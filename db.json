{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/images/alipay-reward-image.jpg","path":"images/alipay-reward-image.jpg","modified":0,"renderable":0},{"_id":"source/images/favicon.ico","path":"images/favicon.ico","modified":0,"renderable":0},{"_id":"source/images/wechat-reward-image.jpg","path":"images/wechat-reward-image.jpg","modified":0,"renderable":0},{"_id":"source/images/blog/newRepository.png","path":"images/blog/newRepository.png","modified":0,"renderable":0},{"_id":"source/images/blog/step2.png","path":"images/blog/step2.png","modified":0,"renderable":0},{"_id":"source/images/blog/step3.png","path":"images/blog/step3.png","modified":0,"renderable":0},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":0,"renderable":1},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":0,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":0,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":0,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/affix.js","path":"js/src/affix.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/algolia-search.js","path":"js/src/algolia-search.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/exturl.js","path":"js/src/exturl.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/js.cookie.js","path":"js/src/js.cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/motion.js","path":"js/src/motion.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/post-details.js","path":"js/src/post-details.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/scroll-cookie.js","path":"js/src/scroll-cookie.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/utils.js","path":"js/src/utils.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","path":"lib/ua-parser-js/dist/ua-parser.min.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","path":"lib/ua-parser-js/dist/ua-parser.pack.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":0,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"source/images/avatar.png","path":"images/avatar.png","modified":0,"renderable":0},{"_id":"themes/next/source/images/avatar.png","path":"images/avatar.png","modified":0,"renderable":1},{"_id":"themes/next/source/js/src/mouse.js","path":"js/src/mouse.js","modified":0,"renderable":1}],"Cache":[{"_id":"themes/next/.editorconfig","hash":"211d2c92bfdddb3e81ea946f4ca7a539f150f4da","modified":1519721038267},{"_id":"themes/next/.gitattributes","hash":"8454b9313cb1a97b63fb87e2d29daee497ce6249","modified":1519721038268},{"_id":"themes/next/.bowerrc","hash":"334da94ca6f024d60d012cc26ea655681e724ad8","modified":1519721038267},{"_id":"themes/next/.gitignore","hash":"0378adb9c2dc4855b3198184df4863cb30e4059c","modified":1519723321641},{"_id":"themes/next/.hound.yml","hash":"289dcf5bfe92dbd680d54d6e0668f41c9c9c0c78","modified":1519721038272},{"_id":"themes/next/.javascript_ignore","hash":"cd250ad74ca22bd2c054476456a73d9687f05f87","modified":1519721038272},{"_id":"themes/next/.jshintrc","hash":"b7d23f2ce8d99fa073f22f9960605f318acd7710","modified":1519721038273},{"_id":"themes/next/.stylintrc","hash":"3b7f9785e9ad0dab764e1c535b40df02f4ff5fd6","modified":1519721038273},{"_id":"themes/next/.travis.yml","hash":"6674fbdfe0d0c03b8a04527ffb8ab66a94253acd","modified":1519721038274},{"_id":"themes/next/LICENSE","hash":"ec44503d7e617144909e54533754f0147845f0c5","modified":1519721038274},{"_id":"themes/next/README.cn.md","hash":"87950c415dd162ff78e98b41f1148b85462103e2","modified":1519721038275},{"_id":"themes/next/README.md","hash":"22f81fb0211cd2efab94ee3292c78da4932ff6d6","modified":1519723321645},{"_id":"themes/next/_config.yml","hash":"4fcc6f1186c1e42c0ada06c748161a62a47ecc64","modified":1520320796109},{"_id":"themes/next/bower.json","hash":"1efc7506abd41eca71d211baece5f1afbc9357e6","modified":1519723321647},{"_id":"themes/next/gulpfile.coffee","hash":"67eaf2515100971f6195b60eeebbfe5e8de895ab","modified":1519723321661},{"_id":"themes/next/package.json","hash":"eaff7a4ba9beb78eb1e8225b5e2a8c75f1edbbb7","modified":1519723321744},{"_id":"source/_posts/Activiti5-流程框架.md","hash":"b8a5e58e26d23d98f9b8df372592a1a30a36db02","modified":1519717118082},{"_id":"source/_posts/Callable及Future.md","hash":"ced5b4d99e27da68294181983c9d6df716bc0e93","modified":1519717118083},{"_id":"source/_posts/DCloud-离线打包之Android-Studio.md","hash":"3befa3b03f213f4a3ea9b8afc684527a5dc0b39e","modified":1519717118084},{"_id":"source/_posts/Java中读取properties.md","hash":"524e54fed85d7dd6bba1a358090f8f8718fe6f41","modified":1519717118084},{"_id":"source/_posts/Java线程池的创建.md","hash":"d2065c35b0e5884e3f90f247ae018040d8ebd900","modified":1519717118085},{"_id":"source/_posts/Mybatis-1-——入门.md","hash":"1b68102a9cd4ff351863bfdf026070246fcde1f4","modified":1519717118086},{"_id":"source/_posts/Mysql-存储过程.md","hash":"e23288d12dad6d0ebbad5d0c9e4e8cf9c77395e9","modified":1519717118087},{"_id":"source/_posts/Mysql——触发器.md","hash":"6e600bf40a541ed67d55bb83cb02e78ec3456172","modified":1519717118087},{"_id":"source/_posts/SNMP学习总结(1)——基本概念.md","hash":"0a35277cd3d90252d3aff2481e71e783497b9e9b","modified":1519717118090},{"_id":"source/_posts/SNMP学习总结(2)——snmp安装和配置.md","hash":"072b2534a4ef46e692376709eb19bd30eebc55c3","modified":1519717118091},{"_id":"source/_posts/SNMP学习笔记(3)——snmp4j.md","hash":"3cf27a9d0de859a9868d0f803ad29aa63dec7da2","modified":1519717118091},{"_id":"source/_posts/Struts2-1-——基本认识.md","hash":"df8eb55862ed6066610fc51348b1aaad0a0b4e86","modified":1519717118092},{"_id":"source/_posts/Struts2-2-——搭建struts及spring整合Demo.md","hash":"cd41ae398f52a822987dfdc15aa0474fccefdca1","modified":1519717118093},{"_id":"source/_posts/Struts2-3-——Action配置及访问方式.md","hash":"6d35e8d47c00822eeabf42cbaaf7197472eb0547","modified":1519717118093},{"_id":"source/_posts/Struts2-4-——数据封装和类型转换.md","hash":"f617b4fc83ef53f3fa97797bc2cbcfb66b672c49","modified":1519717118094},{"_id":"source/_posts/Struts2-5-——拦截器.md","hash":"eea445c038d60f4fe5ff11344f5a12ae88261c7e","modified":1519717118095},{"_id":"source/_posts/Struts2-6-——Struts标签、国际化、文件上传下载.md","hash":"fd64a7fa165536a2cdb3377014fd8cc671c76939","modified":1519717118096},{"_id":"source/_posts/hexo+github搭建个人博客.md","hash":"32eb815c1bae916e5269bbc25326bf538ba05681","modified":1519717118096},{"_id":"source/_posts/spring-1——框架简介.md","hash":"dc5ae2a4dc67e851c0aa778393b4f0986861b22f","modified":1519717118099},{"_id":"source/_posts/html5-常用功能.md","hash":"33cd56f3ef3760157568ddefc2fe9465cc971b03","modified":1519717118097},{"_id":"source/_posts/spring-2——IOC浅析.md","hash":"6d179ab94095d9b9829746e0f4601b85df4251fd","modified":1519717118100},{"_id":"source/_posts/spring-3——AOP浅析.md","hash":"2574a177ae1021803a9a5988ef98b7ff0ddde750","modified":1519717118100},{"_id":"source/_posts/spring-4-——持久层封装.md","hash":"a370906592d9376709c3b9e68ada02c0f0fd2de2","modified":1519717118101},{"_id":"source/_posts/使用i18next完成前端国际化.md","hash":"8a0dcc4d106a5d2b7b38a249033e81bfc362fb60","modified":1519717118102},{"_id":"source/_posts/使用jquery-i18n完成前端国际化.md","hash":"da16e5cac87915c2b9f8ec2b02c1eedc664d3ea9","modified":1519717118103},{"_id":"source/_posts/基于MUI及Html5-开发app.md","hash":"cf619bc1169ae58fd72747ff1c445e603f46b0a6","modified":1519717118103},{"_id":"source/_posts/多线程.md","hash":"5acee14c8f9a6d3cb78ed0196890404e97798388","modified":1519717118104},{"_id":"source/_posts/网站数据分析.md","hash":"5cbacdd889c257d7a149c0b602152186e60e3fd3","modified":1519717118104},{"_id":"source/categories/index.md","hash":"b251fea7db08a1920dd1ee86edb85d12e2660d87","modified":1519717118108},{"_id":"source/images/alipay-reward-image.jpg","hash":"ae2001a613364643005e9798c5a7bf2a13bd2066","modified":1519717118109},{"_id":"source/images/favicon.ico","hash":"75b675529611ce5e08b868af7d616100da70dad8","modified":1519717118115},{"_id":"source/about/index.md","hash":"7150ebb1254d5d82ec1fbc44e1f214b249b0706c","modified":1519717118105},{"_id":"source/photos/data.json","hash":"dba16a3e248e670a0c08a0b1e8b210297b44a4cf","modified":1519717118116},{"_id":"source/photos/index.ejs","hash":"93746d6bf15dd696b708ba7e8eac2fbd35308265","modified":1519717118117},{"_id":"source/photos/index.md","hash":"8a74707bb28e217a64ee8f065ec9bf19dc5e490b","modified":1519717118118},{"_id":"source/photos/ins.css","hash":"43a45811b364e206d2190228b9afe629f2c7d50b","modified":1519717118118},{"_id":"source/photos/ins.js","hash":"2890476636491238c95f168162b93bd83b27b0d2","modified":1519717118120},{"_id":"source/photos/lazyload.min.js","hash":"47cf297e07df9cbf6c2ebced6ef88e8963a6a4ed","modified":1519717118121},{"_id":"source/tags/index.md","hash":"91f9c2e38215cf860e39af7fcf9ed8cb954ab163","modified":1519717118122},{"_id":"themes/next/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1519721038240},{"_id":"themes/next/.git/config","hash":"f1969a9b2e1128a528f7b846c2bc39a7f0984cdf","modified":1519723321620},{"_id":"themes/next/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1519720177124},{"_id":"themes/next/.git/index","hash":"b60cae72b4a05f8446d8f631fb8bf95b9accf9b8","modified":1520321611552},{"_id":"themes/next/.git/packed-refs","hash":"b9fa1b025aa935399db5e0eea292fb1e6fad0530","modified":1519723321592},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"e8400c762e5754baf439ab2b7c9e92acd2fc6fe9","modified":1519723321639},{"_id":"themes/next/.github/ISSUE_TEMPLATE.md","hash":"d19c9b9d6360bbee4bb39a7a8527ec36924dd6b5","modified":1519723321639},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"36201119490a04107c8179b10202548a9d0e5e60","modified":1519723321640},{"_id":"themes/next/.github/browserstack_logo.png","hash":"a6c43887f64a7f48a2814e3714eaa1215e542037","modified":1519721038270},{"_id":"themes/next/languages/de.yml","hash":"1ee86b05a8d9ab81c22c79177627ebff842a2229","modified":1519723321666},{"_id":"themes/next/languages/default.yml","hash":"b3bcd8934327448a43d9bfada5dd11b1b8c1402e","modified":1519721038279},{"_id":"themes/next/languages/en.yml","hash":"2f4b4776ca1a08cc266a19afb0d1350a3926f42c","modified":1519721038280},{"_id":"themes/next/languages/fr-FR.yml","hash":"efeeb55d5c4add54ad59a612fc0630ee1300388c","modified":1519721038280},{"_id":"themes/next/languages/id.yml","hash":"be01386e4fdef4bbc2b2e962c3437e18b1055d30","modified":1519723321673},{"_id":"themes/next/languages/it.yml","hash":"262625a7bf0337718e5f1ecef5fde0be199eb2eb","modified":1519723321673},{"_id":"themes/next/languages/ja.yml","hash":"425e83a333e158d3fe7c13bd164173f9e791c824","modified":1519723321674},{"_id":"themes/next/languages/ko.yml","hash":"a63e411693dca4c78abdeadaa17740912d4e23ab","modified":1519723321675},{"_id":"themes/next/languages/nl-NL.yml","hash":"213e7a002b82fb265f69dabafbbc382cfd460030","modified":1519721038283},{"_id":"themes/next/languages/pt-BR.yml","hash":"8efc68488cae3cbabdf90fc06b7c75808f192003","modified":1519723321679},{"_id":"themes/next/languages/pt.yml","hash":"765af5f3d5e17e5402cb53ddb4c66f43336bdbef","modified":1519723321680},{"_id":"themes/next/languages/ru.yml","hash":"587603f5a591892f1ee32436db584f7211857eba","modified":1519723321681},{"_id":"themes/next/languages/vi.yml","hash":"671228645ff6dfdd2305c08ce94bbebab9e92de7","modified":1519723321686},{"_id":"themes/next/languages/zh-Hans.yml","hash":"66b9b42f143c3cb2f782a94abd4c4cbd5fd7f55f","modified":1519721038286},{"_id":"themes/next/languages/zh-hk.yml","hash":"fe0d45807d015082049f05b54714988c244888da","modified":1519721038286},{"_id":"themes/next/languages/zh-tw.yml","hash":"432463b481e105073accda16c3e590e54c8e7b74","modified":1519721038287},{"_id":"themes/next/layout/_layout.swig","hash":"0d461d49121c47d2b61924ee066f421af3a314e4","modified":1520320672844},{"_id":"themes/next/layout/archive.swig","hash":"678a6cab739b54da9dfb2d6634848cffdc7aab6a","modified":1519723321740},{"_id":"themes/next/layout/category.swig","hash":"3cbb3f72429647411f9e85f2544bdf0e3ad2e6b2","modified":1519721038333},{"_id":"themes/next/layout/index.swig","hash":"555a357ecf17128db4e29346c92bb6298e66547a","modified":1519721038334},{"_id":"themes/next/layout/page.swig","hash":"fbf2c3d14c3e5730fad75d7d106bf7f070ccd69c","modified":1519723321742},{"_id":"themes/next/layout/post.swig","hash":"ceba7287574c429a235aa7a62bf7a3dc1efb265a","modified":1519723321742},{"_id":"themes/next/layout/schedule.swig","hash":"87ad6055df01fa2e63e51887d34a2d8f0fbd2f5a","modified":1519721038336},{"_id":"themes/next/layout/tag.swig","hash":"34e1c016cbdf94a31f9c5d494854ff46b2a182e9","modified":1519721038336},{"_id":"themes/next/scripts/merge-configs.js","hash":"176952dfe3605c2ab57f3f7cdbac4f2487825c41","modified":1519723321745},{"_id":"themes/next/scripts/merge.js","hash":"39b84b937b2a9608b94e5872349a47200e1800ff","modified":1519721038339},{"_id":"themes/next/test/.jshintrc","hash":"c9fca43ae0d99718e45a6f5ce736a18ba5fc8fb6","modified":1519721038519},{"_id":"themes/next/test/helpers.js","hash":"f25e7f3265eb5a6e1ccbb5e5012fa9bebf134105","modified":1519721038519},{"_id":"themes/next/test/intern.js","hash":"db90b1063356727d72be0d77054fdc32fa882a66","modified":1519721038520},{"_id":"source/images/avatar.jpg","hash":"f5c15c3a390550ab84662fbcc6dcdd34e53deb22","modified":1519718205742},{"_id":"source/images/wechat-reward-image.jpg","hash":"4532622ab5a752b82d00b96dca3bd3239f0ac30a","modified":1519717118116},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1519721038417},{"_id":"source/images/blog/newRepository.png","hash":"91e0c5fb0b354385812a50da67605398a3c056a7","modified":1519717118112},{"_id":"source/images/blog/step2.png","hash":"4797f5bd95528679a1cdd46593fb6e32309ca5b6","modified":1519717118113},{"_id":"source/images/blog/step3.png","hash":"b897b0e3f5a40af76c4e9f04fcb53ccee15b5daa","modified":1519717118114},{"_id":"themes/next/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1519720177125},{"_id":"themes/next/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1519720177126},{"_id":"themes/next/.git/hooks/fsmonitor-watchman.sample","hash":"f7c0aa40cb0d620ff0bca3efe3521ec79e5d7156","modified":1519720177127},{"_id":"themes/next/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1519720177127},{"_id":"themes/next/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1519720177128},{"_id":"themes/next/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1519720177128},{"_id":"themes/next/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1519720177129},{"_id":"themes/next/.git/hooks/pre-rebase.sample","hash":"288efdc0027db4cfd8b7c47c4aeddba09b6ded12","modified":1519720177130},{"_id":"themes/next/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1519720177130},{"_id":"themes/next/.git/hooks/prepare-commit-msg.sample","hash":"2584806ba147152ae005cb675aa4f01d5d068456","modified":1519720177131},{"_id":"themes/next/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1519720177131},{"_id":"themes/next/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1519720177132},{"_id":"themes/next/.git/logs/HEAD","hash":"dd4c86ac6293c2fabba8904ce1b626ccafbe0c79","modified":1519723321610},{"_id":"themes/next/layout/_custom/sidebar.swig","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1519721038289},{"_id":"themes/next/layout/_custom/header.swig","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1519721038288},{"_id":"themes/next/layout/_partials/comments.swig","hash":"2e8c3df265e9ae38003d1321fb80fb3b12cb6a97","modified":1519723321698},{"_id":"themes/next/layout/_partials/footer.swig","hash":"2132dd17e0f8269f1f1c8d66df6684f2a6d1b90b","modified":1519723321698},{"_id":"themes/next/layout/_partials/head.swig","hash":"f14a39dad1ddd98e6d3ceb25dda092ba80d391b5","modified":1519721038296},{"_id":"themes/next/layout/_partials/header.swig","hash":"bd7bc75b94e157e16f3578460ad02a380df31478","modified":1519723321701},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"1634fb887842698e01ff6e632597fe03c75d2d01","modified":1519721038299},{"_id":"themes/next/layout/_partials/page-header.swig","hash":"206cbd6ac9ca6a219a8516f59beae25b3c770199","modified":1519723321701},{"_id":"themes/next/layout/_partials/search.swig","hash":"b4ebe4a52a3b51efe549dd1cdee846103664f5eb","modified":1519721038299},{"_id":"themes/next/layout/_scripts/boostrap.swig","hash":"c0f5a0955f69ca4ed9ee64a2d5f8aa75064935ad","modified":1519721038304},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"931808ad9b8d8390c0dcf9bdeb0954eeb9185d68","modified":1519721038305},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"f134aeb8d5bee351e5277edb92ac694af314b75f","modified":1519723321711},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"8c56dd26157cbc580ae41d97ac34b90ab48ced3f","modified":1519721038291},{"_id":"themes/next/layout/_macro/post-copyright.swig","hash":"949bf640c011689e518ad480299ab19785df4b80","modified":1519723321693},{"_id":"themes/next/layout/_macro/reward.swig","hash":"8dc3b6ba76c389aaa0810cbd0df206f7096d76a0","modified":1519723321695},{"_id":"themes/next/layout/_macro/post.swig","hash":"04e01e1bf1102d6b514101da3f7c9800fdd1c1fc","modified":1519723321694},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"2d8e3b4a211d55f4861eb2375b6fdd786484bf71","modified":1519723321695},{"_id":"themes/next/layout/_macro/wechat-subscriber.swig","hash":"616ffee93e84958e72ee0f996808f866c4ccdbf7","modified":1519723321696},{"_id":"themes/next/layout/_third-party/duoshuo-hot-articles.swig","hash":"ba75672183d94f1de7c8bd0eeee497a58c70e889","modified":1519721038324},{"_id":"themes/next/layout/_third-party/exturl.swig","hash":"8301c9600bb3e47f7fb98b0e0332ef3c51bb1688","modified":1519721038324},{"_id":"themes/next/layout/_third-party/mathjax.swig","hash":"a0bd3388587fd943baae0d84ca779a707fbcad89","modified":1519721038325},{"_id":"themes/next/layout/_third-party/needsharebutton.swig","hash":"debba9b7110f635204a15df148194d4c2fd2668b","modified":1519723321732},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"554ec568e9d2c71e4a624a8de3cb5929050811d6","modified":1519721038326},{"_id":"themes/next/layout/_third-party/schedule.swig","hash":"db15d7e1552aa2d2386a6b8a33b3b3a40bf9e43d","modified":1519721038327},{"_id":"themes/next/layout/_third-party/scroll-cookie.swig","hash":"9a188938d46931d5f3882a140aa1c48b3a893f0c","modified":1519721038327},{"_id":"themes/next/scripts/tags/button.js","hash":"496e3846f353d253dad944b2ed8fdc4e02dcc28a","modified":1519723321747},{"_id":"themes/next/scripts/tags/exturl.js","hash":"4f928ef9ad0ae8e3d766352b8861bc22f96de5d8","modified":1519723321748},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"696157d4e4382fdbe29c674b0f4b433d47db449b","modified":1519723321749},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"5c87817385986748617fa87dee9cba654566adcd","modified":1519723321748},{"_id":"themes/next/scripts/tags/lazy-image.js","hash":"92c0ead5f503cfc4ee7c254ebfb00a2623fa1890","modified":1519723321751},{"_id":"themes/next/scripts/tags/note.js","hash":"1cec218c9fcaa8fb4144bf9d0b39babcaafac8d4","modified":1519723321752},{"_id":"themes/next/scripts/tags/tabs.js","hash":"aa7fc94a5ec27737458d9fe1a75c0db7593352fd","modified":1519721038345},{"_id":"themes/next/scripts/tags/label.js","hash":"d8bfb2974c6afef2c085642857b70b6569b4a097","modified":1519723321751},{"_id":"themes/next/scripts/tags/full-image.js","hash":"2118895d2d5e379240b27399a6c988a74f25a427","modified":1519723321749},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1519721038418},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"45eeea0b5fba833e21e38ea10ed5ab385ceb4f01","modified":1519721038418},{"_id":"themes/next/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1519721038419},{"_id":"themes/next/source/css/main.styl","hash":"2a62e2a11e9cdcc69e538d856d6f9ce228a07c93","modified":1519723321832},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"bc3588c9b2d7c68830524783120ff6cf957cf668","modified":1519721038420},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"6f55543d1fb9cbc436c101d24f802dec7b41efc3","modified":1519721038420},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"6f076713fb9bf934aa2c1046bdf2cf2e37bc1eab","modified":1519721038422},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"42cd73da328077ccc92f859bb8f3cf621b3484f8","modified":1519721038422},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"70c1535f43e54e5ff35ca81419e77e4c0c301398","modified":1519721038423},{"_id":"themes/next/source/images/cc-zero.svg","hash":"9bfb52b2f63527a7049247bf00d44e6dc1170e7d","modified":1519721038424},{"_id":"themes/next/source/images/cc-by.svg","hash":"e92a33c32d1dac8ed94849b2b4e6456e887efe70","modified":1519721038423},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1519721038424},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1519721038425},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1519721038426},{"_id":"themes/next/source/images/logo.svg","hash":"169f56fd82941591dad3abd734a50ec7259be950","modified":1519721038426},{"_id":"themes/next/source/images/quote-r.svg","hash":"2a2a250b32a87c69dcc1b1976c74b747bedbfb41","modified":1519721038428},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1519721038427},{"_id":"themes/next/source/images/quote-l.svg","hash":"cd108d6f44351cadf8e6742565217f88818a0458","modified":1519721038427},{"_id":"themes/next/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1519721038429},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1519721038308},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1519721038308},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1519721038394},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1519721038395},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1519721038396},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1519721038414},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1519721038415},{"_id":"themes/next/.git/refs/heads/master","hash":"df2628595c2b95807ef63be43ceea6d0e20ba7d2","modified":1519723321610},{"_id":"themes/next/layout/_partials/head/custom-head.swig","hash":"a223919d2e1bf17ca4d6abb2c86f2efca9883dc1","modified":1519721038297},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"f5e487b0d213ca0bd94aa30bc23b240d65081627","modified":1519721038297},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"b2f0d247b213e4cf8de47af6a304d98070cc7256","modified":1519721038300},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"a8c7f9ca7c605d039a1f3bf4e4d3183700a3dd62","modified":1519721038301},{"_id":"themes/next/layout/_partials/search/tinysou.swig","hash":"b25002a83cbd2ca0c4a5df87ad5bff26477c0457","modified":1519721038301},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"9e3d133ac5bcc6cb51702c83b2611a49811abad1","modified":1519721038302},{"_id":"themes/next/layout/_partials/share/duoshuo_share.swig","hash":"d4fbffd7fa8f2090eb32a871872665d90a885fac","modified":1519721038303},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"d9e2d9282f9be6e04eae105964abb81e512bffed","modified":1519721038302},{"_id":"themes/next/layout/_partials/share/jiathis.swig","hash":"0a9cdd6958395fcdffc80ab60f0c6301b63664a5","modified":1519721038303},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"9b84ab576982b2c3bb0291da49143bc77fba3cc6","modified":1519721038306},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"a9a3995b9615adfb8d6b127c78c6771627bee19a","modified":1519721038307},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"a9a3995b9615adfb8d6b127c78c6771627bee19a","modified":1519721038309},{"_id":"themes/next/layout/_third-party/analytics/analytics-with-widget.swig","hash":"ff947f3561b229bc528cb1837d4ca19612219411","modified":1519721038311},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"71397a5823e8ec8aad3b68aace13150623b3e19d","modified":1519721038311},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"753d262911c27baf663fcaf199267133528656af","modified":1519721038312},{"_id":"themes/next/layout/_third-party/analytics/busuanzi-counter.swig","hash":"c43f41b7f3c0743d1e673af2e787ea34a67fc9cb","modified":1519723321715},{"_id":"themes/next/layout/_third-party/analytics/cnzz-analytics.swig","hash":"a10b7f19d7b5725527514622899df413a34a89db","modified":1519721038313},{"_id":"themes/next/layout/_third-party/analytics/firestore.swig","hash":"d67d9a176a276cdab6f2bcb7eb3650fbca5459c4","modified":1519723321717},{"_id":"themes/next/layout/_third-party/analytics/facebook-sdk.swig","hash":"7d94845f96197d9d84a405fa5d4ede75fb81b225","modified":1519721038314},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"cfc932c5db04fef64cc56d3ba0b8ddf3a15a63bd","modified":1519723321718},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"45f3f629c2aacc381095750e1c8649041a71a84b","modified":1519721038315},{"_id":"themes/next/layout/_third-party/analytics/lean-analytics.swig","hash":"9f5240af3dc8f4c355fd6c3001045bc8dba7f475","modified":1519723321719},{"_id":"themes/next/layout/_third-party/analytics/tencent-analytics.swig","hash":"8a399df90dadba5ad4e781445b58f4765aeb701e","modified":1519721038316},{"_id":"themes/next/layout/_third-party/analytics/tencent-mta.swig","hash":"5a8027328f060f965b3014060bebec1d7cf149c1","modified":1519721038317},{"_id":"themes/next/layout/_third-party/analytics/vkontakte-api.swig","hash":"f9a1647a8f1866deeb94052d1f87a5df99cb1e70","modified":1519721038317},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"4c501ea0b9c494181eb3c607c5526a5754e7fbd8","modified":1519721038318},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"a693a2c00497471d06113443f548b676ee2e527d","modified":1519723321723},{"_id":"themes/next/layout/_third-party/comments/duoshuo.swig","hash":"1600f340e0225361580c44890568dc07dbcf2c89","modified":1519721038319},{"_id":"themes/next/layout/_third-party/comments/gitment.swig","hash":"292cdd1059b76d3d10486b71c99d9afb3e59ea44","modified":1519723321723},{"_id":"themes/next/layout/_third-party/comments/hypercomments.swig","hash":"787d482d797c38e77d69629ebb88d45f972216b7","modified":1519723321724},{"_id":"themes/next/layout/_third-party/comments/index.swig","hash":"18a58db53f1eef50462ee0065d4445b7fbb04fb5","modified":1519723321724},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"7cf0c589d95a2d1848266ffe2357e91c95d2e7f8","modified":1519723321725},{"_id":"themes/next/layout/_third-party/comments/valine.swig","hash":"de1fac9bb3f0cab88b1ed1950f76c7eb0037aeda","modified":1519723321726},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"34599633658f3b0ffb487728b7766e1c7b551f5a","modified":1519721038330},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"71c897f9b107dd0de1b7f649633cf583c206a9db","modified":1519723321738},{"_id":"themes/next/layout/_third-party/comments/youyan.swig","hash":"ab181c036cda9656f87bb1a749e3e7cbc437f012","modified":1519723321726},{"_id":"themes/next/layout/_third-party/search/tinysou.swig","hash":"fe95dd3d166634c466e19aa756e65ad6e8254d3e","modified":1519721038331},{"_id":"themes/next/layout/_third-party/seo/baidu-push.swig","hash":"d8c98938719284fa06492c114d99a1904652a555","modified":1519721038332},{"_id":"themes/next/source/css/_mixins/Gemini.styl","hash":"07f7da320689f828f6e36a6123807964a45157a0","modified":1519721038394},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"8aa98ae349908736ba43196c42498fd5bdeb780a","modified":1519723321811},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"0e55cbd93852dc3f8ccb44df74d35d9918f847e0","modified":1519721038396},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"f276ccca4f9c254b467d23ce4e7b4f748c9ce7ae","modified":1520321989012},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"8b5fc9e6621a5de04ae7d9ef117683c69965fb00","modified":1519723321829},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"a25408534f8fe6e321db4bbf9dd03335d648fe17","modified":1519721038413},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"b89e68789e6dac24e00250528f4fc9ae8aa3599b","modified":1519723321830},{"_id":"themes/next/source/css/_variables/base.styl","hash":"534b9dec93f3e235c217b97314d4bf513fa3e5ba","modified":1519723321831},{"_id":"themes/next/source/js/src/affix.js","hash":"1b509c3b5b290a6f4607f0f06461a0c33acb69b1","modified":1519721038430},{"_id":"themes/next/source/js/src/algolia-search.js","hash":"cb431b54ba9c692165a1f5a12e4c564a560f8058","modified":1519721038431},{"_id":"themes/next/source/js/src/bootstrap.js","hash":"6c30aab4822b189d1fe9b20ca5272fd8d3ebe998","modified":1519723321848},{"_id":"themes/next/source/js/src/exturl.js","hash":"a2a0f0de07e46211f74942a468f42ee270aa555c","modified":1519721038432},{"_id":"themes/next/source/js/src/hook-duoshuo.js","hash":"b35a7dc47b634197b93487cea8671a40a9fdffce","modified":1519721038433},{"_id":"themes/next/source/js/src/js.cookie.js","hash":"1512c751d219577d338ac0780fb2bbd9075d5298","modified":1519721038433},{"_id":"themes/next/source/js/src/motion.js","hash":"bea49fc6392bd38fb6f80d041d95d23051423aa2","modified":1519723321849},{"_id":"themes/next/source/js/src/post-details.js","hash":"02acfa1862d5e4345d6a7cee08841cc9e2fb0259","modified":1519723321891},{"_id":"themes/next/source/js/src/scroll-cookie.js","hash":"02cf91514e41200bc9df5d8bdbeb58575ec06074","modified":1519721038436},{"_id":"themes/next/source/js/src/scrollspy.js","hash":"b7657be25fc52ec67c75ab5481bdcb483573338b","modified":1519721038437},{"_id":"themes/next/source/js/src/utils.js","hash":"2c1f25c2fae32524b1d910875a2b8d3a6a611af1","modified":1519723321894},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.css","hash":"90ef19edc982645b118b095615838d9c5eaba0de","modified":1519721038448},{"_id":"themes/next/source/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1519721038452},{"_id":"themes/next/source/lib/canvas-ribbon/canvas-ribbon.js","hash":"b02737510e9b89aeed6b54f89f602a9c24b06ff2","modified":1519721038453},{"_id":"themes/next/source/lib/fancybox/.bower.json","hash":"9be892a4e14e0da18ff9cb962c9ef71f163b1b22","modified":1519721038453},{"_id":"themes/next/source/lib/fancybox/.gitattributes","hash":"672d3b5767e0eacd83bb41b188c913f2cf754793","modified":1519721038454},{"_id":"themes/next/source/lib/fastclick/.bower.json","hash":"bf3eef9d647cd7c9b62feda3bc708c6cdd7c0877","modified":1519721038465},{"_id":"themes/next/source/lib/fastclick/LICENSE","hash":"6f474ea75c42442da7bbcf2e9143ce98258efd8d","modified":1519721038465},{"_id":"themes/next/source/lib/fastclick/README.md","hash":"68a9b9d53126405b0fa5f3324f1fb96dbcc547aa","modified":1519721038466},{"_id":"themes/next/source/lib/fastclick/bower.json","hash":"a9b3ee1e4db71a0e4ea6d5bed292d176dd68b261","modified":1519721038467},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"03ddbf76c1dd1afb93eed0b670d2eee747472ef1","modified":1519721038470},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"c31ff06a740955e44edd4403902e653ccabfd4db","modified":1519721038471},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"b4aefc910578d76b267e86dfffdd5121c8db9aec","modified":1519721038470},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"ee33b2798b1e714b904d663436c6b3521011d1fa","modified":1519721038471},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"71e7183634dc1b9449f590f15ebd7201add22ca7","modified":1519721038472},{"_id":"themes/next/source/lib/jquery/.bower.json","hash":"865d6c1328ab209a4376b9d2b7a7824369565f28","modified":1519721038487},{"_id":"themes/next/source/lib/jquery_lazyload/.bower.json","hash":"90fa628f156d8045357ff11eaf32e61abacf10e8","modified":1519721038489},{"_id":"themes/next/source/lib/jquery_lazyload/CONTRIBUTING.md","hash":"4ded6fee668544778e97e38c2b211fc56c848e77","modified":1519721038490},{"_id":"themes/next/source/lib/jquery_lazyload/README.md","hash":"b930297cb98b8e1dbd5abe9bc1ed9d5935d18ce8","modified":1519721038491},{"_id":"themes/next/source/lib/jquery_lazyload/bower.json","hash":"e0acf1db27b0cc16128a59c46db1db406b5c4c58","modified":1519721038491},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.lazyload.js","hash":"f4a570908f6c89c6edfb1c74959e733eaadea4f2","modified":1519721038492},{"_id":"themes/next/source/lib/jquery_lazyload/jquery.scrollstop.js","hash":"bf773ad48a0b9aa77681a89d7569eefc0f7b7b18","modified":1519721038492},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.css","hash":"e33aa8fa48b6639d8d8b937d13261597dd473b3a","modified":1519721038495},{"_id":"themes/next/source/lib/needsharebutton/font-embedded.css","hash":"14264a210bf94232d58d7599ea2ba93bfa4fb458","modified":1519721038494},{"_id":"themes/next/source/lib/needsharebutton/needsharebutton.js","hash":"2ce5f3bf15c523b9bfc97720d8884bb22602a454","modified":1519721038496},{"_id":"themes/next/source/lib/three/canvas_lines.min.js","hash":"2d9a9f38c493fdf7c0b833bb9184b6a1645c11b2","modified":1519721038505},{"_id":"themes/next/source/lib/three/canvas_sphere.min.js","hash":"46a50b91c98b639c9a2b9265c5a1e66a5c656881","modified":1519721038505},{"_id":"themes/next/source/lib/three/three-waves.min.js","hash":"8148492dd49aa876d32bb7d5b728d3f5bf6f5074","modified":1519721038506},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1519721038497},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1519721038497},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1519721038498},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1519721038498},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1519721038499},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1519721038499},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","hash":"67f44c947548bd4d77e7590d3f59e236cbf9e98a","modified":1519721038500},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1519721038500},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1519721038501},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1519721038501},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1519721038502},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1519721038502},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1519721038503},{"_id":"themes/next/source/lib/pace/pace.min.js","hash":"8aaa675f577d5501f5f22d5ccb07c2b76310b690","modified":1519721038504},{"_id":"themes/next/source/lib/velocity/.bower.json","hash":"63da5e80ebb61bb66a2794d5936315ca44231f0c","modified":1519721038513},{"_id":"themes/next/source/lib/velocity/bower.json","hash":"92d92860418c4216aa59eb4cb4a556290a7ad9c3","modified":1519721038514},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"bf172816a9c57f9040e3d19c24e181a142daf92b","modified":1519721038516},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","hash":"dbbfb50f6502f6b81dcc9fee7b31f1e812da3464","modified":1519721038517},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"dde584994ac13dc601836e86f4cf490e418d9723","modified":1519721038518},{"_id":"themes/next/source/lib/jquery/index.js","hash":"17a740d68a1c330876c198b6a4d9319f379f3af2","modified":1519721038488},{"_id":"themes/next/.git/logs/refs/heads/master","hash":"dd4c86ac6293c2fabba8904ce1b626ccafbe0c79","modified":1519723321612},{"_id":"themes/next/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1519721038237},{"_id":"themes/next/layout/_third-party/search/algolia-search/assets.swig","hash":"218cc936ba3518a3591b2c9eda46bc701edf7710","modified":1519721038329},{"_id":"themes/next/layout/_third-party/search/algolia-search/dom.swig","hash":"2530de0f3125a912756f6c0e9090cd012134a4c5","modified":1519721038329},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"8f86f694c0749a18ab3ad6f6df75466ca137a4bc","modified":1519721038347},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"8b32928686c327151e13d3ab100157f9a03cd59f","modified":1519721038348},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"237d185ac62ec9877e300947fa0109c44fb8db19","modified":1519721038348},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"ff4489cd582f518bba6909a301ac1292a38b4e96","modified":1519721038349},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"7ad4081466b397e2a6204141bb7768b7c01bd93c","modified":1519721038349},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"4f2801fc4cf3f31bf2069f41db8c6ce0e3da9e39","modified":1519721038360},{"_id":"themes/next/source/css/_common/components/tag-cloud.styl","hash":"6eb4bcc3056bd279d000607e8b4dad50d368ca69","modified":1519721038376},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"12662536c7a07fff548abe94171f34b768dd610f","modified":1519721038389},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"24ee4b356ff55fc6e58f26a929fa07750002cf29","modified":1519721038390},{"_id":"themes/next/source/css/_common/scaffolding/mobile.styl","hash":"91ca75492cd51f2553f4d294ed2f48239fcd55eb","modified":1519721038391},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"1da5c800d025345f212a3bf1be035060f4e5e6ed","modified":1519721038390},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"3f40e8a9fe8e7bd5cfc4cf4cbbbcb9539462e973","modified":1519721038391},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"a17e2b871a335f290afb392a08f94fd35f59c715","modified":1519721038392},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"ea9069645696f86c5df64208490876fe150c8cae","modified":1519721038392},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"af5f652a366a0fc2874eb9a8cc58885ab6b043fc","modified":1519723321814},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"25d5e45a355ee2093f3b8b8eeac125ebf3905026","modified":1519721038399},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"d0bfd1bef988c76f7d7dd72d88af6f0908a8b0db","modified":1519721038399},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"b1025c421406d2c24cc92a02ae28c1915b01e240","modified":1519721038400},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"65b23000b74b935b2a26f1b4c67d5c8514fd9d34","modified":1519723321816},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"9c99034f8e00d47e978b3959f51eb4a9ded0fcc8","modified":1519721038401},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"09c965022c13b84ed8a661fee8ac2a6d550495ae","modified":1519721038402},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"2ccb9bdc309b7c1ef183a3dbb0a4621bec54a328","modified":1519723321818},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"31127dcbf4c7b4ada53ffbf1638b5fe325b7cbc0","modified":1519721038406},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"748dbfbf9c08e719ddc775958003c64b00d39dab","modified":1519721038406},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"3cc7646583218d16925ced7b70865e63a901d4a7","modified":1519723321822},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"09c965022c13b84ed8a661fee8ac2a6d550495ae","modified":1519721038407},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"b26f8a3394d8357a5bfd24d9f8bf62d7b4063ebb","modified":1519723321823},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"bce344d3a665b4c55230d2a91eac2ad16d6f32fd","modified":1519721038409},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"cc961108b12ab97d9216606ceb1cd1cd31ab20f0","modified":1519723321826},{"_id":"themes/next/source/css/_schemes/Pisces/_posts.styl","hash":"1f6e2ce674735269599acc6d77b3ea18d31967fc","modified":1519721038411},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"df16dc995eb9ad498df2edcfc3e20528fc9aa133","modified":1519723321827},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"86197902dfd3bededba10ba62b8f9f22e0420bde","modified":1519721038412},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"ab7eb1d66e300264a225feb6f8bed55683c96cdf","modified":1519723321825},{"_id":"themes/next/source/js/src/schemes/pisces.js","hash":"f1d0b5d7af32c423eaa8bb93ab6a0b45655645dc","modified":1519721038436},{"_id":"themes/next/source/lib/Han/dist/han.css","hash":"6c26cdb36687d4f0a11dabf5290a909c3506be5c","modified":1519721038444},{"_id":"themes/next/source/lib/Han/dist/han.min.css","hash":"6d586bfcfb7ae48f1b12f76eec82d3ad31947501","modified":1519721038446},{"_id":"themes/next/source/lib/Han/dist/han.min.js","hash":"16b03db23a52623348f37c04544f2792032c1fb6","modified":1519721038447},{"_id":"themes/next/source/lib/fancybox/source/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1519721038455},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1519721038455},{"_id":"themes/next/source/lib/fancybox/source/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1519721038456},{"_id":"themes/next/source/lib/fancybox/source/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1519721038456},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1519721038457},{"_id":"themes/next/source/lib/fancybox/source/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1519721038458},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","hash":"82f33ad0842aa9c154d029e0dada2497d4eb1d57","modified":1519721038462},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","hash":"ae6318aeb62ad4ce7a7e9a4cdacd93ffb004f0fb","modified":1519721038464},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","hash":"d71602cbca33b9ecdb7ab291b7f86a49530f3601","modified":1519721038463},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.min.js","hash":"2cae0f5a6c5d6f3cb993015e6863f9483fc4de18","modified":1519721038468},{"_id":"themes/next/source/lib/fastclick/lib/fastclick.js","hash":"1d6aeda0480d0e4cb6198edf7719d601d4ae2ccc","modified":1519721038468},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"3655f1fdf1e584c4d8e8d39026093ca306a5a341","modified":1519721038473},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"1573904b82807abbb32c97a3632c6c6808eaac50","modified":1519721038473},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"88af80502c44cd52ca81ffe7dc7276b7eccb06cf","modified":1519721038474},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","hash":"41ea797c68dbcff2f6fb3aba1d1043a22e7cc0f6","modified":1519721038511},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"a817b6c158cbc5bab3582713de9fe18a18a80552","modified":1519721038512},{"_id":"themes/next/source/lib/Han/dist/han.js","hash":"4ac683b2bc8531c84d98f51b86957be0e6f830f3","modified":1519721038445},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1519721038485},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1519721038486},{"_id":"themes/next/source/lib/velocity/velocity.js","hash":"4237c6e9d59da349639de20e559e87c2c0218cfd","modified":1519721038515},{"_id":"themes/next/.git/logs/refs/remotes/origin/HEAD","hash":"dd4c86ac6293c2fabba8904ce1b626ccafbe0c79","modified":1519723321601},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"9f73c4696f0907aa451a855444f88fc0698fa472","modified":1519721038350},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"34f5ac3c1ed2dd31e9297cc4c0733e71bc2e252f","modified":1519723321762},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d63e0cacc53dd375fcc113465a4328c59ff5f2c1","modified":1519721038352},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"1a0d059799a298fe17c49a44298d32cebde93785","modified":1519721038352},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"0656e753f182c9f47fef7304c847b7587a85ef0d","modified":1519721038353},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"1727702eac5d326b5c81a667944a245016668231","modified":1519721038354},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"167986d0f649516671ddf7193eebba7b421cd115","modified":1519721038355},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"50450d9fdc8a2b2be8cfca51e3e1a01ffd636c0b","modified":1519721038355},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"7fe4d4d656e86276c17cb4e48a560cb6a4def703","modified":1519721038356},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"b6f3a06a94a6ee5470c956663164d58eda818a64","modified":1519721038357},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"7fb593f90d74a99c21840679933b9ef6fdc16a61","modified":1519721038358},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"ad4cae23c8e383f4fabc9a2a95bca6055020d22e","modified":1519723321771},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"4e3838d7ac81d9ad133960f0f7ed58a44a015285","modified":1519721038359},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"8cf318644acc8b4978537c263290363e21c7f5af","modified":1519721038359},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"62fbbd32cf5a99ae550c45c763a2c4813a138d01","modified":1519721038361},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"875cbe88d5c7f6248990e2beb97c9828920e7e24","modified":1519721038361},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"caf263d1928496688c0e1419801eafd7e6919ce5","modified":1519721038362},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"a200c0a1c5a895ac9dc41e0641a5dfcd766be99b","modified":1519721038362},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"a6c6eb8adba0a090ad1f4b9124e866887f20d10d","modified":1519721038363},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"cd9e214e502697f2f2db84eb721bac57a49b0fce","modified":1519721038364},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"78d4d664b71cd1c8360f6dfb158457b03b8b0608","modified":1519723321779},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"27deb3d3a243d30022055dac7dad851024099a8b","modified":1519721038365},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"ca88ea6999a61fb905eb6e72eba5f92d4ee31e6e","modified":1519721038365},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"b2495ae5e04dcca610aacadc47881d9e716cd440","modified":1519721038366},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"5a982d8ef3b3623ea5f59e63728990f5623c1b57","modified":1519721038366},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"ccb34c52be8adba5996c6b94f9e723bd07d34c16","modified":1519721038367},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"01567edaea6978628aa5521a122a85434c418bfd","modified":1519721038367},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"7968343e41f8b94b318c36289dff1196c3eb1791","modified":1519721038368},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"1faeb3fca899df9d033e4e6ad9a4867cdce7ef9d","modified":1519723321784},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"fa57ec9a6f1943c0558856dfba2d6b8faca0cd4d","modified":1519723321785},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"761eba9811b050b25d548cc0854de4824b41eb08","modified":1519721038371},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"11c22f0fb3f6beb13e5a425ec064a4ff974c13b7","modified":1519721038372},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"61f8cea3c01acd600e90e1bc2a07def405503748","modified":1519721038372},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"1153bb71edf253765145559674390e16dd67c633","modified":1519721038373},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"9e05a2232faabb41bcebb51d545d897a76f077da","modified":1519723321789},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"a1521d48bb06d8d703753f52a198baa197af7da2","modified":1519721038374},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"94d76e6da600a36d80e2470326ebb6b3be447ccb","modified":1519723321790},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"e71652d3216e289c8548b1ea2357822c1476a425","modified":1519721038375},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"8dd9a1c6f4f6baa00c2cf01837e7617120cf9660","modified":1519721038371},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"2fe76476432b31993338cb45cdb3b29a518b6379","modified":1519721038377},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"d79c051abb8ab7b5ee5da29a28587704fd5108f5","modified":1519723321794},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"2ad1a2a9bbf6742d1b0762c4c623b68113d1e0fe","modified":1519721038378},{"_id":"themes/next/source/css/_common/components/tags/exturl.styl","hash":"a3bdd71237afc112b2aa255f278cab6baeb25351","modified":1519721038377},{"_id":"themes/next/source/css/_common/components/tags/label.styl","hash":"2ab1322fe52ab5aafd49e68f5bd890e8380ee927","modified":1519721038379},{"_id":"themes/next/source/css/_common/components/tags/note-modern.styl","hash":"b7076e58d647265ee0ad2b461fe8ce72c9373bc5","modified":1519721038380},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"9a409b798decdefdaf7a23f0b11004a8c27e82f3","modified":1519721038380},{"_id":"themes/next/source/css/_common/components/tags/tabs.styl","hash":"154a87a32d2fead480d5e909c37f6c476671c5e6","modified":1519721038381},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"b80604868e4f5cf20fccafd7ee415c20c804f700","modified":1519721038381},{"_id":"themes/next/source/css/_common/components/third-party/algolia-search.styl","hash":"957259131bad29e1aa5df49718c8af27f495a71c","modified":1519723321799},{"_id":"themes/next/source/css/_common/components/third-party/baidushare.styl","hash":"5dbeed535d63a50265d96b396a5440f9bb31e4ba","modified":1519721038383},{"_id":"themes/next/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"a6e7d698702c2e383dde3fde2abde27951679084","modified":1519721038384},{"_id":"themes/next/source/css/_common/components/third-party/duoshuo.styl","hash":"717cc7f82be9cc151e23a7678601ff2fd3a7fa1d","modified":1519721038384},{"_id":"themes/next/source/css/_common/components/third-party/gitment.styl","hash":"874278147115601d2abf15987f5f7a84ada1ac6b","modified":1519721038385},{"_id":"themes/next/source/css/_common/components/third-party/jiathis.styl","hash":"15975ba7456b96916b1dbac448a1a0d2c38b8f3d","modified":1519721038386},{"_id":"themes/next/source/css/_common/components/third-party/han.styl","hash":"10599e16414a8b7a76c4e79e6617b5fe3d4d1adf","modified":1519721038386},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"16087276945fa038f199692e3eabb1c52b8ea633","modified":1519721038387},{"_id":"themes/next/source/css/_common/components/third-party/needsharebutton.styl","hash":"28825ae15fa20ae3942cdaa7bcc1f3523ce59acc","modified":1519721038387},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"0b9c4140d7bc526553553552c3ed92da7c81e0b6","modified":1519723321804},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"a07aa12cc36ac5c819670c2a3c17d07ed7a08986","modified":1519721038403},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"1f09be9bb38411f0629b58c3b23873589a6dbcaa","modified":1519721038405},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"1f09be9bb38411f0629b58c3b23873589a6dbcaa","modified":1519721038409},{"_id":"themes/next/source/lib/Han/dist/font/han-space.otf","hash":"07436f011b44051f61b8329c99de4bec64e86f4b","modified":1519721038440},{"_id":"themes/next/source/lib/Han/dist/font/han-space.woff","hash":"7a635062b10bf5662ae1d218ba0980171005d060","modified":1519721038441},{"_id":"themes/next/source/lib/Han/dist/font/han.otf","hash":"f1f6bb8f461f5672e000380195d3d2358a28494c","modified":1519721038442},{"_id":"themes/next/source/lib/Han/dist/font/han.woff","hash":"f38ff9b2eecaa17b50b66aa2dae87e9e7436d195","modified":1519721038442},{"_id":"themes/next/source/lib/Han/dist/font/han.woff2","hash":"623af3ed5423371ac136a4fe0e8cc7bb7396037a","modified":1519721038443},{"_id":"themes/next/source/lib/fancybox/source/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1519721038459},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.css","hash":"6394c48092085788a8c0ef72670b0652006231a1","modified":1519721038459},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-buttons.js","hash":"ee948b4489aedeb548a77c9e45d8c7c5732fd62d","modified":1519721038460},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-media.js","hash":"51139a4c79573d372a347ef01a493222a1eaf10a","modified":1519721038460},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.css","hash":"b88b589f5f1aa1b3d87cc7eef34c281ff749b1ae","modified":1519721038461},{"_id":"themes/next/source/lib/fancybox/source/helpers/jquery.fancybox-thumbs.js","hash":"d22b1629cb23a6181bebb70d0cf653ffe4b835c8","modified":1519721038462},{"_id":"themes/next/source/lib/font-awesome/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1519721038476},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1519721038479},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1519721038484},{"_id":"themes/next/.git/objects/pack/pack-b8112ba9b2c5bcb1cb04d783dc033a5ffee52826.idx","hash":"40b3e03b5059218f1654f42fa247459300719d43","modified":1519721038027},{"_id":"themes/next/source/lib/algolia-instant-search/instantsearch.min.js","hash":"90a1b22129efc172e2dfcceeeb76bff58bc3192f","modified":1519721038450},{"_id":"themes/next/source/lib/three/three.min.js","hash":"26273b1cb4914850a89529b48091dc584f2c57b8","modified":1519721038510},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"b5483b11f8ba213e733b5b8af9927a04fec996f6","modified":1519721038482},{"_id":"themes/next/.git/objects/pack/pack-b8112ba9b2c5bcb1cb04d783dc033a5ffee52826.pack","hash":"e3ce8bde10cc496dd49a3dbb6e8adf7035e5faad","modified":1519721038090},{"_id":"themes/next/LICENSE.md","hash":"f0190c7d83a98464549a6b3a51bb206148d88e1b","modified":1519723321645},{"_id":"themes/next/crowdin.yml","hash":"d8807bbc82be89d16bcaf08b1855008b3fe92cab","modified":1519723321647},{"_id":"themes/next/.github/stale.yml","hash":"b9f7b394c0f3c00ac36168aa5f88c04cbb335911","modified":1519723321641},{"_id":"themes/next/docs/AGPL3.md","hash":"f463f95b169d64983f59fa6f3e4b6760290a0e6b","modified":1519723321648},{"_id":"themes/next/docs/ALGOLIA-SEARCH.md","hash":"7d5c4b7e478d67154aa456256e1e82a1bcee7098","modified":1519723321649},{"_id":"themes/next/docs/AUTHORS.md","hash":"51a0a13da55ff3d596970b2f9ab4531c6b2211f2","modified":1519723321650},{"_id":"themes/next/docs/DATA-FILES.md","hash":"9a1895c0a0db705c4c48f512e86917f9af1ec3fb","modified":1519723321651},{"_id":"themes/next/docs/INSTALLATION.md","hash":"b74ef6fedf76cdb156e2265759ee0a789ddd49cc","modified":1519723321651},{"_id":"themes/next/docs/MATH.md","hash":"bdbbcaf88f86de3d762fd1459fd5a0893cf4bce6","modified":1519723321653},{"_id":"themes/next/docs/LICENSE","hash":"5b702310012d480b40529fd10cf1872f687277a0","modified":1519723321652},{"_id":"themes/next/docs/UPDATE-FROM-5.1.X.md","hash":"c9f2ed8e15c137b1885d9ca8b7197d9f457971e9","modified":1519723321653},{"_id":"themes/next/languages/_en.yml","hash":"42b3b162b7d63408ac4845853450ca08a677a2bc","modified":1519723321662},{"_id":"themes/next/languages/ar.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321663},{"_id":"themes/next/languages/bg.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321664},{"_id":"themes/next/languages/bn.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321665},{"_id":"themes/next/languages/cs.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321665},{"_id":"themes/next/languages/da.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321666},{"_id":"themes/next/languages/el.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321667},{"_id":"themes/next/languages/es.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321668},{"_id":"themes/next/languages/et.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321668},{"_id":"themes/next/languages/fa.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321669},{"_id":"themes/next/languages/fi.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321669},{"_id":"themes/next/languages/fr.yml","hash":"3cadf73565f54e043b7406112a8155accbe3d3d5","modified":1519723321670},{"_id":"themes/next/languages/he.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321671},{"_id":"themes/next/languages/hi.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321671},{"_id":"themes/next/languages/hr.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321672},{"_id":"themes/next/languages/hu.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321672},{"_id":"themes/next/languages/jv.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321674},{"_id":"themes/next/languages/lt.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321675},{"_id":"themes/next/languages/lv.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321676},{"_id":"themes/next/languages/nl.yml","hash":"604d485fd341cb39fa11b68517699596b7ffa142","modified":1519723321677},{"_id":"themes/next/languages/ms.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321676},{"_id":"themes/next/languages/no.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321678},{"_id":"themes/next/languages/pl.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321679},{"_id":"themes/next/languages/pa.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321678},{"_id":"themes/next/languages/ro.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321680},{"_id":"themes/next/languages/sl.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321682},{"_id":"themes/next/languages/sr.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321682},{"_id":"themes/next/languages/sv.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321683},{"_id":"themes/next/languages/th.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321683},{"_id":"themes/next/languages/tr.yml","hash":"a4fb90940acad36537125b86256539debec4ab6b","modified":1519723321686},{"_id":"themes/next/languages/uk.yml","hash":"84164095a9eb0b7a64dd11c0ee978402c16aec26","modified":1519723321686},{"_id":"themes/next/languages/zh-CN.yml","hash":"c372336ea22cafa55a597e26b027f0dd4928d35f","modified":1519723321686},{"_id":"themes/next/languages/zh-HK.yml","hash":"ff392b2d69840c8896467545b9fc9b3a53c37707","modified":1519723321687},{"_id":"themes/next/languages/zh-TW.yml","hash":"64ee53b7326aca487fc707b4559c32fa1976cd9d","modified":1519723321689},{"_id":"themes/next/docs/ru/DATA-FILES.md","hash":"a51de08657f5946f4028b11373280ddc04639525","modified":1519723321654},{"_id":"themes/next/docs/ru/UPDATE-FROM-5.1.X.md","hash":"1a4e41adcf5831057f3f7b3025ed4a5ef7c442b4","modified":1519723321656},{"_id":"themes/next/docs/ru/README.md","hash":"c314fd4c147d881bd4158038fee4adf86841b848","modified":1519723321656},{"_id":"themes/next/docs/ru/INSTALLATION.md","hash":"7b2963daac19b0c14f98ebef375d5fbce8fc3f44","modified":1519723321655},{"_id":"themes/next/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"e07fb0307bd9b92dd2f32abfddac998ccf5f68d9","modified":1519723321657},{"_id":"themes/next/docs/zh-CN/DATA-FILES.md","hash":"67f4a987e7db0ab1ce1ea4c311f2961df07b6681","modified":1519723321658},{"_id":"themes/next/docs/zh-CN/INSTALLATION.md","hash":"baca12cc24be082f1db28c7f283493569666321c","modified":1519723321658},{"_id":"themes/next/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md","hash":"555384b3a51e61352ad8c0467a4b716306cd39c2","modified":1519723321659},{"_id":"themes/next/docs/zh-CN/MATH.md","hash":"08c630dc7bd479e49d7d5aa813df628e7726bd7f","modified":1519723321660},{"_id":"themes/next/docs/zh-CN/README.md","hash":"0b2b901dd14bd0df755d4bcb89b7bfc7afb30e66","modified":1519723321660},{"_id":"themes/next/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"1ec7a0e9ac64b2c84aa1fd7ba2c662be1dbcb407","modified":1519723321661},{"_id":"themes/next/layout/_custom/head.swig","hash":"a223919d2e1bf17ca4d6abb2c86f2efca9883dc1","modified":1519723321690},{"_id":"themes/next/layout/_macro/post-related.swig","hash":"e8dfb86eb62b9c2bc1435d6d1afa95d3b4c7b931","modified":1519723321694},{"_id":"themes/next/layout/_scripts/noscript.swig","hash":"f8c7e729ad6e72b4c705a2c5d5041589c2b4cc52","modified":1519723321708},{"_id":"themes/next/layout/_partials/breadcrumb.swig","hash":"4b48fdbfe3bf41ddeda4ff74c1ff17ab9f15c14e","modified":1519723321697},{"_id":"themes/next/layout/_third-party/bookmark.swig","hash":"ed62ea83d3f2c9db2ea57bf23a7d765ed82504c2","modified":1519723321721},{"_id":"themes/next/layout/_third-party/github-banner.swig","hash":"736cb278fa09d3b4ed6f305b56353941ea918793","modified":1519723321727},{"_id":"themes/next/layout/_third-party/pangu.swig","hash":"ccf0035086e14dcefa24c2907301edf4c37d5448","modified":1519723321732},{"_id":"themes/next/scripts/tags/include-raw.js","hash":"1f7bafba9cf3c94f5735873bd52e93ddcf37f8a2","modified":1519723321750},{"_id":"themes/next/layout/_partials/head/head-unique.swig","hash":"fc4af87d8d882b24f31e12ccebd2499402b0be72","modified":1519723321700},{"_id":"themes/next/layout/_partials/head/head.swig","hash":"e4c708ac8442fae6a0adccaf8a217824ca1bcca8","modified":1519723321700},{"_id":"themes/next/layout/_third-party/math/index.swig","hash":"30e9e55d9af2ced6e6b156a042026a8b480f0ab0","modified":1519723321729},{"_id":"themes/next/layout/_third-party/math/mathjax.swig","hash":"9a865d013b6d273bbbfc3999e8657844b0c48752","modified":1519723321730},{"_id":"themes/next/layout/_third-party/math/katex.swig","hash":"860de4ce6fccc516d2f779a4b600a4214d8c18e2","modified":1519723321729},{"_id":"themes/next/.git/objects/pack/pack-910ac413b391281b6667de7c2150e2c4d19feab1.idx","hash":"b65b7b93844d05dd5c79635eaebfc26c4ae04464","modified":1519723321432},{"_id":"themes/next/source/css/_common/components/header/github-banner.styl","hash":"66f22eb57dda1084c86c54391b6e0465e6534ea4","modified":1519723321761},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"630be616447a982413030e561bbd3a80ac14b120","modified":1519723321768},{"_id":"themes/next/source/css/_common/components/post/post-reading_progress.styl","hash":"82bc7fa5d38d98e98cc25f9a73189024fda25e63","modified":1519723321780},{"_id":"themes/next/source/css/_common/components/third-party/related-posts.styl","hash":"acfdd76b1c90d2e384affb3d0006a39b524609d2","modified":1519723321803},{"_id":"themes/next/.git/objects/pack/pack-910ac413b391281b6667de7c2150e2c4d19feab1.pack","hash":"b5e98bd294607d880bc50359ae62d21eca912c90","modified":1519723321479},{"_id":"source/images/avatar.png","hash":"62c2087587b79b3929a4570195e7137c9962a446","modified":1520315084948},{"_id":"themes/next/source/images/avatar.png","hash":"62c2087587b79b3929a4570195e7137c9962a446","modified":1520315084948},{"_id":"themes/next/source/js/src/mouse.js","hash":"7046f0e6d46a1096949cf66c1ae37a2fb3922a41","modified":1520319988439}],"Category":[{"name":"JavaEE","_id":"cje5fspdv0004n8vf8pryrogy"},{"name":"DCloud","_id":"cje5fspeg000bn8vfytsezwoa"},{"name":"JavaSE","_id":"cje5fspez000kn8vf5ookdot6"},{"name":"Spring","_id":"cje5fspf5000rn8vfc8qf7s6w"},{"name":"Mybatis","_id":"cje5fspf9000wn8vf28aor2oz"},{"name":"Mysql","_id":"cje5fspff0015n8vf3vjoket0"},{"name":"SNMP","_id":"cje5fspfs001hn8vfo1jjey2x"},{"name":"Struts2","_id":"cje5fspga0021n8vfxgxxvonl"},{"name":"杂七杂八","_id":"cje5fspgu002xn8vfcv62r88e"},{"name":"Web","_id":"cje5fspgw0034n8vf5cbysm43"}],"Data":[],"Page":[{"title":"分类","date":"2017-04-27T11:13:22.000Z","type":"categories","comments":0,"_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2017-04-27 19:13:22\ntype: \"categories\"\ncomments: false\n---\n","updated":"2018-02-27T07:38:38.108Z","path":"categories/index.html","layout":"page","_id":"cje5fspdk0001n8vfdydq2sat","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"简介","date":"2017-04-28T07:16:02.000Z","comments":0,"_content":"2016年毕业于武汉理工，现就职于武汉鼎点视讯\n\n喜欢旅游、冒险，追逐那为之悸动的一景、一情、一人\n\nQQ:785554043\nwechat：13638665425\n","source":"about/index.md","raw":"---\ntitle: 简介\ndate: 2017-04-28 15:16:02\ncomments: false\n---\n2016年毕业于武汉理工，现就职于武汉鼎点视讯\n\n喜欢旅游、冒险，追逐那为之悸动的一景、一情、一人\n\nQQ:785554043\nwechat：13638665425\n","updated":"2018-02-27T07:38:38.105Z","path":"about/index.html","layout":"page","_id":"cje5fspds0003n8vfbjmki5d0","content":"<p>2016年毕业于武汉理工，现就职于武汉鼎点视讯</p>\n<p>喜欢旅游、冒险，追逐那为之悸动的一景、一情、一人</p>\n<p>QQ:785554043<br>wechat：13638665425</p>\n","site":{"data":{}},"excerpt":"","more":"<p>2016年毕业于武汉理工，现就职于武汉鼎点视讯</p>\n<p>喜欢旅游、冒险，追逐那为之悸动的一景、一情、一人</p>\n<p>QQ:785554043<br>wechat：13638665425</p>\n"},{"_content":"{\"list\": [{\"arr\": {\"link\": [\"2017-03-01_\\u4e09\\u5206\\u5f52\\u664b.jpg\", \"2017-03-01_\\u5c81\\u6708\\u795e\\u5077.jpg\"], \"text\": [\"\\u4e09\\u5206\\u5f52\\u664b\", \"\\u5c81\\u6708\\u795e\\u5077\"], \"month\": 3, \"type\": [\"image\", \"image\"], \"year\": 2017}, \"date\": \"2017-03\"}, {\"arr\": {\"link\": [\"2017-01-01_2017\\u65b0\\u5e74 (2).jpg\", \"2017-01-01_2017\\u65b0\\u5e74 (3).jpg\", \"2017-01-01_2017\\u65b0\\u5e74 (4).jpg\", \"2017-01-01_2017\\u65b0\\u5e74.jpg\", \"2017-01-01_\\u9ec4\\u660f.jpg\"], \"text\": [\"2017\\u65b0\\u5e74 (2)\", \"2017\\u65b0\\u5e74 (3)\", \"2017\\u65b0\\u5e74 (4)\", \"2017\\u65b0\\u5e74\", \"\\u9ec4\\u660f\"], \"month\": 1, \"type\": [\"image\", \"image\", \"image\", \"image\", \"image\"], \"year\": 2017}, \"date\": \"2017-01\"}, {\"arr\": {\"link\": [\"2016-11-03_\\u5915\\u9633\\u65e0\\u9650\\u597d\\uff0c\\u53ea\\u662f\\u8fd1\\u9ec4\\u660f.jpg\"], \"text\": [\"\\u5915\\u9633\\u65e0\\u9650\\u597d\\uff0c\\u53ea\\u662f\\u8fd1\\u9ec4\\u660f\"], \"month\": 11, \"type\": [\"image\"], \"year\": 2016}, \"date\": \"2016-11\"}, {\"arr\": {\"link\": [\"2016-05-01_\\u4e16\\u535a\\u9986.PNG\", \"2016-05-01_\\u5356\\u4e66\\u5566\\uff01.jpg\", \"2016-05-01_\\u6211\\u7684\\u75d5\\u8ff9.jpg\", \"2016-05-01_\\u6f02\\u4eae--\\u4e2d\\u56fd\\u9986.JPG\", \"2016-05-01_\\u6f02\\u4eae.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u805a\\u9910-1.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u805a\\u9910-\\u5b54\\u660e\\u706f-1.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u805a\\u9910-\\u5b54\\u660e\\u706f-2.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u9732\\u8425-1.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u9732\\u8425-2.JPG\", \"2016-05-01_\\u73ed\\u7ea7\\u9732\\u8425-\\u70e7\\u70e4-1.jpg\", \"2016-05-01_\\u770b\\uff0c\\u86c7\\uff01.jpg\", \"2016-05-01_\\u968f\\u540e\\u62cd2.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u805a\\u9910\\u770b\\u7535\\u5f71\\u56de\\u6765-2-24\\u665a.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u901a\\u5bb5--\\u8fd8\\u5728\\u6539\\u8bba\\u6587.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u901a\\u5bb5-ktv.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u901a\\u5bb5-\\u7f51\\u5427.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u95f2\\u901b.jpg\"], \"text\": [\"\\u4e16\\u535a\\u9986\", \"\\u5356\\u4e66\\u5566\\uff01\", \"\\u6211\\u7684\\u75d5\\u8ff9\", \"\\u6f02\\u4eae--\\u4e2d\\u56fd\\u9986\", \"\\u6f02\\u4eae\", \"\\u73ed\\u7ea7\\u805a\\u9910-1\", \"\\u73ed\\u7ea7\\u805a\\u9910-\\u5b54\\u660e\\u706f-1\", \"\\u73ed\\u7ea7\\u805a\\u9910-\\u5b54\\u660e\\u706f-2\", \"\\u73ed\\u7ea7\\u9732\\u8425-1\", \"\\u73ed\\u7ea7\\u9732\\u8425-2\", \"\\u73ed\\u7ea7\\u9732\\u8425-\\u70e7\\u70e4-1\", \"\\u770b\\uff0c\\u86c7\\uff01\", \"\\u968f\\u540e\\u62cd2\", \"\\u6700\\u540e\\u7684\\u805a\\u9910\\u770b\\u7535\\u5f71\\u56de\\u6765-2-24\\u665a\", \"\\u6700\\u540e\\u7684\\u901a\\u5bb5--\\u8fd8\\u5728\\u6539\\u8bba\\u6587\", \"\\u6700\\u540e\\u7684\\u901a\\u5bb5-ktv\", \"\\u6700\\u540e\\u7684\\u901a\\u5bb5-\\u7f51\\u5427\", \"\\u6700\\u540e\\u7684\\u95f2\\u901b\"], \"month\": 5, \"type\": [\"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\"], \"year\": 2016}, \"date\": \"2016-05\"}, {\"arr\": {\"link\": [\"2016-04-01_\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-1.jpg\", \"2016-04-01_\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-2.jpg\", \"2016-04-01_\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-3.jpg\", \"2016-04-03_\\u6700\\u540e\\u4e00\\u6b21\\u5347\\u65d7\\u4eea\\u5f0f.jpg\"], \"text\": [\"\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-1\", \"\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-2\", \"\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-3\", \"\\u6700\\u540e\\u4e00\\u6b21\\u5347\\u65d7\\u4eea\\u5f0f\"], \"month\": 4, \"type\": [\"image\", \"image\", \"image\", \"image\"], \"year\": 2016}, \"date\": \"2016-04\"}, {\"arr\": {\"link\": [\"2015-12-01_beautiful\\uff01\\uff01.JPG\"], \"text\": [\"beautiful\\uff01\\uff01\"], \"month\": 12, \"type\": [\"image\"], \"year\": 2015}, \"date\": \"2015-12\"}, {\"arr\": {\"link\": [\"2015-10-01_five floor.jpg\", \"2015-10-01_\\u4e2d\\u79cb--.jpg\", \"2015-10-01_\\u54c8\\u54c8.jpg\", \"2015-10-01_\\u54c8\\u54c82.jpg\", \"2015-10-01_\\u9633\\u5149\\u6b63\\u597d.jpg\", \"2015-10-01_\\u9752\\u6625\\u653e\\u6b4c.jpg\"], \"text\": [\"five floor\", \"\\u4e2d\\u79cb--\", \"\\u54c8\\u54c8\", \"\\u54c8\\u54c82\", \"\\u9633\\u5149\\u6b63\\u597d\", \"\\u9752\\u6625\\u653e\\u6b4c\"], \"month\": 10, \"type\": [\"image\", \"image\", \"image\", \"image\", \"image\", \"image\"], \"year\": 2015}, \"date\": \"2015-10\"}, {\"arr\": {\"link\": [\"2015-05-01_\\u4f53\\u80b2\\u9986\\u4e0a.JPG\", \"2015-05-01_\\u5145\\u5b9e\\u7684\\u4e00\\u5929--\\u4e03\\u591501.jpg\", \"2015-05-01_\\u518d\\u6765\\u4e00\\u6b21\\u56fe\\u4e66\\u9986-1.jpg\", \"2015-05-01_\\u518d\\u6765\\u4e00\\u6b21\\u56fe\\u4e66\\u9986-2.jpg\", \"2015-05-01_\\u53cd\\u6b63\\u4e0d\\u662f\\u6211\\u8d34\\u7684.jpg\", \"2015-05-01_\\u591a\\u56fe.JPG\", \"2015-05-01_\\u5929\\u6c14\\u4e0d\\u9519--\\u6691\\u5047\\u7559\\u6821\\u671f\\u95f4.JPG\", \"2015-05-01_\\u5b66\\u4f4d\\u6388\\u4e88-1.jpg\", \"2015-05-01_\\u5bbf\\u820d\\u805a\\u9910-1.jpg\", \"2015-05-01_\\u62bd\\u5956\\u4e2d\\u7684\\u2014\\u2014\\u4f4e\\u8c03.jpg\", \"2015-05-01_\\u6f02\\u917f.jpg\", \"2015-05-01_\\u7ae5\\u5e74.jpg\", \"2015-05-01_\\u968f\\u610f\\u62cd.jpg\", \"2015-05-01_\\u968f\\u624b\\u62cd3.jpg\"], \"text\": [\"\\u4f53\\u80b2\\u9986\\u4e0a\", \"\\u5145\\u5b9e\\u7684\\u4e00\\u5929--\\u4e03\\u591501\", \"\\u518d\\u6765\\u4e00\\u6b21\\u56fe\\u4e66\\u9986-1\", \"\\u518d\\u6765\\u4e00\\u6b21\\u56fe\\u4e66\\u9986-2\", \"\\u53cd\\u6b63\\u4e0d\\u662f\\u6211\\u8d34\\u7684\", \"\\u591a\\u56fe\", \"\\u5929\\u6c14\\u4e0d\\u9519--\\u6691\\u5047\\u7559\\u6821\\u671f\\u95f4\", \"\\u5b66\\u4f4d\\u6388\\u4e88-1\", \"\\u5bbf\\u820d\\u805a\\u9910-1\", \"\\u62bd\\u5956\\u4e2d\\u7684\\u2014\\u2014\\u4f4e\\u8c03\", \"\\u6f02\\u917f\", \"\\u7ae5\\u5e74\", \"\\u968f\\u610f\\u62cd\", \"\\u968f\\u624b\\u62cd3\"], \"month\": 5, \"type\": [\"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\"], \"year\": 2015}, \"date\": \"2015-05\"}]}","source":"photos/data.json","raw":"{\"list\": [{\"arr\": {\"link\": [\"2017-03-01_\\u4e09\\u5206\\u5f52\\u664b.jpg\", \"2017-03-01_\\u5c81\\u6708\\u795e\\u5077.jpg\"], \"text\": [\"\\u4e09\\u5206\\u5f52\\u664b\", \"\\u5c81\\u6708\\u795e\\u5077\"], \"month\": 3, \"type\": [\"image\", \"image\"], \"year\": 2017}, \"date\": \"2017-03\"}, {\"arr\": {\"link\": [\"2017-01-01_2017\\u65b0\\u5e74 (2).jpg\", \"2017-01-01_2017\\u65b0\\u5e74 (3).jpg\", \"2017-01-01_2017\\u65b0\\u5e74 (4).jpg\", \"2017-01-01_2017\\u65b0\\u5e74.jpg\", \"2017-01-01_\\u9ec4\\u660f.jpg\"], \"text\": [\"2017\\u65b0\\u5e74 (2)\", \"2017\\u65b0\\u5e74 (3)\", \"2017\\u65b0\\u5e74 (4)\", \"2017\\u65b0\\u5e74\", \"\\u9ec4\\u660f\"], \"month\": 1, \"type\": [\"image\", \"image\", \"image\", \"image\", \"image\"], \"year\": 2017}, \"date\": \"2017-01\"}, {\"arr\": {\"link\": [\"2016-11-03_\\u5915\\u9633\\u65e0\\u9650\\u597d\\uff0c\\u53ea\\u662f\\u8fd1\\u9ec4\\u660f.jpg\"], \"text\": [\"\\u5915\\u9633\\u65e0\\u9650\\u597d\\uff0c\\u53ea\\u662f\\u8fd1\\u9ec4\\u660f\"], \"month\": 11, \"type\": [\"image\"], \"year\": 2016}, \"date\": \"2016-11\"}, {\"arr\": {\"link\": [\"2016-05-01_\\u4e16\\u535a\\u9986.PNG\", \"2016-05-01_\\u5356\\u4e66\\u5566\\uff01.jpg\", \"2016-05-01_\\u6211\\u7684\\u75d5\\u8ff9.jpg\", \"2016-05-01_\\u6f02\\u4eae--\\u4e2d\\u56fd\\u9986.JPG\", \"2016-05-01_\\u6f02\\u4eae.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u805a\\u9910-1.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u805a\\u9910-\\u5b54\\u660e\\u706f-1.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u805a\\u9910-\\u5b54\\u660e\\u706f-2.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u9732\\u8425-1.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u9732\\u8425-2.JPG\", \"2016-05-01_\\u73ed\\u7ea7\\u9732\\u8425-\\u70e7\\u70e4-1.jpg\", \"2016-05-01_\\u770b\\uff0c\\u86c7\\uff01.jpg\", \"2016-05-01_\\u968f\\u540e\\u62cd2.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u805a\\u9910\\u770b\\u7535\\u5f71\\u56de\\u6765-2-24\\u665a.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u901a\\u5bb5--\\u8fd8\\u5728\\u6539\\u8bba\\u6587.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u901a\\u5bb5-ktv.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u901a\\u5bb5-\\u7f51\\u5427.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u95f2\\u901b.jpg\"], \"text\": [\"\\u4e16\\u535a\\u9986\", \"\\u5356\\u4e66\\u5566\\uff01\", \"\\u6211\\u7684\\u75d5\\u8ff9\", \"\\u6f02\\u4eae--\\u4e2d\\u56fd\\u9986\", \"\\u6f02\\u4eae\", \"\\u73ed\\u7ea7\\u805a\\u9910-1\", \"\\u73ed\\u7ea7\\u805a\\u9910-\\u5b54\\u660e\\u706f-1\", \"\\u73ed\\u7ea7\\u805a\\u9910-\\u5b54\\u660e\\u706f-2\", \"\\u73ed\\u7ea7\\u9732\\u8425-1\", \"\\u73ed\\u7ea7\\u9732\\u8425-2\", \"\\u73ed\\u7ea7\\u9732\\u8425-\\u70e7\\u70e4-1\", \"\\u770b\\uff0c\\u86c7\\uff01\", \"\\u968f\\u540e\\u62cd2\", \"\\u6700\\u540e\\u7684\\u805a\\u9910\\u770b\\u7535\\u5f71\\u56de\\u6765-2-24\\u665a\", \"\\u6700\\u540e\\u7684\\u901a\\u5bb5--\\u8fd8\\u5728\\u6539\\u8bba\\u6587\", \"\\u6700\\u540e\\u7684\\u901a\\u5bb5-ktv\", \"\\u6700\\u540e\\u7684\\u901a\\u5bb5-\\u7f51\\u5427\", \"\\u6700\\u540e\\u7684\\u95f2\\u901b\"], \"month\": 5, \"type\": [\"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\"], \"year\": 2016}, \"date\": \"2016-05\"}, {\"arr\": {\"link\": [\"2016-04-01_\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-1.jpg\", \"2016-04-01_\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-2.jpg\", \"2016-04-01_\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-3.jpg\", \"2016-04-03_\\u6700\\u540e\\u4e00\\u6b21\\u5347\\u65d7\\u4eea\\u5f0f.jpg\"], \"text\": [\"\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-1\", \"\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-2\", \"\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-3\", \"\\u6700\\u540e\\u4e00\\u6b21\\u5347\\u65d7\\u4eea\\u5f0f\"], \"month\": 4, \"type\": [\"image\", \"image\", \"image\", \"image\"], \"year\": 2016}, \"date\": \"2016-04\"}, {\"arr\": {\"link\": [\"2015-12-01_beautiful\\uff01\\uff01.JPG\"], \"text\": [\"beautiful\\uff01\\uff01\"], \"month\": 12, \"type\": [\"image\"], \"year\": 2015}, \"date\": \"2015-12\"}, {\"arr\": {\"link\": [\"2015-10-01_five floor.jpg\", \"2015-10-01_\\u4e2d\\u79cb--.jpg\", \"2015-10-01_\\u54c8\\u54c8.jpg\", \"2015-10-01_\\u54c8\\u54c82.jpg\", \"2015-10-01_\\u9633\\u5149\\u6b63\\u597d.jpg\", \"2015-10-01_\\u9752\\u6625\\u653e\\u6b4c.jpg\"], \"text\": [\"five floor\", \"\\u4e2d\\u79cb--\", \"\\u54c8\\u54c8\", \"\\u54c8\\u54c82\", \"\\u9633\\u5149\\u6b63\\u597d\", \"\\u9752\\u6625\\u653e\\u6b4c\"], \"month\": 10, \"type\": [\"image\", \"image\", \"image\", \"image\", \"image\", \"image\"], \"year\": 2015}, \"date\": \"2015-10\"}, {\"arr\": {\"link\": [\"2015-05-01_\\u4f53\\u80b2\\u9986\\u4e0a.JPG\", \"2015-05-01_\\u5145\\u5b9e\\u7684\\u4e00\\u5929--\\u4e03\\u591501.jpg\", \"2015-05-01_\\u518d\\u6765\\u4e00\\u6b21\\u56fe\\u4e66\\u9986-1.jpg\", \"2015-05-01_\\u518d\\u6765\\u4e00\\u6b21\\u56fe\\u4e66\\u9986-2.jpg\", \"2015-05-01_\\u53cd\\u6b63\\u4e0d\\u662f\\u6211\\u8d34\\u7684.jpg\", \"2015-05-01_\\u591a\\u56fe.JPG\", \"2015-05-01_\\u5929\\u6c14\\u4e0d\\u9519--\\u6691\\u5047\\u7559\\u6821\\u671f\\u95f4.JPG\", \"2015-05-01_\\u5b66\\u4f4d\\u6388\\u4e88-1.jpg\", \"2015-05-01_\\u5bbf\\u820d\\u805a\\u9910-1.jpg\", \"2015-05-01_\\u62bd\\u5956\\u4e2d\\u7684\\u2014\\u2014\\u4f4e\\u8c03.jpg\", \"2015-05-01_\\u6f02\\u917f.jpg\", \"2015-05-01_\\u7ae5\\u5e74.jpg\", \"2015-05-01_\\u968f\\u610f\\u62cd.jpg\", \"2015-05-01_\\u968f\\u624b\\u62cd3.jpg\"], \"text\": [\"\\u4f53\\u80b2\\u9986\\u4e0a\", \"\\u5145\\u5b9e\\u7684\\u4e00\\u5929--\\u4e03\\u591501\", \"\\u518d\\u6765\\u4e00\\u6b21\\u56fe\\u4e66\\u9986-1\", \"\\u518d\\u6765\\u4e00\\u6b21\\u56fe\\u4e66\\u9986-2\", \"\\u53cd\\u6b63\\u4e0d\\u662f\\u6211\\u8d34\\u7684\", \"\\u591a\\u56fe\", \"\\u5929\\u6c14\\u4e0d\\u9519--\\u6691\\u5047\\u7559\\u6821\\u671f\\u95f4\", \"\\u5b66\\u4f4d\\u6388\\u4e88-1\", \"\\u5bbf\\u820d\\u805a\\u9910-1\", \"\\u62bd\\u5956\\u4e2d\\u7684\\u2014\\u2014\\u4f4e\\u8c03\", \"\\u6f02\\u917f\", \"\\u7ae5\\u5e74\", \"\\u968f\\u610f\\u62cd\", \"\\u968f\\u624b\\u62cd3\"], \"month\": 5, \"type\": [\"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\"], \"year\": 2015}, \"date\": \"2015-05\"}]}","date":"2018-02-27T07:38:38.116Z","updated":"2018-02-27T07:38:38.116Z","path":"photos/data.json","layout":"false","title":"","comments":1,"_id":"cje5fspe70007n8vf7pfzhony","content":"{\"list\":[{\"arr\":{\"link\":[\"2017-03-01_三分归晋.jpg\",\"2017-03-01_岁月神偷.jpg\"],\"text\":[\"三分归晋\",\"岁月神偷\"],\"month\":3,\"type\":[\"image\",\"image\"],\"year\":2017},\"date\":\"2017-03\"},{\"arr\":{\"link\":[\"2017-01-01_2017新年 (2).jpg\",\"2017-01-01_2017新年 (3).jpg\",\"2017-01-01_2017新年 (4).jpg\",\"2017-01-01_2017新年.jpg\",\"2017-01-01_黄昏.jpg\"],\"text\":[\"2017新年 (2)\",\"2017新年 (3)\",\"2017新年 (4)\",\"2017新年\",\"黄昏\"],\"month\":1,\"type\":[\"image\",\"image\",\"image\",\"image\",\"image\"],\"year\":2017},\"date\":\"2017-01\"},{\"arr\":{\"link\":[\"2016-11-03_夕阳无限好，只是近黄昏.jpg\"],\"text\":[\"夕阳无限好，只是近黄昏\"],\"month\":11,\"type\":[\"image\"],\"year\":2016},\"date\":\"2016-11\"},{\"arr\":{\"link\":[\"2016-05-01_世博馆.PNG\",\"2016-05-01_卖书啦！.jpg\",\"2016-05-01_我的痕迹.jpg\",\"2016-05-01_漂亮--中国馆.JPG\",\"2016-05-01_漂亮.jpg\",\"2016-05-01_班级聚餐-1.jpg\",\"2016-05-01_班级聚餐-孔明灯-1.jpg\",\"2016-05-01_班级聚餐-孔明灯-2.jpg\",\"2016-05-01_班级露营-1.jpg\",\"2016-05-01_班级露营-2.JPG\",\"2016-05-01_班级露营-烧烤-1.jpg\",\"2016-05-01_看，蛇！.jpg\",\"2016-05-01_随后拍2.jpg\",\"2016-05-10_最后的聚餐看电影回来-2-24晚.jpg\",\"2016-05-10_最后的通宵--还在改论文.jpg\",\"2016-05-10_最后的通宵-ktv.jpg\",\"2016-05-10_最后的通宵-网吧.jpg\",\"2016-05-10_最后的闲逛.jpg\"],\"text\":[\"世博馆\",\"卖书啦！\",\"我的痕迹\",\"漂亮--中国馆\",\"漂亮\",\"班级聚餐-1\",\"班级聚餐-孔明灯-1\",\"班级聚餐-孔明灯-2\",\"班级露营-1\",\"班级露营-2\",\"班级露营-烧烤-1\",\"看，蛇！\",\"随后拍2\",\"最后的聚餐看电影回来-2-24晚\",\"最后的通宵--还在改论文\",\"最后的通宵-ktv\",\"最后的通宵-网吧\",\"最后的闲逛\"],\"month\":5,\"type\":[\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\"],\"year\":2016},\"date\":\"2016-05\"},{\"arr\":{\"link\":[\"2016-04-01_毕业生晚会-1.jpg\",\"2016-04-01_毕业生晚会-2.jpg\",\"2016-04-01_毕业生晚会-3.jpg\",\"2016-04-03_最后一次升旗仪式.jpg\"],\"text\":[\"毕业生晚会-1\",\"毕业生晚会-2\",\"毕业生晚会-3\",\"最后一次升旗仪式\"],\"month\":4,\"type\":[\"image\",\"image\",\"image\",\"image\"],\"year\":2016},\"date\":\"2016-04\"},{\"arr\":{\"link\":[\"2015-12-01_beautiful！！.JPG\"],\"text\":[\"beautiful！！\"],\"month\":12,\"type\":[\"image\"],\"year\":2015},\"date\":\"2015-12\"},{\"arr\":{\"link\":[\"2015-10-01_five floor.jpg\",\"2015-10-01_中秋--.jpg\",\"2015-10-01_哈哈.jpg\",\"2015-10-01_哈哈2.jpg\",\"2015-10-01_阳光正好.jpg\",\"2015-10-01_青春放歌.jpg\"],\"text\":[\"five floor\",\"中秋--\",\"哈哈\",\"哈哈2\",\"阳光正好\",\"青春放歌\"],\"month\":10,\"type\":[\"image\",\"image\",\"image\",\"image\",\"image\",\"image\"],\"year\":2015},\"date\":\"2015-10\"},{\"arr\":{\"link\":[\"2015-05-01_体育馆上.JPG\",\"2015-05-01_充实的一天--七夕01.jpg\",\"2015-05-01_再来一次图书馆-1.jpg\",\"2015-05-01_再来一次图书馆-2.jpg\",\"2015-05-01_反正不是我贴的.jpg\",\"2015-05-01_多图.JPG\",\"2015-05-01_天气不错--暑假留校期间.JPG\",\"2015-05-01_学位授予-1.jpg\",\"2015-05-01_宿舍聚餐-1.jpg\",\"2015-05-01_抽奖中的——低调.jpg\",\"2015-05-01_漂酿.jpg\",\"2015-05-01_童年.jpg\",\"2015-05-01_随意拍.jpg\",\"2015-05-01_随手拍3.jpg\"],\"text\":[\"体育馆上\",\"充实的一天--七夕01\",\"再来一次图书馆-1\",\"再来一次图书馆-2\",\"反正不是我贴的\",\"多图\",\"天气不错--暑假留校期间\",\"学位授予-1\",\"宿舍聚餐-1\",\"抽奖中的——低调\",\"漂酿\",\"童年\",\"随意拍\",\"随手拍3\"],\"month\":5,\"type\":[\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\"],\"year\":2015},\"date\":\"2015-05\"}]}","site":{"data":{}},"excerpt":"","more":"{\"list\":[{\"arr\":{\"link\":[\"2017-03-01_三分归晋.jpg\",\"2017-03-01_岁月神偷.jpg\"],\"text\":[\"三分归晋\",\"岁月神偷\"],\"month\":3,\"type\":[\"image\",\"image\"],\"year\":2017},\"date\":\"2017-03\"},{\"arr\":{\"link\":[\"2017-01-01_2017新年 (2).jpg\",\"2017-01-01_2017新年 (3).jpg\",\"2017-01-01_2017新年 (4).jpg\",\"2017-01-01_2017新年.jpg\",\"2017-01-01_黄昏.jpg\"],\"text\":[\"2017新年 (2)\",\"2017新年 (3)\",\"2017新年 (4)\",\"2017新年\",\"黄昏\"],\"month\":1,\"type\":[\"image\",\"image\",\"image\",\"image\",\"image\"],\"year\":2017},\"date\":\"2017-01\"},{\"arr\":{\"link\":[\"2016-11-03_夕阳无限好，只是近黄昏.jpg\"],\"text\":[\"夕阳无限好，只是近黄昏\"],\"month\":11,\"type\":[\"image\"],\"year\":2016},\"date\":\"2016-11\"},{\"arr\":{\"link\":[\"2016-05-01_世博馆.PNG\",\"2016-05-01_卖书啦！.jpg\",\"2016-05-01_我的痕迹.jpg\",\"2016-05-01_漂亮--中国馆.JPG\",\"2016-05-01_漂亮.jpg\",\"2016-05-01_班级聚餐-1.jpg\",\"2016-05-01_班级聚餐-孔明灯-1.jpg\",\"2016-05-01_班级聚餐-孔明灯-2.jpg\",\"2016-05-01_班级露营-1.jpg\",\"2016-05-01_班级露营-2.JPG\",\"2016-05-01_班级露营-烧烤-1.jpg\",\"2016-05-01_看，蛇！.jpg\",\"2016-05-01_随后拍2.jpg\",\"2016-05-10_最后的聚餐看电影回来-2-24晚.jpg\",\"2016-05-10_最后的通宵--还在改论文.jpg\",\"2016-05-10_最后的通宵-ktv.jpg\",\"2016-05-10_最后的通宵-网吧.jpg\",\"2016-05-10_最后的闲逛.jpg\"],\"text\":[\"世博馆\",\"卖书啦！\",\"我的痕迹\",\"漂亮--中国馆\",\"漂亮\",\"班级聚餐-1\",\"班级聚餐-孔明灯-1\",\"班级聚餐-孔明灯-2\",\"班级露营-1\",\"班级露营-2\",\"班级露营-烧烤-1\",\"看，蛇！\",\"随后拍2\",\"最后的聚餐看电影回来-2-24晚\",\"最后的通宵--还在改论文\",\"最后的通宵-ktv\",\"最后的通宵-网吧\",\"最后的闲逛\"],\"month\":5,\"type\":[\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\"],\"year\":2016},\"date\":\"2016-05\"},{\"arr\":{\"link\":[\"2016-04-01_毕业生晚会-1.jpg\",\"2016-04-01_毕业生晚会-2.jpg\",\"2016-04-01_毕业生晚会-3.jpg\",\"2016-04-03_最后一次升旗仪式.jpg\"],\"text\":[\"毕业生晚会-1\",\"毕业生晚会-2\",\"毕业生晚会-3\",\"最后一次升旗仪式\"],\"month\":4,\"type\":[\"image\",\"image\",\"image\",\"image\"],\"year\":2016},\"date\":\"2016-04\"},{\"arr\":{\"link\":[\"2015-12-01_beautiful！！.JPG\"],\"text\":[\"beautiful！！\"],\"month\":12,\"type\":[\"image\"],\"year\":2015},\"date\":\"2015-12\"},{\"arr\":{\"link\":[\"2015-10-01_five floor.jpg\",\"2015-10-01_中秋--.jpg\",\"2015-10-01_哈哈.jpg\",\"2015-10-01_哈哈2.jpg\",\"2015-10-01_阳光正好.jpg\",\"2015-10-01_青春放歌.jpg\"],\"text\":[\"five floor\",\"中秋--\",\"哈哈\",\"哈哈2\",\"阳光正好\",\"青春放歌\"],\"month\":10,\"type\":[\"image\",\"image\",\"image\",\"image\",\"image\",\"image\"],\"year\":2015},\"date\":\"2015-10\"},{\"arr\":{\"link\":[\"2015-05-01_体育馆上.JPG\",\"2015-05-01_充实的一天--七夕01.jpg\",\"2015-05-01_再来一次图书馆-1.jpg\",\"2015-05-01_再来一次图书馆-2.jpg\",\"2015-05-01_反正不是我贴的.jpg\",\"2015-05-01_多图.JPG\",\"2015-05-01_天气不错--暑假留校期间.JPG\",\"2015-05-01_学位授予-1.jpg\",\"2015-05-01_宿舍聚餐-1.jpg\",\"2015-05-01_抽奖中的——低调.jpg\",\"2015-05-01_漂酿.jpg\",\"2015-05-01_童年.jpg\",\"2015-05-01_随意拍.jpg\",\"2015-05-01_随手拍3.jpg\"],\"text\":[\"体育馆上\",\"充实的一天--七夕01\",\"再来一次图书馆-1\",\"再来一次图书馆-2\",\"反正不是我贴的\",\"多图\",\"天气不错--暑假留校期间\",\"学位授予-1\",\"宿舍聚餐-1\",\"抽奖中的——低调\",\"漂酿\",\"童年\",\"随意拍\",\"随手拍3\"],\"month\":5,\"type\":[\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\"],\"year\":2015},\"date\":\"2015-05\"}]}"},{"layout":"post","slug":"photos","title":"����","noDate":"true","comments":0,"_content":"<link rel=\"stylesheet\" href=\"./ins.css\">\n<div class=\"photos-btn-wrap\">\n\t<a class=\"photos-btn active\" href=\"javascript:void(0)\">Photos</a>\n\t<a class=\"photos-btn\" href=\"#\">����</a>\n</div>\n<div class=\"instagram itemscope\">\n\t<a href=\"https://www.instagram.com/lawlitewang20/\" target=\"_blank\" class=\"open-ins\">ͼƬ���ڼ����С�</a>\n</div>\n<script>\n  (function() {\n    var loadScript = function(path) {\n      var $script = document.createElement('script')\n      document.getElementsByTagName('body')[0].appendChild($script)\n      $script.setAttribute('src', path)\n    }\n    setTimeout(function() {\n      loadScript('./ins.js')\n    }, 0)\n  })()\n</script>","source":"photos/index.ejs","raw":"---\nlayout: post\nslug: \"photos\"\ntitle: \"����\"\nnoDate: \"true\"\ncomments: \"false\"\n---\n<link rel=\"stylesheet\" href=\"./ins.css\">\n<div class=\"photos-btn-wrap\">\n\t<a class=\"photos-btn active\" href=\"javascript:void(0)\">Photos</a>\n\t<a class=\"photos-btn\" href=\"#\">����</a>\n</div>\n<div class=\"instagram itemscope\">\n\t<a href=\"https://www.instagram.com/lawlitewang20/\" target=\"_blank\" class=\"open-ins\">ͼƬ���ڼ����С�</a>\n</div>\n<script>\n  (function() {\n    var loadScript = function(path) {\n      var $script = document.createElement('script')\n      document.getElementsByTagName('body')[0].appendChild($script)\n      $script.setAttribute('src', path)\n    }\n    setTimeout(function() {\n      loadScript('./ins.js')\n    }, 0)\n  })()\n</script>","date":"2018-02-27T07:38:38.117Z","updated":"2018-02-27T07:38:38.117Z","path":"photos/index.html","_id":"cje5fspec0009n8vf9cr592rz","content":"<link rel=\"stylesheet\" href=\"./ins.css\">\n<div class=\"photos-btn-wrap\">\n\t<a class=\"photos-btn active\" href=\"javascript:void(0)\" target=\"_blank\" rel=\"noopener\">Photos</a>\n\t<a class=\"photos-btn\" href=\"#\">����</a>\n</div>\n<div class=\"instagram itemscope\">\n\t<a href=\"https://www.instagram.com/lawlitewang20/\" target=\"_blank\" class=\"open-ins\">ͼƬ���ڼ����С�</a>\n</div>\n<script>\n  (function() {\n    var loadScript = function(path) {\n      var $script = document.createElement('script')\n      document.getElementsByTagName('body')[0].appendChild($script)\n      $script.setAttribute('src', path)\n    }\n    setTimeout(function() {\n      loadScript('./ins.js')\n    }, 0)\n  })()\n</script>","site":{"data":{}},"excerpt":"","more":"<link rel=\"stylesheet\" href=\"./ins.css\">\n<div class=\"photos-btn-wrap\">\n\t<a class=\"photos-btn active\" href=\"javascript:void(0)\" target=\"_blank\" rel=\"noopener\">Photos</a>\n\t<a class=\"photos-btn\" href=\"#\">����</a>\n</div>\n<div class=\"instagram itemscope\">\n\t<a href=\"https://www.instagram.com/lawlitewang20/\" target=\"_blank\" class=\"open-ins\">ͼƬ���ڼ����С�</a>\n</div>\n<script>\n  (function() {\n    var loadScript = function(path) {\n      var $script = document.createElement('script')\n      document.getElementsByTagName('body')[0].appendChild($script)\n      $script.setAttribute('src', path)\n    }\n    setTimeout(function() {\n      loadScript('./ins.js')\n    }, 0)\n  })()\n</script>"},{"title":"photos","date":"2017-05-19T11:22:20.000Z","type":"photos","_content":"","source":"photos/index.md","raw":"---\ntitle: photos\ndate: 2017-05-19 19:22:20\ntype: photos\n---\n","updated":"2018-02-27T07:38:38.118Z","path":"photos/index.html","comments":1,"layout":"page","_id":"cje5fspeh000dn8vf6u1sfrrh","content":"","site":{"data":{}},"excerpt":"","more":""},{"_content":"#post-instagram{\n\tpadding: 30px;\n}\n#post-instagram .article-entry{\n\tpadding-right: 0;\n}\n.instagram{\n\tposition: relative;\n\tmin-height: 500px;\n}\n.instagram img {\n\twidth: 100%;\n}\n.instagram .year {\n\tfont-size: 16px;\n}\n.instagram .open-ins{\n\tpadding: 10px 0;\n\tcolor: #cdcdcd;\n}\n.instagram .open-ins:hover{\n\tcolor: #657b83;\n}\n.instagram .year{\n\tdisplay: inline;\n}\n.instagram .thumb {\n\twidth: 25%;\n\theight: 0; \n\tpadding-bottom: 25%;\n\tposition: relative;\n\tdisplay: inline-block;\n\ttext-align: center;\n\tbackground: #ededed;\n\toutline: 1px solid #ddd;\n}\n.instagram .thumb a {\n\tposition: relative;\n}\n.instagram .album h1 em{\n\tfont-style: normal;\n\tfont-size: 14px;\n\tmargin-left: 10px;\n}\n.instagram .album ul{\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tclear: both;\n\twidth: 100%;\n\ttext-align: left;\n}\n.instagram .album li{\n\tlist-style: none;\n\tdisplay: inline-block;\n\tbox-sizing: border-box;\n\tpadding: 0 5px;\n\tmargin-bottom: -10px;\n\theight: 0;\n\twidth: 25%;\n\tposition: relative;\n\tpadding-bottom: 25%;\n}\n.instagram .album li:before{\n\tdisplay: none;\n}\n.instagram .album div.img-box{\n\tposition: absolute;\n\twidth: 90%;\n\theight: 90%;\n\t-webkit-box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n\t-moz-box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n\tbox-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n}\n.instagram .album div.img-box img{\n\twidth: 100%;\n\theight: 100%;\n    position: absolute;\n    z-index: 2;\n}\n.instagram .album div.img-box .img-bg{\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tbottom: 0px;\n\twidth: 100%;\n\tmargin: -5px;\n\tpadding: 5px;\n\t-webkit-box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\t-moz-box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\tbox-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\t-webkit-transition: all 0.15s ease-out 0.1s;\n\t-moz-transition: all 0.15s ease-out 0.1s;\n\t-o-transition: all 0.15s ease-out 0.1s;\n\ttransition: all 0.15s ease-out 0.1s;\n\topacity: 0.2;\n\tcursor: pointer;\n\tdisplay: block;\n\tz-index: 3;\n}\n.instagram .album div.img-box .icon {\n    font-size: 14px;\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    margin-left: -7px;\n    margin-top: -7px;\n    color: #999;\n    z-index: 1;\n}\n.instagram .album div.img-box .img-bg:hover{\n\topacity: 0;\n}\n.photos-btn-wrap {\n\tborder-bottom: 1px solid #e5e5e5;\n\tmargin-bottom: 20px;\n}\n.photos-btn {\n\tfont-size: 16px;\n\tcolor: #333;\n\tmargin-bottom: -4px;\n\tpadding: 5px 8px 3px;\n}\n.photos-btn.active {\n\tcolor: #08c;\n\tborder: 1px solid #e5e5e5;\n\tborder-bottom: 5px solid #fff;\n}\n\n@media screen and (max-width:600px) {\n\t.instagram .thumb {\n\t\twidth: 50%;\n\t\tpadding-bottom: 50%;\n\t}\n\t.instagram .album li {\n\t\twidth: 100%;\n\t\tposition: relative;\n\t\tpadding-bottom: 100%;\n\t\ttext-align: center;\n\t}\n\t.instagram .album div.img-box{\n\t\tmargin: 0;\n\t\twidth: 90%;\n\t\theight: 90%;\n\t}\n}","source":"photos/ins.css","raw":"#post-instagram{\n\tpadding: 30px;\n}\n#post-instagram .article-entry{\n\tpadding-right: 0;\n}\n.instagram{\n\tposition: relative;\n\tmin-height: 500px;\n}\n.instagram img {\n\twidth: 100%;\n}\n.instagram .year {\n\tfont-size: 16px;\n}\n.instagram .open-ins{\n\tpadding: 10px 0;\n\tcolor: #cdcdcd;\n}\n.instagram .open-ins:hover{\n\tcolor: #657b83;\n}\n.instagram .year{\n\tdisplay: inline;\n}\n.instagram .thumb {\n\twidth: 25%;\n\theight: 0; \n\tpadding-bottom: 25%;\n\tposition: relative;\n\tdisplay: inline-block;\n\ttext-align: center;\n\tbackground: #ededed;\n\toutline: 1px solid #ddd;\n}\n.instagram .thumb a {\n\tposition: relative;\n}\n.instagram .album h1 em{\n\tfont-style: normal;\n\tfont-size: 14px;\n\tmargin-left: 10px;\n}\n.instagram .album ul{\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tclear: both;\n\twidth: 100%;\n\ttext-align: left;\n}\n.instagram .album li{\n\tlist-style: none;\n\tdisplay: inline-block;\n\tbox-sizing: border-box;\n\tpadding: 0 5px;\n\tmargin-bottom: -10px;\n\theight: 0;\n\twidth: 25%;\n\tposition: relative;\n\tpadding-bottom: 25%;\n}\n.instagram .album li:before{\n\tdisplay: none;\n}\n.instagram .album div.img-box{\n\tposition: absolute;\n\twidth: 90%;\n\theight: 90%;\n\t-webkit-box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n\t-moz-box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n\tbox-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n}\n.instagram .album div.img-box img{\n\twidth: 100%;\n\theight: 100%;\n    position: absolute;\n    z-index: 2;\n}\n.instagram .album div.img-box .img-bg{\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tbottom: 0px;\n\twidth: 100%;\n\tmargin: -5px;\n\tpadding: 5px;\n\t-webkit-box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\t-moz-box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\tbox-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\t-webkit-transition: all 0.15s ease-out 0.1s;\n\t-moz-transition: all 0.15s ease-out 0.1s;\n\t-o-transition: all 0.15s ease-out 0.1s;\n\ttransition: all 0.15s ease-out 0.1s;\n\topacity: 0.2;\n\tcursor: pointer;\n\tdisplay: block;\n\tz-index: 3;\n}\n.instagram .album div.img-box .icon {\n    font-size: 14px;\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    margin-left: -7px;\n    margin-top: -7px;\n    color: #999;\n    z-index: 1;\n}\n.instagram .album div.img-box .img-bg:hover{\n\topacity: 0;\n}\n.photos-btn-wrap {\n\tborder-bottom: 1px solid #e5e5e5;\n\tmargin-bottom: 20px;\n}\n.photos-btn {\n\tfont-size: 16px;\n\tcolor: #333;\n\tmargin-bottom: -4px;\n\tpadding: 5px 8px 3px;\n}\n.photos-btn.active {\n\tcolor: #08c;\n\tborder: 1px solid #e5e5e5;\n\tborder-bottom: 5px solid #fff;\n}\n\n@media screen and (max-width:600px) {\n\t.instagram .thumb {\n\t\twidth: 50%;\n\t\tpadding-bottom: 50%;\n\t}\n\t.instagram .album li {\n\t\twidth: 100%;\n\t\tposition: relative;\n\t\tpadding-bottom: 100%;\n\t\ttext-align: center;\n\t}\n\t.instagram .album div.img-box{\n\t\tmargin: 0;\n\t\twidth: 90%;\n\t\theight: 90%;\n\t}\n}","date":"2018-02-27T07:38:38.118Z","updated":"2018-02-27T07:38:38.118Z","path":"photos/ins.css","layout":"false","title":"","comments":1,"_id":"cje5fspet000gn8vfvgfro8d3","content":"#post-instagram{\n\tpadding: 30px;\n}\n#post-instagram .article-entry{\n\tpadding-right: 0;\n}\n.instagram{\n\tposition: relative;\n\tmin-height: 500px;\n}\n.instagram img {\n\twidth: 100%;\n}\n.instagram .year {\n\tfont-size: 16px;\n}\n.instagram .open-ins{\n\tpadding: 10px 0;\n\tcolor: #cdcdcd;\n}\n.instagram .open-ins:hover{\n\tcolor: #657b83;\n}\n.instagram .year{\n\tdisplay: inline;\n}\n.instagram .thumb {\n\twidth: 25%;\n\theight: 0; \n\tpadding-bottom: 25%;\n\tposition: relative;\n\tdisplay: inline-block;\n\ttext-align: center;\n\tbackground: #ededed;\n\toutline: 1px solid #ddd;\n}\n.instagram .thumb a {\n\tposition: relative;\n}\n.instagram .album h1 em{\n\tfont-style: normal;\n\tfont-size: 14px;\n\tmargin-left: 10px;\n}\n.instagram .album ul{\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tclear: both;\n\twidth: 100%;\n\ttext-align: left;\n}\n.instagram .album li{\n\tlist-style: none;\n\tdisplay: inline-block;\n\tbox-sizing: border-box;\n\tpadding: 0 5px;\n\tmargin-bottom: -10px;\n\theight: 0;\n\twidth: 25%;\n\tposition: relative;\n\tpadding-bottom: 25%;\n}\n.instagram .album li:before{\n\tdisplay: none;\n}\n.instagram .album div.img-box{\n\tposition: absolute;\n\twidth: 90%;\n\theight: 90%;\n\t-webkit-box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n\t-moz-box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n\tbox-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n}\n.instagram .album div.img-box img{\n\twidth: 100%;\n\theight: 100%;\n    position: absolute;\n    z-index: 2;\n}\n.instagram .album div.img-box .img-bg{\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tbottom: 0px;\n\twidth: 100%;\n\tmargin: -5px;\n\tpadding: 5px;\n\t-webkit-box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\t-moz-box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\tbox-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\t-webkit-transition: all 0.15s ease-out 0.1s;\n\t-moz-transition: all 0.15s ease-out 0.1s;\n\t-o-transition: all 0.15s ease-out 0.1s;\n\ttransition: all 0.15s ease-out 0.1s;\n\topacity: 0.2;\n\tcursor: pointer;\n\tdisplay: block;\n\tz-index: 3;\n}\n.instagram .album div.img-box .icon {\n    font-size: 14px;\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    margin-left: -7px;\n    margin-top: -7px;\n    color: #999;\n    z-index: 1;\n}\n.instagram .album div.img-box .img-bg:hover{\n\topacity: 0;\n}\n.photos-btn-wrap {\n\tborder-bottom: 1px solid #e5e5e5;\n\tmargin-bottom: 20px;\n}\n.photos-btn {\n\tfont-size: 16px;\n\tcolor: #333;\n\tmargin-bottom: -4px;\n\tpadding: 5px 8px 3px;\n}\n.photos-btn.active {\n\tcolor: #08c;\n\tborder: 1px solid #e5e5e5;\n\tborder-bottom: 5px solid #fff;\n}\n\n@media screen and (max-width:600px) {\n\t.instagram .thumb {\n\t\twidth: 50%;\n\t\tpadding-bottom: 50%;\n\t}\n\t.instagram .album li {\n\t\twidth: 100%;\n\t\tposition: relative;\n\t\tpadding-bottom: 100%;\n\t\ttext-align: center;\n\t}\n\t.instagram .album div.img-box{\n\t\tmargin: 0;\n\t\twidth: 90%;\n\t\theight: 90%;\n\t}\n}","site":{"data":{}},"excerpt":"","more":"#post-instagram{\n\tpadding: 30px;\n}\n#post-instagram .article-entry{\n\tpadding-right: 0;\n}\n.instagram{\n\tposition: relative;\n\tmin-height: 500px;\n}\n.instagram img {\n\twidth: 100%;\n}\n.instagram .year {\n\tfont-size: 16px;\n}\n.instagram .open-ins{\n\tpadding: 10px 0;\n\tcolor: #cdcdcd;\n}\n.instagram .open-ins:hover{\n\tcolor: #657b83;\n}\n.instagram .year{\n\tdisplay: inline;\n}\n.instagram .thumb {\n\twidth: 25%;\n\theight: 0; \n\tpadding-bottom: 25%;\n\tposition: relative;\n\tdisplay: inline-block;\n\ttext-align: center;\n\tbackground: #ededed;\n\toutline: 1px solid #ddd;\n}\n.instagram .thumb a {\n\tposition: relative;\n}\n.instagram .album h1 em{\n\tfont-style: normal;\n\tfont-size: 14px;\n\tmargin-left: 10px;\n}\n.instagram .album ul{\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tclear: both;\n\twidth: 100%;\n\ttext-align: left;\n}\n.instagram .album li{\n\tlist-style: none;\n\tdisplay: inline-block;\n\tbox-sizing: border-box;\n\tpadding: 0 5px;\n\tmargin-bottom: -10px;\n\theight: 0;\n\twidth: 25%;\n\tposition: relative;\n\tpadding-bottom: 25%;\n}\n.instagram .album li:before{\n\tdisplay: none;\n}\n.instagram .album div.img-box{\n\tposition: absolute;\n\twidth: 90%;\n\theight: 90%;\n\t-webkit-box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n\t-moz-box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n\tbox-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n}\n.instagram .album div.img-box img{\n\twidth: 100%;\n\theight: 100%;\n    position: absolute;\n    z-index: 2;\n}\n.instagram .album div.img-box .img-bg{\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tbottom: 0px;\n\twidth: 100%;\n\tmargin: -5px;\n\tpadding: 5px;\n\t-webkit-box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\t-moz-box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\tbox-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\t-webkit-transition: all 0.15s ease-out 0.1s;\n\t-moz-transition: all 0.15s ease-out 0.1s;\n\t-o-transition: all 0.15s ease-out 0.1s;\n\ttransition: all 0.15s ease-out 0.1s;\n\topacity: 0.2;\n\tcursor: pointer;\n\tdisplay: block;\n\tz-index: 3;\n}\n.instagram .album div.img-box .icon {\n    font-size: 14px;\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    margin-left: -7px;\n    margin-top: -7px;\n    color: #999;\n    z-index: 1;\n}\n.instagram .album div.img-box .img-bg:hover{\n\topacity: 0;\n}\n.photos-btn-wrap {\n\tborder-bottom: 1px solid #e5e5e5;\n\tmargin-bottom: 20px;\n}\n.photos-btn {\n\tfont-size: 16px;\n\tcolor: #333;\n\tmargin-bottom: -4px;\n\tpadding: 5px 8px 3px;\n}\n.photos-btn.active {\n\tcolor: #08c;\n\tborder: 1px solid #e5e5e5;\n\tborder-bottom: 5px solid #fff;\n}\n\n@media screen and (max-width:600px) {\n\t.instagram .thumb {\n\t\twidth: 50%;\n\t\tpadding-bottom: 50%;\n\t}\n\t.instagram .album li {\n\t\twidth: 100%;\n\t\tposition: relative;\n\t\tpadding-bottom: 100%;\n\t\ttext-align: center;\n\t}\n\t.instagram .album div.img-box{\n\t\tmargin: 0;\n\t\twidth: 90%;\n\t\theight: 90%;\n\t}\n}"},{"_content":"/******/\n(function(modules) { // webpackBootstrap\n  /******/ // The module cache\n  /******/\n  var installedModules = {};\n  /******/\n  /******/ // The require function\n  /******/\n  function __webpack_require__(moduleId) {\n    /******/\n    /******/ // Check if module is in cache\n    /******/\n    if (installedModules[moduleId])\n    /******/\n      return installedModules[moduleId].exports;\n    /******/\n    /******/ // Create a new module (and put it into the cache)\n    /******/\n    var module = installedModules[moduleId] = {\n      /******/\n      exports: {},\n      /******/\n      id: moduleId,\n      /******/\n      loaded: false\n        /******/\n    };\n    /******/\n    /******/ // Execute the module function\n    /******/\n    modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n    /******/\n    /******/ // Flag the module as loaded\n    /******/\n    module.loaded = true;\n    /******/\n    /******/ // Return the exports of the module\n    /******/\n    return module.exports;\n    /******/\n  }\n  /******/\n  /******/\n  /******/ // expose the modules object (__webpack_modules__)\n  /******/\n  __webpack_require__.m = modules;\n  /******/\n  /******/ // expose the module cache\n  /******/\n  __webpack_require__.c = installedModules;\n  /******/\n  /******/ // __webpack_public_path__\n  /******/\n  __webpack_require__.p = \"/dist/\";\n  /******/\n  /******/ // Load entry module and return exports\n  /******/\n  return __webpack_require__(0);\n  /******/\n})\n/************************************************************************/\n/******/\n([\n  /* 0 */\n  /***/\n  function(module, exports, __webpack_require__) {\n\n    'use strict';\n\n    __webpack_require__(1);\n\n    var _view = __webpack_require__(2);\n\n    var _view2 = _interopRequireDefault(_view);\n\n    function _interopRequireDefault(obj) {\n      return obj && obj.__esModule ? obj : {\n        default: obj\n      };\n    }\n\n    /**\n     * @name impush-client \n     * @description ������Ŀ���ҷ����¸���\n     * @date 2016-12-1\n     */\n\n    var _collection = [];\n    var _count = 0;\n    var searchData;\n\n    function addMask(elem) {\n      var rect = elem.getBoundingClientRect();\n      var style = getComputedStyle(elem, null);\n\n      var mask = document.createElement('i');\n      mask.className = 'icon-film';\n      mask.style.color = '#fff';\n      mask.style.fontSize = '26px';\n      mask.style.position = 'absolute';\n      mask.style.right = '10px';\n      mask.style.bottom = '10px';\n      mask.style.zIndex = 1;\n      elem.parentNode.appendChild(mask);\n    }\n\n    var createVideoIncon = function createVideoIncon() {\n      var $videoImg = document.querySelectorAll('.thumb a[data-type=\"video\"]');\n      for (var i = 0, len = $videoImg.length; i < len; i++) {\n        addMask($videoImg[i]);\n      }\n    };\n    var render = function render(res) {\n      var ulTmpl = \"\";\n      for (var j = 0, len2 = res.list.length; j < len2; j++) {\n        var data = res.list[j].arr;\n        var liTmpl = \"\";\n        for (var i = 0, len = data.link.length; i < len; i++) {\n          var minSrc = 'https://raw.githubusercontent.com/lawlite19/blog-back-up/master/min_photos/' + data.link[i];\n          var src = 'https://raw.githubusercontent.com/lawlite19/blog-back-up/master/photos/' + data.link[i];\n          var type = data.type[i];\n          var target = src + (type === 'video' ? '.mp4' : '.jpg');\n          src += '';\n\n          liTmpl += '<figure class=\"thumb\" itemprop=\"associatedMedia\" itemscope=\"\" itemtype=\"http://schema.org/ImageObject\">\\\n                <a href=\"' + src + '\" itemprop=\"contentUrl\" data-size=\"1080x1080\" data-type=\"' + type + '\" data-target=\"' + src + '\">\\\n                  <img class=\"reward-img\" data-type=\"' + type + '\" data-src=\"' + minSrc + '\" src=\"/assets/img/empty.png\" itemprop=\"thumbnail\" onload=\"lzld(this)\">\\\n                </a>\\\n                <figcaption style=\"display:none\" itemprop=\"caption description\">' + data.text[i] + '</figcaption>\\\n            </figure>';\n        }\n        ulTmpl = ulTmpl + '<section class=\"archives album\"><h1 class=\"year\">' + data.year + '��<em>' + data.month + '��</em></h1>\\\n        <ul class=\"img-box-ul\">' + liTmpl + '</ul>\\\n        </section>';\n      }\n      document.querySelector('.instagram').innerHTML = '<div class=\"photos\" itemscope=\"\" itemtype=\"http://schema.org/ImageGallery\">' + ulTmpl + '</div>';\n      createVideoIncon();\n      _view2.default.init();\n    };\n\n    var replacer = function replacer(str) {\n      var arr = str.split(\"/\");\n      return \"/assets/ins/\" + arr[arr.length - 1];\n    };\n\n    var ctrler = function ctrler(data) {\n      var imgObj = {};\n      for (var i = 0, len = data.length; i < len; i++) {\n        var y = data[i].y;\n        var m = data[i].m;\n        var src = replacer(data[i].src);\n        var text = data[i].text;\n        var key = y + \"\" + ((m + \"\").length == 1 ? \"0\" + m : m);\n        if (imgObj[key]) {\n          imgObj[key].srclist.push(src);\n          imgObj[key].text.push(text);\n        } else {\n          imgObj[key] = {\n            year: y,\n            month: m,\n            srclist: [src],\n            text: [text]\n          };\n        }\n      }\n      render(imgObj);\n    };\n\n    function loadData(success) {\n      if (!searchData) {\n        var xhr = new XMLHttpRequest();\n        xhr.open('GET', './data.json?t=' + +new Date(), true);\n\n        xhr.onload = function() {\n          if (this.status >= 200 && this.status < 300) {\n            var res = JSON.parse(this.response);\n            searchData = res;\n            success(searchData);\n          } else {\n            console.error(this.statusText);\n          }\n        };\n\n        xhr.onerror = function() {\n          console.error(this.statusText);\n        };\n\n        xhr.send();\n      } else {\n        success(searchData);\n      }\n    }\n\n    var Ins = {\n      init: function init() {\n        loadData(function(data) {\n          render(data);\n        });\n      }\n    };\n\n    Ins.init();\n\n    // export default impush;\n\n    /***/\n  },\n  /* 1 */\n  /***/\n  function(module, exports, __webpack_require__) {\n\n    /* WEBPACK VAR INJECTION */\n    (function(global) {\n      'use strict';\n\n      var inViewport = __webpack_require__(3);\n      var lazyAttrs = ['data-src'];\n\n      global.lzld = lazyload();\n\n      // Provide libs using getAttribute early to get the good src\n      // and not the fake data-src\n      replaceGetAttribute('Image');\n      replaceGetAttribute('IFrame');\n\n      function registerLazyAttr(attr) {\n        if (indexOf.call(lazyAttrs, attr) === -1) {\n          lazyAttrs.push(attr);\n        }\n      }\n\n      function lazyload(opts) {\n        opts = merge({\n          'offset': 333,\n          'src': 'data-src',\n          'container': false\n        }, opts || {});\n\n        if (typeof opts.src === 'string') {\n          registerLazyAttr(opts.src);\n        }\n\n        var elts = [];\n\n        function show(elt) {\n          var src = findRealSrc(elt);\n\n          if (src) {\n            elt.src = src;\n          }\n\n          elt.setAttribute('data-lzled', true);\n          elts[indexOf.call(elts, elt)] = null;\n        }\n\n        function findRealSrc(elt) {\n          if (typeof opts.src === 'function') {\n            return opts.src(elt);\n          }\n\n          return elt.getAttribute(opts.src);\n        }\n\n        function register(elt) {\n          elt.onload = null;\n          elt.removeAttribute('onload');\n          elt.onerror = null;\n          elt.removeAttribute('onerror');\n\n          if (indexOf.call(elts, elt) === -1) {\n            inViewport(elt, opts, show);\n          }\n        }\n\n        return register;\n      }\n\n      function replaceGetAttribute(elementName) {\n        var fullname = 'HTML' + elementName + 'Element';\n        if (fullname in global === false) {\n          return;\n        }\n\n        var original = global[fullname].prototype.getAttribute;\n        global[fullname].prototype.getAttribute = function(name) {\n          if (name === 'src') {\n            var realSrc;\n            for (var i = 0, max = lazyAttrs.length; i < max; i++) {\n              realSrc = original.call(this, lazyAttrs[i]);\n              if (realSrc) {\n                break;\n              }\n            }\n\n            return realSrc || original.call(this, name);\n          }\n\n          // our own lazyloader will go through theses lines\n          // because we use getAttribute(opts.src)\n          return original.call(this, name);\n        };\n      }\n\n      function merge(defaults, opts) {\n        for (var name in defaults) {\n          if (opts[name] === undefined) {\n            opts[name] = defaults[name];\n          }\n        }\n\n        return opts;\n      }\n\n      // http://webreflection.blogspot.fr/2011/06/partial-polyfills.html\n      function indexOf(value) {\n        for (var i = this.length; i-- && this[i] !== value;) {}\n        return i;\n      }\n\n      module.exports = lazyload;\n\n      // export default impush;\n      /* WEBPACK VAR INJECTION */\n    }.call(exports, (function() {\n      return this;\n    }())))\n\n    /***/\n  },\n  /* 2 */\n  /***/\n  function(module, exports) {\n\n    'use strict';\n\n    var initPhotoSwipeFromDOM = function initPhotoSwipeFromDOM(gallerySelector) {\n\n      // parse slide data (url, title, size ...) from DOM elements \n      // (children of gallerySelector)\n      var parseThumbnailElements = function parseThumbnailElements(el) {\n        el = el.parentNode.parentNode;\n        var thumbElements = el.getElementsByClassName('thumb'),\n          numNodes = thumbElements.length,\n          items = [],\n          figureEl,\n          linkEl,\n          size,\n          type,\n          // video or not\n          target,\n          item;\n\n        for (var i = 0; i < numNodes; i++) {\n\n          figureEl = thumbElements[i]; // \n\n          // include only element nodes \n          if (figureEl.nodeType !== 1) {\n            continue;\n          }\n\n          linkEl = figureEl.children[0]; // \n\n          size = linkEl.getAttribute('data-size').split('x');\n          type = linkEl.getAttribute('data-type');\n          target = linkEl.getAttribute('data-target');\n          // create slide object\n          item = {\n            src: linkEl.getAttribute('href'),\n            w: parseInt(size[0], 10),\n            h: parseInt(size[1], 10)\n          };\n\n          if (figureEl.children.length > 1) {\n            item.title = figureEl.children[1].innerHTML;\n          }\n\n          if (linkEl.children.length > 0) {\n            item.msrc = linkEl.children[0].getAttribute('src');\n            item.type = type;\n            item.target = target;\n            item.html = '<video src=\"' + target + '\" controls=\"controls\" autoplay=\"autoplay\"></video>';\n            if (type === 'video') {\n              //item.src = null;\n            }\n          }\n\n          item.el = figureEl; // save link to element for getThumbBoundsFn\n          items.push(item);\n        }\n\n        return items;\n      };\n\n      // find nearest parent element\n      var closest = function closest(el, fn) {\n        return el && (fn(el) ? el : closest(el.parentNode, fn));\n      };\n\n      // triggers when user clicks on thumbnail\n      var onThumbnailsClick = function onThumbnailsClick(e) {\n        e = e || window.event;\n        e.preventDefault ? e.preventDefault() : e.returnValue = false;\n\n        var eTarget = e.target || e.srcElement;\n\n        // find root element of slide\n        var clickedListItem = closest(eTarget, function(el) {\n          return el.tagName && el.tagName.toUpperCase() === 'FIGURE';\n        });\n\n        if (!clickedListItem) {\n          return;\n        }\n\n        // find index of clicked item by looping through all child nodes\n        // alternatively, you may define index via data- attribute\n        var clickedGallery = clickedListItem.parentNode,\n\n          // childNodes = clickedListItem.parentNode.childNodes,\n          // numChildNodes = childNodes.length,\n          childNodes = document.getElementsByClassName('thumb'),\n          numChildNodes = childNodes.length,\n          nodeIndex = 0,\n          index;\n\n        for (var i = 0; i < numChildNodes; i++) {\n          if (childNodes[i].nodeType !== 1) {\n            continue;\n          }\n\n          if (childNodes[i] === clickedListItem) {\n            index = nodeIndex;\n            break;\n          }\n          nodeIndex++;\n        }\n\n        if (index >= 0) {\n          // open PhotoSwipe if valid index found\n          openPhotoSwipe(index, clickedGallery);\n        }\n        return false;\n      };\n\n      // parse picture index and gallery index from URL (#&pid=1&gid=2)\n      var photoswipeParseHash = function photoswipeParseHash() {\n        var hash = window.location.hash.substring(1),\n          params = {};\n\n        if (hash.length < 5) {\n          return params;\n        }\n\n        var vars = hash.split('&');\n        for (var i = 0; i < vars.length; i++) {\n          if (!vars[i]) {\n            continue;\n          }\n          var pair = vars[i].split('=');\n          if (pair.length < 2) {\n            continue;\n          }\n          params[pair[0]] = pair[1];\n        }\n\n        if (params.gid) {\n          params.gid = parseInt(params.gid, 10);\n        }\n\n        return params;\n      };\n\n      var openPhotoSwipe = function openPhotoSwipe(index, galleryElement, disableAnimation, fromURL) {\n        var pswpElement = document.querySelectorAll('.pswp')[0],\n          gallery,\n          options,\n          items;\n\n        items = parseThumbnailElements(galleryElement);\n        // define options (if needed)\n        options = {\n\n          // define gallery index (for URL)\n          galleryUID: galleryElement.getAttribute('data-pswp-uid'),\n\n          getThumbBoundsFn: function getThumbBoundsFn(index) {\n            // See Options -> getThumbBoundsFn section of documentation for more info\n            var thumbnail = items[index].el.getElementsByTagName('img')[0],\n              // find thumbnail\n              pageYScroll = window.pageYOffset || document.documentElement.scrollTop,\n              rect = thumbnail.getBoundingClientRect();\n\n            return {\n              x: rect.left,\n              y: rect.top + pageYScroll,\n              w: rect.width\n            };\n          }\n\n        };\n\n        // PhotoSwipe opened from URL\n        if (fromURL) {\n          if (options.galleryPIDs) {\n            // parse real index when custom PIDs are used \n            // http://photoswipe.com/documentation/faq.html#custom-pid-in-url\n            for (var j = 0; j < items.length; j++) {\n              if (items[j].pid == index) {\n                options.index = j;\n                break;\n              }\n            }\n          } else {\n            // in URL indexes start from 1\n            options.index = parseInt(index, 10) - 1;\n          }\n        } else {\n          options.index = parseInt(index, 10);\n        }\n\n        // exit if index not found\n        if (isNaN(options.index)) {\n          return;\n        }\n\n        if (disableAnimation) {\n          options.showAnimationDuration = 0;\n        }\n\n        // Pass data to PhotoSwipe and initialize it\n        gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);\n        gallery.init();\n\n        var $tempVideo;\n        var stopVideoHandle = function stopVideoHandle() {\n          if ($tempVideo) {\n            $tempVideo.remove();\n            $tempVideo = null;\n          }\n        };\n        var changeHandle = function changeHandle() {\n          var item = gallery.currItem;\n          stopVideoHandle();\n          if (item.type === 'video') {\n            var $ctn = item.container;\n            var style = $ctn.getElementsByClassName('pswp__img')[0].style;\n            var $video = document.createElement('video');\n            $video.setAttribute('autoplay', 'autoplay');\n            $video.setAttribute('controls', 'controls');\n            $video.setAttribute('src', item.target);\n            $video.style.width = style.width;\n            $video.style.height = style.height;\n            $video.style.position = 'absolute';\n            $video.style.zIndex = 2;\n            $tempVideo = $video;\n            $ctn.appendChild($video);\n          }\n        };\n        gallery.listen('initialZoomIn', changeHandle);\n        gallery.listen('afterChange', changeHandle);\n        gallery.listen('initialZoomOut', stopVideoHandle);\n      };\n\n      // loop through all gallery elements and bind events\n      var galleryElements = document.querySelectorAll(gallerySelector);\n      for (var i = 0, l = galleryElements.length; i < l; i++) {\n        galleryElements[i].setAttribute('data-pswp-uid', i + 1);\n        galleryElements[i].onclick = onThumbnailsClick;\n      }\n\n      // Parse URL and open gallery if it contains #&pid=3&gid=1\n      var hashData = photoswipeParseHash();\n      if (hashData.pid && hashData.gid) {\n        openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);\n      }\n    };\n\n    var Viewer = function() {\n      function init() {\n        initPhotoSwipeFromDOM('.photos');\n      }\n      return {\n        init: init\n      };\n    }();\n\n    module.exports = Viewer;\n\n    /***/\n  },\n  /* 3 */\n  /***/\n  function(module, exports) {\n\n    /* WEBPACK VAR INJECTION */\n    (function(global) {\n      module.exports = inViewport;\n\n      var instances = [];\n      var supportsMutationObserver = typeof global.MutationObserver === 'function';\n\n      function inViewport(elt, params, cb) {\n        var opts = {\n          container: global.document.body,\n          offset: 0\n        };\n\n        if (params === undefined || typeof params === 'function') {\n          cb = params;\n          params = {};\n        }\n\n        var container = opts.container = params.container || opts.container;\n        var offset = opts.offset = params.offset || opts.offset;\n\n        for (var i = 0; i < instances.length; i++) {\n          if (instances[i].container === container) {\n            return instances[i].isInViewport(elt, offset, cb);\n          }\n        }\n\n        return instances[\n          instances.push(createInViewport(container)) - 1\n        ].isInViewport(elt, offset, cb);\n      }\n\n      function addEvent(el, type, fn) {\n        if (el.attachEvent) {\n          el.attachEvent('on' + type, fn);\n        } else {\n          el.addEventListener(type, fn, false);\n        }\n      }\n\n      function debounce(func, wait, immediate) {\n        var timeout;\n        return function() {\n          var context = this,\n            args = arguments;\n          var callNow = immediate && !timeout;\n          clearTimeout(timeout);\n          timeout = setTimeout(later, wait);\n          if (callNow) func.apply(context, args);\n\n          function later() {\n            timeout = null;\n            if (!immediate) func.apply(context, args);\n          }\n        };\n      }\n\n      // https://github.com/jquery/sizzle/blob/3136f48b90e3edc84cbaaa6f6f7734ef03775a07/sizzle.js#L708\n      var contains = function() {\n        if (!global.document) {\n          return true;\n        }\n        return global.document.documentElement.compareDocumentPosition ?\n          function(a, b) {\n            return !!(a.compareDocumentPosition(b) & 16);\n          } :\n          global.document.documentElement.contains ?\n          function(a, b) {\n            return a !== b && (a.contains ? a.contains(b) : false);\n          } :\n          function(a, b) {\n            while (b = b.parentNode) {\n              if (b === a) {\n                return true;\n              }\n            }\n            return false;\n          };\n      }\n\n      function createInViewport(container) {\n        var watches = createWatches();\n\n        var scrollContainer = container === global.document.body ? global : container;\n        var debouncedCheck = debounce(watches.checkAll(watchInViewport), 15);\n\n        addEvent(scrollContainer, 'scroll', debouncedCheck);\n\n        if (scrollContainer === global) {\n          addEvent(global, 'resize', debouncedCheck);\n        }\n\n        if (supportsMutationObserver) {\n          observeDOM(watches, container, debouncedCheck);\n        }\n\n        // failsafe check, every 200ms we check for visible images\n        // usecase: a hidden parent containing eleements\n        // when the parent becomes visible, we have no event that the children\n        // became visible\n        setInterval(debouncedCheck, 150);\n\n        function isInViewport(elt, offset, cb) {\n          if (!cb) {\n            return isVisible(elt, offset);\n          }\n\n          var remote = createRemote(elt, offset, cb);\n          remote.watch();\n          return remote;\n        }\n\n        function createRemote(elt, offset, cb) {\n          function watch() {\n            watches.add(elt, offset, cb);\n          }\n\n          function dispose() {\n            watches.remove(elt);\n          }\n\n          return {\n            watch: watch,\n            dispose: dispose\n          };\n        }\n\n        function watchInViewport(elt, offset, cb) {\n          if (isVisible(elt, offset)) {\n            watches.remove(elt);\n            cb(elt);\n          }\n        }\n\n        function isVisible(elt, offset) {\n          if (!contains(global.document.documentElement, elt) || !contains(global.document.documentElement, container)) {\n            return false;\n          }\n\n          // Check if the element is visible\n          // https://github.com/jquery/jquery/blob/740e190223d19a114d5373758127285d14d6b71e/src/css/hiddenVisibleSelectors.js\n          if (!elt.offsetWidth || !elt.offsetHeight) {\n            return false;\n          }\n\n          var eltRect = elt.getBoundingClientRect();\n          var viewport = {};\n\n          if (container === global.document.body) {\n            viewport = {\n              top: -offset,\n              left: -offset,\n              right: global.document.documentElement.clientWidth + offset,\n              bottom: global.document.documentElement.clientHeight + offset\n            };\n          } else {\n            var containerRect = container.getBoundingClientRect();\n            viewport = {\n              top: containerRect.top - offset,\n              left: containerRect.left - offset,\n              right: containerRect.right + offset,\n              bottom: containerRect.bottom + offset\n            };\n          }\n\n          // The element must overlap with the visible part of the viewport\n          var visible =\n            (\n              (eltRect.right > viewport.left) &&\n              (eltRect.left < viewport.right) &&\n              (eltRect.bottom > viewport.top) &&\n              (eltRect.top < viewport.bottom)\n            );\n\n          return visible;\n        }\n\n        return {\n          container: container,\n          isInViewport: isInViewport\n        };\n      }\n\n      function createWatches() {\n        var watches = [];\n\n        function add(elt, offset, cb) {\n          if (!isWatched(elt)) {\n            watches.push([elt, offset, cb]);\n          }\n        }\n\n        function remove(elt) {\n          var pos = indexOf(elt);\n          if (pos !== -1) {\n            watches.splice(pos, 1);\n          }\n        }\n\n        function indexOf(elt) {\n          for (var i = watches.length - 1; i >= 0; i--) {\n            if (watches[i][0] === elt) {\n              return i;\n            }\n          }\n          return -1;\n        }\n\n        function isWatched(elt) {\n          return indexOf(elt) !== -1;\n        }\n\n        function checkAll(cb) {\n          return function() {\n            for (var i = watches.length - 1; i >= 0; i--) {\n              cb.apply(this, watches[i]);\n            }\n          };\n        }\n\n        return {\n          add: add,\n          remove: remove,\n          isWatched: isWatched,\n          checkAll: checkAll\n        };\n      }\n\n      function observeDOM(watches, container, cb) {\n        var observer = new MutationObserver(watch);\n        var filter = Array.prototype.filter;\n        var concat = Array.prototype.concat;\n\n        observer.observe(container, {\n          childList: true,\n          subtree: true,\n          // changes like style/width/height/display will be catched\n          attributes: true\n        });\n\n        function watch(mutations) {\n          // some new DOM nodes where previously watched\n          // we should check their positions\n          if (mutations.some(knownNodes) === true) {\n            setTimeout(cb, 0);\n          }\n        }\n\n        function knownNodes(mutation) {\n          var nodes = concat.call([],\n            Array.prototype.slice.call(mutation.addedNodes),\n            mutation.target\n          );\n          return filter.call(nodes, watches.isWatched).length > 0;\n        }\n      }\n\n      /* WEBPACK VAR INJECTION */\n    }.call(exports, (function() {\n      return this;\n    }())))\n\n    /***/\n  }\n  /******/\n]);","source":"photos/ins.js","raw":"/******/\n(function(modules) { // webpackBootstrap\n  /******/ // The module cache\n  /******/\n  var installedModules = {};\n  /******/\n  /******/ // The require function\n  /******/\n  function __webpack_require__(moduleId) {\n    /******/\n    /******/ // Check if module is in cache\n    /******/\n    if (installedModules[moduleId])\n    /******/\n      return installedModules[moduleId].exports;\n    /******/\n    /******/ // Create a new module (and put it into the cache)\n    /******/\n    var module = installedModules[moduleId] = {\n      /******/\n      exports: {},\n      /******/\n      id: moduleId,\n      /******/\n      loaded: false\n        /******/\n    };\n    /******/\n    /******/ // Execute the module function\n    /******/\n    modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n    /******/\n    /******/ // Flag the module as loaded\n    /******/\n    module.loaded = true;\n    /******/\n    /******/ // Return the exports of the module\n    /******/\n    return module.exports;\n    /******/\n  }\n  /******/\n  /******/\n  /******/ // expose the modules object (__webpack_modules__)\n  /******/\n  __webpack_require__.m = modules;\n  /******/\n  /******/ // expose the module cache\n  /******/\n  __webpack_require__.c = installedModules;\n  /******/\n  /******/ // __webpack_public_path__\n  /******/\n  __webpack_require__.p = \"/dist/\";\n  /******/\n  /******/ // Load entry module and return exports\n  /******/\n  return __webpack_require__(0);\n  /******/\n})\n/************************************************************************/\n/******/\n([\n  /* 0 */\n  /***/\n  function(module, exports, __webpack_require__) {\n\n    'use strict';\n\n    __webpack_require__(1);\n\n    var _view = __webpack_require__(2);\n\n    var _view2 = _interopRequireDefault(_view);\n\n    function _interopRequireDefault(obj) {\n      return obj && obj.__esModule ? obj : {\n        default: obj\n      };\n    }\n\n    /**\n     * @name impush-client \n     * @description ������Ŀ���ҷ����¸���\n     * @date 2016-12-1\n     */\n\n    var _collection = [];\n    var _count = 0;\n    var searchData;\n\n    function addMask(elem) {\n      var rect = elem.getBoundingClientRect();\n      var style = getComputedStyle(elem, null);\n\n      var mask = document.createElement('i');\n      mask.className = 'icon-film';\n      mask.style.color = '#fff';\n      mask.style.fontSize = '26px';\n      mask.style.position = 'absolute';\n      mask.style.right = '10px';\n      mask.style.bottom = '10px';\n      mask.style.zIndex = 1;\n      elem.parentNode.appendChild(mask);\n    }\n\n    var createVideoIncon = function createVideoIncon() {\n      var $videoImg = document.querySelectorAll('.thumb a[data-type=\"video\"]');\n      for (var i = 0, len = $videoImg.length; i < len; i++) {\n        addMask($videoImg[i]);\n      }\n    };\n    var render = function render(res) {\n      var ulTmpl = \"\";\n      for (var j = 0, len2 = res.list.length; j < len2; j++) {\n        var data = res.list[j].arr;\n        var liTmpl = \"\";\n        for (var i = 0, len = data.link.length; i < len; i++) {\n          var minSrc = 'https://raw.githubusercontent.com/lawlite19/blog-back-up/master/min_photos/' + data.link[i];\n          var src = 'https://raw.githubusercontent.com/lawlite19/blog-back-up/master/photos/' + data.link[i];\n          var type = data.type[i];\n          var target = src + (type === 'video' ? '.mp4' : '.jpg');\n          src += '';\n\n          liTmpl += '<figure class=\"thumb\" itemprop=\"associatedMedia\" itemscope=\"\" itemtype=\"http://schema.org/ImageObject\">\\\n                <a href=\"' + src + '\" itemprop=\"contentUrl\" data-size=\"1080x1080\" data-type=\"' + type + '\" data-target=\"' + src + '\">\\\n                  <img class=\"reward-img\" data-type=\"' + type + '\" data-src=\"' + minSrc + '\" src=\"/assets/img/empty.png\" itemprop=\"thumbnail\" onload=\"lzld(this)\">\\\n                </a>\\\n                <figcaption style=\"display:none\" itemprop=\"caption description\">' + data.text[i] + '</figcaption>\\\n            </figure>';\n        }\n        ulTmpl = ulTmpl + '<section class=\"archives album\"><h1 class=\"year\">' + data.year + '��<em>' + data.month + '��</em></h1>\\\n        <ul class=\"img-box-ul\">' + liTmpl + '</ul>\\\n        </section>';\n      }\n      document.querySelector('.instagram').innerHTML = '<div class=\"photos\" itemscope=\"\" itemtype=\"http://schema.org/ImageGallery\">' + ulTmpl + '</div>';\n      createVideoIncon();\n      _view2.default.init();\n    };\n\n    var replacer = function replacer(str) {\n      var arr = str.split(\"/\");\n      return \"/assets/ins/\" + arr[arr.length - 1];\n    };\n\n    var ctrler = function ctrler(data) {\n      var imgObj = {};\n      for (var i = 0, len = data.length; i < len; i++) {\n        var y = data[i].y;\n        var m = data[i].m;\n        var src = replacer(data[i].src);\n        var text = data[i].text;\n        var key = y + \"\" + ((m + \"\").length == 1 ? \"0\" + m : m);\n        if (imgObj[key]) {\n          imgObj[key].srclist.push(src);\n          imgObj[key].text.push(text);\n        } else {\n          imgObj[key] = {\n            year: y,\n            month: m,\n            srclist: [src],\n            text: [text]\n          };\n        }\n      }\n      render(imgObj);\n    };\n\n    function loadData(success) {\n      if (!searchData) {\n        var xhr = new XMLHttpRequest();\n        xhr.open('GET', './data.json?t=' + +new Date(), true);\n\n        xhr.onload = function() {\n          if (this.status >= 200 && this.status < 300) {\n            var res = JSON.parse(this.response);\n            searchData = res;\n            success(searchData);\n          } else {\n            console.error(this.statusText);\n          }\n        };\n\n        xhr.onerror = function() {\n          console.error(this.statusText);\n        };\n\n        xhr.send();\n      } else {\n        success(searchData);\n      }\n    }\n\n    var Ins = {\n      init: function init() {\n        loadData(function(data) {\n          render(data);\n        });\n      }\n    };\n\n    Ins.init();\n\n    // export default impush;\n\n    /***/\n  },\n  /* 1 */\n  /***/\n  function(module, exports, __webpack_require__) {\n\n    /* WEBPACK VAR INJECTION */\n    (function(global) {\n      'use strict';\n\n      var inViewport = __webpack_require__(3);\n      var lazyAttrs = ['data-src'];\n\n      global.lzld = lazyload();\n\n      // Provide libs using getAttribute early to get the good src\n      // and not the fake data-src\n      replaceGetAttribute('Image');\n      replaceGetAttribute('IFrame');\n\n      function registerLazyAttr(attr) {\n        if (indexOf.call(lazyAttrs, attr) === -1) {\n          lazyAttrs.push(attr);\n        }\n      }\n\n      function lazyload(opts) {\n        opts = merge({\n          'offset': 333,\n          'src': 'data-src',\n          'container': false\n        }, opts || {});\n\n        if (typeof opts.src === 'string') {\n          registerLazyAttr(opts.src);\n        }\n\n        var elts = [];\n\n        function show(elt) {\n          var src = findRealSrc(elt);\n\n          if (src) {\n            elt.src = src;\n          }\n\n          elt.setAttribute('data-lzled', true);\n          elts[indexOf.call(elts, elt)] = null;\n        }\n\n        function findRealSrc(elt) {\n          if (typeof opts.src === 'function') {\n            return opts.src(elt);\n          }\n\n          return elt.getAttribute(opts.src);\n        }\n\n        function register(elt) {\n          elt.onload = null;\n          elt.removeAttribute('onload');\n          elt.onerror = null;\n          elt.removeAttribute('onerror');\n\n          if (indexOf.call(elts, elt) === -1) {\n            inViewport(elt, opts, show);\n          }\n        }\n\n        return register;\n      }\n\n      function replaceGetAttribute(elementName) {\n        var fullname = 'HTML' + elementName + 'Element';\n        if (fullname in global === false) {\n          return;\n        }\n\n        var original = global[fullname].prototype.getAttribute;\n        global[fullname].prototype.getAttribute = function(name) {\n          if (name === 'src') {\n            var realSrc;\n            for (var i = 0, max = lazyAttrs.length; i < max; i++) {\n              realSrc = original.call(this, lazyAttrs[i]);\n              if (realSrc) {\n                break;\n              }\n            }\n\n            return realSrc || original.call(this, name);\n          }\n\n          // our own lazyloader will go through theses lines\n          // because we use getAttribute(opts.src)\n          return original.call(this, name);\n        };\n      }\n\n      function merge(defaults, opts) {\n        for (var name in defaults) {\n          if (opts[name] === undefined) {\n            opts[name] = defaults[name];\n          }\n        }\n\n        return opts;\n      }\n\n      // http://webreflection.blogspot.fr/2011/06/partial-polyfills.html\n      function indexOf(value) {\n        for (var i = this.length; i-- && this[i] !== value;) {}\n        return i;\n      }\n\n      module.exports = lazyload;\n\n      // export default impush;\n      /* WEBPACK VAR INJECTION */\n    }.call(exports, (function() {\n      return this;\n    }())))\n\n    /***/\n  },\n  /* 2 */\n  /***/\n  function(module, exports) {\n\n    'use strict';\n\n    var initPhotoSwipeFromDOM = function initPhotoSwipeFromDOM(gallerySelector) {\n\n      // parse slide data (url, title, size ...) from DOM elements \n      // (children of gallerySelector)\n      var parseThumbnailElements = function parseThumbnailElements(el) {\n        el = el.parentNode.parentNode;\n        var thumbElements = el.getElementsByClassName('thumb'),\n          numNodes = thumbElements.length,\n          items = [],\n          figureEl,\n          linkEl,\n          size,\n          type,\n          // video or not\n          target,\n          item;\n\n        for (var i = 0; i < numNodes; i++) {\n\n          figureEl = thumbElements[i]; // \n\n          // include only element nodes \n          if (figureEl.nodeType !== 1) {\n            continue;\n          }\n\n          linkEl = figureEl.children[0]; // \n\n          size = linkEl.getAttribute('data-size').split('x');\n          type = linkEl.getAttribute('data-type');\n          target = linkEl.getAttribute('data-target');\n          // create slide object\n          item = {\n            src: linkEl.getAttribute('href'),\n            w: parseInt(size[0], 10),\n            h: parseInt(size[1], 10)\n          };\n\n          if (figureEl.children.length > 1) {\n            item.title = figureEl.children[1].innerHTML;\n          }\n\n          if (linkEl.children.length > 0) {\n            item.msrc = linkEl.children[0].getAttribute('src');\n            item.type = type;\n            item.target = target;\n            item.html = '<video src=\"' + target + '\" controls=\"controls\" autoplay=\"autoplay\"></video>';\n            if (type === 'video') {\n              //item.src = null;\n            }\n          }\n\n          item.el = figureEl; // save link to element for getThumbBoundsFn\n          items.push(item);\n        }\n\n        return items;\n      };\n\n      // find nearest parent element\n      var closest = function closest(el, fn) {\n        return el && (fn(el) ? el : closest(el.parentNode, fn));\n      };\n\n      // triggers when user clicks on thumbnail\n      var onThumbnailsClick = function onThumbnailsClick(e) {\n        e = e || window.event;\n        e.preventDefault ? e.preventDefault() : e.returnValue = false;\n\n        var eTarget = e.target || e.srcElement;\n\n        // find root element of slide\n        var clickedListItem = closest(eTarget, function(el) {\n          return el.tagName && el.tagName.toUpperCase() === 'FIGURE';\n        });\n\n        if (!clickedListItem) {\n          return;\n        }\n\n        // find index of clicked item by looping through all child nodes\n        // alternatively, you may define index via data- attribute\n        var clickedGallery = clickedListItem.parentNode,\n\n          // childNodes = clickedListItem.parentNode.childNodes,\n          // numChildNodes = childNodes.length,\n          childNodes = document.getElementsByClassName('thumb'),\n          numChildNodes = childNodes.length,\n          nodeIndex = 0,\n          index;\n\n        for (var i = 0; i < numChildNodes; i++) {\n          if (childNodes[i].nodeType !== 1) {\n            continue;\n          }\n\n          if (childNodes[i] === clickedListItem) {\n            index = nodeIndex;\n            break;\n          }\n          nodeIndex++;\n        }\n\n        if (index >= 0) {\n          // open PhotoSwipe if valid index found\n          openPhotoSwipe(index, clickedGallery);\n        }\n        return false;\n      };\n\n      // parse picture index and gallery index from URL (#&pid=1&gid=2)\n      var photoswipeParseHash = function photoswipeParseHash() {\n        var hash = window.location.hash.substring(1),\n          params = {};\n\n        if (hash.length < 5) {\n          return params;\n        }\n\n        var vars = hash.split('&');\n        for (var i = 0; i < vars.length; i++) {\n          if (!vars[i]) {\n            continue;\n          }\n          var pair = vars[i].split('=');\n          if (pair.length < 2) {\n            continue;\n          }\n          params[pair[0]] = pair[1];\n        }\n\n        if (params.gid) {\n          params.gid = parseInt(params.gid, 10);\n        }\n\n        return params;\n      };\n\n      var openPhotoSwipe = function openPhotoSwipe(index, galleryElement, disableAnimation, fromURL) {\n        var pswpElement = document.querySelectorAll('.pswp')[0],\n          gallery,\n          options,\n          items;\n\n        items = parseThumbnailElements(galleryElement);\n        // define options (if needed)\n        options = {\n\n          // define gallery index (for URL)\n          galleryUID: galleryElement.getAttribute('data-pswp-uid'),\n\n          getThumbBoundsFn: function getThumbBoundsFn(index) {\n            // See Options -> getThumbBoundsFn section of documentation for more info\n            var thumbnail = items[index].el.getElementsByTagName('img')[0],\n              // find thumbnail\n              pageYScroll = window.pageYOffset || document.documentElement.scrollTop,\n              rect = thumbnail.getBoundingClientRect();\n\n            return {\n              x: rect.left,\n              y: rect.top + pageYScroll,\n              w: rect.width\n            };\n          }\n\n        };\n\n        // PhotoSwipe opened from URL\n        if (fromURL) {\n          if (options.galleryPIDs) {\n            // parse real index when custom PIDs are used \n            // http://photoswipe.com/documentation/faq.html#custom-pid-in-url\n            for (var j = 0; j < items.length; j++) {\n              if (items[j].pid == index) {\n                options.index = j;\n                break;\n              }\n            }\n          } else {\n            // in URL indexes start from 1\n            options.index = parseInt(index, 10) - 1;\n          }\n        } else {\n          options.index = parseInt(index, 10);\n        }\n\n        // exit if index not found\n        if (isNaN(options.index)) {\n          return;\n        }\n\n        if (disableAnimation) {\n          options.showAnimationDuration = 0;\n        }\n\n        // Pass data to PhotoSwipe and initialize it\n        gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);\n        gallery.init();\n\n        var $tempVideo;\n        var stopVideoHandle = function stopVideoHandle() {\n          if ($tempVideo) {\n            $tempVideo.remove();\n            $tempVideo = null;\n          }\n        };\n        var changeHandle = function changeHandle() {\n          var item = gallery.currItem;\n          stopVideoHandle();\n          if (item.type === 'video') {\n            var $ctn = item.container;\n            var style = $ctn.getElementsByClassName('pswp__img')[0].style;\n            var $video = document.createElement('video');\n            $video.setAttribute('autoplay', 'autoplay');\n            $video.setAttribute('controls', 'controls');\n            $video.setAttribute('src', item.target);\n            $video.style.width = style.width;\n            $video.style.height = style.height;\n            $video.style.position = 'absolute';\n            $video.style.zIndex = 2;\n            $tempVideo = $video;\n            $ctn.appendChild($video);\n          }\n        };\n        gallery.listen('initialZoomIn', changeHandle);\n        gallery.listen('afterChange', changeHandle);\n        gallery.listen('initialZoomOut', stopVideoHandle);\n      };\n\n      // loop through all gallery elements and bind events\n      var galleryElements = document.querySelectorAll(gallerySelector);\n      for (var i = 0, l = galleryElements.length; i < l; i++) {\n        galleryElements[i].setAttribute('data-pswp-uid', i + 1);\n        galleryElements[i].onclick = onThumbnailsClick;\n      }\n\n      // Parse URL and open gallery if it contains #&pid=3&gid=1\n      var hashData = photoswipeParseHash();\n      if (hashData.pid && hashData.gid) {\n        openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);\n      }\n    };\n\n    var Viewer = function() {\n      function init() {\n        initPhotoSwipeFromDOM('.photos');\n      }\n      return {\n        init: init\n      };\n    }();\n\n    module.exports = Viewer;\n\n    /***/\n  },\n  /* 3 */\n  /***/\n  function(module, exports) {\n\n    /* WEBPACK VAR INJECTION */\n    (function(global) {\n      module.exports = inViewport;\n\n      var instances = [];\n      var supportsMutationObserver = typeof global.MutationObserver === 'function';\n\n      function inViewport(elt, params, cb) {\n        var opts = {\n          container: global.document.body,\n          offset: 0\n        };\n\n        if (params === undefined || typeof params === 'function') {\n          cb = params;\n          params = {};\n        }\n\n        var container = opts.container = params.container || opts.container;\n        var offset = opts.offset = params.offset || opts.offset;\n\n        for (var i = 0; i < instances.length; i++) {\n          if (instances[i].container === container) {\n            return instances[i].isInViewport(elt, offset, cb);\n          }\n        }\n\n        return instances[\n          instances.push(createInViewport(container)) - 1\n        ].isInViewport(elt, offset, cb);\n      }\n\n      function addEvent(el, type, fn) {\n        if (el.attachEvent) {\n          el.attachEvent('on' + type, fn);\n        } else {\n          el.addEventListener(type, fn, false);\n        }\n      }\n\n      function debounce(func, wait, immediate) {\n        var timeout;\n        return function() {\n          var context = this,\n            args = arguments;\n          var callNow = immediate && !timeout;\n          clearTimeout(timeout);\n          timeout = setTimeout(later, wait);\n          if (callNow) func.apply(context, args);\n\n          function later() {\n            timeout = null;\n            if (!immediate) func.apply(context, args);\n          }\n        };\n      }\n\n      // https://github.com/jquery/sizzle/blob/3136f48b90e3edc84cbaaa6f6f7734ef03775a07/sizzle.js#L708\n      var contains = function() {\n        if (!global.document) {\n          return true;\n        }\n        return global.document.documentElement.compareDocumentPosition ?\n          function(a, b) {\n            return !!(a.compareDocumentPosition(b) & 16);\n          } :\n          global.document.documentElement.contains ?\n          function(a, b) {\n            return a !== b && (a.contains ? a.contains(b) : false);\n          } :\n          function(a, b) {\n            while (b = b.parentNode) {\n              if (b === a) {\n                return true;\n              }\n            }\n            return false;\n          };\n      }\n\n      function createInViewport(container) {\n        var watches = createWatches();\n\n        var scrollContainer = container === global.document.body ? global : container;\n        var debouncedCheck = debounce(watches.checkAll(watchInViewport), 15);\n\n        addEvent(scrollContainer, 'scroll', debouncedCheck);\n\n        if (scrollContainer === global) {\n          addEvent(global, 'resize', debouncedCheck);\n        }\n\n        if (supportsMutationObserver) {\n          observeDOM(watches, container, debouncedCheck);\n        }\n\n        // failsafe check, every 200ms we check for visible images\n        // usecase: a hidden parent containing eleements\n        // when the parent becomes visible, we have no event that the children\n        // became visible\n        setInterval(debouncedCheck, 150);\n\n        function isInViewport(elt, offset, cb) {\n          if (!cb) {\n            return isVisible(elt, offset);\n          }\n\n          var remote = createRemote(elt, offset, cb);\n          remote.watch();\n          return remote;\n        }\n\n        function createRemote(elt, offset, cb) {\n          function watch() {\n            watches.add(elt, offset, cb);\n          }\n\n          function dispose() {\n            watches.remove(elt);\n          }\n\n          return {\n            watch: watch,\n            dispose: dispose\n          };\n        }\n\n        function watchInViewport(elt, offset, cb) {\n          if (isVisible(elt, offset)) {\n            watches.remove(elt);\n            cb(elt);\n          }\n        }\n\n        function isVisible(elt, offset) {\n          if (!contains(global.document.documentElement, elt) || !contains(global.document.documentElement, container)) {\n            return false;\n          }\n\n          // Check if the element is visible\n          // https://github.com/jquery/jquery/blob/740e190223d19a114d5373758127285d14d6b71e/src/css/hiddenVisibleSelectors.js\n          if (!elt.offsetWidth || !elt.offsetHeight) {\n            return false;\n          }\n\n          var eltRect = elt.getBoundingClientRect();\n          var viewport = {};\n\n          if (container === global.document.body) {\n            viewport = {\n              top: -offset,\n              left: -offset,\n              right: global.document.documentElement.clientWidth + offset,\n              bottom: global.document.documentElement.clientHeight + offset\n            };\n          } else {\n            var containerRect = container.getBoundingClientRect();\n            viewport = {\n              top: containerRect.top - offset,\n              left: containerRect.left - offset,\n              right: containerRect.right + offset,\n              bottom: containerRect.bottom + offset\n            };\n          }\n\n          // The element must overlap with the visible part of the viewport\n          var visible =\n            (\n              (eltRect.right > viewport.left) &&\n              (eltRect.left < viewport.right) &&\n              (eltRect.bottom > viewport.top) &&\n              (eltRect.top < viewport.bottom)\n            );\n\n          return visible;\n        }\n\n        return {\n          container: container,\n          isInViewport: isInViewport\n        };\n      }\n\n      function createWatches() {\n        var watches = [];\n\n        function add(elt, offset, cb) {\n          if (!isWatched(elt)) {\n            watches.push([elt, offset, cb]);\n          }\n        }\n\n        function remove(elt) {\n          var pos = indexOf(elt);\n          if (pos !== -1) {\n            watches.splice(pos, 1);\n          }\n        }\n\n        function indexOf(elt) {\n          for (var i = watches.length - 1; i >= 0; i--) {\n            if (watches[i][0] === elt) {\n              return i;\n            }\n          }\n          return -1;\n        }\n\n        function isWatched(elt) {\n          return indexOf(elt) !== -1;\n        }\n\n        function checkAll(cb) {\n          return function() {\n            for (var i = watches.length - 1; i >= 0; i--) {\n              cb.apply(this, watches[i]);\n            }\n          };\n        }\n\n        return {\n          add: add,\n          remove: remove,\n          isWatched: isWatched,\n          checkAll: checkAll\n        };\n      }\n\n      function observeDOM(watches, container, cb) {\n        var observer = new MutationObserver(watch);\n        var filter = Array.prototype.filter;\n        var concat = Array.prototype.concat;\n\n        observer.observe(container, {\n          childList: true,\n          subtree: true,\n          // changes like style/width/height/display will be catched\n          attributes: true\n        });\n\n        function watch(mutations) {\n          // some new DOM nodes where previously watched\n          // we should check their positions\n          if (mutations.some(knownNodes) === true) {\n            setTimeout(cb, 0);\n          }\n        }\n\n        function knownNodes(mutation) {\n          var nodes = concat.call([],\n            Array.prototype.slice.call(mutation.addedNodes),\n            mutation.target\n          );\n          return filter.call(nodes, watches.isWatched).length > 0;\n        }\n      }\n\n      /* WEBPACK VAR INJECTION */\n    }.call(exports, (function() {\n      return this;\n    }())))\n\n    /***/\n  }\n  /******/\n]);","date":"2018-02-27T07:38:38.120Z","updated":"2018-02-27T07:38:38.120Z","path":"photos/ins.js","layout":"false","title":"","comments":1,"_id":"cje5fspey000jn8vf0rl7wy5v","content":"/******/\n(function(modules) { // webpackBootstrap\n  /******/ // The module cache\n  /******/\n  var installedModules = {};\n  /******/\n  /******/ // The require function\n  /******/\n  function __webpack_require__(moduleId) {\n    /******/\n    /******/ // Check if module is in cache\n    /******/\n    if (installedModules[moduleId])\n    /******/\n      return installedModules[moduleId].exports;\n    /******/\n    /******/ // Create a new module (and put it into the cache)\n    /******/\n    var module = installedModules[moduleId] = {\n      /******/\n      exports: {},\n      /******/\n      id: moduleId,\n      /******/\n      loaded: false\n        /******/\n    };\n    /******/\n    /******/ // Execute the module function\n    /******/\n    modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n    /******/\n    /******/ // Flag the module as loaded\n    /******/\n    module.loaded = true;\n    /******/\n    /******/ // Return the exports of the module\n    /******/\n    return module.exports;\n    /******/\n  }\n  /******/\n  /******/\n  /******/ // expose the modules object (__webpack_modules__)\n  /******/\n  __webpack_require__.m = modules;\n  /******/\n  /******/ // expose the module cache\n  /******/\n  __webpack_require__.c = installedModules;\n  /******/\n  /******/ // __webpack_public_path__\n  /******/\n  __webpack_require__.p = \"/dist/\";\n  /******/\n  /******/ // Load entry module and return exports\n  /******/\n  return __webpack_require__(0);\n  /******/\n})\n/************************************************************************/\n/******/\n([\n  /* 0 */\n  /***/\n  function(module, exports, __webpack_require__) {\n\n    'use strict';\n\n    __webpack_require__(1);\n\n    var _view = __webpack_require__(2);\n\n    var _view2 = _interopRequireDefault(_view);\n\n    function _interopRequireDefault(obj) {\n      return obj && obj.__esModule ? obj : {\n        default: obj\n      };\n    }\n\n    /**\n     * @name impush-client \n     * @description ������Ŀ���ҷ����¸���\n     * @date 2016-12-1\n     */\n\n    var _collection = [];\n    var _count = 0;\n    var searchData;\n\n    function addMask(elem) {\n      var rect = elem.getBoundingClientRect();\n      var style = getComputedStyle(elem, null);\n\n      var mask = document.createElement('i');\n      mask.className = 'icon-film';\n      mask.style.color = '#fff';\n      mask.style.fontSize = '26px';\n      mask.style.position = 'absolute';\n      mask.style.right = '10px';\n      mask.style.bottom = '10px';\n      mask.style.zIndex = 1;\n      elem.parentNode.appendChild(mask);\n    }\n\n    var createVideoIncon = function createVideoIncon() {\n      var $videoImg = document.querySelectorAll('.thumb a[data-type=\"video\"]');\n      for (var i = 0, len = $videoImg.length; i < len; i++) {\n        addMask($videoImg[i]);\n      }\n    };\n    var render = function render(res) {\n      var ulTmpl = \"\";\n      for (var j = 0, len2 = res.list.length; j < len2; j++) {\n        var data = res.list[j].arr;\n        var liTmpl = \"\";\n        for (var i = 0, len = data.link.length; i < len; i++) {\n          var minSrc = 'https://raw.githubusercontent.com/lawlite19/blog-back-up/master/min_photos/' + data.link[i];\n          var src = 'https://raw.githubusercontent.com/lawlite19/blog-back-up/master/photos/' + data.link[i];\n          var type = data.type[i];\n          var target = src + (type === 'video' ? '.mp4' : '.jpg');\n          src += '';\n\n          liTmpl += '<figure class=\"thumb\" itemprop=\"associatedMedia\" itemscope=\"\" itemtype=\"http://schema.org/ImageObject\">\\\n                <a href=\"' + src + '\" itemprop=\"contentUrl\" data-size=\"1080x1080\" data-type=\"' + type + '\" data-target=\"' + src + '\">\\\n                  <img class=\"reward-img\" data-type=\"' + type + '\" data-src=\"' + minSrc + '\" src=\"/assets/img/empty.png\" itemprop=\"thumbnail\" onload=\"lzld(this)\">\\\n                </a>\\\n                <figcaption style=\"display:none\" itemprop=\"caption description\">' + data.text[i] + '</figcaption>\\\n            </figure>';\n        }\n        ulTmpl = ulTmpl + '<section class=\"archives album\"><h1 class=\"year\">' + data.year + '��<em>' + data.month + '��</em></h1>\\\n        <ul class=\"img-box-ul\">' + liTmpl + '</ul>\\\n        </section>';\n      }\n      document.querySelector('.instagram').innerHTML = '<div class=\"photos\" itemscope=\"\" itemtype=\"http://schema.org/ImageGallery\">' + ulTmpl + '</div>';\n      createVideoIncon();\n      _view2.default.init();\n    };\n\n    var replacer = function replacer(str) {\n      var arr = str.split(\"/\");\n      return \"/assets/ins/\" + arr[arr.length - 1];\n    };\n\n    var ctrler = function ctrler(data) {\n      var imgObj = {};\n      for (var i = 0, len = data.length; i < len; i++) {\n        var y = data[i].y;\n        var m = data[i].m;\n        var src = replacer(data[i].src);\n        var text = data[i].text;\n        var key = y + \"\" + ((m + \"\").length == 1 ? \"0\" + m : m);\n        if (imgObj[key]) {\n          imgObj[key].srclist.push(src);\n          imgObj[key].text.push(text);\n        } else {\n          imgObj[key] = {\n            year: y,\n            month: m,\n            srclist: [src],\n            text: [text]\n          };\n        }\n      }\n      render(imgObj);\n    };\n\n    function loadData(success) {\n      if (!searchData) {\n        var xhr = new XMLHttpRequest();\n        xhr.open('GET', './data.json?t=' + +new Date(), true);\n\n        xhr.onload = function() {\n          if (this.status >= 200 && this.status < 300) {\n            var res = JSON.parse(this.response);\n            searchData = res;\n            success(searchData);\n          } else {\n            console.error(this.statusText);\n          }\n        };\n\n        xhr.onerror = function() {\n          console.error(this.statusText);\n        };\n\n        xhr.send();\n      } else {\n        success(searchData);\n      }\n    }\n\n    var Ins = {\n      init: function init() {\n        loadData(function(data) {\n          render(data);\n        });\n      }\n    };\n\n    Ins.init();\n\n    // export default impush;\n\n    /***/\n  },\n  /* 1 */\n  /***/\n  function(module, exports, __webpack_require__) {\n\n    /* WEBPACK VAR INJECTION */\n    (function(global) {\n      'use strict';\n\n      var inViewport = __webpack_require__(3);\n      var lazyAttrs = ['data-src'];\n\n      global.lzld = lazyload();\n\n      // Provide libs using getAttribute early to get the good src\n      // and not the fake data-src\n      replaceGetAttribute('Image');\n      replaceGetAttribute('IFrame');\n\n      function registerLazyAttr(attr) {\n        if (indexOf.call(lazyAttrs, attr) === -1) {\n          lazyAttrs.push(attr);\n        }\n      }\n\n      function lazyload(opts) {\n        opts = merge({\n          'offset': 333,\n          'src': 'data-src',\n          'container': false\n        }, opts || {});\n\n        if (typeof opts.src === 'string') {\n          registerLazyAttr(opts.src);\n        }\n\n        var elts = [];\n\n        function show(elt) {\n          var src = findRealSrc(elt);\n\n          if (src) {\n            elt.src = src;\n          }\n\n          elt.setAttribute('data-lzled', true);\n          elts[indexOf.call(elts, elt)] = null;\n        }\n\n        function findRealSrc(elt) {\n          if (typeof opts.src === 'function') {\n            return opts.src(elt);\n          }\n\n          return elt.getAttribute(opts.src);\n        }\n\n        function register(elt) {\n          elt.onload = null;\n          elt.removeAttribute('onload');\n          elt.onerror = null;\n          elt.removeAttribute('onerror');\n\n          if (indexOf.call(elts, elt) === -1) {\n            inViewport(elt, opts, show);\n          }\n        }\n\n        return register;\n      }\n\n      function replaceGetAttribute(elementName) {\n        var fullname = 'HTML' + elementName + 'Element';\n        if (fullname in global === false) {\n          return;\n        }\n\n        var original = global[fullname].prototype.getAttribute;\n        global[fullname].prototype.getAttribute = function(name) {\n          if (name === 'src') {\n            var realSrc;\n            for (var i = 0, max = lazyAttrs.length; i < max; i++) {\n              realSrc = original.call(this, lazyAttrs[i]);\n              if (realSrc) {\n                break;\n              }\n            }\n\n            return realSrc || original.call(this, name);\n          }\n\n          // our own lazyloader will go through theses lines\n          // because we use getAttribute(opts.src)\n          return original.call(this, name);\n        };\n      }\n\n      function merge(defaults, opts) {\n        for (var name in defaults) {\n          if (opts[name] === undefined) {\n            opts[name] = defaults[name];\n          }\n        }\n\n        return opts;\n      }\n\n      // http://webreflection.blogspot.fr/2011/06/partial-polyfills.html\n      function indexOf(value) {\n        for (var i = this.length; i-- && this[i] !== value;) {}\n        return i;\n      }\n\n      module.exports = lazyload;\n\n      // export default impush;\n      /* WEBPACK VAR INJECTION */\n    }.call(exports, (function() {\n      return this;\n    }())))\n\n    /***/\n  },\n  /* 2 */\n  /***/\n  function(module, exports) {\n\n    'use strict';\n\n    var initPhotoSwipeFromDOM = function initPhotoSwipeFromDOM(gallerySelector) {\n\n      // parse slide data (url, title, size ...) from DOM elements \n      // (children of gallerySelector)\n      var parseThumbnailElements = function parseThumbnailElements(el) {\n        el = el.parentNode.parentNode;\n        var thumbElements = el.getElementsByClassName('thumb'),\n          numNodes = thumbElements.length,\n          items = [],\n          figureEl,\n          linkEl,\n          size,\n          type,\n          // video or not\n          target,\n          item;\n\n        for (var i = 0; i < numNodes; i++) {\n\n          figureEl = thumbElements[i]; // \n\n          // include only element nodes \n          if (figureEl.nodeType !== 1) {\n            continue;\n          }\n\n          linkEl = figureEl.children[0]; // \n\n          size = linkEl.getAttribute('data-size').split('x');\n          type = linkEl.getAttribute('data-type');\n          target = linkEl.getAttribute('data-target');\n          // create slide object\n          item = {\n            src: linkEl.getAttribute('href'),\n            w: parseInt(size[0], 10),\n            h: parseInt(size[1], 10)\n          };\n\n          if (figureEl.children.length > 1) {\n            item.title = figureEl.children[1].innerHTML;\n          }\n\n          if (linkEl.children.length > 0) {\n            item.msrc = linkEl.children[0].getAttribute('src');\n            item.type = type;\n            item.target = target;\n            item.html = '<video src=\"' + target + '\" controls=\"controls\" autoplay=\"autoplay\"></video>';\n            if (type === 'video') {\n              //item.src = null;\n            }\n          }\n\n          item.el = figureEl; // save link to element for getThumbBoundsFn\n          items.push(item);\n        }\n\n        return items;\n      };\n\n      // find nearest parent element\n      var closest = function closest(el, fn) {\n        return el && (fn(el) ? el : closest(el.parentNode, fn));\n      };\n\n      // triggers when user clicks on thumbnail\n      var onThumbnailsClick = function onThumbnailsClick(e) {\n        e = e || window.event;\n        e.preventDefault ? e.preventDefault() : e.returnValue = false;\n\n        var eTarget = e.target || e.srcElement;\n\n        // find root element of slide\n        var clickedListItem = closest(eTarget, function(el) {\n          return el.tagName && el.tagName.toUpperCase() === 'FIGURE';\n        });\n\n        if (!clickedListItem) {\n          return;\n        }\n\n        // find index of clicked item by looping through all child nodes\n        // alternatively, you may define index via data- attribute\n        var clickedGallery = clickedListItem.parentNode,\n\n          // childNodes = clickedListItem.parentNode.childNodes,\n          // numChildNodes = childNodes.length,\n          childNodes = document.getElementsByClassName('thumb'),\n          numChildNodes = childNodes.length,\n          nodeIndex = 0,\n          index;\n\n        for (var i = 0; i < numChildNodes; i++) {\n          if (childNodes[i].nodeType !== 1) {\n            continue;\n          }\n\n          if (childNodes[i] === clickedListItem) {\n            index = nodeIndex;\n            break;\n          }\n          nodeIndex++;\n        }\n\n        if (index >= 0) {\n          // open PhotoSwipe if valid index found\n          openPhotoSwipe(index, clickedGallery);\n        }\n        return false;\n      };\n\n      // parse picture index and gallery index from URL (#&pid=1&gid=2)\n      var photoswipeParseHash = function photoswipeParseHash() {\n        var hash = window.location.hash.substring(1),\n          params = {};\n\n        if (hash.length < 5) {\n          return params;\n        }\n\n        var vars = hash.split('&');\n        for (var i = 0; i < vars.length; i++) {\n          if (!vars[i]) {\n            continue;\n          }\n          var pair = vars[i].split('=');\n          if (pair.length < 2) {\n            continue;\n          }\n          params[pair[0]] = pair[1];\n        }\n\n        if (params.gid) {\n          params.gid = parseInt(params.gid, 10);\n        }\n\n        return params;\n      };\n\n      var openPhotoSwipe = function openPhotoSwipe(index, galleryElement, disableAnimation, fromURL) {\n        var pswpElement = document.querySelectorAll('.pswp')[0],\n          gallery,\n          options,\n          items;\n\n        items = parseThumbnailElements(galleryElement);\n        // define options (if needed)\n        options = {\n\n          // define gallery index (for URL)\n          galleryUID: galleryElement.getAttribute('data-pswp-uid'),\n\n          getThumbBoundsFn: function getThumbBoundsFn(index) {\n            // See Options -> getThumbBoundsFn section of documentation for more info\n            var thumbnail = items[index].el.getElementsByTagName('img')[0],\n              // find thumbnail\n              pageYScroll = window.pageYOffset || document.documentElement.scrollTop,\n              rect = thumbnail.getBoundingClientRect();\n\n            return {\n              x: rect.left,\n              y: rect.top + pageYScroll,\n              w: rect.width\n            };\n          }\n\n        };\n\n        // PhotoSwipe opened from URL\n        if (fromURL) {\n          if (options.galleryPIDs) {\n            // parse real index when custom PIDs are used \n            // http://photoswipe.com/documentation/faq.html#custom-pid-in-url\n            for (var j = 0; j < items.length; j++) {\n              if (items[j].pid == index) {\n                options.index = j;\n                break;\n              }\n            }\n          } else {\n            // in URL indexes start from 1\n            options.index = parseInt(index, 10) - 1;\n          }\n        } else {\n          options.index = parseInt(index, 10);\n        }\n\n        // exit if index not found\n        if (isNaN(options.index)) {\n          return;\n        }\n\n        if (disableAnimation) {\n          options.showAnimationDuration = 0;\n        }\n\n        // Pass data to PhotoSwipe and initialize it\n        gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);\n        gallery.init();\n\n        var $tempVideo;\n        var stopVideoHandle = function stopVideoHandle() {\n          if ($tempVideo) {\n            $tempVideo.remove();\n            $tempVideo = null;\n          }\n        };\n        var changeHandle = function changeHandle() {\n          var item = gallery.currItem;\n          stopVideoHandle();\n          if (item.type === 'video') {\n            var $ctn = item.container;\n            var style = $ctn.getElementsByClassName('pswp__img')[0].style;\n            var $video = document.createElement('video');\n            $video.setAttribute('autoplay', 'autoplay');\n            $video.setAttribute('controls', 'controls');\n            $video.setAttribute('src', item.target);\n            $video.style.width = style.width;\n            $video.style.height = style.height;\n            $video.style.position = 'absolute';\n            $video.style.zIndex = 2;\n            $tempVideo = $video;\n            $ctn.appendChild($video);\n          }\n        };\n        gallery.listen('initialZoomIn', changeHandle);\n        gallery.listen('afterChange', changeHandle);\n        gallery.listen('initialZoomOut', stopVideoHandle);\n      };\n\n      // loop through all gallery elements and bind events\n      var galleryElements = document.querySelectorAll(gallerySelector);\n      for (var i = 0, l = galleryElements.length; i < l; i++) {\n        galleryElements[i].setAttribute('data-pswp-uid', i + 1);\n        galleryElements[i].onclick = onThumbnailsClick;\n      }\n\n      // Parse URL and open gallery if it contains #&pid=3&gid=1\n      var hashData = photoswipeParseHash();\n      if (hashData.pid && hashData.gid) {\n        openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);\n      }\n    };\n\n    var Viewer = function() {\n      function init() {\n        initPhotoSwipeFromDOM('.photos');\n      }\n      return {\n        init: init\n      };\n    }();\n\n    module.exports = Viewer;\n\n    /***/\n  },\n  /* 3 */\n  /***/\n  function(module, exports) {\n\n    /* WEBPACK VAR INJECTION */\n    (function(global) {\n      module.exports = inViewport;\n\n      var instances = [];\n      var supportsMutationObserver = typeof global.MutationObserver === 'function';\n\n      function inViewport(elt, params, cb) {\n        var opts = {\n          container: global.document.body,\n          offset: 0\n        };\n\n        if (params === undefined || typeof params === 'function') {\n          cb = params;\n          params = {};\n        }\n\n        var container = opts.container = params.container || opts.container;\n        var offset = opts.offset = params.offset || opts.offset;\n\n        for (var i = 0; i < instances.length; i++) {\n          if (instances[i].container === container) {\n            return instances[i].isInViewport(elt, offset, cb);\n          }\n        }\n\n        return instances[\n          instances.push(createInViewport(container)) - 1\n        ].isInViewport(elt, offset, cb);\n      }\n\n      function addEvent(el, type, fn) {\n        if (el.attachEvent) {\n          el.attachEvent('on' + type, fn);\n        } else {\n          el.addEventListener(type, fn, false);\n        }\n      }\n\n      function debounce(func, wait, immediate) {\n        var timeout;\n        return function() {\n          var context = this,\n            args = arguments;\n          var callNow = immediate && !timeout;\n          clearTimeout(timeout);\n          timeout = setTimeout(later, wait);\n          if (callNow) func.apply(context, args);\n\n          function later() {\n            timeout = null;\n            if (!immediate) func.apply(context, args);\n          }\n        };\n      }\n\n      // https://github.com/jquery/sizzle/blob/3136f48b90e3edc84cbaaa6f6f7734ef03775a07/sizzle.js#L708\n      var contains = function() {\n        if (!global.document) {\n          return true;\n        }\n        return global.document.documentElement.compareDocumentPosition ?\n          function(a, b) {\n            return !!(a.compareDocumentPosition(b) & 16);\n          } :\n          global.document.documentElement.contains ?\n          function(a, b) {\n            return a !== b && (a.contains ? a.contains(b) : false);\n          } :\n          function(a, b) {\n            while (b = b.parentNode) {\n              if (b === a) {\n                return true;\n              }\n            }\n            return false;\n          };\n      }\n\n      function createInViewport(container) {\n        var watches = createWatches();\n\n        var scrollContainer = container === global.document.body ? global : container;\n        var debouncedCheck = debounce(watches.checkAll(watchInViewport), 15);\n\n        addEvent(scrollContainer, 'scroll', debouncedCheck);\n\n        if (scrollContainer === global) {\n          addEvent(global, 'resize', debouncedCheck);\n        }\n\n        if (supportsMutationObserver) {\n          observeDOM(watches, container, debouncedCheck);\n        }\n\n        // failsafe check, every 200ms we check for visible images\n        // usecase: a hidden parent containing eleements\n        // when the parent becomes visible, we have no event that the children\n        // became visible\n        setInterval(debouncedCheck, 150);\n\n        function isInViewport(elt, offset, cb) {\n          if (!cb) {\n            return isVisible(elt, offset);\n          }\n\n          var remote = createRemote(elt, offset, cb);\n          remote.watch();\n          return remote;\n        }\n\n        function createRemote(elt, offset, cb) {\n          function watch() {\n            watches.add(elt, offset, cb);\n          }\n\n          function dispose() {\n            watches.remove(elt);\n          }\n\n          return {\n            watch: watch,\n            dispose: dispose\n          };\n        }\n\n        function watchInViewport(elt, offset, cb) {\n          if (isVisible(elt, offset)) {\n            watches.remove(elt);\n            cb(elt);\n          }\n        }\n\n        function isVisible(elt, offset) {\n          if (!contains(global.document.documentElement, elt) || !contains(global.document.documentElement, container)) {\n            return false;\n          }\n\n          // Check if the element is visible\n          // https://github.com/jquery/jquery/blob/740e190223d19a114d5373758127285d14d6b71e/src/css/hiddenVisibleSelectors.js\n          if (!elt.offsetWidth || !elt.offsetHeight) {\n            return false;\n          }\n\n          var eltRect = elt.getBoundingClientRect();\n          var viewport = {};\n\n          if (container === global.document.body) {\n            viewport = {\n              top: -offset,\n              left: -offset,\n              right: global.document.documentElement.clientWidth + offset,\n              bottom: global.document.documentElement.clientHeight + offset\n            };\n          } else {\n            var containerRect = container.getBoundingClientRect();\n            viewport = {\n              top: containerRect.top - offset,\n              left: containerRect.left - offset,\n              right: containerRect.right + offset,\n              bottom: containerRect.bottom + offset\n            };\n          }\n\n          // The element must overlap with the visible part of the viewport\n          var visible =\n            (\n              (eltRect.right > viewport.left) &&\n              (eltRect.left < viewport.right) &&\n              (eltRect.bottom > viewport.top) &&\n              (eltRect.top < viewport.bottom)\n            );\n\n          return visible;\n        }\n\n        return {\n          container: container,\n          isInViewport: isInViewport\n        };\n      }\n\n      function createWatches() {\n        var watches = [];\n\n        function add(elt, offset, cb) {\n          if (!isWatched(elt)) {\n            watches.push([elt, offset, cb]);\n          }\n        }\n\n        function remove(elt) {\n          var pos = indexOf(elt);\n          if (pos !== -1) {\n            watches.splice(pos, 1);\n          }\n        }\n\n        function indexOf(elt) {\n          for (var i = watches.length - 1; i >= 0; i--) {\n            if (watches[i][0] === elt) {\n              return i;\n            }\n          }\n          return -1;\n        }\n\n        function isWatched(elt) {\n          return indexOf(elt) !== -1;\n        }\n\n        function checkAll(cb) {\n          return function() {\n            for (var i = watches.length - 1; i >= 0; i--) {\n              cb.apply(this, watches[i]);\n            }\n          };\n        }\n\n        return {\n          add: add,\n          remove: remove,\n          isWatched: isWatched,\n          checkAll: checkAll\n        };\n      }\n\n      function observeDOM(watches, container, cb) {\n        var observer = new MutationObserver(watch);\n        var filter = Array.prototype.filter;\n        var concat = Array.prototype.concat;\n\n        observer.observe(container, {\n          childList: true,\n          subtree: true,\n          // changes like style/width/height/display will be catched\n          attributes: true\n        });\n\n        function watch(mutations) {\n          // some new DOM nodes where previously watched\n          // we should check their positions\n          if (mutations.some(knownNodes) === true) {\n            setTimeout(cb, 0);\n          }\n        }\n\n        function knownNodes(mutation) {\n          var nodes = concat.call([],\n            Array.prototype.slice.call(mutation.addedNodes),\n            mutation.target\n          );\n          return filter.call(nodes, watches.isWatched).length > 0;\n        }\n      }\n\n      /* WEBPACK VAR INJECTION */\n    }.call(exports, (function() {\n      return this;\n    }())))\n\n    /***/\n  }\n  /******/\n]);","site":{"data":{}},"excerpt":"","more":"/******/\n(function(modules) { // webpackBootstrap\n  /******/ // The module cache\n  /******/\n  var installedModules = {};\n  /******/\n  /******/ // The require function\n  /******/\n  function __webpack_require__(moduleId) {\n    /******/\n    /******/ // Check if module is in cache\n    /******/\n    if (installedModules[moduleId])\n    /******/\n      return installedModules[moduleId].exports;\n    /******/\n    /******/ // Create a new module (and put it into the cache)\n    /******/\n    var module = installedModules[moduleId] = {\n      /******/\n      exports: {},\n      /******/\n      id: moduleId,\n      /******/\n      loaded: false\n        /******/\n    };\n    /******/\n    /******/ // Execute the module function\n    /******/\n    modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n    /******/\n    /******/ // Flag the module as loaded\n    /******/\n    module.loaded = true;\n    /******/\n    /******/ // Return the exports of the module\n    /******/\n    return module.exports;\n    /******/\n  }\n  /******/\n  /******/\n  /******/ // expose the modules object (__webpack_modules__)\n  /******/\n  __webpack_require__.m = modules;\n  /******/\n  /******/ // expose the module cache\n  /******/\n  __webpack_require__.c = installedModules;\n  /******/\n  /******/ // __webpack_public_path__\n  /******/\n  __webpack_require__.p = \"/dist/\";\n  /******/\n  /******/ // Load entry module and return exports\n  /******/\n  return __webpack_require__(0);\n  /******/\n})\n/************************************************************************/\n/******/\n([\n  /* 0 */\n  /***/\n  function(module, exports, __webpack_require__) {\n\n    'use strict';\n\n    __webpack_require__(1);\n\n    var _view = __webpack_require__(2);\n\n    var _view2 = _interopRequireDefault(_view);\n\n    function _interopRequireDefault(obj) {\n      return obj && obj.__esModule ? obj : {\n        default: obj\n      };\n    }\n\n    /**\n     * @name impush-client \n     * @description ������Ŀ���ҷ����¸���\n     * @date 2016-12-1\n     */\n\n    var _collection = [];\n    var _count = 0;\n    var searchData;\n\n    function addMask(elem) {\n      var rect = elem.getBoundingClientRect();\n      var style = getComputedStyle(elem, null);\n\n      var mask = document.createElement('i');\n      mask.className = 'icon-film';\n      mask.style.color = '#fff';\n      mask.style.fontSize = '26px';\n      mask.style.position = 'absolute';\n      mask.style.right = '10px';\n      mask.style.bottom = '10px';\n      mask.style.zIndex = 1;\n      elem.parentNode.appendChild(mask);\n    }\n\n    var createVideoIncon = function createVideoIncon() {\n      var $videoImg = document.querySelectorAll('.thumb a[data-type=\"video\"]');\n      for (var i = 0, len = $videoImg.length; i < len; i++) {\n        addMask($videoImg[i]);\n      }\n    };\n    var render = function render(res) {\n      var ulTmpl = \"\";\n      for (var j = 0, len2 = res.list.length; j < len2; j++) {\n        var data = res.list[j].arr;\n        var liTmpl = \"\";\n        for (var i = 0, len = data.link.length; i < len; i++) {\n          var minSrc = 'https://raw.githubusercontent.com/lawlite19/blog-back-up/master/min_photos/' + data.link[i];\n          var src = 'https://raw.githubusercontent.com/lawlite19/blog-back-up/master/photos/' + data.link[i];\n          var type = data.type[i];\n          var target = src + (type === 'video' ? '.mp4' : '.jpg');\n          src += '';\n\n          liTmpl += '<figure class=\"thumb\" itemprop=\"associatedMedia\" itemscope=\"\" itemtype=\"http://schema.org/ImageObject\">\\\n                <a href=\"' + src + '\" itemprop=\"contentUrl\" data-size=\"1080x1080\" data-type=\"' + type + '\" data-target=\"' + src + '\">\\\n                  <img class=\"reward-img\" data-type=\"' + type + '\" data-src=\"' + minSrc + '\" src=\"/assets/img/empty.png\" itemprop=\"thumbnail\" onload=\"lzld(this)\">\\\n                </a>\\\n                <figcaption style=\"display:none\" itemprop=\"caption description\">' + data.text[i] + '</figcaption>\\\n            </figure>';\n        }\n        ulTmpl = ulTmpl + '<section class=\"archives album\"><h1 class=\"year\">' + data.year + '��<em>' + data.month + '��</em></h1>\\\n        <ul class=\"img-box-ul\">' + liTmpl + '</ul>\\\n        </section>';\n      }\n      document.querySelector('.instagram').innerHTML = '<div class=\"photos\" itemscope=\"\" itemtype=\"http://schema.org/ImageGallery\">' + ulTmpl + '</div>';\n      createVideoIncon();\n      _view2.default.init();\n    };\n\n    var replacer = function replacer(str) {\n      var arr = str.split(\"/\");\n      return \"/assets/ins/\" + arr[arr.length - 1];\n    };\n\n    var ctrler = function ctrler(data) {\n      var imgObj = {};\n      for (var i = 0, len = data.length; i < len; i++) {\n        var y = data[i].y;\n        var m = data[i].m;\n        var src = replacer(data[i].src);\n        var text = data[i].text;\n        var key = y + \"\" + ((m + \"\").length == 1 ? \"0\" + m : m);\n        if (imgObj[key]) {\n          imgObj[key].srclist.push(src);\n          imgObj[key].text.push(text);\n        } else {\n          imgObj[key] = {\n            year: y,\n            month: m,\n            srclist: [src],\n            text: [text]\n          };\n        }\n      }\n      render(imgObj);\n    };\n\n    function loadData(success) {\n      if (!searchData) {\n        var xhr = new XMLHttpRequest();\n        xhr.open('GET', './data.json?t=' + +new Date(), true);\n\n        xhr.onload = function() {\n          if (this.status >= 200 && this.status < 300) {\n            var res = JSON.parse(this.response);\n            searchData = res;\n            success(searchData);\n          } else {\n            console.error(this.statusText);\n          }\n        };\n\n        xhr.onerror = function() {\n          console.error(this.statusText);\n        };\n\n        xhr.send();\n      } else {\n        success(searchData);\n      }\n    }\n\n    var Ins = {\n      init: function init() {\n        loadData(function(data) {\n          render(data);\n        });\n      }\n    };\n\n    Ins.init();\n\n    // export default impush;\n\n    /***/\n  },\n  /* 1 */\n  /***/\n  function(module, exports, __webpack_require__) {\n\n    /* WEBPACK VAR INJECTION */\n    (function(global) {\n      'use strict';\n\n      var inViewport = __webpack_require__(3);\n      var lazyAttrs = ['data-src'];\n\n      global.lzld = lazyload();\n\n      // Provide libs using getAttribute early to get the good src\n      // and not the fake data-src\n      replaceGetAttribute('Image');\n      replaceGetAttribute('IFrame');\n\n      function registerLazyAttr(attr) {\n        if (indexOf.call(lazyAttrs, attr) === -1) {\n          lazyAttrs.push(attr);\n        }\n      }\n\n      function lazyload(opts) {\n        opts = merge({\n          'offset': 333,\n          'src': 'data-src',\n          'container': false\n        }, opts || {});\n\n        if (typeof opts.src === 'string') {\n          registerLazyAttr(opts.src);\n        }\n\n        var elts = [];\n\n        function show(elt) {\n          var src = findRealSrc(elt);\n\n          if (src) {\n            elt.src = src;\n          }\n\n          elt.setAttribute('data-lzled', true);\n          elts[indexOf.call(elts, elt)] = null;\n        }\n\n        function findRealSrc(elt) {\n          if (typeof opts.src === 'function') {\n            return opts.src(elt);\n          }\n\n          return elt.getAttribute(opts.src);\n        }\n\n        function register(elt) {\n          elt.onload = null;\n          elt.removeAttribute('onload');\n          elt.onerror = null;\n          elt.removeAttribute('onerror');\n\n          if (indexOf.call(elts, elt) === -1) {\n            inViewport(elt, opts, show);\n          }\n        }\n\n        return register;\n      }\n\n      function replaceGetAttribute(elementName) {\n        var fullname = 'HTML' + elementName + 'Element';\n        if (fullname in global === false) {\n          return;\n        }\n\n        var original = global[fullname].prototype.getAttribute;\n        global[fullname].prototype.getAttribute = function(name) {\n          if (name === 'src') {\n            var realSrc;\n            for (var i = 0, max = lazyAttrs.length; i < max; i++) {\n              realSrc = original.call(this, lazyAttrs[i]);\n              if (realSrc) {\n                break;\n              }\n            }\n\n            return realSrc || original.call(this, name);\n          }\n\n          // our own lazyloader will go through theses lines\n          // because we use getAttribute(opts.src)\n          return original.call(this, name);\n        };\n      }\n\n      function merge(defaults, opts) {\n        for (var name in defaults) {\n          if (opts[name] === undefined) {\n            opts[name] = defaults[name];\n          }\n        }\n\n        return opts;\n      }\n\n      // http://webreflection.blogspot.fr/2011/06/partial-polyfills.html\n      function indexOf(value) {\n        for (var i = this.length; i-- && this[i] !== value;) {}\n        return i;\n      }\n\n      module.exports = lazyload;\n\n      // export default impush;\n      /* WEBPACK VAR INJECTION */\n    }.call(exports, (function() {\n      return this;\n    }())))\n\n    /***/\n  },\n  /* 2 */\n  /***/\n  function(module, exports) {\n\n    'use strict';\n\n    var initPhotoSwipeFromDOM = function initPhotoSwipeFromDOM(gallerySelector) {\n\n      // parse slide data (url, title, size ...) from DOM elements \n      // (children of gallerySelector)\n      var parseThumbnailElements = function parseThumbnailElements(el) {\n        el = el.parentNode.parentNode;\n        var thumbElements = el.getElementsByClassName('thumb'),\n          numNodes = thumbElements.length,\n          items = [],\n          figureEl,\n          linkEl,\n          size,\n          type,\n          // video or not\n          target,\n          item;\n\n        for (var i = 0; i < numNodes; i++) {\n\n          figureEl = thumbElements[i]; // \n\n          // include only element nodes \n          if (figureEl.nodeType !== 1) {\n            continue;\n          }\n\n          linkEl = figureEl.children[0]; // \n\n          size = linkEl.getAttribute('data-size').split('x');\n          type = linkEl.getAttribute('data-type');\n          target = linkEl.getAttribute('data-target');\n          // create slide object\n          item = {\n            src: linkEl.getAttribute('href'),\n            w: parseInt(size[0], 10),\n            h: parseInt(size[1], 10)\n          };\n\n          if (figureEl.children.length > 1) {\n            item.title = figureEl.children[1].innerHTML;\n          }\n\n          if (linkEl.children.length > 0) {\n            item.msrc = linkEl.children[0].getAttribute('src');\n            item.type = type;\n            item.target = target;\n            item.html = '<video src=\"' + target + '\" controls=\"controls\" autoplay=\"autoplay\"></video>';\n            if (type === 'video') {\n              //item.src = null;\n            }\n          }\n\n          item.el = figureEl; // save link to element for getThumbBoundsFn\n          items.push(item);\n        }\n\n        return items;\n      };\n\n      // find nearest parent element\n      var closest = function closest(el, fn) {\n        return el && (fn(el) ? el : closest(el.parentNode, fn));\n      };\n\n      // triggers when user clicks on thumbnail\n      var onThumbnailsClick = function onThumbnailsClick(e) {\n        e = e || window.event;\n        e.preventDefault ? e.preventDefault() : e.returnValue = false;\n\n        var eTarget = e.target || e.srcElement;\n\n        // find root element of slide\n        var clickedListItem = closest(eTarget, function(el) {\n          return el.tagName && el.tagName.toUpperCase() === 'FIGURE';\n        });\n\n        if (!clickedListItem) {\n          return;\n        }\n\n        // find index of clicked item by looping through all child nodes\n        // alternatively, you may define index via data- attribute\n        var clickedGallery = clickedListItem.parentNode,\n\n          // childNodes = clickedListItem.parentNode.childNodes,\n          // numChildNodes = childNodes.length,\n          childNodes = document.getElementsByClassName('thumb'),\n          numChildNodes = childNodes.length,\n          nodeIndex = 0,\n          index;\n\n        for (var i = 0; i < numChildNodes; i++) {\n          if (childNodes[i].nodeType !== 1) {\n            continue;\n          }\n\n          if (childNodes[i] === clickedListItem) {\n            index = nodeIndex;\n            break;\n          }\n          nodeIndex++;\n        }\n\n        if (index >= 0) {\n          // open PhotoSwipe if valid index found\n          openPhotoSwipe(index, clickedGallery);\n        }\n        return false;\n      };\n\n      // parse picture index and gallery index from URL (#&pid=1&gid=2)\n      var photoswipeParseHash = function photoswipeParseHash() {\n        var hash = window.location.hash.substring(1),\n          params = {};\n\n        if (hash.length < 5) {\n          return params;\n        }\n\n        var vars = hash.split('&');\n        for (var i = 0; i < vars.length; i++) {\n          if (!vars[i]) {\n            continue;\n          }\n          var pair = vars[i].split('=');\n          if (pair.length < 2) {\n            continue;\n          }\n          params[pair[0]] = pair[1];\n        }\n\n        if (params.gid) {\n          params.gid = parseInt(params.gid, 10);\n        }\n\n        return params;\n      };\n\n      var openPhotoSwipe = function openPhotoSwipe(index, galleryElement, disableAnimation, fromURL) {\n        var pswpElement = document.querySelectorAll('.pswp')[0],\n          gallery,\n          options,\n          items;\n\n        items = parseThumbnailElements(galleryElement);\n        // define options (if needed)\n        options = {\n\n          // define gallery index (for URL)\n          galleryUID: galleryElement.getAttribute('data-pswp-uid'),\n\n          getThumbBoundsFn: function getThumbBoundsFn(index) {\n            // See Options -> getThumbBoundsFn section of documentation for more info\n            var thumbnail = items[index].el.getElementsByTagName('img')[0],\n              // find thumbnail\n              pageYScroll = window.pageYOffset || document.documentElement.scrollTop,\n              rect = thumbnail.getBoundingClientRect();\n\n            return {\n              x: rect.left,\n              y: rect.top + pageYScroll,\n              w: rect.width\n            };\n          }\n\n        };\n\n        // PhotoSwipe opened from URL\n        if (fromURL) {\n          if (options.galleryPIDs) {\n            // parse real index when custom PIDs are used \n            // http://photoswipe.com/documentation/faq.html#custom-pid-in-url\n            for (var j = 0; j < items.length; j++) {\n              if (items[j].pid == index) {\n                options.index = j;\n                break;\n              }\n            }\n          } else {\n            // in URL indexes start from 1\n            options.index = parseInt(index, 10) - 1;\n          }\n        } else {\n          options.index = parseInt(index, 10);\n        }\n\n        // exit if index not found\n        if (isNaN(options.index)) {\n          return;\n        }\n\n        if (disableAnimation) {\n          options.showAnimationDuration = 0;\n        }\n\n        // Pass data to PhotoSwipe and initialize it\n        gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);\n        gallery.init();\n\n        var $tempVideo;\n        var stopVideoHandle = function stopVideoHandle() {\n          if ($tempVideo) {\n            $tempVideo.remove();\n            $tempVideo = null;\n          }\n        };\n        var changeHandle = function changeHandle() {\n          var item = gallery.currItem;\n          stopVideoHandle();\n          if (item.type === 'video') {\n            var $ctn = item.container;\n            var style = $ctn.getElementsByClassName('pswp__img')[0].style;\n            var $video = document.createElement('video');\n            $video.setAttribute('autoplay', 'autoplay');\n            $video.setAttribute('controls', 'controls');\n            $video.setAttribute('src', item.target);\n            $video.style.width = style.width;\n            $video.style.height = style.height;\n            $video.style.position = 'absolute';\n            $video.style.zIndex = 2;\n            $tempVideo = $video;\n            $ctn.appendChild($video);\n          }\n        };\n        gallery.listen('initialZoomIn', changeHandle);\n        gallery.listen('afterChange', changeHandle);\n        gallery.listen('initialZoomOut', stopVideoHandle);\n      };\n\n      // loop through all gallery elements and bind events\n      var galleryElements = document.querySelectorAll(gallerySelector);\n      for (var i = 0, l = galleryElements.length; i < l; i++) {\n        galleryElements[i].setAttribute('data-pswp-uid', i + 1);\n        galleryElements[i].onclick = onThumbnailsClick;\n      }\n\n      // Parse URL and open gallery if it contains #&pid=3&gid=1\n      var hashData = photoswipeParseHash();\n      if (hashData.pid && hashData.gid) {\n        openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);\n      }\n    };\n\n    var Viewer = function() {\n      function init() {\n        initPhotoSwipeFromDOM('.photos');\n      }\n      return {\n        init: init\n      };\n    }();\n\n    module.exports = Viewer;\n\n    /***/\n  },\n  /* 3 */\n  /***/\n  function(module, exports) {\n\n    /* WEBPACK VAR INJECTION */\n    (function(global) {\n      module.exports = inViewport;\n\n      var instances = [];\n      var supportsMutationObserver = typeof global.MutationObserver === 'function';\n\n      function inViewport(elt, params, cb) {\n        var opts = {\n          container: global.document.body,\n          offset: 0\n        };\n\n        if (params === undefined || typeof params === 'function') {\n          cb = params;\n          params = {};\n        }\n\n        var container = opts.container = params.container || opts.container;\n        var offset = opts.offset = params.offset || opts.offset;\n\n        for (var i = 0; i < instances.length; i++) {\n          if (instances[i].container === container) {\n            return instances[i].isInViewport(elt, offset, cb);\n          }\n        }\n\n        return instances[\n          instances.push(createInViewport(container)) - 1\n        ].isInViewport(elt, offset, cb);\n      }\n\n      function addEvent(el, type, fn) {\n        if (el.attachEvent) {\n          el.attachEvent('on' + type, fn);\n        } else {\n          el.addEventListener(type, fn, false);\n        }\n      }\n\n      function debounce(func, wait, immediate) {\n        var timeout;\n        return function() {\n          var context = this,\n            args = arguments;\n          var callNow = immediate && !timeout;\n          clearTimeout(timeout);\n          timeout = setTimeout(later, wait);\n          if (callNow) func.apply(context, args);\n\n          function later() {\n            timeout = null;\n            if (!immediate) func.apply(context, args);\n          }\n        };\n      }\n\n      // https://github.com/jquery/sizzle/blob/3136f48b90e3edc84cbaaa6f6f7734ef03775a07/sizzle.js#L708\n      var contains = function() {\n        if (!global.document) {\n          return true;\n        }\n        return global.document.documentElement.compareDocumentPosition ?\n          function(a, b) {\n            return !!(a.compareDocumentPosition(b) & 16);\n          } :\n          global.document.documentElement.contains ?\n          function(a, b) {\n            return a !== b && (a.contains ? a.contains(b) : false);\n          } :\n          function(a, b) {\n            while (b = b.parentNode) {\n              if (b === a) {\n                return true;\n              }\n            }\n            return false;\n          };\n      }\n\n      function createInViewport(container) {\n        var watches = createWatches();\n\n        var scrollContainer = container === global.document.body ? global : container;\n        var debouncedCheck = debounce(watches.checkAll(watchInViewport), 15);\n\n        addEvent(scrollContainer, 'scroll', debouncedCheck);\n\n        if (scrollContainer === global) {\n          addEvent(global, 'resize', debouncedCheck);\n        }\n\n        if (supportsMutationObserver) {\n          observeDOM(watches, container, debouncedCheck);\n        }\n\n        // failsafe check, every 200ms we check for visible images\n        // usecase: a hidden parent containing eleements\n        // when the parent becomes visible, we have no event that the children\n        // became visible\n        setInterval(debouncedCheck, 150);\n\n        function isInViewport(elt, offset, cb) {\n          if (!cb) {\n            return isVisible(elt, offset);\n          }\n\n          var remote = createRemote(elt, offset, cb);\n          remote.watch();\n          return remote;\n        }\n\n        function createRemote(elt, offset, cb) {\n          function watch() {\n            watches.add(elt, offset, cb);\n          }\n\n          function dispose() {\n            watches.remove(elt);\n          }\n\n          return {\n            watch: watch,\n            dispose: dispose\n          };\n        }\n\n        function watchInViewport(elt, offset, cb) {\n          if (isVisible(elt, offset)) {\n            watches.remove(elt);\n            cb(elt);\n          }\n        }\n\n        function isVisible(elt, offset) {\n          if (!contains(global.document.documentElement, elt) || !contains(global.document.documentElement, container)) {\n            return false;\n          }\n\n          // Check if the element is visible\n          // https://github.com/jquery/jquery/blob/740e190223d19a114d5373758127285d14d6b71e/src/css/hiddenVisibleSelectors.js\n          if (!elt.offsetWidth || !elt.offsetHeight) {\n            return false;\n          }\n\n          var eltRect = elt.getBoundingClientRect();\n          var viewport = {};\n\n          if (container === global.document.body) {\n            viewport = {\n              top: -offset,\n              left: -offset,\n              right: global.document.documentElement.clientWidth + offset,\n              bottom: global.document.documentElement.clientHeight + offset\n            };\n          } else {\n            var containerRect = container.getBoundingClientRect();\n            viewport = {\n              top: containerRect.top - offset,\n              left: containerRect.left - offset,\n              right: containerRect.right + offset,\n              bottom: containerRect.bottom + offset\n            };\n          }\n\n          // The element must overlap with the visible part of the viewport\n          var visible =\n            (\n              (eltRect.right > viewport.left) &&\n              (eltRect.left < viewport.right) &&\n              (eltRect.bottom > viewport.top) &&\n              (eltRect.top < viewport.bottom)\n            );\n\n          return visible;\n        }\n\n        return {\n          container: container,\n          isInViewport: isInViewport\n        };\n      }\n\n      function createWatches() {\n        var watches = [];\n\n        function add(elt, offset, cb) {\n          if (!isWatched(elt)) {\n            watches.push([elt, offset, cb]);\n          }\n        }\n\n        function remove(elt) {\n          var pos = indexOf(elt);\n          if (pos !== -1) {\n            watches.splice(pos, 1);\n          }\n        }\n\n        function indexOf(elt) {\n          for (var i = watches.length - 1; i >= 0; i--) {\n            if (watches[i][0] === elt) {\n              return i;\n            }\n          }\n          return -1;\n        }\n\n        function isWatched(elt) {\n          return indexOf(elt) !== -1;\n        }\n\n        function checkAll(cb) {\n          return function() {\n            for (var i = watches.length - 1; i >= 0; i--) {\n              cb.apply(this, watches[i]);\n            }\n          };\n        }\n\n        return {\n          add: add,\n          remove: remove,\n          isWatched: isWatched,\n          checkAll: checkAll\n        };\n      }\n\n      function observeDOM(watches, container, cb) {\n        var observer = new MutationObserver(watch);\n        var filter = Array.prototype.filter;\n        var concat = Array.prototype.concat;\n\n        observer.observe(container, {\n          childList: true,\n          subtree: true,\n          // changes like style/width/height/display will be catched\n          attributes: true\n        });\n\n        function watch(mutations) {\n          // some new DOM nodes where previously watched\n          // we should check their positions\n          if (mutations.some(knownNodes) === true) {\n            setTimeout(cb, 0);\n          }\n        }\n\n        function knownNodes(mutation) {\n          var nodes = concat.call([],\n            Array.prototype.slice.call(mutation.addedNodes),\n            mutation.target\n          );\n          return filter.call(nodes, watches.isWatched).length > 0;\n        }\n      }\n\n      /* WEBPACK VAR INJECTION */\n    }.call(exports, (function() {\n      return this;\n    }())))\n\n    /***/\n  }\n  /******/\n]);"},{"_content":"/*!\n * An jQuery | zepto plugin for lazy loading images.\n * author -> jieyou\n * see https://github.com/jieyou/lazyload\n * use some tuupola's code https://github.com/tuupola/jquery_lazyload (BSD)\n * use component's throttle https://github.com/component/throttle (MIT)\n */\n!function(a){\"function\"==typeof define&&define.amd?define([\"jquery\"],a):a(window.jQuery||window.Zepto)}(function(a){function g(){}function h(a,b){var e;return e=b._$container==d?(\"innerHeight\"in c?c.innerHeight:d.height())+d.scrollTop():b._$container.offset().top+b._$container.height(),e<=a.offset().top-b.threshold}function i(b,e){var f;return f=e._$container==d?d.width()+(a.fn.scrollLeft?d.scrollLeft():c.pageXOffset):e._$container.offset().left+e._$container.width(),f<=b.offset().left-e.threshold}function j(a,b){var c;return c=b._$container==d?d.scrollTop():b._$container.offset().top,c>=a.offset().top+b.threshold+a.height()}function k(b,e){var f;return f=e._$container==d?a.fn.scrollLeft?d.scrollLeft():c.pageXOffset:e._$container.offset().left,f>=b.offset().left+e.threshold+b.width()}function l(a,b){var c=0;a.each(function(d){function g(){f.trigger(\"_lazyload_appear\"),c=0}var f=a.eq(d);if(!(f.width()<=0&&f.height()<=0||\"none\"===f.css(\"display\")))if(b.vertical_only)if(j(f,b));else if(h(f,b)){if(++c>b.failure_limit)return!1}else g();else if(j(f,b)||k(f,b));else if(h(f,b)||i(f,b)){if(++c>b.failure_limit)return!1}else g()})}function m(a){return a.filter(function(b){return!a.eq(b)._lazyload_loadStarted})}function n(a,b){function h(){f=0,g=+new Date,e=a.apply(c,d),c=null,d=null}var c,d,e,f,g=0;return function(){c=this,d=arguments;var a=new Date-g;return f||(a>=b?h():f=setTimeout(h,b-a)),e}}var f,c=window,d=a(c),e={threshold:0,failure_limit:0,event:\"scroll\",effect:\"show\",effect_params:null,container:c,data_attribute:\"original\",data_srcset_attribute:\"original-srcset\",skip_invisible:!0,appear:g,load:g,vertical_only:!1,check_appear_throttle_time:300,url_rewriter_fn:g,no_fake_img_loader:!1,placeholder_data_img:\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC\",placeholder_real_img:\"http://ditu.baidu.cn/yyfm/lazyload/0.0.1/img/placeholder.png\"};f=function(){var a=Object.prototype.toString;return function(b){return a.call(b).replace(\"[object \",\"\").replace(\"]\",\"\")}}(),a.fn.hasOwnProperty(\"lazyload\")||(a.fn.lazyload=function(b){var i,j,k,h=this;return a.isPlainObject(b)||(b={}),a.each(e,function(g,h){var i=f(b[g]);-1!=a.inArray(g,[\"threshold\",\"failure_limit\",\"check_appear_throttle_time\"])?\"String\"==i?b[g]=parseInt(b[g],10):\"Number\"!=i&&(b[g]=h):\"container\"==g?(b._$container=b.hasOwnProperty(g)?b[g]==c||b[g]==document?d:a(b[g]):d,delete b.container):!e.hasOwnProperty(g)||b.hasOwnProperty(g)&&i==f(e[g])||(b[g]=h)}),i=\"scroll\"==b.event,k=0==b.check_appear_throttle_time?l:n(l,b.check_appear_throttle_time),j=i||\"scrollstart\"==b.event||\"scrollstop\"==b.event,h.each(function(c){var e=this,f=h.eq(c),i=f.attr(\"src\"),k=f.attr(\"data-\"+b.data_attribute),l=b.url_rewriter_fn==g?k:b.url_rewriter_fn.call(e,f,k),n=f.attr(\"data-\"+b.data_srcset_attribute),o=f.is(\"img\");return 1==f._lazyload_loadStarted||i==l?(f._lazyload_loadStarted=!0,h=m(h),void 0):(f._lazyload_loadStarted=!1,o&&!i&&f.one(\"error\",function(){f.attr(\"src\",b.placeholder_real_img)}).attr(\"src\",b.placeholder_data_img),f.one(\"_lazyload_appear\",function(){function i(){d&&f.hide(),o?(n&&f.attr(\"srcset\",n),l&&f.attr(\"src\",l)):f.css(\"background-image\",'url(\"'+l+'\")'),d&&f[b.effect].apply(f,c?b.effect_params:[]),h=m(h)}var d,c=a.isArray(b.effect_params);f._lazyload_loadStarted||(d=\"show\"!=b.effect&&a.fn[b.effect]&&(!b.effect_params||c&&0==b.effect_params.length),b.appear!=g&&b.appear.call(e,f,h.length,b),f._lazyload_loadStarted=!0,b.no_fake_img_loader||n?(b.load!=g&&f.one(\"load\",function(){b.load.call(e,f,h.length,b)}),i()):a(\"<img />\").one(\"load\",function(){i(),b.load!=g&&b.load.call(e,f,h.length,b)}).attr(\"src\",l))}),j||f.on(b.event,function(){f._lazyload_loadStarted||f.trigger(\"_lazyload_appear\")}),void 0)}),j&&b._$container.on(b.event,function(){k(h,b)}),d.on(\"resize load\",function(){k(h,b)}),a(function(){k(h,b)}),this})});\n","source":"photos/lazyload.min.js","raw":"/*!\n * An jQuery | zepto plugin for lazy loading images.\n * author -> jieyou\n * see https://github.com/jieyou/lazyload\n * use some tuupola's code https://github.com/tuupola/jquery_lazyload (BSD)\n * use component's throttle https://github.com/component/throttle (MIT)\n */\n!function(a){\"function\"==typeof define&&define.amd?define([\"jquery\"],a):a(window.jQuery||window.Zepto)}(function(a){function g(){}function h(a,b){var e;return e=b._$container==d?(\"innerHeight\"in c?c.innerHeight:d.height())+d.scrollTop():b._$container.offset().top+b._$container.height(),e<=a.offset().top-b.threshold}function i(b,e){var f;return f=e._$container==d?d.width()+(a.fn.scrollLeft?d.scrollLeft():c.pageXOffset):e._$container.offset().left+e._$container.width(),f<=b.offset().left-e.threshold}function j(a,b){var c;return c=b._$container==d?d.scrollTop():b._$container.offset().top,c>=a.offset().top+b.threshold+a.height()}function k(b,e){var f;return f=e._$container==d?a.fn.scrollLeft?d.scrollLeft():c.pageXOffset:e._$container.offset().left,f>=b.offset().left+e.threshold+b.width()}function l(a,b){var c=0;a.each(function(d){function g(){f.trigger(\"_lazyload_appear\"),c=0}var f=a.eq(d);if(!(f.width()<=0&&f.height()<=0||\"none\"===f.css(\"display\")))if(b.vertical_only)if(j(f,b));else if(h(f,b)){if(++c>b.failure_limit)return!1}else g();else if(j(f,b)||k(f,b));else if(h(f,b)||i(f,b)){if(++c>b.failure_limit)return!1}else g()})}function m(a){return a.filter(function(b){return!a.eq(b)._lazyload_loadStarted})}function n(a,b){function h(){f=0,g=+new Date,e=a.apply(c,d),c=null,d=null}var c,d,e,f,g=0;return function(){c=this,d=arguments;var a=new Date-g;return f||(a>=b?h():f=setTimeout(h,b-a)),e}}var f,c=window,d=a(c),e={threshold:0,failure_limit:0,event:\"scroll\",effect:\"show\",effect_params:null,container:c,data_attribute:\"original\",data_srcset_attribute:\"original-srcset\",skip_invisible:!0,appear:g,load:g,vertical_only:!1,check_appear_throttle_time:300,url_rewriter_fn:g,no_fake_img_loader:!1,placeholder_data_img:\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC\",placeholder_real_img:\"http://ditu.baidu.cn/yyfm/lazyload/0.0.1/img/placeholder.png\"};f=function(){var a=Object.prototype.toString;return function(b){return a.call(b).replace(\"[object \",\"\").replace(\"]\",\"\")}}(),a.fn.hasOwnProperty(\"lazyload\")||(a.fn.lazyload=function(b){var i,j,k,h=this;return a.isPlainObject(b)||(b={}),a.each(e,function(g,h){var i=f(b[g]);-1!=a.inArray(g,[\"threshold\",\"failure_limit\",\"check_appear_throttle_time\"])?\"String\"==i?b[g]=parseInt(b[g],10):\"Number\"!=i&&(b[g]=h):\"container\"==g?(b._$container=b.hasOwnProperty(g)?b[g]==c||b[g]==document?d:a(b[g]):d,delete b.container):!e.hasOwnProperty(g)||b.hasOwnProperty(g)&&i==f(e[g])||(b[g]=h)}),i=\"scroll\"==b.event,k=0==b.check_appear_throttle_time?l:n(l,b.check_appear_throttle_time),j=i||\"scrollstart\"==b.event||\"scrollstop\"==b.event,h.each(function(c){var e=this,f=h.eq(c),i=f.attr(\"src\"),k=f.attr(\"data-\"+b.data_attribute),l=b.url_rewriter_fn==g?k:b.url_rewriter_fn.call(e,f,k),n=f.attr(\"data-\"+b.data_srcset_attribute),o=f.is(\"img\");return 1==f._lazyload_loadStarted||i==l?(f._lazyload_loadStarted=!0,h=m(h),void 0):(f._lazyload_loadStarted=!1,o&&!i&&f.one(\"error\",function(){f.attr(\"src\",b.placeholder_real_img)}).attr(\"src\",b.placeholder_data_img),f.one(\"_lazyload_appear\",function(){function i(){d&&f.hide(),o?(n&&f.attr(\"srcset\",n),l&&f.attr(\"src\",l)):f.css(\"background-image\",'url(\"'+l+'\")'),d&&f[b.effect].apply(f,c?b.effect_params:[]),h=m(h)}var d,c=a.isArray(b.effect_params);f._lazyload_loadStarted||(d=\"show\"!=b.effect&&a.fn[b.effect]&&(!b.effect_params||c&&0==b.effect_params.length),b.appear!=g&&b.appear.call(e,f,h.length,b),f._lazyload_loadStarted=!0,b.no_fake_img_loader||n?(b.load!=g&&f.one(\"load\",function(){b.load.call(e,f,h.length,b)}),i()):a(\"<img />\").one(\"load\",function(){i(),b.load!=g&&b.load.call(e,f,h.length,b)}).attr(\"src\",l))}),j||f.on(b.event,function(){f._lazyload_loadStarted||f.trigger(\"_lazyload_appear\")}),void 0)}),j&&b._$container.on(b.event,function(){k(h,b)}),d.on(\"resize load\",function(){k(h,b)}),a(function(){k(h,b)}),this})});\n","date":"2018-02-27T07:38:38.121Z","updated":"2018-02-27T07:38:38.121Z","path":"photos/lazyload.min.js","layout":"false","title":"","comments":1,"_id":"cje5fspf2000nn8vfpkn645th","content":"/*!\n * An jQuery | zepto plugin for lazy loading images.\n * author -> jieyou\n * see https://github.com/jieyou/lazyload\n * use some tuupola's code https://github.com/tuupola/jquery_lazyload (BSD)\n * use component's throttle https://github.com/component/throttle (MIT)\n */\n!function(a){\"function\"==typeof define&&define.amd?define([\"jquery\"],a):a(window.jQuery||window.Zepto)}(function(a){function g(){}function h(a,b){var e;return e=b._$container==d?(\"innerHeight\"in c?c.innerHeight:d.height())+d.scrollTop():b._$container.offset().top+b._$container.height(),e<=a.offset().top-b.threshold}function i(b,e){var=\"\" f;return=\"\" f=\"e._$container==d?d.width()+(a.fn.scrollLeft?d.scrollLeft():c.pageXOffset):e._$container.offset().left+e._$container.width(),f<=b.offset().left-e.threshold}function\" j(a,b){var=\"\" c;return=\"\" c=\"b._$container==d?d.scrollTop():b._$container.offset().top,c\">=a.offset().top+b.threshold+a.height()}function k(b,e){var f;return f=e._$container==d?a.fn.scrollLeft?d.scrollLeft():c.pageXOffset:e._$container.offset().left,f>=b.offset().left+e.threshold+b.width()}function l(a,b){var c=0;a.each(function(d){function g(){f.trigger(\"_lazyload_appear\"),c=0}var f=a.eq(d);if(!(f.width()<=0&&f.height()<=0||\"none\"===f.css(\"display\")))if(b.vertical_only)if(j(f,b));else if(h(f,b)){if(++c=\"\">b.failure_limit)return!1}else g();else if(j(f,b)||k(f,b));else if(h(f,b)||i(f,b)){if(++c>b.failure_limit)return!1}else g()})}function m(a){return a.filter(function(b){return!a.eq(b)._lazyload_loadStarted})}function n(a,b){function h(){f=0,g=+new Date,e=a.apply(c,d),c=null,d=null}var c,d,e,f,g=0;return function(){c=this,d=arguments;var a=new Date-g;return f||(a>=b?h():f=setTimeout(h,b-a)),e}}var f,c=window,d=a(c),e={threshold:0,failure_limit:0,event:\"scroll\",effect:\"show\",effect_params:null,container:c,data_attribute:\"original\",data_srcset_attribute:\"original-srcset\",skip_invisible:!0,appear:g,load:g,vertical_only:!1,check_appear_throttle_time:300,url_rewriter_fn:g,no_fake_img_loader:!1,placeholder_data_img:\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC\",placeholder_real_img:\"http://ditu.baidu.cn/yyfm/lazyload/0.0.1/img/placeholder.png\"};f=function(){var a=Object.prototype.toString;return function(b){return a.call(b).replace(\"[object \",\"\").replace(\"]\",\"\")}}(),a.fn.hasOwnProperty(\"lazyload\")||(a.fn.lazyload=function(b){var i,j,k,h=this;return a.isPlainObject(b)||(b={}),a.each(e,function(g,h){var i=f(b[g]);-1!=a.inArray(g,[\"threshold\",\"failure_limit\",\"check_appear_throttle_time\"])?\"String\"==i?b[g]=parseInt(b[g],10):\"Number\"!=i&&(b[g]=h):\"container\"==g?(b._$container=b.hasOwnProperty(g)?b[g]==c||b[g]==document?d:a(b[g]):d,delete b.container):!e.hasOwnProperty(g)||b.hasOwnProperty(g)&&i==f(e[g])||(b[g]=h)}),i=\"scroll\"==b.event,k=0==b.check_appear_throttle_time?l:n(l,b.check_appear_throttle_time),j=i||\"scrollstart\"==b.event||\"scrollstop\"==b.event,h.each(function(c){var e=this,f=h.eq(c),i=f.attr(\"src\"),k=f.attr(\"data-\"+b.data_attribute),l=b.url_rewriter_fn==g?k:b.url_rewriter_fn.call(e,f,k),n=f.attr(\"data-\"+b.data_srcset_attribute),o=f.is(\"img\");return 1==f._lazyload_loadStarted||i==l?(f._lazyload_loadStarted=!0,h=m(h),void 0):(f._lazyload_loadStarted=!1,o&&!i&&f.one(\"error\",function(){f.attr(\"src\",b.placeholder_real_img)}).attr(\"src\",b.placeholder_data_img),f.one(\"_lazyload_appear\",function(){function i(){d&&f.hide(),o?(n&&f.attr(\"srcset\",n),l&&f.attr(\"src\",l)):f.css(\"background-image\",'url(\"'+l+'\")'),d&&f[b.effect].apply(f,c?b.effect_params:[]),h=m(h)}var d,c=a.isArray(b.effect_params);f._lazyload_loadStarted||(d=\"show\"!=b.effect&&a.fn[b.effect]&&(!b.effect_params||c&&0==b.effect_params.length),b.appear!=g&&b.appear.call(e,f,h.length,b),f._lazyload_loadStarted=!0,b.no_fake_img_loader||n?(b.load!=g&&f.one(\"load\",function(){b.load.call(e,f,h.length,b)}),i()):a(\"<img>\").one(\"load\",function(){i(),b.load!=g&&b.load.call(e,f,h.length,b)}).attr(\"src\",l))}),j||f.on(b.event,function(){f._lazyload_loadStarted||f.trigger(\"_lazyload_appear\")}),void 0)}),j&&b._$container.on(b.event,function(){k(h,b)}),d.on(\"resize load\",function(){k(h,b)}),a(function(){k(h,b)}),this})});\n</=0&&f.height()<=0||\"none\"===f.css(\"display\")))if(b.vertical_only)if(j(f,b));else></=a.offset().top-b.threshold}function>","site":{"data":{}},"excerpt":"","more":"/*!\n * An jQuery | zepto plugin for lazy loading images.\n * author -> jieyou\n * see https://github.com/jieyou/lazyload\n * use some tuupola's code https://github.com/tuupola/jquery_lazyload (BSD)\n * use component's throttle https://github.com/component/throttle (MIT)\n */\n!function(a){\"function\"==typeof define&&define.amd?define([\"jquery\"],a):a(window.jQuery||window.Zepto)}(function(a){function g(){}function h(a,b){var e;return e=b._$container==d?(\"innerHeight\"in c?c.innerHeight:d.height())+d.scrollTop():b._$container.offset().top+b._$container.height(),e<=a.offset().top-b.threshold}function i(b,e){var=\"\" f;return=\"\" f=\"e._$container==d?d.width()+(a.fn.scrollLeft?d.scrollLeft():c.pageXOffset):e._$container.offset().left+e._$container.width(),f<=b.offset().left-e.threshold}function\" j(a,b){var=\"\" c;return=\"\" c=\"b._$container==d?d.scrollTop():b._$container.offset().top,c\">=a.offset().top+b.threshold+a.height()}function k(b,e){var f;return f=e._$container==d?a.fn.scrollLeft?d.scrollLeft():c.pageXOffset:e._$container.offset().left,f>=b.offset().left+e.threshold+b.width()}function l(a,b){var c=0;a.each(function(d){function g(){f.trigger(\"_lazyload_appear\"),c=0}var f=a.eq(d);if(!(f.width()<=0&&f.height()<=0||\"none\"===f.css(\"display\")))if(b.vertical_only)if(j(f,b));else if(h(f,b)){if(++c=\"\">b.failure_limit)return!1}else g();else if(j(f,b)||k(f,b));else if(h(f,b)||i(f,b)){if(++c>b.failure_limit)return!1}else g()})}function m(a){return a.filter(function(b){return!a.eq(b)._lazyload_loadStarted})}function n(a,b){function h(){f=0,g=+new Date,e=a.apply(c,d),c=null,d=null}var c,d,e,f,g=0;return function(){c=this,d=arguments;var a=new Date-g;return f||(a>=b?h():f=setTimeout(h,b-a)),e}}var f,c=window,d=a(c),e={threshold:0,failure_limit:0,event:\"scroll\",effect:\"show\",effect_params:null,container:c,data_attribute:\"original\",data_srcset_attribute:\"original-srcset\",skip_invisible:!0,appear:g,load:g,vertical_only:!1,check_appear_throttle_time:300,url_rewriter_fn:g,no_fake_img_loader:!1,placeholder_data_img:\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC\",placeholder_real_img:\"http://ditu.baidu.cn/yyfm/lazyload/0.0.1/img/placeholder.png\"};f=function(){var a=Object.prototype.toString;return function(b){return a.call(b).replace(\"[object \",\"\").replace(\"]\",\"\")}}(),a.fn.hasOwnProperty(\"lazyload\")||(a.fn.lazyload=function(b){var i,j,k,h=this;return a.isPlainObject(b)||(b={}),a.each(e,function(g,h){var i=f(b[g]);-1!=a.inArray(g,[\"threshold\",\"failure_limit\",\"check_appear_throttle_time\"])?\"String\"==i?b[g]=parseInt(b[g],10):\"Number\"!=i&&(b[g]=h):\"container\"==g?(b._$container=b.hasOwnProperty(g)?b[g]==c||b[g]==document?d:a(b[g]):d,delete b.container):!e.hasOwnProperty(g)||b.hasOwnProperty(g)&&i==f(e[g])||(b[g]=h)}),i=\"scroll\"==b.event,k=0==b.check_appear_throttle_time?l:n(l,b.check_appear_throttle_time),j=i||\"scrollstart\"==b.event||\"scrollstop\"==b.event,h.each(function(c){var e=this,f=h.eq(c),i=f.attr(\"src\"),k=f.attr(\"data-\"+b.data_attribute),l=b.url_rewriter_fn==g?k:b.url_rewriter_fn.call(e,f,k),n=f.attr(\"data-\"+b.data_srcset_attribute),o=f.is(\"img\");return 1==f._lazyload_loadStarted||i==l?(f._lazyload_loadStarted=!0,h=m(h),void 0):(f._lazyload_loadStarted=!1,o&&!i&&f.one(\"error\",function(){f.attr(\"src\",b.placeholder_real_img)}).attr(\"src\",b.placeholder_data_img),f.one(\"_lazyload_appear\",function(){function i(){d&&f.hide(),o?(n&&f.attr(\"srcset\",n),l&&f.attr(\"src\",l)):f.css(\"background-image\",'url(\"'+l+'\")'),d&&f[b.effect].apply(f,c?b.effect_params:[]),h=m(h)}var d,c=a.isArray(b.effect_params);f._lazyload_loadStarted||(d=\"show\"!=b.effect&&a.fn[b.effect]&&(!b.effect_params||c&&0==b.effect_params.length),b.appear!=g&&b.appear.call(e,f,h.length,b),f._lazyload_loadStarted=!0,b.no_fake_img_loader||n?(b.load!=g&&f.one(\"load\",function(){b.load.call(e,f,h.length,b)}),i()):a(\"<img>\").one(\"load\",function(){i(),b.load!=g&&b.load.call(e,f,h.length,b)}).attr(\"src\",l))}),j||f.on(b.event,function(){f._lazyload_loadStarted||f.trigger(\"_lazyload_appear\")}),void 0)}),j&&b._$container.on(b.event,function(){k(h,b)}),d.on(\"resize load\",function(){k(h,b)}),a(function(){k(h,b)}),this})});\n</=0&&f.height()<=0||\"none\"===f.css(\"display\")))if(b.vertical_only)if(j(f,b));else></=a.offset().top-b.threshold}function>"},{"title":"标签","date":"2017-04-27T11:11:27.000Z","type":"tags","comments":0,"_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2017-04-27 19:11:27\ntype: \"tags\"\ncomments: false\n---\n","updated":"2018-02-27T07:38:38.122Z","path":"tags/index.html","layout":"page","_id":"cje5fspf4000pn8vfmwd2484z","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"Activiti5 流程框架","date":"2017-11-23T09:00:30.000Z","_content":"工作流(Workflow)，就是“业务过程的部分或整体在计算机应用环境下的自动化”，它主要解决的是“使在多个参与者之间按照某种预定义的规则传递文档、信息或任务的过程自动进行，从而实现某个预期的业务目标，或者促使此目标的实现”。\n<!--more-->\n\n# 1 Activiti简介\n\nActiviti5是由Alfresco软件在2010年5月17日发布的业务流程管理（BPM）框架，它是覆盖了业务流程管理、工作流、服务协作等领域的一个开源的、灵活的、易扩展的可执行流程语言框架。Activiti基于Apache许可的开源BPM平台，创始人Tom Baeyens是JBoss jBPM的项目架构师，它特色是提供了eclipse插件，开发人员可以通过插件直接绘画出业务流程图。\n\n## 1.1 工作流引擎\n\n这是Activiti的核心，负责生成流程运行时的各种实例及数据、监控和管理流程的运行。\n  \n## 1.2 BPMN2.0\n\n业务流程建模与标注（Business Process Model and Notation，BPMN) ，描述流程的基本符号，包括这些图元如何组合成一个业务流程图（Business Process Diagram）\n\n## 1.3 数据库\n\nActiviti的后台是有数据库的支持，所有的表都以ACT_开头。第二部分是表示表的用途的两个字母标识。 用途也和服务的API对应。\n\n 1. **ACT_RE_***: 'RE'表示repository。 这个前缀的表包含了流程定义和流程静态资源 （图片，规则，等等）。\n 2. **ACT_RU_***: 'RU'表示runtime。 这些运行时的表，包含流程实例，任务，变量，异步任务，等运行中的数据。 Activiti只在流程实例执行过程中保存这些数据， 在流程结束时就会删除这些记录。 这样运行时表可以一直很小速度很快。\n 3. **ACT_ID_***: 'ID'表示identity。 这些表包含身份信息，比如用户，组等等。\n 4. **ACT_HI_***: 'HI'表示history。 这些表包含历史数据，比如历史流程实例， 变量，任务等等。\n 5. **ACT_GE_***: 通用数据， 用于不同场景下。\n\n### 1.3.1 资源库流程规则表\n\n 1. act_re_deployment  部署信息表\n 2. act_re_mode        流程设计模型部署表\n 3. act_re_procdef     流程定义表\n\n### 1.3.2 运行时数据库\n\n 1. act_ru_execution    运行时流程执行实例表\n 2. act_ru_identitylink 运行时流程人员表，主要存储任务节点与参与者的相关信息\n 3. act_ru_task\t\t    运行时任务节点表\n 4. act_ru_variable\t    运行时流程变量数据表\n\n### 1.3.3 历史数据库表\n\n 1. act_hi_actinst \t\t    历史节点表\n 2. act_hi_attachment\t\t历史附件表\n 3. act_hi_comment\t\t    历史意见表\n 4. act_hi_identitylink\t\t历史流程人员表\n 5. act_hi_detail\t\t\t历史详情表，提供历史变量的查询\n 6. act_hi_procinst\t\t    历史流程实例表\n 7. act_hi_taskinst\t\t    历史任务实例表\n 8. act_hi_varinst\t\t    历史变量表\n\n### 1.3.4 组织机构表\n\n 1. act_id_group\t\t用户组信息表\n 2. act_id_info\t\t用户扩展信息表\n 3. act_id_membership\t用户与用户组对应信息表\n 4. act_id_user\t\t用户信息表\n\n这四张表很常见，基本的组织机构管理，关于用户认证方面建议还是自己开发一套，组件自带的功能太简单，使用中有很多需求难以满足 。可以使shiro完成用户认证。\n\n### 1.3.5 统用数据表\n\n 1. act_ge_bytearray\t\t二进制数据表\n 2. act_ge_property\t\t属性数据表存储整个流程引擎级别的数据,初始化表结构时，会默认插入三条记录\n\n## 1.4 activiti.cfg.xml\n\nActiviti核心配置文件，配置流程引擎创建工具的基本参数和数据库连接池参数。\n\n定义数据库配置参数：\n\n - jdbcUrl: 数据库的JDBC URL。\n - jdbcDriver: 对应不同数据库类型的驱动。\n - jdbcUsername: 连接数据库的用户名。\n - jdbcPassword: 连接数据库的密码。\n\n基于JDBC参数配置的数据库连接 会使用默认的MyBatis连接池。 下面的参数可以用来配置连接池（来自MyBatis参数）：\n\n - jdbcMaxActiveConnections: 连接池中处于被使用状态的连接的最大值。默认为10。\n - jdbcMaxIdleConnections: 连接池中处于空闲状态的连接的最大值。\n - jdbcMaxCheckoutTime: 连接被取出使用的最长时间，超过时间会被强制回收。 默认为20000（20秒）。\n - jdbcMaxWaitTime: 这是一个底层配置，让连接池可以在长时间无法获得连接时， 打印一条日志，并重新尝试获取一个连接。（避免因为错误配置导致沉默的操作失败）。 默认为20000（20秒）。\n\n\n示例如下：\n\n```xml\n  \t<bean name=\"processEngineConfiguration\" class=\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\">\n  \t\t<property name=\"JdbcDriver\" value=\"com.mysql.jdbc.Driver\" />\n  \t\t<property name=\"JdbcUrl\" value=\"jdbc:mysql://localhost:3306/activititest\"/>\n\t\t<property name=\"JdbcUsername\" value=\"root\" />\n\t\t<property name=\"JdbcPassword\" value=\"123\" />\n\t\t<!-- \n\t\t\tdatabaseSchemaUpdate：设置流程引擎启动和关闭时如何处理数据库表\n\t\t\tfalse（默认）:检查数据库表的版本和依赖库的版本，如果不一致就抛出异常\n\t\t\ttrue:构建流程引擎是执行检查，如果需要就更新，如果表不存在就创建\n\t\t\tcreate-drop：构建流程引擎是创建表，关闭时删除表  \n\t\t-->\n\t\t<property name=\"databaseSchemaUpdate\" value=\"true\" />\n  \t</bean>\n```\n\n关于c3p0、dbcp等数据库连接池配置请参看[spring(4)——持久层封装][1]\n\n## 1.5 logging.properties\n\n```xml\nlog4j.rootLogger=WARN, stdout\nlog4j.appender.stdout=org.apache.log4j.ConsoleAppender\nlog4j.appender.stdout.layout=org.apache.log4j.PatternLayout\nlog4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - %m%n\n```\n\n更详细log4j说明请参看[log4j.properties配置详解与实例][2]\n \n# 2 环境搭建\n\n## 2.1 需求java环境\n\n 1. JDK1.6或更高\n 2. 支持的数据库有：h2, mysql, oracle, postgres, mssql, db2等。\n 3. 支持activiti5运行的jar包\n 4. 开发环境为Eclipse3.7或者以上版本,myeclipse为8.6版本\n\n## 2.2 资源下载\n\nactiviti可以到[Activiti官方网站][3]下载得到。\n\n百度网盘下载地址，5.22.0和6.0.0两个版本，还有eclipse插件。[百度网盘下载][4]\n\n注意：安装插件后，在Windows->Preferences->Activiti->Save菜单下勾选保存时自动生成图片。\n\n## 2.3 配置开发环境\n\n### 2.3.1 添加jar包\n\n在activiti-5.22.0→wars目录下是一些示例项目，解压activiti-rest项目，导入activiti-rest目录中WEB-INF\\lib下所有jar包到classpath中。\n注意还需要数据库连接驱动包，如Mysql还需要添加**mysql-connector-java.jar**。\n\n### 2.3.2 初始化数据库\n\n```java\n@Test\npublic void createTable() {\n    //1、创建流程引擎配置对象\n\tProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration.createStandaloneProcessEngineConfiguration();\n\t//2、配置数据库\n\tprocessEngineConfiguration.setJdbcDriver(\"com.mysql.jdbc.Driver\");\n\tprocessEngineConfiguration.setJdbcUrl(\"jdbc:mysql://localhost:3306/activititest\");\n\tprocessEngineConfiguration.setJdbcUsername(\"root\");\n\tprocessEngineConfiguration.setJdbcPassword(\"123\");\n\t//3、设置建表策略\n\tprocessEngineConfiguration.setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE);\n\t//4、创建流程引擎对象\n\tProcessEngine processEngine = processEngineConfiguration.buildProcessEngine();\n\tSystem.out.println(\"processEngine\"+processEngine);\n}\n```\n在Activiti中，在创建核心的流程引擎对象时会自动建表。如果程序正常执行，mysql会自动建库，然后创建23张表。\n\n### 2.3.3 配置文件\n\n在Actiiti5中定制流程必定会操作到数据库，如果都像上面那样写一大段代码会非常麻烦，所以我们可以把数据库连接配置写入配置文件。\n  \n在Activiti5的官方示例中并没有现成的配置文件，所以先得找到activiti-rest\\WEB-INF\\classes下有：**activiti-context.xml**：一个类似spring结构的配置文件，清空内容后改名为activiti.cfg.xml，用来做流程引擎的相关配置。\n\n```xml\n  \t<bean name=\"processEngineConfiguration\" class=\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\">\n  \t\t<property name=\"JdbcDriver\" value=\"com.mysql.jdbc.Driver\" />\n  \t\t<property name=\"JdbcUrl\" value=\"jdbc:mysql://localhost:3306/activititest\"/>\n\t\t<property name=\"JdbcUsername\" value=\"root\" />\n\t\t<property name=\"JdbcPassword\" value=\"123\" />\n\t\t<!-- \n\t\t\tdatabaseSchemaUpdate：设置流程引擎启动和关闭时如何处理数据库表\n\t\t\tfalse（默认）:检查数据库表的版本和依赖库的版本，如果不一致就抛出异常\n\t\t\ttrue:构建流程引擎是执行检查，如果需要就更新，如果表不存在就创建\n\t\t\tcreate-drop：构建流程引擎是创建表，关闭时删除表  \n\t\t-->\n\t\t<property name=\"databaseSchemaUpdate\" value=\"true\" />\n  \t</bean>\n```\n\nJava代码如下：\n\n```java\n@Test\npublic void createTable2() {\n\tProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(\"activiti.cfg.xml\");\n\tProcessEngine processEngine = processEngineConfiguration.buildProcessEngine();\n}\n```\n\n# 3 核心API\n\n## 3.1 ProcessEngine\n\n 1. 在Activiti中最核心的类，其他的类都是由它而来。\n 2. 产生方式\n    2.1 方式一：最基础版本，见2.3.2小节\n    2.2 方式二：配置文件+java代码，见2.3.3小节\n    \n    ```java\n    @Test\n    public void createTable3() {\n    \tProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    }\n    ```\n    这种方式更加简单，会自动加载classpath下名为activiti.cfg.xml的文件。\n 3. 产生各种service\n \n    ```java\n    //流程仓库业务类，管理流程定义、部署\n    RepositoryService repositoryService = processEngine.getRepositoryService();\n    //流程运行业务类，管理流程启动、推进、删除等操作\n    RuntimeService runtimeService = processEngine.getRuntimeService();\n    //流程任务类，管理具体的任务\n    TaskService taskService = processEngine.getTaskService();\n    //流程历史数据类\n    HistoryService historyService = processEngine.getHistoryService();\n    //流程用户业务类\n    IdentityService identityService = processEngine.getIdentityService();\n    ```\n## 3.2 ReposityService\n\n流程仓库业务类，仓库简单理解即流程定义文档的两个文件：bpmn文件和流程图片\n\n 1. 产生流程部署配置对象，用来定义流程部署的相关参数\n\n    ```\n    @Test\n    public void Demo1() {\n    \tDeploymentBuilder deploymentBuilder = processEngine.getRepositoryService().createDeployment().name(\"test\");\n    \tdeploymentBuilder.addClasspathResource(\"diagrams/HelloWord.bpmn\");\n    \tdeploymentBuilder.addClasspathResource(\"diagrams/HelloWord.png\");\n    \t\n    \tDeployment deployment = deploymentBuilder.deploy();\n    \tSystem.out.println(deployment.getId() + \"。。。。\"+ deployment.getName());\n    }\n    ```\n 2. 删除流程定义\n\n    ```\n    repositoryService.deleteDeployment(deploymentId);\n    ```\n \n## 3.3 RuntimeService\n\n流程执行服务类。可以从这个类中获取很多关于流程执行相关的信息。\n\n 1. 启动流程\n \n    ```java\n    //常用的启动流程实例的两种方法\n    ProcessInstance processInstance = runtimeService.startProcessInstanceById(processInstanceId);\n    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(processInstanceKey);\n    ```\n\n## 3.4 TaskService\n\nactiviti的任务服务类。可以从这个类中获取任务的信息。\n\n## 3.5 ProcessDefinition\n\n流程定义类。可以从这里获得资源文件等。\n每个流程文件唯一对应一个相同key的流程定义，只是流程定义的version不同\n\n## 3.6 ProcessInstance\n\n流程实例。根据流程定义实例化的具体流程，我们可以利用这个对象来了解当前流程实例的进度等信息。\n如：\n    公司有一个所有人通用的请假流程，这个叫做流程定义。\n    小明今天请假，填写请假单，就是创建了一个流程实例。\n\n```java\n/** Represents one execution of a  {@link ProcessDefinition}.\n 1. \n 2. @author Tom Baeyens\n 3. @author Joram Barrez\n 4. @author Daniel Meyer\n 5. @author Tijs Rademakers\n */\npublic interface ProcessInstance extends Execution {\n```\n\n从上面可以看出ProcessInstance就是Execution，但实际有点区别\n\n 1. 单线流程中，ProcessInstance与Execution是一致的，ID都一样\n 2. 多线 流程中，总线路代表ProcessInstance，而分线路中每个活动代表Execution。\n\n## 3.7 Execution\n\nActiviti用这个对象去描述流程执行的每一个节点。在没有并发的情况下，同ProcessInstance。\n\n# 4 流程定义\n\n## 4.1 创建流程文件\n\n在classpath下创建流程文件\n![创建][5]\n编辑流程文件\n![编辑][6]\n\n## 4.2 部署流程定义\n\n部署流程定义可以看成是添加流程定义\n```java\n@Test\npublic void deploy() {\n    //创建流程引擎\n    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    //创建流程部署对象\n    DeploymentBuilder deploymentBuilder = processEngine.getRepositoryService().createDeployment();\n    //读取文件部署流程\n    Deployment deploy = deploymentBuilder.name(\"测试\")\n                            .addClasspathResource(\"diagrams/HelloWord.bpmn\")\n                            .addClasspathResource(\"diagrams/HelloWord.png\")\n                            .deploy();\n    \n    System.out.println(deploy.getId() + \"。。。\" + deploy.getName());\n}\n```\n\n**部署流程会改变3张表**\n\n - act_re_deployment\n\t存放流程定义的显示名和部署时间，每部署一次增加一条记录\n - act_re_procdef\n\t存放流程定义的属性信息，部署每个新的流程定义都会在这张表中增加一条记录。\n - act_ge_bytearray\n\t存储流程定义相关的部署信息。即流程定义文档的存放地。每部署一次就会增加两条记录，一条是关于bpmn规则文件的，一条是图片的（如果部署时只指定了bpmn一个文件，activiti会在部署时解析bpmn文件内容自动生成流程图）。两个文件不是很大，都是以二进制形式存储在数据库中。\n\n## 4.3 查看流程定义\n\n```java\n@Test\npublic void view() {\n    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();\n    List<ProcessDefinition> list = repositoryService.createProcessDefinitionQuery()\n                                        //过滤条件\n                                        .processDefinitionKey(\"HelloWorld\")\n                                        //.processDefinitionId(processDefinitionId)\n                                        //分页\n                                        //.listPage(firstResult, maxResults)\n                                        //排序\n                                        //.orderByProcessDefinitionVersion()\n                                        //执行查询\n                                        .list();\n    for (ProcessDefinition processDefinition : list) {\n        System.out.print(\"id:\" + processDefinition.getId() + \",\");//流程Id\n        System.out.print(\"key:\" + processDefinition.getKey() + \",\");//流程Key\n        System.out.print(\"name:\" + processDefinition.getName() + \",\");//流程名字\n        System.out.print(\"version:\" + processDefinition.getVersion() + \",\");//流程版本\n        System.out.println(\"deploymentId():\" + processDefinition.getDeploymentId());//流程部署对象Id\n    }\n}\n```\n查询结果\n\n    id:HelloWorld:1:35004,key:HelloWorld,name:请假审批流程,version:1,deploymentId():35001\n再部署一次，再查询\n\n    id:HelloWorld:1:35004,key:HelloWorld,name:请假审批流程,version:1,deploymentId():35001\n    id:HelloWorld:2:37504,key:HelloWorld,name:请假审批流程,version:2,deploymentId():37501\n    \n说明：\n    \n\n 1. 因为流程定义的信息在仓库中，实际在act_re_*表中，所以创建RepositoryService\n 2. 创建查询对象**ProcessDefinitionQuery**，设置查询参数，调用list()执行查询\n 3. 由查询结果可知：\n    3.1 流程定义的key和name与流程文件的id和name一致\n\n    ```xml\n    <process id=\"HelloWorld\" name=\"请假审批流程\" isExecutable=\"true\">\n    ```\n    3.2 key属性被用来区别不同的流程定义。\n    3.3 带有特定key的流程定义第一次部署时，version为1。之后每次部署都会在当前最高版本号上加1\n    3.4 Id的生成规则为：**{processDefinitionKey}:{processDefinitionVersion}:{generated-id}**，这里的generated-id是一个自动生成的唯一的数字\n    3.5 重复部署一次，deploymentId的值以一定的形式变化\n    \n## 4.4 删除流程定义\n\n删除部署到activiti中的流程定义。如:删除请假流程定义，则大家再也不能请假了。\n\n```java\n@Test\npublic void delete() {\n    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();\n    String deploymentId = \"7501\";\n    //如果有关联信息，会报错\n    //repositoryService.deleteDeployment(deploymentId);\n    //如果有关联信息，会级联删除\n    repositoryService.deleteDeployment(deploymentId, true);\n}\n```\n\n## 4.5 获取流程定义文档资源\n\n```java\n@Test\npublic void getResource() throws IOException {\n    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();\n   \n    String deploymentId = \"35001\";\n    String resourceName = null;\n    //资源文件名,即act_re_bytearray表中的name\n    List<String> names = repositoryService.getDeploymentResourceNames(deploymentId);\n    for (String str : names) {\n        //过滤出特定的图片文件\n        if (str.indexOf(\"HelloWorld.png\") != -1) {\n            resourceName = str;\n        }\n    }\n    System.out.println(resourceName);\n    if (resourceName != null) {\n        //通过部署ID和文件名获得输入流\n        InputStream inputStream = repositoryService.getResourceAsStream(deploymentId, resourceName);\n        File file = new File(\"D:/\"+ resourceName);\n        FileUtils.copyInputStreamToFile(inputStream, file);\n    }\n}\n```\n    \n# 5 流程实例\n\n## 5.1 启动流程实例\n\n```java\n@Test\npublic void startProcess() {\n    RuntimeService runtimeService = ProcessEngines.getDefaultProcessEngine().getRuntimeService();\n    //根据流程Id启动流程\n    //ProcessInstance processInstance = runtimeService.startProcessInstanceById(processDefinitionId);\n    //根据流程key启动流程，会自动找到版本最高的流程定义来创建\n    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(\"HelloWorld\");\n    System.out.println(processInstance.getId());//流程实例Id\n    System.out.println(processInstance.getActivityId());//流程当前节点Id\n}\n```\n    启动流程实例有很多重载方法，根据实际需要选用。\n\n## 5.2 查询任务\n\n在Activiti中，任务主要分为两类：\n\n 1. 确切指定了办理者的任务，之歌任务称为制定者的私人任务\n 2. 2.无法指定具体的某一个人来办理的任务，可以把任务分配给几个人或者一到\t多个小组，让这个范围内的用户可以选择性（如有空余时间时）来办理这类任务。\n\n```java\n@Test\npublic void taskQuery() {\n    TaskService taskService = ProcessEngines.getDefaultProcessEngine().getTaskService();\n    List<Task> list = taskService.createTaskQuery()\n            //查询指定用户的私人任务\n            //.taskAssignee(\"指定用户\")\n            //查询某人可接的共有任务\n            //.taskCandidateUser(\"候选用户\")\n            //排序\n            .orderByTaskCreateTime().desc()\n            //执行查询\n            .list();\n    for (Task task : list) {\n        System.out.println(\"id:\" + task.getId());\n        System.out.println(\"name:\" + task.getName());\n        System.out.println(\"assignee:\" + task.getAssignee());\n        System.out.println(\"createTime:\" + task.getCreateTime());\n        System.out.println(\"ProcessInstanceId:\" + task.getProcessInstanceId());\n        System.out.println(\"ProcessDefinitionId:\" + task.getProcessDefinitionId());\n    }\n}\n```\n\n## 5.3 认领任务\n\n```java\ntaskService.claim(taskId, userId);\n```\n将任务变为用户的私人任务\n\n## 5.4 办理任务\n\n```java\n//根据任务Id办理任务\ntaskService.complete(taskId);\n//根据任务Id办理任务,并设置任务变量\ntaskService.complete(taskId, variables);\n```\n\nvariables是Map，当设置变量时，会在act_ru_variables表中添加相应条数的数据，变量可以用来执行gateway的判断，后面会讲到gateway。\n\n## 5.5 判断流程是否结束\n\n在流程执行过程中，创建的流程实例ID在整个过程都不会变，当流程结束后，流程实例将被删除。\n\n 1. 从运行库中查询该流程是否还存在\n 2. 从历史库中查询该流程是否存在\n\n```java\n@Test\npublic String checkStatus() {\n    String processInstanceId = \"1213\";\n    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    RuntimeService runtimeService = processEngine.getRuntimeService();\n    //从运行库查询该流程实例是否存在\n    ProcessInstance instance = runtimeService.createProcessInstanceQuery()\n                                    .processInstanceId(processInstanceId)\n                                    .singleResult();\n    //实例不存在，可能未开始或者已结束\n    if (instance == null) {\n        //从历史库查\n        HistoryService historyService = processEngine.getHistoryService();\n        HistoricProcessInstance singleResult = historyService.createHistoricProcessInstanceQuery()\n                                                .processInstanceId(processInstanceId)\n                                                .singleResult();\n        if (singleResult != null && singleResult.getEndTime() != null) {\n            //流程已结束\n            return \"COMPLETE\";\n        } else {\n            //流程未开始\n            return \"NOT_START\";\n        }\n    }\n    return instance.getActivityId();//当前任务节点\n}\n```\n \n# 6 流程历史\n\n在前一个的例子中，大家可能会流程执行完毕后，究竟去了哪里有些疑问。虽然已完成的任务在act_ru_task和act_ru_execution表中都已被删除，但是这些数据还存在activiti的数据库中，作为历史改由HistoryService来管理。\n\n历史是一个组件，它可以捕获发生在进程执行中的信息并永久的保存，与运行时数据不同的是，当流程实例运行完成之后它还会存在于数据库中。\n\n在流程引擎配置对象中可以设置历史记录规则：\n\n```xml\n<bean name=\"processEngineConfiguration\" \n  \t  class=\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\">\n\t<property name=\"databaseSchemaUpdate\" value=\"true\" />\n\t<!--\n\t\tActiviti提供了四种历史级别：\n\t\tnone:不保存任何历史，可以提高性能\n\t\tactiviti:保存所有流程实例、任务、活动信息\n\t\taudit:默认级别,保存所有流程实例、任务、活动、表单\n\t\tfull:保存所有信息,如流程变量\n\t  -->\n\t<property name=\"history\" value=\"activiti\"/>\n```\n由于数据库中保存着历史信息以及正在运行的流程实例信息，在实际项目中对已完成任务的查看频率远不及对代办和可接任务的查看，所以在activiti采用分开管理，把正在运行的交给runtimeService管理，而历史数据交给HistoryService来管理。\n\n对已成为历史的数据主要进行查询操作，我们主要关心两种类型的历史数据：\n\n - **HistoricProcessInstance** 包含当前和已经结束的流程实例信息。\n - **HistoricActivityInstance** 包含一个活动(流程上的节点)的执行信息。\n\n## 6.1 查看历史流程实例\n\n```java\n@Test\npublic void queryHisInstance() {\n    //流程引擎\n    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    //流程定义ID\n    String processDefinitionId = \"HelloWorld:2:37504\";\n    //查询历史流程实例\n    List<HistoricProcessInstance> list = processEngine.getHistoryService().createHistoricProcessInstanceQuery()\n                                        .processDefinitionId(processDefinitionId)\n                                        .finished()\n                                        .orderByProcessInstanceStartTime().desc()\n                                        .list();\n    for (HistoricProcessInstance hp : list) {\n        System.out.println(\"ID：\"+hp.getId());\n        System.out.println(\"startTime：\"+hp.getStartTime());\n        System.out.println(\"endTime：\"+hp.getEndTime());\n    }\n}\n```\n\n1.通常查询历史流程实例都需要指定一个过滤条件，指定\tprocessDefinitionId查看具体某一次部署所开启的流程或者指定\tprocessDefinitionKey查看某个规则下不限版本的所有流程\n\n2.可以选择性添加finished方法控制是否查询未完成的流程实例。在流\t程开启时，activiti同时在act_ru_execution表和act_hi_procinst表中\t创建了一条记录，在流程完成之前act_hi_procinst表中实例的结束时间为空\n\n\n## 6.2 查看历史流程活动（节点）\n\n```java\n@Test\npublic void queryHisActiviti() {\n    //流程引擎\n    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    //流程实例ID\n    String processInstanceId = \"HelloWorld:2:37504\";\n    //查询历史流程活动\n    List<HistoricActivityInstance> list = processEngine.getHistoryService()\n                                        //创建历史流程活动实例查询对象\n                                        .createHistoricActivityInstanceQuery()\n                                        //过滤条件\n                                        .processInstanceId(processInstanceId)\n                                        //排序\n                                        .orderByHistoricActivityInstanceStartTime().desc()\n                                        //执行查询\n                                        .list();\n    for (HistoricActivityInstance ha : list) {\n        System.out.println(\"ID：\"+ha.getActivityId());\n        System.out.println(\"name:\"+ha.getActivityName());\n        System.out.println(\"startTime：\"+ha.getStartTime());\n        System.out.println(\"endTime：\"+ha.getEndTime());\n    }\n}\n```\n\n通常查询历史流程活动都需要指定一个过滤条件，指定processInstanceId查看具体某一次流程执行过程中所经历的步奏\n\n# 7 流程变量\n\n流程变量在整个工作流中扮演很重要的作用。例如：请假流程中有请假天数、请假原因等一些参数都为流程变量的范围。\n流程变量的作用域范围是流程实例。也就是说各个流程实例的流程变量是不相互影响的。\n流程实例结束完成以后流程变量是否保存在数据库中取决于存储策略，见第六章。\n![流程变量][7]\n\n## 7.1 添加流程变量\n\n 1. 启动流程实例时添加\n    ```java\n    @Test\n    public void addVariables() {\n        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n        RuntimeService runtimeService = processEngine.getRuntimeService();\n        \n        String processDefinitionKey = \"HelloWorld\";\n        Map<String,Object> variables = new HashMap<>();\n        variables.put(\"请假天数\", 3);\n        variables.put(\"请假原因\", \"约会\");\n        ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(processDefinitionKey, variables);\n    }\n    ```\n    说明：\n        1)\t在启动流程实例时，通过重载startProcessInstanceByKey的方法可以加载流程变量。\n        2)\t第二个参数要求是Map<String ,Object>类型，意味着可以添加多个流程变量。\n        3)\t当这段代码执行完以后，会在数据库表act_ru_variable中添加两行记录。\n        \n\n 2. 完成任务时添加\n    ```java\n    //办理过程中\n    taskService.setVariables(taskId, variables);\n    //提交时\n    taskService.complete(taskId, variables);\n    ```\n    \n 3. 执行流程实例时添加\n    ```java\n    //执行流程实例时\n    runtimeService.setVariables(executionId, variables);\n    //流程实例提交时\n    runtimeService.signal(executionId, processVariables);//signal用于接受任务\n    ```\n    \n## 7.2 获取流程变量\n\n```java\n//某个流程的变量\nruntimeService.getVariables(executionId);\n//某个任务的变量\ntaskService.getVariables(taskId);\n```\n\n说明：这些流程变量是从act_ru_variable这个表中读出来的。\n\n## 7.3 流程变量范围\n\n![此处输入图片的描述][8]\n\n从图中可以看出包括了大部分封装类型和Date、String和实现了Serializable接口的类的类型。\n\n## 7.4 Javabean类型变量\n\n 1. 定义一个javabean，这个javabean实现了Serializable接口\n 2. 实例化javaBean，放到map中，然后正常设置流程变量\n 3. 正常取出变量\n\n# 8 流程定义语言\n\n## 8.1 流程（Process）\n\nbpmn文件一个流程的根元素。一个流程就代表一个工作流。\n\n## 8.2 顺序流（sequenceFlow）\n\n顺序流是连接两个流程节点的连线，代表一个节点的出口。流程执行完一个节点后，会沿着节点的所有外出顺序流继续执行。 就是说，BPMN 2.0默认的行为就是并发的： 两个外出顺序流会创造两个单独的，并发流程分支。\n\n顺序流主要由4个属性组成：\n\n - Id: 唯一标示，用来区分不同的顺序流\n - sourceRef：连线的源头节点ID\n - targetRef：连线的目标节点ID\n - name（可选）：连线的名称，不涉及业务，主要用于显示\n\n## 8.3 节点\n\n### 8.3.1 开始事件节点(startEvent)\n开始事件用来指明流程在哪里开始。开始事件的类型（流程在接收事件时启动， 还是在指定时间启动，等等），定义了流程如何启动， 这通过事件中不同的小图表来展示。 在XML中，这些类型是通过声明不同的子元素来区分的。\n![此处输入图片的描述][9]\n\n 1. 空开始事件\n    空开始事件技术上意味着没有指定启动流程实例的触发条件。最常用的一种开始，意味着流程的启动需要手动触发，通过调用api的startProcessInstanceByXXX方法。\n    ```java\n    ProcessInstance processInstance = runtimeService.startProcessInstanceByXXX()\n    ```\n    图形标记：空开始事件显示成一个圆圈，没有内部图表（没有触发类型）\n    XML结构如下：\n    ```xml\n    <startEvent id=\"startevent\" name=\"Start\"></startEvent>\n    ```\n\n 2. 定时开始事件\n\n    定时开始事件用来在指定的时间创建流程实例。 它可以同时用于只启动一次的流程 和应该在特定时间间隔启动多次的流程。\n\n        注意：\n        1.子流程不能使用定时开始事件。\n        2.定时开始事件在流程发布后就会开始计算时间。不需要调用startProcessInstanceByXXX，虽然也而已调用启动流程的方法，但是那会导致调用startProcessInstanceByXXX时启动过多的流程。\n        3.当包含定时开始事件的新版本流程部署时，对应的上一个定时器就会被删除。这是因为通常不希望自动启动旧版本流程的流程实例。\n    \n    图形标记：定时开始事件显示为一个圆圈，内部是一个表。\n    XML内容：定时开始事件的XML内容是普通开始事件的声明，包含一个定时定义子元素。 \n    示例：流程会启动4次，每次间隔5分钟，从2013年9月18日，12:10开始计时。\n    ```xml\n    <startEvent id=\"theStart\">\n        <timerEventDefinition>                \n\t\t    <timeCycle>R4/2017-11-22T11:04/PT5M</timeCycle>            \t\t \n\t    </timerEventDefinition>\n    </startEvent> \n    ```\n    示例：流程会根据选中的时间启动一次。\n    ```xml\n    <startEvent id=\"theStart\">\n        <timerEventDefinition>                \n\t\t    <timeDate>2017-12-31T23:59:59</timeDate>               \t\t \n\t    </timerEventDefinition>\n    </startEvent> \n    ```\n \n### 8.3.2 结束事件节点(endEvent)\n\n结束事件表示（子）流程（分支）的结束。结束事件都是触发事件。这是说当流程达结束事件，会触发一个结果。 结果的类型是通过事件的内部黑色图标表示的。\n![结束事件][10]\n\n 1. 空结束事件\n \n    空结束事件意味着到达事件时不会指定抛出的结果。这样，引擎会直接结束当前执行的分支，不会做其他事情。\n    图形标记:空结束事件是一个粗边圆圈，内部没有小图表（无结果类型）\n    XML内容:空结束事件的XML内容是普通结束事件定义，不包含子元素（其他结束事件类型都会包含声明类型的子元素）。\n    ```xml\n    <endEvent id=\"end\" name=\"my end event\"/>\n    ```\n\n### 8.3.3 任务节点(Task)\n\n![任务节点][11]\n\n 1. 用户任务节点\n    用户任务用来设置必须由人员完成的工作。当流程执行到用户任务，会创建一个新任务，并把这个新任务加入到分配人或群组的任务列表中。\n    图形标记：用户任务显示成一个普通任务（圆角矩形），左上角有一个小用户图标。\n    XML内容：XML中的用户任务定义如下。id属性是必须的。 name属性是可选的。\n    ```xml\n    <userTask id=\"theTask\" name=\"Important task\"/>  \n    ```\n    用户任务也可以设置描述(实际上所有BPMN 2.0元素都可以设置描述)。 添加documentation元素可以定义描述。\n    ```xml\n    <userTask id=\"theTask\" name=\"Schedule meeting\">  \n    <documentation>\n        Schedule an engineering meeting for next week with the new hire.  \n    </documentation>\n    ```\n    在实际应用中，用户接到任务后可以参照任务描述来办理任务，描述文本可以通过标准的java方法来获得：\n    ```java\n    task.getDescription() \n    ```\n**私人任务**\n    私有任务即有直接分配给指定用户的任务。只有一个用户可以成为任务的执行者。 在activiti中，用户叫做执行者。 拥有执行者的用户任务（即私有任务）对其他用户是不可见的。只能出现执行者的个人任务列表中.\n    直接把用户任务分配给指定用户使用assignee属性，XML代码如下：\n    ```xml\n    <userTask id=\"theTask\" name=\"my task\" activiti:assignee=\"username\"/>\n    ```\n    Assignee属性对应的值为一个用户的ID。\n    直接分配给用户的任务可以通过TaskService像下面这样办理：\n    ```java\n    List<Task>tasks =taskService.createTaskQuery().taskAssignee(\"sirius\").list();\nTask task = tasks.get(0);// 假设任务集合的第一条是要办理的任务\ntaskService.complete(task.getId());\n\n    ```\n **公有任务**\n    有的用户任务在指派时无法确定具体的办理者，这时任务也可以加入到\t人员的候选任务列表中，然后让这些人员选择性认领和办理任务。\n    \n    公有任务的分配可以分为指定候选用户和候选组两种。\n\n    -  把任务添加到一批用户的候选任务列表中，使用candidateUsers\t属\t性，XML内容如下:\n    ```xml\n    <userTaskid=\"theTask\"name=\"my task\"activiti:candidateUsers=\"sirius,kermit\"/>\n    ```\n    candidateUsers属性内为用户的ID，多个用户ID之间使用（半角）逗号间隔。\n    \n     - 把任务添加到一个或多个候选组下，这时任务对组下的所有用户可见，首先得保证每个组下面有用户，通过IdentityService对象创建用户和组，然后把用户添加到对应的组下。然后配置组任务，使用candidateGroups属性，XML内容如下：\n    ```xml\n    <userTask id=\"theTask\" name=\"my task\" activiti:candidateGroups=\"testGroup，developGroup\"/>\n    ```\n    间接分配给用户的任务，可以通过TaskService像下面这样操作：\n    ```java\n    List<Task>tasks =taskService.createTaskQuery()\n\t\t\t\t.taskCandidateUser(\"sirius\").list();\n    Task task = tasks.get(0);// 假设任务集合的第一条是要办理的任务\n    String taskId = task.getId();\n    taskService.claim(taskId ,“sirius”); //认领任务，让用户成为任务的执行者\n    taskService.complete(taskId );\n    ```\n\n    说明：\n    \n     1. 要维护用户和组得使用用户管理服务对象，使用\t\tprocessEngine\t得到IdentityService。\n     2. 要分配组任务必须先创建组，而且组下得有用户，用户和组的\t最关键属性是ID。\n     3. 使用newUser（userId）和newGroup（groupId）创建用户和组。\n     4. 使用createMembership（userId，groupId）把用户挂到组下。\n     5. 办理候选任务，首先得认领任务，让用户成为任务的执行者\n    \n    如果上面的方式还不够灵活，那么我们也可以自定义一个任务分配处理器，通过代码的方式来动态设置任务的属性。XML代码如下：\n    ```xml\n    <userTask id=\"task1\" name=\"My task\"> \n        <extensionElements>    \n            <activiti:taskListener event=\"create\" class=\"org.activiti.MyAssignmentHandler\"/>  \n        </extensionElements>\n    </userTask>\n    ```\n    DelegateTask会传递给TaskListener的实现，通过它可以设置执行人，候选人和候选组：\n    ```java\n    Public class MyAssignmentHandler implements TaskListener {\n      \n        Public void notify(DelegateTask delegateTask){ \n    \t// 执行用户搜索相关代码    \n    \t...\n    \t// 然后把获取到的用户通过下面方法，设置给当前触发事件的任务\n        \tdelegateTask.setAssignee(\"sirius\");\n        \t//delegateTask.addCandidateUser(\"kermit\");\n       \t//delegateTask.addCandidateGroup(\"testGroup\"); \n       \t...  \n        }\n    }\n    ```\n\n 2. 接收任务节点（receiveTask）\n\n    接收任务是一个简单任务，它会等待对应消息的到达。当前，官方只实现了这个任务的java语义。 当流程达到接收任务，流程状态会保存到数据库中。在任务创建后，意味着流程会进入等待状态，直到引擎接收了一个特定的消息，这会触发流程穿过接收任务继续执行。\n    \n    图形标记：接收任务显示为一个任务（圆角矩形），右上角有一个消息小标记。 消息是白色的（黑色图标表示发送语义）。\n    \n    XML内容：\n    ```xml\n    <receiveTask id=\"waitState\" name=\"wait\"/> \n    ```\n    \n    当前任务（一般指机器自动完成，但需要耗费一定时间的工作）完成后，向后推移流程，可以调用runtimeService.signal(executionId)，传递接收任务上流程的id。\n    ```java\n    ProcessInstance pi = runtimeService.startProcessInstanceByKey(\"receiveTask\");\n    Execution execution = runtimeService.createExecutionQuery()\n                            .processInstanceId(pi.getId())\n                            .activityId(\"waitState\")\n                            .singleResult();\n    runtimeService.signal(execution.getId());  \n    ```\n    \n----------\n\n述两个虽然都可以统称为任务节点，但是还是有本质区别：\n\n 1. receiveTask主要代表机器自动执行的，userTask代表人工干预的。\n 2. eiveTask任务产生后会在act_ru_execution表中新增一条记录，\t而userTask产生后会在act_ru_execution和act_ru_task（主要记录任\t务的发布时间，办理人等信息）中各产生一条记录。\n 3. receiveTask任务提交方式使用RuntimeService的signal方法提交，\tuserTask任务提交方式使用TaskService的complete方法提交。\n\n \n### 8.3.4 网关（gateWay）\n![网关][12]\n\n 1. 排他网关\n    排他网关（也叫异或（XOR）网关，或更技术性的叫法基于数据的排他网关），用来在流程中实现决策。\n    \n    **图形标记**:排他网关显示成一个普通网关（比如，菱形图形）,内部是一个“X”图标,表示异或（XOR）语义。注意，没有内部图标的网关，默认为排他网关。BPMN2.0规范不允许在同一个流程定义中同时使用没有X和有X的菱形图形。\n    \n    **XML内容**:排他网关的XML内容是很直接的：用一行定义了网关,条件表达式定义在外出顺序流中。参考条件顺序流 获得这些表达式的可用配置。\n    ![排他网关][13]\n    ```xml\n    <exclusiveGatewayid=\"exclusiveGw\"name=\"Exclusive Gateway\"/>\n    <sequenceFlow id=\"flow2\" sourceRef=\"exclusiveGw\" targetRef=\"theTask1\">  \n        <conditionExpressionxsi:type=\"tFormalExpression\">${input == 1}</conditionExpression> \n    </sequenceFlow>\t\n    <sequenceFlow id=\"flow3\" sourceRef=\"exclusiveGw\" targetRef=\"theTask2\">   \n        <conditionExpressionxsi:type=\"tFormalExpression\">${input == 2}</conditionExpression> \n    </sequenceFlow>\n    <sequenceFlow id=\"flow4\" sourceRef=\"exclusiveGw\" targetRef=\"theTask3\">  \n        <conditionExpressionxsi:type=\"tFormalExpression\">${input == 3}</conditionExpression> \n    </sequenceFlow>\n    ```\n    \n    说明：\n    1.一个排他网关对应一个以上的顺序流\n    2.由排他网关流出的顺序流都有个conditionExpression元素，在内部维护返回boolean类型的决策结果。\n    3.决策网关只会返回一条结果。当流程执行到排他网关时，流程引擎会自动检索网关出口，从上到下检索如果发现第一条决策结果为true或者没有设置条件的(默认为成立)，则流出。\n    4.如果没有任何一个出口符合条件则抛出异常。\n\n 2. 并行网关\n \n    网关也可以表示流程中的并行情况。最简单的并行网关是parallelGateWay，它允许将流程分成多条分支，也可以把多条分支汇聚到一起。\n\n    **图形标记**：并行网关显示成一个普通网关（菱形）内部是一个“加号”图标，表示“与（AND）”语义。\n    ![并行网关][14]\n    \n    **XML内容**：定义并行网关只需要一行\n    ```xml\n    <parallelGateway id=\"myParallelGateway\"/>\n    ```\n    实际发生的行为（分支，聚合，同时分支聚合），要根据并行网关的顺序流来决定。\n    ```xml\n    <startEvent id=\"theStart\"/>\n\n    <sequenceFlow id=\"flow1\" sourceRef=\"theStart\" targetRef=\"fork\"/>\n    <parallelGateway id=\"fork\"/> \n     \n    <sequenceFlow sourceRef=\"fork\" targetRef=\"receivePayment\"/>\n    <sequenceFlow sourceRef=\"fork\" targetRef=\"shipOrder\"/>\n        \n    <userTaskid=\"receivePayment\"name=\"Receive Payment\"/>\n    <sequenceFlow sourceRef=\"receivePayment\" targetRef=\"join\"/>\n       \n    <userTaskid=\"shipOrder\"name=\"Ship Order\"/>\n    <sequenceFlow sourceRef=\"shipOrder\" targetRef=\"join\"/>\n    \n    <parallelGateway id=\"join\"/>\n    <sequenceFlow sourceRef=\"join\" targetRef=\"archiveOrder\"/>\n     \n    <userTask id=\"archiveOrder\"name=\"Archive Order\"/>\n    <sequenceFlow sourceRef=\"archiveOrder\" targetRef=\"theEnd\"/>\n             \n    <endEventid=\"theEnd\"/>\n    ```\n    上面例子中，流程启动之后，会创建两个任务：\n    ```java\n    ProcessInstancepi =runtimeService.startProcessInstanceByKey(\"forkJoin\");\n    \n    List<Task> tasks = taskService.createTaskQuery().list();\n    Task task1 =tasks.get(0);\n    System.out.println(\"Receive Payment\"+task1.getName());\n    Task task2 =tasks.get(1);\n    System.out.println(\"Ship Order\"+task2.getName());\n    ```\n    当两个任务都完成时，第二个并行网关会汇聚两个分支，因为它只有一条外出连线，不会创建并行分支，只会创建归档订单任务。\n    \n    说明：\n    1.并行网关的功能是基于进入和外出的顺序流的：\n        分支(fork)：并行后的所有外出顺序流，为每个顺序流都创建一个并发分支。\n        汇聚(join)：所有到达并行网关，在此等待的进入分支，直到所有进入顺序流的分支都到达以后， 流程就会通过汇聚网关。\n    2.并行网关的进入和外出都是使用相同节点标示\n    3.如果同一个并行网关有多个进入和多个外出顺序流，它就同时具有分支和汇聚功能。这时，网关会先汇聚所有进入的顺序流，然后再切分成多个并行分支。\n    4.并行网关不会解析条件。 即使顺序流中定义了条件，也会被忽略。\n    5.并行网关不需要是“平衡的”（比如，对应并行网关的进入和外出节点数目相等）。如图中标示是合法的：\n    ![并行网关不需要是“平衡的”][15]\n \n## 8.4 监听器（Listener）\n\n在流程中我们有时会对整个流程或者一个节点的某种状态做出相应的处理。这时就会用到监听器。\n\n在Activiti中流程的监听主要分为两大类，执行监听器和任务监听器。\n\n### 8.4.1 执行监听器（ExecutionListener）\n\n执行监听器可以执行外部java代码或执行表达式，当流程定义中发生了某个事件。 可以捕获的事件有:\n\n - 流程实例的启动和结束。\n - 选中一条连线。\n - 节点的开始和结束。\n - 网关的开始和结束。\n - 中间事件的开始和结束。\n - 开始事件结束或结束事件开始。\n\n现在有这样一个简单流程，只包含开始、结束、接收任务和用户任务4个节点：\n![监听器流程示例][16]\n配置监听器,XML代码如下\n```xml\n<extensionElements>\n      <activiti:executionListener event=\"start\" class=\"test.ProcessStartListener\"></activiti:executionListener>\n</extensionElements>\n```\n说明：\n\n - 任务监听器支持以下属性：\n    \n    - event（必选）：任务监听器会被调用的任务类型\n        - start：流程节点创建后触发\n        - end：当任务完成，并尚未从运行数据中删除时触发\n        - take：任务完成后，流程流出时触发\n    - class(必选)：代理类，实现org.activiti.engine.delegate.ExecutionListener接口。\n    示例：\n    ```java\n    public class ProcessStartListener implements ExecutionListener {\n\n    private static final long serialVersionUID = 1L;\n\n    @Override\n    public void notify(DelegateExecution execution) throws Exception {\n            System.out.println(\"ID:\"+execution.getId()+\", Name:\"+execution.getCurrentActivityName());\n        }\n    \n    }\n    ```\n\n - 执行监听器配置可以放在以下三个地方，如图\n![此处输入图片的描述][17]\n\n    a)\t监听整个流程的启动和结束状态，配置为process节点的子元素，如①\n    b)\t监听一个节点的启动和结束状态，配置为一个节点的子元素，如②和③\n    c)\t监听一条连线的执行，配置在sequenceFlow节点的内部，只有task一种事件，如④\n    \n启动流程测试代码如下：\n```java\n@Test\npublic void Demo1() {\n    //部署流程\n    Deployment deployment = repositoryService.createDeployment()\n                .addClasspathResource(\"diagrams/Listener.bpmn\")\n                .addClasspathResource(\"diagrams/Listener.png\")\n                .deploy();\n    //启动\n    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(\"ListenerTest\");\n    //推动\n    String processInstanceId = processInstance.getId();\n    runtimeService.signal(processInstanceId);\n    \n    String id = taskService.createTaskQuery().processInstanceId(processInstanceId).singleResult().getId();\n    taskService.complete(id);\n}\n```\n\n测试结果如下：\n\n        ID:60005, Name:开始\n        ID:60005, Name:接收任务\n        ID:60005, Name:用户任务\n\n### 8.4.2 任务监听器（TaskListener）\n\n任务监听器可以在发生对应的任务相关事件时执行自定义java逻辑 或表达式。\n任务监听器只能添加到流程定义中的用户任务中。在之前任务节点上添加任务监听:\n![此处输入图片的描述][18]\n\n任务监听器支持以下属性\n\n- event（必选）：任务监听器会被调用的任务类型。 可能的类型为：\n    - create：任务创建并设置所有属性后触发。\n    - assignment：任务分配给一些人时触发。当流程到达userTask，assignment事件 会在create事件之前发生。这样的顺序似乎不自然，但是原因很简单：当获得create时间时， 我们想获得任务的所有属性，包括执行人。\n    - complete：当任务完成，并尚未从运行数据中删除时触发。\n- class：必须调用的代理类。 这个类必须实现org.activiti.engine.delegate.TaskListener\t接口。\n\n\n----------\n\n新添加的任务监听包裹在executionListener监听的内部，顺序为：execution Start--> task Assignment-->task Create-->task Complete-->execution End-->execution take。\n\n\n# 9 Spring集成\n\n虽然前面的例子中我们可以自己手动来创建相应的API实例，但是在一个项目中这些API都应该以**单例形式**存在的。和Spring的集成主要就是把Activiti的主要对象交给Spring容器管理。\n\n```xml\n<!-- 流程引擎 -->\n<bean id=\"processEngine\" class=\"org.activiti.spring.ProcessEngineFactoryBean\"> \n\t<property name=\"processEngineConfiguration\" ref=\"processEngineConfiguration\"></property>\n</bean>\n\n<!-- 流程引擎配置对象 -->\n<bean id=\"processEngineConfiguration\" class=\"org.activiti.spring.SpringProcessEngineConfiguration\">\n\t<property name=\"dataSource\" ref=\"dataSource\" />\n\t<property name=\"transactionManager\" ref=\"transactionManager\" />\n\t<!-- activiti表数据更新策略 false true（默认） create-drop-->\n\t<property name=\"databaseSchemaUpdate\" value=\"true\" />\n\t<!-- activiti历史数据保存策略 none activity audit(默认) full-->\n\t<property name=\"history\" value=\"audit\" />\n\t<!-- 管理线程计时器和异步消息,默认开启，但有ManagementService替代，避免冲突所以关闭 -->\n\t<property name=\"jobExecutorActivate\" value=\"false\" />\n\t<!-- 加载资源文件 -->\n\t<property name=\"deploymentResources\" value=\"classpath:/activiti-process/*.bpmn\" />\n</bean>\n\n<!-- 核心业务类 -->\n<bean id=\"repositoryService\" factory-bean=\"processEngine\" factory-method=\"getRepositoryService\" />\n<bean id=\"runtimeService\" factory-bean=\"processEngine\" factory-method=\"getRuntimeService\" />\n<bean id=\"taskService\" factory-bean=\"processEngine\" factory-method=\"getTaskService\" />\n<bean id=\"historyService\" factory-bean=\"processEngine\" factory-method=\"getHistoryService\" />\n<bean id=\"managementService\" factory-bean=\"processEngine\" factory-method=\"getManagementService\" />\n```\n\n**注意：**\n 1. ProcessEngineConfiguration\n    单独使用和整合Spring时不是同一个class\n    独立使用：org.activiti.engine.ProcessEngineConfiguration\n    整合Spring：org.activiti.spring.SpringProcessEngineConfiguration\n 2. 项目部署后会自动在数据库中创建相关流程定义\n\n \n\n \n \n \n  \n\n\n  \n\n\n  [1]: https://www.zybuluo.com/mdeditor#785927\n  [2]: http://blog.csdn.net/dr_guo/article/details/50718063\n  [3]: http://activiti.org/download.htmlt/dr_guo/article/details/50718063\n  [4]: http://pan.baidu.com/s/1qYmgdlE\n  [5]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/create.png\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/example.png\n  [7]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/variable.png\n  [8]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/baseVar.png\n  [9]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/startEvent.png\n  [10]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/endEvent.png\n  [11]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/task.png\n  [12]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/gateWay.png\n  [13]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/xor.png\n  [14]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/parallelGateWay.png\n  [15]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/binxing.png\n  [16]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/listenerExample.png\n  [17]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/taskListener.png\n  [18]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/taskListener2.png","source":"_posts/Activiti5-流程框架.md","raw":"---\ntitle: Activiti5 流程框架\ncategories:\n  - JavaEE\ntags:\n  - activiti\ndate: 2017-11-23 17:00:30\n---\n工作流(Workflow)，就是“业务过程的部分或整体在计算机应用环境下的自动化”，它主要解决的是“使在多个参与者之间按照某种预定义的规则传递文档、信息或任务的过程自动进行，从而实现某个预期的业务目标，或者促使此目标的实现”。\n<!--more-->\n\n# 1 Activiti简介\n\nActiviti5是由Alfresco软件在2010年5月17日发布的业务流程管理（BPM）框架，它是覆盖了业务流程管理、工作流、服务协作等领域的一个开源的、灵活的、易扩展的可执行流程语言框架。Activiti基于Apache许可的开源BPM平台，创始人Tom Baeyens是JBoss jBPM的项目架构师，它特色是提供了eclipse插件，开发人员可以通过插件直接绘画出业务流程图。\n\n## 1.1 工作流引擎\n\n这是Activiti的核心，负责生成流程运行时的各种实例及数据、监控和管理流程的运行。\n  \n## 1.2 BPMN2.0\n\n业务流程建模与标注（Business Process Model and Notation，BPMN) ，描述流程的基本符号，包括这些图元如何组合成一个业务流程图（Business Process Diagram）\n\n## 1.3 数据库\n\nActiviti的后台是有数据库的支持，所有的表都以ACT_开头。第二部分是表示表的用途的两个字母标识。 用途也和服务的API对应。\n\n 1. **ACT_RE_***: 'RE'表示repository。 这个前缀的表包含了流程定义和流程静态资源 （图片，规则，等等）。\n 2. **ACT_RU_***: 'RU'表示runtime。 这些运行时的表，包含流程实例，任务，变量，异步任务，等运行中的数据。 Activiti只在流程实例执行过程中保存这些数据， 在流程结束时就会删除这些记录。 这样运行时表可以一直很小速度很快。\n 3. **ACT_ID_***: 'ID'表示identity。 这些表包含身份信息，比如用户，组等等。\n 4. **ACT_HI_***: 'HI'表示history。 这些表包含历史数据，比如历史流程实例， 变量，任务等等。\n 5. **ACT_GE_***: 通用数据， 用于不同场景下。\n\n### 1.3.1 资源库流程规则表\n\n 1. act_re_deployment  部署信息表\n 2. act_re_mode        流程设计模型部署表\n 3. act_re_procdef     流程定义表\n\n### 1.3.2 运行时数据库\n\n 1. act_ru_execution    运行时流程执行实例表\n 2. act_ru_identitylink 运行时流程人员表，主要存储任务节点与参与者的相关信息\n 3. act_ru_task\t\t    运行时任务节点表\n 4. act_ru_variable\t    运行时流程变量数据表\n\n### 1.3.3 历史数据库表\n\n 1. act_hi_actinst \t\t    历史节点表\n 2. act_hi_attachment\t\t历史附件表\n 3. act_hi_comment\t\t    历史意见表\n 4. act_hi_identitylink\t\t历史流程人员表\n 5. act_hi_detail\t\t\t历史详情表，提供历史变量的查询\n 6. act_hi_procinst\t\t    历史流程实例表\n 7. act_hi_taskinst\t\t    历史任务实例表\n 8. act_hi_varinst\t\t    历史变量表\n\n### 1.3.4 组织机构表\n\n 1. act_id_group\t\t用户组信息表\n 2. act_id_info\t\t用户扩展信息表\n 3. act_id_membership\t用户与用户组对应信息表\n 4. act_id_user\t\t用户信息表\n\n这四张表很常见，基本的组织机构管理，关于用户认证方面建议还是自己开发一套，组件自带的功能太简单，使用中有很多需求难以满足 。可以使shiro完成用户认证。\n\n### 1.3.5 统用数据表\n\n 1. act_ge_bytearray\t\t二进制数据表\n 2. act_ge_property\t\t属性数据表存储整个流程引擎级别的数据,初始化表结构时，会默认插入三条记录\n\n## 1.4 activiti.cfg.xml\n\nActiviti核心配置文件，配置流程引擎创建工具的基本参数和数据库连接池参数。\n\n定义数据库配置参数：\n\n - jdbcUrl: 数据库的JDBC URL。\n - jdbcDriver: 对应不同数据库类型的驱动。\n - jdbcUsername: 连接数据库的用户名。\n - jdbcPassword: 连接数据库的密码。\n\n基于JDBC参数配置的数据库连接 会使用默认的MyBatis连接池。 下面的参数可以用来配置连接池（来自MyBatis参数）：\n\n - jdbcMaxActiveConnections: 连接池中处于被使用状态的连接的最大值。默认为10。\n - jdbcMaxIdleConnections: 连接池中处于空闲状态的连接的最大值。\n - jdbcMaxCheckoutTime: 连接被取出使用的最长时间，超过时间会被强制回收。 默认为20000（20秒）。\n - jdbcMaxWaitTime: 这是一个底层配置，让连接池可以在长时间无法获得连接时， 打印一条日志，并重新尝试获取一个连接。（避免因为错误配置导致沉默的操作失败）。 默认为20000（20秒）。\n\n\n示例如下：\n\n```xml\n  \t<bean name=\"processEngineConfiguration\" class=\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\">\n  \t\t<property name=\"JdbcDriver\" value=\"com.mysql.jdbc.Driver\" />\n  \t\t<property name=\"JdbcUrl\" value=\"jdbc:mysql://localhost:3306/activititest\"/>\n\t\t<property name=\"JdbcUsername\" value=\"root\" />\n\t\t<property name=\"JdbcPassword\" value=\"123\" />\n\t\t<!-- \n\t\t\tdatabaseSchemaUpdate：设置流程引擎启动和关闭时如何处理数据库表\n\t\t\tfalse（默认）:检查数据库表的版本和依赖库的版本，如果不一致就抛出异常\n\t\t\ttrue:构建流程引擎是执行检查，如果需要就更新，如果表不存在就创建\n\t\t\tcreate-drop：构建流程引擎是创建表，关闭时删除表  \n\t\t-->\n\t\t<property name=\"databaseSchemaUpdate\" value=\"true\" />\n  \t</bean>\n```\n\n关于c3p0、dbcp等数据库连接池配置请参看[spring(4)——持久层封装][1]\n\n## 1.5 logging.properties\n\n```xml\nlog4j.rootLogger=WARN, stdout\nlog4j.appender.stdout=org.apache.log4j.ConsoleAppender\nlog4j.appender.stdout.layout=org.apache.log4j.PatternLayout\nlog4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - %m%n\n```\n\n更详细log4j说明请参看[log4j.properties配置详解与实例][2]\n \n# 2 环境搭建\n\n## 2.1 需求java环境\n\n 1. JDK1.6或更高\n 2. 支持的数据库有：h2, mysql, oracle, postgres, mssql, db2等。\n 3. 支持activiti5运行的jar包\n 4. 开发环境为Eclipse3.7或者以上版本,myeclipse为8.6版本\n\n## 2.2 资源下载\n\nactiviti可以到[Activiti官方网站][3]下载得到。\n\n百度网盘下载地址，5.22.0和6.0.0两个版本，还有eclipse插件。[百度网盘下载][4]\n\n注意：安装插件后，在Windows->Preferences->Activiti->Save菜单下勾选保存时自动生成图片。\n\n## 2.3 配置开发环境\n\n### 2.3.1 添加jar包\n\n在activiti-5.22.0→wars目录下是一些示例项目，解压activiti-rest项目，导入activiti-rest目录中WEB-INF\\lib下所有jar包到classpath中。\n注意还需要数据库连接驱动包，如Mysql还需要添加**mysql-connector-java.jar**。\n\n### 2.3.2 初始化数据库\n\n```java\n@Test\npublic void createTable() {\n    //1、创建流程引擎配置对象\n\tProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration.createStandaloneProcessEngineConfiguration();\n\t//2、配置数据库\n\tprocessEngineConfiguration.setJdbcDriver(\"com.mysql.jdbc.Driver\");\n\tprocessEngineConfiguration.setJdbcUrl(\"jdbc:mysql://localhost:3306/activititest\");\n\tprocessEngineConfiguration.setJdbcUsername(\"root\");\n\tprocessEngineConfiguration.setJdbcPassword(\"123\");\n\t//3、设置建表策略\n\tprocessEngineConfiguration.setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE);\n\t//4、创建流程引擎对象\n\tProcessEngine processEngine = processEngineConfiguration.buildProcessEngine();\n\tSystem.out.println(\"processEngine\"+processEngine);\n}\n```\n在Activiti中，在创建核心的流程引擎对象时会自动建表。如果程序正常执行，mysql会自动建库，然后创建23张表。\n\n### 2.3.3 配置文件\n\n在Actiiti5中定制流程必定会操作到数据库，如果都像上面那样写一大段代码会非常麻烦，所以我们可以把数据库连接配置写入配置文件。\n  \n在Activiti5的官方示例中并没有现成的配置文件，所以先得找到activiti-rest\\WEB-INF\\classes下有：**activiti-context.xml**：一个类似spring结构的配置文件，清空内容后改名为activiti.cfg.xml，用来做流程引擎的相关配置。\n\n```xml\n  \t<bean name=\"processEngineConfiguration\" class=\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\">\n  \t\t<property name=\"JdbcDriver\" value=\"com.mysql.jdbc.Driver\" />\n  \t\t<property name=\"JdbcUrl\" value=\"jdbc:mysql://localhost:3306/activititest\"/>\n\t\t<property name=\"JdbcUsername\" value=\"root\" />\n\t\t<property name=\"JdbcPassword\" value=\"123\" />\n\t\t<!-- \n\t\t\tdatabaseSchemaUpdate：设置流程引擎启动和关闭时如何处理数据库表\n\t\t\tfalse（默认）:检查数据库表的版本和依赖库的版本，如果不一致就抛出异常\n\t\t\ttrue:构建流程引擎是执行检查，如果需要就更新，如果表不存在就创建\n\t\t\tcreate-drop：构建流程引擎是创建表，关闭时删除表  \n\t\t-->\n\t\t<property name=\"databaseSchemaUpdate\" value=\"true\" />\n  \t</bean>\n```\n\nJava代码如下：\n\n```java\n@Test\npublic void createTable2() {\n\tProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(\"activiti.cfg.xml\");\n\tProcessEngine processEngine = processEngineConfiguration.buildProcessEngine();\n}\n```\n\n# 3 核心API\n\n## 3.1 ProcessEngine\n\n 1. 在Activiti中最核心的类，其他的类都是由它而来。\n 2. 产生方式\n    2.1 方式一：最基础版本，见2.3.2小节\n    2.2 方式二：配置文件+java代码，见2.3.3小节\n    \n    ```java\n    @Test\n    public void createTable3() {\n    \tProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    }\n    ```\n    这种方式更加简单，会自动加载classpath下名为activiti.cfg.xml的文件。\n 3. 产生各种service\n \n    ```java\n    //流程仓库业务类，管理流程定义、部署\n    RepositoryService repositoryService = processEngine.getRepositoryService();\n    //流程运行业务类，管理流程启动、推进、删除等操作\n    RuntimeService runtimeService = processEngine.getRuntimeService();\n    //流程任务类，管理具体的任务\n    TaskService taskService = processEngine.getTaskService();\n    //流程历史数据类\n    HistoryService historyService = processEngine.getHistoryService();\n    //流程用户业务类\n    IdentityService identityService = processEngine.getIdentityService();\n    ```\n## 3.2 ReposityService\n\n流程仓库业务类，仓库简单理解即流程定义文档的两个文件：bpmn文件和流程图片\n\n 1. 产生流程部署配置对象，用来定义流程部署的相关参数\n\n    ```\n    @Test\n    public void Demo1() {\n    \tDeploymentBuilder deploymentBuilder = processEngine.getRepositoryService().createDeployment().name(\"test\");\n    \tdeploymentBuilder.addClasspathResource(\"diagrams/HelloWord.bpmn\");\n    \tdeploymentBuilder.addClasspathResource(\"diagrams/HelloWord.png\");\n    \t\n    \tDeployment deployment = deploymentBuilder.deploy();\n    \tSystem.out.println(deployment.getId() + \"。。。。\"+ deployment.getName());\n    }\n    ```\n 2. 删除流程定义\n\n    ```\n    repositoryService.deleteDeployment(deploymentId);\n    ```\n \n## 3.3 RuntimeService\n\n流程执行服务类。可以从这个类中获取很多关于流程执行相关的信息。\n\n 1. 启动流程\n \n    ```java\n    //常用的启动流程实例的两种方法\n    ProcessInstance processInstance = runtimeService.startProcessInstanceById(processInstanceId);\n    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(processInstanceKey);\n    ```\n\n## 3.4 TaskService\n\nactiviti的任务服务类。可以从这个类中获取任务的信息。\n\n## 3.5 ProcessDefinition\n\n流程定义类。可以从这里获得资源文件等。\n每个流程文件唯一对应一个相同key的流程定义，只是流程定义的version不同\n\n## 3.6 ProcessInstance\n\n流程实例。根据流程定义实例化的具体流程，我们可以利用这个对象来了解当前流程实例的进度等信息。\n如：\n    公司有一个所有人通用的请假流程，这个叫做流程定义。\n    小明今天请假，填写请假单，就是创建了一个流程实例。\n\n```java\n/** Represents one execution of a  {@link ProcessDefinition}.\n 1. \n 2. @author Tom Baeyens\n 3. @author Joram Barrez\n 4. @author Daniel Meyer\n 5. @author Tijs Rademakers\n */\npublic interface ProcessInstance extends Execution {\n```\n\n从上面可以看出ProcessInstance就是Execution，但实际有点区别\n\n 1. 单线流程中，ProcessInstance与Execution是一致的，ID都一样\n 2. 多线 流程中，总线路代表ProcessInstance，而分线路中每个活动代表Execution。\n\n## 3.7 Execution\n\nActiviti用这个对象去描述流程执行的每一个节点。在没有并发的情况下，同ProcessInstance。\n\n# 4 流程定义\n\n## 4.1 创建流程文件\n\n在classpath下创建流程文件\n![创建][5]\n编辑流程文件\n![编辑][6]\n\n## 4.2 部署流程定义\n\n部署流程定义可以看成是添加流程定义\n```java\n@Test\npublic void deploy() {\n    //创建流程引擎\n    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    //创建流程部署对象\n    DeploymentBuilder deploymentBuilder = processEngine.getRepositoryService().createDeployment();\n    //读取文件部署流程\n    Deployment deploy = deploymentBuilder.name(\"测试\")\n                            .addClasspathResource(\"diagrams/HelloWord.bpmn\")\n                            .addClasspathResource(\"diagrams/HelloWord.png\")\n                            .deploy();\n    \n    System.out.println(deploy.getId() + \"。。。\" + deploy.getName());\n}\n```\n\n**部署流程会改变3张表**\n\n - act_re_deployment\n\t存放流程定义的显示名和部署时间，每部署一次增加一条记录\n - act_re_procdef\n\t存放流程定义的属性信息，部署每个新的流程定义都会在这张表中增加一条记录。\n - act_ge_bytearray\n\t存储流程定义相关的部署信息。即流程定义文档的存放地。每部署一次就会增加两条记录，一条是关于bpmn规则文件的，一条是图片的（如果部署时只指定了bpmn一个文件，activiti会在部署时解析bpmn文件内容自动生成流程图）。两个文件不是很大，都是以二进制形式存储在数据库中。\n\n## 4.3 查看流程定义\n\n```java\n@Test\npublic void view() {\n    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();\n    List<ProcessDefinition> list = repositoryService.createProcessDefinitionQuery()\n                                        //过滤条件\n                                        .processDefinitionKey(\"HelloWorld\")\n                                        //.processDefinitionId(processDefinitionId)\n                                        //分页\n                                        //.listPage(firstResult, maxResults)\n                                        //排序\n                                        //.orderByProcessDefinitionVersion()\n                                        //执行查询\n                                        .list();\n    for (ProcessDefinition processDefinition : list) {\n        System.out.print(\"id:\" + processDefinition.getId() + \",\");//流程Id\n        System.out.print(\"key:\" + processDefinition.getKey() + \",\");//流程Key\n        System.out.print(\"name:\" + processDefinition.getName() + \",\");//流程名字\n        System.out.print(\"version:\" + processDefinition.getVersion() + \",\");//流程版本\n        System.out.println(\"deploymentId():\" + processDefinition.getDeploymentId());//流程部署对象Id\n    }\n}\n```\n查询结果\n\n    id:HelloWorld:1:35004,key:HelloWorld,name:请假审批流程,version:1,deploymentId():35001\n再部署一次，再查询\n\n    id:HelloWorld:1:35004,key:HelloWorld,name:请假审批流程,version:1,deploymentId():35001\n    id:HelloWorld:2:37504,key:HelloWorld,name:请假审批流程,version:2,deploymentId():37501\n    \n说明：\n    \n\n 1. 因为流程定义的信息在仓库中，实际在act_re_*表中，所以创建RepositoryService\n 2. 创建查询对象**ProcessDefinitionQuery**，设置查询参数，调用list()执行查询\n 3. 由查询结果可知：\n    3.1 流程定义的key和name与流程文件的id和name一致\n\n    ```xml\n    <process id=\"HelloWorld\" name=\"请假审批流程\" isExecutable=\"true\">\n    ```\n    3.2 key属性被用来区别不同的流程定义。\n    3.3 带有特定key的流程定义第一次部署时，version为1。之后每次部署都会在当前最高版本号上加1\n    3.4 Id的生成规则为：**{processDefinitionKey}:{processDefinitionVersion}:{generated-id}**，这里的generated-id是一个自动生成的唯一的数字\n    3.5 重复部署一次，deploymentId的值以一定的形式变化\n    \n## 4.4 删除流程定义\n\n删除部署到activiti中的流程定义。如:删除请假流程定义，则大家再也不能请假了。\n\n```java\n@Test\npublic void delete() {\n    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();\n    String deploymentId = \"7501\";\n    //如果有关联信息，会报错\n    //repositoryService.deleteDeployment(deploymentId);\n    //如果有关联信息，会级联删除\n    repositoryService.deleteDeployment(deploymentId, true);\n}\n```\n\n## 4.5 获取流程定义文档资源\n\n```java\n@Test\npublic void getResource() throws IOException {\n    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();\n   \n    String deploymentId = \"35001\";\n    String resourceName = null;\n    //资源文件名,即act_re_bytearray表中的name\n    List<String> names = repositoryService.getDeploymentResourceNames(deploymentId);\n    for (String str : names) {\n        //过滤出特定的图片文件\n        if (str.indexOf(\"HelloWorld.png\") != -1) {\n            resourceName = str;\n        }\n    }\n    System.out.println(resourceName);\n    if (resourceName != null) {\n        //通过部署ID和文件名获得输入流\n        InputStream inputStream = repositoryService.getResourceAsStream(deploymentId, resourceName);\n        File file = new File(\"D:/\"+ resourceName);\n        FileUtils.copyInputStreamToFile(inputStream, file);\n    }\n}\n```\n    \n# 5 流程实例\n\n## 5.1 启动流程实例\n\n```java\n@Test\npublic void startProcess() {\n    RuntimeService runtimeService = ProcessEngines.getDefaultProcessEngine().getRuntimeService();\n    //根据流程Id启动流程\n    //ProcessInstance processInstance = runtimeService.startProcessInstanceById(processDefinitionId);\n    //根据流程key启动流程，会自动找到版本最高的流程定义来创建\n    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(\"HelloWorld\");\n    System.out.println(processInstance.getId());//流程实例Id\n    System.out.println(processInstance.getActivityId());//流程当前节点Id\n}\n```\n    启动流程实例有很多重载方法，根据实际需要选用。\n\n## 5.2 查询任务\n\n在Activiti中，任务主要分为两类：\n\n 1. 确切指定了办理者的任务，之歌任务称为制定者的私人任务\n 2. 2.无法指定具体的某一个人来办理的任务，可以把任务分配给几个人或者一到\t多个小组，让这个范围内的用户可以选择性（如有空余时间时）来办理这类任务。\n\n```java\n@Test\npublic void taskQuery() {\n    TaskService taskService = ProcessEngines.getDefaultProcessEngine().getTaskService();\n    List<Task> list = taskService.createTaskQuery()\n            //查询指定用户的私人任务\n            //.taskAssignee(\"指定用户\")\n            //查询某人可接的共有任务\n            //.taskCandidateUser(\"候选用户\")\n            //排序\n            .orderByTaskCreateTime().desc()\n            //执行查询\n            .list();\n    for (Task task : list) {\n        System.out.println(\"id:\" + task.getId());\n        System.out.println(\"name:\" + task.getName());\n        System.out.println(\"assignee:\" + task.getAssignee());\n        System.out.println(\"createTime:\" + task.getCreateTime());\n        System.out.println(\"ProcessInstanceId:\" + task.getProcessInstanceId());\n        System.out.println(\"ProcessDefinitionId:\" + task.getProcessDefinitionId());\n    }\n}\n```\n\n## 5.3 认领任务\n\n```java\ntaskService.claim(taskId, userId);\n```\n将任务变为用户的私人任务\n\n## 5.4 办理任务\n\n```java\n//根据任务Id办理任务\ntaskService.complete(taskId);\n//根据任务Id办理任务,并设置任务变量\ntaskService.complete(taskId, variables);\n```\n\nvariables是Map，当设置变量时，会在act_ru_variables表中添加相应条数的数据，变量可以用来执行gateway的判断，后面会讲到gateway。\n\n## 5.5 判断流程是否结束\n\n在流程执行过程中，创建的流程实例ID在整个过程都不会变，当流程结束后，流程实例将被删除。\n\n 1. 从运行库中查询该流程是否还存在\n 2. 从历史库中查询该流程是否存在\n\n```java\n@Test\npublic String checkStatus() {\n    String processInstanceId = \"1213\";\n    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    RuntimeService runtimeService = processEngine.getRuntimeService();\n    //从运行库查询该流程实例是否存在\n    ProcessInstance instance = runtimeService.createProcessInstanceQuery()\n                                    .processInstanceId(processInstanceId)\n                                    .singleResult();\n    //实例不存在，可能未开始或者已结束\n    if (instance == null) {\n        //从历史库查\n        HistoryService historyService = processEngine.getHistoryService();\n        HistoricProcessInstance singleResult = historyService.createHistoricProcessInstanceQuery()\n                                                .processInstanceId(processInstanceId)\n                                                .singleResult();\n        if (singleResult != null && singleResult.getEndTime() != null) {\n            //流程已结束\n            return \"COMPLETE\";\n        } else {\n            //流程未开始\n            return \"NOT_START\";\n        }\n    }\n    return instance.getActivityId();//当前任务节点\n}\n```\n \n# 6 流程历史\n\n在前一个的例子中，大家可能会流程执行完毕后，究竟去了哪里有些疑问。虽然已完成的任务在act_ru_task和act_ru_execution表中都已被删除，但是这些数据还存在activiti的数据库中，作为历史改由HistoryService来管理。\n\n历史是一个组件，它可以捕获发生在进程执行中的信息并永久的保存，与运行时数据不同的是，当流程实例运行完成之后它还会存在于数据库中。\n\n在流程引擎配置对象中可以设置历史记录规则：\n\n```xml\n<bean name=\"processEngineConfiguration\" \n  \t  class=\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\">\n\t<property name=\"databaseSchemaUpdate\" value=\"true\" />\n\t<!--\n\t\tActiviti提供了四种历史级别：\n\t\tnone:不保存任何历史，可以提高性能\n\t\tactiviti:保存所有流程实例、任务、活动信息\n\t\taudit:默认级别,保存所有流程实例、任务、活动、表单\n\t\tfull:保存所有信息,如流程变量\n\t  -->\n\t<property name=\"history\" value=\"activiti\"/>\n```\n由于数据库中保存着历史信息以及正在运行的流程实例信息，在实际项目中对已完成任务的查看频率远不及对代办和可接任务的查看，所以在activiti采用分开管理，把正在运行的交给runtimeService管理，而历史数据交给HistoryService来管理。\n\n对已成为历史的数据主要进行查询操作，我们主要关心两种类型的历史数据：\n\n - **HistoricProcessInstance** 包含当前和已经结束的流程实例信息。\n - **HistoricActivityInstance** 包含一个活动(流程上的节点)的执行信息。\n\n## 6.1 查看历史流程实例\n\n```java\n@Test\npublic void queryHisInstance() {\n    //流程引擎\n    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    //流程定义ID\n    String processDefinitionId = \"HelloWorld:2:37504\";\n    //查询历史流程实例\n    List<HistoricProcessInstance> list = processEngine.getHistoryService().createHistoricProcessInstanceQuery()\n                                        .processDefinitionId(processDefinitionId)\n                                        .finished()\n                                        .orderByProcessInstanceStartTime().desc()\n                                        .list();\n    for (HistoricProcessInstance hp : list) {\n        System.out.println(\"ID：\"+hp.getId());\n        System.out.println(\"startTime：\"+hp.getStartTime());\n        System.out.println(\"endTime：\"+hp.getEndTime());\n    }\n}\n```\n\n1.通常查询历史流程实例都需要指定一个过滤条件，指定\tprocessDefinitionId查看具体某一次部署所开启的流程或者指定\tprocessDefinitionKey查看某个规则下不限版本的所有流程\n\n2.可以选择性添加finished方法控制是否查询未完成的流程实例。在流\t程开启时，activiti同时在act_ru_execution表和act_hi_procinst表中\t创建了一条记录，在流程完成之前act_hi_procinst表中实例的结束时间为空\n\n\n## 6.2 查看历史流程活动（节点）\n\n```java\n@Test\npublic void queryHisActiviti() {\n    //流程引擎\n    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    //流程实例ID\n    String processInstanceId = \"HelloWorld:2:37504\";\n    //查询历史流程活动\n    List<HistoricActivityInstance> list = processEngine.getHistoryService()\n                                        //创建历史流程活动实例查询对象\n                                        .createHistoricActivityInstanceQuery()\n                                        //过滤条件\n                                        .processInstanceId(processInstanceId)\n                                        //排序\n                                        .orderByHistoricActivityInstanceStartTime().desc()\n                                        //执行查询\n                                        .list();\n    for (HistoricActivityInstance ha : list) {\n        System.out.println(\"ID：\"+ha.getActivityId());\n        System.out.println(\"name:\"+ha.getActivityName());\n        System.out.println(\"startTime：\"+ha.getStartTime());\n        System.out.println(\"endTime：\"+ha.getEndTime());\n    }\n}\n```\n\n通常查询历史流程活动都需要指定一个过滤条件，指定processInstanceId查看具体某一次流程执行过程中所经历的步奏\n\n# 7 流程变量\n\n流程变量在整个工作流中扮演很重要的作用。例如：请假流程中有请假天数、请假原因等一些参数都为流程变量的范围。\n流程变量的作用域范围是流程实例。也就是说各个流程实例的流程变量是不相互影响的。\n流程实例结束完成以后流程变量是否保存在数据库中取决于存储策略，见第六章。\n![流程变量][7]\n\n## 7.1 添加流程变量\n\n 1. 启动流程实例时添加\n    ```java\n    @Test\n    public void addVariables() {\n        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n        RuntimeService runtimeService = processEngine.getRuntimeService();\n        \n        String processDefinitionKey = \"HelloWorld\";\n        Map<String,Object> variables = new HashMap<>();\n        variables.put(\"请假天数\", 3);\n        variables.put(\"请假原因\", \"约会\");\n        ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(processDefinitionKey, variables);\n    }\n    ```\n    说明：\n        1)\t在启动流程实例时，通过重载startProcessInstanceByKey的方法可以加载流程变量。\n        2)\t第二个参数要求是Map<String ,Object>类型，意味着可以添加多个流程变量。\n        3)\t当这段代码执行完以后，会在数据库表act_ru_variable中添加两行记录。\n        \n\n 2. 完成任务时添加\n    ```java\n    //办理过程中\n    taskService.setVariables(taskId, variables);\n    //提交时\n    taskService.complete(taskId, variables);\n    ```\n    \n 3. 执行流程实例时添加\n    ```java\n    //执行流程实例时\n    runtimeService.setVariables(executionId, variables);\n    //流程实例提交时\n    runtimeService.signal(executionId, processVariables);//signal用于接受任务\n    ```\n    \n## 7.2 获取流程变量\n\n```java\n//某个流程的变量\nruntimeService.getVariables(executionId);\n//某个任务的变量\ntaskService.getVariables(taskId);\n```\n\n说明：这些流程变量是从act_ru_variable这个表中读出来的。\n\n## 7.3 流程变量范围\n\n![此处输入图片的描述][8]\n\n从图中可以看出包括了大部分封装类型和Date、String和实现了Serializable接口的类的类型。\n\n## 7.4 Javabean类型变量\n\n 1. 定义一个javabean，这个javabean实现了Serializable接口\n 2. 实例化javaBean，放到map中，然后正常设置流程变量\n 3. 正常取出变量\n\n# 8 流程定义语言\n\n## 8.1 流程（Process）\n\nbpmn文件一个流程的根元素。一个流程就代表一个工作流。\n\n## 8.2 顺序流（sequenceFlow）\n\n顺序流是连接两个流程节点的连线，代表一个节点的出口。流程执行完一个节点后，会沿着节点的所有外出顺序流继续执行。 就是说，BPMN 2.0默认的行为就是并发的： 两个外出顺序流会创造两个单独的，并发流程分支。\n\n顺序流主要由4个属性组成：\n\n - Id: 唯一标示，用来区分不同的顺序流\n - sourceRef：连线的源头节点ID\n - targetRef：连线的目标节点ID\n - name（可选）：连线的名称，不涉及业务，主要用于显示\n\n## 8.3 节点\n\n### 8.3.1 开始事件节点(startEvent)\n开始事件用来指明流程在哪里开始。开始事件的类型（流程在接收事件时启动， 还是在指定时间启动，等等），定义了流程如何启动， 这通过事件中不同的小图表来展示。 在XML中，这些类型是通过声明不同的子元素来区分的。\n![此处输入图片的描述][9]\n\n 1. 空开始事件\n    空开始事件技术上意味着没有指定启动流程实例的触发条件。最常用的一种开始，意味着流程的启动需要手动触发，通过调用api的startProcessInstanceByXXX方法。\n    ```java\n    ProcessInstance processInstance = runtimeService.startProcessInstanceByXXX()\n    ```\n    图形标记：空开始事件显示成一个圆圈，没有内部图表（没有触发类型）\n    XML结构如下：\n    ```xml\n    <startEvent id=\"startevent\" name=\"Start\"></startEvent>\n    ```\n\n 2. 定时开始事件\n\n    定时开始事件用来在指定的时间创建流程实例。 它可以同时用于只启动一次的流程 和应该在特定时间间隔启动多次的流程。\n\n        注意：\n        1.子流程不能使用定时开始事件。\n        2.定时开始事件在流程发布后就会开始计算时间。不需要调用startProcessInstanceByXXX，虽然也而已调用启动流程的方法，但是那会导致调用startProcessInstanceByXXX时启动过多的流程。\n        3.当包含定时开始事件的新版本流程部署时，对应的上一个定时器就会被删除。这是因为通常不希望自动启动旧版本流程的流程实例。\n    \n    图形标记：定时开始事件显示为一个圆圈，内部是一个表。\n    XML内容：定时开始事件的XML内容是普通开始事件的声明，包含一个定时定义子元素。 \n    示例：流程会启动4次，每次间隔5分钟，从2013年9月18日，12:10开始计时。\n    ```xml\n    <startEvent id=\"theStart\">\n        <timerEventDefinition>                \n\t\t    <timeCycle>R4/2017-11-22T11:04/PT5M</timeCycle>            \t\t \n\t    </timerEventDefinition>\n    </startEvent> \n    ```\n    示例：流程会根据选中的时间启动一次。\n    ```xml\n    <startEvent id=\"theStart\">\n        <timerEventDefinition>                \n\t\t    <timeDate>2017-12-31T23:59:59</timeDate>               \t\t \n\t    </timerEventDefinition>\n    </startEvent> \n    ```\n \n### 8.3.2 结束事件节点(endEvent)\n\n结束事件表示（子）流程（分支）的结束。结束事件都是触发事件。这是说当流程达结束事件，会触发一个结果。 结果的类型是通过事件的内部黑色图标表示的。\n![结束事件][10]\n\n 1. 空结束事件\n \n    空结束事件意味着到达事件时不会指定抛出的结果。这样，引擎会直接结束当前执行的分支，不会做其他事情。\n    图形标记:空结束事件是一个粗边圆圈，内部没有小图表（无结果类型）\n    XML内容:空结束事件的XML内容是普通结束事件定义，不包含子元素（其他结束事件类型都会包含声明类型的子元素）。\n    ```xml\n    <endEvent id=\"end\" name=\"my end event\"/>\n    ```\n\n### 8.3.3 任务节点(Task)\n\n![任务节点][11]\n\n 1. 用户任务节点\n    用户任务用来设置必须由人员完成的工作。当流程执行到用户任务，会创建一个新任务，并把这个新任务加入到分配人或群组的任务列表中。\n    图形标记：用户任务显示成一个普通任务（圆角矩形），左上角有一个小用户图标。\n    XML内容：XML中的用户任务定义如下。id属性是必须的。 name属性是可选的。\n    ```xml\n    <userTask id=\"theTask\" name=\"Important task\"/>  \n    ```\n    用户任务也可以设置描述(实际上所有BPMN 2.0元素都可以设置描述)。 添加documentation元素可以定义描述。\n    ```xml\n    <userTask id=\"theTask\" name=\"Schedule meeting\">  \n    <documentation>\n        Schedule an engineering meeting for next week with the new hire.  \n    </documentation>\n    ```\n    在实际应用中，用户接到任务后可以参照任务描述来办理任务，描述文本可以通过标准的java方法来获得：\n    ```java\n    task.getDescription() \n    ```\n**私人任务**\n    私有任务即有直接分配给指定用户的任务。只有一个用户可以成为任务的执行者。 在activiti中，用户叫做执行者。 拥有执行者的用户任务（即私有任务）对其他用户是不可见的。只能出现执行者的个人任务列表中.\n    直接把用户任务分配给指定用户使用assignee属性，XML代码如下：\n    ```xml\n    <userTask id=\"theTask\" name=\"my task\" activiti:assignee=\"username\"/>\n    ```\n    Assignee属性对应的值为一个用户的ID。\n    直接分配给用户的任务可以通过TaskService像下面这样办理：\n    ```java\n    List<Task>tasks =taskService.createTaskQuery().taskAssignee(\"sirius\").list();\nTask task = tasks.get(0);// 假设任务集合的第一条是要办理的任务\ntaskService.complete(task.getId());\n\n    ```\n **公有任务**\n    有的用户任务在指派时无法确定具体的办理者，这时任务也可以加入到\t人员的候选任务列表中，然后让这些人员选择性认领和办理任务。\n    \n    公有任务的分配可以分为指定候选用户和候选组两种。\n\n    -  把任务添加到一批用户的候选任务列表中，使用candidateUsers\t属\t性，XML内容如下:\n    ```xml\n    <userTaskid=\"theTask\"name=\"my task\"activiti:candidateUsers=\"sirius,kermit\"/>\n    ```\n    candidateUsers属性内为用户的ID，多个用户ID之间使用（半角）逗号间隔。\n    \n     - 把任务添加到一个或多个候选组下，这时任务对组下的所有用户可见，首先得保证每个组下面有用户，通过IdentityService对象创建用户和组，然后把用户添加到对应的组下。然后配置组任务，使用candidateGroups属性，XML内容如下：\n    ```xml\n    <userTask id=\"theTask\" name=\"my task\" activiti:candidateGroups=\"testGroup，developGroup\"/>\n    ```\n    间接分配给用户的任务，可以通过TaskService像下面这样操作：\n    ```java\n    List<Task>tasks =taskService.createTaskQuery()\n\t\t\t\t.taskCandidateUser(\"sirius\").list();\n    Task task = tasks.get(0);// 假设任务集合的第一条是要办理的任务\n    String taskId = task.getId();\n    taskService.claim(taskId ,“sirius”); //认领任务，让用户成为任务的执行者\n    taskService.complete(taskId );\n    ```\n\n    说明：\n    \n     1. 要维护用户和组得使用用户管理服务对象，使用\t\tprocessEngine\t得到IdentityService。\n     2. 要分配组任务必须先创建组，而且组下得有用户，用户和组的\t最关键属性是ID。\n     3. 使用newUser（userId）和newGroup（groupId）创建用户和组。\n     4. 使用createMembership（userId，groupId）把用户挂到组下。\n     5. 办理候选任务，首先得认领任务，让用户成为任务的执行者\n    \n    如果上面的方式还不够灵活，那么我们也可以自定义一个任务分配处理器，通过代码的方式来动态设置任务的属性。XML代码如下：\n    ```xml\n    <userTask id=\"task1\" name=\"My task\"> \n        <extensionElements>    \n            <activiti:taskListener event=\"create\" class=\"org.activiti.MyAssignmentHandler\"/>  \n        </extensionElements>\n    </userTask>\n    ```\n    DelegateTask会传递给TaskListener的实现，通过它可以设置执行人，候选人和候选组：\n    ```java\n    Public class MyAssignmentHandler implements TaskListener {\n      \n        Public void notify(DelegateTask delegateTask){ \n    \t// 执行用户搜索相关代码    \n    \t...\n    \t// 然后把获取到的用户通过下面方法，设置给当前触发事件的任务\n        \tdelegateTask.setAssignee(\"sirius\");\n        \t//delegateTask.addCandidateUser(\"kermit\");\n       \t//delegateTask.addCandidateGroup(\"testGroup\"); \n       \t...  \n        }\n    }\n    ```\n\n 2. 接收任务节点（receiveTask）\n\n    接收任务是一个简单任务，它会等待对应消息的到达。当前，官方只实现了这个任务的java语义。 当流程达到接收任务，流程状态会保存到数据库中。在任务创建后，意味着流程会进入等待状态，直到引擎接收了一个特定的消息，这会触发流程穿过接收任务继续执行。\n    \n    图形标记：接收任务显示为一个任务（圆角矩形），右上角有一个消息小标记。 消息是白色的（黑色图标表示发送语义）。\n    \n    XML内容：\n    ```xml\n    <receiveTask id=\"waitState\" name=\"wait\"/> \n    ```\n    \n    当前任务（一般指机器自动完成，但需要耗费一定时间的工作）完成后，向后推移流程，可以调用runtimeService.signal(executionId)，传递接收任务上流程的id。\n    ```java\n    ProcessInstance pi = runtimeService.startProcessInstanceByKey(\"receiveTask\");\n    Execution execution = runtimeService.createExecutionQuery()\n                            .processInstanceId(pi.getId())\n                            .activityId(\"waitState\")\n                            .singleResult();\n    runtimeService.signal(execution.getId());  \n    ```\n    \n----------\n\n述两个虽然都可以统称为任务节点，但是还是有本质区别：\n\n 1. receiveTask主要代表机器自动执行的，userTask代表人工干预的。\n 2. eiveTask任务产生后会在act_ru_execution表中新增一条记录，\t而userTask产生后会在act_ru_execution和act_ru_task（主要记录任\t务的发布时间，办理人等信息）中各产生一条记录。\n 3. receiveTask任务提交方式使用RuntimeService的signal方法提交，\tuserTask任务提交方式使用TaskService的complete方法提交。\n\n \n### 8.3.4 网关（gateWay）\n![网关][12]\n\n 1. 排他网关\n    排他网关（也叫异或（XOR）网关，或更技术性的叫法基于数据的排他网关），用来在流程中实现决策。\n    \n    **图形标记**:排他网关显示成一个普通网关（比如，菱形图形）,内部是一个“X”图标,表示异或（XOR）语义。注意，没有内部图标的网关，默认为排他网关。BPMN2.0规范不允许在同一个流程定义中同时使用没有X和有X的菱形图形。\n    \n    **XML内容**:排他网关的XML内容是很直接的：用一行定义了网关,条件表达式定义在外出顺序流中。参考条件顺序流 获得这些表达式的可用配置。\n    ![排他网关][13]\n    ```xml\n    <exclusiveGatewayid=\"exclusiveGw\"name=\"Exclusive Gateway\"/>\n    <sequenceFlow id=\"flow2\" sourceRef=\"exclusiveGw\" targetRef=\"theTask1\">  \n        <conditionExpressionxsi:type=\"tFormalExpression\">${input == 1}</conditionExpression> \n    </sequenceFlow>\t\n    <sequenceFlow id=\"flow3\" sourceRef=\"exclusiveGw\" targetRef=\"theTask2\">   \n        <conditionExpressionxsi:type=\"tFormalExpression\">${input == 2}</conditionExpression> \n    </sequenceFlow>\n    <sequenceFlow id=\"flow4\" sourceRef=\"exclusiveGw\" targetRef=\"theTask3\">  \n        <conditionExpressionxsi:type=\"tFormalExpression\">${input == 3}</conditionExpression> \n    </sequenceFlow>\n    ```\n    \n    说明：\n    1.一个排他网关对应一个以上的顺序流\n    2.由排他网关流出的顺序流都有个conditionExpression元素，在内部维护返回boolean类型的决策结果。\n    3.决策网关只会返回一条结果。当流程执行到排他网关时，流程引擎会自动检索网关出口，从上到下检索如果发现第一条决策结果为true或者没有设置条件的(默认为成立)，则流出。\n    4.如果没有任何一个出口符合条件则抛出异常。\n\n 2. 并行网关\n \n    网关也可以表示流程中的并行情况。最简单的并行网关是parallelGateWay，它允许将流程分成多条分支，也可以把多条分支汇聚到一起。\n\n    **图形标记**：并行网关显示成一个普通网关（菱形）内部是一个“加号”图标，表示“与（AND）”语义。\n    ![并行网关][14]\n    \n    **XML内容**：定义并行网关只需要一行\n    ```xml\n    <parallelGateway id=\"myParallelGateway\"/>\n    ```\n    实际发生的行为（分支，聚合，同时分支聚合），要根据并行网关的顺序流来决定。\n    ```xml\n    <startEvent id=\"theStart\"/>\n\n    <sequenceFlow id=\"flow1\" sourceRef=\"theStart\" targetRef=\"fork\"/>\n    <parallelGateway id=\"fork\"/> \n     \n    <sequenceFlow sourceRef=\"fork\" targetRef=\"receivePayment\"/>\n    <sequenceFlow sourceRef=\"fork\" targetRef=\"shipOrder\"/>\n        \n    <userTaskid=\"receivePayment\"name=\"Receive Payment\"/>\n    <sequenceFlow sourceRef=\"receivePayment\" targetRef=\"join\"/>\n       \n    <userTaskid=\"shipOrder\"name=\"Ship Order\"/>\n    <sequenceFlow sourceRef=\"shipOrder\" targetRef=\"join\"/>\n    \n    <parallelGateway id=\"join\"/>\n    <sequenceFlow sourceRef=\"join\" targetRef=\"archiveOrder\"/>\n     \n    <userTask id=\"archiveOrder\"name=\"Archive Order\"/>\n    <sequenceFlow sourceRef=\"archiveOrder\" targetRef=\"theEnd\"/>\n             \n    <endEventid=\"theEnd\"/>\n    ```\n    上面例子中，流程启动之后，会创建两个任务：\n    ```java\n    ProcessInstancepi =runtimeService.startProcessInstanceByKey(\"forkJoin\");\n    \n    List<Task> tasks = taskService.createTaskQuery().list();\n    Task task1 =tasks.get(0);\n    System.out.println(\"Receive Payment\"+task1.getName());\n    Task task2 =tasks.get(1);\n    System.out.println(\"Ship Order\"+task2.getName());\n    ```\n    当两个任务都完成时，第二个并行网关会汇聚两个分支，因为它只有一条外出连线，不会创建并行分支，只会创建归档订单任务。\n    \n    说明：\n    1.并行网关的功能是基于进入和外出的顺序流的：\n        分支(fork)：并行后的所有外出顺序流，为每个顺序流都创建一个并发分支。\n        汇聚(join)：所有到达并行网关，在此等待的进入分支，直到所有进入顺序流的分支都到达以后， 流程就会通过汇聚网关。\n    2.并行网关的进入和外出都是使用相同节点标示\n    3.如果同一个并行网关有多个进入和多个外出顺序流，它就同时具有分支和汇聚功能。这时，网关会先汇聚所有进入的顺序流，然后再切分成多个并行分支。\n    4.并行网关不会解析条件。 即使顺序流中定义了条件，也会被忽略。\n    5.并行网关不需要是“平衡的”（比如，对应并行网关的进入和外出节点数目相等）。如图中标示是合法的：\n    ![并行网关不需要是“平衡的”][15]\n \n## 8.4 监听器（Listener）\n\n在流程中我们有时会对整个流程或者一个节点的某种状态做出相应的处理。这时就会用到监听器。\n\n在Activiti中流程的监听主要分为两大类，执行监听器和任务监听器。\n\n### 8.4.1 执行监听器（ExecutionListener）\n\n执行监听器可以执行外部java代码或执行表达式，当流程定义中发生了某个事件。 可以捕获的事件有:\n\n - 流程实例的启动和结束。\n - 选中一条连线。\n - 节点的开始和结束。\n - 网关的开始和结束。\n - 中间事件的开始和结束。\n - 开始事件结束或结束事件开始。\n\n现在有这样一个简单流程，只包含开始、结束、接收任务和用户任务4个节点：\n![监听器流程示例][16]\n配置监听器,XML代码如下\n```xml\n<extensionElements>\n      <activiti:executionListener event=\"start\" class=\"test.ProcessStartListener\"></activiti:executionListener>\n</extensionElements>\n```\n说明：\n\n - 任务监听器支持以下属性：\n    \n    - event（必选）：任务监听器会被调用的任务类型\n        - start：流程节点创建后触发\n        - end：当任务完成，并尚未从运行数据中删除时触发\n        - take：任务完成后，流程流出时触发\n    - class(必选)：代理类，实现org.activiti.engine.delegate.ExecutionListener接口。\n    示例：\n    ```java\n    public class ProcessStartListener implements ExecutionListener {\n\n    private static final long serialVersionUID = 1L;\n\n    @Override\n    public void notify(DelegateExecution execution) throws Exception {\n            System.out.println(\"ID:\"+execution.getId()+\", Name:\"+execution.getCurrentActivityName());\n        }\n    \n    }\n    ```\n\n - 执行监听器配置可以放在以下三个地方，如图\n![此处输入图片的描述][17]\n\n    a)\t监听整个流程的启动和结束状态，配置为process节点的子元素，如①\n    b)\t监听一个节点的启动和结束状态，配置为一个节点的子元素，如②和③\n    c)\t监听一条连线的执行，配置在sequenceFlow节点的内部，只有task一种事件，如④\n    \n启动流程测试代码如下：\n```java\n@Test\npublic void Demo1() {\n    //部署流程\n    Deployment deployment = repositoryService.createDeployment()\n                .addClasspathResource(\"diagrams/Listener.bpmn\")\n                .addClasspathResource(\"diagrams/Listener.png\")\n                .deploy();\n    //启动\n    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(\"ListenerTest\");\n    //推动\n    String processInstanceId = processInstance.getId();\n    runtimeService.signal(processInstanceId);\n    \n    String id = taskService.createTaskQuery().processInstanceId(processInstanceId).singleResult().getId();\n    taskService.complete(id);\n}\n```\n\n测试结果如下：\n\n        ID:60005, Name:开始\n        ID:60005, Name:接收任务\n        ID:60005, Name:用户任务\n\n### 8.4.2 任务监听器（TaskListener）\n\n任务监听器可以在发生对应的任务相关事件时执行自定义java逻辑 或表达式。\n任务监听器只能添加到流程定义中的用户任务中。在之前任务节点上添加任务监听:\n![此处输入图片的描述][18]\n\n任务监听器支持以下属性\n\n- event（必选）：任务监听器会被调用的任务类型。 可能的类型为：\n    - create：任务创建并设置所有属性后触发。\n    - assignment：任务分配给一些人时触发。当流程到达userTask，assignment事件 会在create事件之前发生。这样的顺序似乎不自然，但是原因很简单：当获得create时间时， 我们想获得任务的所有属性，包括执行人。\n    - complete：当任务完成，并尚未从运行数据中删除时触发。\n- class：必须调用的代理类。 这个类必须实现org.activiti.engine.delegate.TaskListener\t接口。\n\n\n----------\n\n新添加的任务监听包裹在executionListener监听的内部，顺序为：execution Start--> task Assignment-->task Create-->task Complete-->execution End-->execution take。\n\n\n# 9 Spring集成\n\n虽然前面的例子中我们可以自己手动来创建相应的API实例，但是在一个项目中这些API都应该以**单例形式**存在的。和Spring的集成主要就是把Activiti的主要对象交给Spring容器管理。\n\n```xml\n<!-- 流程引擎 -->\n<bean id=\"processEngine\" class=\"org.activiti.spring.ProcessEngineFactoryBean\"> \n\t<property name=\"processEngineConfiguration\" ref=\"processEngineConfiguration\"></property>\n</bean>\n\n<!-- 流程引擎配置对象 -->\n<bean id=\"processEngineConfiguration\" class=\"org.activiti.spring.SpringProcessEngineConfiguration\">\n\t<property name=\"dataSource\" ref=\"dataSource\" />\n\t<property name=\"transactionManager\" ref=\"transactionManager\" />\n\t<!-- activiti表数据更新策略 false true（默认） create-drop-->\n\t<property name=\"databaseSchemaUpdate\" value=\"true\" />\n\t<!-- activiti历史数据保存策略 none activity audit(默认) full-->\n\t<property name=\"history\" value=\"audit\" />\n\t<!-- 管理线程计时器和异步消息,默认开启，但有ManagementService替代，避免冲突所以关闭 -->\n\t<property name=\"jobExecutorActivate\" value=\"false\" />\n\t<!-- 加载资源文件 -->\n\t<property name=\"deploymentResources\" value=\"classpath:/activiti-process/*.bpmn\" />\n</bean>\n\n<!-- 核心业务类 -->\n<bean id=\"repositoryService\" factory-bean=\"processEngine\" factory-method=\"getRepositoryService\" />\n<bean id=\"runtimeService\" factory-bean=\"processEngine\" factory-method=\"getRuntimeService\" />\n<bean id=\"taskService\" factory-bean=\"processEngine\" factory-method=\"getTaskService\" />\n<bean id=\"historyService\" factory-bean=\"processEngine\" factory-method=\"getHistoryService\" />\n<bean id=\"managementService\" factory-bean=\"processEngine\" factory-method=\"getManagementService\" />\n```\n\n**注意：**\n 1. ProcessEngineConfiguration\n    单独使用和整合Spring时不是同一个class\n    独立使用：org.activiti.engine.ProcessEngineConfiguration\n    整合Spring：org.activiti.spring.SpringProcessEngineConfiguration\n 2. 项目部署后会自动在数据库中创建相关流程定义\n\n \n\n \n \n \n  \n\n\n  \n\n\n  [1]: https://www.zybuluo.com/mdeditor#785927\n  [2]: http://blog.csdn.net/dr_guo/article/details/50718063\n  [3]: http://activiti.org/download.htmlt/dr_guo/article/details/50718063\n  [4]: http://pan.baidu.com/s/1qYmgdlE\n  [5]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/create.png\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/example.png\n  [7]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/variable.png\n  [8]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/baseVar.png\n  [9]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/startEvent.png\n  [10]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/endEvent.png\n  [11]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/task.png\n  [12]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/gateWay.png\n  [13]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/xor.png\n  [14]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/parallelGateWay.png\n  [15]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/binxing.png\n  [16]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/listenerExample.png\n  [17]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/taskListener.png\n  [18]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/taskListener2.png","slug":"Activiti5-流程框架","published":1,"updated":"2018-02-27T07:38:38.082Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspda0000n8vftu1mhrpc","content":"<p>工作流(Workflow)，就是“业务过程的部分或整体在计算机应用环境下的自动化”，它主要解决的是“使在多个参与者之间按照某种预定义的规则传递文档、信息或任务的过程自动进行，从而实现某个预期的业务目标，或者促使此目标的实现”。<br><a id=\"more\"></a></p>\n<h1 id=\"1-Activiti简介\"><a href=\"#1-Activiti简介\" class=\"headerlink\" title=\"1 Activiti简介\"></a>1 Activiti简介</h1><p>Activiti5是由Alfresco软件在2010年5月17日发布的业务流程管理（BPM）框架，它是覆盖了业务流程管理、工作流、服务协作等领域的一个开源的、灵活的、易扩展的可执行流程语言框架。Activiti基于Apache许可的开源BPM平台，创始人Tom Baeyens是JBoss jBPM的项目架构师，它特色是提供了eclipse插件，开发人员可以通过插件直接绘画出业务流程图。</p>\n<h2 id=\"1-1-工作流引擎\"><a href=\"#1-1-工作流引擎\" class=\"headerlink\" title=\"1.1 工作流引擎\"></a>1.1 工作流引擎</h2><p>这是Activiti的核心，负责生成流程运行时的各种实例及数据、监控和管理流程的运行。</p>\n<h2 id=\"1-2-BPMN2-0\"><a href=\"#1-2-BPMN2-0\" class=\"headerlink\" title=\"1.2 BPMN2.0\"></a>1.2 BPMN2.0</h2><p>业务流程建模与标注（Business Process Model and Notation，BPMN) ，描述流程的基本符号，包括这些图元如何组合成一个业务流程图（Business Process Diagram）</p>\n<h2 id=\"1-3-数据库\"><a href=\"#1-3-数据库\" class=\"headerlink\" title=\"1.3 数据库\"></a>1.3 数据库</h2><p>Activiti的后台是有数据库的支持，所有的表都以ACT_开头。第二部分是表示表的用途的两个字母标识。 用途也和服务的API对应。</p>\n<ol>\n<li><strong>ACT<em>RE</em>*</strong>: ‘RE’表示repository。 这个前缀的表包含了流程定义和流程静态资源 （图片，规则，等等）。</li>\n<li><strong>ACT<em>RU</em>*</strong>: ‘RU’表示runtime。 这些运行时的表，包含流程实例，任务，变量，异步任务，等运行中的数据。 Activiti只在流程实例执行过程中保存这些数据， 在流程结束时就会删除这些记录。 这样运行时表可以一直很小速度很快。</li>\n<li><strong>ACT<em>ID</em>*</strong>: ‘ID’表示identity。 这些表包含身份信息，比如用户，组等等。</li>\n<li><strong>ACT<em>HI</em>*</strong>: ‘HI’表示history。 这些表包含历史数据，比如历史流程实例， 变量，任务等等。</li>\n<li><strong>ACT<em>GE</em>*</strong>: 通用数据， 用于不同场景下。</li>\n</ol>\n<h3 id=\"1-3-1-资源库流程规则表\"><a href=\"#1-3-1-资源库流程规则表\" class=\"headerlink\" title=\"1.3.1 资源库流程规则表\"></a>1.3.1 资源库流程规则表</h3><ol>\n<li>act_re_deployment  部署信息表</li>\n<li>act_re_mode        流程设计模型部署表</li>\n<li>act_re_procdef     流程定义表</li>\n</ol>\n<h3 id=\"1-3-2-运行时数据库\"><a href=\"#1-3-2-运行时数据库\" class=\"headerlink\" title=\"1.3.2 运行时数据库\"></a>1.3.2 运行时数据库</h3><ol>\n<li>act_ru_execution    运行时流程执行实例表</li>\n<li>act_ru_identitylink 运行时流程人员表，主要存储任务节点与参与者的相关信息</li>\n<li>act_ru_task            运行时任务节点表</li>\n<li>act_ru_variable        运行时流程变量数据表</li>\n</ol>\n<h3 id=\"1-3-3-历史数据库表\"><a href=\"#1-3-3-历史数据库表\" class=\"headerlink\" title=\"1.3.3 历史数据库表\"></a>1.3.3 历史数据库表</h3><ol>\n<li>act_hi_actinst             历史节点表</li>\n<li>act_hi_attachment        历史附件表</li>\n<li>act_hi_comment            历史意见表</li>\n<li>act_hi_identitylink        历史流程人员表</li>\n<li>act_hi_detail            历史详情表，提供历史变量的查询</li>\n<li>act_hi_procinst            历史流程实例表</li>\n<li>act_hi_taskinst            历史任务实例表</li>\n<li>act_hi_varinst            历史变量表</li>\n</ol>\n<h3 id=\"1-3-4-组织机构表\"><a href=\"#1-3-4-组织机构表\" class=\"headerlink\" title=\"1.3.4 组织机构表\"></a>1.3.4 组织机构表</h3><ol>\n<li>act_id_group        用户组信息表</li>\n<li>act_id_info        用户扩展信息表</li>\n<li>act_id_membership    用户与用户组对应信息表</li>\n<li>act_id_user        用户信息表</li>\n</ol>\n<p>这四张表很常见，基本的组织机构管理，关于用户认证方面建议还是自己开发一套，组件自带的功能太简单，使用中有很多需求难以满足 。可以使shiro完成用户认证。</p>\n<h3 id=\"1-3-5-统用数据表\"><a href=\"#1-3-5-统用数据表\" class=\"headerlink\" title=\"1.3.5 统用数据表\"></a>1.3.5 统用数据表</h3><ol>\n<li>act_ge_bytearray        二进制数据表</li>\n<li>act_ge_property        属性数据表存储整个流程引擎级别的数据,初始化表结构时，会默认插入三条记录</li>\n</ol>\n<h2 id=\"1-4-activiti-cfg-xml\"><a href=\"#1-4-activiti-cfg-xml\" class=\"headerlink\" title=\"1.4 activiti.cfg.xml\"></a>1.4 activiti.cfg.xml</h2><p>Activiti核心配置文件，配置流程引擎创建工具的基本参数和数据库连接池参数。</p>\n<p>定义数据库配置参数：</p>\n<ul>\n<li>jdbcUrl: 数据库的JDBC URL。</li>\n<li>jdbcDriver: 对应不同数据库类型的驱动。</li>\n<li>jdbcUsername: 连接数据库的用户名。</li>\n<li>jdbcPassword: 连接数据库的密码。</li>\n</ul>\n<p>基于JDBC参数配置的数据库连接 会使用默认的MyBatis连接池。 下面的参数可以用来配置连接池（来自MyBatis参数）：</p>\n<ul>\n<li>jdbcMaxActiveConnections: 连接池中处于被使用状态的连接的最大值。默认为10。</li>\n<li>jdbcMaxIdleConnections: 连接池中处于空闲状态的连接的最大值。</li>\n<li>jdbcMaxCheckoutTime: 连接被取出使用的最长时间，超过时间会被强制回收。 默认为20000（20秒）。</li>\n<li>jdbcMaxWaitTime: 这是一个底层配置，让连接池可以在长时间无法获得连接时， 打印一条日志，并重新尝试获取一个连接。（避免因为错误配置导致沉默的操作失败）。 默认为20000（20秒）。</li>\n</ul>\n<p>示例如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">name</span>=<span class=\"string\">\"processEngineConfiguration\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcDriver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/activititest\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcUsername\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcPassword\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"123\"</span> /&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- </span></div><div class=\"line\">\tdatabaseSchemaUpdate：设置流程引擎启动和关闭时如何处理数据库表</div><div class=\"line\">\tfalse（默认）:检查数据库表的版本和依赖库的版本，如果不一致就抛出异常</div><div class=\"line\">\ttrue:构建流程引擎是执行检查，如果需要就更新，如果表不存在就创建</div><div class=\"line\">\tcreate-drop：构建流程引擎是创建表，关闭时删除表  </div><div class=\"line\">--&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"databaseSchemaUpdate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>关于c3p0、dbcp等数据库连接池配置请参看<a href=\"https://www.zybuluo.com/mdeditor#785927\" target=\"_blank\" rel=\"noopener\">spring(4)——持久层封装</a></p>\n<h2 id=\"1-5-logging-properties\"><a href=\"#1-5-logging-properties\" class=\"headerlink\" title=\"1.5 logging.properties\"></a>1.5 logging.properties</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">log4j.rootLogger=WARN, stdout</div><div class=\"line\">log4j.appender.stdout=org.apache.log4j.ConsoleAppender</div><div class=\"line\">log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</div><div class=\"line\">log4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - %m%n</div></pre></td></tr></table></figure>\n<p>更详细log4j说明请参看<a href=\"http://blog.csdn.net/dr_guo/article/details/50718063\" target=\"_blank\" rel=\"noopener\">log4j.properties配置详解与实例</a></p>\n<h1 id=\"2-环境搭建\"><a href=\"#2-环境搭建\" class=\"headerlink\" title=\"2 环境搭建\"></a>2 环境搭建</h1><h2 id=\"2-1-需求java环境\"><a href=\"#2-1-需求java环境\" class=\"headerlink\" title=\"2.1 需求java环境\"></a>2.1 需求java环境</h2><ol>\n<li>JDK1.6或更高</li>\n<li>支持的数据库有：h2, mysql, oracle, postgres, mssql, db2等。</li>\n<li>支持activiti5运行的jar包</li>\n<li>开发环境为Eclipse3.7或者以上版本,myeclipse为8.6版本</li>\n</ol>\n<h2 id=\"2-2-资源下载\"><a href=\"#2-2-资源下载\" class=\"headerlink\" title=\"2.2 资源下载\"></a>2.2 资源下载</h2><p>activiti可以到<a href=\"http://activiti.org/download.htmlt/dr_guo/article/details/50718063\" target=\"_blank\" rel=\"noopener\">Activiti官方网站</a>下载得到。</p>\n<p>百度网盘下载地址，5.22.0和6.0.0两个版本，还有eclipse插件。<a href=\"http://pan.baidu.com/s/1qYmgdlE\" target=\"_blank\" rel=\"noopener\">百度网盘下载</a></p>\n<p>注意：安装插件后，在Windows-&gt;Preferences-&gt;Activiti-&gt;Save菜单下勾选保存时自动生成图片。</p>\n<h2 id=\"2-3-配置开发环境\"><a href=\"#2-3-配置开发环境\" class=\"headerlink\" title=\"2.3 配置开发环境\"></a>2.3 配置开发环境</h2><h3 id=\"2-3-1-添加jar包\"><a href=\"#2-3-1-添加jar包\" class=\"headerlink\" title=\"2.3.1 添加jar包\"></a>2.3.1 添加jar包</h3><p>在activiti-5.22.0→wars目录下是一些示例项目，解压activiti-rest项目，导入activiti-rest目录中WEB-INF\\lib下所有jar包到classpath中。<br>注意还需要数据库连接驱动包，如Mysql还需要添加<strong>mysql-connector-java.jar</strong>。</p>\n<h3 id=\"2-3-2-初始化数据库\"><a href=\"#2-3-2-初始化数据库\" class=\"headerlink\" title=\"2.3.2 初始化数据库\"></a>2.3.2 初始化数据库</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createTable</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//1、创建流程引擎配置对象</span></div><div class=\"line\">\tProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration.createStandaloneProcessEngineConfiguration();</div><div class=\"line\">\t<span class=\"comment\">//2、配置数据库</span></div><div class=\"line\">\tprocessEngineConfiguration.setJdbcDriver(<span class=\"string\">\"com.mysql.jdbc.Driver\"</span>);</div><div class=\"line\">\tprocessEngineConfiguration.setJdbcUrl(<span class=\"string\">\"jdbc:mysql://localhost:3306/activititest\"</span>);</div><div class=\"line\">\tprocessEngineConfiguration.setJdbcUsername(<span class=\"string\">\"root\"</span>);</div><div class=\"line\">\tprocessEngineConfiguration.setJdbcPassword(<span class=\"string\">\"123\"</span>);</div><div class=\"line\">\t<span class=\"comment\">//3、设置建表策略</span></div><div class=\"line\">\tprocessEngineConfiguration.setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE);</div><div class=\"line\">\t<span class=\"comment\">//4、创建流程引擎对象</span></div><div class=\"line\">\tProcessEngine processEngine = processEngineConfiguration.buildProcessEngine();</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"processEngine\"</span>+processEngine);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>在Activiti中，在创建核心的流程引擎对象时会自动建表。如果程序正常执行，mysql会自动建库，然后创建23张表。</p>\n<h3 id=\"2-3-3-配置文件\"><a href=\"#2-3-3-配置文件\" class=\"headerlink\" title=\"2.3.3 配置文件\"></a>2.3.3 配置文件</h3><p>在Actiiti5中定制流程必定会操作到数据库，如果都像上面那样写一大段代码会非常麻烦，所以我们可以把数据库连接配置写入配置文件。</p>\n<p>在Activiti5的官方示例中并没有现成的配置文件，所以先得找到activiti-rest\\WEB-INF\\classes下有：<strong>activiti-context.xml</strong>：一个类似spring结构的配置文件，清空内容后改名为activiti.cfg.xml，用来做流程引擎的相关配置。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">name</span>=<span class=\"string\">\"processEngineConfiguration\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcDriver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/activititest\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcUsername\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcPassword\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"123\"</span> /&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- </span></div><div class=\"line\">\tdatabaseSchemaUpdate：设置流程引擎启动和关闭时如何处理数据库表</div><div class=\"line\">\tfalse（默认）:检查数据库表的版本和依赖库的版本，如果不一致就抛出异常</div><div class=\"line\">\ttrue:构建流程引擎是执行检查，如果需要就更新，如果表不存在就创建</div><div class=\"line\">\tcreate-drop：构建流程引擎是创建表，关闭时删除表  </div><div class=\"line\">--&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"databaseSchemaUpdate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>Java代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createTable2</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class=\"string\">\"activiti.cfg.xml\"</span>);</div><div class=\"line\">\tProcessEngine processEngine = processEngineConfiguration.buildProcessEngine();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h1 id=\"3-核心API\"><a href=\"#3-核心API\" class=\"headerlink\" title=\"3 核心API\"></a>3 核心API</h1><h2 id=\"3-1-ProcessEngine\"><a href=\"#3-1-ProcessEngine\" class=\"headerlink\" title=\"3.1 ProcessEngine\"></a>3.1 ProcessEngine</h2><ol>\n<li>在Activiti中最核心的类，其他的类都是由它而来。</li>\n<li><p>产生方式<br>2.1 方式一：最基础版本，见2.3.2小节<br>2.2 方式二：配置文件+java代码，见2.3.3小节</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createTable3</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>这种方式更加简单，会自动加载classpath下名为activiti.cfg.xml的文件。</p>\n</li>\n<li><p>产生各种service</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//流程仓库业务类，管理流程定义、部署</span></div><div class=\"line\">RepositoryService repositoryService = processEngine.getRepositoryService();</div><div class=\"line\"><span class=\"comment\">//流程运行业务类，管理流程启动、推进、删除等操作</span></div><div class=\"line\">RuntimeService runtimeService = processEngine.getRuntimeService();</div><div class=\"line\"><span class=\"comment\">//流程任务类，管理具体的任务</span></div><div class=\"line\">TaskService taskService = processEngine.getTaskService();</div><div class=\"line\"><span class=\"comment\">//流程历史数据类</span></div><div class=\"line\">HistoryService historyService = processEngine.getHistoryService();</div><div class=\"line\"><span class=\"comment\">//流程用户业务类</span></div><div class=\"line\">IdentityService identityService = processEngine.getIdentityService();</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"3-2-ReposityService\"><a href=\"#3-2-ReposityService\" class=\"headerlink\" title=\"3.2 ReposityService\"></a>3.2 ReposityService</h2><p>流程仓库业务类，仓库简单理解即流程定义文档的两个文件：bpmn文件和流程图片</p>\n<ol>\n<li><p>产生流程部署配置对象，用来定义流程部署的相关参数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">@Test</div><div class=\"line\">public void Demo1() &#123;</div><div class=\"line\">\tDeploymentBuilder deploymentBuilder = processEngine.getRepositoryService().createDeployment().name(&quot;test&quot;);</div><div class=\"line\">\tdeploymentBuilder.addClasspathResource(&quot;diagrams/HelloWord.bpmn&quot;);</div><div class=\"line\">\tdeploymentBuilder.addClasspathResource(&quot;diagrams/HelloWord.png&quot;);</div><div class=\"line\">\t</div><div class=\"line\">\tDeployment deployment = deploymentBuilder.deploy();</div><div class=\"line\">\tSystem.out.println(deployment.getId() + &quot;。。。。&quot;+ deployment.getName());</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>删除流程定义</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">repositoryService.deleteDeployment(deploymentId);</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"3-3-RuntimeService\"><a href=\"#3-3-RuntimeService\" class=\"headerlink\" title=\"3.3 RuntimeService\"></a>3.3 RuntimeService</h2><p>流程执行服务类。可以从这个类中获取很多关于流程执行相关的信息。</p>\n<ol>\n<li><p>启动流程</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//常用的启动流程实例的两种方法</span></div><div class=\"line\">ProcessInstance processInstance = runtimeService.startProcessInstanceById(processInstanceId);</div><div class=\"line\">ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(processInstanceKey);</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"3-4-TaskService\"><a href=\"#3-4-TaskService\" class=\"headerlink\" title=\"3.4 TaskService\"></a>3.4 TaskService</h2><p>activiti的任务服务类。可以从这个类中获取任务的信息。</p>\n<h2 id=\"3-5-ProcessDefinition\"><a href=\"#3-5-ProcessDefinition\" class=\"headerlink\" title=\"3.5 ProcessDefinition\"></a>3.5 ProcessDefinition</h2><p>流程定义类。可以从这里获得资源文件等。<br>每个流程文件唯一对应一个相同key的流程定义，只是流程定义的version不同</p>\n<h2 id=\"3-6-ProcessInstance\"><a href=\"#3-6-ProcessInstance\" class=\"headerlink\" title=\"3.6 ProcessInstance\"></a>3.6 ProcessInstance</h2><p>流程实例。根据流程定义实例化的具体流程，我们可以利用这个对象来了解当前流程实例的进度等信息。<br>如：<br>    公司有一个所有人通用的请假流程，这个叫做流程定义。<br>    小明今天请假，填写请假单，就是创建了一个流程实例。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/** Represents one execution of a  &#123;<span class=\"doctag\">@link</span> ProcessDefinition&#125;.</span></div><div class=\"line\"> 1. </div><div class=\"line\"> 2. <span class=\"doctag\">@author</span> Tom Baeyens</div><div class=\"line\"> 3. <span class=\"doctag\">@author</span> Joram Barrez</div><div class=\"line\"> 4. <span class=\"doctag\">@author</span> Daniel Meyer</div><div class=\"line\"> 5. <span class=\"doctag\">@author</span> Tijs Rademakers</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ProcessInstance</span> <span class=\"keyword\">extends</span> <span class=\"title\">Execution</span> </span>&#123;</div></pre></td></tr></table></figure>\n<p>从上面可以看出ProcessInstance就是Execution，但实际有点区别</p>\n<ol>\n<li>单线流程中，ProcessInstance与Execution是一致的，ID都一样</li>\n<li>多线 流程中，总线路代表ProcessInstance，而分线路中每个活动代表Execution。</li>\n</ol>\n<h2 id=\"3-7-Execution\"><a href=\"#3-7-Execution\" class=\"headerlink\" title=\"3.7 Execution\"></a>3.7 Execution</h2><p>Activiti用这个对象去描述流程执行的每一个节点。在没有并发的情况下，同ProcessInstance。</p>\n<h1 id=\"4-流程定义\"><a href=\"#4-流程定义\" class=\"headerlink\" title=\"4 流程定义\"></a>4 流程定义</h1><h2 id=\"4-1-创建流程文件\"><a href=\"#4-1-创建流程文件\" class=\"headerlink\" title=\"4.1 创建流程文件\"></a>4.1 创建流程文件</h2><p>在classpath下创建流程文件<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/create.png\" alt=\"创建\"><br>编辑流程文件<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/example.png\" alt=\"编辑\"></p>\n<h2 id=\"4-2-部署流程定义\"><a href=\"#4-2-部署流程定义\" class=\"headerlink\" title=\"4.2 部署流程定义\"></a>4.2 部署流程定义</h2><p>部署流程定义可以看成是添加流程定义<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">deploy</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//创建流程引擎</span></div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    <span class=\"comment\">//创建流程部署对象</span></div><div class=\"line\">    DeploymentBuilder deploymentBuilder = processEngine.getRepositoryService().createDeployment();</div><div class=\"line\">    <span class=\"comment\">//读取文件部署流程</span></div><div class=\"line\">    Deployment deploy = deploymentBuilder.name(<span class=\"string\">\"测试\"</span>)</div><div class=\"line\">                            .addClasspathResource(<span class=\"string\">\"diagrams/HelloWord.bpmn\"</span>)</div><div class=\"line\">                            .addClasspathResource(<span class=\"string\">\"diagrams/HelloWord.png\"</span>)</div><div class=\"line\">                            .deploy();</div><div class=\"line\">    </div><div class=\"line\">    System.out.println(deploy.getId() + <span class=\"string\">\"。。。\"</span> + deploy.getName());</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p><strong>部署流程会改变3张表</strong></p>\n<ul>\n<li>act_re_deployment<br> 存放流程定义的显示名和部署时间，每部署一次增加一条记录</li>\n<li>act_re_procdef<br> 存放流程定义的属性信息，部署每个新的流程定义都会在这张表中增加一条记录。</li>\n<li>act_ge_bytearray<br> 存储流程定义相关的部署信息。即流程定义文档的存放地。每部署一次就会增加两条记录，一条是关于bpmn规则文件的，一条是图片的（如果部署时只指定了bpmn一个文件，activiti会在部署时解析bpmn文件内容自动生成流程图）。两个文件不是很大，都是以二进制形式存储在数据库中。</li>\n</ul>\n<h2 id=\"4-3-查看流程定义\"><a href=\"#4-3-查看流程定义\" class=\"headerlink\" title=\"4.3 查看流程定义\"></a>4.3 查看流程定义</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">view</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();</div><div class=\"line\">    List&lt;ProcessDefinition&gt; list = repositoryService.createProcessDefinitionQuery()</div><div class=\"line\">                                        <span class=\"comment\">//过滤条件</span></div><div class=\"line\">                                        .processDefinitionKey(<span class=\"string\">\"HelloWorld\"</span>)</div><div class=\"line\">                                        <span class=\"comment\">//.processDefinitionId(processDefinitionId)</span></div><div class=\"line\">                                        <span class=\"comment\">//分页</span></div><div class=\"line\">                                        <span class=\"comment\">//.listPage(firstResult, maxResults)</span></div><div class=\"line\">                                        <span class=\"comment\">//排序</span></div><div class=\"line\">                                        <span class=\"comment\">//.orderByProcessDefinitionVersion()</span></div><div class=\"line\">                                        <span class=\"comment\">//执行查询</span></div><div class=\"line\">                                        .list();</div><div class=\"line\">    <span class=\"keyword\">for</span> (ProcessDefinition processDefinition : list) &#123;</div><div class=\"line\">        System.out.print(<span class=\"string\">\"id:\"</span> + processDefinition.getId() + <span class=\"string\">\",\"</span>);<span class=\"comment\">//流程Id</span></div><div class=\"line\">        System.out.print(<span class=\"string\">\"key:\"</span> + processDefinition.getKey() + <span class=\"string\">\",\"</span>);<span class=\"comment\">//流程Key</span></div><div class=\"line\">        System.out.print(<span class=\"string\">\"name:\"</span> + processDefinition.getName() + <span class=\"string\">\",\"</span>);<span class=\"comment\">//流程名字</span></div><div class=\"line\">        System.out.print(<span class=\"string\">\"version:\"</span> + processDefinition.getVersion() + <span class=\"string\">\",\"</span>);<span class=\"comment\">//流程版本</span></div><div class=\"line\">        System.out.println(<span class=\"string\">\"deploymentId():\"</span> + processDefinition.getDeploymentId());<span class=\"comment\">//流程部署对象Id</span></div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>查询结果</p>\n<pre><code>id:HelloWorld:1:35004,key:HelloWorld,name:请假审批流程,version:1,deploymentId():35001\n</code></pre><p>再部署一次，再查询</p>\n<pre><code>id:HelloWorld:1:35004,key:HelloWorld,name:请假审批流程,version:1,deploymentId():35001\nid:HelloWorld:2:37504,key:HelloWorld,name:请假审批流程,version:2,deploymentId():37501\n</code></pre><p>说明：</p>\n<ol>\n<li>因为流程定义的信息在仓库中，实际在act<em>re</em>*表中，所以创建RepositoryService</li>\n<li>创建查询对象<strong>ProcessDefinitionQuery</strong>，设置查询参数，调用list()执行查询</li>\n<li><p>由查询结果可知：<br>3.1 流程定义的key和name与流程文件的id和name一致</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">process</span> <span class=\"attr\">id</span>=<span class=\"string\">\"HelloWorld\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"请假审批流程\"</span> <span class=\"attr\">isExecutable</span>=<span class=\"string\">\"true\"</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>3.2 key属性被用来区别不同的流程定义。<br>3.3 带有特定key的流程定义第一次部署时，version为1。之后每次部署都会在当前最高版本号上加1<br>3.4 Id的生成规则为：<strong>{processDefinitionKey}:{processDefinitionVersion}:{generated-id}</strong>，这里的generated-id是一个自动生成的唯一的数字<br>3.5 重复部署一次，deploymentId的值以一定的形式变化</p>\n</li>\n</ol>\n<h2 id=\"4-4-删除流程定义\"><a href=\"#4-4-删除流程定义\" class=\"headerlink\" title=\"4.4 删除流程定义\"></a>4.4 删除流程定义</h2><p>删除部署到activiti中的流程定义。如:删除请假流程定义，则大家再也不能请假了。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">delete</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();</div><div class=\"line\">    String deploymentId = <span class=\"string\">\"7501\"</span>;</div><div class=\"line\">    <span class=\"comment\">//如果有关联信息，会报错</span></div><div class=\"line\">    <span class=\"comment\">//repositoryService.deleteDeployment(deploymentId);</span></div><div class=\"line\">    <span class=\"comment\">//如果有关联信息，会级联删除</span></div><div class=\"line\">    repositoryService.deleteDeployment(deploymentId, <span class=\"keyword\">true</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"4-5-获取流程定义文档资源\"><a href=\"#4-5-获取流程定义文档资源\" class=\"headerlink\" title=\"4.5 获取流程定义文档资源\"></a>4.5 获取流程定义文档资源</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getResource</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</div><div class=\"line\">    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();</div><div class=\"line\">   </div><div class=\"line\">    String deploymentId = <span class=\"string\">\"35001\"</span>;</div><div class=\"line\">    String resourceName = <span class=\"keyword\">null</span>;</div><div class=\"line\">    <span class=\"comment\">//资源文件名,即act_re_bytearray表中的name</span></div><div class=\"line\">    List&lt;String&gt; names = repositoryService.getDeploymentResourceNames(deploymentId);</div><div class=\"line\">    <span class=\"keyword\">for</span> (String str : names) &#123;</div><div class=\"line\">        <span class=\"comment\">//过滤出特定的图片文件</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (str.indexOf(<span class=\"string\">\"HelloWorld.png\"</span>) != -<span class=\"number\">1</span>) &#123;</div><div class=\"line\">            resourceName = str;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    System.out.println(resourceName);</div><div class=\"line\">    <span class=\"keyword\">if</span> (resourceName != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">        <span class=\"comment\">//通过部署ID和文件名获得输入流</span></div><div class=\"line\">        InputStream inputStream = repositoryService.getResourceAsStream(deploymentId, resourceName);</div><div class=\"line\">        File file = <span class=\"keyword\">new</span> File(<span class=\"string\">\"D:/\"</span>+ resourceName);</div><div class=\"line\">        FileUtils.copyInputStreamToFile(inputStream, file);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h1 id=\"5-流程实例\"><a href=\"#5-流程实例\" class=\"headerlink\" title=\"5 流程实例\"></a>5 流程实例</h1><h2 id=\"5-1-启动流程实例\"><a href=\"#5-1-启动流程实例\" class=\"headerlink\" title=\"5.1 启动流程实例\"></a>5.1 启动流程实例</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">startProcess</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    RuntimeService runtimeService = ProcessEngines.getDefaultProcessEngine().getRuntimeService();</div><div class=\"line\">    <span class=\"comment\">//根据流程Id启动流程</span></div><div class=\"line\">    <span class=\"comment\">//ProcessInstance processInstance = runtimeService.startProcessInstanceById(processDefinitionId);</span></div><div class=\"line\">    <span class=\"comment\">//根据流程key启动流程，会自动找到版本最高的流程定义来创建</span></div><div class=\"line\">    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(<span class=\"string\">\"HelloWorld\"</span>);</div><div class=\"line\">    System.out.println(processInstance.getId());<span class=\"comment\">//流程实例Id</span></div><div class=\"line\">    System.out.println(processInstance.getActivityId());<span class=\"comment\">//流程当前节点Id</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<pre><code>启动流程实例有很多重载方法，根据实际需要选用。\n</code></pre><h2 id=\"5-2-查询任务\"><a href=\"#5-2-查询任务\" class=\"headerlink\" title=\"5.2 查询任务\"></a>5.2 查询任务</h2><p>在Activiti中，任务主要分为两类：</p>\n<ol>\n<li>确切指定了办理者的任务，之歌任务称为制定者的私人任务</li>\n<li>2.无法指定具体的某一个人来办理的任务，可以把任务分配给几个人或者一到    多个小组，让这个范围内的用户可以选择性（如有空余时间时）来办理这类任务。</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">taskQuery</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    TaskService taskService = ProcessEngines.getDefaultProcessEngine().getTaskService();</div><div class=\"line\">    List&lt;Task&gt; list = taskService.createTaskQuery()</div><div class=\"line\">            <span class=\"comment\">//查询指定用户的私人任务</span></div><div class=\"line\">            <span class=\"comment\">//.taskAssignee(\"指定用户\")</span></div><div class=\"line\">            <span class=\"comment\">//查询某人可接的共有任务</span></div><div class=\"line\">            <span class=\"comment\">//.taskCandidateUser(\"候选用户\")</span></div><div class=\"line\">            <span class=\"comment\">//排序</span></div><div class=\"line\">            .orderByTaskCreateTime().desc()</div><div class=\"line\">            <span class=\"comment\">//执行查询</span></div><div class=\"line\">            .list();</div><div class=\"line\">    <span class=\"keyword\">for</span> (Task task : list) &#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"id:\"</span> + task.getId());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"name:\"</span> + task.getName());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"assignee:\"</span> + task.getAssignee());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"createTime:\"</span> + task.getCreateTime());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ProcessInstanceId:\"</span> + task.getProcessInstanceId());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ProcessDefinitionId:\"</span> + task.getProcessDefinitionId());</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"5-3-认领任务\"><a href=\"#5-3-认领任务\" class=\"headerlink\" title=\"5.3 认领任务\"></a>5.3 认领任务</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">taskService.claim(taskId, userId);</div></pre></td></tr></table></figure>\n<p>将任务变为用户的私人任务</p>\n<h2 id=\"5-4-办理任务\"><a href=\"#5-4-办理任务\" class=\"headerlink\" title=\"5.4 办理任务\"></a>5.4 办理任务</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//根据任务Id办理任务</span></div><div class=\"line\">taskService.complete(taskId);</div><div class=\"line\"><span class=\"comment\">//根据任务Id办理任务,并设置任务变量</span></div><div class=\"line\">taskService.complete(taskId, variables);</div></pre></td></tr></table></figure>\n<p>variables是Map，当设置变量时，会在act_ru_variables表中添加相应条数的数据，变量可以用来执行gateway的判断，后面会讲到gateway。</p>\n<h2 id=\"5-5-判断流程是否结束\"><a href=\"#5-5-判断流程是否结束\" class=\"headerlink\" title=\"5.5 判断流程是否结束\"></a>5.5 判断流程是否结束</h2><p>在流程执行过程中，创建的流程实例ID在整个过程都不会变，当流程结束后，流程实例将被删除。</p>\n<ol>\n<li>从运行库中查询该流程是否还存在</li>\n<li>从历史库中查询该流程是否存在</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">checkStatus</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    String processInstanceId = <span class=\"string\">\"1213\"</span>;</div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    RuntimeService runtimeService = processEngine.getRuntimeService();</div><div class=\"line\">    <span class=\"comment\">//从运行库查询该流程实例是否存在</span></div><div class=\"line\">    ProcessInstance instance = runtimeService.createProcessInstanceQuery()</div><div class=\"line\">                                    .processInstanceId(processInstanceId)</div><div class=\"line\">                                    .singleResult();</div><div class=\"line\">    <span class=\"comment\">//实例不存在，可能未开始或者已结束</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (instance == <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">        <span class=\"comment\">//从历史库查</span></div><div class=\"line\">        HistoryService historyService = processEngine.getHistoryService();</div><div class=\"line\">        HistoricProcessInstance singleResult = historyService.createHistoricProcessInstanceQuery()</div><div class=\"line\">                                                .processInstanceId(processInstanceId)</div><div class=\"line\">                                                .singleResult();</div><div class=\"line\">        <span class=\"keyword\">if</span> (singleResult != <span class=\"keyword\">null</span> &amp;&amp; singleResult.getEndTime() != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">            <span class=\"comment\">//流程已结束</span></div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">\"COMPLETE\"</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            <span class=\"comment\">//流程未开始</span></div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">\"NOT_START\"</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> instance.getActivityId();<span class=\"comment\">//当前任务节点</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h1 id=\"6-流程历史\"><a href=\"#6-流程历史\" class=\"headerlink\" title=\"6 流程历史\"></a>6 流程历史</h1><p>在前一个的例子中，大家可能会流程执行完毕后，究竟去了哪里有些疑问。虽然已完成的任务在act_ru_task和act_ru_execution表中都已被删除，但是这些数据还存在activiti的数据库中，作为历史改由HistoryService来管理。</p>\n<p>历史是一个组件，它可以捕获发生在进程执行中的信息并永久的保存，与运行时数据不同的是，当流程实例运行完成之后它还会存在于数据库中。</p>\n<p>在流程引擎配置对象中可以设置历史记录规则：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">name</span>=<span class=\"string\">\"processEngineConfiguration\"</span> </span></div><div class=\"line\">  \t  <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"databaseSchemaUpdate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!--</span></div><div class=\"line\">\t\tActiviti提供了四种历史级别：</div><div class=\"line\">\t\tnone:不保存任何历史，可以提高性能</div><div class=\"line\">\t\tactiviti:保存所有流程实例、任务、活动信息</div><div class=\"line\">\t\taudit:默认级别,保存所有流程实例、任务、活动、表单</div><div class=\"line\">\t\tfull:保存所有信息,如流程变量</div><div class=\"line\">\t  --&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"history\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"activiti\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>由于数据库中保存着历史信息以及正在运行的流程实例信息，在实际项目中对已完成任务的查看频率远不及对代办和可接任务的查看，所以在activiti采用分开管理，把正在运行的交给runtimeService管理，而历史数据交给HistoryService来管理。</p>\n<p>对已成为历史的数据主要进行查询操作，我们主要关心两种类型的历史数据：</p>\n<ul>\n<li><strong>HistoricProcessInstance</strong> 包含当前和已经结束的流程实例信息。</li>\n<li><strong>HistoricActivityInstance</strong> 包含一个活动(流程上的节点)的执行信息。</li>\n</ul>\n<h2 id=\"6-1-查看历史流程实例\"><a href=\"#6-1-查看历史流程实例\" class=\"headerlink\" title=\"6.1 查看历史流程实例\"></a>6.1 查看历史流程实例</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">queryHisInstance</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//流程引擎</span></div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    <span class=\"comment\">//流程定义ID</span></div><div class=\"line\">    String processDefinitionId = <span class=\"string\">\"HelloWorld:2:37504\"</span>;</div><div class=\"line\">    <span class=\"comment\">//查询历史流程实例</span></div><div class=\"line\">    List&lt;HistoricProcessInstance&gt; list = processEngine.getHistoryService().createHistoricProcessInstanceQuery()</div><div class=\"line\">                                        .processDefinitionId(processDefinitionId)</div><div class=\"line\">                                        .finished()</div><div class=\"line\">                                        .orderByProcessInstanceStartTime().desc()</div><div class=\"line\">                                        .list();</div><div class=\"line\">    <span class=\"keyword\">for</span> (HistoricProcessInstance hp : list) &#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ID：\"</span>+hp.getId());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"startTime：\"</span>+hp.getStartTime());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"endTime：\"</span>+hp.getEndTime());</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>1.通常查询历史流程实例都需要指定一个过滤条件，指定    processDefinitionId查看具体某一次部署所开启的流程或者指定    processDefinitionKey查看某个规则下不限版本的所有流程</p>\n<p>2.可以选择性添加finished方法控制是否查询未完成的流程实例。在流    程开启时，activiti同时在act_ru_execution表和act_hi_procinst表中    创建了一条记录，在流程完成之前act_hi_procinst表中实例的结束时间为空</p>\n<h2 id=\"6-2-查看历史流程活动（节点）\"><a href=\"#6-2-查看历史流程活动（节点）\" class=\"headerlink\" title=\"6.2 查看历史流程活动（节点）\"></a>6.2 查看历史流程活动（节点）</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">queryHisActiviti</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//流程引擎</span></div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    <span class=\"comment\">//流程实例ID</span></div><div class=\"line\">    String processInstanceId = <span class=\"string\">\"HelloWorld:2:37504\"</span>;</div><div class=\"line\">    <span class=\"comment\">//查询历史流程活动</span></div><div class=\"line\">    List&lt;HistoricActivityInstance&gt; list = processEngine.getHistoryService()</div><div class=\"line\">                                        <span class=\"comment\">//创建历史流程活动实例查询对象</span></div><div class=\"line\">                                        .createHistoricActivityInstanceQuery()</div><div class=\"line\">                                        <span class=\"comment\">//过滤条件</span></div><div class=\"line\">                                        .processInstanceId(processInstanceId)</div><div class=\"line\">                                        <span class=\"comment\">//排序</span></div><div class=\"line\">                                        .orderByHistoricActivityInstanceStartTime().desc()</div><div class=\"line\">                                        <span class=\"comment\">//执行查询</span></div><div class=\"line\">                                        .list();</div><div class=\"line\">    <span class=\"keyword\">for</span> (HistoricActivityInstance ha : list) &#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ID：\"</span>+ha.getActivityId());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"name:\"</span>+ha.getActivityName());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"startTime：\"</span>+ha.getStartTime());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"endTime：\"</span>+ha.getEndTime());</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>通常查询历史流程活动都需要指定一个过滤条件，指定processInstanceId查看具体某一次流程执行过程中所经历的步奏</p>\n<h1 id=\"7-流程变量\"><a href=\"#7-流程变量\" class=\"headerlink\" title=\"7 流程变量\"></a>7 流程变量</h1><p>流程变量在整个工作流中扮演很重要的作用。例如：请假流程中有请假天数、请假原因等一些参数都为流程变量的范围。<br>流程变量的作用域范围是流程实例。也就是说各个流程实例的流程变量是不相互影响的。<br>流程实例结束完成以后流程变量是否保存在数据库中取决于存储策略，见第六章。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/variable.png\" alt=\"流程变量\"></p>\n<h2 id=\"7-1-添加流程变量\"><a href=\"#7-1-添加流程变量\" class=\"headerlink\" title=\"7.1 添加流程变量\"></a>7.1 添加流程变量</h2><ol>\n<li><p>启动流程实例时添加</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addVariables</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    RuntimeService runtimeService = processEngine.getRuntimeService();</div><div class=\"line\">    </div><div class=\"line\">    String processDefinitionKey = <span class=\"string\">\"HelloWorld\"</span>;</div><div class=\"line\">    Map&lt;String,Object&gt; variables = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</div><div class=\"line\">    variables.put(<span class=\"string\">\"请假天数\"</span>, <span class=\"number\">3</span>);</div><div class=\"line\">    variables.put(<span class=\"string\">\"请假原因\"</span>, <span class=\"string\">\"约会\"</span>);</div><div class=\"line\">    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(processDefinitionKey, variables);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>说明：</p>\n<pre><code>1)    在启动流程实例时，通过重载startProcessInstanceByKey的方法可以加载流程变量。\n2)    第二个参数要求是Map&lt;String ,Object&gt;类型，意味着可以添加多个流程变量。\n3)    当这段代码执行完以后，会在数据库表act_ru_variable中添加两行记录。\n</code></pre></li>\n</ol>\n<ol>\n<li>完成任务时添加<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//办理过程中</span></div><div class=\"line\">taskService.setVariables(taskId, variables);</div><div class=\"line\"><span class=\"comment\">//提交时</span></div><div class=\"line\">taskService.complete(taskId, variables);</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li>执行流程实例时添加<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//执行流程实例时</span></div><div class=\"line\">runtimeService.setVariables(executionId, variables);</div><div class=\"line\"><span class=\"comment\">//流程实例提交时</span></div><div class=\"line\">runtimeService.signal(executionId, processVariables);<span class=\"comment\">//signal用于接受任务</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"7-2-获取流程变量\"><a href=\"#7-2-获取流程变量\" class=\"headerlink\" title=\"7.2 获取流程变量\"></a>7.2 获取流程变量</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//某个流程的变量</span></div><div class=\"line\">runtimeService.getVariables(executionId);</div><div class=\"line\"><span class=\"comment\">//某个任务的变量</span></div><div class=\"line\">taskService.getVariables(taskId);</div></pre></td></tr></table></figure>\n<p>说明：这些流程变量是从act_ru_variable这个表中读出来的。</p>\n<h2 id=\"7-3-流程变量范围\"><a href=\"#7-3-流程变量范围\" class=\"headerlink\" title=\"7.3 流程变量范围\"></a>7.3 流程变量范围</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/baseVar.png\" alt=\"此处输入图片的描述\"></p>\n<p>从图中可以看出包括了大部分封装类型和Date、String和实现了Serializable接口的类的类型。</p>\n<h2 id=\"7-4-Javabean类型变量\"><a href=\"#7-4-Javabean类型变量\" class=\"headerlink\" title=\"7.4 Javabean类型变量\"></a>7.4 Javabean类型变量</h2><ol>\n<li>定义一个javabean，这个javabean实现了Serializable接口</li>\n<li>实例化javaBean，放到map中，然后正常设置流程变量</li>\n<li>正常取出变量</li>\n</ol>\n<h1 id=\"8-流程定义语言\"><a href=\"#8-流程定义语言\" class=\"headerlink\" title=\"8 流程定义语言\"></a>8 流程定义语言</h1><h2 id=\"8-1-流程（Process）\"><a href=\"#8-1-流程（Process）\" class=\"headerlink\" title=\"8.1 流程（Process）\"></a>8.1 流程（Process）</h2><p>bpmn文件一个流程的根元素。一个流程就代表一个工作流。</p>\n<h2 id=\"8-2-顺序流（sequenceFlow）\"><a href=\"#8-2-顺序流（sequenceFlow）\" class=\"headerlink\" title=\"8.2 顺序流（sequenceFlow）\"></a>8.2 顺序流（sequenceFlow）</h2><p>顺序流是连接两个流程节点的连线，代表一个节点的出口。流程执行完一个节点后，会沿着节点的所有外出顺序流继续执行。 就是说，BPMN 2.0默认的行为就是并发的： 两个外出顺序流会创造两个单独的，并发流程分支。</p>\n<p>顺序流主要由4个属性组成：</p>\n<ul>\n<li>Id: 唯一标示，用来区分不同的顺序流</li>\n<li>sourceRef：连线的源头节点ID</li>\n<li>targetRef：连线的目标节点ID</li>\n<li>name（可选）：连线的名称，不涉及业务，主要用于显示</li>\n</ul>\n<h2 id=\"8-3-节点\"><a href=\"#8-3-节点\" class=\"headerlink\" title=\"8.3 节点\"></a>8.3 节点</h2><h3 id=\"8-3-1-开始事件节点-startEvent\"><a href=\"#8-3-1-开始事件节点-startEvent\" class=\"headerlink\" title=\"8.3.1 开始事件节点(startEvent)\"></a>8.3.1 开始事件节点(startEvent)</h3><p>开始事件用来指明流程在哪里开始。开始事件的类型（流程在接收事件时启动， 还是在指定时间启动，等等），定义了流程如何启动， 这通过事件中不同的小图表来展示。 在XML中，这些类型是通过声明不同的子元素来区分的。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/startEvent.png\" alt=\"此处输入图片的描述\"></p>\n<ol>\n<li><p>空开始事件<br>空开始事件技术上意味着没有指定启动流程实例的触发条件。最常用的一种开始，意味着流程的启动需要手动触发，通过调用api的startProcessInstanceByXXX方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">ProcessInstance processInstance = runtimeService.startProcessInstanceByXXX()</div></pre></td></tr></table></figure>\n<p>图形标记：空开始事件显示成一个圆圈，没有内部图表（没有触发类型）<br>XML结构如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">startEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"startevent\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Start\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">startEvent</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>定时开始事件</p>\n<p>定时开始事件用来在指定的时间创建流程实例。 它可以同时用于只启动一次的流程 和应该在特定时间间隔启动多次的流程。</p>\n<pre><code>注意：\n1.子流程不能使用定时开始事件。\n2.定时开始事件在流程发布后就会开始计算时间。不需要调用startProcessInstanceByXXX，虽然也而已调用启动流程的方法，但是那会导致调用startProcessInstanceByXXX时启动过多的流程。\n3.当包含定时开始事件的新版本流程部署时，对应的上一个定时器就会被删除。这是因为通常不希望自动启动旧版本流程的流程实例。\n</code></pre><p>图形标记：定时开始事件显示为一个圆圈，内部是一个表。<br>XML内容：定时开始事件的XML内容是普通开始事件的声明，包含一个定时定义子元素。<br>示例：流程会启动4次，每次间隔5分钟，从2013年9月18日，12:10开始计时。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">startEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theStart\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">timerEventDefinition</span>&gt;</span>                </div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">timeCycle</span>&gt;</span>R4/2017-11-22T11:04/PT5M<span class=\"tag\">&lt;/<span class=\"name\">timeCycle</span>&gt;</span>            \t\t </div><div class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">timerEventDefinition</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">startEvent</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>示例：流程会根据选中的时间启动一次。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">startEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theStart\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">timerEventDefinition</span>&gt;</span>                </div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">timeDate</span>&gt;</span>2017-12-31T23:59:59<span class=\"tag\">&lt;/<span class=\"name\">timeDate</span>&gt;</span>               \t\t </div><div class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">timerEventDefinition</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">startEvent</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"8-3-2-结束事件节点-endEvent\"><a href=\"#8-3-2-结束事件节点-endEvent\" class=\"headerlink\" title=\"8.3.2 结束事件节点(endEvent)\"></a>8.3.2 结束事件节点(endEvent)</h3><p>结束事件表示（子）流程（分支）的结束。结束事件都是触发事件。这是说当流程达结束事件，会触发一个结果。 结果的类型是通过事件的内部黑色图标表示的。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/endEvent.png\" alt=\"结束事件\"></p>\n<ol>\n<li><p>空结束事件</p>\n<p>空结束事件意味着到达事件时不会指定抛出的结果。这样，引擎会直接结束当前执行的分支，不会做其他事情。<br>图形标记:空结束事件是一个粗边圆圈，内部没有小图表（无结果类型）<br>XML内容:空结束事件的XML内容是普通结束事件定义，不包含子元素（其他结束事件类型都会包含声明类型的子元素）。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">endEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"end\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"my end event\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"8-3-3-任务节点-Task\"><a href=\"#8-3-3-任务节点-Task\" class=\"headerlink\" title=\"8.3.3 任务节点(Task)\"></a>8.3.3 任务节点(Task)</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/task.png\" alt=\"任务节点\"></p>\n<ol>\n<li><p>用户任务节点<br>用户任务用来设置必须由人员完成的工作。当流程执行到用户任务，会创建一个新任务，并把这个新任务加入到分配人或群组的任务列表中。<br>图形标记：用户任务显示成一个普通任务（圆角矩形），左上角有一个小用户图标。<br>XML内容：XML中的用户任务定义如下。id属性是必须的。 name属性是可选的。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theTask\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Important task\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>用户任务也可以设置描述(实际上所有BPMN 2.0元素都可以设置描述)。 添加documentation元素可以定义描述。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theTask\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Schedule meeting\"</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">documentation</span>&gt;</span></div><div class=\"line\">    Schedule an engineering meeting for next week with the new hire.  </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">documentation</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>在实际应用中，用户接到任务后可以参照任务描述来办理任务，描述文本可以通过标准的java方法来获得：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">task.getDescription()</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p><strong>私人任务</strong><br>    私有任务即有直接分配给指定用户的任务。只有一个用户可以成为任务的执行者。 在activiti中，用户叫做执行者。 拥有执行者的用户任务（即私有任务）对其他用户是不可见的。只能出现执行者的个人任务列表中.<br>    直接把用户任务分配给指定用户使用assignee属性，XML代码如下：<br>    <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theTask\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"my task\"</span> <span class=\"attr\">activiti:assignee</span>=<span class=\"string\">\"username\"</span>/&gt;</span></div></pre></td></tr></table></figure></p>\n<pre><code>Assignee属性对应的值为一个用户的ID。\n直接分配给用户的任务可以通过TaskService像下面这样办理：\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">    List&lt;Task&gt;tasks =taskService.createTaskQuery().taskAssignee(<span class=\"string\">\"sirius\"</span>).list();</div><div class=\"line\">Task task = tasks.get(<span class=\"number\">0</span>);<span class=\"comment\">// 假设任务集合的第一条是要办理的任务</span></div><div class=\"line\">taskService.complete(task.getId());</div></pre></td></tr></table></figure>\n</code></pre><p> <strong>公有任务</strong><br>    有的用户任务在指派时无法确定具体的办理者，这时任务也可以加入到    人员的候选任务列表中，然后让这些人员选择性认领和办理任务。</p>\n<pre><code>公有任务的分配可以分为指定候选用户和候选组两种。\n\n-  把任务添加到一批用户的候选任务列表中，使用candidateUsers    属    性，XML内容如下:\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTaskid=\"theTask\"name=\"my</span> <span class=\"attr\">task</span>\"<span class=\"attr\">activiti:candidateUsers</span>=<span class=\"string\">\"sirius,kermit\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n\ncandidateUsers属性内为用户的ID，多个用户ID之间使用（半角）逗号间隔。\n\n - 把任务添加到一个或多个候选组下，这时任务对组下的所有用户可见，首先得保证每个组下面有用户，通过IdentityService对象创建用户和组，然后把用户添加到对应的组下。然后配置组任务，使用candidateGroups属性，XML内容如下：\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theTask\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"my task\"</span> <span class=\"attr\">activiti:candidateGroups</span>=<span class=\"string\">\"testGroup，developGroup\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n\n间接分配给用户的任务，可以通过TaskService像下面这样操作：\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">List&lt;Task&gt;tasks =taskService.createTaskQuery()</div><div class=\"line\">.taskCandidateUser(<span class=\"string\">\"sirius\"</span>).list();</div><div class=\"line\">Task task = tasks.get(<span class=\"number\">0</span>);<span class=\"comment\">// 假设任务集合的第一条是要办理的任务</span></div><div class=\"line\">String taskId = task.getId();</div><div class=\"line\">taskService.claim(taskId ,“sirius”); <span class=\"comment\">//认领任务，让用户成为任务的执行者</span></div><div class=\"line\">taskService.complete(taskId );</div></pre></td></tr></table></figure>\n\n说明：\n\n 1. 要维护用户和组得使用用户管理服务对象，使用        processEngine    得到IdentityService。\n 2. 要分配组任务必须先创建组，而且组下得有用户，用户和组的    最关键属性是ID。\n 3. 使用newUser（userId）和newGroup（groupId）创建用户和组。\n 4. 使用createMembership（userId，groupId）把用户挂到组下。\n 5. 办理候选任务，首先得认领任务，让用户成为任务的执行者\n\n如果上面的方式还不够灵活，那么我们也可以自定义一个任务分配处理器，通过代码的方式来动态设置任务的属性。XML代码如下：\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"task1\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"My task\"</span>&gt;</span> </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">extensionElements</span>&gt;</span>    </div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">activiti:taskListener</span> <span class=\"attr\">event</span>=<span class=\"string\">\"create\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.MyAssignmentHandler\"</span>/&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">extensionElements</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">userTask</span>&gt;</span></div></pre></td></tr></table></figure>\n\nDelegateTask会传递给TaskListener的实现，通过它可以设置执行人，候选人和候选组：\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">Public <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyAssignmentHandler</span> <span class=\"keyword\">implements</span> <span class=\"title\">TaskListener</span> </span>&#123;</div><div class=\"line\">  </div><div class=\"line\">    <span class=\"function\">Public <span class=\"keyword\">void</span> <span class=\"title\">notify</span><span class=\"params\">(DelegateTask delegateTask)</span></span>&#123; </div><div class=\"line\">\t<span class=\"comment\">// 执行用户搜索相关代码    </span></div><div class=\"line\">\t...</div><div class=\"line\">\t<span class=\"comment\">// 然后把获取到的用户通过下面方法，设置给当前触发事件的任务</span></div><div class=\"line\">    \tdelegateTask.setAssignee(<span class=\"string\">\"sirius\"</span>);</div><div class=\"line\">    \t<span class=\"comment\">//delegateTask.addCandidateUser(\"kermit\");</span></div><div class=\"line\">   \t<span class=\"comment\">//delegateTask.addCandidateGroup(\"testGroup\"); </span></div><div class=\"line\">   \t...  </div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</code></pre><ol>\n<li><p>接收任务节点（receiveTask）</p>\n<p>接收任务是一个简单任务，它会等待对应消息的到达。当前，官方只实现了这个任务的java语义。 当流程达到接收任务，流程状态会保存到数据库中。在任务创建后，意味着流程会进入等待状态，直到引擎接收了一个特定的消息，这会触发流程穿过接收任务继续执行。</p>\n<p>图形标记：接收任务显示为一个任务（圆角矩形），右上角有一个消息小标记。 消息是白色的（黑色图标表示发送语义）。</p>\n<p>XML内容：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">receiveTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"waitState\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"wait\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>当前任务（一般指机器自动完成，但需要耗费一定时间的工作）完成后，向后推移流程，可以调用runtimeService.signal(executionId)，传递接收任务上流程的id。\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">ProcessInstance pi = runtimeService.startProcessInstanceByKey(<span class=\"string\">\"receiveTask\"</span>);</div><div class=\"line\">Execution execution = runtimeService.createExecutionQuery()</div><div class=\"line\">                        .processInstanceId(pi.getId())</div><div class=\"line\">                        .activityId(<span class=\"string\">\"waitState\"</span>)</div><div class=\"line\">                        .singleResult();</div><div class=\"line\">runtimeService.signal(execution.getId());</div></pre></td></tr></table></figure>\n</code></pre><hr>\n<p>述两个虽然都可以统称为任务节点，但是还是有本质区别：</p>\n<ol>\n<li>receiveTask主要代表机器自动执行的，userTask代表人工干预的。</li>\n<li>eiveTask任务产生后会在act_ru_execution表中新增一条记录，    而userTask产生后会在act_ru_execution和act_ru_task（主要记录任    务的发布时间，办理人等信息）中各产生一条记录。</li>\n<li>receiveTask任务提交方式使用RuntimeService的signal方法提交，    userTask任务提交方式使用TaskService的complete方法提交。</li>\n</ol>\n<h3 id=\"8-3-4-网关（gateWay）\"><a href=\"#8-3-4-网关（gateWay）\" class=\"headerlink\" title=\"8.3.4 网关（gateWay）\"></a>8.3.4 网关（gateWay）</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/gateWay.png\" alt=\"网关\"></p>\n<ol>\n<li><p>排他网关<br>排他网关（也叫异或（XOR）网关，或更技术性的叫法基于数据的排他网关），用来在流程中实现决策。</p>\n<p><strong>图形标记</strong>:排他网关显示成一个普通网关（比如，菱形图形）,内部是一个“X”图标,表示异或（XOR）语义。注意，没有内部图标的网关，默认为排他网关。BPMN2.0规范不允许在同一个流程定义中同时使用没有X和有X的菱形图形。</p>\n<p><strong>XML内容</strong>:排他网关的XML内容是很直接的：用一行定义了网关,条件表达式定义在外出顺序流中。参考条件顺序流 获得这些表达式的可用配置。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/xor.png\" alt=\"排他网关\"></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">exclusiveGatewayid=\"exclusiveGw\"name=\"Exclusive</span> <span class=\"attr\">Gateway</span>\"/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">id</span>=<span class=\"string\">\"flow2\"</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"exclusiveGw\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"theTask1\"</span>&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">conditionExpressionxsi:type=\"tFormalExpression\"</span>&gt;</span>$&#123;input == 1&#125;<span class=\"tag\">&lt;/<span class=\"name\">conditionExpression</span>&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">sequenceFlow</span>&gt;</span>\t</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">id</span>=<span class=\"string\">\"flow3\"</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"exclusiveGw\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"theTask2\"</span>&gt;</span>   </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">conditionExpressionxsi:type=\"tFormalExpression\"</span>&gt;</span>$&#123;input == 2&#125;<span class=\"tag\">&lt;/<span class=\"name\">conditionExpression</span>&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">sequenceFlow</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">id</span>=<span class=\"string\">\"flow4\"</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"exclusiveGw\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"theTask3\"</span>&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">conditionExpressionxsi:type=\"tFormalExpression\"</span>&gt;</span>$&#123;input == 3&#125;<span class=\"tag\">&lt;/<span class=\"name\">conditionExpression</span>&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">sequenceFlow</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>说明：\n1.一个排他网关对应一个以上的顺序流\n2.由排他网关流出的顺序流都有个conditionExpression元素，在内部维护返回boolean类型的决策结果。\n3.决策网关只会返回一条结果。当流程执行到排他网关时，流程引擎会自动检索网关出口，从上到下检索如果发现第一条决策结果为true或者没有设置条件的(默认为成立)，则流出。\n4.如果没有任何一个出口符合条件则抛出异常。\n</code></pre><ol>\n<li><p>并行网关</p>\n<p>网关也可以表示流程中的并行情况。最简单的并行网关是parallelGateWay，它允许将流程分成多条分支，也可以把多条分支汇聚到一起。</p>\n<p><strong>图形标记</strong>：并行网关显示成一个普通网关（菱形）内部是一个“加号”图标，表示“与（AND）”语义。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/parallelGateWay.png\" alt=\"并行网关\"></p>\n<p><strong>XML内容</strong>：定义并行网关只需要一行</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parallelGateway</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myParallelGateway\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>实际发生的行为（分支，聚合，同时分支聚合），要根据并行网关的顺序流来决定。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">startEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theStart\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">id</span>=<span class=\"string\">\"flow1\"</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"theStart\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"fork\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parallelGateway</span> <span class=\"attr\">id</span>=<span class=\"string\">\"fork\"</span>/&gt;</span> </div><div class=\"line\"> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"fork\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"receivePayment\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"fork\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"shipOrder\"</span>/&gt;</span></div><div class=\"line\">    </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTaskid=\"receivePayment\"name=\"Receive</span> <span class=\"attr\">Payment</span>\"/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"receivePayment\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"join\"</span>/&gt;</span></div><div class=\"line\">   </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTaskid=\"shipOrder\"name=\"Ship</span> <span class=\"attr\">Order</span>\"/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"shipOrder\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"join\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parallelGateway</span> <span class=\"attr\">id</span>=<span class=\"string\">\"join\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"join\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"archiveOrder\"</span>/&gt;</span></div><div class=\"line\"> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"archiveOrder\"</span><span class=\"attr\">name</span>=<span class=\"string\">\"Archive Order\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"archiveOrder\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"theEnd\"</span>/&gt;</span></div><div class=\"line\">         </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">endEventid=\"theEnd\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>上面例子中，流程启动之后，会创建两个任务：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">ProcessInstancepi =runtimeService.startProcessInstanceByKey(<span class=\"string\">\"forkJoin\"</span>);</div><div class=\"line\"></div><div class=\"line\">List&lt;Task&gt; tasks = taskService.createTaskQuery().list();</div><div class=\"line\">Task task1 =tasks.get(<span class=\"number\">0</span>);</div><div class=\"line\">System.out.println(<span class=\"string\">\"Receive Payment\"</span>+task1.getName());</div><div class=\"line\">Task task2 =tasks.get(<span class=\"number\">1</span>);</div><div class=\"line\">System.out.println(<span class=\"string\">\"Ship Order\"</span>+task2.getName());</div></pre></td></tr></table></figure>\n<p>当两个任务都完成时，第二个并行网关会汇聚两个分支，因为它只有一条外出连线，不会创建并行分支，只会创建归档订单任务。</p>\n<p>说明：<br>1.并行网关的功能是基于进入和外出的顺序流的：</p>\n<pre><code>分支(fork)：并行后的所有外出顺序流，为每个顺序流都创建一个并发分支。\n汇聚(join)：所有到达并行网关，在此等待的进入分支，直到所有进入顺序流的分支都到达以后， 流程就会通过汇聚网关。\n</code></pre><p>2.并行网关的进入和外出都是使用相同节点标示<br>3.如果同一个并行网关有多个进入和多个外出顺序流，它就同时具有分支和汇聚功能。这时，网关会先汇聚所有进入的顺序流，然后再切分成多个并行分支。<br>4.并行网关不会解析条件。 即使顺序流中定义了条件，也会被忽略。<br>5.并行网关不需要是“平衡的”（比如，对应并行网关的进入和外出节点数目相等）。如图中标示是合法的：<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/binxing.png\" alt=\"并行网关不需要是“平衡的”\"></p>\n</li>\n</ol>\n<h2 id=\"8-4-监听器（Listener）\"><a href=\"#8-4-监听器（Listener）\" class=\"headerlink\" title=\"8.4 监听器（Listener）\"></a>8.4 监听器（Listener）</h2><p>在流程中我们有时会对整个流程或者一个节点的某种状态做出相应的处理。这时就会用到监听器。</p>\n<p>在Activiti中流程的监听主要分为两大类，执行监听器和任务监听器。</p>\n<h3 id=\"8-4-1-执行监听器（ExecutionListener）\"><a href=\"#8-4-1-执行监听器（ExecutionListener）\" class=\"headerlink\" title=\"8.4.1 执行监听器（ExecutionListener）\"></a>8.4.1 执行监听器（ExecutionListener）</h3><p>执行监听器可以执行外部java代码或执行表达式，当流程定义中发生了某个事件。 可以捕获的事件有:</p>\n<ul>\n<li>流程实例的启动和结束。</li>\n<li>选中一条连线。</li>\n<li>节点的开始和结束。</li>\n<li>网关的开始和结束。</li>\n<li>中间事件的开始和结束。</li>\n<li>开始事件结束或结束事件开始。</li>\n</ul>\n<p>现在有这样一个简单流程，只包含开始、结束、接收任务和用户任务4个节点：<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/listenerExample.png\" alt=\"监听器流程示例\"><br>配置监听器,XML代码如下<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">extensionElements</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">activiti:executionListener</span> <span class=\"attr\">event</span>=<span class=\"string\">\"start\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"test.ProcessStartListener\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">activiti:executionListener</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">extensionElements</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>说明：</p>\n<ul>\n<li><p>任务监听器支持以下属性：</p>\n<ul>\n<li>event（必选）：任务监听器会被调用的任务类型<ul>\n<li>start：流程节点创建后触发</li>\n<li>end：当任务完成，并尚未从运行数据中删除时触发</li>\n<li>take：任务完成后，流程流出时触发</li>\n</ul>\n</li>\n<li>class(必选)：代理类，实现org.activiti.engine.delegate.ExecutionListener接口。<br>示例：<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProcessStartListener</span> <span class=\"keyword\">implements</span> <span class=\"title\">ExecutionListener</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">1L</span>;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">notify</span><span class=\"params\">(DelegateExecution execution)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ID:\"</span>+execution.getId()+<span class=\"string\">\", Name:\"</span>+execution.getCurrentActivityName());</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li><p>执行监听器配置可以放在以下三个地方，如图<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/taskListener.png\" alt=\"此处输入图片的描述\"></p>\n<p> a)    监听整个流程的启动和结束状态，配置为process节点的子元素，如①<br> b)    监听一个节点的启动和结束状态，配置为一个节点的子元素，如②和③<br> c)    监听一条连线的执行，配置在sequenceFlow节点的内部，只有task一种事件，如④</p>\n</li>\n</ul>\n<p>启动流程测试代码如下：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//部署流程</span></div><div class=\"line\">    Deployment deployment = repositoryService.createDeployment()</div><div class=\"line\">                .addClasspathResource(<span class=\"string\">\"diagrams/Listener.bpmn\"</span>)</div><div class=\"line\">                .addClasspathResource(<span class=\"string\">\"diagrams/Listener.png\"</span>)</div><div class=\"line\">                .deploy();</div><div class=\"line\">    <span class=\"comment\">//启动</span></div><div class=\"line\">    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(<span class=\"string\">\"ListenerTest\"</span>);</div><div class=\"line\">    <span class=\"comment\">//推动</span></div><div class=\"line\">    String processInstanceId = processInstance.getId();</div><div class=\"line\">    runtimeService.signal(processInstanceId);</div><div class=\"line\">    </div><div class=\"line\">    String id = taskService.createTaskQuery().processInstanceId(processInstanceId).singleResult().getId();</div><div class=\"line\">    taskService.complete(id);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>测试结果如下：</p>\n<pre><code>ID:60005, Name:开始\nID:60005, Name:接收任务\nID:60005, Name:用户任务\n</code></pre><h3 id=\"8-4-2-任务监听器（TaskListener）\"><a href=\"#8-4-2-任务监听器（TaskListener）\" class=\"headerlink\" title=\"8.4.2 任务监听器（TaskListener）\"></a>8.4.2 任务监听器（TaskListener）</h3><p>任务监听器可以在发生对应的任务相关事件时执行自定义java逻辑 或表达式。<br>任务监听器只能添加到流程定义中的用户任务中。在之前任务节点上添加任务监听:<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/taskListener2.png\" alt=\"此处输入图片的描述\"></p>\n<p>任务监听器支持以下属性</p>\n<ul>\n<li>event（必选）：任务监听器会被调用的任务类型。 可能的类型为：<ul>\n<li>create：任务创建并设置所有属性后触发。</li>\n<li>assignment：任务分配给一些人时触发。当流程到达userTask，assignment事件 会在create事件之前发生。这样的顺序似乎不自然，但是原因很简单：当获得create时间时， 我们想获得任务的所有属性，包括执行人。</li>\n<li>complete：当任务完成，并尚未从运行数据中删除时触发。</li>\n</ul>\n</li>\n<li>class：必须调用的代理类。 这个类必须实现org.activiti.engine.delegate.TaskListener    接口。</li>\n</ul>\n<hr>\n<p>新添加的任务监听包裹在executionListener监听的内部，顺序为：execution Start–&gt; task Assignment–&gt;task Create–&gt;task Complete–&gt;execution End–&gt;execution take。</p>\n<h1 id=\"9-Spring集成\"><a href=\"#9-Spring集成\" class=\"headerlink\" title=\"9 Spring集成\"></a>9 Spring集成</h1><p>虽然前面的例子中我们可以自己手动来创建相应的API实例，但是在一个项目中这些API都应该以<strong>单例形式</strong>存在的。和Spring的集成主要就是把Activiti的主要对象交给Spring容器管理。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 流程引擎 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.spring.ProcessEngineFactoryBean\"</span>&gt;</span> </div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"processEngineConfiguration\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"processEngineConfiguration\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">&lt;!-- 流程引擎配置对象 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"processEngineConfiguration\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.spring.SpringProcessEngineConfiguration\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"transactionManager\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"transactionManager\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- activiti表数据更新策略 false true（默认） create-drop--&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"databaseSchemaUpdate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- activiti历史数据保存策略 none activity audit(默认) full--&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"history\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"audit\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 管理线程计时器和异步消息,默认开启，但有ManagementService替代，避免冲突所以关闭 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jobExecutorActivate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"false\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 加载资源文件 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"deploymentResources\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"classpath:/activiti-process/*.bpmn\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">&lt;!-- 核心业务类 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"repositoryService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getRepositoryService\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"runtimeService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getRuntimeService\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"taskService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getTaskService\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"historyService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getHistoryService\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"managementService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getManagementService\"</span> /&gt;</span></div></pre></td></tr></table></figure>\n<p><strong>注意：</strong></p>\n<ol>\n<li>ProcessEngineConfiguration<br>单独使用和整合Spring时不是同一个class<br>独立使用：org.activiti.engine.ProcessEngineConfiguration<br>整合Spring：org.activiti.spring.SpringProcessEngineConfiguration</li>\n<li>项目部署后会自动在数据库中创建相关流程定义</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>工作流(Workflow)，就是“业务过程的部分或整体在计算机应用环境下的自动化”，它主要解决的是“使在多个参与者之间按照某种预定义的规则传递文档、信息或任务的过程自动进行，从而实现某个预期的业务目标，或者促使此目标的实现”。<br>","more":"</p>\n<h1 id=\"1-Activiti简介\"><a href=\"#1-Activiti简介\" class=\"headerlink\" title=\"1 Activiti简介\"></a>1 Activiti简介</h1><p>Activiti5是由Alfresco软件在2010年5月17日发布的业务流程管理（BPM）框架，它是覆盖了业务流程管理、工作流、服务协作等领域的一个开源的、灵活的、易扩展的可执行流程语言框架。Activiti基于Apache许可的开源BPM平台，创始人Tom Baeyens是JBoss jBPM的项目架构师，它特色是提供了eclipse插件，开发人员可以通过插件直接绘画出业务流程图。</p>\n<h2 id=\"1-1-工作流引擎\"><a href=\"#1-1-工作流引擎\" class=\"headerlink\" title=\"1.1 工作流引擎\"></a>1.1 工作流引擎</h2><p>这是Activiti的核心，负责生成流程运行时的各种实例及数据、监控和管理流程的运行。</p>\n<h2 id=\"1-2-BPMN2-0\"><a href=\"#1-2-BPMN2-0\" class=\"headerlink\" title=\"1.2 BPMN2.0\"></a>1.2 BPMN2.0</h2><p>业务流程建模与标注（Business Process Model and Notation，BPMN) ，描述流程的基本符号，包括这些图元如何组合成一个业务流程图（Business Process Diagram）</p>\n<h2 id=\"1-3-数据库\"><a href=\"#1-3-数据库\" class=\"headerlink\" title=\"1.3 数据库\"></a>1.3 数据库</h2><p>Activiti的后台是有数据库的支持，所有的表都以ACT_开头。第二部分是表示表的用途的两个字母标识。 用途也和服务的API对应。</p>\n<ol>\n<li><strong>ACT<em>RE</em>*</strong>: ‘RE’表示repository。 这个前缀的表包含了流程定义和流程静态资源 （图片，规则，等等）。</li>\n<li><strong>ACT<em>RU</em>*</strong>: ‘RU’表示runtime。 这些运行时的表，包含流程实例，任务，变量，异步任务，等运行中的数据。 Activiti只在流程实例执行过程中保存这些数据， 在流程结束时就会删除这些记录。 这样运行时表可以一直很小速度很快。</li>\n<li><strong>ACT<em>ID</em>*</strong>: ‘ID’表示identity。 这些表包含身份信息，比如用户，组等等。</li>\n<li><strong>ACT<em>HI</em>*</strong>: ‘HI’表示history。 这些表包含历史数据，比如历史流程实例， 变量，任务等等。</li>\n<li><strong>ACT<em>GE</em>*</strong>: 通用数据， 用于不同场景下。</li>\n</ol>\n<h3 id=\"1-3-1-资源库流程规则表\"><a href=\"#1-3-1-资源库流程规则表\" class=\"headerlink\" title=\"1.3.1 资源库流程规则表\"></a>1.3.1 资源库流程规则表</h3><ol>\n<li>act_re_deployment  部署信息表</li>\n<li>act_re_mode        流程设计模型部署表</li>\n<li>act_re_procdef     流程定义表</li>\n</ol>\n<h3 id=\"1-3-2-运行时数据库\"><a href=\"#1-3-2-运行时数据库\" class=\"headerlink\" title=\"1.3.2 运行时数据库\"></a>1.3.2 运行时数据库</h3><ol>\n<li>act_ru_execution    运行时流程执行实例表</li>\n<li>act_ru_identitylink 运行时流程人员表，主要存储任务节点与参与者的相关信息</li>\n<li>act_ru_task            运行时任务节点表</li>\n<li>act_ru_variable        运行时流程变量数据表</li>\n</ol>\n<h3 id=\"1-3-3-历史数据库表\"><a href=\"#1-3-3-历史数据库表\" class=\"headerlink\" title=\"1.3.3 历史数据库表\"></a>1.3.3 历史数据库表</h3><ol>\n<li>act_hi_actinst             历史节点表</li>\n<li>act_hi_attachment        历史附件表</li>\n<li>act_hi_comment            历史意见表</li>\n<li>act_hi_identitylink        历史流程人员表</li>\n<li>act_hi_detail            历史详情表，提供历史变量的查询</li>\n<li>act_hi_procinst            历史流程实例表</li>\n<li>act_hi_taskinst            历史任务实例表</li>\n<li>act_hi_varinst            历史变量表</li>\n</ol>\n<h3 id=\"1-3-4-组织机构表\"><a href=\"#1-3-4-组织机构表\" class=\"headerlink\" title=\"1.3.4 组织机构表\"></a>1.3.4 组织机构表</h3><ol>\n<li>act_id_group        用户组信息表</li>\n<li>act_id_info        用户扩展信息表</li>\n<li>act_id_membership    用户与用户组对应信息表</li>\n<li>act_id_user        用户信息表</li>\n</ol>\n<p>这四张表很常见，基本的组织机构管理，关于用户认证方面建议还是自己开发一套，组件自带的功能太简单，使用中有很多需求难以满足 。可以使shiro完成用户认证。</p>\n<h3 id=\"1-3-5-统用数据表\"><a href=\"#1-3-5-统用数据表\" class=\"headerlink\" title=\"1.3.5 统用数据表\"></a>1.3.5 统用数据表</h3><ol>\n<li>act_ge_bytearray        二进制数据表</li>\n<li>act_ge_property        属性数据表存储整个流程引擎级别的数据,初始化表结构时，会默认插入三条记录</li>\n</ol>\n<h2 id=\"1-4-activiti-cfg-xml\"><a href=\"#1-4-activiti-cfg-xml\" class=\"headerlink\" title=\"1.4 activiti.cfg.xml\"></a>1.4 activiti.cfg.xml</h2><p>Activiti核心配置文件，配置流程引擎创建工具的基本参数和数据库连接池参数。</p>\n<p>定义数据库配置参数：</p>\n<ul>\n<li>jdbcUrl: 数据库的JDBC URL。</li>\n<li>jdbcDriver: 对应不同数据库类型的驱动。</li>\n<li>jdbcUsername: 连接数据库的用户名。</li>\n<li>jdbcPassword: 连接数据库的密码。</li>\n</ul>\n<p>基于JDBC参数配置的数据库连接 会使用默认的MyBatis连接池。 下面的参数可以用来配置连接池（来自MyBatis参数）：</p>\n<ul>\n<li>jdbcMaxActiveConnections: 连接池中处于被使用状态的连接的最大值。默认为10。</li>\n<li>jdbcMaxIdleConnections: 连接池中处于空闲状态的连接的最大值。</li>\n<li>jdbcMaxCheckoutTime: 连接被取出使用的最长时间，超过时间会被强制回收。 默认为20000（20秒）。</li>\n<li>jdbcMaxWaitTime: 这是一个底层配置，让连接池可以在长时间无法获得连接时， 打印一条日志，并重新尝试获取一个连接。（避免因为错误配置导致沉默的操作失败）。 默认为20000（20秒）。</li>\n</ul>\n<p>示例如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">name</span>=<span class=\"string\">\"processEngineConfiguration\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcDriver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/activititest\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcUsername\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcPassword\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"123\"</span> /&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- </span></div><div class=\"line\">\tdatabaseSchemaUpdate：设置流程引擎启动和关闭时如何处理数据库表</div><div class=\"line\">\tfalse（默认）:检查数据库表的版本和依赖库的版本，如果不一致就抛出异常</div><div class=\"line\">\ttrue:构建流程引擎是执行检查，如果需要就更新，如果表不存在就创建</div><div class=\"line\">\tcreate-drop：构建流程引擎是创建表，关闭时删除表  </div><div class=\"line\">--&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"databaseSchemaUpdate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>关于c3p0、dbcp等数据库连接池配置请参看<a href=\"https://www.zybuluo.com/mdeditor#785927\" target=\"_blank\" rel=\"noopener\">spring(4)——持久层封装</a></p>\n<h2 id=\"1-5-logging-properties\"><a href=\"#1-5-logging-properties\" class=\"headerlink\" title=\"1.5 logging.properties\"></a>1.5 logging.properties</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">log4j.rootLogger=WARN, stdout</div><div class=\"line\">log4j.appender.stdout=org.apache.log4j.ConsoleAppender</div><div class=\"line\">log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</div><div class=\"line\">log4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - %m%n</div></pre></td></tr></table></figure>\n<p>更详细log4j说明请参看<a href=\"http://blog.csdn.net/dr_guo/article/details/50718063\" target=\"_blank\" rel=\"noopener\">log4j.properties配置详解与实例</a></p>\n<h1 id=\"2-环境搭建\"><a href=\"#2-环境搭建\" class=\"headerlink\" title=\"2 环境搭建\"></a>2 环境搭建</h1><h2 id=\"2-1-需求java环境\"><a href=\"#2-1-需求java环境\" class=\"headerlink\" title=\"2.1 需求java环境\"></a>2.1 需求java环境</h2><ol>\n<li>JDK1.6或更高</li>\n<li>支持的数据库有：h2, mysql, oracle, postgres, mssql, db2等。</li>\n<li>支持activiti5运行的jar包</li>\n<li>开发环境为Eclipse3.7或者以上版本,myeclipse为8.6版本</li>\n</ol>\n<h2 id=\"2-2-资源下载\"><a href=\"#2-2-资源下载\" class=\"headerlink\" title=\"2.2 资源下载\"></a>2.2 资源下载</h2><p>activiti可以到<a href=\"http://activiti.org/download.htmlt/dr_guo/article/details/50718063\" target=\"_blank\" rel=\"noopener\">Activiti官方网站</a>下载得到。</p>\n<p>百度网盘下载地址，5.22.0和6.0.0两个版本，还有eclipse插件。<a href=\"http://pan.baidu.com/s/1qYmgdlE\" target=\"_blank\" rel=\"noopener\">百度网盘下载</a></p>\n<p>注意：安装插件后，在Windows-&gt;Preferences-&gt;Activiti-&gt;Save菜单下勾选保存时自动生成图片。</p>\n<h2 id=\"2-3-配置开发环境\"><a href=\"#2-3-配置开发环境\" class=\"headerlink\" title=\"2.3 配置开发环境\"></a>2.3 配置开发环境</h2><h3 id=\"2-3-1-添加jar包\"><a href=\"#2-3-1-添加jar包\" class=\"headerlink\" title=\"2.3.1 添加jar包\"></a>2.3.1 添加jar包</h3><p>在activiti-5.22.0→wars目录下是一些示例项目，解压activiti-rest项目，导入activiti-rest目录中WEB-INF\\lib下所有jar包到classpath中。<br>注意还需要数据库连接驱动包，如Mysql还需要添加<strong>mysql-connector-java.jar</strong>。</p>\n<h3 id=\"2-3-2-初始化数据库\"><a href=\"#2-3-2-初始化数据库\" class=\"headerlink\" title=\"2.3.2 初始化数据库\"></a>2.3.2 初始化数据库</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createTable</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//1、创建流程引擎配置对象</span></div><div class=\"line\">\tProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration.createStandaloneProcessEngineConfiguration();</div><div class=\"line\">\t<span class=\"comment\">//2、配置数据库</span></div><div class=\"line\">\tprocessEngineConfiguration.setJdbcDriver(<span class=\"string\">\"com.mysql.jdbc.Driver\"</span>);</div><div class=\"line\">\tprocessEngineConfiguration.setJdbcUrl(<span class=\"string\">\"jdbc:mysql://localhost:3306/activititest\"</span>);</div><div class=\"line\">\tprocessEngineConfiguration.setJdbcUsername(<span class=\"string\">\"root\"</span>);</div><div class=\"line\">\tprocessEngineConfiguration.setJdbcPassword(<span class=\"string\">\"123\"</span>);</div><div class=\"line\">\t<span class=\"comment\">//3、设置建表策略</span></div><div class=\"line\">\tprocessEngineConfiguration.setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE);</div><div class=\"line\">\t<span class=\"comment\">//4、创建流程引擎对象</span></div><div class=\"line\">\tProcessEngine processEngine = processEngineConfiguration.buildProcessEngine();</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"processEngine\"</span>+processEngine);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>在Activiti中，在创建核心的流程引擎对象时会自动建表。如果程序正常执行，mysql会自动建库，然后创建23张表。</p>\n<h3 id=\"2-3-3-配置文件\"><a href=\"#2-3-3-配置文件\" class=\"headerlink\" title=\"2.3.3 配置文件\"></a>2.3.3 配置文件</h3><p>在Actiiti5中定制流程必定会操作到数据库，如果都像上面那样写一大段代码会非常麻烦，所以我们可以把数据库连接配置写入配置文件。</p>\n<p>在Activiti5的官方示例中并没有现成的配置文件，所以先得找到activiti-rest\\WEB-INF\\classes下有：<strong>activiti-context.xml</strong>：一个类似spring结构的配置文件，清空内容后改名为activiti.cfg.xml，用来做流程引擎的相关配置。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">name</span>=<span class=\"string\">\"processEngineConfiguration\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcDriver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/activititest\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcUsername\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcPassword\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"123\"</span> /&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- </span></div><div class=\"line\">\tdatabaseSchemaUpdate：设置流程引擎启动和关闭时如何处理数据库表</div><div class=\"line\">\tfalse（默认）:检查数据库表的版本和依赖库的版本，如果不一致就抛出异常</div><div class=\"line\">\ttrue:构建流程引擎是执行检查，如果需要就更新，如果表不存在就创建</div><div class=\"line\">\tcreate-drop：构建流程引擎是创建表，关闭时删除表  </div><div class=\"line\">--&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"databaseSchemaUpdate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>Java代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createTable2</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class=\"string\">\"activiti.cfg.xml\"</span>);</div><div class=\"line\">\tProcessEngine processEngine = processEngineConfiguration.buildProcessEngine();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h1 id=\"3-核心API\"><a href=\"#3-核心API\" class=\"headerlink\" title=\"3 核心API\"></a>3 核心API</h1><h2 id=\"3-1-ProcessEngine\"><a href=\"#3-1-ProcessEngine\" class=\"headerlink\" title=\"3.1 ProcessEngine\"></a>3.1 ProcessEngine</h2><ol>\n<li>在Activiti中最核心的类，其他的类都是由它而来。</li>\n<li><p>产生方式<br>2.1 方式一：最基础版本，见2.3.2小节<br>2.2 方式二：配置文件+java代码，见2.3.3小节</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createTable3</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>这种方式更加简单，会自动加载classpath下名为activiti.cfg.xml的文件。</p>\n</li>\n<li><p>产生各种service</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//流程仓库业务类，管理流程定义、部署</span></div><div class=\"line\">RepositoryService repositoryService = processEngine.getRepositoryService();</div><div class=\"line\"><span class=\"comment\">//流程运行业务类，管理流程启动、推进、删除等操作</span></div><div class=\"line\">RuntimeService runtimeService = processEngine.getRuntimeService();</div><div class=\"line\"><span class=\"comment\">//流程任务类，管理具体的任务</span></div><div class=\"line\">TaskService taskService = processEngine.getTaskService();</div><div class=\"line\"><span class=\"comment\">//流程历史数据类</span></div><div class=\"line\">HistoryService historyService = processEngine.getHistoryService();</div><div class=\"line\"><span class=\"comment\">//流程用户业务类</span></div><div class=\"line\">IdentityService identityService = processEngine.getIdentityService();</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"3-2-ReposityService\"><a href=\"#3-2-ReposityService\" class=\"headerlink\" title=\"3.2 ReposityService\"></a>3.2 ReposityService</h2><p>流程仓库业务类，仓库简单理解即流程定义文档的两个文件：bpmn文件和流程图片</p>\n<ol>\n<li><p>产生流程部署配置对象，用来定义流程部署的相关参数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">@Test</div><div class=\"line\">public void Demo1() &#123;</div><div class=\"line\">\tDeploymentBuilder deploymentBuilder = processEngine.getRepositoryService().createDeployment().name(&quot;test&quot;);</div><div class=\"line\">\tdeploymentBuilder.addClasspathResource(&quot;diagrams/HelloWord.bpmn&quot;);</div><div class=\"line\">\tdeploymentBuilder.addClasspathResource(&quot;diagrams/HelloWord.png&quot;);</div><div class=\"line\">\t</div><div class=\"line\">\tDeployment deployment = deploymentBuilder.deploy();</div><div class=\"line\">\tSystem.out.println(deployment.getId() + &quot;。。。。&quot;+ deployment.getName());</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>删除流程定义</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">repositoryService.deleteDeployment(deploymentId);</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"3-3-RuntimeService\"><a href=\"#3-3-RuntimeService\" class=\"headerlink\" title=\"3.3 RuntimeService\"></a>3.3 RuntimeService</h2><p>流程执行服务类。可以从这个类中获取很多关于流程执行相关的信息。</p>\n<ol>\n<li><p>启动流程</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//常用的启动流程实例的两种方法</span></div><div class=\"line\">ProcessInstance processInstance = runtimeService.startProcessInstanceById(processInstanceId);</div><div class=\"line\">ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(processInstanceKey);</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"3-4-TaskService\"><a href=\"#3-4-TaskService\" class=\"headerlink\" title=\"3.4 TaskService\"></a>3.4 TaskService</h2><p>activiti的任务服务类。可以从这个类中获取任务的信息。</p>\n<h2 id=\"3-5-ProcessDefinition\"><a href=\"#3-5-ProcessDefinition\" class=\"headerlink\" title=\"3.5 ProcessDefinition\"></a>3.5 ProcessDefinition</h2><p>流程定义类。可以从这里获得资源文件等。<br>每个流程文件唯一对应一个相同key的流程定义，只是流程定义的version不同</p>\n<h2 id=\"3-6-ProcessInstance\"><a href=\"#3-6-ProcessInstance\" class=\"headerlink\" title=\"3.6 ProcessInstance\"></a>3.6 ProcessInstance</h2><p>流程实例。根据流程定义实例化的具体流程，我们可以利用这个对象来了解当前流程实例的进度等信息。<br>如：<br>    公司有一个所有人通用的请假流程，这个叫做流程定义。<br>    小明今天请假，填写请假单，就是创建了一个流程实例。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/** Represents one execution of a  &#123;<span class=\"doctag\">@link</span> ProcessDefinition&#125;.</span></div><div class=\"line\"> 1. </div><div class=\"line\"> 2. <span class=\"doctag\">@author</span> Tom Baeyens</div><div class=\"line\"> 3. <span class=\"doctag\">@author</span> Joram Barrez</div><div class=\"line\"> 4. <span class=\"doctag\">@author</span> Daniel Meyer</div><div class=\"line\"> 5. <span class=\"doctag\">@author</span> Tijs Rademakers</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ProcessInstance</span> <span class=\"keyword\">extends</span> <span class=\"title\">Execution</span> </span>&#123;</div></pre></td></tr></table></figure>\n<p>从上面可以看出ProcessInstance就是Execution，但实际有点区别</p>\n<ol>\n<li>单线流程中，ProcessInstance与Execution是一致的，ID都一样</li>\n<li>多线 流程中，总线路代表ProcessInstance，而分线路中每个活动代表Execution。</li>\n</ol>\n<h2 id=\"3-7-Execution\"><a href=\"#3-7-Execution\" class=\"headerlink\" title=\"3.7 Execution\"></a>3.7 Execution</h2><p>Activiti用这个对象去描述流程执行的每一个节点。在没有并发的情况下，同ProcessInstance。</p>\n<h1 id=\"4-流程定义\"><a href=\"#4-流程定义\" class=\"headerlink\" title=\"4 流程定义\"></a>4 流程定义</h1><h2 id=\"4-1-创建流程文件\"><a href=\"#4-1-创建流程文件\" class=\"headerlink\" title=\"4.1 创建流程文件\"></a>4.1 创建流程文件</h2><p>在classpath下创建流程文件<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/create.png\" alt=\"创建\"><br>编辑流程文件<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/example.png\" alt=\"编辑\"></p>\n<h2 id=\"4-2-部署流程定义\"><a href=\"#4-2-部署流程定义\" class=\"headerlink\" title=\"4.2 部署流程定义\"></a>4.2 部署流程定义</h2><p>部署流程定义可以看成是添加流程定义<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">deploy</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//创建流程引擎</span></div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    <span class=\"comment\">//创建流程部署对象</span></div><div class=\"line\">    DeploymentBuilder deploymentBuilder = processEngine.getRepositoryService().createDeployment();</div><div class=\"line\">    <span class=\"comment\">//读取文件部署流程</span></div><div class=\"line\">    Deployment deploy = deploymentBuilder.name(<span class=\"string\">\"测试\"</span>)</div><div class=\"line\">                            .addClasspathResource(<span class=\"string\">\"diagrams/HelloWord.bpmn\"</span>)</div><div class=\"line\">                            .addClasspathResource(<span class=\"string\">\"diagrams/HelloWord.png\"</span>)</div><div class=\"line\">                            .deploy();</div><div class=\"line\">    </div><div class=\"line\">    System.out.println(deploy.getId() + <span class=\"string\">\"。。。\"</span> + deploy.getName());</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p><strong>部署流程会改变3张表</strong></p>\n<ul>\n<li>act_re_deployment<br> 存放流程定义的显示名和部署时间，每部署一次增加一条记录</li>\n<li>act_re_procdef<br> 存放流程定义的属性信息，部署每个新的流程定义都会在这张表中增加一条记录。</li>\n<li>act_ge_bytearray<br> 存储流程定义相关的部署信息。即流程定义文档的存放地。每部署一次就会增加两条记录，一条是关于bpmn规则文件的，一条是图片的（如果部署时只指定了bpmn一个文件，activiti会在部署时解析bpmn文件内容自动生成流程图）。两个文件不是很大，都是以二进制形式存储在数据库中。</li>\n</ul>\n<h2 id=\"4-3-查看流程定义\"><a href=\"#4-3-查看流程定义\" class=\"headerlink\" title=\"4.3 查看流程定义\"></a>4.3 查看流程定义</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">view</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();</div><div class=\"line\">    List&lt;ProcessDefinition&gt; list = repositoryService.createProcessDefinitionQuery()</div><div class=\"line\">                                        <span class=\"comment\">//过滤条件</span></div><div class=\"line\">                                        .processDefinitionKey(<span class=\"string\">\"HelloWorld\"</span>)</div><div class=\"line\">                                        <span class=\"comment\">//.processDefinitionId(processDefinitionId)</span></div><div class=\"line\">                                        <span class=\"comment\">//分页</span></div><div class=\"line\">                                        <span class=\"comment\">//.listPage(firstResult, maxResults)</span></div><div class=\"line\">                                        <span class=\"comment\">//排序</span></div><div class=\"line\">                                        <span class=\"comment\">//.orderByProcessDefinitionVersion()</span></div><div class=\"line\">                                        <span class=\"comment\">//执行查询</span></div><div class=\"line\">                                        .list();</div><div class=\"line\">    <span class=\"keyword\">for</span> (ProcessDefinition processDefinition : list) &#123;</div><div class=\"line\">        System.out.print(<span class=\"string\">\"id:\"</span> + processDefinition.getId() + <span class=\"string\">\",\"</span>);<span class=\"comment\">//流程Id</span></div><div class=\"line\">        System.out.print(<span class=\"string\">\"key:\"</span> + processDefinition.getKey() + <span class=\"string\">\",\"</span>);<span class=\"comment\">//流程Key</span></div><div class=\"line\">        System.out.print(<span class=\"string\">\"name:\"</span> + processDefinition.getName() + <span class=\"string\">\",\"</span>);<span class=\"comment\">//流程名字</span></div><div class=\"line\">        System.out.print(<span class=\"string\">\"version:\"</span> + processDefinition.getVersion() + <span class=\"string\">\",\"</span>);<span class=\"comment\">//流程版本</span></div><div class=\"line\">        System.out.println(<span class=\"string\">\"deploymentId():\"</span> + processDefinition.getDeploymentId());<span class=\"comment\">//流程部署对象Id</span></div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>查询结果</p>\n<pre><code>id:HelloWorld:1:35004,key:HelloWorld,name:请假审批流程,version:1,deploymentId():35001\n</code></pre><p>再部署一次，再查询</p>\n<pre><code>id:HelloWorld:1:35004,key:HelloWorld,name:请假审批流程,version:1,deploymentId():35001\nid:HelloWorld:2:37504,key:HelloWorld,name:请假审批流程,version:2,deploymentId():37501\n</code></pre><p>说明：</p>\n<ol>\n<li>因为流程定义的信息在仓库中，实际在act<em>re</em>*表中，所以创建RepositoryService</li>\n<li>创建查询对象<strong>ProcessDefinitionQuery</strong>，设置查询参数，调用list()执行查询</li>\n<li><p>由查询结果可知：<br>3.1 流程定义的key和name与流程文件的id和name一致</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">process</span> <span class=\"attr\">id</span>=<span class=\"string\">\"HelloWorld\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"请假审批流程\"</span> <span class=\"attr\">isExecutable</span>=<span class=\"string\">\"true\"</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>3.2 key属性被用来区别不同的流程定义。<br>3.3 带有特定key的流程定义第一次部署时，version为1。之后每次部署都会在当前最高版本号上加1<br>3.4 Id的生成规则为：<strong>{processDefinitionKey}:{processDefinitionVersion}:{generated-id}</strong>，这里的generated-id是一个自动生成的唯一的数字<br>3.5 重复部署一次，deploymentId的值以一定的形式变化</p>\n</li>\n</ol>\n<h2 id=\"4-4-删除流程定义\"><a href=\"#4-4-删除流程定义\" class=\"headerlink\" title=\"4.4 删除流程定义\"></a>4.4 删除流程定义</h2><p>删除部署到activiti中的流程定义。如:删除请假流程定义，则大家再也不能请假了。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">delete</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();</div><div class=\"line\">    String deploymentId = <span class=\"string\">\"7501\"</span>;</div><div class=\"line\">    <span class=\"comment\">//如果有关联信息，会报错</span></div><div class=\"line\">    <span class=\"comment\">//repositoryService.deleteDeployment(deploymentId);</span></div><div class=\"line\">    <span class=\"comment\">//如果有关联信息，会级联删除</span></div><div class=\"line\">    repositoryService.deleteDeployment(deploymentId, <span class=\"keyword\">true</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"4-5-获取流程定义文档资源\"><a href=\"#4-5-获取流程定义文档资源\" class=\"headerlink\" title=\"4.5 获取流程定义文档资源\"></a>4.5 获取流程定义文档资源</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getResource</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</div><div class=\"line\">    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();</div><div class=\"line\">   </div><div class=\"line\">    String deploymentId = <span class=\"string\">\"35001\"</span>;</div><div class=\"line\">    String resourceName = <span class=\"keyword\">null</span>;</div><div class=\"line\">    <span class=\"comment\">//资源文件名,即act_re_bytearray表中的name</span></div><div class=\"line\">    List&lt;String&gt; names = repositoryService.getDeploymentResourceNames(deploymentId);</div><div class=\"line\">    <span class=\"keyword\">for</span> (String str : names) &#123;</div><div class=\"line\">        <span class=\"comment\">//过滤出特定的图片文件</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (str.indexOf(<span class=\"string\">\"HelloWorld.png\"</span>) != -<span class=\"number\">1</span>) &#123;</div><div class=\"line\">            resourceName = str;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    System.out.println(resourceName);</div><div class=\"line\">    <span class=\"keyword\">if</span> (resourceName != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">        <span class=\"comment\">//通过部署ID和文件名获得输入流</span></div><div class=\"line\">        InputStream inputStream = repositoryService.getResourceAsStream(deploymentId, resourceName);</div><div class=\"line\">        File file = <span class=\"keyword\">new</span> File(<span class=\"string\">\"D:/\"</span>+ resourceName);</div><div class=\"line\">        FileUtils.copyInputStreamToFile(inputStream, file);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h1 id=\"5-流程实例\"><a href=\"#5-流程实例\" class=\"headerlink\" title=\"5 流程实例\"></a>5 流程实例</h1><h2 id=\"5-1-启动流程实例\"><a href=\"#5-1-启动流程实例\" class=\"headerlink\" title=\"5.1 启动流程实例\"></a>5.1 启动流程实例</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">startProcess</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    RuntimeService runtimeService = ProcessEngines.getDefaultProcessEngine().getRuntimeService();</div><div class=\"line\">    <span class=\"comment\">//根据流程Id启动流程</span></div><div class=\"line\">    <span class=\"comment\">//ProcessInstance processInstance = runtimeService.startProcessInstanceById(processDefinitionId);</span></div><div class=\"line\">    <span class=\"comment\">//根据流程key启动流程，会自动找到版本最高的流程定义来创建</span></div><div class=\"line\">    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(<span class=\"string\">\"HelloWorld\"</span>);</div><div class=\"line\">    System.out.println(processInstance.getId());<span class=\"comment\">//流程实例Id</span></div><div class=\"line\">    System.out.println(processInstance.getActivityId());<span class=\"comment\">//流程当前节点Id</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<pre><code>启动流程实例有很多重载方法，根据实际需要选用。\n</code></pre><h2 id=\"5-2-查询任务\"><a href=\"#5-2-查询任务\" class=\"headerlink\" title=\"5.2 查询任务\"></a>5.2 查询任务</h2><p>在Activiti中，任务主要分为两类：</p>\n<ol>\n<li>确切指定了办理者的任务，之歌任务称为制定者的私人任务</li>\n<li>2.无法指定具体的某一个人来办理的任务，可以把任务分配给几个人或者一到    多个小组，让这个范围内的用户可以选择性（如有空余时间时）来办理这类任务。</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">taskQuery</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    TaskService taskService = ProcessEngines.getDefaultProcessEngine().getTaskService();</div><div class=\"line\">    List&lt;Task&gt; list = taskService.createTaskQuery()</div><div class=\"line\">            <span class=\"comment\">//查询指定用户的私人任务</span></div><div class=\"line\">            <span class=\"comment\">//.taskAssignee(\"指定用户\")</span></div><div class=\"line\">            <span class=\"comment\">//查询某人可接的共有任务</span></div><div class=\"line\">            <span class=\"comment\">//.taskCandidateUser(\"候选用户\")</span></div><div class=\"line\">            <span class=\"comment\">//排序</span></div><div class=\"line\">            .orderByTaskCreateTime().desc()</div><div class=\"line\">            <span class=\"comment\">//执行查询</span></div><div class=\"line\">            .list();</div><div class=\"line\">    <span class=\"keyword\">for</span> (Task task : list) &#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"id:\"</span> + task.getId());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"name:\"</span> + task.getName());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"assignee:\"</span> + task.getAssignee());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"createTime:\"</span> + task.getCreateTime());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ProcessInstanceId:\"</span> + task.getProcessInstanceId());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ProcessDefinitionId:\"</span> + task.getProcessDefinitionId());</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"5-3-认领任务\"><a href=\"#5-3-认领任务\" class=\"headerlink\" title=\"5.3 认领任务\"></a>5.3 认领任务</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">taskService.claim(taskId, userId);</div></pre></td></tr></table></figure>\n<p>将任务变为用户的私人任务</p>\n<h2 id=\"5-4-办理任务\"><a href=\"#5-4-办理任务\" class=\"headerlink\" title=\"5.4 办理任务\"></a>5.4 办理任务</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//根据任务Id办理任务</span></div><div class=\"line\">taskService.complete(taskId);</div><div class=\"line\"><span class=\"comment\">//根据任务Id办理任务,并设置任务变量</span></div><div class=\"line\">taskService.complete(taskId, variables);</div></pre></td></tr></table></figure>\n<p>variables是Map，当设置变量时，会在act_ru_variables表中添加相应条数的数据，变量可以用来执行gateway的判断，后面会讲到gateway。</p>\n<h2 id=\"5-5-判断流程是否结束\"><a href=\"#5-5-判断流程是否结束\" class=\"headerlink\" title=\"5.5 判断流程是否结束\"></a>5.5 判断流程是否结束</h2><p>在流程执行过程中，创建的流程实例ID在整个过程都不会变，当流程结束后，流程实例将被删除。</p>\n<ol>\n<li>从运行库中查询该流程是否还存在</li>\n<li>从历史库中查询该流程是否存在</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">checkStatus</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    String processInstanceId = <span class=\"string\">\"1213\"</span>;</div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    RuntimeService runtimeService = processEngine.getRuntimeService();</div><div class=\"line\">    <span class=\"comment\">//从运行库查询该流程实例是否存在</span></div><div class=\"line\">    ProcessInstance instance = runtimeService.createProcessInstanceQuery()</div><div class=\"line\">                                    .processInstanceId(processInstanceId)</div><div class=\"line\">                                    .singleResult();</div><div class=\"line\">    <span class=\"comment\">//实例不存在，可能未开始或者已结束</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (instance == <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">        <span class=\"comment\">//从历史库查</span></div><div class=\"line\">        HistoryService historyService = processEngine.getHistoryService();</div><div class=\"line\">        HistoricProcessInstance singleResult = historyService.createHistoricProcessInstanceQuery()</div><div class=\"line\">                                                .processInstanceId(processInstanceId)</div><div class=\"line\">                                                .singleResult();</div><div class=\"line\">        <span class=\"keyword\">if</span> (singleResult != <span class=\"keyword\">null</span> &amp;&amp; singleResult.getEndTime() != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">            <span class=\"comment\">//流程已结束</span></div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">\"COMPLETE\"</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            <span class=\"comment\">//流程未开始</span></div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">\"NOT_START\"</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> instance.getActivityId();<span class=\"comment\">//当前任务节点</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h1 id=\"6-流程历史\"><a href=\"#6-流程历史\" class=\"headerlink\" title=\"6 流程历史\"></a>6 流程历史</h1><p>在前一个的例子中，大家可能会流程执行完毕后，究竟去了哪里有些疑问。虽然已完成的任务在act_ru_task和act_ru_execution表中都已被删除，但是这些数据还存在activiti的数据库中，作为历史改由HistoryService来管理。</p>\n<p>历史是一个组件，它可以捕获发生在进程执行中的信息并永久的保存，与运行时数据不同的是，当流程实例运行完成之后它还会存在于数据库中。</p>\n<p>在流程引擎配置对象中可以设置历史记录规则：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">name</span>=<span class=\"string\">\"processEngineConfiguration\"</span> </span></div><div class=\"line\">  \t  <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"databaseSchemaUpdate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!--</span></div><div class=\"line\">\t\tActiviti提供了四种历史级别：</div><div class=\"line\">\t\tnone:不保存任何历史，可以提高性能</div><div class=\"line\">\t\tactiviti:保存所有流程实例、任务、活动信息</div><div class=\"line\">\t\taudit:默认级别,保存所有流程实例、任务、活动、表单</div><div class=\"line\">\t\tfull:保存所有信息,如流程变量</div><div class=\"line\">\t  --&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"history\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"activiti\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>由于数据库中保存着历史信息以及正在运行的流程实例信息，在实际项目中对已完成任务的查看频率远不及对代办和可接任务的查看，所以在activiti采用分开管理，把正在运行的交给runtimeService管理，而历史数据交给HistoryService来管理。</p>\n<p>对已成为历史的数据主要进行查询操作，我们主要关心两种类型的历史数据：</p>\n<ul>\n<li><strong>HistoricProcessInstance</strong> 包含当前和已经结束的流程实例信息。</li>\n<li><strong>HistoricActivityInstance</strong> 包含一个活动(流程上的节点)的执行信息。</li>\n</ul>\n<h2 id=\"6-1-查看历史流程实例\"><a href=\"#6-1-查看历史流程实例\" class=\"headerlink\" title=\"6.1 查看历史流程实例\"></a>6.1 查看历史流程实例</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">queryHisInstance</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//流程引擎</span></div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    <span class=\"comment\">//流程定义ID</span></div><div class=\"line\">    String processDefinitionId = <span class=\"string\">\"HelloWorld:2:37504\"</span>;</div><div class=\"line\">    <span class=\"comment\">//查询历史流程实例</span></div><div class=\"line\">    List&lt;HistoricProcessInstance&gt; list = processEngine.getHistoryService().createHistoricProcessInstanceQuery()</div><div class=\"line\">                                        .processDefinitionId(processDefinitionId)</div><div class=\"line\">                                        .finished()</div><div class=\"line\">                                        .orderByProcessInstanceStartTime().desc()</div><div class=\"line\">                                        .list();</div><div class=\"line\">    <span class=\"keyword\">for</span> (HistoricProcessInstance hp : list) &#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ID：\"</span>+hp.getId());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"startTime：\"</span>+hp.getStartTime());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"endTime：\"</span>+hp.getEndTime());</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>1.通常查询历史流程实例都需要指定一个过滤条件，指定    processDefinitionId查看具体某一次部署所开启的流程或者指定    processDefinitionKey查看某个规则下不限版本的所有流程</p>\n<p>2.可以选择性添加finished方法控制是否查询未完成的流程实例。在流    程开启时，activiti同时在act_ru_execution表和act_hi_procinst表中    创建了一条记录，在流程完成之前act_hi_procinst表中实例的结束时间为空</p>\n<h2 id=\"6-2-查看历史流程活动（节点）\"><a href=\"#6-2-查看历史流程活动（节点）\" class=\"headerlink\" title=\"6.2 查看历史流程活动（节点）\"></a>6.2 查看历史流程活动（节点）</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">queryHisActiviti</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//流程引擎</span></div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    <span class=\"comment\">//流程实例ID</span></div><div class=\"line\">    String processInstanceId = <span class=\"string\">\"HelloWorld:2:37504\"</span>;</div><div class=\"line\">    <span class=\"comment\">//查询历史流程活动</span></div><div class=\"line\">    List&lt;HistoricActivityInstance&gt; list = processEngine.getHistoryService()</div><div class=\"line\">                                        <span class=\"comment\">//创建历史流程活动实例查询对象</span></div><div class=\"line\">                                        .createHistoricActivityInstanceQuery()</div><div class=\"line\">                                        <span class=\"comment\">//过滤条件</span></div><div class=\"line\">                                        .processInstanceId(processInstanceId)</div><div class=\"line\">                                        <span class=\"comment\">//排序</span></div><div class=\"line\">                                        .orderByHistoricActivityInstanceStartTime().desc()</div><div class=\"line\">                                        <span class=\"comment\">//执行查询</span></div><div class=\"line\">                                        .list();</div><div class=\"line\">    <span class=\"keyword\">for</span> (HistoricActivityInstance ha : list) &#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ID：\"</span>+ha.getActivityId());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"name:\"</span>+ha.getActivityName());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"startTime：\"</span>+ha.getStartTime());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"endTime：\"</span>+ha.getEndTime());</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>通常查询历史流程活动都需要指定一个过滤条件，指定processInstanceId查看具体某一次流程执行过程中所经历的步奏</p>\n<h1 id=\"7-流程变量\"><a href=\"#7-流程变量\" class=\"headerlink\" title=\"7 流程变量\"></a>7 流程变量</h1><p>流程变量在整个工作流中扮演很重要的作用。例如：请假流程中有请假天数、请假原因等一些参数都为流程变量的范围。<br>流程变量的作用域范围是流程实例。也就是说各个流程实例的流程变量是不相互影响的。<br>流程实例结束完成以后流程变量是否保存在数据库中取决于存储策略，见第六章。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/variable.png\" alt=\"流程变量\"></p>\n<h2 id=\"7-1-添加流程变量\"><a href=\"#7-1-添加流程变量\" class=\"headerlink\" title=\"7.1 添加流程变量\"></a>7.1 添加流程变量</h2><ol>\n<li><p>启动流程实例时添加</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addVariables</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    RuntimeService runtimeService = processEngine.getRuntimeService();</div><div class=\"line\">    </div><div class=\"line\">    String processDefinitionKey = <span class=\"string\">\"HelloWorld\"</span>;</div><div class=\"line\">    Map&lt;String,Object&gt; variables = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</div><div class=\"line\">    variables.put(<span class=\"string\">\"请假天数\"</span>, <span class=\"number\">3</span>);</div><div class=\"line\">    variables.put(<span class=\"string\">\"请假原因\"</span>, <span class=\"string\">\"约会\"</span>);</div><div class=\"line\">    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(processDefinitionKey, variables);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>说明：</p>\n<pre><code>1)    在启动流程实例时，通过重载startProcessInstanceByKey的方法可以加载流程变量。\n2)    第二个参数要求是Map&lt;String ,Object&gt;类型，意味着可以添加多个流程变量。\n3)    当这段代码执行完以后，会在数据库表act_ru_variable中添加两行记录。\n</code></pre></li>\n</ol>\n<ol>\n<li>完成任务时添加<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//办理过程中</span></div><div class=\"line\">taskService.setVariables(taskId, variables);</div><div class=\"line\"><span class=\"comment\">//提交时</span></div><div class=\"line\">taskService.complete(taskId, variables);</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li>执行流程实例时添加<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//执行流程实例时</span></div><div class=\"line\">runtimeService.setVariables(executionId, variables);</div><div class=\"line\"><span class=\"comment\">//流程实例提交时</span></div><div class=\"line\">runtimeService.signal(executionId, processVariables);<span class=\"comment\">//signal用于接受任务</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"7-2-获取流程变量\"><a href=\"#7-2-获取流程变量\" class=\"headerlink\" title=\"7.2 获取流程变量\"></a>7.2 获取流程变量</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//某个流程的变量</span></div><div class=\"line\">runtimeService.getVariables(executionId);</div><div class=\"line\"><span class=\"comment\">//某个任务的变量</span></div><div class=\"line\">taskService.getVariables(taskId);</div></pre></td></tr></table></figure>\n<p>说明：这些流程变量是从act_ru_variable这个表中读出来的。</p>\n<h2 id=\"7-3-流程变量范围\"><a href=\"#7-3-流程变量范围\" class=\"headerlink\" title=\"7.3 流程变量范围\"></a>7.3 流程变量范围</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/baseVar.png\" alt=\"此处输入图片的描述\"></p>\n<p>从图中可以看出包括了大部分封装类型和Date、String和实现了Serializable接口的类的类型。</p>\n<h2 id=\"7-4-Javabean类型变量\"><a href=\"#7-4-Javabean类型变量\" class=\"headerlink\" title=\"7.4 Javabean类型变量\"></a>7.4 Javabean类型变量</h2><ol>\n<li>定义一个javabean，这个javabean实现了Serializable接口</li>\n<li>实例化javaBean，放到map中，然后正常设置流程变量</li>\n<li>正常取出变量</li>\n</ol>\n<h1 id=\"8-流程定义语言\"><a href=\"#8-流程定义语言\" class=\"headerlink\" title=\"8 流程定义语言\"></a>8 流程定义语言</h1><h2 id=\"8-1-流程（Process）\"><a href=\"#8-1-流程（Process）\" class=\"headerlink\" title=\"8.1 流程（Process）\"></a>8.1 流程（Process）</h2><p>bpmn文件一个流程的根元素。一个流程就代表一个工作流。</p>\n<h2 id=\"8-2-顺序流（sequenceFlow）\"><a href=\"#8-2-顺序流（sequenceFlow）\" class=\"headerlink\" title=\"8.2 顺序流（sequenceFlow）\"></a>8.2 顺序流（sequenceFlow）</h2><p>顺序流是连接两个流程节点的连线，代表一个节点的出口。流程执行完一个节点后，会沿着节点的所有外出顺序流继续执行。 就是说，BPMN 2.0默认的行为就是并发的： 两个外出顺序流会创造两个单独的，并发流程分支。</p>\n<p>顺序流主要由4个属性组成：</p>\n<ul>\n<li>Id: 唯一标示，用来区分不同的顺序流</li>\n<li>sourceRef：连线的源头节点ID</li>\n<li>targetRef：连线的目标节点ID</li>\n<li>name（可选）：连线的名称，不涉及业务，主要用于显示</li>\n</ul>\n<h2 id=\"8-3-节点\"><a href=\"#8-3-节点\" class=\"headerlink\" title=\"8.3 节点\"></a>8.3 节点</h2><h3 id=\"8-3-1-开始事件节点-startEvent\"><a href=\"#8-3-1-开始事件节点-startEvent\" class=\"headerlink\" title=\"8.3.1 开始事件节点(startEvent)\"></a>8.3.1 开始事件节点(startEvent)</h3><p>开始事件用来指明流程在哪里开始。开始事件的类型（流程在接收事件时启动， 还是在指定时间启动，等等），定义了流程如何启动， 这通过事件中不同的小图表来展示。 在XML中，这些类型是通过声明不同的子元素来区分的。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/startEvent.png\" alt=\"此处输入图片的描述\"></p>\n<ol>\n<li><p>空开始事件<br>空开始事件技术上意味着没有指定启动流程实例的触发条件。最常用的一种开始，意味着流程的启动需要手动触发，通过调用api的startProcessInstanceByXXX方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">ProcessInstance processInstance = runtimeService.startProcessInstanceByXXX()</div></pre></td></tr></table></figure>\n<p>图形标记：空开始事件显示成一个圆圈，没有内部图表（没有触发类型）<br>XML结构如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">startEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"startevent\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Start\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">startEvent</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>定时开始事件</p>\n<p>定时开始事件用来在指定的时间创建流程实例。 它可以同时用于只启动一次的流程 和应该在特定时间间隔启动多次的流程。</p>\n<pre><code>注意：\n1.子流程不能使用定时开始事件。\n2.定时开始事件在流程发布后就会开始计算时间。不需要调用startProcessInstanceByXXX，虽然也而已调用启动流程的方法，但是那会导致调用startProcessInstanceByXXX时启动过多的流程。\n3.当包含定时开始事件的新版本流程部署时，对应的上一个定时器就会被删除。这是因为通常不希望自动启动旧版本流程的流程实例。\n</code></pre><p>图形标记：定时开始事件显示为一个圆圈，内部是一个表。<br>XML内容：定时开始事件的XML内容是普通开始事件的声明，包含一个定时定义子元素。<br>示例：流程会启动4次，每次间隔5分钟，从2013年9月18日，12:10开始计时。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">startEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theStart\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">timerEventDefinition</span>&gt;</span>                </div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">timeCycle</span>&gt;</span>R4/2017-11-22T11:04/PT5M<span class=\"tag\">&lt;/<span class=\"name\">timeCycle</span>&gt;</span>            \t\t </div><div class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">timerEventDefinition</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">startEvent</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>示例：流程会根据选中的时间启动一次。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">startEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theStart\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">timerEventDefinition</span>&gt;</span>                </div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">timeDate</span>&gt;</span>2017-12-31T23:59:59<span class=\"tag\">&lt;/<span class=\"name\">timeDate</span>&gt;</span>               \t\t </div><div class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">timerEventDefinition</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">startEvent</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"8-3-2-结束事件节点-endEvent\"><a href=\"#8-3-2-结束事件节点-endEvent\" class=\"headerlink\" title=\"8.3.2 结束事件节点(endEvent)\"></a>8.3.2 结束事件节点(endEvent)</h3><p>结束事件表示（子）流程（分支）的结束。结束事件都是触发事件。这是说当流程达结束事件，会触发一个结果。 结果的类型是通过事件的内部黑色图标表示的。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/endEvent.png\" alt=\"结束事件\"></p>\n<ol>\n<li><p>空结束事件</p>\n<p>空结束事件意味着到达事件时不会指定抛出的结果。这样，引擎会直接结束当前执行的分支，不会做其他事情。<br>图形标记:空结束事件是一个粗边圆圈，内部没有小图表（无结果类型）<br>XML内容:空结束事件的XML内容是普通结束事件定义，不包含子元素（其他结束事件类型都会包含声明类型的子元素）。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">endEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"end\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"my end event\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"8-3-3-任务节点-Task\"><a href=\"#8-3-3-任务节点-Task\" class=\"headerlink\" title=\"8.3.3 任务节点(Task)\"></a>8.3.3 任务节点(Task)</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/task.png\" alt=\"任务节点\"></p>\n<ol>\n<li><p>用户任务节点<br>用户任务用来设置必须由人员完成的工作。当流程执行到用户任务，会创建一个新任务，并把这个新任务加入到分配人或群组的任务列表中。<br>图形标记：用户任务显示成一个普通任务（圆角矩形），左上角有一个小用户图标。<br>XML内容：XML中的用户任务定义如下。id属性是必须的。 name属性是可选的。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theTask\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Important task\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>用户任务也可以设置描述(实际上所有BPMN 2.0元素都可以设置描述)。 添加documentation元素可以定义描述。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theTask\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Schedule meeting\"</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">documentation</span>&gt;</span></div><div class=\"line\">    Schedule an engineering meeting for next week with the new hire.  </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">documentation</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>在实际应用中，用户接到任务后可以参照任务描述来办理任务，描述文本可以通过标准的java方法来获得：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">task.getDescription()</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p><strong>私人任务</strong><br>    私有任务即有直接分配给指定用户的任务。只有一个用户可以成为任务的执行者。 在activiti中，用户叫做执行者。 拥有执行者的用户任务（即私有任务）对其他用户是不可见的。只能出现执行者的个人任务列表中.<br>    直接把用户任务分配给指定用户使用assignee属性，XML代码如下：<br>    <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theTask\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"my task\"</span> <span class=\"attr\">activiti:assignee</span>=<span class=\"string\">\"username\"</span>/&gt;</span></div></pre></td></tr></table></figure></p>\n<pre><code>Assignee属性对应的值为一个用户的ID。\n直接分配给用户的任务可以通过TaskService像下面这样办理：\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">    List&lt;Task&gt;tasks =taskService.createTaskQuery().taskAssignee(<span class=\"string\">\"sirius\"</span>).list();</div><div class=\"line\">Task task = tasks.get(<span class=\"number\">0</span>);<span class=\"comment\">// 假设任务集合的第一条是要办理的任务</span></div><div class=\"line\">taskService.complete(task.getId());</div></pre></td></tr></table></figure>\n</code></pre><p> <strong>公有任务</strong><br>    有的用户任务在指派时无法确定具体的办理者，这时任务也可以加入到    人员的候选任务列表中，然后让这些人员选择性认领和办理任务。</p>\n<pre><code>公有任务的分配可以分为指定候选用户和候选组两种。\n\n-  把任务添加到一批用户的候选任务列表中，使用candidateUsers    属    性，XML内容如下:\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTaskid=\"theTask\"name=\"my</span> <span class=\"attr\">task</span>\"<span class=\"attr\">activiti:candidateUsers</span>=<span class=\"string\">\"sirius,kermit\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n\ncandidateUsers属性内为用户的ID，多个用户ID之间使用（半角）逗号间隔。\n\n - 把任务添加到一个或多个候选组下，这时任务对组下的所有用户可见，首先得保证每个组下面有用户，通过IdentityService对象创建用户和组，然后把用户添加到对应的组下。然后配置组任务，使用candidateGroups属性，XML内容如下：\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theTask\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"my task\"</span> <span class=\"attr\">activiti:candidateGroups</span>=<span class=\"string\">\"testGroup，developGroup\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n\n间接分配给用户的任务，可以通过TaskService像下面这样操作：\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">List&lt;Task&gt;tasks =taskService.createTaskQuery()</div><div class=\"line\">.taskCandidateUser(<span class=\"string\">\"sirius\"</span>).list();</div><div class=\"line\">Task task = tasks.get(<span class=\"number\">0</span>);<span class=\"comment\">// 假设任务集合的第一条是要办理的任务</span></div><div class=\"line\">String taskId = task.getId();</div><div class=\"line\">taskService.claim(taskId ,“sirius”); <span class=\"comment\">//认领任务，让用户成为任务的执行者</span></div><div class=\"line\">taskService.complete(taskId );</div></pre></td></tr></table></figure>\n\n说明：\n\n 1. 要维护用户和组得使用用户管理服务对象，使用        processEngine    得到IdentityService。\n 2. 要分配组任务必须先创建组，而且组下得有用户，用户和组的    最关键属性是ID。\n 3. 使用newUser（userId）和newGroup（groupId）创建用户和组。\n 4. 使用createMembership（userId，groupId）把用户挂到组下。\n 5. 办理候选任务，首先得认领任务，让用户成为任务的执行者\n\n如果上面的方式还不够灵活，那么我们也可以自定义一个任务分配处理器，通过代码的方式来动态设置任务的属性。XML代码如下：\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"task1\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"My task\"</span>&gt;</span> </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">extensionElements</span>&gt;</span>    </div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">activiti:taskListener</span> <span class=\"attr\">event</span>=<span class=\"string\">\"create\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.MyAssignmentHandler\"</span>/&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">extensionElements</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">userTask</span>&gt;</span></div></pre></td></tr></table></figure>\n\nDelegateTask会传递给TaskListener的实现，通过它可以设置执行人，候选人和候选组：\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">Public <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyAssignmentHandler</span> <span class=\"keyword\">implements</span> <span class=\"title\">TaskListener</span> </span>&#123;</div><div class=\"line\">  </div><div class=\"line\">    <span class=\"function\">Public <span class=\"keyword\">void</span> <span class=\"title\">notify</span><span class=\"params\">(DelegateTask delegateTask)</span></span>&#123; </div><div class=\"line\">\t<span class=\"comment\">// 执行用户搜索相关代码    </span></div><div class=\"line\">\t...</div><div class=\"line\">\t<span class=\"comment\">// 然后把获取到的用户通过下面方法，设置给当前触发事件的任务</span></div><div class=\"line\">    \tdelegateTask.setAssignee(<span class=\"string\">\"sirius\"</span>);</div><div class=\"line\">    \t<span class=\"comment\">//delegateTask.addCandidateUser(\"kermit\");</span></div><div class=\"line\">   \t<span class=\"comment\">//delegateTask.addCandidateGroup(\"testGroup\"); </span></div><div class=\"line\">   \t...  </div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</code></pre><ol>\n<li><p>接收任务节点（receiveTask）</p>\n<p>接收任务是一个简单任务，它会等待对应消息的到达。当前，官方只实现了这个任务的java语义。 当流程达到接收任务，流程状态会保存到数据库中。在任务创建后，意味着流程会进入等待状态，直到引擎接收了一个特定的消息，这会触发流程穿过接收任务继续执行。</p>\n<p>图形标记：接收任务显示为一个任务（圆角矩形），右上角有一个消息小标记。 消息是白色的（黑色图标表示发送语义）。</p>\n<p>XML内容：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">receiveTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"waitState\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"wait\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>当前任务（一般指机器自动完成，但需要耗费一定时间的工作）完成后，向后推移流程，可以调用runtimeService.signal(executionId)，传递接收任务上流程的id。\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">ProcessInstance pi = runtimeService.startProcessInstanceByKey(<span class=\"string\">\"receiveTask\"</span>);</div><div class=\"line\">Execution execution = runtimeService.createExecutionQuery()</div><div class=\"line\">                        .processInstanceId(pi.getId())</div><div class=\"line\">                        .activityId(<span class=\"string\">\"waitState\"</span>)</div><div class=\"line\">                        .singleResult();</div><div class=\"line\">runtimeService.signal(execution.getId());</div></pre></td></tr></table></figure>\n</code></pre><hr>\n<p>述两个虽然都可以统称为任务节点，但是还是有本质区别：</p>\n<ol>\n<li>receiveTask主要代表机器自动执行的，userTask代表人工干预的。</li>\n<li>eiveTask任务产生后会在act_ru_execution表中新增一条记录，    而userTask产生后会在act_ru_execution和act_ru_task（主要记录任    务的发布时间，办理人等信息）中各产生一条记录。</li>\n<li>receiveTask任务提交方式使用RuntimeService的signal方法提交，    userTask任务提交方式使用TaskService的complete方法提交。</li>\n</ol>\n<h3 id=\"8-3-4-网关（gateWay）\"><a href=\"#8-3-4-网关（gateWay）\" class=\"headerlink\" title=\"8.3.4 网关（gateWay）\"></a>8.3.4 网关（gateWay）</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/gateWay.png\" alt=\"网关\"></p>\n<ol>\n<li><p>排他网关<br>排他网关（也叫异或（XOR）网关，或更技术性的叫法基于数据的排他网关），用来在流程中实现决策。</p>\n<p><strong>图形标记</strong>:排他网关显示成一个普通网关（比如，菱形图形）,内部是一个“X”图标,表示异或（XOR）语义。注意，没有内部图标的网关，默认为排他网关。BPMN2.0规范不允许在同一个流程定义中同时使用没有X和有X的菱形图形。</p>\n<p><strong>XML内容</strong>:排他网关的XML内容是很直接的：用一行定义了网关,条件表达式定义在外出顺序流中。参考条件顺序流 获得这些表达式的可用配置。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/xor.png\" alt=\"排他网关\"></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">exclusiveGatewayid=\"exclusiveGw\"name=\"Exclusive</span> <span class=\"attr\">Gateway</span>\"/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">id</span>=<span class=\"string\">\"flow2\"</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"exclusiveGw\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"theTask1\"</span>&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">conditionExpressionxsi:type=\"tFormalExpression\"</span>&gt;</span>$&#123;input == 1&#125;<span class=\"tag\">&lt;/<span class=\"name\">conditionExpression</span>&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">sequenceFlow</span>&gt;</span>\t</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">id</span>=<span class=\"string\">\"flow3\"</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"exclusiveGw\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"theTask2\"</span>&gt;</span>   </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">conditionExpressionxsi:type=\"tFormalExpression\"</span>&gt;</span>$&#123;input == 2&#125;<span class=\"tag\">&lt;/<span class=\"name\">conditionExpression</span>&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">sequenceFlow</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">id</span>=<span class=\"string\">\"flow4\"</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"exclusiveGw\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"theTask3\"</span>&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">conditionExpressionxsi:type=\"tFormalExpression\"</span>&gt;</span>$&#123;input == 3&#125;<span class=\"tag\">&lt;/<span class=\"name\">conditionExpression</span>&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">sequenceFlow</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>说明：\n1.一个排他网关对应一个以上的顺序流\n2.由排他网关流出的顺序流都有个conditionExpression元素，在内部维护返回boolean类型的决策结果。\n3.决策网关只会返回一条结果。当流程执行到排他网关时，流程引擎会自动检索网关出口，从上到下检索如果发现第一条决策结果为true或者没有设置条件的(默认为成立)，则流出。\n4.如果没有任何一个出口符合条件则抛出异常。\n</code></pre><ol>\n<li><p>并行网关</p>\n<p>网关也可以表示流程中的并行情况。最简单的并行网关是parallelGateWay，它允许将流程分成多条分支，也可以把多条分支汇聚到一起。</p>\n<p><strong>图形标记</strong>：并行网关显示成一个普通网关（菱形）内部是一个“加号”图标，表示“与（AND）”语义。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/parallelGateWay.png\" alt=\"并行网关\"></p>\n<p><strong>XML内容</strong>：定义并行网关只需要一行</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parallelGateway</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myParallelGateway\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>实际发生的行为（分支，聚合，同时分支聚合），要根据并行网关的顺序流来决定。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">startEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theStart\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">id</span>=<span class=\"string\">\"flow1\"</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"theStart\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"fork\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parallelGateway</span> <span class=\"attr\">id</span>=<span class=\"string\">\"fork\"</span>/&gt;</span> </div><div class=\"line\"> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"fork\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"receivePayment\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"fork\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"shipOrder\"</span>/&gt;</span></div><div class=\"line\">    </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTaskid=\"receivePayment\"name=\"Receive</span> <span class=\"attr\">Payment</span>\"/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"receivePayment\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"join\"</span>/&gt;</span></div><div class=\"line\">   </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTaskid=\"shipOrder\"name=\"Ship</span> <span class=\"attr\">Order</span>\"/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"shipOrder\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"join\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parallelGateway</span> <span class=\"attr\">id</span>=<span class=\"string\">\"join\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"join\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"archiveOrder\"</span>/&gt;</span></div><div class=\"line\"> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"archiveOrder\"</span><span class=\"attr\">name</span>=<span class=\"string\">\"Archive Order\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"archiveOrder\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"theEnd\"</span>/&gt;</span></div><div class=\"line\">         </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">endEventid=\"theEnd\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>上面例子中，流程启动之后，会创建两个任务：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">ProcessInstancepi =runtimeService.startProcessInstanceByKey(<span class=\"string\">\"forkJoin\"</span>);</div><div class=\"line\"></div><div class=\"line\">List&lt;Task&gt; tasks = taskService.createTaskQuery().list();</div><div class=\"line\">Task task1 =tasks.get(<span class=\"number\">0</span>);</div><div class=\"line\">System.out.println(<span class=\"string\">\"Receive Payment\"</span>+task1.getName());</div><div class=\"line\">Task task2 =tasks.get(<span class=\"number\">1</span>);</div><div class=\"line\">System.out.println(<span class=\"string\">\"Ship Order\"</span>+task2.getName());</div></pre></td></tr></table></figure>\n<p>当两个任务都完成时，第二个并行网关会汇聚两个分支，因为它只有一条外出连线，不会创建并行分支，只会创建归档订单任务。</p>\n<p>说明：<br>1.并行网关的功能是基于进入和外出的顺序流的：</p>\n<pre><code>分支(fork)：并行后的所有外出顺序流，为每个顺序流都创建一个并发分支。\n汇聚(join)：所有到达并行网关，在此等待的进入分支，直到所有进入顺序流的分支都到达以后， 流程就会通过汇聚网关。\n</code></pre><p>2.并行网关的进入和外出都是使用相同节点标示<br>3.如果同一个并行网关有多个进入和多个外出顺序流，它就同时具有分支和汇聚功能。这时，网关会先汇聚所有进入的顺序流，然后再切分成多个并行分支。<br>4.并行网关不会解析条件。 即使顺序流中定义了条件，也会被忽略。<br>5.并行网关不需要是“平衡的”（比如，对应并行网关的进入和外出节点数目相等）。如图中标示是合法的：<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/binxing.png\" alt=\"并行网关不需要是“平衡的”\"></p>\n</li>\n</ol>\n<h2 id=\"8-4-监听器（Listener）\"><a href=\"#8-4-监听器（Listener）\" class=\"headerlink\" title=\"8.4 监听器（Listener）\"></a>8.4 监听器（Listener）</h2><p>在流程中我们有时会对整个流程或者一个节点的某种状态做出相应的处理。这时就会用到监听器。</p>\n<p>在Activiti中流程的监听主要分为两大类，执行监听器和任务监听器。</p>\n<h3 id=\"8-4-1-执行监听器（ExecutionListener）\"><a href=\"#8-4-1-执行监听器（ExecutionListener）\" class=\"headerlink\" title=\"8.4.1 执行监听器（ExecutionListener）\"></a>8.4.1 执行监听器（ExecutionListener）</h3><p>执行监听器可以执行外部java代码或执行表达式，当流程定义中发生了某个事件。 可以捕获的事件有:</p>\n<ul>\n<li>流程实例的启动和结束。</li>\n<li>选中一条连线。</li>\n<li>节点的开始和结束。</li>\n<li>网关的开始和结束。</li>\n<li>中间事件的开始和结束。</li>\n<li>开始事件结束或结束事件开始。</li>\n</ul>\n<p>现在有这样一个简单流程，只包含开始、结束、接收任务和用户任务4个节点：<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/listenerExample.png\" alt=\"监听器流程示例\"><br>配置监听器,XML代码如下<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">extensionElements</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">activiti:executionListener</span> <span class=\"attr\">event</span>=<span class=\"string\">\"start\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"test.ProcessStartListener\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">activiti:executionListener</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">extensionElements</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>说明：</p>\n<ul>\n<li><p>任务监听器支持以下属性：</p>\n<ul>\n<li>event（必选）：任务监听器会被调用的任务类型<ul>\n<li>start：流程节点创建后触发</li>\n<li>end：当任务完成，并尚未从运行数据中删除时触发</li>\n<li>take：任务完成后，流程流出时触发</li>\n</ul>\n</li>\n<li>class(必选)：代理类，实现org.activiti.engine.delegate.ExecutionListener接口。<br>示例：<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProcessStartListener</span> <span class=\"keyword\">implements</span> <span class=\"title\">ExecutionListener</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">1L</span>;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">notify</span><span class=\"params\">(DelegateExecution execution)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ID:\"</span>+execution.getId()+<span class=\"string\">\", Name:\"</span>+execution.getCurrentActivityName());</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li><p>执行监听器配置可以放在以下三个地方，如图<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/taskListener.png\" alt=\"此处输入图片的描述\"></p>\n<p> a)    监听整个流程的启动和结束状态，配置为process节点的子元素，如①<br> b)    监听一个节点的启动和结束状态，配置为一个节点的子元素，如②和③<br> c)    监听一条连线的执行，配置在sequenceFlow节点的内部，只有task一种事件，如④</p>\n</li>\n</ul>\n<p>启动流程测试代码如下：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//部署流程</span></div><div class=\"line\">    Deployment deployment = repositoryService.createDeployment()</div><div class=\"line\">                .addClasspathResource(<span class=\"string\">\"diagrams/Listener.bpmn\"</span>)</div><div class=\"line\">                .addClasspathResource(<span class=\"string\">\"diagrams/Listener.png\"</span>)</div><div class=\"line\">                .deploy();</div><div class=\"line\">    <span class=\"comment\">//启动</span></div><div class=\"line\">    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(<span class=\"string\">\"ListenerTest\"</span>);</div><div class=\"line\">    <span class=\"comment\">//推动</span></div><div class=\"line\">    String processInstanceId = processInstance.getId();</div><div class=\"line\">    runtimeService.signal(processInstanceId);</div><div class=\"line\">    </div><div class=\"line\">    String id = taskService.createTaskQuery().processInstanceId(processInstanceId).singleResult().getId();</div><div class=\"line\">    taskService.complete(id);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>测试结果如下：</p>\n<pre><code>ID:60005, Name:开始\nID:60005, Name:接收任务\nID:60005, Name:用户任务\n</code></pre><h3 id=\"8-4-2-任务监听器（TaskListener）\"><a href=\"#8-4-2-任务监听器（TaskListener）\" class=\"headerlink\" title=\"8.4.2 任务监听器（TaskListener）\"></a>8.4.2 任务监听器（TaskListener）</h3><p>任务监听器可以在发生对应的任务相关事件时执行自定义java逻辑 或表达式。<br>任务监听器只能添加到流程定义中的用户任务中。在之前任务节点上添加任务监听:<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/taskListener2.png\" alt=\"此处输入图片的描述\"></p>\n<p>任务监听器支持以下属性</p>\n<ul>\n<li>event（必选）：任务监听器会被调用的任务类型。 可能的类型为：<ul>\n<li>create：任务创建并设置所有属性后触发。</li>\n<li>assignment：任务分配给一些人时触发。当流程到达userTask，assignment事件 会在create事件之前发生。这样的顺序似乎不自然，但是原因很简单：当获得create时间时， 我们想获得任务的所有属性，包括执行人。</li>\n<li>complete：当任务完成，并尚未从运行数据中删除时触发。</li>\n</ul>\n</li>\n<li>class：必须调用的代理类。 这个类必须实现org.activiti.engine.delegate.TaskListener    接口。</li>\n</ul>\n<hr>\n<p>新添加的任务监听包裹在executionListener监听的内部，顺序为：execution Start–&gt; task Assignment–&gt;task Create–&gt;task Complete–&gt;execution End–&gt;execution take。</p>\n<h1 id=\"9-Spring集成\"><a href=\"#9-Spring集成\" class=\"headerlink\" title=\"9 Spring集成\"></a>9 Spring集成</h1><p>虽然前面的例子中我们可以自己手动来创建相应的API实例，但是在一个项目中这些API都应该以<strong>单例形式</strong>存在的。和Spring的集成主要就是把Activiti的主要对象交给Spring容器管理。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 流程引擎 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.spring.ProcessEngineFactoryBean\"</span>&gt;</span> </div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"processEngineConfiguration\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"processEngineConfiguration\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">&lt;!-- 流程引擎配置对象 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"processEngineConfiguration\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.spring.SpringProcessEngineConfiguration\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"transactionManager\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"transactionManager\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- activiti表数据更新策略 false true（默认） create-drop--&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"databaseSchemaUpdate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- activiti历史数据保存策略 none activity audit(默认) full--&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"history\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"audit\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 管理线程计时器和异步消息,默认开启，但有ManagementService替代，避免冲突所以关闭 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jobExecutorActivate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"false\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 加载资源文件 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"deploymentResources\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"classpath:/activiti-process/*.bpmn\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">&lt;!-- 核心业务类 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"repositoryService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getRepositoryService\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"runtimeService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getRuntimeService\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"taskService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getTaskService\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"historyService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getHistoryService\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"managementService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getManagementService\"</span> /&gt;</span></div></pre></td></tr></table></figure>\n<p><strong>注意：</strong></p>\n<ol>\n<li>ProcessEngineConfiguration<br>单独使用和整合Spring时不是同一个class<br>独立使用：org.activiti.engine.ProcessEngineConfiguration<br>整合Spring：org.activiti.spring.SpringProcessEngineConfiguration</li>\n<li>项目部署后会自动在数据库中创建相关流程定义</li>\n</ol>"},{"title":"DCloud 离线打包之Android Studio","date":"2017-08-08T08:35:55.000Z","_content":"\nDCloud 官方文档对于一个没有接触过Android开发的人来说相当的坑爹，以下是根据本人开发过程整理的Android Studio离线打包完整记录，对每一个步骤讲解非常详细，没有接触过AS也没有任何影响。\n<!--more-->\n\n## 1. 预备环境\n\n 1. AndroidStudio开发环境,要求安装Android4.0或以上（API 14）SDK。安装方法自行百度。\n 2. 下载HBuilder离线打包Android版SDK（[5+ SDK下载][1]）。\n\n## 2. 5+ SDK目录说明\n\n - **HBuilder-Hello**：离线打包演示应用；\n - **HBuilder-Integrate**: 5+ SDK 集成和插件开发示例；\n - **libs**：SDK库文件目录；\n - **Feature列表.xls**：Android平台各扩展Feature API对应的permission；\n\n## 3. 搭建AS工程结构\n\n### 3.1 打开AS，创建一个空项目。\n![新建工程][2]\n![不添加Activity][3]\n\n### 3.2 导入5+ SDK中的示例工程\n![导入Module][4]<br/>\n![选择5+ SDK示例工程][5]\n下面是AS工程的结构\n![目录结构][6]\n\n### 3.3 将示例工程的main目录替换到app目录下的main\n![替换目录][7]\n\n删除导入的module，即HBuilder-Hello。\n删除步骤：\n\n 1. 点击AS左上角  File → Project Structure\n 2. 弹出框中左下角选中要删除的Module,然后点击弹出框左上角的“-”删除，随后点击右下角OK键\n 3. 在工程中选中要删除的Module,点击键盘Delete\n\n## 4. 文件配置\n\n**根据Feature-Android.xml添加项目包依赖**\n\n### 4.1 删除多余文件\n\n 1. 删除app/src/main/assets 下的所有图片\n 2. 清空app/src/mami/res    下所有目录，不要删除目录\n 3. 清空app/src/main/jniLibs下所有目录，不要删除目录\n 4. 删除app/src/main/java   下的目录，保留RInformation\n 5. 删除app/src/main/iflytek 目录，若使用讯飞语音可保留\n 6. 编辑apps.HelloH5.www目录为apps.XXX.www,XXX为自己的项目名,固定写法。删除www下所有文件。\n\n\n### 4.2 添加基础jar包\n\n从Android-SDK@1.9.9.30983_20170414\\Android-SDK\\SDK\\libs下拷贝jar包到工程libs包下。\n\n - **android-support-v4.jar**(运行环境包含了这个包，若运行时报错则将这个包删除)\n - **json_simple-1.1.jar** 没有找到，但好像已经包含在其他几个包中\n - **nineoldandroids-2.4.0.jar** 在SDK中的名字叫my-nineoldandroids-2.4.0.jar\n - **pdr.jar**\n - **my-imageloader.jar**\n - **ui.jar**\n - **nativeui.jar**\n\n在在Modules Dependencies中加入这些包，操作方法：选中包，点击鼠标右键。\n\n![此处输入图片的描述][8]\n\n### 4.3 修改AndroidManifest.xml\n\n删除现有文件中的**application**节点和所有的**uses-permission** \n根据**Feature-Android.xml**文档添加相应的activity和uses-permission,并修改文件头部的package为自己的包名,versionCode和versionName自定义修改。\n\n### 4.4 添加资源文件\n\n严格对照**Feature-Android.xml**添加相关资源文件\n\n### 4.5 将HBuilder中开发的项目全部复制到apps.XXX.www目录下\n\n## 5. 参数修改\n\n有4个文件需要注意：\n\n - apps.XXX.www包下：manifest.json文件                 ***MJ***\n - src/main包下：AndroidManifest.xml文件               ***AM***\n - src/main/assets/data包下：dcloud_control.xml文件    ***DC***\n - src/main/res/values包下：String.xml文件             ***STR***\n\n**项目名**\n\n ***MJ*** id = apps.XXX.www中的XXX = ***DC*** appid\n \n**版本名称**\n\n***MJ*** version.name = ***AM*** android:versionName = ***DC*** appver\n\n**版本Code**\n\n***MJ*** version.code = ***AM*** android:versionCode\n\n**APP对外显示名称**\n\n***MJ*** name = ***STR*** app_name\n\n**基座号码**\n\n***DC*** version = 下载的5+ SDK目录上的一长串数字编号，如*1.9.9.30983*\n\n## 6. APP图标和启动背景\n\n**图标**\n\nAndroidManifest.xml文件的application节点下的***android:icon=\"@drawable/icon\"***设置了图标的名字为icon，可自行更改。将切好的图放置到src/main/res包下对应的drawable目录即可。\n\n**背景图**\n\n默认名为splash.png，切好图放置到对应的drawable目录中即可。\n\n## 7. 签名文件 ##\nAndroid Studio生成\n\n 1. 打开Android Studio的build目录，进入Generate Signed APK子菜单!\n ![sdf][9]\n 2. 点击新建，进入创建页，按提示填写!\n ![新建签名文件][10]\n\n ![输入说明][11]\n 3. 填写完成自动返回上一菜单并自动填充相关参数\n 4. 点击next即可生成\n\n## 8. 查看签名文件SHA-1、MD5 ##\n\n 1. 打开cmd,进入签名文件目录\n 2. 在控制台输入命令\n    debug.keystore：命令为：keytool -list -v -keystore debug.keystore\n    自定义的 keystore：命令为：keytool -list -v -keystore apk的keystore\n    自定义的 jks：命令为：keytool -list -v -keystore apk的jks\n    ![keystore命令][12]\n \n\n\n  [1]: http://ask.dcloud.net.cn/article/103\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_StartNewProject.png\n  [3]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_NoActivity.png\n  [4]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_importModule.png\n  [5]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_selectExample.png\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_catalog.png\n  [7]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_replace.png\n  [8]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_dependencies.png\n  [9]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step1.png\n  [10]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step2.png\n  [11]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step3.png\n  [12]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/keytool.png\n","source":"_posts/DCloud-离线打包之Android-Studio.md","raw":"---\ntitle: DCloud 离线打包之Android Studio\ncategories:\n  - DCloud\ntags:\n  - MUI\n  - Android Studio\n  - 离线打包\ndate: 2017-08-08 16:35:55\n---\n\nDCloud 官方文档对于一个没有接触过Android开发的人来说相当的坑爹，以下是根据本人开发过程整理的Android Studio离线打包完整记录，对每一个步骤讲解非常详细，没有接触过AS也没有任何影响。\n<!--more-->\n\n## 1. 预备环境\n\n 1. AndroidStudio开发环境,要求安装Android4.0或以上（API 14）SDK。安装方法自行百度。\n 2. 下载HBuilder离线打包Android版SDK（[5+ SDK下载][1]）。\n\n## 2. 5+ SDK目录说明\n\n - **HBuilder-Hello**：离线打包演示应用；\n - **HBuilder-Integrate**: 5+ SDK 集成和插件开发示例；\n - **libs**：SDK库文件目录；\n - **Feature列表.xls**：Android平台各扩展Feature API对应的permission；\n\n## 3. 搭建AS工程结构\n\n### 3.1 打开AS，创建一个空项目。\n![新建工程][2]\n![不添加Activity][3]\n\n### 3.2 导入5+ SDK中的示例工程\n![导入Module][4]<br/>\n![选择5+ SDK示例工程][5]\n下面是AS工程的结构\n![目录结构][6]\n\n### 3.3 将示例工程的main目录替换到app目录下的main\n![替换目录][7]\n\n删除导入的module，即HBuilder-Hello。\n删除步骤：\n\n 1. 点击AS左上角  File → Project Structure\n 2. 弹出框中左下角选中要删除的Module,然后点击弹出框左上角的“-”删除，随后点击右下角OK键\n 3. 在工程中选中要删除的Module,点击键盘Delete\n\n## 4. 文件配置\n\n**根据Feature-Android.xml添加项目包依赖**\n\n### 4.1 删除多余文件\n\n 1. 删除app/src/main/assets 下的所有图片\n 2. 清空app/src/mami/res    下所有目录，不要删除目录\n 3. 清空app/src/main/jniLibs下所有目录，不要删除目录\n 4. 删除app/src/main/java   下的目录，保留RInformation\n 5. 删除app/src/main/iflytek 目录，若使用讯飞语音可保留\n 6. 编辑apps.HelloH5.www目录为apps.XXX.www,XXX为自己的项目名,固定写法。删除www下所有文件。\n\n\n### 4.2 添加基础jar包\n\n从Android-SDK@1.9.9.30983_20170414\\Android-SDK\\SDK\\libs下拷贝jar包到工程libs包下。\n\n - **android-support-v4.jar**(运行环境包含了这个包，若运行时报错则将这个包删除)\n - **json_simple-1.1.jar** 没有找到，但好像已经包含在其他几个包中\n - **nineoldandroids-2.4.0.jar** 在SDK中的名字叫my-nineoldandroids-2.4.0.jar\n - **pdr.jar**\n - **my-imageloader.jar**\n - **ui.jar**\n - **nativeui.jar**\n\n在在Modules Dependencies中加入这些包，操作方法：选中包，点击鼠标右键。\n\n![此处输入图片的描述][8]\n\n### 4.3 修改AndroidManifest.xml\n\n删除现有文件中的**application**节点和所有的**uses-permission** \n根据**Feature-Android.xml**文档添加相应的activity和uses-permission,并修改文件头部的package为自己的包名,versionCode和versionName自定义修改。\n\n### 4.4 添加资源文件\n\n严格对照**Feature-Android.xml**添加相关资源文件\n\n### 4.5 将HBuilder中开发的项目全部复制到apps.XXX.www目录下\n\n## 5. 参数修改\n\n有4个文件需要注意：\n\n - apps.XXX.www包下：manifest.json文件                 ***MJ***\n - src/main包下：AndroidManifest.xml文件               ***AM***\n - src/main/assets/data包下：dcloud_control.xml文件    ***DC***\n - src/main/res/values包下：String.xml文件             ***STR***\n\n**项目名**\n\n ***MJ*** id = apps.XXX.www中的XXX = ***DC*** appid\n \n**版本名称**\n\n***MJ*** version.name = ***AM*** android:versionName = ***DC*** appver\n\n**版本Code**\n\n***MJ*** version.code = ***AM*** android:versionCode\n\n**APP对外显示名称**\n\n***MJ*** name = ***STR*** app_name\n\n**基座号码**\n\n***DC*** version = 下载的5+ SDK目录上的一长串数字编号，如*1.9.9.30983*\n\n## 6. APP图标和启动背景\n\n**图标**\n\nAndroidManifest.xml文件的application节点下的***android:icon=\"@drawable/icon\"***设置了图标的名字为icon，可自行更改。将切好的图放置到src/main/res包下对应的drawable目录即可。\n\n**背景图**\n\n默认名为splash.png，切好图放置到对应的drawable目录中即可。\n\n## 7. 签名文件 ##\nAndroid Studio生成\n\n 1. 打开Android Studio的build目录，进入Generate Signed APK子菜单!\n ![sdf][9]\n 2. 点击新建，进入创建页，按提示填写!\n ![新建签名文件][10]\n\n ![输入说明][11]\n 3. 填写完成自动返回上一菜单并自动填充相关参数\n 4. 点击next即可生成\n\n## 8. 查看签名文件SHA-1、MD5 ##\n\n 1. 打开cmd,进入签名文件目录\n 2. 在控制台输入命令\n    debug.keystore：命令为：keytool -list -v -keystore debug.keystore\n    自定义的 keystore：命令为：keytool -list -v -keystore apk的keystore\n    自定义的 jks：命令为：keytool -list -v -keystore apk的jks\n    ![keystore命令][12]\n \n\n\n  [1]: http://ask.dcloud.net.cn/article/103\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_StartNewProject.png\n  [3]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_NoActivity.png\n  [4]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_importModule.png\n  [5]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_selectExample.png\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_catalog.png\n  [7]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_replace.png\n  [8]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_dependencies.png\n  [9]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step1.png\n  [10]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step2.png\n  [11]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step3.png\n  [12]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/keytool.png\n","slug":"DCloud-离线打包之Android-Studio","published":1,"updated":"2018-02-27T07:38:38.084Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspdp0002n8vfll6quvho","content":"<p>DCloud 官方文档对于一个没有接触过Android开发的人来说相当的坑爹，以下是根据本人开发过程整理的Android Studio离线打包完整记录，对每一个步骤讲解非常详细，没有接触过AS也没有任何影响。<br><a id=\"more\"></a></p>\n<h2 id=\"1-预备环境\"><a href=\"#1-预备环境\" class=\"headerlink\" title=\"1. 预备环境\"></a>1. 预备环境</h2><ol>\n<li>AndroidStudio开发环境,要求安装Android4.0或以上（API 14）SDK。安装方法自行百度。</li>\n<li>下载HBuilder离线打包Android版SDK（<a href=\"http://ask.dcloud.net.cn/article/103\" target=\"_blank\" rel=\"noopener\">5+ SDK下载</a>）。</li>\n</ol>\n<h2 id=\"2-5-SDK目录说明\"><a href=\"#2-5-SDK目录说明\" class=\"headerlink\" title=\"2. 5+ SDK目录说明\"></a>2. 5+ SDK目录说明</h2><ul>\n<li><strong>HBuilder-Hello</strong>：离线打包演示应用；</li>\n<li><strong>HBuilder-Integrate</strong>: 5+ SDK 集成和插件开发示例；</li>\n<li><strong>libs</strong>：SDK库文件目录；</li>\n<li><strong>Feature列表.xls</strong>：Android平台各扩展Feature API对应的permission；</li>\n</ul>\n<h2 id=\"3-搭建AS工程结构\"><a href=\"#3-搭建AS工程结构\" class=\"headerlink\" title=\"3. 搭建AS工程结构\"></a>3. 搭建AS工程结构</h2><h3 id=\"3-1-打开AS，创建一个空项目。\"><a href=\"#3-1-打开AS，创建一个空项目。\" class=\"headerlink\" title=\"3.1 打开AS，创建一个空项目。\"></a>3.1 打开AS，创建一个空项目。</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_StartNewProject.png\" alt=\"新建工程\"><br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_NoActivity.png\" alt=\"不添加Activity\"></p>\n<h3 id=\"3-2-导入5-SDK中的示例工程\"><a href=\"#3-2-导入5-SDK中的示例工程\" class=\"headerlink\" title=\"3.2 导入5+ SDK中的示例工程\"></a>3.2 导入5+ SDK中的示例工程</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_importModule.png\" alt=\"导入Module\"><br><br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_selectExample.png\" alt=\"选择5+ SDK示例工程\"><br>下面是AS工程的结构<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_catalog.png\" alt=\"目录结构\"></p>\n<h3 id=\"3-3-将示例工程的main目录替换到app目录下的main\"><a href=\"#3-3-将示例工程的main目录替换到app目录下的main\" class=\"headerlink\" title=\"3.3 将示例工程的main目录替换到app目录下的main\"></a>3.3 将示例工程的main目录替换到app目录下的main</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_replace.png\" alt=\"替换目录\"></p>\n<p>删除导入的module，即HBuilder-Hello。<br>删除步骤：</p>\n<ol>\n<li>点击AS左上角  File → Project Structure</li>\n<li>弹出框中左下角选中要删除的Module,然后点击弹出框左上角的“-”删除，随后点击右下角OK键</li>\n<li>在工程中选中要删除的Module,点击键盘Delete</li>\n</ol>\n<h2 id=\"4-文件配置\"><a href=\"#4-文件配置\" class=\"headerlink\" title=\"4. 文件配置\"></a>4. 文件配置</h2><p><strong>根据Feature-Android.xml添加项目包依赖</strong></p>\n<h3 id=\"4-1-删除多余文件\"><a href=\"#4-1-删除多余文件\" class=\"headerlink\" title=\"4.1 删除多余文件\"></a>4.1 删除多余文件</h3><ol>\n<li>删除app/src/main/assets 下的所有图片</li>\n<li>清空app/src/mami/res    下所有目录，不要删除目录</li>\n<li>清空app/src/main/jniLibs下所有目录，不要删除目录</li>\n<li>删除app/src/main/java   下的目录，保留RInformation</li>\n<li>删除app/src/main/iflytek 目录，若使用讯飞语音可保留</li>\n<li>编辑apps.HelloH5.www目录为apps.XXX.www,XXX为自己的项目名,固定写法。删除www下所有文件。</li>\n</ol>\n<h3 id=\"4-2-添加基础jar包\"><a href=\"#4-2-添加基础jar包\" class=\"headerlink\" title=\"4.2 添加基础jar包\"></a>4.2 添加基础jar包</h3><p>从Android-SDK@1.9.9.30983_20170414\\Android-SDK\\SDK\\libs下拷贝jar包到工程libs包下。</p>\n<ul>\n<li><strong>android-support-v4.jar</strong>(运行环境包含了这个包，若运行时报错则将这个包删除)</li>\n<li><strong>json_simple-1.1.jar</strong> 没有找到，但好像已经包含在其他几个包中</li>\n<li><strong>nineoldandroids-2.4.0.jar</strong> 在SDK中的名字叫my-nineoldandroids-2.4.0.jar</li>\n<li><strong>pdr.jar</strong></li>\n<li><strong>my-imageloader.jar</strong></li>\n<li><strong>ui.jar</strong></li>\n<li><strong>nativeui.jar</strong></li>\n</ul>\n<p>在在Modules Dependencies中加入这些包，操作方法：选中包，点击鼠标右键。</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_dependencies.png\" alt=\"此处输入图片的描述\"></p>\n<h3 id=\"4-3-修改AndroidManifest-xml\"><a href=\"#4-3-修改AndroidManifest-xml\" class=\"headerlink\" title=\"4.3 修改AndroidManifest.xml\"></a>4.3 修改AndroidManifest.xml</h3><p>删除现有文件中的<strong>application</strong>节点和所有的<strong>uses-permission</strong><br>根据<strong>Feature-Android.xml</strong>文档添加相应的activity和uses-permission,并修改文件头部的package为自己的包名,versionCode和versionName自定义修改。</p>\n<h3 id=\"4-4-添加资源文件\"><a href=\"#4-4-添加资源文件\" class=\"headerlink\" title=\"4.4 添加资源文件\"></a>4.4 添加资源文件</h3><p>严格对照<strong>Feature-Android.xml</strong>添加相关资源文件</p>\n<h3 id=\"4-5-将HBuilder中开发的项目全部复制到apps-XXX-www目录下\"><a href=\"#4-5-将HBuilder中开发的项目全部复制到apps-XXX-www目录下\" class=\"headerlink\" title=\"4.5 将HBuilder中开发的项目全部复制到apps.XXX.www目录下\"></a>4.5 将HBuilder中开发的项目全部复制到apps.XXX.www目录下</h3><h2 id=\"5-参数修改\"><a href=\"#5-参数修改\" class=\"headerlink\" title=\"5. 参数修改\"></a>5. 参数修改</h2><p>有4个文件需要注意：</p>\n<ul>\n<li>apps.XXX.www包下：manifest.json文件                 <strong><em>MJ</em></strong></li>\n<li>src/main包下：AndroidManifest.xml文件               <strong><em>AM</em></strong></li>\n<li>src/main/assets/data包下：dcloud_control.xml文件    <strong><em>DC</em></strong></li>\n<li>src/main/res/values包下：String.xml文件             <strong><em>STR</em></strong></li>\n</ul>\n<p><strong>项目名</strong></p>\n<p> <strong><em>MJ</em></strong> id = apps.XXX.www中的XXX = <strong><em>DC</em></strong> appid</p>\n<p><strong>版本名称</strong></p>\n<p><strong><em>MJ</em></strong> version.name = <strong><em>AM</em></strong> android:versionName = <strong><em>DC</em></strong> appver</p>\n<p><strong>版本Code</strong></p>\n<p><strong><em>MJ</em></strong> version.code = <strong><em>AM</em></strong> android:versionCode</p>\n<p><strong>APP对外显示名称</strong></p>\n<p><strong><em>MJ</em></strong> name = <strong><em>STR</em></strong> app_name</p>\n<p><strong>基座号码</strong></p>\n<p><strong><em>DC</em></strong> version = 下载的5+ SDK目录上的一长串数字编号，如<em>1.9.9.30983</em></p>\n<h2 id=\"6-APP图标和启动背景\"><a href=\"#6-APP图标和启动背景\" class=\"headerlink\" title=\"6. APP图标和启动背景\"></a>6. APP图标和启动背景</h2><p><strong>图标</strong></p>\n<p>AndroidManifest.xml文件的application节点下的<strong><em>android:icon=”@drawable/icon”</em></strong>设置了图标的名字为icon，可自行更改。将切好的图放置到src/main/res包下对应的drawable目录即可。</p>\n<p><strong>背景图</strong></p>\n<p>默认名为splash.png，切好图放置到对应的drawable目录中即可。</p>\n<h2 id=\"7-签名文件\"><a href=\"#7-签名文件\" class=\"headerlink\" title=\"7. 签名文件\"></a>7. 签名文件</h2><p>Android Studio生成</p>\n<ol>\n<li>打开Android Studio的build目录，进入Generate Signed APK子菜单!<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step1.png\" alt=\"sdf\"></li>\n<li><p>点击新建，进入创建页，按提示填写!<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step2.png\" alt=\"新建签名文件\"></p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step3.png\" alt=\"输入说明\"></p>\n</li>\n<li>填写完成自动返回上一菜单并自动填充相关参数</li>\n<li>点击next即可生成</li>\n</ol>\n<h2 id=\"8-查看签名文件SHA-1、MD5\"><a href=\"#8-查看签名文件SHA-1、MD5\" class=\"headerlink\" title=\"8. 查看签名文件SHA-1、MD5\"></a>8. 查看签名文件SHA-1、MD5</h2><ol>\n<li>打开cmd,进入签名文件目录</li>\n<li>在控制台输入命令<br>debug.keystore：命令为：keytool -list -v -keystore debug.keystore<br>自定义的 keystore：命令为：keytool -list -v -keystore apk的keystore<br>自定义的 jks：命令为：keytool -list -v -keystore apk的jks<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/keytool.png\" alt=\"keystore命令\"></li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>DCloud 官方文档对于一个没有接触过Android开发的人来说相当的坑爹，以下是根据本人开发过程整理的Android Studio离线打包完整记录，对每一个步骤讲解非常详细，没有接触过AS也没有任何影响。<br>","more":"</p>\n<h2 id=\"1-预备环境\"><a href=\"#1-预备环境\" class=\"headerlink\" title=\"1. 预备环境\"></a>1. 预备环境</h2><ol>\n<li>AndroidStudio开发环境,要求安装Android4.0或以上（API 14）SDK。安装方法自行百度。</li>\n<li>下载HBuilder离线打包Android版SDK（<a href=\"http://ask.dcloud.net.cn/article/103\" target=\"_blank\" rel=\"noopener\">5+ SDK下载</a>）。</li>\n</ol>\n<h2 id=\"2-5-SDK目录说明\"><a href=\"#2-5-SDK目录说明\" class=\"headerlink\" title=\"2. 5+ SDK目录说明\"></a>2. 5+ SDK目录说明</h2><ul>\n<li><strong>HBuilder-Hello</strong>：离线打包演示应用；</li>\n<li><strong>HBuilder-Integrate</strong>: 5+ SDK 集成和插件开发示例；</li>\n<li><strong>libs</strong>：SDK库文件目录；</li>\n<li><strong>Feature列表.xls</strong>：Android平台各扩展Feature API对应的permission；</li>\n</ul>\n<h2 id=\"3-搭建AS工程结构\"><a href=\"#3-搭建AS工程结构\" class=\"headerlink\" title=\"3. 搭建AS工程结构\"></a>3. 搭建AS工程结构</h2><h3 id=\"3-1-打开AS，创建一个空项目。\"><a href=\"#3-1-打开AS，创建一个空项目。\" class=\"headerlink\" title=\"3.1 打开AS，创建一个空项目。\"></a>3.1 打开AS，创建一个空项目。</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_StartNewProject.png\" alt=\"新建工程\"><br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_NoActivity.png\" alt=\"不添加Activity\"></p>\n<h3 id=\"3-2-导入5-SDK中的示例工程\"><a href=\"#3-2-导入5-SDK中的示例工程\" class=\"headerlink\" title=\"3.2 导入5+ SDK中的示例工程\"></a>3.2 导入5+ SDK中的示例工程</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_importModule.png\" alt=\"导入Module\"><br><br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_selectExample.png\" alt=\"选择5+ SDK示例工程\"><br>下面是AS工程的结构<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_catalog.png\" alt=\"目录结构\"></p>\n<h3 id=\"3-3-将示例工程的main目录替换到app目录下的main\"><a href=\"#3-3-将示例工程的main目录替换到app目录下的main\" class=\"headerlink\" title=\"3.3 将示例工程的main目录替换到app目录下的main\"></a>3.3 将示例工程的main目录替换到app目录下的main</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_replace.png\" alt=\"替换目录\"></p>\n<p>删除导入的module，即HBuilder-Hello。<br>删除步骤：</p>\n<ol>\n<li>点击AS左上角  File → Project Structure</li>\n<li>弹出框中左下角选中要删除的Module,然后点击弹出框左上角的“-”删除，随后点击右下角OK键</li>\n<li>在工程中选中要删除的Module,点击键盘Delete</li>\n</ol>\n<h2 id=\"4-文件配置\"><a href=\"#4-文件配置\" class=\"headerlink\" title=\"4. 文件配置\"></a>4. 文件配置</h2><p><strong>根据Feature-Android.xml添加项目包依赖</strong></p>\n<h3 id=\"4-1-删除多余文件\"><a href=\"#4-1-删除多余文件\" class=\"headerlink\" title=\"4.1 删除多余文件\"></a>4.1 删除多余文件</h3><ol>\n<li>删除app/src/main/assets 下的所有图片</li>\n<li>清空app/src/mami/res    下所有目录，不要删除目录</li>\n<li>清空app/src/main/jniLibs下所有目录，不要删除目录</li>\n<li>删除app/src/main/java   下的目录，保留RInformation</li>\n<li>删除app/src/main/iflytek 目录，若使用讯飞语音可保留</li>\n<li>编辑apps.HelloH5.www目录为apps.XXX.www,XXX为自己的项目名,固定写法。删除www下所有文件。</li>\n</ol>\n<h3 id=\"4-2-添加基础jar包\"><a href=\"#4-2-添加基础jar包\" class=\"headerlink\" title=\"4.2 添加基础jar包\"></a>4.2 添加基础jar包</h3><p>从Android-SDK@1.9.9.30983_20170414\\Android-SDK\\SDK\\libs下拷贝jar包到工程libs包下。</p>\n<ul>\n<li><strong>android-support-v4.jar</strong>(运行环境包含了这个包，若运行时报错则将这个包删除)</li>\n<li><strong>json_simple-1.1.jar</strong> 没有找到，但好像已经包含在其他几个包中</li>\n<li><strong>nineoldandroids-2.4.0.jar</strong> 在SDK中的名字叫my-nineoldandroids-2.4.0.jar</li>\n<li><strong>pdr.jar</strong></li>\n<li><strong>my-imageloader.jar</strong></li>\n<li><strong>ui.jar</strong></li>\n<li><strong>nativeui.jar</strong></li>\n</ul>\n<p>在在Modules Dependencies中加入这些包，操作方法：选中包，点击鼠标右键。</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_dependencies.png\" alt=\"此处输入图片的描述\"></p>\n<h3 id=\"4-3-修改AndroidManifest-xml\"><a href=\"#4-3-修改AndroidManifest-xml\" class=\"headerlink\" title=\"4.3 修改AndroidManifest.xml\"></a>4.3 修改AndroidManifest.xml</h3><p>删除现有文件中的<strong>application</strong>节点和所有的<strong>uses-permission</strong><br>根据<strong>Feature-Android.xml</strong>文档添加相应的activity和uses-permission,并修改文件头部的package为自己的包名,versionCode和versionName自定义修改。</p>\n<h3 id=\"4-4-添加资源文件\"><a href=\"#4-4-添加资源文件\" class=\"headerlink\" title=\"4.4 添加资源文件\"></a>4.4 添加资源文件</h3><p>严格对照<strong>Feature-Android.xml</strong>添加相关资源文件</p>\n<h3 id=\"4-5-将HBuilder中开发的项目全部复制到apps-XXX-www目录下\"><a href=\"#4-5-将HBuilder中开发的项目全部复制到apps-XXX-www目录下\" class=\"headerlink\" title=\"4.5 将HBuilder中开发的项目全部复制到apps.XXX.www目录下\"></a>4.5 将HBuilder中开发的项目全部复制到apps.XXX.www目录下</h3><h2 id=\"5-参数修改\"><a href=\"#5-参数修改\" class=\"headerlink\" title=\"5. 参数修改\"></a>5. 参数修改</h2><p>有4个文件需要注意：</p>\n<ul>\n<li>apps.XXX.www包下：manifest.json文件                 <strong><em>MJ</em></strong></li>\n<li>src/main包下：AndroidManifest.xml文件               <strong><em>AM</em></strong></li>\n<li>src/main/assets/data包下：dcloud_control.xml文件    <strong><em>DC</em></strong></li>\n<li>src/main/res/values包下：String.xml文件             <strong><em>STR</em></strong></li>\n</ul>\n<p><strong>项目名</strong></p>\n<p> <strong><em>MJ</em></strong> id = apps.XXX.www中的XXX = <strong><em>DC</em></strong> appid</p>\n<p><strong>版本名称</strong></p>\n<p><strong><em>MJ</em></strong> version.name = <strong><em>AM</em></strong> android:versionName = <strong><em>DC</em></strong> appver</p>\n<p><strong>版本Code</strong></p>\n<p><strong><em>MJ</em></strong> version.code = <strong><em>AM</em></strong> android:versionCode</p>\n<p><strong>APP对外显示名称</strong></p>\n<p><strong><em>MJ</em></strong> name = <strong><em>STR</em></strong> app_name</p>\n<p><strong>基座号码</strong></p>\n<p><strong><em>DC</em></strong> version = 下载的5+ SDK目录上的一长串数字编号，如<em>1.9.9.30983</em></p>\n<h2 id=\"6-APP图标和启动背景\"><a href=\"#6-APP图标和启动背景\" class=\"headerlink\" title=\"6. APP图标和启动背景\"></a>6. APP图标和启动背景</h2><p><strong>图标</strong></p>\n<p>AndroidManifest.xml文件的application节点下的<strong><em>android:icon=”@drawable/icon”</em></strong>设置了图标的名字为icon，可自行更改。将切好的图放置到src/main/res包下对应的drawable目录即可。</p>\n<p><strong>背景图</strong></p>\n<p>默认名为splash.png，切好图放置到对应的drawable目录中即可。</p>\n<h2 id=\"7-签名文件\"><a href=\"#7-签名文件\" class=\"headerlink\" title=\"7. 签名文件\"></a>7. 签名文件</h2><p>Android Studio生成</p>\n<ol>\n<li>打开Android Studio的build目录，进入Generate Signed APK子菜单!<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step1.png\" alt=\"sdf\"></li>\n<li><p>点击新建，进入创建页，按提示填写!<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step2.png\" alt=\"新建签名文件\"></p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step3.png\" alt=\"输入说明\"></p>\n</li>\n<li>填写完成自动返回上一菜单并自动填充相关参数</li>\n<li>点击next即可生成</li>\n</ol>\n<h2 id=\"8-查看签名文件SHA-1、MD5\"><a href=\"#8-查看签名文件SHA-1、MD5\" class=\"headerlink\" title=\"8. 查看签名文件SHA-1、MD5\"></a>8. 查看签名文件SHA-1、MD5</h2><ol>\n<li>打开cmd,进入签名文件目录</li>\n<li>在控制台输入命令<br>debug.keystore：命令为：keytool -list -v -keystore debug.keystore<br>自定义的 keystore：命令为：keytool -list -v -keystore apk的keystore<br>自定义的 jks：命令为：keytool -list -v -keystore apk的jks<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/keytool.png\" alt=\"keystore命令\"></li>\n</ol>"},{"title":"Callable及Future","date":"2017-10-12T03:13:54.000Z","_content":"## 1. 概述\n在线程池中执行任务，使用execute()方法，执行的是Runnable任务，它不返回任何值。如果希望任务完成后返回结果，那么需要使用Callable接口，这也是本文要研究的主题。\n\n<!--more-->\n\n```java\npublic class CallableTest {\n\tpublic static void main(String[] args) {\n\t\tCallable<Integer> callable = new Callable<Integer>() {\n\t\t\t@Override\n\t\t\tpublic Integer call() throws Exception {\n\t\t\t\tSystem.out.println(\"callable线程执行\");\n\t\t\t\treturn new Random().nextInt(100);\n\t\t\t}\n\t\t};\n\n\t\tExecutorService executorService = Executors.newSingleThreadExecutor();\n\t\tFuture<Integer> future = executorService.submit(callable);\n\n\t\ttry {\n\t\t\t// 限定时间获取结果\n\t\t\tSystem.out.println(future.get(5, TimeUnit.SECONDS));\n\t\t} catch (TimeoutException e) {\n\t\t\t// 超时触发线程中止\n\t\t\te.printStackTrace();\n\t\t} catch (InterruptedException e) {\n\t\t\te.printStackTrace();\n\t\t} catch (ExecutionException e) {\n\t\t\t// 抛出执行异常\n\t\t\te.printStackTrace();\n\t\t} finally {\n\t\t\t// 如果任务还在运行，执行中断\n\t\t\tboolean mayInterruptIfRunning = true;\n\t\t\tfuture.cancel(mayInterruptIfRunning);\n\t\t}\n\t}\n}\n```\n\n上面是callable和future的简单应用，执行时要求在限定时间内获取结果，超时执行会抛出TimeoutException，执行异常会抛出ExecutionException。最后在finally里，如果任务还在执行，就进行取消；如果任务已经执行完，取消操作也没有影响。\n\n## 2. Callable接口\n\n我们先回顾一下java.lang.Runnable接口，就声明了run(),其返回值为void，当然就无法获取结果了。\n```java\npublic interface Runnable {  \n    public abstract void run();  \n} \n```\n而callable的接口定义如下：\n```java\npublic interface Callable<V> {   \n      V   call()   throws Exception;   \n} \n```\ncallable接口声明call()方法，有返回值，也可抛出异常，对该接口我们先了解这么多就行，下面我们来说明如何使用。\n\n无论是Runnable接口的实现类还是Callable接口的实现类，都可以被ThreadPoolExecutor或ScheduledThreadPoolExecutor执行，ThreadPoolExecutor或ScheduledThreadPoolExecutor都实现了ExcutorService接口，而因此Callable需要和Executor框架中的ExcutorService结合使用，我们先看看ExecutorService提供的方法：\n```java\n<T> Future<T> submit(Callable<T> task);  \nFuture<?> submit(Runnable task);  \n<T> Future<T> submit(Runnable task, T result);  \n```\n\n - 第一个方法：submit提交一个实现Callable接口的任务，并且返回封装了异步计算结果的Future。\n - 第二个方法：submit提交一个实现Runnable接口的任务，并且返回封装了异步计算结果的Future。\n - 第三个方法：submit提交一个实现Runnable接口的任务，并且指定了在调用Future的get方法时返回的result对象。这个用的很少，因为是自己给定的返回结果，意义不大。\n\n因此我们只要创建好我们的线程对象（实现Callable接口或者Runnable接口），然后通过上面3个方法提交给线程池去执行即可。\n还有点要注意的是，除了我们自己实现Callable对象外，我们还可以使用工厂类Executors来把一个Runnable对象包装成Callable对象。Executors工厂类提供的方法如下：\n```java\npublic static Callable<Object> callable(Runnable task)  \npublic static <T> Callable<T> callable(Runnable task, T result)  \n```\n \n## 3. Future接口\nFuture<V>接口是用来获取异步计算结果的，说白了就是对具体的Runnable或者Callable对象任务执行的结果进行获取(get()),取消(cancel()),判断是否完成等操作。我们看看Future接口的源码：\n```java\npublic interface Future<V> {  \n    boolean cancel(boolean mayInterruptIfRunning);  \n    boolean isCancelled();  \n    boolean isDone();  \n    V get() throws InterruptedException, ExecutionException;  \n    V get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException;  \n}  \n```\n\n方法解析：\n\n - get(): 获取异步执行的结果，如果没有结果可用，此方法会阻塞直到异步计算完成。\n - get(long timeout, TimeUnit unit):获取异步执行结果，如果没有结果可用，此方法会阻塞，但是会有时间限制，如果阻塞时间超过设定的timeout时间，该方法将抛出异常。\n - isDone():如果任务执行结束，无论是正常结束或是中途取消还是发生异常，都返回true。\n - isCancelled():如果任务完成前被取消，则返回true。\n - cancel():\n    - 如果任务还没开始，执行cancel(...)方法将返回false\n    - 如果任务已经启动，执行cancel(true)方法将以中断执行此任务线程的方式来试图停止任务，如果停止成功，返回true；当任务已经启动，执行cancel(false)方法将不会对正在执行的任务线程产生影响(让线程正常执行到完成)，此时返回false\n    - 当任务已经完成，执行cancel(...)方法将返回false\n\n通过方法分析我们也知道实际上Future提供了3种功能：\n 1. 能够中断执行中的任务\n 2. 判断任务是否执行完成\n 3. 获取任务执行完成后额结果。\n\n但是我们必须明白Future只是一个接口，我们无法直接创建对象，因此就需要其实现类FutureTask登场啦\n     \n## 4. FutureTask\n            \n-------------------------![此处输入图片的描述][1]--------------------------\nFutureTask除了实现了Future接口外还实现了Runnable接口，因此FutureTask也可以直接提交给Executor执行。 当然也可以调用线程直接执行（FutureTask.run()）.\n\n\n### 4.1 FutureTask的状态\n```java\nprivate volatile int state;\nprivate static final int NEW          = 0;\nprivate static final int COMPLETING   = 1;\nprivate static final int NORMAL       = 2;\nprivate static final int EXCEPTIONAL  = 3;\nprivate static final int CANCELLED    = 4;\nprivate static final int INTERRUPTING = 5;\nprivate static final int INTERRUPTED  = 6;\n```\n\nFutureTask有7种状态，初始状态从NEW开始，状态转换路径可以归纳为图2所示。在后文的代码，会使用int的大小比较判断状态处于哪个范围，需要留意上面状态的排列顺序\n![FutureTask的状态][2]\nFutureTask的状态路径，取决于run和cancel的调用顺序，在后文分析时，对号入座这几条路径。\n\n 1. NEW -> COMPLETING -> NORMAL 正常的流程\n 2. NEW -> COMPLETING -> EXCEPTIONAL 异常的流程\n 3. NEW -> CANCELLED 被取消流程\n 4. NEW -> INTERRUPTING -> INTERRUPTED 被中断流程\n\n### 4.2 FutureTask的变量\n```java\nprivate volatile int state;\n/** The underlying callable; nulled out after running */\nprivate Callable<V> callable;\n/** The result to return or exception to throw from get() */\nprivate Object outcome; // non-volatile, protected by state reads/writes\n/** The thread running the callable; CASed during run() */\nprivate volatile Thread runner;\n/** Treiber stack of waiting threads */\nprivate volatile WaitNode waiters;\n```\nstate、runner、waiters三个变量没有使用原子类，而是使用Unsafe对象进行原子操作。代码中会见到很多形如compareAndSwap的方法，入门原理可以看[认识非阻塞的同步机制CAS][3]。\n\ncallable是要执行的任务，runner是执行任务的线程，outcome是返回的结果（正常结果或Exception结果）\n\n```java\nstatic final class WaitNode {\n    volatile Thread thread;\n    volatile WaitNode next;\n    WaitNode() { thread = Thread.currentThread(); }\n}\n```\n\nwaiters的数据结构是WaitNode，保存了Thread和下个WaitNode的引用。waiters保存了等待结果的线程，每次操作只会增减头，所以是一个栈结构，详细见后文对get方法的分析。\n\n### 4.3 FutureTask的创建\n下面是FutureTask的两种创建方式：\n```java\npublic FutureTask(Callable<V> callable) {\n    if (callable == null)\n        throw new NullPointerException();\n    this.callable = callable;\n    this.state = NEW;       // ensure visibility of callable\n}\n\npublic FutureTask(Runnable runnable, V result) {\n    this.callable = Executors.callable(runnable, result);\n    this.state = NEW;       // ensure visibility of callable\n} \n```\n\n提交FutureTask到线程池的submit定义在AbstractExecutorService，根据入参的不同，有三个submit方法。下面以提交Callable为例：\n\n```java\npublic <T> Future<T> submit(Callable<T> task) {\n   if (task == null) throw new NullPointerException();\n   RunnableFuture<T> ftask = newTaskFor(task);\n   execute(ftask);\n   return ftask;\n}\n\nprotected <T> RunnableFuture<T> newTaskFor(Callable<T> callable) {    \n   return new FutureTask<T>(callable);\n}\n```\n\nFutureTask在newTaskFor创建，然后调用线程池的execute执行，最后返回Future。获取Future后，就可以调用get获取结果，或者调用cancel取消任务。\n\n### 4.4 FutureTask的运行\n\nFutureTask实现了Runnable，在线程池里执行时调用的方法是run。\n\n```java\npublic void run() {\n    //1\n    if (state != NEW ||\n        !UNSAFE.compareAndSwapObject(this, runnerOffset,null, Thread.currentThread()))\n        return;\n    //2\n    try {\n        Callable<V> c = callable;\n        if (c != null && state == NEW) {\n            V result;\n            boolean ran;\n            try {\n                result = c.call();\n                ran = true;\n            } catch (Throwable ex) {\n                result = null;\n                ran = false;\n                setException(ex);\n            }\n            if (ran)\n                set(result);\n        }\n    } finally {\n       //3\n        runner = null;\n        int s = state;\n        if (s >= INTERRUPTING)\n            handlePossibleCancellationInterrupt(s);\n    }\n}\n```\n标记1处检查FutureTask的状态，如果不是处于NEW，说明状态已经进入四条路径之一，也就没有必要继续了。如果状态是NEW，则将执行任务的线程交给runner。\n\n标记2处开始正式执行任务，调用call方法获取结果，没有异常就算成功，最后执行set方法；出现异常就调用setException方法。\n\n标记3处，无论任务执行是否成功，都需要将runner重新置为空。\n\n```java\nprotected void set(V v) {\n    if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) {\n        outcome = v;\n        UNSAFE.putOrderedInt(this, stateOffset, NORMAL); // final state\n        finishCompletion();\n    }\n}\n\nprotected void setException(Throwable t) {\n    if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) {\n        outcome = t;\n        UNSAFE.putOrderedInt(this, stateOffset, EXCEPTIONAL); // final state\n        finishCompletion();\n    }\n}\n```\n\n任务执行成功与失败，分别对应NEW -> COMPLETING -> NORMAL和NEW -> COMPLETING -> EXCEPTIONAL两条路径。这里先将状态修改为中间状态，再对结果赋值，最后再修改为最终状态。\n\n```java\nprivate void finishCompletion() {\n    // assert state > COMPLETING;\n    for (WaitNode q; (q = waiters) != null;) {\n        if (UNSAFE.compareAndSwapObject(this, waitersOffset, q, null)) {\n            for (;;) {\n                Thread t = q.thread;\n                if (t != null) {\n                    q.thread = null;\n                    LockSupport.unpark(t);\n                }\n                WaitNode next = q.next;\n                if (next == null)\n                    break;\n                q.next = null; // unlink to help gc\n                q = next;\n            }\n            break;\n        }\n    }\n    done();\n    callable = null;        // to reduce footprint\n}\n```\n\n最后调用finishCompletion执行任务完成，唤醒并删除所有在waiters中等待的线程。done方法是空的，供子类实现，最后callable也设置为空。\n\nFutureTask还有个runAndReset，逻辑和run类似，但没有调用set方法来设置结果，执行完成后将任务重新初始化。\n\n```java\nprotected boolean runAndReset() {\n    if (state != NEW ||\n        !UNSAFE.compareAndSwapObject(this, runnerOffset,\n                                     null, Thread.currentThread()))\n        return false;\n    boolean ran = false;\n    int s = state;\n    try {\n        Callable<V> c = callable;\n        if (c != null && s == NEW) {\n            try {\n                c.call(); // don't set result\n                ran = true;\n            } catch (Throwable ex) {\n                setException(ex);\n            }\n        }\n    } finally {\n        // runner must be non-null until state is settled to\n        // prevent concurrent calls to run()\n        runner = null;\n        // state must be re-read after nulling runner to prevent\n        // leaked interrupts\n        s = state;\n        if (s >= INTERRUPTING)\n            handlePossibleCancellationInterrupt(s);\n    }\n    return ran && s == NEW;\n}\n```\n\n\n### 4.5 FutureTask的取消\n\n对于已经提交执行的任务，可以调用cancel执行取消。\n\n```java\npublic boolean cancel(boolean mayInterruptIfRunning) {\n   //1\n    if (!(state == NEW &&\n          UNSAFE.compareAndSwapInt(this, stateOffset, NEW,\n              mayInterruptIfRunning ? INTERRUPTING : CANCELLED)))\n        return false;\n    try {    // in case call to interrupt throws exception\n       //2\n        if (mayInterruptIfRunning) {\n            try {\n                Thread t = runner;\n                if (t != null)\n                    t.interrupt();\n            } finally { // final state\n                UNSAFE.putOrderedInt(this, stateOffset, INTERRUPTED);\n            }\n        }\n    } finally {\n        finishCompletion();\n    }\n    return true;\n}\n```\n\n标记1处判断任务状态，为NEW才能被取消。如果mayInterruptIfRunning是true，代表任务需要被中断，走NEW -> INTERRUPTING -> INTERRUPTED流程。否则代表任务被取消，走NEW -> CANCELLED流程。\n\n标记2处理任务被中断的情况，这里仅仅是对线程发出中断请求，不确保任务能检测并处理中断，详细原理去看Java的中断机制。\n\n最后调用finishCompletion完成收尾工作。\n\n```java\npublic boolean isCancelled() {\n    return state >= CANCELLED;\n}\n```\n判断任务是否被取消，具体逻辑是判断state >= CANCELLED，包括了被中断一共两条路径的结果。\n\n### 4.5 FutureTask获取结果\n调用FutureTask的get方法获取任务的执行结果，可以阻塞直到获取结果，也可以限制范围时间内获取结果，否则抛出TimeoutException。\n```java\npublic V get() throws InterruptedException, ExecutionException {\n    int s = state;\n    if (s <= COMPLETING)\n        s = awaitDone(false, 0L);\n    return report(s);\n}\n\npublic V get(long timeout, TimeUnit unit)\n    throws InterruptedException, ExecutionException, TimeoutException {\n    if (unit == null)\n        throw new NullPointerException();\n    int s = state;\n    if (s <= COMPLETING &&\n        (s = awaitDone(true, unit.toNanos(timeout))) <= COMPLETING)\n        throw new TimeoutException();\n    return report(s);\n}\n```\nget的核心实现调用了awaitDone，入参为是否开启时间限制和最大的等待时间。\n\n```java\nprivate int awaitDone(boolean timed, long nanos)\n    throws InterruptedException {\n    final long deadline = timed ? System.nanoTime() + nanos : 0L;\n    WaitNode q = null;\n    boolean queued = false;\n    for (;;) {\n        if (Thread.interrupted()) {\n            removeWaiter(q);\n            throw new InterruptedException();\n        }\n\n        int s = state;\n        if (s > COMPLETING) {    //1\n            if (q != null)\n                q.thread = null;\n            return s;\n        }\n        else if (s == COMPLETING) // cannot time out yet    //2\n            Thread.yield();\n        else if (q == null)     //3\n            q = new WaitNode();\n        else if (!queued)    //4\n            queued = UNSAFE.compareAndSwapObject(this, waitersOffset,\n                                                 q.next = waiters, q);\n        else if (timed) {    //5\n            nanos = deadline - System.nanoTime();\n            if (nanos <= 0L) {\n                removeWaiter(q);\n                return state;\n            }\n            LockSupport.parkNanos(this, nanos);\n        }\n        else     //6\n            LockSupport.park(this);\n    }\n}\n```\nawaitDone主要逻辑是一个无限循环，首先判断线程是否被中断，是的话移除waiter并抛出中断异常。接下来是一串if-else，一共六种情况。\n\n 1. 判断任务状态是否已经完成，是就直接返回；\n 2. 任务状态是COMPLETING，代表在set结果时被阻塞了，这里先让出资源；\n 3. 如果WaitNode为空，就为当前线程初始化一个WaitNode；\n 4. 如果当前的WaitNode还没有加入waiters，就加入；\n 5. 如果是限定时间执行，判断有无超时，超时就将waiter移出，并返回结果，否则阻塞一定时间；\n 6. 如果没有限定时间，就一直阻塞到下次被唤醒。\n \nLockSupport是用来创建锁和其他同步类的基本线程阻塞原语。park和unpark的作用分别是阻塞线程和解除阻塞线程。\n\n```java\nprivate V report(int s) throws ExecutionException {\n   Object x = outcome;\n   if (s == NORMAL)\n       return (V)x;\n   if (s >= CANCELLED)\n       throw new CancellationException();\n   throw new ExecutionException((Throwable)x);\n}\n```\n\n最后get调用report，使用outcome返回结果。\n\n![此处输入图片的描述][4]\n\n如果多个线程向同一个FutureTask实例get结果，但FutureTask又没有执行完毕，线程将会阻塞并保存在waiters中。待FutureTask获取结果后，唤醒waiters等待的线程，并返回同一个结果。\n\n\n  [1]: http://upload-images.jianshu.io/upload_images/3294095-237f514c17eb5e4a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\n  [2]: http://upload-images.jianshu.io/upload_images/3294095-66574ae94d956415.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\n  [3]: http://www.jianshu.com/p/e2179c74a2e4\n  [4]: http://upload-images.jianshu.io/upload_images/3294095-123399195bd337cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240","source":"_posts/Callable及Future.md","raw":"---\ntitle: Callable及Future\ncategories:\n  - JavaSE\ntags:\n  - Java\n  - 多线程\ndate: 2017-10-12 11:13:54\n---\n## 1. 概述\n在线程池中执行任务，使用execute()方法，执行的是Runnable任务，它不返回任何值。如果希望任务完成后返回结果，那么需要使用Callable接口，这也是本文要研究的主题。\n\n<!--more-->\n\n```java\npublic class CallableTest {\n\tpublic static void main(String[] args) {\n\t\tCallable<Integer> callable = new Callable<Integer>() {\n\t\t\t@Override\n\t\t\tpublic Integer call() throws Exception {\n\t\t\t\tSystem.out.println(\"callable线程执行\");\n\t\t\t\treturn new Random().nextInt(100);\n\t\t\t}\n\t\t};\n\n\t\tExecutorService executorService = Executors.newSingleThreadExecutor();\n\t\tFuture<Integer> future = executorService.submit(callable);\n\n\t\ttry {\n\t\t\t// 限定时间获取结果\n\t\t\tSystem.out.println(future.get(5, TimeUnit.SECONDS));\n\t\t} catch (TimeoutException e) {\n\t\t\t// 超时触发线程中止\n\t\t\te.printStackTrace();\n\t\t} catch (InterruptedException e) {\n\t\t\te.printStackTrace();\n\t\t} catch (ExecutionException e) {\n\t\t\t// 抛出执行异常\n\t\t\te.printStackTrace();\n\t\t} finally {\n\t\t\t// 如果任务还在运行，执行中断\n\t\t\tboolean mayInterruptIfRunning = true;\n\t\t\tfuture.cancel(mayInterruptIfRunning);\n\t\t}\n\t}\n}\n```\n\n上面是callable和future的简单应用，执行时要求在限定时间内获取结果，超时执行会抛出TimeoutException，执行异常会抛出ExecutionException。最后在finally里，如果任务还在执行，就进行取消；如果任务已经执行完，取消操作也没有影响。\n\n## 2. Callable接口\n\n我们先回顾一下java.lang.Runnable接口，就声明了run(),其返回值为void，当然就无法获取结果了。\n```java\npublic interface Runnable {  \n    public abstract void run();  \n} \n```\n而callable的接口定义如下：\n```java\npublic interface Callable<V> {   \n      V   call()   throws Exception;   \n} \n```\ncallable接口声明call()方法，有返回值，也可抛出异常，对该接口我们先了解这么多就行，下面我们来说明如何使用。\n\n无论是Runnable接口的实现类还是Callable接口的实现类，都可以被ThreadPoolExecutor或ScheduledThreadPoolExecutor执行，ThreadPoolExecutor或ScheduledThreadPoolExecutor都实现了ExcutorService接口，而因此Callable需要和Executor框架中的ExcutorService结合使用，我们先看看ExecutorService提供的方法：\n```java\n<T> Future<T> submit(Callable<T> task);  \nFuture<?> submit(Runnable task);  \n<T> Future<T> submit(Runnable task, T result);  \n```\n\n - 第一个方法：submit提交一个实现Callable接口的任务，并且返回封装了异步计算结果的Future。\n - 第二个方法：submit提交一个实现Runnable接口的任务，并且返回封装了异步计算结果的Future。\n - 第三个方法：submit提交一个实现Runnable接口的任务，并且指定了在调用Future的get方法时返回的result对象。这个用的很少，因为是自己给定的返回结果，意义不大。\n\n因此我们只要创建好我们的线程对象（实现Callable接口或者Runnable接口），然后通过上面3个方法提交给线程池去执行即可。\n还有点要注意的是，除了我们自己实现Callable对象外，我们还可以使用工厂类Executors来把一个Runnable对象包装成Callable对象。Executors工厂类提供的方法如下：\n```java\npublic static Callable<Object> callable(Runnable task)  \npublic static <T> Callable<T> callable(Runnable task, T result)  \n```\n \n## 3. Future接口\nFuture<V>接口是用来获取异步计算结果的，说白了就是对具体的Runnable或者Callable对象任务执行的结果进行获取(get()),取消(cancel()),判断是否完成等操作。我们看看Future接口的源码：\n```java\npublic interface Future<V> {  \n    boolean cancel(boolean mayInterruptIfRunning);  \n    boolean isCancelled();  \n    boolean isDone();  \n    V get() throws InterruptedException, ExecutionException;  \n    V get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException;  \n}  \n```\n\n方法解析：\n\n - get(): 获取异步执行的结果，如果没有结果可用，此方法会阻塞直到异步计算完成。\n - get(long timeout, TimeUnit unit):获取异步执行结果，如果没有结果可用，此方法会阻塞，但是会有时间限制，如果阻塞时间超过设定的timeout时间，该方法将抛出异常。\n - isDone():如果任务执行结束，无论是正常结束或是中途取消还是发生异常，都返回true。\n - isCancelled():如果任务完成前被取消，则返回true。\n - cancel():\n    - 如果任务还没开始，执行cancel(...)方法将返回false\n    - 如果任务已经启动，执行cancel(true)方法将以中断执行此任务线程的方式来试图停止任务，如果停止成功，返回true；当任务已经启动，执行cancel(false)方法将不会对正在执行的任务线程产生影响(让线程正常执行到完成)，此时返回false\n    - 当任务已经完成，执行cancel(...)方法将返回false\n\n通过方法分析我们也知道实际上Future提供了3种功能：\n 1. 能够中断执行中的任务\n 2. 判断任务是否执行完成\n 3. 获取任务执行完成后额结果。\n\n但是我们必须明白Future只是一个接口，我们无法直接创建对象，因此就需要其实现类FutureTask登场啦\n     \n## 4. FutureTask\n            \n-------------------------![此处输入图片的描述][1]--------------------------\nFutureTask除了实现了Future接口外还实现了Runnable接口，因此FutureTask也可以直接提交给Executor执行。 当然也可以调用线程直接执行（FutureTask.run()）.\n\n\n### 4.1 FutureTask的状态\n```java\nprivate volatile int state;\nprivate static final int NEW          = 0;\nprivate static final int COMPLETING   = 1;\nprivate static final int NORMAL       = 2;\nprivate static final int EXCEPTIONAL  = 3;\nprivate static final int CANCELLED    = 4;\nprivate static final int INTERRUPTING = 5;\nprivate static final int INTERRUPTED  = 6;\n```\n\nFutureTask有7种状态，初始状态从NEW开始，状态转换路径可以归纳为图2所示。在后文的代码，会使用int的大小比较判断状态处于哪个范围，需要留意上面状态的排列顺序\n![FutureTask的状态][2]\nFutureTask的状态路径，取决于run和cancel的调用顺序，在后文分析时，对号入座这几条路径。\n\n 1. NEW -> COMPLETING -> NORMAL 正常的流程\n 2. NEW -> COMPLETING -> EXCEPTIONAL 异常的流程\n 3. NEW -> CANCELLED 被取消流程\n 4. NEW -> INTERRUPTING -> INTERRUPTED 被中断流程\n\n### 4.2 FutureTask的变量\n```java\nprivate volatile int state;\n/** The underlying callable; nulled out after running */\nprivate Callable<V> callable;\n/** The result to return or exception to throw from get() */\nprivate Object outcome; // non-volatile, protected by state reads/writes\n/** The thread running the callable; CASed during run() */\nprivate volatile Thread runner;\n/** Treiber stack of waiting threads */\nprivate volatile WaitNode waiters;\n```\nstate、runner、waiters三个变量没有使用原子类，而是使用Unsafe对象进行原子操作。代码中会见到很多形如compareAndSwap的方法，入门原理可以看[认识非阻塞的同步机制CAS][3]。\n\ncallable是要执行的任务，runner是执行任务的线程，outcome是返回的结果（正常结果或Exception结果）\n\n```java\nstatic final class WaitNode {\n    volatile Thread thread;\n    volatile WaitNode next;\n    WaitNode() { thread = Thread.currentThread(); }\n}\n```\n\nwaiters的数据结构是WaitNode，保存了Thread和下个WaitNode的引用。waiters保存了等待结果的线程，每次操作只会增减头，所以是一个栈结构，详细见后文对get方法的分析。\n\n### 4.3 FutureTask的创建\n下面是FutureTask的两种创建方式：\n```java\npublic FutureTask(Callable<V> callable) {\n    if (callable == null)\n        throw new NullPointerException();\n    this.callable = callable;\n    this.state = NEW;       // ensure visibility of callable\n}\n\npublic FutureTask(Runnable runnable, V result) {\n    this.callable = Executors.callable(runnable, result);\n    this.state = NEW;       // ensure visibility of callable\n} \n```\n\n提交FutureTask到线程池的submit定义在AbstractExecutorService，根据入参的不同，有三个submit方法。下面以提交Callable为例：\n\n```java\npublic <T> Future<T> submit(Callable<T> task) {\n   if (task == null) throw new NullPointerException();\n   RunnableFuture<T> ftask = newTaskFor(task);\n   execute(ftask);\n   return ftask;\n}\n\nprotected <T> RunnableFuture<T> newTaskFor(Callable<T> callable) {    \n   return new FutureTask<T>(callable);\n}\n```\n\nFutureTask在newTaskFor创建，然后调用线程池的execute执行，最后返回Future。获取Future后，就可以调用get获取结果，或者调用cancel取消任务。\n\n### 4.4 FutureTask的运行\n\nFutureTask实现了Runnable，在线程池里执行时调用的方法是run。\n\n```java\npublic void run() {\n    //1\n    if (state != NEW ||\n        !UNSAFE.compareAndSwapObject(this, runnerOffset,null, Thread.currentThread()))\n        return;\n    //2\n    try {\n        Callable<V> c = callable;\n        if (c != null && state == NEW) {\n            V result;\n            boolean ran;\n            try {\n                result = c.call();\n                ran = true;\n            } catch (Throwable ex) {\n                result = null;\n                ran = false;\n                setException(ex);\n            }\n            if (ran)\n                set(result);\n        }\n    } finally {\n       //3\n        runner = null;\n        int s = state;\n        if (s >= INTERRUPTING)\n            handlePossibleCancellationInterrupt(s);\n    }\n}\n```\n标记1处检查FutureTask的状态，如果不是处于NEW，说明状态已经进入四条路径之一，也就没有必要继续了。如果状态是NEW，则将执行任务的线程交给runner。\n\n标记2处开始正式执行任务，调用call方法获取结果，没有异常就算成功，最后执行set方法；出现异常就调用setException方法。\n\n标记3处，无论任务执行是否成功，都需要将runner重新置为空。\n\n```java\nprotected void set(V v) {\n    if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) {\n        outcome = v;\n        UNSAFE.putOrderedInt(this, stateOffset, NORMAL); // final state\n        finishCompletion();\n    }\n}\n\nprotected void setException(Throwable t) {\n    if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) {\n        outcome = t;\n        UNSAFE.putOrderedInt(this, stateOffset, EXCEPTIONAL); // final state\n        finishCompletion();\n    }\n}\n```\n\n任务执行成功与失败，分别对应NEW -> COMPLETING -> NORMAL和NEW -> COMPLETING -> EXCEPTIONAL两条路径。这里先将状态修改为中间状态，再对结果赋值，最后再修改为最终状态。\n\n```java\nprivate void finishCompletion() {\n    // assert state > COMPLETING;\n    for (WaitNode q; (q = waiters) != null;) {\n        if (UNSAFE.compareAndSwapObject(this, waitersOffset, q, null)) {\n            for (;;) {\n                Thread t = q.thread;\n                if (t != null) {\n                    q.thread = null;\n                    LockSupport.unpark(t);\n                }\n                WaitNode next = q.next;\n                if (next == null)\n                    break;\n                q.next = null; // unlink to help gc\n                q = next;\n            }\n            break;\n        }\n    }\n    done();\n    callable = null;        // to reduce footprint\n}\n```\n\n最后调用finishCompletion执行任务完成，唤醒并删除所有在waiters中等待的线程。done方法是空的，供子类实现，最后callable也设置为空。\n\nFutureTask还有个runAndReset，逻辑和run类似，但没有调用set方法来设置结果，执行完成后将任务重新初始化。\n\n```java\nprotected boolean runAndReset() {\n    if (state != NEW ||\n        !UNSAFE.compareAndSwapObject(this, runnerOffset,\n                                     null, Thread.currentThread()))\n        return false;\n    boolean ran = false;\n    int s = state;\n    try {\n        Callable<V> c = callable;\n        if (c != null && s == NEW) {\n            try {\n                c.call(); // don't set result\n                ran = true;\n            } catch (Throwable ex) {\n                setException(ex);\n            }\n        }\n    } finally {\n        // runner must be non-null until state is settled to\n        // prevent concurrent calls to run()\n        runner = null;\n        // state must be re-read after nulling runner to prevent\n        // leaked interrupts\n        s = state;\n        if (s >= INTERRUPTING)\n            handlePossibleCancellationInterrupt(s);\n    }\n    return ran && s == NEW;\n}\n```\n\n\n### 4.5 FutureTask的取消\n\n对于已经提交执行的任务，可以调用cancel执行取消。\n\n```java\npublic boolean cancel(boolean mayInterruptIfRunning) {\n   //1\n    if (!(state == NEW &&\n          UNSAFE.compareAndSwapInt(this, stateOffset, NEW,\n              mayInterruptIfRunning ? INTERRUPTING : CANCELLED)))\n        return false;\n    try {    // in case call to interrupt throws exception\n       //2\n        if (mayInterruptIfRunning) {\n            try {\n                Thread t = runner;\n                if (t != null)\n                    t.interrupt();\n            } finally { // final state\n                UNSAFE.putOrderedInt(this, stateOffset, INTERRUPTED);\n            }\n        }\n    } finally {\n        finishCompletion();\n    }\n    return true;\n}\n```\n\n标记1处判断任务状态，为NEW才能被取消。如果mayInterruptIfRunning是true，代表任务需要被中断，走NEW -> INTERRUPTING -> INTERRUPTED流程。否则代表任务被取消，走NEW -> CANCELLED流程。\n\n标记2处理任务被中断的情况，这里仅仅是对线程发出中断请求，不确保任务能检测并处理中断，详细原理去看Java的中断机制。\n\n最后调用finishCompletion完成收尾工作。\n\n```java\npublic boolean isCancelled() {\n    return state >= CANCELLED;\n}\n```\n判断任务是否被取消，具体逻辑是判断state >= CANCELLED，包括了被中断一共两条路径的结果。\n\n### 4.5 FutureTask获取结果\n调用FutureTask的get方法获取任务的执行结果，可以阻塞直到获取结果，也可以限制范围时间内获取结果，否则抛出TimeoutException。\n```java\npublic V get() throws InterruptedException, ExecutionException {\n    int s = state;\n    if (s <= COMPLETING)\n        s = awaitDone(false, 0L);\n    return report(s);\n}\n\npublic V get(long timeout, TimeUnit unit)\n    throws InterruptedException, ExecutionException, TimeoutException {\n    if (unit == null)\n        throw new NullPointerException();\n    int s = state;\n    if (s <= COMPLETING &&\n        (s = awaitDone(true, unit.toNanos(timeout))) <= COMPLETING)\n        throw new TimeoutException();\n    return report(s);\n}\n```\nget的核心实现调用了awaitDone，入参为是否开启时间限制和最大的等待时间。\n\n```java\nprivate int awaitDone(boolean timed, long nanos)\n    throws InterruptedException {\n    final long deadline = timed ? System.nanoTime() + nanos : 0L;\n    WaitNode q = null;\n    boolean queued = false;\n    for (;;) {\n        if (Thread.interrupted()) {\n            removeWaiter(q);\n            throw new InterruptedException();\n        }\n\n        int s = state;\n        if (s > COMPLETING) {    //1\n            if (q != null)\n                q.thread = null;\n            return s;\n        }\n        else if (s == COMPLETING) // cannot time out yet    //2\n            Thread.yield();\n        else if (q == null)     //3\n            q = new WaitNode();\n        else if (!queued)    //4\n            queued = UNSAFE.compareAndSwapObject(this, waitersOffset,\n                                                 q.next = waiters, q);\n        else if (timed) {    //5\n            nanos = deadline - System.nanoTime();\n            if (nanos <= 0L) {\n                removeWaiter(q);\n                return state;\n            }\n            LockSupport.parkNanos(this, nanos);\n        }\n        else     //6\n            LockSupport.park(this);\n    }\n}\n```\nawaitDone主要逻辑是一个无限循环，首先判断线程是否被中断，是的话移除waiter并抛出中断异常。接下来是一串if-else，一共六种情况。\n\n 1. 判断任务状态是否已经完成，是就直接返回；\n 2. 任务状态是COMPLETING，代表在set结果时被阻塞了，这里先让出资源；\n 3. 如果WaitNode为空，就为当前线程初始化一个WaitNode；\n 4. 如果当前的WaitNode还没有加入waiters，就加入；\n 5. 如果是限定时间执行，判断有无超时，超时就将waiter移出，并返回结果，否则阻塞一定时间；\n 6. 如果没有限定时间，就一直阻塞到下次被唤醒。\n \nLockSupport是用来创建锁和其他同步类的基本线程阻塞原语。park和unpark的作用分别是阻塞线程和解除阻塞线程。\n\n```java\nprivate V report(int s) throws ExecutionException {\n   Object x = outcome;\n   if (s == NORMAL)\n       return (V)x;\n   if (s >= CANCELLED)\n       throw new CancellationException();\n   throw new ExecutionException((Throwable)x);\n}\n```\n\n最后get调用report，使用outcome返回结果。\n\n![此处输入图片的描述][4]\n\n如果多个线程向同一个FutureTask实例get结果，但FutureTask又没有执行完毕，线程将会阻塞并保存在waiters中。待FutureTask获取结果后，唤醒waiters等待的线程，并返回同一个结果。\n\n\n  [1]: http://upload-images.jianshu.io/upload_images/3294095-237f514c17eb5e4a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\n  [2]: http://upload-images.jianshu.io/upload_images/3294095-66574ae94d956415.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\n  [3]: http://www.jianshu.com/p/e2179c74a2e4\n  [4]: http://upload-images.jianshu.io/upload_images/3294095-123399195bd337cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240","slug":"Callable及Future","published":1,"updated":"2018-02-27T07:38:38.083Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspe30006n8vfdnmxue6c","content":"<h2 id=\"1-概述\"><a href=\"#1-概述\" class=\"headerlink\" title=\"1. 概述\"></a>1. 概述</h2><p>在线程池中执行任务，使用execute()方法，执行的是Runnable任务，它不返回任何值。如果希望任务完成后返回结果，那么需要使用Callable接口，这也是本文要研究的主题。</p>\n<a id=\"more\"></a>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CallableTest</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tCallable&lt;Integer&gt; callable = <span class=\"keyword\">new</span> Callable&lt;Integer&gt;() &#123;</div><div class=\"line\">\t\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t\t\tSystem.out.println(<span class=\"string\">\"callable线程执行\"</span>);</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Random().nextInt(<span class=\"number\">100</span>);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;;</div><div class=\"line\"></div><div class=\"line\">\t\tExecutorService executorService = Executors.newSingleThreadExecutor();</div><div class=\"line\">\t\tFuture&lt;Integer&gt; future = executorService.submit(callable);</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">// 限定时间获取结果</span></div><div class=\"line\">\t\t\tSystem.out.println(future.get(<span class=\"number\">5</span>, TimeUnit.SECONDS));</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (TimeoutException e) &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">// 超时触发线程中止</span></div><div class=\"line\">\t\t\te.printStackTrace();</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\te.printStackTrace();</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (ExecutionException e) &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">// 抛出执行异常</span></div><div class=\"line\">\t\t\te.printStackTrace();</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">// 如果任务还在运行，执行中断</span></div><div class=\"line\">\t\t\t<span class=\"keyword\">boolean</span> mayInterruptIfRunning = <span class=\"keyword\">true</span>;</div><div class=\"line\">\t\t\tfuture.cancel(mayInterruptIfRunning);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>上面是callable和future的简单应用，执行时要求在限定时间内获取结果，超时执行会抛出TimeoutException，执行异常会抛出ExecutionException。最后在finally里，如果任务还在执行，就进行取消；如果任务已经执行完，取消操作也没有影响。</p>\n<h2 id=\"2-Callable接口\"><a href=\"#2-Callable接口\" class=\"headerlink\" title=\"2. Callable接口\"></a>2. Callable接口</h2><p>我们先回顾一下java.lang.Runnable接口，就声明了run(),其返回值为void，当然就无法获取结果了。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Runnable</span> </span>&#123;  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>;  </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>而callable的接口定义如下：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Callable</span>&lt;<span class=\"title\">V</span>&gt; </span>&#123;   </div><div class=\"line\">      <span class=\"function\">V   <span class=\"title\">call</span><span class=\"params\">()</span>   <span class=\"keyword\">throws</span> Exception</span>;   </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>callable接口声明call()方法，有返回值，也可抛出异常，对该接口我们先了解这么多就行，下面我们来说明如何使用。</p>\n<p>无论是Runnable接口的实现类还是Callable接口的实现类，都可以被ThreadPoolExecutor或ScheduledThreadPoolExecutor执行，ThreadPoolExecutor或ScheduledThreadPoolExecutor都实现了ExcutorService接口，而因此Callable需要和Executor框架中的ExcutorService结合使用，我们先看看ExecutorService提供的方法：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;T&gt; <span class=\"function\">Future&lt;T&gt; <span class=\"title\">submit</span><span class=\"params\">(Callable&lt;T&gt; task)</span></span>;  </div><div class=\"line\">Future&lt;?&gt; submit(Runnable task);  </div><div class=\"line\">&lt;T&gt; <span class=\"function\">Future&lt;T&gt; <span class=\"title\">submit</span><span class=\"params\">(Runnable task, T result)</span></span>;</div></pre></td></tr></table></figure></p>\n<ul>\n<li>第一个方法：submit提交一个实现Callable接口的任务，并且返回封装了异步计算结果的Future。</li>\n<li>第二个方法：submit提交一个实现Runnable接口的任务，并且返回封装了异步计算结果的Future。</li>\n<li>第三个方法：submit提交一个实现Runnable接口的任务，并且指定了在调用Future的get方法时返回的result对象。这个用的很少，因为是自己给定的返回结果，意义不大。</li>\n</ul>\n<p>因此我们只要创建好我们的线程对象（实现Callable接口或者Runnable接口），然后通过上面3个方法提交给线程池去执行即可。<br>还有点要注意的是，除了我们自己实现Callable对象外，我们还可以使用工厂类Executors来把一个Runnable对象包装成Callable对象。Executors工厂类提供的方法如下：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Callable&lt;Object&gt; <span class=\"title\">callable</span><span class=\"params\">(Runnable task)</span>  </span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> &lt;T&gt; Callable&lt;T&gt; <span class=\"title\">callable</span><span class=\"params\">(Runnable task, T result)</span></div></pre></td></tr></table></figure></p>\n<h2 id=\"3-Future接口\"><a href=\"#3-Future接口\" class=\"headerlink\" title=\"3. Future接口\"></a>3. Future接口</h2><p>Future<v>接口是用来获取异步计算结果的，说白了就是对具体的Runnable或者Callable对象任务执行的结果进行获取(get()),取消(cancel()),判断是否完成等操作。我们看看Future接口的源码：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Future</span>&lt;<span class=\"title\">V</span>&gt; </span>&#123;  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">cancel</span><span class=\"params\">(<span class=\"keyword\">boolean</span> mayInterruptIfRunning)</span></span>;  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">isCancelled</span><span class=\"params\">()</span></span>;  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">isDone</span><span class=\"params\">()</span></span>;  </div><div class=\"line\">    <span class=\"function\">V <span class=\"title\">get</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException</span>;  </div><div class=\"line\">    <span class=\"function\">V <span class=\"title\">get</span><span class=\"params\">(<span class=\"keyword\">long</span> timeout, TimeUnit unit)</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException, TimeoutException</span>;  </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></v></p>\n<p>方法解析：</p>\n<ul>\n<li>get(): 获取异步执行的结果，如果没有结果可用，此方法会阻塞直到异步计算完成。</li>\n<li>get(long timeout, TimeUnit unit):获取异步执行结果，如果没有结果可用，此方法会阻塞，但是会有时间限制，如果阻塞时间超过设定的timeout时间，该方法将抛出异常。</li>\n<li>isDone():如果任务执行结束，无论是正常结束或是中途取消还是发生异常，都返回true。</li>\n<li>isCancelled():如果任务完成前被取消，则返回true。</li>\n<li>cancel():<ul>\n<li>如果任务还没开始，执行cancel(…)方法将返回false</li>\n<li>如果任务已经启动，执行cancel(true)方法将以中断执行此任务线程的方式来试图停止任务，如果停止成功，返回true；当任务已经启动，执行cancel(false)方法将不会对正在执行的任务线程产生影响(让线程正常执行到完成)，此时返回false</li>\n<li>当任务已经完成，执行cancel(…)方法将返回false</li>\n</ul>\n</li>\n</ul>\n<p>通过方法分析我们也知道实际上Future提供了3种功能：</p>\n<ol>\n<li>能够中断执行中的任务</li>\n<li>判断任务是否执行完成</li>\n<li>获取任务执行完成后额结果。</li>\n</ol>\n<p>但是我们必须明白Future只是一个接口，我们无法直接创建对象，因此就需要其实现类FutureTask登场啦</p>\n<h2 id=\"4-FutureTask\"><a href=\"#4-FutureTask\" class=\"headerlink\" title=\"4. FutureTask\"></a>4. FutureTask</h2><p>————————-<img src=\"http://upload-images.jianshu.io/upload_images/3294095-237f514c17eb5e4a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"此处输入图片的描述\">————————–<br>FutureTask除了实现了Future接口外还实现了Runnable接口，因此FutureTask也可以直接提交给Executor执行。 当然也可以调用线程直接执行（FutureTask.run()）.</p>\n<h3 id=\"4-1-FutureTask的状态\"><a href=\"#4-1-FutureTask的状态\" class=\"headerlink\" title=\"4.1 FutureTask的状态\"></a>4.1 FutureTask的状态</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">int</span> state;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> NEW          = <span class=\"number\">0</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> COMPLETING   = <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> NORMAL       = <span class=\"number\">2</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> EXCEPTIONAL  = <span class=\"number\">3</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> CANCELLED    = <span class=\"number\">4</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> INTERRUPTING = <span class=\"number\">5</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> INTERRUPTED  = <span class=\"number\">6</span>;</div></pre></td></tr></table></figure>\n<p>FutureTask有7种状态，初始状态从NEW开始，状态转换路径可以归纳为图2所示。在后文的代码，会使用int的大小比较判断状态处于哪个范围，需要留意上面状态的排列顺序<br><img src=\"http://upload-images.jianshu.io/upload_images/3294095-66574ae94d956415.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"FutureTask的状态\"><br>FutureTask的状态路径，取决于run和cancel的调用顺序，在后文分析时，对号入座这几条路径。</p>\n<ol>\n<li>NEW -&gt; COMPLETING -&gt; NORMAL 正常的流程</li>\n<li>NEW -&gt; COMPLETING -&gt; EXCEPTIONAL 异常的流程</li>\n<li>NEW -&gt; CANCELLED 被取消流程</li>\n<li>NEW -&gt; INTERRUPTING -&gt; INTERRUPTED 被中断流程</li>\n</ol>\n<h3 id=\"4-2-FutureTask的变量\"><a href=\"#4-2-FutureTask的变量\" class=\"headerlink\" title=\"4.2 FutureTask的变量\"></a>4.2 FutureTask的变量</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">int</span> state;</div><div class=\"line\"><span class=\"comment\">/** The underlying callable; nulled out after running */</span></div><div class=\"line\"><span class=\"keyword\">private</span> Callable&lt;V&gt; callable;</div><div class=\"line\"><span class=\"comment\">/** The result to return or exception to throw from get() */</span></div><div class=\"line\"><span class=\"keyword\">private</span> Object outcome; <span class=\"comment\">// non-volatile, protected by state reads/writes</span></div><div class=\"line\"><span class=\"comment\">/** The thread running the callable; CASed during run() */</span></div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> Thread runner;</div><div class=\"line\"><span class=\"comment\">/** Treiber stack of waiting threads */</span></div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> WaitNode waiters;</div></pre></td></tr></table></figure>\n<p>state、runner、waiters三个变量没有使用原子类，而是使用Unsafe对象进行原子操作。代码中会见到很多形如compareAndSwap的方法，入门原理可以看<a href=\"http://www.jianshu.com/p/e2179c74a2e4\" target=\"_blank\" rel=\"noopener\">认识非阻塞的同步机制CAS</a>。</p>\n<p>callable是要执行的任务，runner是执行任务的线程，outcome是返回的结果（正常结果或Exception结果）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WaitNode</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">volatile</span> Thread thread;</div><div class=\"line\">    <span class=\"keyword\">volatile</span> WaitNode next;</div><div class=\"line\">    WaitNode() &#123; thread = Thread.currentThread(); &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>waiters的数据结构是WaitNode，保存了Thread和下个WaitNode的引用。waiters保存了等待结果的线程，每次操作只会增减头，所以是一个栈结构，详细见后文对get方法的分析。</p>\n<h3 id=\"4-3-FutureTask的创建\"><a href=\"#4-3-FutureTask的创建\" class=\"headerlink\" title=\"4.3 FutureTask的创建\"></a>4.3 FutureTask的创建</h3><p>下面是FutureTask的两种创建方式：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">FutureTask</span><span class=\"params\">(Callable&lt;V&gt; callable)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (callable == <span class=\"keyword\">null</span>)</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</div><div class=\"line\">    <span class=\"keyword\">this</span>.callable = callable;</div><div class=\"line\">    <span class=\"keyword\">this</span>.state = NEW;       <span class=\"comment\">// ensure visibility of callable</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">FutureTask</span><span class=\"params\">(Runnable runnable, V result)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.callable = Executors.callable(runnable, result);</div><div class=\"line\">    <span class=\"keyword\">this</span>.state = NEW;       <span class=\"comment\">// ensure visibility of callable</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>提交FutureTask到线程池的submit定义在AbstractExecutorService，根据入参的不同，有三个submit方法。下面以提交Callable为例：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> &lt;T&gt; <span class=\"function\">Future&lt;T&gt; <span class=\"title\">submit</span><span class=\"params\">(Callable&lt;T&gt; task)</span> </span>&#123;</div><div class=\"line\">   <span class=\"keyword\">if</span> (task == <span class=\"keyword\">null</span>) <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</div><div class=\"line\">   RunnableFuture&lt;T&gt; ftask = newTaskFor(task);</div><div class=\"line\">   execute(ftask);</div><div class=\"line\">   <span class=\"keyword\">return</span> ftask;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">protected</span> &lt;T&gt; <span class=\"function\">RunnableFuture&lt;T&gt; <span class=\"title\">newTaskFor</span><span class=\"params\">(Callable&lt;T&gt; callable)</span> </span>&#123;    </div><div class=\"line\">   <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> FutureTask&lt;T&gt;(callable);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>FutureTask在newTaskFor创建，然后调用线程池的execute执行，最后返回Future。获取Future后，就可以调用get获取结果，或者调用cancel取消任务。</p>\n<h3 id=\"4-4-FutureTask的运行\"><a href=\"#4-4-FutureTask的运行\" class=\"headerlink\" title=\"4.4 FutureTask的运行\"></a>4.4 FutureTask的运行</h3><p>FutureTask实现了Runnable，在线程池里执行时调用的方法是run。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//1</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (state != NEW ||</div><div class=\"line\">        !UNSAFE.compareAndSwapObject(<span class=\"keyword\">this</span>, runnerOffset,<span class=\"keyword\">null</span>, Thread.currentThread()))</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">    <span class=\"comment\">//2</span></div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        Callable&lt;V&gt; c = callable;</div><div class=\"line\">        <span class=\"keyword\">if</span> (c != <span class=\"keyword\">null</span> &amp;&amp; state == NEW) &#123;</div><div class=\"line\">            V result;</div><div class=\"line\">            <span class=\"keyword\">boolean</span> ran;</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                result = c.call();</div><div class=\"line\">                ran = <span class=\"keyword\">true</span>;</div><div class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Throwable ex) &#123;</div><div class=\"line\">                result = <span class=\"keyword\">null</span>;</div><div class=\"line\">                ran = <span class=\"keyword\">false</span>;</div><div class=\"line\">                setException(ex);</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">if</span> (ran)</div><div class=\"line\">                set(result);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">       <span class=\"comment\">//3</span></div><div class=\"line\">        runner = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">        <span class=\"keyword\">if</span> (s &gt;= INTERRUPTING)</div><div class=\"line\">            handlePossibleCancellationInterrupt(s);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>标记1处检查FutureTask的状态，如果不是处于NEW，说明状态已经进入四条路径之一，也就没有必要继续了。如果状态是NEW，则将执行任务的线程交给runner。</p>\n<p>标记2处开始正式执行任务，调用call方法获取结果，没有异常就算成功，最后执行set方法；出现异常就调用setException方法。</p>\n<p>标记3处，无论任务执行是否成功，都需要将runner重新置为空。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">set</span><span class=\"params\">(V v)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (UNSAFE.compareAndSwapInt(<span class=\"keyword\">this</span>, stateOffset, NEW, COMPLETING)) &#123;</div><div class=\"line\">        outcome = v;</div><div class=\"line\">        UNSAFE.putOrderedInt(<span class=\"keyword\">this</span>, stateOffset, NORMAL); <span class=\"comment\">// final state</span></div><div class=\"line\">        finishCompletion();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">setException</span><span class=\"params\">(Throwable t)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (UNSAFE.compareAndSwapInt(<span class=\"keyword\">this</span>, stateOffset, NEW, COMPLETING)) &#123;</div><div class=\"line\">        outcome = t;</div><div class=\"line\">        UNSAFE.putOrderedInt(<span class=\"keyword\">this</span>, stateOffset, EXCEPTIONAL); <span class=\"comment\">// final state</span></div><div class=\"line\">        finishCompletion();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>任务执行成功与失败，分别对应NEW -&gt; COMPLETING -&gt; NORMAL和NEW -&gt; COMPLETING -&gt; EXCEPTIONAL两条路径。这里先将状态修改为中间状态，再对结果赋值，最后再修改为最终状态。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">finishCompletion</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">// assert state &gt; COMPLETING;</span></div><div class=\"line\">    <span class=\"keyword\">for</span> (WaitNode q; (q = waiters) != <span class=\"keyword\">null</span>;) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (UNSAFE.compareAndSwapObject(<span class=\"keyword\">this</span>, waitersOffset, q, <span class=\"keyword\">null</span>)) &#123;</div><div class=\"line\">            <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">                Thread t = q.thread;</div><div class=\"line\">                <span class=\"keyword\">if</span> (t != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">                    q.thread = <span class=\"keyword\">null</span>;</div><div class=\"line\">                    LockSupport.unpark(t);</div><div class=\"line\">                &#125;</div><div class=\"line\">                WaitNode next = q.next;</div><div class=\"line\">                <span class=\"keyword\">if</span> (next == <span class=\"keyword\">null</span>)</div><div class=\"line\">                    <span class=\"keyword\">break</span>;</div><div class=\"line\">                q.next = <span class=\"keyword\">null</span>; <span class=\"comment\">// unlink to help gc</span></div><div class=\"line\">                q = next;</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    done();</div><div class=\"line\">    callable = <span class=\"keyword\">null</span>;        <span class=\"comment\">// to reduce footprint</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>最后调用finishCompletion执行任务完成，唤醒并删除所有在waiters中等待的线程。done方法是空的，供子类实现，最后callable也设置为空。</p>\n<p>FutureTask还有个runAndReset，逻辑和run类似，但没有调用set方法来设置结果，执行完成后将任务重新初始化。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">boolean</span> <span class=\"title\">runAndReset</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (state != NEW ||</div><div class=\"line\">        !UNSAFE.compareAndSwapObject(<span class=\"keyword\">this</span>, runnerOffset,</div><div class=\"line\">                                     <span class=\"keyword\">null</span>, Thread.currentThread()))</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">boolean</span> ran = <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        Callable&lt;V&gt; c = callable;</div><div class=\"line\">        <span class=\"keyword\">if</span> (c != <span class=\"keyword\">null</span> &amp;&amp; s == NEW) &#123;</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                c.call(); <span class=\"comment\">// don't set result</span></div><div class=\"line\">                ran = <span class=\"keyword\">true</span>;</div><div class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Throwable ex) &#123;</div><div class=\"line\">                setException(ex);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">        <span class=\"comment\">// runner must be non-null until state is settled to</span></div><div class=\"line\">        <span class=\"comment\">// prevent concurrent calls to run()</span></div><div class=\"line\">        runner = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"comment\">// state must be re-read after nulling runner to prevent</span></div><div class=\"line\">        <span class=\"comment\">// leaked interrupts</span></div><div class=\"line\">        s = state;</div><div class=\"line\">        <span class=\"keyword\">if</span> (s &gt;= INTERRUPTING)</div><div class=\"line\">            handlePossibleCancellationInterrupt(s);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> ran &amp;&amp; s == NEW;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"4-5-FutureTask的取消\"><a href=\"#4-5-FutureTask的取消\" class=\"headerlink\" title=\"4.5 FutureTask的取消\"></a>4.5 FutureTask的取消</h3><p>对于已经提交执行的任务，可以调用cancel执行取消。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">cancel</span><span class=\"params\">(<span class=\"keyword\">boolean</span> mayInterruptIfRunning)</span> </span>&#123;</div><div class=\"line\">   <span class=\"comment\">//1</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (!(state == NEW &amp;&amp;</div><div class=\"line\">          UNSAFE.compareAndSwapInt(<span class=\"keyword\">this</span>, stateOffset, NEW,</div><div class=\"line\">              mayInterruptIfRunning ? INTERRUPTING : CANCELLED)))</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;    <span class=\"comment\">// in case call to interrupt throws exception</span></div><div class=\"line\">       <span class=\"comment\">//2</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (mayInterruptIfRunning) &#123;</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                Thread t = runner;</div><div class=\"line\">                <span class=\"keyword\">if</span> (t != <span class=\"keyword\">null</span>)</div><div class=\"line\">                    t.interrupt();</div><div class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123; <span class=\"comment\">// final state</span></div><div class=\"line\">                UNSAFE.putOrderedInt(<span class=\"keyword\">this</span>, stateOffset, INTERRUPTED);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">        finishCompletion();</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>标记1处判断任务状态，为NEW才能被取消。如果mayInterruptIfRunning是true，代表任务需要被中断，走NEW -&gt; INTERRUPTING -&gt; INTERRUPTED流程。否则代表任务被取消，走NEW -&gt; CANCELLED流程。</p>\n<p>标记2处理任务被中断的情况，这里仅仅是对线程发出中断请求，不确保任务能检测并处理中断，详细原理去看Java的中断机制。</p>\n<p>最后调用finishCompletion完成收尾工作。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isCancelled</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> state &gt;= CANCELLED;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>判断任务是否被取消，具体逻辑是判断state &gt;= CANCELLED，包括了被中断一共两条路径的结果。</p>\n<h3 id=\"4-5-FutureTask获取结果\"><a href=\"#4-5-FutureTask获取结果\" class=\"headerlink\" title=\"4.5 FutureTask获取结果\"></a>4.5 FutureTask获取结果</h3><p>调用FutureTask的get方法获取任务的执行结果，可以阻塞直到获取结果，也可以限制范围时间内获取结果，否则抛出TimeoutException。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">get</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">    <span class=\"keyword\">if</span> (s &lt;= COMPLETING)</div><div class=\"line\">        s = awaitDone(<span class=\"keyword\">false</span>, <span class=\"number\">0L</span>);</div><div class=\"line\">    <span class=\"keyword\">return</span> report(s);</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">get</span><span class=\"params\">(<span class=\"keyword\">long</span> timeout, TimeUnit unit)</span></span></div><div class=\"line\">    <span class=\"keyword\">throws</span> InterruptedException, ExecutionException, TimeoutException &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (unit == <span class=\"keyword\">null</span>)</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</div><div class=\"line\">    <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">    <span class=\"keyword\">if</span> (s &lt;= COMPLETING &amp;&amp;</div><div class=\"line\">        (s = awaitDone(<span class=\"keyword\">true</span>, unit.toNanos(timeout))) &lt;= COMPLETING)</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> TimeoutException();</div><div class=\"line\">    <span class=\"keyword\">return</span> report(s);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>get的核心实现调用了awaitDone，入参为是否开启时间限制和最大的等待时间。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> <span class=\"title\">awaitDone</span><span class=\"params\">(<span class=\"keyword\">boolean</span> timed, <span class=\"keyword\">long</span> nanos)</span></span></div><div class=\"line\">    <span class=\"keyword\">throws</span> InterruptedException &#123;</div><div class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> deadline = timed ? System.nanoTime() + nanos : <span class=\"number\">0L</span>;</div><div class=\"line\">    WaitNode q = <span class=\"keyword\">null</span>;</div><div class=\"line\">    <span class=\"keyword\">boolean</span> queued = <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (Thread.interrupted()) &#123;</div><div class=\"line\">            removeWaiter(q);</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> InterruptedException();</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">        <span class=\"keyword\">if</span> (s &gt; COMPLETING) &#123;    <span class=\"comment\">//1</span></div><div class=\"line\">            <span class=\"keyword\">if</span> (q != <span class=\"keyword\">null</span>)</div><div class=\"line\">                q.thread = <span class=\"keyword\">null</span>;</div><div class=\"line\">            <span class=\"keyword\">return</span> s;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (s == COMPLETING) <span class=\"comment\">// cannot time out yet    //2</span></div><div class=\"line\">            Thread.yield();</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (q == <span class=\"keyword\">null</span>)     <span class=\"comment\">//3</span></div><div class=\"line\">            q = <span class=\"keyword\">new</span> WaitNode();</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!queued)    <span class=\"comment\">//4</span></div><div class=\"line\">            queued = UNSAFE.compareAndSwapObject(<span class=\"keyword\">this</span>, waitersOffset,</div><div class=\"line\">                                                 q.next = waiters, q);</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (timed) &#123;    <span class=\"comment\">//5</span></div><div class=\"line\">            nanos = deadline - System.nanoTime();</div><div class=\"line\">            <span class=\"keyword\">if</span> (nanos &lt;= <span class=\"number\">0L</span>) &#123;</div><div class=\"line\">                removeWaiter(q);</div><div class=\"line\">                <span class=\"keyword\">return</span> state;</div><div class=\"line\">            &#125;</div><div class=\"line\">            LockSupport.parkNanos(<span class=\"keyword\">this</span>, nanos);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span>     <span class=\"comment\">//6</span></div><div class=\"line\">            LockSupport.park(<span class=\"keyword\">this</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>awaitDone主要逻辑是一个无限循环，首先判断线程是否被中断，是的话移除waiter并抛出中断异常。接下来是一串if-else，一共六种情况。</p>\n<ol>\n<li>判断任务状态是否已经完成，是就直接返回；</li>\n<li>任务状态是COMPLETING，代表在set结果时被阻塞了，这里先让出资源；</li>\n<li>如果WaitNode为空，就为当前线程初始化一个WaitNode；</li>\n<li>如果当前的WaitNode还没有加入waiters，就加入；</li>\n<li>如果是限定时间执行，判断有无超时，超时就将waiter移出，并返回结果，否则阻塞一定时间；</li>\n<li>如果没有限定时间，就一直阻塞到下次被唤醒。</li>\n</ol>\n<p>LockSupport是用来创建锁和其他同步类的基本线程阻塞原语。park和unpark的作用分别是阻塞线程和解除阻塞线程。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> V <span class=\"title\">report</span><span class=\"params\">(<span class=\"keyword\">int</span> s)</span> <span class=\"keyword\">throws</span> ExecutionException </span>&#123;</div><div class=\"line\">   Object x = outcome;</div><div class=\"line\">   <span class=\"keyword\">if</span> (s == NORMAL)</div><div class=\"line\">       <span class=\"keyword\">return</span> (V)x;</div><div class=\"line\">   <span class=\"keyword\">if</span> (s &gt;= CANCELLED)</div><div class=\"line\">       <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> CancellationException();</div><div class=\"line\">   <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> ExecutionException((Throwable)x);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>最后get调用report，使用outcome返回结果。</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/3294095-123399195bd337cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"此处输入图片的描述\"></p>\n<p>如果多个线程向同一个FutureTask实例get结果，但FutureTask又没有执行完毕，线程将会阻塞并保存在waiters中。待FutureTask获取结果后，唤醒waiters等待的线程，并返回同一个结果。</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"1-概述\"><a href=\"#1-概述\" class=\"headerlink\" title=\"1. 概述\"></a>1. 概述</h2><p>在线程池中执行任务，使用execute()方法，执行的是Runnable任务，它不返回任何值。如果希望任务完成后返回结果，那么需要使用Callable接口，这也是本文要研究的主题。</p>","more":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CallableTest</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tCallable&lt;Integer&gt; callable = <span class=\"keyword\">new</span> Callable&lt;Integer&gt;() &#123;</div><div class=\"line\">\t\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t\t\tSystem.out.println(<span class=\"string\">\"callable线程执行\"</span>);</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Random().nextInt(<span class=\"number\">100</span>);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;;</div><div class=\"line\"></div><div class=\"line\">\t\tExecutorService executorService = Executors.newSingleThreadExecutor();</div><div class=\"line\">\t\tFuture&lt;Integer&gt; future = executorService.submit(callable);</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">// 限定时间获取结果</span></div><div class=\"line\">\t\t\tSystem.out.println(future.get(<span class=\"number\">5</span>, TimeUnit.SECONDS));</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (TimeoutException e) &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">// 超时触发线程中止</span></div><div class=\"line\">\t\t\te.printStackTrace();</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\te.printStackTrace();</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (ExecutionException e) &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">// 抛出执行异常</span></div><div class=\"line\">\t\t\te.printStackTrace();</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">// 如果任务还在运行，执行中断</span></div><div class=\"line\">\t\t\t<span class=\"keyword\">boolean</span> mayInterruptIfRunning = <span class=\"keyword\">true</span>;</div><div class=\"line\">\t\t\tfuture.cancel(mayInterruptIfRunning);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>上面是callable和future的简单应用，执行时要求在限定时间内获取结果，超时执行会抛出TimeoutException，执行异常会抛出ExecutionException。最后在finally里，如果任务还在执行，就进行取消；如果任务已经执行完，取消操作也没有影响。</p>\n<h2 id=\"2-Callable接口\"><a href=\"#2-Callable接口\" class=\"headerlink\" title=\"2. Callable接口\"></a>2. Callable接口</h2><p>我们先回顾一下java.lang.Runnable接口，就声明了run(),其返回值为void，当然就无法获取结果了。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Runnable</span> </span>&#123;  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>;  </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>而callable的接口定义如下：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Callable</span>&lt;<span class=\"title\">V</span>&gt; </span>&#123;   </div><div class=\"line\">      <span class=\"function\">V   <span class=\"title\">call</span><span class=\"params\">()</span>   <span class=\"keyword\">throws</span> Exception</span>;   </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>callable接口声明call()方法，有返回值，也可抛出异常，对该接口我们先了解这么多就行，下面我们来说明如何使用。</p>\n<p>无论是Runnable接口的实现类还是Callable接口的实现类，都可以被ThreadPoolExecutor或ScheduledThreadPoolExecutor执行，ThreadPoolExecutor或ScheduledThreadPoolExecutor都实现了ExcutorService接口，而因此Callable需要和Executor框架中的ExcutorService结合使用，我们先看看ExecutorService提供的方法：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;T&gt; <span class=\"function\">Future&lt;T&gt; <span class=\"title\">submit</span><span class=\"params\">(Callable&lt;T&gt; task)</span></span>;  </div><div class=\"line\">Future&lt;?&gt; submit(Runnable task);  </div><div class=\"line\">&lt;T&gt; <span class=\"function\">Future&lt;T&gt; <span class=\"title\">submit</span><span class=\"params\">(Runnable task, T result)</span></span>;</div></pre></td></tr></table></figure></p>\n<ul>\n<li>第一个方法：submit提交一个实现Callable接口的任务，并且返回封装了异步计算结果的Future。</li>\n<li>第二个方法：submit提交一个实现Runnable接口的任务，并且返回封装了异步计算结果的Future。</li>\n<li>第三个方法：submit提交一个实现Runnable接口的任务，并且指定了在调用Future的get方法时返回的result对象。这个用的很少，因为是自己给定的返回结果，意义不大。</li>\n</ul>\n<p>因此我们只要创建好我们的线程对象（实现Callable接口或者Runnable接口），然后通过上面3个方法提交给线程池去执行即可。<br>还有点要注意的是，除了我们自己实现Callable对象外，我们还可以使用工厂类Executors来把一个Runnable对象包装成Callable对象。Executors工厂类提供的方法如下：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Callable&lt;Object&gt; <span class=\"title\">callable</span><span class=\"params\">(Runnable task)</span>  </span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> &lt;T&gt; Callable&lt;T&gt; <span class=\"title\">callable</span><span class=\"params\">(Runnable task, T result)</span></div></pre></td></tr></table></figure></p>\n<h2 id=\"3-Future接口\"><a href=\"#3-Future接口\" class=\"headerlink\" title=\"3. Future接口\"></a>3. Future接口</h2><p>Future<v>接口是用来获取异步计算结果的，说白了就是对具体的Runnable或者Callable对象任务执行的结果进行获取(get()),取消(cancel()),判断是否完成等操作。我们看看Future接口的源码：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Future</span>&lt;<span class=\"title\">V</span>&gt; </span>&#123;  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">cancel</span><span class=\"params\">(<span class=\"keyword\">boolean</span> mayInterruptIfRunning)</span></span>;  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">isCancelled</span><span class=\"params\">()</span></span>;  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">isDone</span><span class=\"params\">()</span></span>;  </div><div class=\"line\">    <span class=\"function\">V <span class=\"title\">get</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException</span>;  </div><div class=\"line\">    <span class=\"function\">V <span class=\"title\">get</span><span class=\"params\">(<span class=\"keyword\">long</span> timeout, TimeUnit unit)</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException, TimeoutException</span>;  </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></v></p>\n<p>方法解析：</p>\n<ul>\n<li>get(): 获取异步执行的结果，如果没有结果可用，此方法会阻塞直到异步计算完成。</li>\n<li>get(long timeout, TimeUnit unit):获取异步执行结果，如果没有结果可用，此方法会阻塞，但是会有时间限制，如果阻塞时间超过设定的timeout时间，该方法将抛出异常。</li>\n<li>isDone():如果任务执行结束，无论是正常结束或是中途取消还是发生异常，都返回true。</li>\n<li>isCancelled():如果任务完成前被取消，则返回true。</li>\n<li>cancel():<ul>\n<li>如果任务还没开始，执行cancel(…)方法将返回false</li>\n<li>如果任务已经启动，执行cancel(true)方法将以中断执行此任务线程的方式来试图停止任务，如果停止成功，返回true；当任务已经启动，执行cancel(false)方法将不会对正在执行的任务线程产生影响(让线程正常执行到完成)，此时返回false</li>\n<li>当任务已经完成，执行cancel(…)方法将返回false</li>\n</ul>\n</li>\n</ul>\n<p>通过方法分析我们也知道实际上Future提供了3种功能：</p>\n<ol>\n<li>能够中断执行中的任务</li>\n<li>判断任务是否执行完成</li>\n<li>获取任务执行完成后额结果。</li>\n</ol>\n<p>但是我们必须明白Future只是一个接口，我们无法直接创建对象，因此就需要其实现类FutureTask登场啦</p>\n<h2 id=\"4-FutureTask\"><a href=\"#4-FutureTask\" class=\"headerlink\" title=\"4. FutureTask\"></a>4. FutureTask</h2><p>————————-<img src=\"http://upload-images.jianshu.io/upload_images/3294095-237f514c17eb5e4a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"此处输入图片的描述\">————————–<br>FutureTask除了实现了Future接口外还实现了Runnable接口，因此FutureTask也可以直接提交给Executor执行。 当然也可以调用线程直接执行（FutureTask.run()）.</p>\n<h3 id=\"4-1-FutureTask的状态\"><a href=\"#4-1-FutureTask的状态\" class=\"headerlink\" title=\"4.1 FutureTask的状态\"></a>4.1 FutureTask的状态</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">int</span> state;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> NEW          = <span class=\"number\">0</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> COMPLETING   = <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> NORMAL       = <span class=\"number\">2</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> EXCEPTIONAL  = <span class=\"number\">3</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> CANCELLED    = <span class=\"number\">4</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> INTERRUPTING = <span class=\"number\">5</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> INTERRUPTED  = <span class=\"number\">6</span>;</div></pre></td></tr></table></figure>\n<p>FutureTask有7种状态，初始状态从NEW开始，状态转换路径可以归纳为图2所示。在后文的代码，会使用int的大小比较判断状态处于哪个范围，需要留意上面状态的排列顺序<br><img src=\"http://upload-images.jianshu.io/upload_images/3294095-66574ae94d956415.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"FutureTask的状态\"><br>FutureTask的状态路径，取决于run和cancel的调用顺序，在后文分析时，对号入座这几条路径。</p>\n<ol>\n<li>NEW -&gt; COMPLETING -&gt; NORMAL 正常的流程</li>\n<li>NEW -&gt; COMPLETING -&gt; EXCEPTIONAL 异常的流程</li>\n<li>NEW -&gt; CANCELLED 被取消流程</li>\n<li>NEW -&gt; INTERRUPTING -&gt; INTERRUPTED 被中断流程</li>\n</ol>\n<h3 id=\"4-2-FutureTask的变量\"><a href=\"#4-2-FutureTask的变量\" class=\"headerlink\" title=\"4.2 FutureTask的变量\"></a>4.2 FutureTask的变量</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">int</span> state;</div><div class=\"line\"><span class=\"comment\">/** The underlying callable; nulled out after running */</span></div><div class=\"line\"><span class=\"keyword\">private</span> Callable&lt;V&gt; callable;</div><div class=\"line\"><span class=\"comment\">/** The result to return or exception to throw from get() */</span></div><div class=\"line\"><span class=\"keyword\">private</span> Object outcome; <span class=\"comment\">// non-volatile, protected by state reads/writes</span></div><div class=\"line\"><span class=\"comment\">/** The thread running the callable; CASed during run() */</span></div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> Thread runner;</div><div class=\"line\"><span class=\"comment\">/** Treiber stack of waiting threads */</span></div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> WaitNode waiters;</div></pre></td></tr></table></figure>\n<p>state、runner、waiters三个变量没有使用原子类，而是使用Unsafe对象进行原子操作。代码中会见到很多形如compareAndSwap的方法，入门原理可以看<a href=\"http://www.jianshu.com/p/e2179c74a2e4\" target=\"_blank\" rel=\"noopener\">认识非阻塞的同步机制CAS</a>。</p>\n<p>callable是要执行的任务，runner是执行任务的线程，outcome是返回的结果（正常结果或Exception结果）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WaitNode</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">volatile</span> Thread thread;</div><div class=\"line\">    <span class=\"keyword\">volatile</span> WaitNode next;</div><div class=\"line\">    WaitNode() &#123; thread = Thread.currentThread(); &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>waiters的数据结构是WaitNode，保存了Thread和下个WaitNode的引用。waiters保存了等待结果的线程，每次操作只会增减头，所以是一个栈结构，详细见后文对get方法的分析。</p>\n<h3 id=\"4-3-FutureTask的创建\"><a href=\"#4-3-FutureTask的创建\" class=\"headerlink\" title=\"4.3 FutureTask的创建\"></a>4.3 FutureTask的创建</h3><p>下面是FutureTask的两种创建方式：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">FutureTask</span><span class=\"params\">(Callable&lt;V&gt; callable)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (callable == <span class=\"keyword\">null</span>)</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</div><div class=\"line\">    <span class=\"keyword\">this</span>.callable = callable;</div><div class=\"line\">    <span class=\"keyword\">this</span>.state = NEW;       <span class=\"comment\">// ensure visibility of callable</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">FutureTask</span><span class=\"params\">(Runnable runnable, V result)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.callable = Executors.callable(runnable, result);</div><div class=\"line\">    <span class=\"keyword\">this</span>.state = NEW;       <span class=\"comment\">// ensure visibility of callable</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>提交FutureTask到线程池的submit定义在AbstractExecutorService，根据入参的不同，有三个submit方法。下面以提交Callable为例：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> &lt;T&gt; <span class=\"function\">Future&lt;T&gt; <span class=\"title\">submit</span><span class=\"params\">(Callable&lt;T&gt; task)</span> </span>&#123;</div><div class=\"line\">   <span class=\"keyword\">if</span> (task == <span class=\"keyword\">null</span>) <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</div><div class=\"line\">   RunnableFuture&lt;T&gt; ftask = newTaskFor(task);</div><div class=\"line\">   execute(ftask);</div><div class=\"line\">   <span class=\"keyword\">return</span> ftask;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">protected</span> &lt;T&gt; <span class=\"function\">RunnableFuture&lt;T&gt; <span class=\"title\">newTaskFor</span><span class=\"params\">(Callable&lt;T&gt; callable)</span> </span>&#123;    </div><div class=\"line\">   <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> FutureTask&lt;T&gt;(callable);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>FutureTask在newTaskFor创建，然后调用线程池的execute执行，最后返回Future。获取Future后，就可以调用get获取结果，或者调用cancel取消任务。</p>\n<h3 id=\"4-4-FutureTask的运行\"><a href=\"#4-4-FutureTask的运行\" class=\"headerlink\" title=\"4.4 FutureTask的运行\"></a>4.4 FutureTask的运行</h3><p>FutureTask实现了Runnable，在线程池里执行时调用的方法是run。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//1</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (state != NEW ||</div><div class=\"line\">        !UNSAFE.compareAndSwapObject(<span class=\"keyword\">this</span>, runnerOffset,<span class=\"keyword\">null</span>, Thread.currentThread()))</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">    <span class=\"comment\">//2</span></div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        Callable&lt;V&gt; c = callable;</div><div class=\"line\">        <span class=\"keyword\">if</span> (c != <span class=\"keyword\">null</span> &amp;&amp; state == NEW) &#123;</div><div class=\"line\">            V result;</div><div class=\"line\">            <span class=\"keyword\">boolean</span> ran;</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                result = c.call();</div><div class=\"line\">                ran = <span class=\"keyword\">true</span>;</div><div class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Throwable ex) &#123;</div><div class=\"line\">                result = <span class=\"keyword\">null</span>;</div><div class=\"line\">                ran = <span class=\"keyword\">false</span>;</div><div class=\"line\">                setException(ex);</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">if</span> (ran)</div><div class=\"line\">                set(result);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">       <span class=\"comment\">//3</span></div><div class=\"line\">        runner = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">        <span class=\"keyword\">if</span> (s &gt;= INTERRUPTING)</div><div class=\"line\">            handlePossibleCancellationInterrupt(s);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>标记1处检查FutureTask的状态，如果不是处于NEW，说明状态已经进入四条路径之一，也就没有必要继续了。如果状态是NEW，则将执行任务的线程交给runner。</p>\n<p>标记2处开始正式执行任务，调用call方法获取结果，没有异常就算成功，最后执行set方法；出现异常就调用setException方法。</p>\n<p>标记3处，无论任务执行是否成功，都需要将runner重新置为空。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">set</span><span class=\"params\">(V v)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (UNSAFE.compareAndSwapInt(<span class=\"keyword\">this</span>, stateOffset, NEW, COMPLETING)) &#123;</div><div class=\"line\">        outcome = v;</div><div class=\"line\">        UNSAFE.putOrderedInt(<span class=\"keyword\">this</span>, stateOffset, NORMAL); <span class=\"comment\">// final state</span></div><div class=\"line\">        finishCompletion();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">setException</span><span class=\"params\">(Throwable t)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (UNSAFE.compareAndSwapInt(<span class=\"keyword\">this</span>, stateOffset, NEW, COMPLETING)) &#123;</div><div class=\"line\">        outcome = t;</div><div class=\"line\">        UNSAFE.putOrderedInt(<span class=\"keyword\">this</span>, stateOffset, EXCEPTIONAL); <span class=\"comment\">// final state</span></div><div class=\"line\">        finishCompletion();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>任务执行成功与失败，分别对应NEW -&gt; COMPLETING -&gt; NORMAL和NEW -&gt; COMPLETING -&gt; EXCEPTIONAL两条路径。这里先将状态修改为中间状态，再对结果赋值，最后再修改为最终状态。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">finishCompletion</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">// assert state &gt; COMPLETING;</span></div><div class=\"line\">    <span class=\"keyword\">for</span> (WaitNode q; (q = waiters) != <span class=\"keyword\">null</span>;) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (UNSAFE.compareAndSwapObject(<span class=\"keyword\">this</span>, waitersOffset, q, <span class=\"keyword\">null</span>)) &#123;</div><div class=\"line\">            <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">                Thread t = q.thread;</div><div class=\"line\">                <span class=\"keyword\">if</span> (t != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">                    q.thread = <span class=\"keyword\">null</span>;</div><div class=\"line\">                    LockSupport.unpark(t);</div><div class=\"line\">                &#125;</div><div class=\"line\">                WaitNode next = q.next;</div><div class=\"line\">                <span class=\"keyword\">if</span> (next == <span class=\"keyword\">null</span>)</div><div class=\"line\">                    <span class=\"keyword\">break</span>;</div><div class=\"line\">                q.next = <span class=\"keyword\">null</span>; <span class=\"comment\">// unlink to help gc</span></div><div class=\"line\">                q = next;</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    done();</div><div class=\"line\">    callable = <span class=\"keyword\">null</span>;        <span class=\"comment\">// to reduce footprint</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>最后调用finishCompletion执行任务完成，唤醒并删除所有在waiters中等待的线程。done方法是空的，供子类实现，最后callable也设置为空。</p>\n<p>FutureTask还有个runAndReset，逻辑和run类似，但没有调用set方法来设置结果，执行完成后将任务重新初始化。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">boolean</span> <span class=\"title\">runAndReset</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (state != NEW ||</div><div class=\"line\">        !UNSAFE.compareAndSwapObject(<span class=\"keyword\">this</span>, runnerOffset,</div><div class=\"line\">                                     <span class=\"keyword\">null</span>, Thread.currentThread()))</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">boolean</span> ran = <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        Callable&lt;V&gt; c = callable;</div><div class=\"line\">        <span class=\"keyword\">if</span> (c != <span class=\"keyword\">null</span> &amp;&amp; s == NEW) &#123;</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                c.call(); <span class=\"comment\">// don't set result</span></div><div class=\"line\">                ran = <span class=\"keyword\">true</span>;</div><div class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Throwable ex) &#123;</div><div class=\"line\">                setException(ex);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">        <span class=\"comment\">// runner must be non-null until state is settled to</span></div><div class=\"line\">        <span class=\"comment\">// prevent concurrent calls to run()</span></div><div class=\"line\">        runner = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"comment\">// state must be re-read after nulling runner to prevent</span></div><div class=\"line\">        <span class=\"comment\">// leaked interrupts</span></div><div class=\"line\">        s = state;</div><div class=\"line\">        <span class=\"keyword\">if</span> (s &gt;= INTERRUPTING)</div><div class=\"line\">            handlePossibleCancellationInterrupt(s);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> ran &amp;&amp; s == NEW;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"4-5-FutureTask的取消\"><a href=\"#4-5-FutureTask的取消\" class=\"headerlink\" title=\"4.5 FutureTask的取消\"></a>4.5 FutureTask的取消</h3><p>对于已经提交执行的任务，可以调用cancel执行取消。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">cancel</span><span class=\"params\">(<span class=\"keyword\">boolean</span> mayInterruptIfRunning)</span> </span>&#123;</div><div class=\"line\">   <span class=\"comment\">//1</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (!(state == NEW &amp;&amp;</div><div class=\"line\">          UNSAFE.compareAndSwapInt(<span class=\"keyword\">this</span>, stateOffset, NEW,</div><div class=\"line\">              mayInterruptIfRunning ? INTERRUPTING : CANCELLED)))</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;    <span class=\"comment\">// in case call to interrupt throws exception</span></div><div class=\"line\">       <span class=\"comment\">//2</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (mayInterruptIfRunning) &#123;</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                Thread t = runner;</div><div class=\"line\">                <span class=\"keyword\">if</span> (t != <span class=\"keyword\">null</span>)</div><div class=\"line\">                    t.interrupt();</div><div class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123; <span class=\"comment\">// final state</span></div><div class=\"line\">                UNSAFE.putOrderedInt(<span class=\"keyword\">this</span>, stateOffset, INTERRUPTED);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">        finishCompletion();</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>标记1处判断任务状态，为NEW才能被取消。如果mayInterruptIfRunning是true，代表任务需要被中断，走NEW -&gt; INTERRUPTING -&gt; INTERRUPTED流程。否则代表任务被取消，走NEW -&gt; CANCELLED流程。</p>\n<p>标记2处理任务被中断的情况，这里仅仅是对线程发出中断请求，不确保任务能检测并处理中断，详细原理去看Java的中断机制。</p>\n<p>最后调用finishCompletion完成收尾工作。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isCancelled</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> state &gt;= CANCELLED;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>判断任务是否被取消，具体逻辑是判断state &gt;= CANCELLED，包括了被中断一共两条路径的结果。</p>\n<h3 id=\"4-5-FutureTask获取结果\"><a href=\"#4-5-FutureTask获取结果\" class=\"headerlink\" title=\"4.5 FutureTask获取结果\"></a>4.5 FutureTask获取结果</h3><p>调用FutureTask的get方法获取任务的执行结果，可以阻塞直到获取结果，也可以限制范围时间内获取结果，否则抛出TimeoutException。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">get</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">    <span class=\"keyword\">if</span> (s &lt;= COMPLETING)</div><div class=\"line\">        s = awaitDone(<span class=\"keyword\">false</span>, <span class=\"number\">0L</span>);</div><div class=\"line\">    <span class=\"keyword\">return</span> report(s);</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">get</span><span class=\"params\">(<span class=\"keyword\">long</span> timeout, TimeUnit unit)</span></span></div><div class=\"line\">    <span class=\"keyword\">throws</span> InterruptedException, ExecutionException, TimeoutException &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (unit == <span class=\"keyword\">null</span>)</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</div><div class=\"line\">    <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">    <span class=\"keyword\">if</span> (s &lt;= COMPLETING &amp;&amp;</div><div class=\"line\">        (s = awaitDone(<span class=\"keyword\">true</span>, unit.toNanos(timeout))) &lt;= COMPLETING)</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> TimeoutException();</div><div class=\"line\">    <span class=\"keyword\">return</span> report(s);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>get的核心实现调用了awaitDone，入参为是否开启时间限制和最大的等待时间。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> <span class=\"title\">awaitDone</span><span class=\"params\">(<span class=\"keyword\">boolean</span> timed, <span class=\"keyword\">long</span> nanos)</span></span></div><div class=\"line\">    <span class=\"keyword\">throws</span> InterruptedException &#123;</div><div class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> deadline = timed ? System.nanoTime() + nanos : <span class=\"number\">0L</span>;</div><div class=\"line\">    WaitNode q = <span class=\"keyword\">null</span>;</div><div class=\"line\">    <span class=\"keyword\">boolean</span> queued = <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (Thread.interrupted()) &#123;</div><div class=\"line\">            removeWaiter(q);</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> InterruptedException();</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">        <span class=\"keyword\">if</span> (s &gt; COMPLETING) &#123;    <span class=\"comment\">//1</span></div><div class=\"line\">            <span class=\"keyword\">if</span> (q != <span class=\"keyword\">null</span>)</div><div class=\"line\">                q.thread = <span class=\"keyword\">null</span>;</div><div class=\"line\">            <span class=\"keyword\">return</span> s;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (s == COMPLETING) <span class=\"comment\">// cannot time out yet    //2</span></div><div class=\"line\">            Thread.yield();</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (q == <span class=\"keyword\">null</span>)     <span class=\"comment\">//3</span></div><div class=\"line\">            q = <span class=\"keyword\">new</span> WaitNode();</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!queued)    <span class=\"comment\">//4</span></div><div class=\"line\">            queued = UNSAFE.compareAndSwapObject(<span class=\"keyword\">this</span>, waitersOffset,</div><div class=\"line\">                                                 q.next = waiters, q);</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (timed) &#123;    <span class=\"comment\">//5</span></div><div class=\"line\">            nanos = deadline - System.nanoTime();</div><div class=\"line\">            <span class=\"keyword\">if</span> (nanos &lt;= <span class=\"number\">0L</span>) &#123;</div><div class=\"line\">                removeWaiter(q);</div><div class=\"line\">                <span class=\"keyword\">return</span> state;</div><div class=\"line\">            &#125;</div><div class=\"line\">            LockSupport.parkNanos(<span class=\"keyword\">this</span>, nanos);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span>     <span class=\"comment\">//6</span></div><div class=\"line\">            LockSupport.park(<span class=\"keyword\">this</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>awaitDone主要逻辑是一个无限循环，首先判断线程是否被中断，是的话移除waiter并抛出中断异常。接下来是一串if-else，一共六种情况。</p>\n<ol>\n<li>判断任务状态是否已经完成，是就直接返回；</li>\n<li>任务状态是COMPLETING，代表在set结果时被阻塞了，这里先让出资源；</li>\n<li>如果WaitNode为空，就为当前线程初始化一个WaitNode；</li>\n<li>如果当前的WaitNode还没有加入waiters，就加入；</li>\n<li>如果是限定时间执行，判断有无超时，超时就将waiter移出，并返回结果，否则阻塞一定时间；</li>\n<li>如果没有限定时间，就一直阻塞到下次被唤醒。</li>\n</ol>\n<p>LockSupport是用来创建锁和其他同步类的基本线程阻塞原语。park和unpark的作用分别是阻塞线程和解除阻塞线程。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> V <span class=\"title\">report</span><span class=\"params\">(<span class=\"keyword\">int</span> s)</span> <span class=\"keyword\">throws</span> ExecutionException </span>&#123;</div><div class=\"line\">   Object x = outcome;</div><div class=\"line\">   <span class=\"keyword\">if</span> (s == NORMAL)</div><div class=\"line\">       <span class=\"keyword\">return</span> (V)x;</div><div class=\"line\">   <span class=\"keyword\">if</span> (s &gt;= CANCELLED)</div><div class=\"line\">       <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> CancellationException();</div><div class=\"line\">   <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> ExecutionException((Throwable)x);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>最后get调用report，使用outcome返回结果。</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/3294095-123399195bd337cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"此处输入图片的描述\"></p>\n<p>如果多个线程向同一个FutureTask实例get结果，但FutureTask又没有执行完毕，线程将会阻塞并保存在waiters中。待FutureTask获取结果后，唤醒waiters等待的线程，并返回同一个结果。</p>"},{"title":"Java中读取properties","date":"2017-12-19T03:41:35.000Z","_content":"\n将一些业务常量配置成properties文件，是扩展程序兼容性的常用做法。在业务变更导致数据需要改变时，不需要修改代码，只用更改配置文件并重启即可生效。\n\n<!-- more -->\n\n## 方法一：IO实现\n```java\npublic static String getValue(String fileNamePath, String key) throws IOException {\n    Properties props = new Properties();\n    InputStream in = null;\n    \n    try {\n        in = new FileInputStream(fileNamePath);\n        //如果将in改为下面的方法，必须要将.Properties文件和此class类文件放在同一个包中    \n        //in = propertiesTools.class.getResourceAsStream(fileNamePath); \n        props.load(in);\n        String value = props.getProperty(key);\n        // 有乱码时要进行重新编码    \n        // new String(props.getProperty(\"name\").getBytes(\"ISO-8859-1\"), \"GBK\");\n        return value;\n    } catch (FileNotFoundException e) {\n        return null;\n    } finally {\n        if (null != in) {\n            in.close();\n        }\n    }\n}\n```\n\n## 方法二：spring实现\n\n在spring扫描配置文件时，将properties中的key和value放入一个map中。\n\n 1. Spring配置\n\n  ```xml\n <bean id=\"propertyConfigurer\" class=\"com.hapishop.util.ProjectDBinfoConfigurer\">\n        <property name=\"locations\">\n            <list>\n                <value>classpath*:/META-INF/*.properties</value>\n                <value>file:conf/*.properties</value>\n            </list>\n        </property>\n    </bean>\n  ```\n\n 2. 自定义CustomizedPropertyConfigurer,继承**PropertyPlaceholderConfigurer**\n\n    ```java\n    public class CustomizedPropertyConfigurer extends PropertyPlaceholderConfigurer {\n        private static Map<String, String> properties = new HashMap<String, String>();\n\n        protected void processProperties(ConfigurableListableBeanFactory beanFactoryToProcess, Properties props) throws BeansException {\n            // cache the properties\n            PropertyPlaceholderHelper helper = new PropertyPlaceholderHelper(DEFAULT_PLACEHOLDER_PREFIX,DEFAULT_PLACEHOLDER_SUFFIX, DEFAULT_VALUE_SEPARATOR, false);\n            for (Entry<Object, Object> entry : props.entrySet()) {\n                String stringKey = String.valueOf(entry.getKey());\n                String stringValue = String.valueOf(entry.getValue());\n                stringValue = helper.replacePlaceholders(stringValue, props);\n                properties.put(stringKey, stringValue);\n            }\n            super.processProperties(beanFactoryToProcess, props);\n        }\n\n        public static Map<String, String> getProperties() {\n            return properties;\n        }\n    \n        public static String getProperty(String key) {\n            return properties.get(key);\n        }\n} \n    ```\n    \n 3. 配置properties\n\n    ```xml\n    site=iteye  \n    blog=antlove  \n    url=${site}/${blog} \n    ```\n    \n\n 4. Java获取\n\n    ```java\n    //调用此方法获取value\n    CustomizedPropertyConfigurer.getContextProperty()\n    ```\n\n## 方法三：注解实现\n\n - Spring配置\n  \n  ```xml\n <bean id=\"propertyConfigurer\" class=\"com.hapishop.util.ProjectDBinfoConfigurer\">\n        <property name=\"locations\">\n            <list>\n                <value>classpath*:/META-INF/*.properties</value>\n                <value>file:conf/*.properties</value>\n            </list>\n        </property>\n    </bean>\n  ```\n  \n - 注解获取\n\n    ```java\n    @Value(\"${socket.time.out}\")\n    int socketTimeout;\n    \n    public void setSocketTimeout(int socketTimeout) {  \n        this.socketTimeout = socketTimeout;  \n    }  \n    ```\n    \n    @Value写在要注入的属性上，要提供setter方法。\n    \n    \n## spring加载properties的两个类的区别\n\n - PropertiesFactoryBean是PropertiesLoaderSupport直接的实现类，专门用来管理properties文件的工厂bean，默认是单例的。\n - PropertyPlaceholderConfigurer是解决properties文件占位符问题的，也实现了PropertiesLoaderSupport类。\n\n在java 代码里，一般是使用@Value注解来引用 properties 文件的属性。\n\n使用 PropertyPlaceholderConfigurer 时， @Value表达式的用法是 @Value(value=\"${properties key}\") ，\n\n使用 PropertiesFactoryBean 时，我们还可以用@Value 读取 properties对象的值， @Value 用法 是 @Value(value=\"#{configProperties['properties key']}\")\n     \n\n \n \n \n \n\n","source":"_posts/Java中读取properties.md","raw":"---\ntitle: Java中读取properties\ncategories:\n  - Spring\ntags:\n  - properties\ndate: 2017-12-19 11:41:35\n---\n\n将一些业务常量配置成properties文件，是扩展程序兼容性的常用做法。在业务变更导致数据需要改变时，不需要修改代码，只用更改配置文件并重启即可生效。\n\n<!-- more -->\n\n## 方法一：IO实现\n```java\npublic static String getValue(String fileNamePath, String key) throws IOException {\n    Properties props = new Properties();\n    InputStream in = null;\n    \n    try {\n        in = new FileInputStream(fileNamePath);\n        //如果将in改为下面的方法，必须要将.Properties文件和此class类文件放在同一个包中    \n        //in = propertiesTools.class.getResourceAsStream(fileNamePath); \n        props.load(in);\n        String value = props.getProperty(key);\n        // 有乱码时要进行重新编码    \n        // new String(props.getProperty(\"name\").getBytes(\"ISO-8859-1\"), \"GBK\");\n        return value;\n    } catch (FileNotFoundException e) {\n        return null;\n    } finally {\n        if (null != in) {\n            in.close();\n        }\n    }\n}\n```\n\n## 方法二：spring实现\n\n在spring扫描配置文件时，将properties中的key和value放入一个map中。\n\n 1. Spring配置\n\n  ```xml\n <bean id=\"propertyConfigurer\" class=\"com.hapishop.util.ProjectDBinfoConfigurer\">\n        <property name=\"locations\">\n            <list>\n                <value>classpath*:/META-INF/*.properties</value>\n                <value>file:conf/*.properties</value>\n            </list>\n        </property>\n    </bean>\n  ```\n\n 2. 自定义CustomizedPropertyConfigurer,继承**PropertyPlaceholderConfigurer**\n\n    ```java\n    public class CustomizedPropertyConfigurer extends PropertyPlaceholderConfigurer {\n        private static Map<String, String> properties = new HashMap<String, String>();\n\n        protected void processProperties(ConfigurableListableBeanFactory beanFactoryToProcess, Properties props) throws BeansException {\n            // cache the properties\n            PropertyPlaceholderHelper helper = new PropertyPlaceholderHelper(DEFAULT_PLACEHOLDER_PREFIX,DEFAULT_PLACEHOLDER_SUFFIX, DEFAULT_VALUE_SEPARATOR, false);\n            for (Entry<Object, Object> entry : props.entrySet()) {\n                String stringKey = String.valueOf(entry.getKey());\n                String stringValue = String.valueOf(entry.getValue());\n                stringValue = helper.replacePlaceholders(stringValue, props);\n                properties.put(stringKey, stringValue);\n            }\n            super.processProperties(beanFactoryToProcess, props);\n        }\n\n        public static Map<String, String> getProperties() {\n            return properties;\n        }\n    \n        public static String getProperty(String key) {\n            return properties.get(key);\n        }\n} \n    ```\n    \n 3. 配置properties\n\n    ```xml\n    site=iteye  \n    blog=antlove  \n    url=${site}/${blog} \n    ```\n    \n\n 4. Java获取\n\n    ```java\n    //调用此方法获取value\n    CustomizedPropertyConfigurer.getContextProperty()\n    ```\n\n## 方法三：注解实现\n\n - Spring配置\n  \n  ```xml\n <bean id=\"propertyConfigurer\" class=\"com.hapishop.util.ProjectDBinfoConfigurer\">\n        <property name=\"locations\">\n            <list>\n                <value>classpath*:/META-INF/*.properties</value>\n                <value>file:conf/*.properties</value>\n            </list>\n        </property>\n    </bean>\n  ```\n  \n - 注解获取\n\n    ```java\n    @Value(\"${socket.time.out}\")\n    int socketTimeout;\n    \n    public void setSocketTimeout(int socketTimeout) {  \n        this.socketTimeout = socketTimeout;  \n    }  \n    ```\n    \n    @Value写在要注入的属性上，要提供setter方法。\n    \n    \n## spring加载properties的两个类的区别\n\n - PropertiesFactoryBean是PropertiesLoaderSupport直接的实现类，专门用来管理properties文件的工厂bean，默认是单例的。\n - PropertyPlaceholderConfigurer是解决properties文件占位符问题的，也实现了PropertiesLoaderSupport类。\n\n在java 代码里，一般是使用@Value注解来引用 properties 文件的属性。\n\n使用 PropertyPlaceholderConfigurer 时， @Value表达式的用法是 @Value(value=\"${properties key}\") ，\n\n使用 PropertiesFactoryBean 时，我们还可以用@Value 读取 properties对象的值， @Value 用法 是 @Value(value=\"#{configProperties['properties key']}\")\n     \n\n \n \n \n \n\n","slug":"Java中读取properties","published":1,"updated":"2018-02-27T07:38:38.084Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspea0008n8vfe8670eed","content":"<p>将一些业务常量配置成properties文件，是扩展程序兼容性的常用做法。在业务变更导致数据需要改变时，不需要修改代码，只用更改配置文件并重启即可生效。</p>\n<a id=\"more\"></a>\n<h2 id=\"方法一：IO实现\"><a href=\"#方法一：IO实现\" class=\"headerlink\" title=\"方法一：IO实现\"></a>方法一：IO实现</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">getValue</span><span class=\"params\">(String fileNamePath, String key)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</div><div class=\"line\">    Properties props = <span class=\"keyword\">new</span> Properties();</div><div class=\"line\">    InputStream in = <span class=\"keyword\">null</span>;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        in = <span class=\"keyword\">new</span> FileInputStream(fileNamePath);</div><div class=\"line\">        <span class=\"comment\">//如果将in改为下面的方法，必须要将.Properties文件和此class类文件放在同一个包中    </span></div><div class=\"line\">        <span class=\"comment\">//in = propertiesTools.class.getResourceAsStream(fileNamePath); </span></div><div class=\"line\">        props.load(in);</div><div class=\"line\">        String value = props.getProperty(key);</div><div class=\"line\">        <span class=\"comment\">// 有乱码时要进行重新编码    </span></div><div class=\"line\">        <span class=\"comment\">// new String(props.getProperty(\"name\").getBytes(\"ISO-8859-1\"), \"GBK\");</span></div><div class=\"line\">        <span class=\"keyword\">return</span> value;</div><div class=\"line\">    &#125; <span class=\"keyword\">catch</span> (FileNotFoundException e) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> != in) &#123;</div><div class=\"line\">            in.close();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"方法二：spring实现\"><a href=\"#方法二：spring实现\" class=\"headerlink\" title=\"方法二：spring实现\"></a>方法二：spring实现</h2><p>在spring扫描配置文件时，将properties中的key和value放入一个map中。</p>\n<ol>\n<li><p>Spring配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"propertyConfigurer\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.hapishop.util.ProjectDBinfoConfigurer\"</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"locations\"</span>&gt;</span></div><div class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>classpath*:/META-INF/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>file:conf/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>自定义CustomizedPropertyConfigurer,继承<strong>PropertyPlaceholderConfigurer</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CustomizedPropertyConfigurer</span> <span class=\"keyword\">extends</span> <span class=\"title\">PropertyPlaceholderConfigurer</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Map&lt;String, String&gt; properties = <span class=\"keyword\">new</span> HashMap&lt;String, String&gt;();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">processProperties</span><span class=\"params\">(ConfigurableListableBeanFactory beanFactoryToProcess, Properties props)</span> <span class=\"keyword\">throws</span> BeansException </span>&#123;</div><div class=\"line\">            <span class=\"comment\">// cache the properties</span></div><div class=\"line\">            PropertyPlaceholderHelper helper = <span class=\"keyword\">new</span> PropertyPlaceholderHelper(DEFAULT_PLACEHOLDER_PREFIX,DEFAULT_PLACEHOLDER_SUFFIX, DEFAULT_VALUE_SEPARATOR, <span class=\"keyword\">false</span>);</div><div class=\"line\">            <span class=\"keyword\">for</span> (Entry&lt;Object, Object&gt; entry : props.entrySet()) &#123;</div><div class=\"line\">                String stringKey = String.valueOf(entry.getKey());</div><div class=\"line\">                String stringValue = String.valueOf(entry.getValue());</div><div class=\"line\">                stringValue = helper.replacePlaceholders(stringValue, props);</div><div class=\"line\">                properties.put(stringKey, stringValue);</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">super</span>.processProperties(beanFactoryToProcess, props);</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Map&lt;String, String&gt; <span class=\"title\">getProperties</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> properties;</div><div class=\"line\">        &#125;</div><div class=\"line\">    </div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">getProperty</span><span class=\"params\">(String key)</span> </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> properties.get(key);</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>配置properties</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">site=iteye  </div><div class=\"line\">blog=antlove  </div><div class=\"line\">url=$&#123;site&#125;/$&#123;blog&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>Java获取</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//调用此方法获取value</span></div><div class=\"line\">CustomizedPropertyConfigurer.getContextProperty()</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"方法三：注解实现\"><a href=\"#方法三：注解实现\" class=\"headerlink\" title=\"方法三：注解实现\"></a>方法三：注解实现</h2><ul>\n<li><p>Spring配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"propertyConfigurer\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.hapishop.util.ProjectDBinfoConfigurer\"</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"locations\"</span>&gt;</span></div><div class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>classpath*:/META-INF/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>file:conf/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul>\n<li><p>注解获取</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;socket.time.out&#125;\"</span>)</div><div class=\"line\"><span class=\"keyword\">int</span> socketTimeout;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setSocketTimeout</span><span class=\"params\">(<span class=\"keyword\">int</span> socketTimeout)</span> </span>&#123;  </div><div class=\"line\">    <span class=\"keyword\">this</span>.socketTimeout = socketTimeout;  </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<pre><code>@Value写在要注入的属性上，要提供setter方法。\n</code></pre><h2 id=\"spring加载properties的两个类的区别\"><a href=\"#spring加载properties的两个类的区别\" class=\"headerlink\" title=\"spring加载properties的两个类的区别\"></a>spring加载properties的两个类的区别</h2><ul>\n<li>PropertiesFactoryBean是PropertiesLoaderSupport直接的实现类，专门用来管理properties文件的工厂bean，默认是单例的。</li>\n<li>PropertyPlaceholderConfigurer是解决properties文件占位符问题的，也实现了PropertiesLoaderSupport类。</li>\n</ul>\n<p>在java 代码里，一般是使用@Value注解来引用 properties 文件的属性。</p>\n<p>使用 PropertyPlaceholderConfigurer 时， @Value表达式的用法是 @Value(value=”${properties key}”) ，</p>\n<p>使用 PropertiesFactoryBean 时，我们还可以用@Value 读取 properties对象的值， @Value 用法 是 @Value(value=”#{configProperties[‘properties key’]}”)</p>\n","site":{"data":{}},"excerpt":"<p>将一些业务常量配置成properties文件，是扩展程序兼容性的常用做法。在业务变更导致数据需要改变时，不需要修改代码，只用更改配置文件并重启即可生效。</p>","more":"<h2 id=\"方法一：IO实现\"><a href=\"#方法一：IO实现\" class=\"headerlink\" title=\"方法一：IO实现\"></a>方法一：IO实现</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">getValue</span><span class=\"params\">(String fileNamePath, String key)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</div><div class=\"line\">    Properties props = <span class=\"keyword\">new</span> Properties();</div><div class=\"line\">    InputStream in = <span class=\"keyword\">null</span>;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        in = <span class=\"keyword\">new</span> FileInputStream(fileNamePath);</div><div class=\"line\">        <span class=\"comment\">//如果将in改为下面的方法，必须要将.Properties文件和此class类文件放在同一个包中    </span></div><div class=\"line\">        <span class=\"comment\">//in = propertiesTools.class.getResourceAsStream(fileNamePath); </span></div><div class=\"line\">        props.load(in);</div><div class=\"line\">        String value = props.getProperty(key);</div><div class=\"line\">        <span class=\"comment\">// 有乱码时要进行重新编码    </span></div><div class=\"line\">        <span class=\"comment\">// new String(props.getProperty(\"name\").getBytes(\"ISO-8859-1\"), \"GBK\");</span></div><div class=\"line\">        <span class=\"keyword\">return</span> value;</div><div class=\"line\">    &#125; <span class=\"keyword\">catch</span> (FileNotFoundException e) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> != in) &#123;</div><div class=\"line\">            in.close();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"方法二：spring实现\"><a href=\"#方法二：spring实现\" class=\"headerlink\" title=\"方法二：spring实现\"></a>方法二：spring实现</h2><p>在spring扫描配置文件时，将properties中的key和value放入一个map中。</p>\n<ol>\n<li><p>Spring配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"propertyConfigurer\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.hapishop.util.ProjectDBinfoConfigurer\"</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"locations\"</span>&gt;</span></div><div class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>classpath*:/META-INF/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>file:conf/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>自定义CustomizedPropertyConfigurer,继承<strong>PropertyPlaceholderConfigurer</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CustomizedPropertyConfigurer</span> <span class=\"keyword\">extends</span> <span class=\"title\">PropertyPlaceholderConfigurer</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Map&lt;String, String&gt; properties = <span class=\"keyword\">new</span> HashMap&lt;String, String&gt;();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">processProperties</span><span class=\"params\">(ConfigurableListableBeanFactory beanFactoryToProcess, Properties props)</span> <span class=\"keyword\">throws</span> BeansException </span>&#123;</div><div class=\"line\">            <span class=\"comment\">// cache the properties</span></div><div class=\"line\">            PropertyPlaceholderHelper helper = <span class=\"keyword\">new</span> PropertyPlaceholderHelper(DEFAULT_PLACEHOLDER_PREFIX,DEFAULT_PLACEHOLDER_SUFFIX, DEFAULT_VALUE_SEPARATOR, <span class=\"keyword\">false</span>);</div><div class=\"line\">            <span class=\"keyword\">for</span> (Entry&lt;Object, Object&gt; entry : props.entrySet()) &#123;</div><div class=\"line\">                String stringKey = String.valueOf(entry.getKey());</div><div class=\"line\">                String stringValue = String.valueOf(entry.getValue());</div><div class=\"line\">                stringValue = helper.replacePlaceholders(stringValue, props);</div><div class=\"line\">                properties.put(stringKey, stringValue);</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">super</span>.processProperties(beanFactoryToProcess, props);</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Map&lt;String, String&gt; <span class=\"title\">getProperties</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> properties;</div><div class=\"line\">        &#125;</div><div class=\"line\">    </div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">getProperty</span><span class=\"params\">(String key)</span> </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> properties.get(key);</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>配置properties</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">site=iteye  </div><div class=\"line\">blog=antlove  </div><div class=\"line\">url=$&#123;site&#125;/$&#123;blog&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>Java获取</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//调用此方法获取value</span></div><div class=\"line\">CustomizedPropertyConfigurer.getContextProperty()</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"方法三：注解实现\"><a href=\"#方法三：注解实现\" class=\"headerlink\" title=\"方法三：注解实现\"></a>方法三：注解实现</h2><ul>\n<li><p>Spring配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"propertyConfigurer\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.hapishop.util.ProjectDBinfoConfigurer\"</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"locations\"</span>&gt;</span></div><div class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>classpath*:/META-INF/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>file:conf/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul>\n<li><p>注解获取</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;socket.time.out&#125;\"</span>)</div><div class=\"line\"><span class=\"keyword\">int</span> socketTimeout;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setSocketTimeout</span><span class=\"params\">(<span class=\"keyword\">int</span> socketTimeout)</span> </span>&#123;  </div><div class=\"line\">    <span class=\"keyword\">this</span>.socketTimeout = socketTimeout;  </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<pre><code>@Value写在要注入的属性上，要提供setter方法。\n</code></pre><h2 id=\"spring加载properties的两个类的区别\"><a href=\"#spring加载properties的两个类的区别\" class=\"headerlink\" title=\"spring加载properties的两个类的区别\"></a>spring加载properties的两个类的区别</h2><ul>\n<li>PropertiesFactoryBean是PropertiesLoaderSupport直接的实现类，专门用来管理properties文件的工厂bean，默认是单例的。</li>\n<li>PropertyPlaceholderConfigurer是解决properties文件占位符问题的，也实现了PropertiesLoaderSupport类。</li>\n</ul>\n<p>在java 代码里，一般是使用@Value注解来引用 properties 文件的属性。</p>\n<p>使用 PropertyPlaceholderConfigurer 时， @Value表达式的用法是 @Value(value=”${properties key}”) ，</p>\n<p>使用 PropertiesFactoryBean 时，我们还可以用@Value 读取 properties对象的值， @Value 用法 是 @Value(value=”#{configProperties[‘properties key’]}”)</p>"},{"title":"Mybatis(1)——入门","date":"2018-02-27T03:15:13.000Z","_content":"MyBatis 本是apache的一个开源项目iBatis, 2010年这个项目由apache software foundation 迁移到了google code，并且改名为MyBatis，实质上Mybatis对ibatis进行一些改进。 \nMyBatis是一个优秀的持久层框架，它对jdbc的操作数据库的过程进行封装，使开发者只需要关注 SQL 本身，而不需要花费精力去处理例如注册驱动、创建connection、创建statement、手动设置参数、结果集检索等jdbc繁杂的过程代码。\nMybatis通过xml或注解的方式将要执行的各种statement（statement、preparedStatemnt、CallableStatement）配置起来，并通过java对象和statement中的sql进行映射生成最终执行的sql语句，最后由mybatis框架执行sql并将结果映射成java对象并返回。\n<!--more-->\n\n## 1、资源下载\n\nmybaits的代码由github.com管理，地址：https://github.com/mybatis/mybatis-3/releases\n要使用 MyBatis， 只需将 mybatis-x.x.x.jar 文件置于 classpath 中即可。\n\n如果使用 Maven 来构建项目，则需将下面的 dependency 代码置于 pom.xml 文件中：\n```xml\n<dependency>\n    <groupId>org.mybatis</groupId>\n    <artifactId>mybatis</artifactId>\n    <version>x.x.x</version>\n</dependency>\n```\n\n## 2、架构\n![mybatis原理图][1]\n\n 1. SqlMapConfig.xml\n    mybatis的全局配置文件，配置了运行环境等信息。mapper.xml即映射文件，里面配置了操作数据库的sql语句，该类文件需要在SqlMapConfig.xml中加载。\n 2. SqlSessionFactory\n    通过mybatis环境等配置信息构造SqlSessionFactory即会话工厂\n 3. SqlSession\n    由会话工厂创建sqlSession即会话，操作数据库需要通过sqlSession进行\n 4. Executor\n    mybatis底层自定义了Executor执行器接口操作数据库，Executor接口有两个实现，一个是基本执行器、一个是缓存执行器。\n 5. Mapper Statement\n    mybatis底层封装对象，它包装了mybatis配置信息及sql映射信息等。mapper.xml文件中一个sql对应一个Mapped Statement对象，sql的id即是Mapped statement的id。\n    Mapped Statement对sql执行输入参数进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql前将输入的java对象映射至sql中，输入参数映射就是jdbc编程中对preparedStatement设置参数。\n    Mapped Statement对sql执行输出结果进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql后将输出结果映射至java对象中，输出结果映射过程相当于jdbc编程中对结果的解析处理过程。\n\n## 3、特点\n![此处输入图片的描述][2]\n\n上边使用jdbc的原始方法（未经封装）实现了查询数据库表记录的操作。\n\n**JDBC编程问题总结：**\n1、\t数据库链接创建、释放频繁造成系统资源浪费从而影响系统性能，如果使用数据库链接池可解决此问题。\n<font color=\"red\">解决：在SqlMapConfig.xml中配置数据链接池，使用连接池管理数据库链接</font>\n2、\tSql语句在代码中硬编码，造成代码不易维护，实际应用sql变化的可能较大，sql变动需要改变java代码。\n<font color=\"red\">解决：将Sql语句配置在XXXXmapper.xml文件中与java代码分离。</font>\n3、\t使用preparedStatement向占有位符号传参数存在硬编码，因为sql语句的where条件不一定，可能多也可能少，修改sql还要修改代码，系统不易维护。\n<font color=\"red\">解决：Mybatis自动将java对象映射至sql语句，通过statement中的parameterType定义输入参数的类型。</font>\n4、\t对结果集解析存在硬编码（查询列名），sql变化导致解析代码变化，系统不易维护，如果能将数据库记录封装成pojo对象解析比较方便。\n<font color=\"red\">解决：Mybatis自动将sql执行结果映射至java对象，通过statement中的resultType定义输出结果的类型。</font>\n\n\n## 4、入门程序搭建\n\n需求:查询图书id查询图书信息\n\n创建数据库，新建book表：\n```sql\nCREATE TABLE `book` (\n  `book_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '图书ID',\n  `name` varchar(100) NOT NULL COMMENT '图书名称',\n  `number` int(11) NOT NULL COMMENT '馆藏数量',\n  PRIMARY KEY (`book_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=1004 DEFAULT CHARSET=utf8 COMMENT='图书表'\n\nINSERT INTO `book` VALUES ('1000', 'Java程序设计', '10');\nINSERT INTO `book` VALUES ('1001', '数据结构', '10');\nINSERT INTO `book` VALUES ('1002', '设计模式', '10');\nINSERT INTO `book` VALUES ('1003', '编译原理', '10');\n```\n\n### 4.1、maven创建java工程\n省略\n\n### 4.2、引入依赖\n加入mybatis核心包、依赖包、数据驱动包。完整的pom配置如下：\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\n\t<groupId>com.topvision.maven</groupId>\n\t<artifactId>mybatis</artifactId>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<packaging>jar</packaging>\n\n\t<name>mybatis</name>\n\t<url>http://maven.apache.org</url>\n\n\t<properties>\n\t\t<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n\t\t<mybatis.version>3.4.5</mybatis.version>\n\t</properties>\n\n\t<dependencyManagement>\n\t\t<dependencies>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t\t<artifactId>mybatis</artifactId>\n\t\t\t\t<version>${mybatis.version}</version>\n\t\t\t</dependency>\n\t\t</dependencies>\n\t</dependencyManagement>\n\n\t<dependencies>\n\t\t<!-- mybatis -->\n\t\t<dependency>\n\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t<artifactId>mybatis</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t<artifactId>mybatis-spring</artifactId>\n\t\t\t<version>1.3.1</version>\n\t\t</dependency>\n\n\t\t<!-- mysql驱动 -->\n\t\t<dependency>\n\t\t\t<groupId>mysql</groupId>\n\t\t\t<artifactId>mysql-connector-java</artifactId>\n\t\t\t<version>5.1.6</version>\n\t\t\t<scope>runtime</scope>\n\t\t</dependency>\n\n\t\t<!-- c3p0 -->\n\t\t<dependency>\n\t\t\t<groupId>c3p0</groupId>\n\t\t\t<artifactId>c3p0</artifactId>\n\t\t\t<version>0.9.1.2</version>\n\t\t</dependency>\n\t\t<!-- slf4j -->\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-api</artifactId>\n\t\t\t<version>1.7.5</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-log4j12</artifactId>\n\t\t\t<version>1.7.12</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>log4j</groupId>\n\t\t\t<artifactId>log4j</artifactId>\n\t\t\t<version>1.2.17</version>\n\t\t</dependency>\n\t\t<!-- junit -->\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>4.9</version>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t</dependencies>\n\n\t<build>\n\t\t<plugins>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n\t\t\t\t<artifactId>maven-compiler-plugin</artifactId>\n\t\t\t\t<configuration>\n\t\t\t\t\t<source>1.8</source>\n\t\t\t\t\t<target>1.8</target>\n\t\t\t\t\t<encoding>UTF-8</encoding>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t</plugins>\n\n\t\t<finalName>mybatis</finalName>\n\t</build>\n</project>\n```\n\n### 4.3、log4j.properties\n\n在classpath下加入日志配置：\n```properties\n#定义LOG输出级别  \nlog4j.rootLogger=DEBUG,Console,File  \n#定义日志输出目的地为控制台  \nlog4j.appender.Console=org.apache.log4j.ConsoleAppender  \nlog4j.appender.Console.Target=System.out  \n#可以灵活地指定日志输出格式，下面一行是指定具体的格式  \nlog4j.appender.Console.layout = org.apache.log4j.PatternLayout  \nlog4j.appender.Console.layout.ConversionPattern=[%c] - %m%n  \n  \n#文件大小到达指定尺寸的时候产生一个新的文件  \nlog4j.appender.File = org.apache.log4j.RollingFileAppender  \n#指定输出目录  \nlog4j.appender.File.File = logs/ssm.log\n#定义文件最大大小  \nlog4j.appender.File.MaxFileSize = 10MB  \n#输出所有日志，如果换成DEBUG表示输出DEBUG以上级别日志  \nlog4j.appender.File.Threshold = ALL  \nlog4j.appender.File.layout = org.apache.log4j.PatternLayout  \nlog4j.appender.File.layout.ConversionPattern =[%p] [%d{yyyy-MM-dd HH\\:mm\\:ss}][%c]%m%n \n```\n\n### 4.4、jdbc.properties\n\n在classpath下新建数据库连接文件。\n\n```properties\njdbc.driverClass\t= com.mysql.jdbc.Driver\njdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb?characterEncoding=utf-8\njdbc.username\t\t= root\njdbc.password\t\t= 123\n```\n\n### 4.4、SqlMapConfig.xml\n\n在classpath下新建SqlMapConfig.xml文件，配置mybatis运行环境。\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE configuration\nPUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"\n\"http://mybatis.org/dtd/mybatis-3-config.dtd\">\n<configuration>\n\t<properties resource=\"jdbc.properties\"/>\n\t\n\t<!-- 和spring整合后 environments配置将废除 -->\n\t<environments default=\"development\">\n\t\t<environment id=\"development\">\n\t\t\t<!-- 使用jdbc事务管理 -->\n\t\t\t<transactionManager type=\"JDBC\" />\n\t\t\t<!-- 数据库连接池 -->\n\t\t\t<dataSource type=\"POOLED\">\n\t\t\t\t<property name=\"driver\" value=\"${jdbc.driverClass}\" />\n                <property name=\"url\" value=\"${jdbc.url}\" />\n\t\t\t\t<property name=\"username\" value=\"${jdbc.username}\" />\n                <property name=\"password\" value=\"${jdbc.password}\" />\n\t\t\t</dataSource>\n\t\t</environment>\n\t</environments>\n\t\n</configuration>\n```\nSqlMapConfig.xml是mybatis核心配置文件，上边文件的配置内容为数据源、事务管理。\n\n### 4.5、编写Po类\n\nPo类作为mybatis进行sql映射使用，po类通常与数据库表对应，Book.java如下:\n```java\npublic class Book {\n\n    private long bookId;// 图书ID\n    private String name;// 图书名称\n    private int number;// 馆藏数量\n    ...\n```\n\n### 4.6、编写映射文件（sql）\n在classpath下的sqlmap目录下创建sql映射文件Book.xml：\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE mapper\nPUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n\n<mapper namespace=\"test\">\n\t<select id=\"queryById\" parameterType=\"long\" resultType=\"com.topvision.maven.mybatis.domain.Book\">\n\t\tselect book_id bookId,name,number from book where book_id = #{id}\n\t</select>\n</mapper>\n```\n\nnamespace ：命名空间，用于隔离sql语句，后面会讲另一层非常重要的作用。\nparameterType：定义输入到sql中的映射类型，#{id}表示使用preparedstatement设置占位符号并将输入变量id传到sql。\nresultType：定义结果映射类型。\n\n### 4.7、加载映射文件\n\n在SqlMapConfig.xml中加载映射文件Book.xml\n\n```xml\n<mappers>\n    <mapper resource=\"sqlmap/Book.xml\"/>\n</mappers>\n```\n\n### 4.8、测试\n\n```java\npublic class BookDaoTest {\n    private SqlSessionFactory sqlSessionFactory;\n    \n    @Before\n    public void createSqlSessionFactory() throws IOException{\n        String resource = \"sqlMapConfig.xml\";\n        InputStream inputStream = Resources.getResourceAsStream(resource);\n        \n        sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);\n    }\n\n    @Test\n    public void testQueryById() {\n        SqlSession sqlSession = null;\n        try {\n            sqlSession = sqlSessionFactory.openSession();\n            Book book = sqlSession.selectOne(\"test.queryById\",1000l);\n            System.out.println(book);\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            if (sqlSession != null) {\n                sqlSession.close();\n            }\n        }\n    }\n}\n```\n\n至此，若能查询出结果，则工程搭建成功。\n\n\n\n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/mybatis/framework.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/mybatis/jdbcProgram.png","source":"_posts/Mybatis-1-——入门.md","raw":"---\ntitle: Mybatis(1)——入门\ncategories:\n  - Mybatis\ntags:\n  - Mybatis\ndate: 2018-02-27 11:15:13\n---\nMyBatis 本是apache的一个开源项目iBatis, 2010年这个项目由apache software foundation 迁移到了google code，并且改名为MyBatis，实质上Mybatis对ibatis进行一些改进。 \nMyBatis是一个优秀的持久层框架，它对jdbc的操作数据库的过程进行封装，使开发者只需要关注 SQL 本身，而不需要花费精力去处理例如注册驱动、创建connection、创建statement、手动设置参数、结果集检索等jdbc繁杂的过程代码。\nMybatis通过xml或注解的方式将要执行的各种statement（statement、preparedStatemnt、CallableStatement）配置起来，并通过java对象和statement中的sql进行映射生成最终执行的sql语句，最后由mybatis框架执行sql并将结果映射成java对象并返回。\n<!--more-->\n\n## 1、资源下载\n\nmybaits的代码由github.com管理，地址：https://github.com/mybatis/mybatis-3/releases\n要使用 MyBatis， 只需将 mybatis-x.x.x.jar 文件置于 classpath 中即可。\n\n如果使用 Maven 来构建项目，则需将下面的 dependency 代码置于 pom.xml 文件中：\n```xml\n<dependency>\n    <groupId>org.mybatis</groupId>\n    <artifactId>mybatis</artifactId>\n    <version>x.x.x</version>\n</dependency>\n```\n\n## 2、架构\n![mybatis原理图][1]\n\n 1. SqlMapConfig.xml\n    mybatis的全局配置文件，配置了运行环境等信息。mapper.xml即映射文件，里面配置了操作数据库的sql语句，该类文件需要在SqlMapConfig.xml中加载。\n 2. SqlSessionFactory\n    通过mybatis环境等配置信息构造SqlSessionFactory即会话工厂\n 3. SqlSession\n    由会话工厂创建sqlSession即会话，操作数据库需要通过sqlSession进行\n 4. Executor\n    mybatis底层自定义了Executor执行器接口操作数据库，Executor接口有两个实现，一个是基本执行器、一个是缓存执行器。\n 5. Mapper Statement\n    mybatis底层封装对象，它包装了mybatis配置信息及sql映射信息等。mapper.xml文件中一个sql对应一个Mapped Statement对象，sql的id即是Mapped statement的id。\n    Mapped Statement对sql执行输入参数进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql前将输入的java对象映射至sql中，输入参数映射就是jdbc编程中对preparedStatement设置参数。\n    Mapped Statement对sql执行输出结果进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql后将输出结果映射至java对象中，输出结果映射过程相当于jdbc编程中对结果的解析处理过程。\n\n## 3、特点\n![此处输入图片的描述][2]\n\n上边使用jdbc的原始方法（未经封装）实现了查询数据库表记录的操作。\n\n**JDBC编程问题总结：**\n1、\t数据库链接创建、释放频繁造成系统资源浪费从而影响系统性能，如果使用数据库链接池可解决此问题。\n<font color=\"red\">解决：在SqlMapConfig.xml中配置数据链接池，使用连接池管理数据库链接</font>\n2、\tSql语句在代码中硬编码，造成代码不易维护，实际应用sql变化的可能较大，sql变动需要改变java代码。\n<font color=\"red\">解决：将Sql语句配置在XXXXmapper.xml文件中与java代码分离。</font>\n3、\t使用preparedStatement向占有位符号传参数存在硬编码，因为sql语句的where条件不一定，可能多也可能少，修改sql还要修改代码，系统不易维护。\n<font color=\"red\">解决：Mybatis自动将java对象映射至sql语句，通过statement中的parameterType定义输入参数的类型。</font>\n4、\t对结果集解析存在硬编码（查询列名），sql变化导致解析代码变化，系统不易维护，如果能将数据库记录封装成pojo对象解析比较方便。\n<font color=\"red\">解决：Mybatis自动将sql执行结果映射至java对象，通过statement中的resultType定义输出结果的类型。</font>\n\n\n## 4、入门程序搭建\n\n需求:查询图书id查询图书信息\n\n创建数据库，新建book表：\n```sql\nCREATE TABLE `book` (\n  `book_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '图书ID',\n  `name` varchar(100) NOT NULL COMMENT '图书名称',\n  `number` int(11) NOT NULL COMMENT '馆藏数量',\n  PRIMARY KEY (`book_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=1004 DEFAULT CHARSET=utf8 COMMENT='图书表'\n\nINSERT INTO `book` VALUES ('1000', 'Java程序设计', '10');\nINSERT INTO `book` VALUES ('1001', '数据结构', '10');\nINSERT INTO `book` VALUES ('1002', '设计模式', '10');\nINSERT INTO `book` VALUES ('1003', '编译原理', '10');\n```\n\n### 4.1、maven创建java工程\n省略\n\n### 4.2、引入依赖\n加入mybatis核心包、依赖包、数据驱动包。完整的pom配置如下：\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\n\t<groupId>com.topvision.maven</groupId>\n\t<artifactId>mybatis</artifactId>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<packaging>jar</packaging>\n\n\t<name>mybatis</name>\n\t<url>http://maven.apache.org</url>\n\n\t<properties>\n\t\t<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n\t\t<mybatis.version>3.4.5</mybatis.version>\n\t</properties>\n\n\t<dependencyManagement>\n\t\t<dependencies>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t\t<artifactId>mybatis</artifactId>\n\t\t\t\t<version>${mybatis.version}</version>\n\t\t\t</dependency>\n\t\t</dependencies>\n\t</dependencyManagement>\n\n\t<dependencies>\n\t\t<!-- mybatis -->\n\t\t<dependency>\n\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t<artifactId>mybatis</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t<artifactId>mybatis-spring</artifactId>\n\t\t\t<version>1.3.1</version>\n\t\t</dependency>\n\n\t\t<!-- mysql驱动 -->\n\t\t<dependency>\n\t\t\t<groupId>mysql</groupId>\n\t\t\t<artifactId>mysql-connector-java</artifactId>\n\t\t\t<version>5.1.6</version>\n\t\t\t<scope>runtime</scope>\n\t\t</dependency>\n\n\t\t<!-- c3p0 -->\n\t\t<dependency>\n\t\t\t<groupId>c3p0</groupId>\n\t\t\t<artifactId>c3p0</artifactId>\n\t\t\t<version>0.9.1.2</version>\n\t\t</dependency>\n\t\t<!-- slf4j -->\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-api</artifactId>\n\t\t\t<version>1.7.5</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-log4j12</artifactId>\n\t\t\t<version>1.7.12</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>log4j</groupId>\n\t\t\t<artifactId>log4j</artifactId>\n\t\t\t<version>1.2.17</version>\n\t\t</dependency>\n\t\t<!-- junit -->\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>4.9</version>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t</dependencies>\n\n\t<build>\n\t\t<plugins>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n\t\t\t\t<artifactId>maven-compiler-plugin</artifactId>\n\t\t\t\t<configuration>\n\t\t\t\t\t<source>1.8</source>\n\t\t\t\t\t<target>1.8</target>\n\t\t\t\t\t<encoding>UTF-8</encoding>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t</plugins>\n\n\t\t<finalName>mybatis</finalName>\n\t</build>\n</project>\n```\n\n### 4.3、log4j.properties\n\n在classpath下加入日志配置：\n```properties\n#定义LOG输出级别  \nlog4j.rootLogger=DEBUG,Console,File  \n#定义日志输出目的地为控制台  \nlog4j.appender.Console=org.apache.log4j.ConsoleAppender  \nlog4j.appender.Console.Target=System.out  \n#可以灵活地指定日志输出格式，下面一行是指定具体的格式  \nlog4j.appender.Console.layout = org.apache.log4j.PatternLayout  \nlog4j.appender.Console.layout.ConversionPattern=[%c] - %m%n  \n  \n#文件大小到达指定尺寸的时候产生一个新的文件  \nlog4j.appender.File = org.apache.log4j.RollingFileAppender  \n#指定输出目录  \nlog4j.appender.File.File = logs/ssm.log\n#定义文件最大大小  \nlog4j.appender.File.MaxFileSize = 10MB  \n#输出所有日志，如果换成DEBUG表示输出DEBUG以上级别日志  \nlog4j.appender.File.Threshold = ALL  \nlog4j.appender.File.layout = org.apache.log4j.PatternLayout  \nlog4j.appender.File.layout.ConversionPattern =[%p] [%d{yyyy-MM-dd HH\\:mm\\:ss}][%c]%m%n \n```\n\n### 4.4、jdbc.properties\n\n在classpath下新建数据库连接文件。\n\n```properties\njdbc.driverClass\t= com.mysql.jdbc.Driver\njdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb?characterEncoding=utf-8\njdbc.username\t\t= root\njdbc.password\t\t= 123\n```\n\n### 4.4、SqlMapConfig.xml\n\n在classpath下新建SqlMapConfig.xml文件，配置mybatis运行环境。\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE configuration\nPUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"\n\"http://mybatis.org/dtd/mybatis-3-config.dtd\">\n<configuration>\n\t<properties resource=\"jdbc.properties\"/>\n\t\n\t<!-- 和spring整合后 environments配置将废除 -->\n\t<environments default=\"development\">\n\t\t<environment id=\"development\">\n\t\t\t<!-- 使用jdbc事务管理 -->\n\t\t\t<transactionManager type=\"JDBC\" />\n\t\t\t<!-- 数据库连接池 -->\n\t\t\t<dataSource type=\"POOLED\">\n\t\t\t\t<property name=\"driver\" value=\"${jdbc.driverClass}\" />\n                <property name=\"url\" value=\"${jdbc.url}\" />\n\t\t\t\t<property name=\"username\" value=\"${jdbc.username}\" />\n                <property name=\"password\" value=\"${jdbc.password}\" />\n\t\t\t</dataSource>\n\t\t</environment>\n\t</environments>\n\t\n</configuration>\n```\nSqlMapConfig.xml是mybatis核心配置文件，上边文件的配置内容为数据源、事务管理。\n\n### 4.5、编写Po类\n\nPo类作为mybatis进行sql映射使用，po类通常与数据库表对应，Book.java如下:\n```java\npublic class Book {\n\n    private long bookId;// 图书ID\n    private String name;// 图书名称\n    private int number;// 馆藏数量\n    ...\n```\n\n### 4.6、编写映射文件（sql）\n在classpath下的sqlmap目录下创建sql映射文件Book.xml：\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE mapper\nPUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n\n<mapper namespace=\"test\">\n\t<select id=\"queryById\" parameterType=\"long\" resultType=\"com.topvision.maven.mybatis.domain.Book\">\n\t\tselect book_id bookId,name,number from book where book_id = #{id}\n\t</select>\n</mapper>\n```\n\nnamespace ：命名空间，用于隔离sql语句，后面会讲另一层非常重要的作用。\nparameterType：定义输入到sql中的映射类型，#{id}表示使用preparedstatement设置占位符号并将输入变量id传到sql。\nresultType：定义结果映射类型。\n\n### 4.7、加载映射文件\n\n在SqlMapConfig.xml中加载映射文件Book.xml\n\n```xml\n<mappers>\n    <mapper resource=\"sqlmap/Book.xml\"/>\n</mappers>\n```\n\n### 4.8、测试\n\n```java\npublic class BookDaoTest {\n    private SqlSessionFactory sqlSessionFactory;\n    \n    @Before\n    public void createSqlSessionFactory() throws IOException{\n        String resource = \"sqlMapConfig.xml\";\n        InputStream inputStream = Resources.getResourceAsStream(resource);\n        \n        sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);\n    }\n\n    @Test\n    public void testQueryById() {\n        SqlSession sqlSession = null;\n        try {\n            sqlSession = sqlSessionFactory.openSession();\n            Book book = sqlSession.selectOne(\"test.queryById\",1000l);\n            System.out.println(book);\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            if (sqlSession != null) {\n                sqlSession.close();\n            }\n        }\n    }\n}\n```\n\n至此，若能查询出结果，则工程搭建成功。\n\n\n\n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/mybatis/framework.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/mybatis/jdbcProgram.png","slug":"Mybatis-1-——入门","published":1,"updated":"2018-02-27T07:38:38.086Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspee000an8vfvhbmu3qm","content":"<p>MyBatis 本是apache的一个开源项目iBatis, 2010年这个项目由apache software foundation 迁移到了google code，并且改名为MyBatis，实质上Mybatis对ibatis进行一些改进。<br>MyBatis是一个优秀的持久层框架，它对jdbc的操作数据库的过程进行封装，使开发者只需要关注 SQL 本身，而不需要花费精力去处理例如注册驱动、创建connection、创建statement、手动设置参数、结果集检索等jdbc繁杂的过程代码。<br>Mybatis通过xml或注解的方式将要执行的各种statement（statement、preparedStatemnt、CallableStatement）配置起来，并通过java对象和statement中的sql进行映射生成最终执行的sql语句，最后由mybatis框架执行sql并将结果映射成java对象并返回。<br><a id=\"more\"></a></p>\n<h2 id=\"1、资源下载\"><a href=\"#1、资源下载\" class=\"headerlink\" title=\"1、资源下载\"></a>1、资源下载</h2><p>mybaits的代码由github.com管理，地址：<a href=\"https://github.com/mybatis/mybatis-3/releases\" target=\"_blank\" rel=\"noopener\">https://github.com/mybatis/mybatis-3/releases</a><br>要使用 MyBatis， 只需将 mybatis-x.x.x.jar 文件置于 classpath 中即可。</p>\n<p>如果使用 Maven 来构建项目，则需将下面的 dependency 代码置于 pom.xml 文件中：<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>x.x.x<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<h2 id=\"2、架构\"><a href=\"#2、架构\" class=\"headerlink\" title=\"2、架构\"></a>2、架构</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/mybatis/framework.png\" alt=\"mybatis原理图\"></p>\n<ol>\n<li>SqlMapConfig.xml<br>mybatis的全局配置文件，配置了运行环境等信息。mapper.xml即映射文件，里面配置了操作数据库的sql语句，该类文件需要在SqlMapConfig.xml中加载。</li>\n<li>SqlSessionFactory<br>通过mybatis环境等配置信息构造SqlSessionFactory即会话工厂</li>\n<li>SqlSession<br>由会话工厂创建sqlSession即会话，操作数据库需要通过sqlSession进行</li>\n<li>Executor<br>mybatis底层自定义了Executor执行器接口操作数据库，Executor接口有两个实现，一个是基本执行器、一个是缓存执行器。</li>\n<li>Mapper Statement<br>mybatis底层封装对象，它包装了mybatis配置信息及sql映射信息等。mapper.xml文件中一个sql对应一个Mapped Statement对象，sql的id即是Mapped statement的id。<br>Mapped Statement对sql执行输入参数进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql前将输入的java对象映射至sql中，输入参数映射就是jdbc编程中对preparedStatement设置参数。<br>Mapped Statement对sql执行输出结果进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql后将输出结果映射至java对象中，输出结果映射过程相当于jdbc编程中对结果的解析处理过程。</li>\n</ol>\n<h2 id=\"3、特点\"><a href=\"#3、特点\" class=\"headerlink\" title=\"3、特点\"></a>3、特点</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/mybatis/jdbcProgram.png\" alt=\"此处输入图片的描述\"></p>\n<p>上边使用jdbc的原始方法（未经封装）实现了查询数据库表记录的操作。</p>\n<p><strong>JDBC编程问题总结：</strong><br>1、    数据库链接创建、释放频繁造成系统资源浪费从而影响系统性能，如果使用数据库链接池可解决此问题。</p>\n<font color=\"red\">解决：在SqlMapConfig.xml中配置数据链接池，使用连接池管理数据库链接</font><br>2、    Sql语句在代码中硬编码，造成代码不易维护，实际应用sql变化的可能较大，sql变动需要改变java代码。<br><font color=\"red\">解决：将Sql语句配置在XXXXmapper.xml文件中与java代码分离。</font><br>3、    使用preparedStatement向占有位符号传参数存在硬编码，因为sql语句的where条件不一定，可能多也可能少，修改sql还要修改代码，系统不易维护。<br><font color=\"red\">解决：Mybatis自动将java对象映射至sql语句，通过statement中的parameterType定义输入参数的类型。</font><br>4、    对结果集解析存在硬编码（查询列名），sql变化导致解析代码变化，系统不易维护，如果能将数据库记录封装成pojo对象解析比较方便。<br><font color=\"red\">解决：Mybatis自动将sql执行结果映射至java对象，通过statement中的resultType定义输出结果的类型。</font>\n\n\n<h2 id=\"4、入门程序搭建\"><a href=\"#4、入门程序搭建\" class=\"headerlink\" title=\"4、入门程序搭建\"></a>4、入门程序搭建</h2><p>需求:查询图书id查询图书信息</p>\n<p>创建数据库，新建book表：<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"string\">`book`</span> (</div><div class=\"line\">  <span class=\"string\">`book_id`</span> <span class=\"built_in\">bigint</span>(<span class=\"number\">20</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> AUTO_INCREMENT <span class=\"keyword\">COMMENT</span> <span class=\"string\">'图书ID'</span>,</div><div class=\"line\">  <span class=\"string\">`name`</span> <span class=\"built_in\">varchar</span>(<span class=\"number\">100</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> <span class=\"keyword\">COMMENT</span> <span class=\"string\">'图书名称'</span>,</div><div class=\"line\">  <span class=\"string\">`number`</span> <span class=\"built_in\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> <span class=\"keyword\">COMMENT</span> <span class=\"string\">'馆藏数量'</span>,</div><div class=\"line\">  PRIMARY <span class=\"keyword\">KEY</span> (<span class=\"string\">`book_id`</span>)</div><div class=\"line\">) <span class=\"keyword\">ENGINE</span>=<span class=\"keyword\">InnoDB</span> AUTO_INCREMENT=<span class=\"number\">1004</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">CHARSET</span>=utf8 <span class=\"keyword\">COMMENT</span>=<span class=\"string\">'图书表'</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`book`</span> <span class=\"keyword\">VALUES</span> (<span class=\"string\">'1000'</span>, <span class=\"string\">'Java程序设计'</span>, <span class=\"string\">'10'</span>);</div><div class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`book`</span> <span class=\"keyword\">VALUES</span> (<span class=\"string\">'1001'</span>, <span class=\"string\">'数据结构'</span>, <span class=\"string\">'10'</span>);</div><div class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`book`</span> <span class=\"keyword\">VALUES</span> (<span class=\"string\">'1002'</span>, <span class=\"string\">'设计模式'</span>, <span class=\"string\">'10'</span>);</div><div class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`book`</span> <span class=\"keyword\">VALUES</span> (<span class=\"string\">'1003'</span>, <span class=\"string\">'编译原理'</span>, <span class=\"string\">'10'</span>);</div></pre></td></tr></table></figure></p>\n<h3 id=\"4-1、maven创建java工程\"><a href=\"#4-1、maven创建java工程\" class=\"headerlink\" title=\"4.1、maven创建java工程\"></a>4.1、maven创建java工程</h3><p>省略</p>\n<h3 id=\"4-2、引入依赖\"><a href=\"#4-2、引入依赖\" class=\"headerlink\" title=\"4.2、引入依赖\"></a>4.2、引入依赖</h3><p>加入mybatis核心包、依赖包、数据驱动包。完整的pom配置如下：<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.topvision.maven<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.apache.org<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">mybatis.version</span>&gt;</span>3.4.5<span class=\"tag\">&lt;/<span class=\"name\">mybatis.version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mybatis --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-spring<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mysql驱动 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- c3p0 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- slf4j --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-log4j12<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.17<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- junit --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.9<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">encoding</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<h3 id=\"4-3、log4j-properties\"><a href=\"#4-3、log4j-properties\" class=\"headerlink\" title=\"4.3、log4j.properties\"></a>4.3、log4j.properties</h3><p>在classpath下加入日志配置：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\">#定义LOG输出级别  </div><div class=\"line\">log4j.rootLogger=DEBUG,Console,File  </div><div class=\"line\">#定义日志输出目的地为控制台  </div><div class=\"line\">log4j.appender.Console=org.apache.log4j.ConsoleAppender  </div><div class=\"line\">log4j.appender.Console.Target=System.out  </div><div class=\"line\">#可以灵活地指定日志输出格式，下面一行是指定具体的格式  </div><div class=\"line\">log4j.appender.Console.layout = org.apache.log4j.PatternLayout  </div><div class=\"line\">log4j.appender.Console.layout.ConversionPattern=[%c] - %m%n  </div><div class=\"line\">  </div><div class=\"line\">#文件大小到达指定尺寸的时候产生一个新的文件  </div><div class=\"line\">log4j.appender.File = org.apache.log4j.RollingFileAppender  </div><div class=\"line\">#指定输出目录  </div><div class=\"line\">log4j.appender.File.File = logs/ssm.log</div><div class=\"line\">#定义文件最大大小  </div><div class=\"line\">log4j.appender.File.MaxFileSize = 10MB  </div><div class=\"line\">#输出所有日志，如果换成DEBUG表示输出DEBUG以上级别日志  </div><div class=\"line\">log4j.appender.File.Threshold = ALL  </div><div class=\"line\">log4j.appender.File.layout = org.apache.log4j.PatternLayout  </div><div class=\"line\">log4j.appender.File.layout.ConversionPattern =[%p] [%d&#123;yyyy-MM-dd HH\\:mm\\:ss&#125;][%c]%m%n</div></pre></td></tr></table></figure></p>\n<h3 id=\"4-4、jdbc-properties\"><a href=\"#4-4、jdbc-properties\" class=\"headerlink\" title=\"4.4、jdbc.properties\"></a>4.4、jdbc.properties</h3><p>在classpath下新建数据库连接文件。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">jdbc.driverClass\t= com.mysql.jdbc.Driver</div><div class=\"line\">jdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb?characterEncoding=utf-8</div><div class=\"line\">jdbc.username\t\t= root</div><div class=\"line\">jdbc.password\t\t= 123</div></pre></td></tr></table></figure>\n<h3 id=\"4-4、SqlMapConfig-xml\"><a href=\"#4-4、SqlMapConfig-xml\" class=\"headerlink\" title=\"4.4、SqlMapConfig.xml\"></a>4.4、SqlMapConfig.xml</h3><p>在classpath下新建SqlMapConfig.xml文件，配置mybatis运行环境。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE configuration</span></div><div class=\"line\">PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"</div><div class=\"line\">\"http://mybatis.org/dtd/mybatis-3-config.dtd\"&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">properties</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"jdbc.properties\"</span>/&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 和spring整合后 environments配置将废除 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">environments</span> <span class=\"attr\">default</span>=<span class=\"string\">\"development\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">environment</span> <span class=\"attr\">id</span>=<span class=\"string\">\"development\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 使用jdbc事务管理 --&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">transactionManager</span> <span class=\"attr\">type</span>=<span class=\"string\">\"JDBC\"</span> /&gt;</span></div><div class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 数据库连接池 --&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dataSource</span> <span class=\"attr\">type</span>=<span class=\"string\">\"POOLED\"</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.driverClass&#125;\"</span> /&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.url&#125;\"</span> /&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.username&#125;\"</span> /&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.password&#125;\"</span> /&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dataSource</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">environment</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">environments</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>SqlMapConfig.xml是mybatis核心配置文件，上边文件的配置内容为数据源、事务管理。</p>\n<h3 id=\"4-5、编写Po类\"><a href=\"#4-5、编写Po类\" class=\"headerlink\" title=\"4.5、编写Po类\"></a>4.5、编写Po类</h3><p>Po类作为mybatis进行sql映射使用，po类通常与数据库表对应，Book.java如下:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Book</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> bookId;<span class=\"comment\">// 图书ID</span></div><div class=\"line\">    <span class=\"keyword\">private</span> String name;<span class=\"comment\">// 图书名称</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> number;<span class=\"comment\">// 馆藏数量</span></div><div class=\"line\">    ...</div></pre></td></tr></table></figure></p>\n<h3 id=\"4-6、编写映射文件（sql）\"><a href=\"#4-6、编写映射文件（sql）\" class=\"headerlink\" title=\"4.6、编写映射文件（sql）\"></a>4.6、编写映射文件（sql）</h3><p>在classpath下的sqlmap目录下创建sql映射文件Book.xml：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE mapper</span></div><div class=\"line\">PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"</div><div class=\"line\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"test\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"queryById\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"long\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"com.topvision.maven.mybatis.domain.Book\"</span>&gt;</span></div><div class=\"line\">\t\tselect book_id bookId,name,number from book where book_id = #&#123;id&#125;</div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>namespace ：命名空间，用于隔离sql语句，后面会讲另一层非常重要的作用。<br>parameterType：定义输入到sql中的映射类型，#{id}表示使用preparedstatement设置占位符号并将输入变量id传到sql。<br>resultType：定义结果映射类型。</p>\n<h3 id=\"4-7、加载映射文件\"><a href=\"#4-7、加载映射文件\" class=\"headerlink\" title=\"4.7、加载映射文件\"></a>4.7、加载映射文件</h3><p>在SqlMapConfig.xml中加载映射文件Book.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mappers</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"sqlmap/Book.xml\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mappers</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"4-8、测试\"><a href=\"#4-8、测试\" class=\"headerlink\" title=\"4.8、测试\"></a>4.8、测试</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BookDaoTest</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> SqlSessionFactory sqlSessionFactory;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"meta\">@Before</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createSqlSessionFactory</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException</span>&#123;</div><div class=\"line\">        String resource = <span class=\"string\">\"sqlMapConfig.xml\"</span>;</div><div class=\"line\">        InputStream inputStream = Resources.getResourceAsStream(resource);</div><div class=\"line\">        </div><div class=\"line\">        sqlSessionFactory = <span class=\"keyword\">new</span> SqlSessionFactoryBuilder().build(inputStream);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testQueryById</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        SqlSession sqlSession = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            sqlSession = sqlSessionFactory.openSession();</div><div class=\"line\">            Book book = sqlSession.selectOne(<span class=\"string\">\"test.queryById\"</span>,<span class=\"number\">1000l</span>);</div><div class=\"line\">            System.out.println(book);</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">if</span> (sqlSession != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">                sqlSession.close();</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>至此，若能查询出结果，则工程搭建成功。</p>\n","site":{"data":{}},"excerpt":"<p>MyBatis 本是apache的一个开源项目iBatis, 2010年这个项目由apache software foundation 迁移到了google code，并且改名为MyBatis，实质上Mybatis对ibatis进行一些改进。<br>MyBatis是一个优秀的持久层框架，它对jdbc的操作数据库的过程进行封装，使开发者只需要关注 SQL 本身，而不需要花费精力去处理例如注册驱动、创建connection、创建statement、手动设置参数、结果集检索等jdbc繁杂的过程代码。<br>Mybatis通过xml或注解的方式将要执行的各种statement（statement、preparedStatemnt、CallableStatement）配置起来，并通过java对象和statement中的sql进行映射生成最终执行的sql语句，最后由mybatis框架执行sql并将结果映射成java对象并返回。<br>","more":"</p>\n<h2 id=\"1、资源下载\"><a href=\"#1、资源下载\" class=\"headerlink\" title=\"1、资源下载\"></a>1、资源下载</h2><p>mybaits的代码由github.com管理，地址：<a href=\"https://github.com/mybatis/mybatis-3/releases\" target=\"_blank\" rel=\"noopener\">https://github.com/mybatis/mybatis-3/releases</a><br>要使用 MyBatis， 只需将 mybatis-x.x.x.jar 文件置于 classpath 中即可。</p>\n<p>如果使用 Maven 来构建项目，则需将下面的 dependency 代码置于 pom.xml 文件中：<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>x.x.x<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<h2 id=\"2、架构\"><a href=\"#2、架构\" class=\"headerlink\" title=\"2、架构\"></a>2、架构</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/mybatis/framework.png\" alt=\"mybatis原理图\"></p>\n<ol>\n<li>SqlMapConfig.xml<br>mybatis的全局配置文件，配置了运行环境等信息。mapper.xml即映射文件，里面配置了操作数据库的sql语句，该类文件需要在SqlMapConfig.xml中加载。</li>\n<li>SqlSessionFactory<br>通过mybatis环境等配置信息构造SqlSessionFactory即会话工厂</li>\n<li>SqlSession<br>由会话工厂创建sqlSession即会话，操作数据库需要通过sqlSession进行</li>\n<li>Executor<br>mybatis底层自定义了Executor执行器接口操作数据库，Executor接口有两个实现，一个是基本执行器、一个是缓存执行器。</li>\n<li>Mapper Statement<br>mybatis底层封装对象，它包装了mybatis配置信息及sql映射信息等。mapper.xml文件中一个sql对应一个Mapped Statement对象，sql的id即是Mapped statement的id。<br>Mapped Statement对sql执行输入参数进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql前将输入的java对象映射至sql中，输入参数映射就是jdbc编程中对preparedStatement设置参数。<br>Mapped Statement对sql执行输出结果进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql后将输出结果映射至java对象中，输出结果映射过程相当于jdbc编程中对结果的解析处理过程。</li>\n</ol>\n<h2 id=\"3、特点\"><a href=\"#3、特点\" class=\"headerlink\" title=\"3、特点\"></a>3、特点</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/mybatis/jdbcProgram.png\" alt=\"此处输入图片的描述\"></p>\n<p>上边使用jdbc的原始方法（未经封装）实现了查询数据库表记录的操作。</p>\n<p><strong>JDBC编程问题总结：</strong><br>1、    数据库链接创建、释放频繁造成系统资源浪费从而影响系统性能，如果使用数据库链接池可解决此问题。</p>\n<font color=\"red\">解决：在SqlMapConfig.xml中配置数据链接池，使用连接池管理数据库链接</font><br>2、    Sql语句在代码中硬编码，造成代码不易维护，实际应用sql变化的可能较大，sql变动需要改变java代码。<br><font color=\"red\">解决：将Sql语句配置在XXXXmapper.xml文件中与java代码分离。</font><br>3、    使用preparedStatement向占有位符号传参数存在硬编码，因为sql语句的where条件不一定，可能多也可能少，修改sql还要修改代码，系统不易维护。<br><font color=\"red\">解决：Mybatis自动将java对象映射至sql语句，通过statement中的parameterType定义输入参数的类型。</font><br>4、    对结果集解析存在硬编码（查询列名），sql变化导致解析代码变化，系统不易维护，如果能将数据库记录封装成pojo对象解析比较方便。<br><font color=\"red\">解决：Mybatis自动将sql执行结果映射至java对象，通过statement中的resultType定义输出结果的类型。</font>\n\n\n<h2 id=\"4、入门程序搭建\"><a href=\"#4、入门程序搭建\" class=\"headerlink\" title=\"4、入门程序搭建\"></a>4、入门程序搭建</h2><p>需求:查询图书id查询图书信息</p>\n<p>创建数据库，新建book表：<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"string\">`book`</span> (</div><div class=\"line\">  <span class=\"string\">`book_id`</span> <span class=\"built_in\">bigint</span>(<span class=\"number\">20</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> AUTO_INCREMENT <span class=\"keyword\">COMMENT</span> <span class=\"string\">'图书ID'</span>,</div><div class=\"line\">  <span class=\"string\">`name`</span> <span class=\"built_in\">varchar</span>(<span class=\"number\">100</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> <span class=\"keyword\">COMMENT</span> <span class=\"string\">'图书名称'</span>,</div><div class=\"line\">  <span class=\"string\">`number`</span> <span class=\"built_in\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> <span class=\"keyword\">COMMENT</span> <span class=\"string\">'馆藏数量'</span>,</div><div class=\"line\">  PRIMARY <span class=\"keyword\">KEY</span> (<span class=\"string\">`book_id`</span>)</div><div class=\"line\">) <span class=\"keyword\">ENGINE</span>=<span class=\"keyword\">InnoDB</span> AUTO_INCREMENT=<span class=\"number\">1004</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">CHARSET</span>=utf8 <span class=\"keyword\">COMMENT</span>=<span class=\"string\">'图书表'</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`book`</span> <span class=\"keyword\">VALUES</span> (<span class=\"string\">'1000'</span>, <span class=\"string\">'Java程序设计'</span>, <span class=\"string\">'10'</span>);</div><div class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`book`</span> <span class=\"keyword\">VALUES</span> (<span class=\"string\">'1001'</span>, <span class=\"string\">'数据结构'</span>, <span class=\"string\">'10'</span>);</div><div class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`book`</span> <span class=\"keyword\">VALUES</span> (<span class=\"string\">'1002'</span>, <span class=\"string\">'设计模式'</span>, <span class=\"string\">'10'</span>);</div><div class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`book`</span> <span class=\"keyword\">VALUES</span> (<span class=\"string\">'1003'</span>, <span class=\"string\">'编译原理'</span>, <span class=\"string\">'10'</span>);</div></pre></td></tr></table></figure></p>\n<h3 id=\"4-1、maven创建java工程\"><a href=\"#4-1、maven创建java工程\" class=\"headerlink\" title=\"4.1、maven创建java工程\"></a>4.1、maven创建java工程</h3><p>省略</p>\n<h3 id=\"4-2、引入依赖\"><a href=\"#4-2、引入依赖\" class=\"headerlink\" title=\"4.2、引入依赖\"></a>4.2、引入依赖</h3><p>加入mybatis核心包、依赖包、数据驱动包。完整的pom配置如下：<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.topvision.maven<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.apache.org<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">mybatis.version</span>&gt;</span>3.4.5<span class=\"tag\">&lt;/<span class=\"name\">mybatis.version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mybatis --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-spring<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mysql驱动 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- c3p0 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- slf4j --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-log4j12<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.17<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- junit --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.9<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">encoding</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<h3 id=\"4-3、log4j-properties\"><a href=\"#4-3、log4j-properties\" class=\"headerlink\" title=\"4.3、log4j.properties\"></a>4.3、log4j.properties</h3><p>在classpath下加入日志配置：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\">#定义LOG输出级别  </div><div class=\"line\">log4j.rootLogger=DEBUG,Console,File  </div><div class=\"line\">#定义日志输出目的地为控制台  </div><div class=\"line\">log4j.appender.Console=org.apache.log4j.ConsoleAppender  </div><div class=\"line\">log4j.appender.Console.Target=System.out  </div><div class=\"line\">#可以灵活地指定日志输出格式，下面一行是指定具体的格式  </div><div class=\"line\">log4j.appender.Console.layout = org.apache.log4j.PatternLayout  </div><div class=\"line\">log4j.appender.Console.layout.ConversionPattern=[%c] - %m%n  </div><div class=\"line\">  </div><div class=\"line\">#文件大小到达指定尺寸的时候产生一个新的文件  </div><div class=\"line\">log4j.appender.File = org.apache.log4j.RollingFileAppender  </div><div class=\"line\">#指定输出目录  </div><div class=\"line\">log4j.appender.File.File = logs/ssm.log</div><div class=\"line\">#定义文件最大大小  </div><div class=\"line\">log4j.appender.File.MaxFileSize = 10MB  </div><div class=\"line\">#输出所有日志，如果换成DEBUG表示输出DEBUG以上级别日志  </div><div class=\"line\">log4j.appender.File.Threshold = ALL  </div><div class=\"line\">log4j.appender.File.layout = org.apache.log4j.PatternLayout  </div><div class=\"line\">log4j.appender.File.layout.ConversionPattern =[%p] [%d&#123;yyyy-MM-dd HH\\:mm\\:ss&#125;][%c]%m%n</div></pre></td></tr></table></figure></p>\n<h3 id=\"4-4、jdbc-properties\"><a href=\"#4-4、jdbc-properties\" class=\"headerlink\" title=\"4.4、jdbc.properties\"></a>4.4、jdbc.properties</h3><p>在classpath下新建数据库连接文件。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">jdbc.driverClass\t= com.mysql.jdbc.Driver</div><div class=\"line\">jdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb?characterEncoding=utf-8</div><div class=\"line\">jdbc.username\t\t= root</div><div class=\"line\">jdbc.password\t\t= 123</div></pre></td></tr></table></figure>\n<h3 id=\"4-4、SqlMapConfig-xml\"><a href=\"#4-4、SqlMapConfig-xml\" class=\"headerlink\" title=\"4.4、SqlMapConfig.xml\"></a>4.4、SqlMapConfig.xml</h3><p>在classpath下新建SqlMapConfig.xml文件，配置mybatis运行环境。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE configuration</span></div><div class=\"line\">PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"</div><div class=\"line\">\"http://mybatis.org/dtd/mybatis-3-config.dtd\"&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">properties</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"jdbc.properties\"</span>/&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 和spring整合后 environments配置将废除 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">environments</span> <span class=\"attr\">default</span>=<span class=\"string\">\"development\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">environment</span> <span class=\"attr\">id</span>=<span class=\"string\">\"development\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 使用jdbc事务管理 --&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">transactionManager</span> <span class=\"attr\">type</span>=<span class=\"string\">\"JDBC\"</span> /&gt;</span></div><div class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 数据库连接池 --&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dataSource</span> <span class=\"attr\">type</span>=<span class=\"string\">\"POOLED\"</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.driverClass&#125;\"</span> /&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.url&#125;\"</span> /&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.username&#125;\"</span> /&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.password&#125;\"</span> /&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dataSource</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">environment</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">environments</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>SqlMapConfig.xml是mybatis核心配置文件，上边文件的配置内容为数据源、事务管理。</p>\n<h3 id=\"4-5、编写Po类\"><a href=\"#4-5、编写Po类\" class=\"headerlink\" title=\"4.5、编写Po类\"></a>4.5、编写Po类</h3><p>Po类作为mybatis进行sql映射使用，po类通常与数据库表对应，Book.java如下:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Book</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> bookId;<span class=\"comment\">// 图书ID</span></div><div class=\"line\">    <span class=\"keyword\">private</span> String name;<span class=\"comment\">// 图书名称</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> number;<span class=\"comment\">// 馆藏数量</span></div><div class=\"line\">    ...</div></pre></td></tr></table></figure></p>\n<h3 id=\"4-6、编写映射文件（sql）\"><a href=\"#4-6、编写映射文件（sql）\" class=\"headerlink\" title=\"4.6、编写映射文件（sql）\"></a>4.6、编写映射文件（sql）</h3><p>在classpath下的sqlmap目录下创建sql映射文件Book.xml：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE mapper</span></div><div class=\"line\">PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"</div><div class=\"line\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"test\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"queryById\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"long\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"com.topvision.maven.mybatis.domain.Book\"</span>&gt;</span></div><div class=\"line\">\t\tselect book_id bookId,name,number from book where book_id = #&#123;id&#125;</div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>namespace ：命名空间，用于隔离sql语句，后面会讲另一层非常重要的作用。<br>parameterType：定义输入到sql中的映射类型，#{id}表示使用preparedstatement设置占位符号并将输入变量id传到sql。<br>resultType：定义结果映射类型。</p>\n<h3 id=\"4-7、加载映射文件\"><a href=\"#4-7、加载映射文件\" class=\"headerlink\" title=\"4.7、加载映射文件\"></a>4.7、加载映射文件</h3><p>在SqlMapConfig.xml中加载映射文件Book.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mappers</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"sqlmap/Book.xml\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mappers</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"4-8、测试\"><a href=\"#4-8、测试\" class=\"headerlink\" title=\"4.8、测试\"></a>4.8、测试</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BookDaoTest</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> SqlSessionFactory sqlSessionFactory;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"meta\">@Before</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createSqlSessionFactory</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException</span>&#123;</div><div class=\"line\">        String resource = <span class=\"string\">\"sqlMapConfig.xml\"</span>;</div><div class=\"line\">        InputStream inputStream = Resources.getResourceAsStream(resource);</div><div class=\"line\">        </div><div class=\"line\">        sqlSessionFactory = <span class=\"keyword\">new</span> SqlSessionFactoryBuilder().build(inputStream);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testQueryById</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        SqlSession sqlSession = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            sqlSession = sqlSessionFactory.openSession();</div><div class=\"line\">            Book book = sqlSession.selectOne(<span class=\"string\">\"test.queryById\"</span>,<span class=\"number\">1000l</span>);</div><div class=\"line\">            System.out.println(book);</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">if</span> (sqlSession != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">                sqlSession.close();</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>至此，若能查询出结果，则工程搭建成功。</p>"},{"title":"Mysql--存储过程","date":"2017-07-25T05:08:58.000Z","_content":"## 1. 存储过程\n\n### 1.1 简介\n\n&emsp;&emsp;普通的sql语句在执行的时候需要先编译再执行，而存储过程（Stored Procedure）是一组为了特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定的存储过程名称并给定参数（如果有的话）来调用执行它。\n&emsp;&emsp;存储过程是可编程的函数，在数据库中创建并保存，可以由SQL语句和控制结构组成。当想要在不同的应用程序或平台上执行相同的函数，或者封装特定功能时，存储过程是非常有用的。数据库中的存储过程可以看做是对编程中面向对象方法的模拟，它允许控制数据的访问方式。\n<!--more-->\n\n### 1.2 优点\n\n 1. 增强SQL语言的功能和灵活性：存储过程可以用流控制语句编写，有很强的灵活性，可以完成复杂的判断和较复杂的运算。\n 2. 标准组件式编程：存储过程被创建后，可以在程序中被多次调用，而不必重新编写该存储过程的SQL语句。而且数据库专业人员可以随时对存储过程进行修改，对应用程序源代码毫无影响。\n 3. 较快的执行速度：如果某一操作包含大量的Transaction-SQL代码或分别被多次执行，那么存储过程要比批处理的执行速度快很多。因为存储过程是预编译的。在首次运行一个存储过程时查询，优化器对其进行分析优化，并且给出最终被存储在系统表中的执行计划。而批处理的Transaction-SQL语句在每次运行时都要进行编译和优化，速度相对要慢一些。\n 4. 减少网络流量：针对同一个数据库对象的操作（如查询、修改），如果这一操作所涉及的Transaction-SQL语句被组织程存储过程，那么当在客户计算机上调用该存储过程时，网络中传送的只是该调用语句，从而大大增加了网络流量并降低了网络负载。\n 5. 安全机制：通过对执行某一存储过程的权限进行限制，能够实现对相应的数据的访问权限的限制，避免了非授权用户对数据的访问，保证了数据的安全。\n\n### 1.3 存储过程创建\n\n#### 1.3.1 语法\n**CREATE PROCEDURE  过程名([[IN|OUT|INOUT] 参数名 数据类型[,[IN|OUT|INOUT] 参数名 数据类型…]]) [特性 ...] 过程体**\n\n```sql\nDELIMITER //\n  CREATE PROCEDURE myproc(OUT s int)\n    BEGIN\n      SELECT COUNT(*) INTO s FROM students;\n    END\n    //\nDELIMITER ;\n```\n\n#### 1.3.2 分隔符\n\n&emsp;&emsp;MySQL默认以\";\"为分隔符，如果没有声明分割符，则编译器会把存储过程当成SQL语句进行处理，因此编译过程会报错，所以要事先用“DELIMITER //”声明当前段分隔符，让编译器把两个\"//\"之间的内容当做存储过程的代码，不会执行这些代码；“DELIMITER ;”的意为把分隔符还原。\n\n#### 1.3.3 参数\n\n&emsp;&emsp;存储过程根据需要可能会有输入、输出、输入输出参数，如果有多个参数用\",\"分割开。MySQL存储过程的参数用在存储过程的定义，共有三种参数类型,IN,OUT,INOUT:\n\n - IN:参数的值必须在调用存储过程时指定，在存储过程中修改该参数的值不能被返回，为默认值.\n - OUT:值可在存储过程内部被改变，并可返回.\n - INOUT:调用时指定，并且可被改变和返回.\n \n#### 2.3.4 过程体\n\n&emsp;&emsp;过程体的开始与结束使用BEGIN与END进行标识。\n\n### 1.4 变量\n\n#### 1.4.1 声明变量\n\n&emsp;&emsp;**DECLARE 变量名1[,变量名2...] 数据类型 [默认值];**\n\n#### 1.4.2 数值类型\n\n&emsp;&emsp;数据类型为MySQL的数据类型\n\n 1. 数值类型!\n     ![此处输入图片的描述][1]\n 2. 日期和时间类型!\n    ![此处输入图片的描述][2]\n 3. 字符串类型!\n    ![此处输入图片的描述][3]\n\n#### 1.4.3 变量赋值\n\n&emsp;&emsp;**SET 变量名 = 变量值 [,变量名= 变量值 ...]**\n\n#### 1.4.4 用户变量\n\n&emsp;&emsp;用户变量一般以@开头。\n&emsp;&emsp;注意：滥用用户变量会导致程序难以理解及管理\n```sql\nSELECT 'Hello World' into @x;\nSELECT @x;\n\nSET @y='Goodbye Cruel World';\nSELECT @y;\nSET @z=1+2+3;\nSELECT @z;\n```\n执行结果:\n![此处输入图片的描述][4]\n![此处输入图片的描述][5]\n![此处输入图片的描述][6]\n\n - 在存储过程中使用用户变量\n    \n    ```sql\n    CREATE PROCEDURE GreetWorld() SELECT CONCAT(@greeting,' World');\n    SET @greeting='Hello';\n    CALL GreetWorld();\n    ```\n    \n    执行结果:\n    ![此处输入图片的描述][7]\n    \n - 在存储过程间传递全局范围的用户变量\n\n    ```sql\n    CREATE PROCEDURE p1() SET @last_proc='p1';\n    CREATE PROCEDURE p2() SELECT CONCAT('Last procedure was ',@last_proc);\n    CALL p1();\n    CALL p2();\n    ```\n    \n    执行结果:\n    ![此处输入图片的描述][8]\n    \n#### 1.4.5 变量作用域\n\n&emsp;&emsp;内部变量在其作用域范围内享有更高的优先权，当执行到end时，内部变量消失，不再可见了，在存储过程外再也找不到这个内部变量，但是可以通过out参数或者将其值指派给会话变量来保存其值。\n\n```sql\n#变量作用域\nDELIMITER //\n  CREATE PROCEDURE proc()\n    BEGIN\n      DECLARE x1 VARCHAR(5) DEFAULT 'outer';\n        BEGIN\n          DECLARE x1 VARCHAR(5) DEFAULT 'inner';\n          SELECT x1;\n        END;\n      SELECT x1;\n    END;\n    //\nDELIMITER ;\n#调用\nCALL proc();\n```\n\n执行结果：\n```sql\ninner  outer\n```\n    \n### 1.5 存储过程的CRUD\n\n#### 1.5.1 调用\n&emsp;&emsp;用call和你过程名以及一个括号，括号里面根据需要，加入参数，参数包括输入参数、输出参数、输入输出参数。\n\n#### 1.5.2 查询\n\n```sql\n#查询存储过程\nSELECT name FROM mysql.proc WHERE db='数据库名';\nSELECT routine_name FROM information_schema.routines WHERE routine_schema='数据库名';\nSHOW PROCEDURE STATUS WHERE db='数据库名';\n\n#查看存储过程详细信息\nSHOW CREATE PROCEDURE 数据库.存储过程名;\n```\n\n#### 1.5.3 修改\n\n&emsp;&emsp;**ALTER PROCEDURE 更改用CREATE PROCEDURE 建立的预先指定的存储过程，其不会影响相关存储过程或存储功能。**\n\n```sql\nALTER {PROCEDURE | FUNCTION} sp_name [characteristic ...]\ncharacteristic:{ CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }\n| SQL SECURITY { DEFINER | INVOKER }\n| COMMENT 'string'\n```\n\n - sp_name参数表示存储过程或函数的名称；\n - characteristic参数指定存储函数的特性。\n - CONTAINS SQL表示子程序包含SQL语句，但不包含读或写数据的语句；\n - NO SQL表示子程序中不包含SQL语句；\n - READS SQL DATA表示子程序中包含读数据的语句；\n - MODIFIES SQL DATA表示子程序中包含写数据的语句。\n - SQL SECURITY { DEFINER | INVOKER }指明谁有权限来执行，DEFINER表示只有定义者自己才能够执行；INVOKER表示调用者可以执行。\n - COMMENT 'string'是注释信息。\n\nExample:\n```sql\n#将读写权限改为MODIFIES SQL DATA，并指明调用者可以执行。\nALTER  PROCEDURE  num_from_employee\n  MODIFIES SQL DATA\n  SQL SECURITY INVOKER ;\n#将读写权限改为READS SQL DATA，并加上注释信息'FIND NAME'。\nALTER  PROCEDURE  name_from_employee\n  READS SQL DATA\n  COMMENT 'FIND NAME' ;\n```\n\n#### 1.5.4 删除\n\n&emsp;&emsp;**DROP PROCEDURE [过程1[,过程2…]]**\n&emsp;&emsp;从MySQL的表格中删除一个或多个存储过程。\n \n \n### 1.6 控制语句\n\n#### 1.6.1 条件语句\n\n```sql\n#条件语句IF-THEN-ELSE\nDROP PROCEDURE IF EXISTS proc3;\nDELIMITER //\nCREATE PROCEDURE proc3(IN parameter int)\n  BEGIN\n    DECLARE var int;\n    SET var=parameter+1;\n    IF var=0 THEN\n      INSERT INTO t VALUES (17);\n    END IF ;\n    IF parameter=0 THEN\n      UPDATE t SET s1=s1+1;\n    ELSE\n      UPDATE t SET s1=s1+2;\n    END IF ;\n  END ;\n  //\nDELIMITER ;\n```\n```sql\n#CASE-WHEN-THEN-ELSE语句\nDELIMITER //\n  CREATE PROCEDURE proc4 (IN parameter INT)\n    BEGIN\n      DECLARE var INT;\n      SET var=parameter+1;\n      CASE var\n        WHEN 0 THEN\n          INSERT INTO t VALUES (17);\n        WHEN 1 THEN\n          INSERT INTO t VALUES (18);\n        ELSE\n          INSERT INTO t VALUES (19);\n      END CASE ;\n    END ;\n  //\nDELIMITER ;\n```\n\n#### 1.6.2 循环语句\n\n```sql\n#WHILE-DO…END-WHILE语句\nDELIMITER //\n  CREATE PROCEDURE proc5()\n    BEGIN\n      DECLARE var INT;\n      SET var=0;\n      WHILE var<6 DO\n        INSERT INTO t VALUES (var);\n        SET var=var+1;\n      END WHILE ;\n    END;\n  //\nDELIMITER ;\n```\n\n```sql\n#REPEAT...END REPEAT\n#此语句的特点是执行操作后检查结果\nDELIMITER //\n  CREATE PROCEDURE proc6 ()\n    BEGIN\n      DECLARE v INT;\n      SET v=0;\n      REPEAT\n        INSERT INTO t VALUES(v);\n        SET v=v+1;\n        UNTIL v>=5\n      END REPEAT;\n    END;\n  //\nDELIMITER ;\n```\n\n```sql\n#LOOP...END LOOP\nDELIMITER //\n  CREATE PROCEDURE proc7 ()\n    BEGIN\n      DECLARE v INT;\n      SET v=0;\n      LOOP_LABLE:LOOP\n        INSERT INTO t VALUES(v);\n        SET v=v+1;\n        IF v >=5 THEN\n          LEAVE LOOP_LABLE;\n        END IF;\n      END LOOP;\n    END;\n  //\nDELIMITER ;\n```\n\n**LABLES标号**\n&emsp;&emsp;标号可以用在begin repeat while 或者loop语句前，语句标号只能在合法的语句前面使用。可以跳出循环，使运行指令达到复合语句的最后一步。\n\n#### 1.6.3 迭代\n\n&emsp;&emsp;通过引用复合语句的标号,来从新开始复合语句\n\n```sql\n#ITERATE\nDELIMITER //\n  CREATE PROCEDURE proc8()\n  BEGIN\n    DECLARE v INT;\n    SET v=0;\n    LOOP_LABLE:LOOP\n      IF v=3 THEN\n        SET v=v+1;\n        ITERATE LOOP_LABLE;\n      END IF;\n      INSERT INTO t VALUES(v);\n      SET v=v+1;\n      IF v>=5 THEN\n        LEAVE LOOP_LABLE;\n      END IF;\n    END LOOP;\n  END;\n  //\nDELIMITER ;\n```\n\n## 2. MySQL存储过程的基本函数\n\n### 2.1 字符串类\n```sql\nCHARSET(str) //返回字串字符集\nCONCAT (string2 [,... ]) //连接字串\nINSTR (string ,substring ) //返回substring首次在string中出现的位置,不存在返回0\nLCASE (string2 ) //转换成小写\nLEFT (string2 ,length ) //从string2中的左边起取length个字符\nLENGTH (string ) //string长度\nLOAD_FILE (file_name ) //从文件读取内容\nLOCATE (substring , string [,start_position ] ) 同INSTR,但可指定开始位置\nLPAD (string2 ,length ,pad ) //重复用pad加在string开头,直到字串长度为length\nLTRIM (string2 ) //去除前端空格\nREPEAT (string2 ,count ) //重复count次\nREPLACE (str ,search_str ,replace_str ) //在str中用replace_str替换search_str\nRPAD (string2 ,length ,pad) //在str后用pad补充,直到长度为length\nRTRIM (string2 ) //去除后端空格\nSTRCMP (string1 ,string2 ) //逐字符比较两字串大小,\nSUBSTRING (str , position [,length ]) //从str的position开始,取length个字符,\n注：mysql中处理字符串时，默认第一个字符下标为1，即参数position必须大于等于1\nTRIM([[BOTH|LEADING|TRAILING] [padding] FROM]string2) //去除指定位置的指定字符\nUCASE (string2 ) //转换成大写\nRIGHT(string2,length) //取string2最后length个字符\nSPACE(count) //生成count个空格\n```\n    \n### 2.2 数学类\n\n```sql\nABS (number2 ) //绝对值\nBIN (decimal_number ) //十进制转二进制\nCEILING (number2 ) //向上取整\nCONV(number2,from_base,to_base) //进制转换\nFLOOR (number2 ) //向下取整\nFORMAT (number,decimal_places ) //保留小数位数\nHEX (DecimalNumber ) //转十六进制\n注：HEX()中可传入字符串，则返回其ASC-11码，如HEX('DEF')返回4142143\n也可以传入十进制整数，返回其十六进制编码，如HEX(25)返回19\nLEAST (number , number2 [,..]) //求最小值\nMOD (numerator ,denominator ) //求余\nPOWER (number ,power ) //求指数\nRAND([seed]) //随机数\nROUND (number [,decimals ]) //四舍五入,decimals为小数位数]\nSIGN (number2 ) // 正数返回1，负数返回-1注：返回类型并非均为整数，如：\nSQRT(number2) //开平方\n```\n\n### 2.3 时间类\n\n```sql\nADDTIME (date2 ,time_interval ) //将time_interval加到date2\nCONVERT_TZ (datetime2 ,fromTZ ,toTZ ) //转换时区\nCURRENT_DATE ( ) //当前日期\nCURRENT_TIME ( ) //当前时间\nCURRENT_TIMESTAMP ( ) //当前时间戳\nDATE (datetime ) //返回datetime的日期部分\nDATE_ADD (date2 , INTERVAL d_value d_type ) //在date2中加上日期或时间\nDATE_FORMAT (datetime ,FormatCodes ) //使用formatcodes格式显示datetime\nDATE_SUB (date2 , INTERVAL d_value d_type ) //在date2上减去一个时间\nDATEDIFF (date1 ,date2 ) //两个日期差\nDAY (date ) //返回日期的天\nDAYNAME (date ) //英文星期\nDAYOFWEEK (date ) //星期(1-7) ,1为星期天\nDAYOFYEAR (date ) //一年中的第几天\nEXTRACT (interval_name FROM date ) //从date中提取日期的指定部分\nMAKEDATE (year ,day ) //给出年及年中的第几天,生成日期串\nMAKETIME (hour ,minute ,second ) //生成时间串\nMONTHNAME (date ) //英文月份名\nNOW ( ) //当前时间\nSEC_TO_TIME (seconds ) //秒数转成时间\nSTR_TO_DATE (string ,format ) //字串转成时间,以format格式显示\nTIMEDIFF (datetime1 ,datetime2 ) //两个时间差\nTIME_TO_SEC (time ) //时间转秒数]\nWEEK (date_time [,start_of_week ]) //第几周\nYEAR (datetime ) //年份\nDAYOFMONTH(datetime) //月的第几天\nHOUR(datetime) //小时\nLAST_DAY(date) //date的月的最后日期\nMICROSECOND(datetime) //微秒\nMONTH(datetime) //月\nMINUTE(datetime) //分返回符号,正负或0\n```\n\n \n \n \n\n\n  [1]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201446988-1864698114.png\n  [2]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201448332-1505149268.png\n  [3]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201449535-2004058554.png\n  [4]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201450582-1967285160.png\n  [5]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201451254-1893179304.png\n  [6]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201451910-256935933.png\n  [7]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201452707-1144703374.png\n  [8]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201453520-1437835050.png\n  [9]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201454316-1239511390.png","source":"_posts/Mysql-存储过程.md","raw":"---\ntitle: Mysql--存储过程\ncategories:\n  - Mysql\ntags:\n  - Mysql 数据库\ndate: 2017-07-25 13:08:58\n---\n## 1. 存储过程\n\n### 1.1 简介\n\n&emsp;&emsp;普通的sql语句在执行的时候需要先编译再执行，而存储过程（Stored Procedure）是一组为了特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定的存储过程名称并给定参数（如果有的话）来调用执行它。\n&emsp;&emsp;存储过程是可编程的函数，在数据库中创建并保存，可以由SQL语句和控制结构组成。当想要在不同的应用程序或平台上执行相同的函数，或者封装特定功能时，存储过程是非常有用的。数据库中的存储过程可以看做是对编程中面向对象方法的模拟，它允许控制数据的访问方式。\n<!--more-->\n\n### 1.2 优点\n\n 1. 增强SQL语言的功能和灵活性：存储过程可以用流控制语句编写，有很强的灵活性，可以完成复杂的判断和较复杂的运算。\n 2. 标准组件式编程：存储过程被创建后，可以在程序中被多次调用，而不必重新编写该存储过程的SQL语句。而且数据库专业人员可以随时对存储过程进行修改，对应用程序源代码毫无影响。\n 3. 较快的执行速度：如果某一操作包含大量的Transaction-SQL代码或分别被多次执行，那么存储过程要比批处理的执行速度快很多。因为存储过程是预编译的。在首次运行一个存储过程时查询，优化器对其进行分析优化，并且给出最终被存储在系统表中的执行计划。而批处理的Transaction-SQL语句在每次运行时都要进行编译和优化，速度相对要慢一些。\n 4. 减少网络流量：针对同一个数据库对象的操作（如查询、修改），如果这一操作所涉及的Transaction-SQL语句被组织程存储过程，那么当在客户计算机上调用该存储过程时，网络中传送的只是该调用语句，从而大大增加了网络流量并降低了网络负载。\n 5. 安全机制：通过对执行某一存储过程的权限进行限制，能够实现对相应的数据的访问权限的限制，避免了非授权用户对数据的访问，保证了数据的安全。\n\n### 1.3 存储过程创建\n\n#### 1.3.1 语法\n**CREATE PROCEDURE  过程名([[IN|OUT|INOUT] 参数名 数据类型[,[IN|OUT|INOUT] 参数名 数据类型…]]) [特性 ...] 过程体**\n\n```sql\nDELIMITER //\n  CREATE PROCEDURE myproc(OUT s int)\n    BEGIN\n      SELECT COUNT(*) INTO s FROM students;\n    END\n    //\nDELIMITER ;\n```\n\n#### 1.3.2 分隔符\n\n&emsp;&emsp;MySQL默认以\";\"为分隔符，如果没有声明分割符，则编译器会把存储过程当成SQL语句进行处理，因此编译过程会报错，所以要事先用“DELIMITER //”声明当前段分隔符，让编译器把两个\"//\"之间的内容当做存储过程的代码，不会执行这些代码；“DELIMITER ;”的意为把分隔符还原。\n\n#### 1.3.3 参数\n\n&emsp;&emsp;存储过程根据需要可能会有输入、输出、输入输出参数，如果有多个参数用\",\"分割开。MySQL存储过程的参数用在存储过程的定义，共有三种参数类型,IN,OUT,INOUT:\n\n - IN:参数的值必须在调用存储过程时指定，在存储过程中修改该参数的值不能被返回，为默认值.\n - OUT:值可在存储过程内部被改变，并可返回.\n - INOUT:调用时指定，并且可被改变和返回.\n \n#### 2.3.4 过程体\n\n&emsp;&emsp;过程体的开始与结束使用BEGIN与END进行标识。\n\n### 1.4 变量\n\n#### 1.4.1 声明变量\n\n&emsp;&emsp;**DECLARE 变量名1[,变量名2...] 数据类型 [默认值];**\n\n#### 1.4.2 数值类型\n\n&emsp;&emsp;数据类型为MySQL的数据类型\n\n 1. 数值类型!\n     ![此处输入图片的描述][1]\n 2. 日期和时间类型!\n    ![此处输入图片的描述][2]\n 3. 字符串类型!\n    ![此处输入图片的描述][3]\n\n#### 1.4.3 变量赋值\n\n&emsp;&emsp;**SET 变量名 = 变量值 [,变量名= 变量值 ...]**\n\n#### 1.4.4 用户变量\n\n&emsp;&emsp;用户变量一般以@开头。\n&emsp;&emsp;注意：滥用用户变量会导致程序难以理解及管理\n```sql\nSELECT 'Hello World' into @x;\nSELECT @x;\n\nSET @y='Goodbye Cruel World';\nSELECT @y;\nSET @z=1+2+3;\nSELECT @z;\n```\n执行结果:\n![此处输入图片的描述][4]\n![此处输入图片的描述][5]\n![此处输入图片的描述][6]\n\n - 在存储过程中使用用户变量\n    \n    ```sql\n    CREATE PROCEDURE GreetWorld() SELECT CONCAT(@greeting,' World');\n    SET @greeting='Hello';\n    CALL GreetWorld();\n    ```\n    \n    执行结果:\n    ![此处输入图片的描述][7]\n    \n - 在存储过程间传递全局范围的用户变量\n\n    ```sql\n    CREATE PROCEDURE p1() SET @last_proc='p1';\n    CREATE PROCEDURE p2() SELECT CONCAT('Last procedure was ',@last_proc);\n    CALL p1();\n    CALL p2();\n    ```\n    \n    执行结果:\n    ![此处输入图片的描述][8]\n    \n#### 1.4.5 变量作用域\n\n&emsp;&emsp;内部变量在其作用域范围内享有更高的优先权，当执行到end时，内部变量消失，不再可见了，在存储过程外再也找不到这个内部变量，但是可以通过out参数或者将其值指派给会话变量来保存其值。\n\n```sql\n#变量作用域\nDELIMITER //\n  CREATE PROCEDURE proc()\n    BEGIN\n      DECLARE x1 VARCHAR(5) DEFAULT 'outer';\n        BEGIN\n          DECLARE x1 VARCHAR(5) DEFAULT 'inner';\n          SELECT x1;\n        END;\n      SELECT x1;\n    END;\n    //\nDELIMITER ;\n#调用\nCALL proc();\n```\n\n执行结果：\n```sql\ninner  outer\n```\n    \n### 1.5 存储过程的CRUD\n\n#### 1.5.1 调用\n&emsp;&emsp;用call和你过程名以及一个括号，括号里面根据需要，加入参数，参数包括输入参数、输出参数、输入输出参数。\n\n#### 1.5.2 查询\n\n```sql\n#查询存储过程\nSELECT name FROM mysql.proc WHERE db='数据库名';\nSELECT routine_name FROM information_schema.routines WHERE routine_schema='数据库名';\nSHOW PROCEDURE STATUS WHERE db='数据库名';\n\n#查看存储过程详细信息\nSHOW CREATE PROCEDURE 数据库.存储过程名;\n```\n\n#### 1.5.3 修改\n\n&emsp;&emsp;**ALTER PROCEDURE 更改用CREATE PROCEDURE 建立的预先指定的存储过程，其不会影响相关存储过程或存储功能。**\n\n```sql\nALTER {PROCEDURE | FUNCTION} sp_name [characteristic ...]\ncharacteristic:{ CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }\n| SQL SECURITY { DEFINER | INVOKER }\n| COMMENT 'string'\n```\n\n - sp_name参数表示存储过程或函数的名称；\n - characteristic参数指定存储函数的特性。\n - CONTAINS SQL表示子程序包含SQL语句，但不包含读或写数据的语句；\n - NO SQL表示子程序中不包含SQL语句；\n - READS SQL DATA表示子程序中包含读数据的语句；\n - MODIFIES SQL DATA表示子程序中包含写数据的语句。\n - SQL SECURITY { DEFINER | INVOKER }指明谁有权限来执行，DEFINER表示只有定义者自己才能够执行；INVOKER表示调用者可以执行。\n - COMMENT 'string'是注释信息。\n\nExample:\n```sql\n#将读写权限改为MODIFIES SQL DATA，并指明调用者可以执行。\nALTER  PROCEDURE  num_from_employee\n  MODIFIES SQL DATA\n  SQL SECURITY INVOKER ;\n#将读写权限改为READS SQL DATA，并加上注释信息'FIND NAME'。\nALTER  PROCEDURE  name_from_employee\n  READS SQL DATA\n  COMMENT 'FIND NAME' ;\n```\n\n#### 1.5.4 删除\n\n&emsp;&emsp;**DROP PROCEDURE [过程1[,过程2…]]**\n&emsp;&emsp;从MySQL的表格中删除一个或多个存储过程。\n \n \n### 1.6 控制语句\n\n#### 1.6.1 条件语句\n\n```sql\n#条件语句IF-THEN-ELSE\nDROP PROCEDURE IF EXISTS proc3;\nDELIMITER //\nCREATE PROCEDURE proc3(IN parameter int)\n  BEGIN\n    DECLARE var int;\n    SET var=parameter+1;\n    IF var=0 THEN\n      INSERT INTO t VALUES (17);\n    END IF ;\n    IF parameter=0 THEN\n      UPDATE t SET s1=s1+1;\n    ELSE\n      UPDATE t SET s1=s1+2;\n    END IF ;\n  END ;\n  //\nDELIMITER ;\n```\n```sql\n#CASE-WHEN-THEN-ELSE语句\nDELIMITER //\n  CREATE PROCEDURE proc4 (IN parameter INT)\n    BEGIN\n      DECLARE var INT;\n      SET var=parameter+1;\n      CASE var\n        WHEN 0 THEN\n          INSERT INTO t VALUES (17);\n        WHEN 1 THEN\n          INSERT INTO t VALUES (18);\n        ELSE\n          INSERT INTO t VALUES (19);\n      END CASE ;\n    END ;\n  //\nDELIMITER ;\n```\n\n#### 1.6.2 循环语句\n\n```sql\n#WHILE-DO…END-WHILE语句\nDELIMITER //\n  CREATE PROCEDURE proc5()\n    BEGIN\n      DECLARE var INT;\n      SET var=0;\n      WHILE var<6 DO\n        INSERT INTO t VALUES (var);\n        SET var=var+1;\n      END WHILE ;\n    END;\n  //\nDELIMITER ;\n```\n\n```sql\n#REPEAT...END REPEAT\n#此语句的特点是执行操作后检查结果\nDELIMITER //\n  CREATE PROCEDURE proc6 ()\n    BEGIN\n      DECLARE v INT;\n      SET v=0;\n      REPEAT\n        INSERT INTO t VALUES(v);\n        SET v=v+1;\n        UNTIL v>=5\n      END REPEAT;\n    END;\n  //\nDELIMITER ;\n```\n\n```sql\n#LOOP...END LOOP\nDELIMITER //\n  CREATE PROCEDURE proc7 ()\n    BEGIN\n      DECLARE v INT;\n      SET v=0;\n      LOOP_LABLE:LOOP\n        INSERT INTO t VALUES(v);\n        SET v=v+1;\n        IF v >=5 THEN\n          LEAVE LOOP_LABLE;\n        END IF;\n      END LOOP;\n    END;\n  //\nDELIMITER ;\n```\n\n**LABLES标号**\n&emsp;&emsp;标号可以用在begin repeat while 或者loop语句前，语句标号只能在合法的语句前面使用。可以跳出循环，使运行指令达到复合语句的最后一步。\n\n#### 1.6.3 迭代\n\n&emsp;&emsp;通过引用复合语句的标号,来从新开始复合语句\n\n```sql\n#ITERATE\nDELIMITER //\n  CREATE PROCEDURE proc8()\n  BEGIN\n    DECLARE v INT;\n    SET v=0;\n    LOOP_LABLE:LOOP\n      IF v=3 THEN\n        SET v=v+1;\n        ITERATE LOOP_LABLE;\n      END IF;\n      INSERT INTO t VALUES(v);\n      SET v=v+1;\n      IF v>=5 THEN\n        LEAVE LOOP_LABLE;\n      END IF;\n    END LOOP;\n  END;\n  //\nDELIMITER ;\n```\n\n## 2. MySQL存储过程的基本函数\n\n### 2.1 字符串类\n```sql\nCHARSET(str) //返回字串字符集\nCONCAT (string2 [,... ]) //连接字串\nINSTR (string ,substring ) //返回substring首次在string中出现的位置,不存在返回0\nLCASE (string2 ) //转换成小写\nLEFT (string2 ,length ) //从string2中的左边起取length个字符\nLENGTH (string ) //string长度\nLOAD_FILE (file_name ) //从文件读取内容\nLOCATE (substring , string [,start_position ] ) 同INSTR,但可指定开始位置\nLPAD (string2 ,length ,pad ) //重复用pad加在string开头,直到字串长度为length\nLTRIM (string2 ) //去除前端空格\nREPEAT (string2 ,count ) //重复count次\nREPLACE (str ,search_str ,replace_str ) //在str中用replace_str替换search_str\nRPAD (string2 ,length ,pad) //在str后用pad补充,直到长度为length\nRTRIM (string2 ) //去除后端空格\nSTRCMP (string1 ,string2 ) //逐字符比较两字串大小,\nSUBSTRING (str , position [,length ]) //从str的position开始,取length个字符,\n注：mysql中处理字符串时，默认第一个字符下标为1，即参数position必须大于等于1\nTRIM([[BOTH|LEADING|TRAILING] [padding] FROM]string2) //去除指定位置的指定字符\nUCASE (string2 ) //转换成大写\nRIGHT(string2,length) //取string2最后length个字符\nSPACE(count) //生成count个空格\n```\n    \n### 2.2 数学类\n\n```sql\nABS (number2 ) //绝对值\nBIN (decimal_number ) //十进制转二进制\nCEILING (number2 ) //向上取整\nCONV(number2,from_base,to_base) //进制转换\nFLOOR (number2 ) //向下取整\nFORMAT (number,decimal_places ) //保留小数位数\nHEX (DecimalNumber ) //转十六进制\n注：HEX()中可传入字符串，则返回其ASC-11码，如HEX('DEF')返回4142143\n也可以传入十进制整数，返回其十六进制编码，如HEX(25)返回19\nLEAST (number , number2 [,..]) //求最小值\nMOD (numerator ,denominator ) //求余\nPOWER (number ,power ) //求指数\nRAND([seed]) //随机数\nROUND (number [,decimals ]) //四舍五入,decimals为小数位数]\nSIGN (number2 ) // 正数返回1，负数返回-1注：返回类型并非均为整数，如：\nSQRT(number2) //开平方\n```\n\n### 2.3 时间类\n\n```sql\nADDTIME (date2 ,time_interval ) //将time_interval加到date2\nCONVERT_TZ (datetime2 ,fromTZ ,toTZ ) //转换时区\nCURRENT_DATE ( ) //当前日期\nCURRENT_TIME ( ) //当前时间\nCURRENT_TIMESTAMP ( ) //当前时间戳\nDATE (datetime ) //返回datetime的日期部分\nDATE_ADD (date2 , INTERVAL d_value d_type ) //在date2中加上日期或时间\nDATE_FORMAT (datetime ,FormatCodes ) //使用formatcodes格式显示datetime\nDATE_SUB (date2 , INTERVAL d_value d_type ) //在date2上减去一个时间\nDATEDIFF (date1 ,date2 ) //两个日期差\nDAY (date ) //返回日期的天\nDAYNAME (date ) //英文星期\nDAYOFWEEK (date ) //星期(1-7) ,1为星期天\nDAYOFYEAR (date ) //一年中的第几天\nEXTRACT (interval_name FROM date ) //从date中提取日期的指定部分\nMAKEDATE (year ,day ) //给出年及年中的第几天,生成日期串\nMAKETIME (hour ,minute ,second ) //生成时间串\nMONTHNAME (date ) //英文月份名\nNOW ( ) //当前时间\nSEC_TO_TIME (seconds ) //秒数转成时间\nSTR_TO_DATE (string ,format ) //字串转成时间,以format格式显示\nTIMEDIFF (datetime1 ,datetime2 ) //两个时间差\nTIME_TO_SEC (time ) //时间转秒数]\nWEEK (date_time [,start_of_week ]) //第几周\nYEAR (datetime ) //年份\nDAYOFMONTH(datetime) //月的第几天\nHOUR(datetime) //小时\nLAST_DAY(date) //date的月的最后日期\nMICROSECOND(datetime) //微秒\nMONTH(datetime) //月\nMINUTE(datetime) //分返回符号,正负或0\n```\n\n \n \n \n\n\n  [1]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201446988-1864698114.png\n  [2]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201448332-1505149268.png\n  [3]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201449535-2004058554.png\n  [4]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201450582-1967285160.png\n  [5]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201451254-1893179304.png\n  [6]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201451910-256935933.png\n  [7]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201452707-1144703374.png\n  [8]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201453520-1437835050.png\n  [9]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201454316-1239511390.png","slug":"Mysql-存储过程","published":1,"updated":"2018-02-27T07:38:38.087Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fsper000fn8vfztfnsfwh","content":"<h2 id=\"1-存储过程\"><a href=\"#1-存储过程\" class=\"headerlink\" title=\"1. 存储过程\"></a>1. 存储过程</h2><h3 id=\"1-1-简介\"><a href=\"#1-1-简介\" class=\"headerlink\" title=\"1.1 简介\"></a>1.1 简介</h3><p>&emsp;&emsp;普通的sql语句在执行的时候需要先编译再执行，而存储过程（Stored Procedure）是一组为了特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定的存储过程名称并给定参数（如果有的话）来调用执行它。<br>&emsp;&emsp;存储过程是可编程的函数，在数据库中创建并保存，可以由SQL语句和控制结构组成。当想要在不同的应用程序或平台上执行相同的函数，或者封装特定功能时，存储过程是非常有用的。数据库中的存储过程可以看做是对编程中面向对象方法的模拟，它允许控制数据的访问方式。<br><a id=\"more\"></a></p>\n<h3 id=\"1-2-优点\"><a href=\"#1-2-优点\" class=\"headerlink\" title=\"1.2 优点\"></a>1.2 优点</h3><ol>\n<li>增强SQL语言的功能和灵活性：存储过程可以用流控制语句编写，有很强的灵活性，可以完成复杂的判断和较复杂的运算。</li>\n<li>标准组件式编程：存储过程被创建后，可以在程序中被多次调用，而不必重新编写该存储过程的SQL语句。而且数据库专业人员可以随时对存储过程进行修改，对应用程序源代码毫无影响。</li>\n<li>较快的执行速度：如果某一操作包含大量的Transaction-SQL代码或分别被多次执行，那么存储过程要比批处理的执行速度快很多。因为存储过程是预编译的。在首次运行一个存储过程时查询，优化器对其进行分析优化，并且给出最终被存储在系统表中的执行计划。而批处理的Transaction-SQL语句在每次运行时都要进行编译和优化，速度相对要慢一些。</li>\n<li>减少网络流量：针对同一个数据库对象的操作（如查询、修改），如果这一操作所涉及的Transaction-SQL语句被组织程存储过程，那么当在客户计算机上调用该存储过程时，网络中传送的只是该调用语句，从而大大增加了网络流量并降低了网络负载。</li>\n<li>安全机制：通过对执行某一存储过程的权限进行限制，能够实现对相应的数据的访问权限的限制，避免了非授权用户对数据的访问，保证了数据的安全。</li>\n</ol>\n<h3 id=\"1-3-存储过程创建\"><a href=\"#1-3-存储过程创建\" class=\"headerlink\" title=\"1.3 存储过程创建\"></a>1.3 存储过程创建</h3><h4 id=\"1-3-1-语法\"><a href=\"#1-3-1-语法\" class=\"headerlink\" title=\"1.3.1 语法\"></a>1.3.1 语法</h4><p><strong>CREATE PROCEDURE  过程名([[IN|OUT|INOUT] 参数名 数据类型[,[IN|OUT|INOUT] 参数名 数据类型…]]) [特性 …] 过程体</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">DELIMITER //</div><div class=\"line\">  <span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> myproc(<span class=\"keyword\">OUT</span> s <span class=\"built_in\">int</span>)</div><div class=\"line\">    <span class=\"keyword\">BEGIN</span></div><div class=\"line\">      <span class=\"keyword\">SELECT</span> <span class=\"keyword\">COUNT</span>(*) <span class=\"keyword\">INTO</span> s <span class=\"keyword\">FROM</span> students;</div><div class=\"line\">    <span class=\"keyword\">END</span></div><div class=\"line\">    //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<h4 id=\"1-3-2-分隔符\"><a href=\"#1-3-2-分隔符\" class=\"headerlink\" title=\"1.3.2 分隔符\"></a>1.3.2 分隔符</h4><p>&emsp;&emsp;MySQL默认以”;”为分隔符，如果没有声明分割符，则编译器会把存储过程当成SQL语句进行处理，因此编译过程会报错，所以要事先用“DELIMITER //”声明当前段分隔符，让编译器把两个”//“之间的内容当做存储过程的代码，不会执行这些代码；“DELIMITER ;”的意为把分隔符还原。</p>\n<h4 id=\"1-3-3-参数\"><a href=\"#1-3-3-参数\" class=\"headerlink\" title=\"1.3.3 参数\"></a>1.3.3 参数</h4><p>&emsp;&emsp;存储过程根据需要可能会有输入、输出、输入输出参数，如果有多个参数用”,”分割开。MySQL存储过程的参数用在存储过程的定义，共有三种参数类型,IN,OUT,INOUT:</p>\n<ul>\n<li>IN:参数的值必须在调用存储过程时指定，在存储过程中修改该参数的值不能被返回，为默认值.</li>\n<li>OUT:值可在存储过程内部被改变，并可返回.</li>\n<li>INOUT:调用时指定，并且可被改变和返回.</li>\n</ul>\n<h4 id=\"2-3-4-过程体\"><a href=\"#2-3-4-过程体\" class=\"headerlink\" title=\"2.3.4 过程体\"></a>2.3.4 过程体</h4><p>&emsp;&emsp;过程体的开始与结束使用BEGIN与END进行标识。</p>\n<h3 id=\"1-4-变量\"><a href=\"#1-4-变量\" class=\"headerlink\" title=\"1.4 变量\"></a>1.4 变量</h3><h4 id=\"1-4-1-声明变量\"><a href=\"#1-4-1-声明变量\" class=\"headerlink\" title=\"1.4.1 声明变量\"></a>1.4.1 声明变量</h4><p>&emsp;&emsp;<strong>DECLARE 变量名1[,变量名2…] 数据类型 [默认值];</strong></p>\n<h4 id=\"1-4-2-数值类型\"><a href=\"#1-4-2-数值类型\" class=\"headerlink\" title=\"1.4.2 数值类型\"></a>1.4.2 数值类型</h4><p>&emsp;&emsp;数据类型为MySQL的数据类型</p>\n<ol>\n<li>数值类型!<br> <img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201446988-1864698114.png\" alt=\"此处输入图片的描述\"></li>\n<li>日期和时间类型!<br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201448332-1505149268.png\" alt=\"此处输入图片的描述\"></li>\n<li>字符串类型!<br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201449535-2004058554.png\" alt=\"此处输入图片的描述\"></li>\n</ol>\n<h4 id=\"1-4-3-变量赋值\"><a href=\"#1-4-3-变量赋值\" class=\"headerlink\" title=\"1.4.3 变量赋值\"></a>1.4.3 变量赋值</h4><p>&emsp;&emsp;<strong>SET 变量名 = 变量值 [,变量名= 变量值 …]</strong></p>\n<h4 id=\"1-4-4-用户变量\"><a href=\"#1-4-4-用户变量\" class=\"headerlink\" title=\"1.4.4 用户变量\"></a>1.4.4 用户变量</h4><p>&emsp;&emsp;用户变量一般以@开头。<br>&emsp;&emsp;注意：滥用用户变量会导致程序难以理解及管理<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"string\">'Hello World'</span> <span class=\"keyword\">into</span> @x;</div><div class=\"line\"><span class=\"keyword\">SELECT</span> @x;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">SET</span> @y=<span class=\"string\">'Goodbye Cruel World'</span>;</div><div class=\"line\"><span class=\"keyword\">SELECT</span> @y;</div><div class=\"line\"><span class=\"keyword\">SET</span> @z=<span class=\"number\">1</span>+<span class=\"number\">2</span>+<span class=\"number\">3</span>;</div><div class=\"line\"><span class=\"keyword\">SELECT</span> @z;</div></pre></td></tr></table></figure></p>\n<p>执行结果:<br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201450582-1967285160.png\" alt=\"此处输入图片的描述\"><br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201451254-1893179304.png\" alt=\"此处输入图片的描述\"><br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201451910-256935933.png\" alt=\"此处输入图片的描述\"></p>\n<ul>\n<li><p>在存储过程中使用用户变量</p>\n <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> GreetWorld() <span class=\"keyword\">SELECT</span> <span class=\"keyword\">CONCAT</span>(@greeting,<span class=\"string\">' World'</span>);</div><div class=\"line\"><span class=\"keyword\">SET</span> @greeting=<span class=\"string\">'Hello'</span>;</div><div class=\"line\"><span class=\"keyword\">CALL</span> GreetWorld();</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<pre><code>执行结果:\n![此处输入图片的描述][7]\n</code></pre><ul>\n<li><p>在存储过程间传递全局范围的用户变量</p>\n <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> p1() <span class=\"keyword\">SET</span> @last_proc=<span class=\"string\">'p1'</span>;</div><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> p2() <span class=\"keyword\">SELECT</span> <span class=\"keyword\">CONCAT</span>(<span class=\"string\">'Last procedure was '</span>,@last_proc);</div><div class=\"line\"><span class=\"keyword\">CALL</span> p1();</div><div class=\"line\"><span class=\"keyword\">CALL</span> p2();</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<pre><code>执行结果:\n![此处输入图片的描述][8]\n</code></pre><h4 id=\"1-4-5-变量作用域\"><a href=\"#1-4-5-变量作用域\" class=\"headerlink\" title=\"1.4.5 变量作用域\"></a>1.4.5 变量作用域</h4><p>&emsp;&emsp;内部变量在其作用域范围内享有更高的优先权，当执行到end时，内部变量消失，不再可见了，在存储过程外再也找不到这个内部变量，但是可以通过out参数或者将其值指派给会话变量来保存其值。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">#变量作用域</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc()</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE x1 VARCHAR(5) DEFAULT 'outer';</div><div class=\"line\">        BEGIN</div><div class=\"line\">          DECLARE x1 VARCHAR(5) DEFAULT 'inner';</div><div class=\"line\">          SELECT x1;</div><div class=\"line\">        END;</div><div class=\"line\">      SELECT x1;</div><div class=\"line\">    END;</div><div class=\"line\">    //</div><div class=\"line\">DELIMITER ;</div><div class=\"line\">#调用</div><div class=\"line\">CALL proc();</div></pre></td></tr></table></figure>\n<p>执行结果：<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">inner  outer</div></pre></td></tr></table></figure></p>\n<h3 id=\"1-5-存储过程的CRUD\"><a href=\"#1-5-存储过程的CRUD\" class=\"headerlink\" title=\"1.5 存储过程的CRUD\"></a>1.5 存储过程的CRUD</h3><h4 id=\"1-5-1-调用\"><a href=\"#1-5-1-调用\" class=\"headerlink\" title=\"1.5.1 调用\"></a>1.5.1 调用</h4><p>&emsp;&emsp;用call和你过程名以及一个括号，括号里面根据需要，加入参数，参数包括输入参数、输出参数、输入输出参数。</p>\n<h4 id=\"1-5-2-查询\"><a href=\"#1-5-2-查询\" class=\"headerlink\" title=\"1.5.2 查询\"></a>1.5.2 查询</h4><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">#查询存储过程</div><div class=\"line\">SELECT name FROM mysql.proc WHERE db='数据库名';</div><div class=\"line\">SELECT routine_name FROM information_schema.routines WHERE routine_schema='数据库名';</div><div class=\"line\">SHOW PROCEDURE STATUS WHERE db='数据库名';</div><div class=\"line\"></div><div class=\"line\">#查看存储过程详细信息</div><div class=\"line\">SHOW CREATE PROCEDURE 数据库.存储过程名;</div></pre></td></tr></table></figure>\n<h4 id=\"1-5-3-修改\"><a href=\"#1-5-3-修改\" class=\"headerlink\" title=\"1.5.3 修改\"></a>1.5.3 修改</h4><p>&emsp;&emsp;<strong>ALTER PROCEDURE 更改用CREATE PROCEDURE 建立的预先指定的存储过程，其不会影响相关存储过程或存储功能。</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">ALTER</span> &#123;<span class=\"keyword\">PROCEDURE</span> | <span class=\"keyword\">FUNCTION</span>&#125; sp_name [characteristic ...]</div><div class=\"line\">characteristic:&#123; CONTAINS <span class=\"keyword\">SQL</span> | <span class=\"keyword\">NO</span> <span class=\"keyword\">SQL</span> | <span class=\"keyword\">READS</span> <span class=\"keyword\">SQL</span> <span class=\"keyword\">DATA</span> | MODIFIES <span class=\"keyword\">SQL</span> <span class=\"keyword\">DATA</span> &#125;</div><div class=\"line\">| <span class=\"keyword\">SQL</span> <span class=\"keyword\">SECURITY</span> &#123; DEFINER | INVOKER &#125;</div><div class=\"line\">| <span class=\"keyword\">COMMENT</span> <span class=\"string\">'string'</span></div></pre></td></tr></table></figure>\n<ul>\n<li>sp_name参数表示存储过程或函数的名称；</li>\n<li>characteristic参数指定存储函数的特性。</li>\n<li>CONTAINS SQL表示子程序包含SQL语句，但不包含读或写数据的语句；</li>\n<li>NO SQL表示子程序中不包含SQL语句；</li>\n<li>READS SQL DATA表示子程序中包含读数据的语句；</li>\n<li>MODIFIES SQL DATA表示子程序中包含写数据的语句。</li>\n<li>SQL SECURITY { DEFINER | INVOKER }指明谁有权限来执行，DEFINER表示只有定义者自己才能够执行；INVOKER表示调用者可以执行。</li>\n<li>COMMENT ‘string’是注释信息。</li>\n</ul>\n<p>Example:<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">#将读写权限改为MODIFIES SQL DATA，并指明调用者可以执行。</div><div class=\"line\">ALTER  PROCEDURE  num_from_employee</div><div class=\"line\">  MODIFIES SQL DATA</div><div class=\"line\">  SQL SECURITY INVOKER ;</div><div class=\"line\">#将读写权限改为READS SQL DATA，并加上注释信息'FIND NAME'。</div><div class=\"line\">ALTER  PROCEDURE  name_from_employee</div><div class=\"line\">  READS SQL DATA</div><div class=\"line\">  COMMENT 'FIND NAME' ;</div></pre></td></tr></table></figure></p>\n<h4 id=\"1-5-4-删除\"><a href=\"#1-5-4-删除\" class=\"headerlink\" title=\"1.5.4 删除\"></a>1.5.4 删除</h4><p>&emsp;&emsp;<strong>DROP PROCEDURE [过程1[,过程2…]]</strong><br>&emsp;&emsp;从MySQL的表格中删除一个或多个存储过程。</p>\n<h3 id=\"1-6-控制语句\"><a href=\"#1-6-控制语句\" class=\"headerlink\" title=\"1.6 控制语句\"></a>1.6 控制语句</h3><h4 id=\"1-6-1-条件语句\"><a href=\"#1-6-1-条件语句\" class=\"headerlink\" title=\"1.6.1 条件语句\"></a>1.6.1 条件语句</h4><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">#条件语句IF-THEN-ELSE</div><div class=\"line\">DROP PROCEDURE IF EXISTS proc3;</div><div class=\"line\">DELIMITER //</div><div class=\"line\">CREATE PROCEDURE proc3(IN parameter int)</div><div class=\"line\">  BEGIN</div><div class=\"line\">    DECLARE var int;</div><div class=\"line\">    SET var=parameter+1;</div><div class=\"line\">    IF var=0 THEN</div><div class=\"line\">      INSERT INTO t VALUES (17);</div><div class=\"line\">    END IF ;</div><div class=\"line\">    IF parameter=0 THEN</div><div class=\"line\">      UPDATE t SET s1=s1+1;</div><div class=\"line\">    ELSE</div><div class=\"line\">      UPDATE t SET s1=s1+2;</div><div class=\"line\">    END IF ;</div><div class=\"line\">  END ;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">#CASE-WHEN-THEN-ELSE语句</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc4 (IN parameter INT)</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE var INT;</div><div class=\"line\">      SET var=parameter+1;</div><div class=\"line\">      CASE var</div><div class=\"line\">        WHEN 0 THEN</div><div class=\"line\">          INSERT INTO t VALUES (17);</div><div class=\"line\">        WHEN 1 THEN</div><div class=\"line\">          INSERT INTO t VALUES (18);</div><div class=\"line\">        ELSE</div><div class=\"line\">          INSERT INTO t VALUES (19);</div><div class=\"line\">      END CASE ;</div><div class=\"line\">    END ;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<h4 id=\"1-6-2-循环语句\"><a href=\"#1-6-2-循环语句\" class=\"headerlink\" title=\"1.6.2 循环语句\"></a>1.6.2 循环语句</h4><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">#WHILE-DO…END-WHILE语句</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc5()</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE var INT;</div><div class=\"line\">      SET var=0;</div><div class=\"line\">      WHILE var&lt;6 DO</div><div class=\"line\">        INSERT INTO t VALUES (var);</div><div class=\"line\">        SET var=var+1;</div><div class=\"line\">      END WHILE ;</div><div class=\"line\">    END;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">#REPEAT...END REPEAT</div><div class=\"line\">#此语句的特点是执行操作后检查结果</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc6 ()</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE v INT;</div><div class=\"line\">      SET v=0;</div><div class=\"line\">      REPEAT</div><div class=\"line\">        INSERT INTO t VALUES(v);</div><div class=\"line\">        SET v=v+1;</div><div class=\"line\">        UNTIL v&gt;=5</div><div class=\"line\">      END REPEAT;</div><div class=\"line\">    END;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">#LOOP...END LOOP</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc7 ()</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE v INT;</div><div class=\"line\">      SET v=0;</div><div class=\"line\">      LOOP_LABLE:LOOP</div><div class=\"line\">        INSERT INTO t VALUES(v);</div><div class=\"line\">        SET v=v+1;</div><div class=\"line\">        IF v &gt;=5 THEN</div><div class=\"line\">          LEAVE LOOP_LABLE;</div><div class=\"line\">        END IF;</div><div class=\"line\">      END LOOP;</div><div class=\"line\">    END;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<p><strong>LABLES标号</strong><br>&emsp;&emsp;标号可以用在begin repeat while 或者loop语句前，语句标号只能在合法的语句前面使用。可以跳出循环，使运行指令达到复合语句的最后一步。</p>\n<h4 id=\"1-6-3-迭代\"><a href=\"#1-6-3-迭代\" class=\"headerlink\" title=\"1.6.3 迭代\"></a>1.6.3 迭代</h4><p>&emsp;&emsp;通过引用复合语句的标号,来从新开始复合语句</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">#ITERATE</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc8()</div><div class=\"line\">  BEGIN</div><div class=\"line\">    DECLARE v INT;</div><div class=\"line\">    SET v=0;</div><div class=\"line\">    LOOP_LABLE:LOOP</div><div class=\"line\">      IF v=3 THEN</div><div class=\"line\">        SET v=v+1;</div><div class=\"line\">        ITERATE LOOP_LABLE;</div><div class=\"line\">      END IF;</div><div class=\"line\">      INSERT INTO t VALUES(v);</div><div class=\"line\">      SET v=v+1;</div><div class=\"line\">      IF v&gt;=5 THEN</div><div class=\"line\">        LEAVE LOOP_LABLE;</div><div class=\"line\">      END IF;</div><div class=\"line\">    END LOOP;</div><div class=\"line\">  END;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<h2 id=\"2-MySQL存储过程的基本函数\"><a href=\"#2-MySQL存储过程的基本函数\" class=\"headerlink\" title=\"2. MySQL存储过程的基本函数\"></a>2. MySQL存储过程的基本函数</h2><h3 id=\"2-1-字符串类\"><a href=\"#2-1-字符串类\" class=\"headerlink\" title=\"2.1 字符串类\"></a>2.1 字符串类</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\">CHARSET(str) //返回字串字符集</div><div class=\"line\">CONCAT (string2 [,... ]) //连接字串</div><div class=\"line\">INSTR (string ,substring ) //返回substring首次在string中出现的位置,不存在返回0</div><div class=\"line\">LCASE (string2 ) //转换成小写</div><div class=\"line\">LEFT (string2 ,length ) //从string2中的左边起取length个字符</div><div class=\"line\">LENGTH (string ) //string长度</div><div class=\"line\">LOAD_FILE (file_name ) //从文件读取内容</div><div class=\"line\">LOCATE (substring , string [,start_position ] ) 同INSTR,但可指定开始位置</div><div class=\"line\">LPAD (string2 ,length ,pad ) //重复用pad加在string开头,直到字串长度为length</div><div class=\"line\">LTRIM (string2 ) //去除前端空格</div><div class=\"line\">REPEAT (string2 ,count ) //重复count次</div><div class=\"line\"><span class=\"keyword\">REPLACE</span> (<span class=\"keyword\">str</span> ,search_str ,replace_str ) //在<span class=\"keyword\">str</span>中用replace_str替换search_str</div><div class=\"line\">RPAD (string2 ,<span class=\"keyword\">length</span> ,<span class=\"keyword\">pad</span>) //在<span class=\"keyword\">str</span>后用<span class=\"keyword\">pad</span>补充,直到长度为<span class=\"keyword\">length</span></div><div class=\"line\"><span class=\"keyword\">RTRIM</span> (string2 ) //去除后端空格</div><div class=\"line\"><span class=\"keyword\">STRCMP</span> (string1 ,string2 ) //逐字符比较两字串大小,</div><div class=\"line\"><span class=\"keyword\">SUBSTRING</span> (<span class=\"keyword\">str</span> , <span class=\"keyword\">position</span> [,<span class=\"keyword\">length</span> ]) //从<span class=\"keyword\">str</span>的<span class=\"keyword\">position</span>开始,取<span class=\"keyword\">length</span>个字符,</div><div class=\"line\">注：mysql中处理字符串时，默认第一个字符下标为<span class=\"number\">1</span>，即参数<span class=\"keyword\">position</span>必须大于等于<span class=\"number\">1</span></div><div class=\"line\"><span class=\"keyword\">TRIM</span>([[<span class=\"keyword\">BOTH</span>|<span class=\"keyword\">LEADING</span>|TRAILING] [padding] <span class=\"keyword\">FROM</span>]string2) //去除指定位置的指定字符</div><div class=\"line\"><span class=\"keyword\">UCASE</span> (string2 ) //转换成大写</div><div class=\"line\"><span class=\"keyword\">RIGHT</span>(string2,<span class=\"keyword\">length</span>) //取string2最后<span class=\"keyword\">length</span>个字符</div><div class=\"line\"><span class=\"keyword\">SPACE</span>(<span class=\"keyword\">count</span>) //生成<span class=\"keyword\">count</span>个空格</div></pre></td></tr></table></figure>\n<h3 id=\"2-2-数学类\"><a href=\"#2-2-数学类\" class=\"headerlink\" title=\"2.2 数学类\"></a>2.2 数学类</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">ABS (number2 ) //绝对值</div><div class=\"line\">BIN (decimal_number ) //十进制转二进制</div><div class=\"line\">CEILING (number2 ) //向上取整</div><div class=\"line\">CONV(number2,from_base,to_base) //进制转换</div><div class=\"line\">FLOOR (number2 ) //向下取整</div><div class=\"line\">FORMAT (number,decimal_places ) //保留小数位数</div><div class=\"line\">HEX (DecimalNumber ) //转十六进制</div><div class=\"line\">注：HEX()中可传入字符串，则返回其ASC-11码，如HEX('DEF')返回4142143</div><div class=\"line\">也可以传入十进制整数，返回其十六进制编码，如HEX(25)返回19</div><div class=\"line\">LEAST (number , number2 [,..]) //求最小值</div><div class=\"line\">MOD (numerator ,denominator ) //求余</div><div class=\"line\">POWER (number ,power ) //求指数</div><div class=\"line\">RAND([seed]) //随机数</div><div class=\"line\">ROUND (number [,decimals ]) //四舍五入,decimals为小数位数]</div><div class=\"line\">SIGN (number2 ) // 正数返回1，负数返回-1注：返回类型并非均为整数，如：</div><div class=\"line\">SQRT(number2) //开平方</div></pre></td></tr></table></figure>\n<h3 id=\"2-3-时间类\"><a href=\"#2-3-时间类\" class=\"headerlink\" title=\"2.3 时间类\"></a>2.3 时间类</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\">ADDTIME (date2 ,time_interval ) //将time_interval加到date2</div><div class=\"line\">CONVERT_TZ (datetime2 ,fromTZ ,toTZ ) //转换时区</div><div class=\"line\">CURRENT_DATE ( ) //当前日期</div><div class=\"line\">CURRENT_TIME ( ) //当前时间</div><div class=\"line\">CURRENT_TIMESTAMP ( ) //当前时间戳</div><div class=\"line\">DATE (datetime ) //返回datetime的日期部分</div><div class=\"line\">DATE_ADD (date2 , INTERVAL d_value d_type ) //在date2中加上日期或时间</div><div class=\"line\">DATE_FORMAT (datetime ,FormatCodes ) //使用formatcodes格式显示datetime</div><div class=\"line\">DATE_SUB (date2 , INTERVAL d_value d_type ) //在date2上减去一个时间</div><div class=\"line\">DATEDIFF (date1 ,date2 ) //两个日期差</div><div class=\"line\">DAY (date ) //返回日期的天</div><div class=\"line\">DAYNAME (date ) //英文星期</div><div class=\"line\">DAYOFWEEK (date ) //星期(1-7) ,1为星期天</div><div class=\"line\">DAYOFYEAR (date ) //一年中的第几天</div><div class=\"line\">EXTRACT (interval_name FROM date ) //从date中提取日期的指定部分</div><div class=\"line\">MAKEDATE (year ,day ) //给出年及年中的第几天,生成日期串</div><div class=\"line\">MAKETIME (hour ,minute ,second ) //生成时间串</div><div class=\"line\">MONTHNAME (date ) //英文月份名</div><div class=\"line\">NOW ( ) //当前时间</div><div class=\"line\">SEC_TO_TIME (seconds ) //秒数转成时间</div><div class=\"line\">STR_TO_DATE (string ,format ) //字串转成时间,以format格式显示</div><div class=\"line\">TIMEDIFF (datetime1 ,datetime2 ) //两个时间差</div><div class=\"line\">TIME_TO_SEC (time ) //时间转秒数]</div><div class=\"line\">WEEK (date_time [,start_of_week ]) //第几周</div><div class=\"line\">YEAR (datetime ) //年份</div><div class=\"line\">DAYOFMONTH(datetime) //月的第几天</div><div class=\"line\">HOUR(datetime) //小时</div><div class=\"line\">LAST_DAY(date) //date的月的最后日期</div><div class=\"line\">MICROSECOND(datetime) //微秒</div><div class=\"line\">MONTH(datetime) //月</div><div class=\"line\">MINUTE(datetime) //分返回符号,正负或0</div></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h2 id=\"1-存储过程\"><a href=\"#1-存储过程\" class=\"headerlink\" title=\"1. 存储过程\"></a>1. 存储过程</h2><h3 id=\"1-1-简介\"><a href=\"#1-1-简介\" class=\"headerlink\" title=\"1.1 简介\"></a>1.1 简介</h3><p>&emsp;&emsp;普通的sql语句在执行的时候需要先编译再执行，而存储过程（Stored Procedure）是一组为了特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定的存储过程名称并给定参数（如果有的话）来调用执行它。<br>&emsp;&emsp;存储过程是可编程的函数，在数据库中创建并保存，可以由SQL语句和控制结构组成。当想要在不同的应用程序或平台上执行相同的函数，或者封装特定功能时，存储过程是非常有用的。数据库中的存储过程可以看做是对编程中面向对象方法的模拟，它允许控制数据的访问方式。<br>","more":"</p>\n<h3 id=\"1-2-优点\"><a href=\"#1-2-优点\" class=\"headerlink\" title=\"1.2 优点\"></a>1.2 优点</h3><ol>\n<li>增强SQL语言的功能和灵活性：存储过程可以用流控制语句编写，有很强的灵活性，可以完成复杂的判断和较复杂的运算。</li>\n<li>标准组件式编程：存储过程被创建后，可以在程序中被多次调用，而不必重新编写该存储过程的SQL语句。而且数据库专业人员可以随时对存储过程进行修改，对应用程序源代码毫无影响。</li>\n<li>较快的执行速度：如果某一操作包含大量的Transaction-SQL代码或分别被多次执行，那么存储过程要比批处理的执行速度快很多。因为存储过程是预编译的。在首次运行一个存储过程时查询，优化器对其进行分析优化，并且给出最终被存储在系统表中的执行计划。而批处理的Transaction-SQL语句在每次运行时都要进行编译和优化，速度相对要慢一些。</li>\n<li>减少网络流量：针对同一个数据库对象的操作（如查询、修改），如果这一操作所涉及的Transaction-SQL语句被组织程存储过程，那么当在客户计算机上调用该存储过程时，网络中传送的只是该调用语句，从而大大增加了网络流量并降低了网络负载。</li>\n<li>安全机制：通过对执行某一存储过程的权限进行限制，能够实现对相应的数据的访问权限的限制，避免了非授权用户对数据的访问，保证了数据的安全。</li>\n</ol>\n<h3 id=\"1-3-存储过程创建\"><a href=\"#1-3-存储过程创建\" class=\"headerlink\" title=\"1.3 存储过程创建\"></a>1.3 存储过程创建</h3><h4 id=\"1-3-1-语法\"><a href=\"#1-3-1-语法\" class=\"headerlink\" title=\"1.3.1 语法\"></a>1.3.1 语法</h4><p><strong>CREATE PROCEDURE  过程名([[IN|OUT|INOUT] 参数名 数据类型[,[IN|OUT|INOUT] 参数名 数据类型…]]) [特性 …] 过程体</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">DELIMITER //</div><div class=\"line\">  <span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> myproc(<span class=\"keyword\">OUT</span> s <span class=\"built_in\">int</span>)</div><div class=\"line\">    <span class=\"keyword\">BEGIN</span></div><div class=\"line\">      <span class=\"keyword\">SELECT</span> <span class=\"keyword\">COUNT</span>(*) <span class=\"keyword\">INTO</span> s <span class=\"keyword\">FROM</span> students;</div><div class=\"line\">    <span class=\"keyword\">END</span></div><div class=\"line\">    //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<h4 id=\"1-3-2-分隔符\"><a href=\"#1-3-2-分隔符\" class=\"headerlink\" title=\"1.3.2 分隔符\"></a>1.3.2 分隔符</h4><p>&emsp;&emsp;MySQL默认以”;”为分隔符，如果没有声明分割符，则编译器会把存储过程当成SQL语句进行处理，因此编译过程会报错，所以要事先用“DELIMITER //”声明当前段分隔符，让编译器把两个”//“之间的内容当做存储过程的代码，不会执行这些代码；“DELIMITER ;”的意为把分隔符还原。</p>\n<h4 id=\"1-3-3-参数\"><a href=\"#1-3-3-参数\" class=\"headerlink\" title=\"1.3.3 参数\"></a>1.3.3 参数</h4><p>&emsp;&emsp;存储过程根据需要可能会有输入、输出、输入输出参数，如果有多个参数用”,”分割开。MySQL存储过程的参数用在存储过程的定义，共有三种参数类型,IN,OUT,INOUT:</p>\n<ul>\n<li>IN:参数的值必须在调用存储过程时指定，在存储过程中修改该参数的值不能被返回，为默认值.</li>\n<li>OUT:值可在存储过程内部被改变，并可返回.</li>\n<li>INOUT:调用时指定，并且可被改变和返回.</li>\n</ul>\n<h4 id=\"2-3-4-过程体\"><a href=\"#2-3-4-过程体\" class=\"headerlink\" title=\"2.3.4 过程体\"></a>2.3.4 过程体</h4><p>&emsp;&emsp;过程体的开始与结束使用BEGIN与END进行标识。</p>\n<h3 id=\"1-4-变量\"><a href=\"#1-4-变量\" class=\"headerlink\" title=\"1.4 变量\"></a>1.4 变量</h3><h4 id=\"1-4-1-声明变量\"><a href=\"#1-4-1-声明变量\" class=\"headerlink\" title=\"1.4.1 声明变量\"></a>1.4.1 声明变量</h4><p>&emsp;&emsp;<strong>DECLARE 变量名1[,变量名2…] 数据类型 [默认值];</strong></p>\n<h4 id=\"1-4-2-数值类型\"><a href=\"#1-4-2-数值类型\" class=\"headerlink\" title=\"1.4.2 数值类型\"></a>1.4.2 数值类型</h4><p>&emsp;&emsp;数据类型为MySQL的数据类型</p>\n<ol>\n<li>数值类型!<br> <img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201446988-1864698114.png\" alt=\"此处输入图片的描述\"></li>\n<li>日期和时间类型!<br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201448332-1505149268.png\" alt=\"此处输入图片的描述\"></li>\n<li>字符串类型!<br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201449535-2004058554.png\" alt=\"此处输入图片的描述\"></li>\n</ol>\n<h4 id=\"1-4-3-变量赋值\"><a href=\"#1-4-3-变量赋值\" class=\"headerlink\" title=\"1.4.3 变量赋值\"></a>1.4.3 变量赋值</h4><p>&emsp;&emsp;<strong>SET 变量名 = 变量值 [,变量名= 变量值 …]</strong></p>\n<h4 id=\"1-4-4-用户变量\"><a href=\"#1-4-4-用户变量\" class=\"headerlink\" title=\"1.4.4 用户变量\"></a>1.4.4 用户变量</h4><p>&emsp;&emsp;用户变量一般以@开头。<br>&emsp;&emsp;注意：滥用用户变量会导致程序难以理解及管理<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"string\">'Hello World'</span> <span class=\"keyword\">into</span> @x;</div><div class=\"line\"><span class=\"keyword\">SELECT</span> @x;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">SET</span> @y=<span class=\"string\">'Goodbye Cruel World'</span>;</div><div class=\"line\"><span class=\"keyword\">SELECT</span> @y;</div><div class=\"line\"><span class=\"keyword\">SET</span> @z=<span class=\"number\">1</span>+<span class=\"number\">2</span>+<span class=\"number\">3</span>;</div><div class=\"line\"><span class=\"keyword\">SELECT</span> @z;</div></pre></td></tr></table></figure></p>\n<p>执行结果:<br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201450582-1967285160.png\" alt=\"此处输入图片的描述\"><br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201451254-1893179304.png\" alt=\"此处输入图片的描述\"><br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201451910-256935933.png\" alt=\"此处输入图片的描述\"></p>\n<ul>\n<li><p>在存储过程中使用用户变量</p>\n <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> GreetWorld() <span class=\"keyword\">SELECT</span> <span class=\"keyword\">CONCAT</span>(@greeting,<span class=\"string\">' World'</span>);</div><div class=\"line\"><span class=\"keyword\">SET</span> @greeting=<span class=\"string\">'Hello'</span>;</div><div class=\"line\"><span class=\"keyword\">CALL</span> GreetWorld();</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<pre><code>执行结果:\n![此处输入图片的描述][7]\n</code></pre><ul>\n<li><p>在存储过程间传递全局范围的用户变量</p>\n <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> p1() <span class=\"keyword\">SET</span> @last_proc=<span class=\"string\">'p1'</span>;</div><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> p2() <span class=\"keyword\">SELECT</span> <span class=\"keyword\">CONCAT</span>(<span class=\"string\">'Last procedure was '</span>,@last_proc);</div><div class=\"line\"><span class=\"keyword\">CALL</span> p1();</div><div class=\"line\"><span class=\"keyword\">CALL</span> p2();</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<pre><code>执行结果:\n![此处输入图片的描述][8]\n</code></pre><h4 id=\"1-4-5-变量作用域\"><a href=\"#1-4-5-变量作用域\" class=\"headerlink\" title=\"1.4.5 变量作用域\"></a>1.4.5 变量作用域</h4><p>&emsp;&emsp;内部变量在其作用域范围内享有更高的优先权，当执行到end时，内部变量消失，不再可见了，在存储过程外再也找不到这个内部变量，但是可以通过out参数或者将其值指派给会话变量来保存其值。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">#变量作用域</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc()</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE x1 VARCHAR(5) DEFAULT 'outer';</div><div class=\"line\">        BEGIN</div><div class=\"line\">          DECLARE x1 VARCHAR(5) DEFAULT 'inner';</div><div class=\"line\">          SELECT x1;</div><div class=\"line\">        END;</div><div class=\"line\">      SELECT x1;</div><div class=\"line\">    END;</div><div class=\"line\">    //</div><div class=\"line\">DELIMITER ;</div><div class=\"line\">#调用</div><div class=\"line\">CALL proc();</div></pre></td></tr></table></figure>\n<p>执行结果：<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">inner  outer</div></pre></td></tr></table></figure></p>\n<h3 id=\"1-5-存储过程的CRUD\"><a href=\"#1-5-存储过程的CRUD\" class=\"headerlink\" title=\"1.5 存储过程的CRUD\"></a>1.5 存储过程的CRUD</h3><h4 id=\"1-5-1-调用\"><a href=\"#1-5-1-调用\" class=\"headerlink\" title=\"1.5.1 调用\"></a>1.5.1 调用</h4><p>&emsp;&emsp;用call和你过程名以及一个括号，括号里面根据需要，加入参数，参数包括输入参数、输出参数、输入输出参数。</p>\n<h4 id=\"1-5-2-查询\"><a href=\"#1-5-2-查询\" class=\"headerlink\" title=\"1.5.2 查询\"></a>1.5.2 查询</h4><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">#查询存储过程</div><div class=\"line\">SELECT name FROM mysql.proc WHERE db='数据库名';</div><div class=\"line\">SELECT routine_name FROM information_schema.routines WHERE routine_schema='数据库名';</div><div class=\"line\">SHOW PROCEDURE STATUS WHERE db='数据库名';</div><div class=\"line\"></div><div class=\"line\">#查看存储过程详细信息</div><div class=\"line\">SHOW CREATE PROCEDURE 数据库.存储过程名;</div></pre></td></tr></table></figure>\n<h4 id=\"1-5-3-修改\"><a href=\"#1-5-3-修改\" class=\"headerlink\" title=\"1.5.3 修改\"></a>1.5.3 修改</h4><p>&emsp;&emsp;<strong>ALTER PROCEDURE 更改用CREATE PROCEDURE 建立的预先指定的存储过程，其不会影响相关存储过程或存储功能。</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">ALTER</span> &#123;<span class=\"keyword\">PROCEDURE</span> | <span class=\"keyword\">FUNCTION</span>&#125; sp_name [characteristic ...]</div><div class=\"line\">characteristic:&#123; CONTAINS <span class=\"keyword\">SQL</span> | <span class=\"keyword\">NO</span> <span class=\"keyword\">SQL</span> | <span class=\"keyword\">READS</span> <span class=\"keyword\">SQL</span> <span class=\"keyword\">DATA</span> | MODIFIES <span class=\"keyword\">SQL</span> <span class=\"keyword\">DATA</span> &#125;</div><div class=\"line\">| <span class=\"keyword\">SQL</span> <span class=\"keyword\">SECURITY</span> &#123; DEFINER | INVOKER &#125;</div><div class=\"line\">| <span class=\"keyword\">COMMENT</span> <span class=\"string\">'string'</span></div></pre></td></tr></table></figure>\n<ul>\n<li>sp_name参数表示存储过程或函数的名称；</li>\n<li>characteristic参数指定存储函数的特性。</li>\n<li>CONTAINS SQL表示子程序包含SQL语句，但不包含读或写数据的语句；</li>\n<li>NO SQL表示子程序中不包含SQL语句；</li>\n<li>READS SQL DATA表示子程序中包含读数据的语句；</li>\n<li>MODIFIES SQL DATA表示子程序中包含写数据的语句。</li>\n<li>SQL SECURITY { DEFINER | INVOKER }指明谁有权限来执行，DEFINER表示只有定义者自己才能够执行；INVOKER表示调用者可以执行。</li>\n<li>COMMENT ‘string’是注释信息。</li>\n</ul>\n<p>Example:<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">#将读写权限改为MODIFIES SQL DATA，并指明调用者可以执行。</div><div class=\"line\">ALTER  PROCEDURE  num_from_employee</div><div class=\"line\">  MODIFIES SQL DATA</div><div class=\"line\">  SQL SECURITY INVOKER ;</div><div class=\"line\">#将读写权限改为READS SQL DATA，并加上注释信息'FIND NAME'。</div><div class=\"line\">ALTER  PROCEDURE  name_from_employee</div><div class=\"line\">  READS SQL DATA</div><div class=\"line\">  COMMENT 'FIND NAME' ;</div></pre></td></tr></table></figure></p>\n<h4 id=\"1-5-4-删除\"><a href=\"#1-5-4-删除\" class=\"headerlink\" title=\"1.5.4 删除\"></a>1.5.4 删除</h4><p>&emsp;&emsp;<strong>DROP PROCEDURE [过程1[,过程2…]]</strong><br>&emsp;&emsp;从MySQL的表格中删除一个或多个存储过程。</p>\n<h3 id=\"1-6-控制语句\"><a href=\"#1-6-控制语句\" class=\"headerlink\" title=\"1.6 控制语句\"></a>1.6 控制语句</h3><h4 id=\"1-6-1-条件语句\"><a href=\"#1-6-1-条件语句\" class=\"headerlink\" title=\"1.6.1 条件语句\"></a>1.6.1 条件语句</h4><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">#条件语句IF-THEN-ELSE</div><div class=\"line\">DROP PROCEDURE IF EXISTS proc3;</div><div class=\"line\">DELIMITER //</div><div class=\"line\">CREATE PROCEDURE proc3(IN parameter int)</div><div class=\"line\">  BEGIN</div><div class=\"line\">    DECLARE var int;</div><div class=\"line\">    SET var=parameter+1;</div><div class=\"line\">    IF var=0 THEN</div><div class=\"line\">      INSERT INTO t VALUES (17);</div><div class=\"line\">    END IF ;</div><div class=\"line\">    IF parameter=0 THEN</div><div class=\"line\">      UPDATE t SET s1=s1+1;</div><div class=\"line\">    ELSE</div><div class=\"line\">      UPDATE t SET s1=s1+2;</div><div class=\"line\">    END IF ;</div><div class=\"line\">  END ;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">#CASE-WHEN-THEN-ELSE语句</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc4 (IN parameter INT)</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE var INT;</div><div class=\"line\">      SET var=parameter+1;</div><div class=\"line\">      CASE var</div><div class=\"line\">        WHEN 0 THEN</div><div class=\"line\">          INSERT INTO t VALUES (17);</div><div class=\"line\">        WHEN 1 THEN</div><div class=\"line\">          INSERT INTO t VALUES (18);</div><div class=\"line\">        ELSE</div><div class=\"line\">          INSERT INTO t VALUES (19);</div><div class=\"line\">      END CASE ;</div><div class=\"line\">    END ;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<h4 id=\"1-6-2-循环语句\"><a href=\"#1-6-2-循环语句\" class=\"headerlink\" title=\"1.6.2 循环语句\"></a>1.6.2 循环语句</h4><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">#WHILE-DO…END-WHILE语句</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc5()</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE var INT;</div><div class=\"line\">      SET var=0;</div><div class=\"line\">      WHILE var&lt;6 DO</div><div class=\"line\">        INSERT INTO t VALUES (var);</div><div class=\"line\">        SET var=var+1;</div><div class=\"line\">      END WHILE ;</div><div class=\"line\">    END;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">#REPEAT...END REPEAT</div><div class=\"line\">#此语句的特点是执行操作后检查结果</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc6 ()</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE v INT;</div><div class=\"line\">      SET v=0;</div><div class=\"line\">      REPEAT</div><div class=\"line\">        INSERT INTO t VALUES(v);</div><div class=\"line\">        SET v=v+1;</div><div class=\"line\">        UNTIL v&gt;=5</div><div class=\"line\">      END REPEAT;</div><div class=\"line\">    END;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">#LOOP...END LOOP</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc7 ()</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE v INT;</div><div class=\"line\">      SET v=0;</div><div class=\"line\">      LOOP_LABLE:LOOP</div><div class=\"line\">        INSERT INTO t VALUES(v);</div><div class=\"line\">        SET v=v+1;</div><div class=\"line\">        IF v &gt;=5 THEN</div><div class=\"line\">          LEAVE LOOP_LABLE;</div><div class=\"line\">        END IF;</div><div class=\"line\">      END LOOP;</div><div class=\"line\">    END;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<p><strong>LABLES标号</strong><br>&emsp;&emsp;标号可以用在begin repeat while 或者loop语句前，语句标号只能在合法的语句前面使用。可以跳出循环，使运行指令达到复合语句的最后一步。</p>\n<h4 id=\"1-6-3-迭代\"><a href=\"#1-6-3-迭代\" class=\"headerlink\" title=\"1.6.3 迭代\"></a>1.6.3 迭代</h4><p>&emsp;&emsp;通过引用复合语句的标号,来从新开始复合语句</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">#ITERATE</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc8()</div><div class=\"line\">  BEGIN</div><div class=\"line\">    DECLARE v INT;</div><div class=\"line\">    SET v=0;</div><div class=\"line\">    LOOP_LABLE:LOOP</div><div class=\"line\">      IF v=3 THEN</div><div class=\"line\">        SET v=v+1;</div><div class=\"line\">        ITERATE LOOP_LABLE;</div><div class=\"line\">      END IF;</div><div class=\"line\">      INSERT INTO t VALUES(v);</div><div class=\"line\">      SET v=v+1;</div><div class=\"line\">      IF v&gt;=5 THEN</div><div class=\"line\">        LEAVE LOOP_LABLE;</div><div class=\"line\">      END IF;</div><div class=\"line\">    END LOOP;</div><div class=\"line\">  END;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<h2 id=\"2-MySQL存储过程的基本函数\"><a href=\"#2-MySQL存储过程的基本函数\" class=\"headerlink\" title=\"2. MySQL存储过程的基本函数\"></a>2. MySQL存储过程的基本函数</h2><h3 id=\"2-1-字符串类\"><a href=\"#2-1-字符串类\" class=\"headerlink\" title=\"2.1 字符串类\"></a>2.1 字符串类</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\">CHARSET(str) //返回字串字符集</div><div class=\"line\">CONCAT (string2 [,... ]) //连接字串</div><div class=\"line\">INSTR (string ,substring ) //返回substring首次在string中出现的位置,不存在返回0</div><div class=\"line\">LCASE (string2 ) //转换成小写</div><div class=\"line\">LEFT (string2 ,length ) //从string2中的左边起取length个字符</div><div class=\"line\">LENGTH (string ) //string长度</div><div class=\"line\">LOAD_FILE (file_name ) //从文件读取内容</div><div class=\"line\">LOCATE (substring , string [,start_position ] ) 同INSTR,但可指定开始位置</div><div class=\"line\">LPAD (string2 ,length ,pad ) //重复用pad加在string开头,直到字串长度为length</div><div class=\"line\">LTRIM (string2 ) //去除前端空格</div><div class=\"line\">REPEAT (string2 ,count ) //重复count次</div><div class=\"line\"><span class=\"keyword\">REPLACE</span> (<span class=\"keyword\">str</span> ,search_str ,replace_str ) //在<span class=\"keyword\">str</span>中用replace_str替换search_str</div><div class=\"line\">RPAD (string2 ,<span class=\"keyword\">length</span> ,<span class=\"keyword\">pad</span>) //在<span class=\"keyword\">str</span>后用<span class=\"keyword\">pad</span>补充,直到长度为<span class=\"keyword\">length</span></div><div class=\"line\"><span class=\"keyword\">RTRIM</span> (string2 ) //去除后端空格</div><div class=\"line\"><span class=\"keyword\">STRCMP</span> (string1 ,string2 ) //逐字符比较两字串大小,</div><div class=\"line\"><span class=\"keyword\">SUBSTRING</span> (<span class=\"keyword\">str</span> , <span class=\"keyword\">position</span> [,<span class=\"keyword\">length</span> ]) //从<span class=\"keyword\">str</span>的<span class=\"keyword\">position</span>开始,取<span class=\"keyword\">length</span>个字符,</div><div class=\"line\">注：mysql中处理字符串时，默认第一个字符下标为<span class=\"number\">1</span>，即参数<span class=\"keyword\">position</span>必须大于等于<span class=\"number\">1</span></div><div class=\"line\"><span class=\"keyword\">TRIM</span>([[<span class=\"keyword\">BOTH</span>|<span class=\"keyword\">LEADING</span>|TRAILING] [padding] <span class=\"keyword\">FROM</span>]string2) //去除指定位置的指定字符</div><div class=\"line\"><span class=\"keyword\">UCASE</span> (string2 ) //转换成大写</div><div class=\"line\"><span class=\"keyword\">RIGHT</span>(string2,<span class=\"keyword\">length</span>) //取string2最后<span class=\"keyword\">length</span>个字符</div><div class=\"line\"><span class=\"keyword\">SPACE</span>(<span class=\"keyword\">count</span>) //生成<span class=\"keyword\">count</span>个空格</div></pre></td></tr></table></figure>\n<h3 id=\"2-2-数学类\"><a href=\"#2-2-数学类\" class=\"headerlink\" title=\"2.2 数学类\"></a>2.2 数学类</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">ABS (number2 ) //绝对值</div><div class=\"line\">BIN (decimal_number ) //十进制转二进制</div><div class=\"line\">CEILING (number2 ) //向上取整</div><div class=\"line\">CONV(number2,from_base,to_base) //进制转换</div><div class=\"line\">FLOOR (number2 ) //向下取整</div><div class=\"line\">FORMAT (number,decimal_places ) //保留小数位数</div><div class=\"line\">HEX (DecimalNumber ) //转十六进制</div><div class=\"line\">注：HEX()中可传入字符串，则返回其ASC-11码，如HEX('DEF')返回4142143</div><div class=\"line\">也可以传入十进制整数，返回其十六进制编码，如HEX(25)返回19</div><div class=\"line\">LEAST (number , number2 [,..]) //求最小值</div><div class=\"line\">MOD (numerator ,denominator ) //求余</div><div class=\"line\">POWER (number ,power ) //求指数</div><div class=\"line\">RAND([seed]) //随机数</div><div class=\"line\">ROUND (number [,decimals ]) //四舍五入,decimals为小数位数]</div><div class=\"line\">SIGN (number2 ) // 正数返回1，负数返回-1注：返回类型并非均为整数，如：</div><div class=\"line\">SQRT(number2) //开平方</div></pre></td></tr></table></figure>\n<h3 id=\"2-3-时间类\"><a href=\"#2-3-时间类\" class=\"headerlink\" title=\"2.3 时间类\"></a>2.3 时间类</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\">ADDTIME (date2 ,time_interval ) //将time_interval加到date2</div><div class=\"line\">CONVERT_TZ (datetime2 ,fromTZ ,toTZ ) //转换时区</div><div class=\"line\">CURRENT_DATE ( ) //当前日期</div><div class=\"line\">CURRENT_TIME ( ) //当前时间</div><div class=\"line\">CURRENT_TIMESTAMP ( ) //当前时间戳</div><div class=\"line\">DATE (datetime ) //返回datetime的日期部分</div><div class=\"line\">DATE_ADD (date2 , INTERVAL d_value d_type ) //在date2中加上日期或时间</div><div class=\"line\">DATE_FORMAT (datetime ,FormatCodes ) //使用formatcodes格式显示datetime</div><div class=\"line\">DATE_SUB (date2 , INTERVAL d_value d_type ) //在date2上减去一个时间</div><div class=\"line\">DATEDIFF (date1 ,date2 ) //两个日期差</div><div class=\"line\">DAY (date ) //返回日期的天</div><div class=\"line\">DAYNAME (date ) //英文星期</div><div class=\"line\">DAYOFWEEK (date ) //星期(1-7) ,1为星期天</div><div class=\"line\">DAYOFYEAR (date ) //一年中的第几天</div><div class=\"line\">EXTRACT (interval_name FROM date ) //从date中提取日期的指定部分</div><div class=\"line\">MAKEDATE (year ,day ) //给出年及年中的第几天,生成日期串</div><div class=\"line\">MAKETIME (hour ,minute ,second ) //生成时间串</div><div class=\"line\">MONTHNAME (date ) //英文月份名</div><div class=\"line\">NOW ( ) //当前时间</div><div class=\"line\">SEC_TO_TIME (seconds ) //秒数转成时间</div><div class=\"line\">STR_TO_DATE (string ,format ) //字串转成时间,以format格式显示</div><div class=\"line\">TIMEDIFF (datetime1 ,datetime2 ) //两个时间差</div><div class=\"line\">TIME_TO_SEC (time ) //时间转秒数]</div><div class=\"line\">WEEK (date_time [,start_of_week ]) //第几周</div><div class=\"line\">YEAR (datetime ) //年份</div><div class=\"line\">DAYOFMONTH(datetime) //月的第几天</div><div class=\"line\">HOUR(datetime) //小时</div><div class=\"line\">LAST_DAY(date) //date的月的最后日期</div><div class=\"line\">MICROSECOND(datetime) //微秒</div><div class=\"line\">MONTH(datetime) //月</div><div class=\"line\">MINUTE(datetime) //分返回符号,正负或0</div></pre></td></tr></table></figure>"},{"title":"Mysql——触发器","date":"2018-02-13T01:34:00.000Z","_content":"触发器（TRIGGER）是MySQL的数据库对象之一，从5.0.2版本开始支持。它和函数比较相似，也需要声明和执行，但是它不用程序或人工调用，而是由事件驱动的。\n\n那么，什么是触发器？\n    \n在MySQL Server里面也就是对某一个表的一定的操作，触发某种条件（Insert,Update,Delete 等），从而自动执行的一段程序。从这种意义上讲触发器是一个特殊的存储过程\n<!--more-->\n\n## 1、语法\n\n```sql\nCREATE TRIGGER trigger_name\ntrigger_time trigger_event\nON tbl_name\nFOR EACH ROW \ntrigger_body              \n```\n\n - trigger_name：触发器的名称，不能与已经存在的触发器重复；\n - trigger_time：{ BEFORE | AFTER }，表示在事件之前或之后触发；\n - trigger_event:：{ INSERT |UPDATE | DELETE }，触发该触发器的具体事件；\n - tbl_name：该触发器作用在tbl_name上；\n - trigger_body：sql语句\n\n你必须拥有相当大的权限才能创建触发器（CREATE TRIGGER），如果你已经是Root用户，那么就足够了。这跟SQL的标准有所不同。\n\n## 2、实例\n\n创建学生表\n\n```sql\nCREATE TABLE `student` (\n  `id` int(5) NOT NULL AUTO_INCREMENT,\n  `classId` int(5) NOT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8\n```\n\n创建班级表\n\n```sql\nCREATE TABLE `class` (\n  `id` int(5) NOT NULL,\n  `name` varchar(10) NOT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8\n```\n\n创建插入触发器\n\n```sql\nCREATE TRIGGER tri_insert\nAFTER INSERT \nON student\nFOR EACH ROW\nBEGIN\n  DECLARE c INT;\n  SET c = (SELECT num from class WHERE id = new.classId);\n  UPDATE class SET num = c + 1 WHERE id = new.classId;\nEND\n```\n\n插入一条数据到student表，class表对应的班级学生数+1\n\n## 3、变量详解\n\nMySQL 中使用 DECLARE 来定义一局部变量，该变量只能在 BEGIN … END 复合语句中使用，并且应该定义在复合语句的开头，\n\n即其它语句之前，语法如下：\n\n```sql\nDECLARE var_name[,...] type [DEFAULT value]\n```\n\n - var_name 为变量名称，同 SQL 语句一样，变量名不区分大小写；\n - type 为 MySQL 支持的任何数据类型；可以同时定义多个同类型的变量，用逗号隔开；\n\n变量初始值为 NULL，如果需要，可以使用DEFAULT子句提供默认值，值可以被指定为一个表达式。\n\n对变量赋值采用 SET 语句，语法为：\n\n```sql\nSET var_name = expr [,var_name = expr] ...\n```\n\n## 4、NEW 与 OLD 详解\n\n上述示例中使用了NEW关键字，和 MS SQL Server 中的 INSERTED 和 DELETED 类似，MySQL 中定义了 NEW 和 OLD，用来表示\n\n触发器的所在表中，触发了触发器的那一行数据。\n具体地：\n在 INSERT 型触发器中，NEW用来表示将要（BEFORE）或已经（AFTER）插入的新数据；\n在 UPDATE 型触发器中，OLD用来表示将要或已经被修改的原数据，NEW用来表示将要或已经修改为的新数据；\n在 DELETE 型触发器中，OLD 用来表示将要或已经被删除的原数据；\n\n使用方法： NEW.columnName （columnName 为相应数据表某一列名）\n另外，OLD 是只读的，而 NEW 则可以在触发器中使用 SET 赋值，这样不会再次触发触发器，造成循环调用（如每插入一个学生前，都在其学号前加“2013”）。\n\n## 5、查看与删除触发器\n\n和查看数据库（show databases;）查看表格（showtables;）一样，查看触发器的语法如下：\n\n```sql\nSHOW TRIGGERS [FROM schema_name];\n```\n\n其中，schema_name 即 Schema 的名称，在 MySQL 中 Schema 和 Database 是一样的，也就是说，可以指定数据库名，这样就不必先“USE database_name;”了。\n \n和删除数据库、删除表格一样，删除触发器的语法如下：\n \n```sql\nDROP TRIGGER [IF EXISTS] [schema_name.]trigger_name\n```\n## 6、执行顺序\n\n我们建立的数据库一般都是 InnoDB 数据库，其上建立的表是事务性表，也就是事务安全的。这时，若SQL语句或触发器执行失败，MySQL 会回滚事务，有：\n\n①如果 BEFORE 触发器执行失败，SQL 无法正确执行。\n②SQL 执行失败时，AFTER 型触发器不会触发。\n③AFTER 类型的触发器执行失败，SQL 会回滚。\n  \n","source":"_posts/Mysql——触发器.md","raw":"---\ntitle: Mysql——触发器\ncategories:\n  - Mysql\ntags:\n  - Mysql\ndate: 2018-02-13 09:34:00\n---\n触发器（TRIGGER）是MySQL的数据库对象之一，从5.0.2版本开始支持。它和函数比较相似，也需要声明和执行，但是它不用程序或人工调用，而是由事件驱动的。\n\n那么，什么是触发器？\n    \n在MySQL Server里面也就是对某一个表的一定的操作，触发某种条件（Insert,Update,Delete 等），从而自动执行的一段程序。从这种意义上讲触发器是一个特殊的存储过程\n<!--more-->\n\n## 1、语法\n\n```sql\nCREATE TRIGGER trigger_name\ntrigger_time trigger_event\nON tbl_name\nFOR EACH ROW \ntrigger_body              \n```\n\n - trigger_name：触发器的名称，不能与已经存在的触发器重复；\n - trigger_time：{ BEFORE | AFTER }，表示在事件之前或之后触发；\n - trigger_event:：{ INSERT |UPDATE | DELETE }，触发该触发器的具体事件；\n - tbl_name：该触发器作用在tbl_name上；\n - trigger_body：sql语句\n\n你必须拥有相当大的权限才能创建触发器（CREATE TRIGGER），如果你已经是Root用户，那么就足够了。这跟SQL的标准有所不同。\n\n## 2、实例\n\n创建学生表\n\n```sql\nCREATE TABLE `student` (\n  `id` int(5) NOT NULL AUTO_INCREMENT,\n  `classId` int(5) NOT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8\n```\n\n创建班级表\n\n```sql\nCREATE TABLE `class` (\n  `id` int(5) NOT NULL,\n  `name` varchar(10) NOT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8\n```\n\n创建插入触发器\n\n```sql\nCREATE TRIGGER tri_insert\nAFTER INSERT \nON student\nFOR EACH ROW\nBEGIN\n  DECLARE c INT;\n  SET c = (SELECT num from class WHERE id = new.classId);\n  UPDATE class SET num = c + 1 WHERE id = new.classId;\nEND\n```\n\n插入一条数据到student表，class表对应的班级学生数+1\n\n## 3、变量详解\n\nMySQL 中使用 DECLARE 来定义一局部变量，该变量只能在 BEGIN … END 复合语句中使用，并且应该定义在复合语句的开头，\n\n即其它语句之前，语法如下：\n\n```sql\nDECLARE var_name[,...] type [DEFAULT value]\n```\n\n - var_name 为变量名称，同 SQL 语句一样，变量名不区分大小写；\n - type 为 MySQL 支持的任何数据类型；可以同时定义多个同类型的变量，用逗号隔开；\n\n变量初始值为 NULL，如果需要，可以使用DEFAULT子句提供默认值，值可以被指定为一个表达式。\n\n对变量赋值采用 SET 语句，语法为：\n\n```sql\nSET var_name = expr [,var_name = expr] ...\n```\n\n## 4、NEW 与 OLD 详解\n\n上述示例中使用了NEW关键字，和 MS SQL Server 中的 INSERTED 和 DELETED 类似，MySQL 中定义了 NEW 和 OLD，用来表示\n\n触发器的所在表中，触发了触发器的那一行数据。\n具体地：\n在 INSERT 型触发器中，NEW用来表示将要（BEFORE）或已经（AFTER）插入的新数据；\n在 UPDATE 型触发器中，OLD用来表示将要或已经被修改的原数据，NEW用来表示将要或已经修改为的新数据；\n在 DELETE 型触发器中，OLD 用来表示将要或已经被删除的原数据；\n\n使用方法： NEW.columnName （columnName 为相应数据表某一列名）\n另外，OLD 是只读的，而 NEW 则可以在触发器中使用 SET 赋值，这样不会再次触发触发器，造成循环调用（如每插入一个学生前，都在其学号前加“2013”）。\n\n## 5、查看与删除触发器\n\n和查看数据库（show databases;）查看表格（showtables;）一样，查看触发器的语法如下：\n\n```sql\nSHOW TRIGGERS [FROM schema_name];\n```\n\n其中，schema_name 即 Schema 的名称，在 MySQL 中 Schema 和 Database 是一样的，也就是说，可以指定数据库名，这样就不必先“USE database_name;”了。\n \n和删除数据库、删除表格一样，删除触发器的语法如下：\n \n```sql\nDROP TRIGGER [IF EXISTS] [schema_name.]trigger_name\n```\n## 6、执行顺序\n\n我们建立的数据库一般都是 InnoDB 数据库，其上建立的表是事务性表，也就是事务安全的。这时，若SQL语句或触发器执行失败，MySQL 会回滚事务，有：\n\n①如果 BEFORE 触发器执行失败，SQL 无法正确执行。\n②SQL 执行失败时，AFTER 型触发器不会触发。\n③AFTER 类型的触发器执行失败，SQL 会回滚。\n  \n","slug":"Mysql——触发器","published":1,"updated":"2018-02-27T07:38:38.087Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspew000hn8vfffcghu8k","content":"<p>触发器（TRIGGER）是MySQL的数据库对象之一，从5.0.2版本开始支持。它和函数比较相似，也需要声明和执行，但是它不用程序或人工调用，而是由事件驱动的。</p>\n<p>那么，什么是触发器？</p>\n<p>在MySQL Server里面也就是对某一个表的一定的操作，触发某种条件（Insert,Update,Delete 等），从而自动执行的一段程序。从这种意义上讲触发器是一个特殊的存储过程<br><a id=\"more\"></a></p>\n<h2 id=\"1、语法\"><a href=\"#1、语法\" class=\"headerlink\" title=\"1、语法\"></a>1、语法</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TRIGGER</span> trigger_name</div><div class=\"line\">trigger_time trigger_event</div><div class=\"line\"><span class=\"keyword\">ON</span> tbl_name</div><div class=\"line\"><span class=\"keyword\">FOR</span> <span class=\"keyword\">EACH</span> <span class=\"keyword\">ROW</span> </div><div class=\"line\">trigger_body</div></pre></td></tr></table></figure>\n<ul>\n<li>trigger_name：触发器的名称，不能与已经存在的触发器重复；</li>\n<li>trigger_time：{ BEFORE | AFTER }，表示在事件之前或之后触发；</li>\n<li>trigger_event:：{ INSERT |UPDATE | DELETE }，触发该触发器的具体事件；</li>\n<li>tbl_name：该触发器作用在tbl_name上；</li>\n<li>trigger_body：sql语句</li>\n</ul>\n<p>你必须拥有相当大的权限才能创建触发器（CREATE TRIGGER），如果你已经是Root用户，那么就足够了。这跟SQL的标准有所不同。</p>\n<h2 id=\"2、实例\"><a href=\"#2、实例\" class=\"headerlink\" title=\"2、实例\"></a>2、实例</h2><p>创建学生表</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"string\">`student`</span> (</div><div class=\"line\">  <span class=\"string\">`id`</span> <span class=\"built_in\">int</span>(<span class=\"number\">5</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> AUTO_INCREMENT,</div><div class=\"line\">  <span class=\"string\">`classId`</span> <span class=\"built_in\">int</span>(<span class=\"number\">5</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  PRIMARY <span class=\"keyword\">KEY</span> (<span class=\"string\">`id`</span>)</div><div class=\"line\">) <span class=\"keyword\">ENGINE</span>=<span class=\"keyword\">InnoDB</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">CHARSET</span>=utf8</div></pre></td></tr></table></figure>\n<p>创建班级表</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"string\">`class`</span> (</div><div class=\"line\">  <span class=\"string\">`id`</span> <span class=\"built_in\">int</span>(<span class=\"number\">5</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  <span class=\"string\">`name`</span> <span class=\"built_in\">varchar</span>(<span class=\"number\">10</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  PRIMARY <span class=\"keyword\">KEY</span> (<span class=\"string\">`id`</span>)</div><div class=\"line\">) <span class=\"keyword\">ENGINE</span>=<span class=\"keyword\">InnoDB</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">CHARSET</span>=utf8</div></pre></td></tr></table></figure>\n<p>创建插入触发器</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TRIGGER</span> tri_insert</div><div class=\"line\"><span class=\"keyword\">AFTER</span> <span class=\"keyword\">INSERT</span> </div><div class=\"line\"><span class=\"keyword\">ON</span> student</div><div class=\"line\"><span class=\"keyword\">FOR</span> <span class=\"keyword\">EACH</span> <span class=\"keyword\">ROW</span></div><div class=\"line\"><span class=\"keyword\">BEGIN</span></div><div class=\"line\">  <span class=\"keyword\">DECLARE</span> c <span class=\"built_in\">INT</span>;</div><div class=\"line\">  <span class=\"keyword\">SET</span> c = (<span class=\"keyword\">SELECT</span> <span class=\"keyword\">num</span> <span class=\"keyword\">from</span> <span class=\"keyword\">class</span> <span class=\"keyword\">WHERE</span> <span class=\"keyword\">id</span> = new.classId);</div><div class=\"line\">  <span class=\"keyword\">UPDATE</span> <span class=\"keyword\">class</span> <span class=\"keyword\">SET</span> <span class=\"keyword\">num</span> = c + <span class=\"number\">1</span> <span class=\"keyword\">WHERE</span> <span class=\"keyword\">id</span> = new.classId;</div><div class=\"line\"><span class=\"keyword\">END</span></div></pre></td></tr></table></figure>\n<p>插入一条数据到student表，class表对应的班级学生数+1</p>\n<h2 id=\"3、变量详解\"><a href=\"#3、变量详解\" class=\"headerlink\" title=\"3、变量详解\"></a>3、变量详解</h2><p>MySQL 中使用 DECLARE 来定义一局部变量，该变量只能在 BEGIN … END 复合语句中使用，并且应该定义在复合语句的开头，</p>\n<p>即其它语句之前，语法如下：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">DECLARE</span> var_name[,...] <span class=\"keyword\">type</span> [<span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">value</span>]</div></pre></td></tr></table></figure>\n<ul>\n<li>var_name 为变量名称，同 SQL 语句一样，变量名不区分大小写；</li>\n<li>type 为 MySQL 支持的任何数据类型；可以同时定义多个同类型的变量，用逗号隔开；</li>\n</ul>\n<p>变量初始值为 NULL，如果需要，可以使用DEFAULT子句提供默认值，值可以被指定为一个表达式。</p>\n<p>对变量赋值采用 SET 语句，语法为：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">SET</span> var_name = expr [,var_name = expr] ...</div></pre></td></tr></table></figure>\n<h2 id=\"4、NEW-与-OLD-详解\"><a href=\"#4、NEW-与-OLD-详解\" class=\"headerlink\" title=\"4、NEW 与 OLD 详解\"></a>4、NEW 与 OLD 详解</h2><p>上述示例中使用了NEW关键字，和 MS SQL Server 中的 INSERTED 和 DELETED 类似，MySQL 中定义了 NEW 和 OLD，用来表示</p>\n<p>触发器的所在表中，触发了触发器的那一行数据。<br>具体地：<br>在 INSERT 型触发器中，NEW用来表示将要（BEFORE）或已经（AFTER）插入的新数据；<br>在 UPDATE 型触发器中，OLD用来表示将要或已经被修改的原数据，NEW用来表示将要或已经修改为的新数据；<br>在 DELETE 型触发器中，OLD 用来表示将要或已经被删除的原数据；</p>\n<p>使用方法： NEW.columnName （columnName 为相应数据表某一列名）<br>另外，OLD 是只读的，而 NEW 则可以在触发器中使用 SET 赋值，这样不会再次触发触发器，造成循环调用（如每插入一个学生前，都在其学号前加“2013”）。</p>\n<h2 id=\"5、查看与删除触发器\"><a href=\"#5、查看与删除触发器\" class=\"headerlink\" title=\"5、查看与删除触发器\"></a>5、查看与删除触发器</h2><p>和查看数据库（show databases;）查看表格（showtables;）一样，查看触发器的语法如下：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">SHOW</span> <span class=\"keyword\">TRIGGERS</span> [<span class=\"keyword\">FROM</span> schema_name];</div></pre></td></tr></table></figure>\n<p>其中，schema_name 即 Schema 的名称，在 MySQL 中 Schema 和 Database 是一样的，也就是说，可以指定数据库名，这样就不必先“USE database_name;”了。</p>\n<p>和删除数据库、删除表格一样，删除触发器的语法如下：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">TRIGGER</span> [<span class=\"keyword\">IF</span> <span class=\"keyword\">EXISTS</span>] [schema_name.]trigger_name</div></pre></td></tr></table></figure>\n<h2 id=\"6、执行顺序\"><a href=\"#6、执行顺序\" class=\"headerlink\" title=\"6、执行顺序\"></a>6、执行顺序</h2><p>我们建立的数据库一般都是 InnoDB 数据库，其上建立的表是事务性表，也就是事务安全的。这时，若SQL语句或触发器执行失败，MySQL 会回滚事务，有：</p>\n<p>①如果 BEFORE 触发器执行失败，SQL 无法正确执行。<br>②SQL 执行失败时，AFTER 型触发器不会触发。<br>③AFTER 类型的触发器执行失败，SQL 会回滚。</p>\n","site":{"data":{}},"excerpt":"<p>触发器（TRIGGER）是MySQL的数据库对象之一，从5.0.2版本开始支持。它和函数比较相似，也需要声明和执行，但是它不用程序或人工调用，而是由事件驱动的。</p>\n<p>那么，什么是触发器？</p>\n<p>在MySQL Server里面也就是对某一个表的一定的操作，触发某种条件（Insert,Update,Delete 等），从而自动执行的一段程序。从这种意义上讲触发器是一个特殊的存储过程<br>","more":"</p>\n<h2 id=\"1、语法\"><a href=\"#1、语法\" class=\"headerlink\" title=\"1、语法\"></a>1、语法</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TRIGGER</span> trigger_name</div><div class=\"line\">trigger_time trigger_event</div><div class=\"line\"><span class=\"keyword\">ON</span> tbl_name</div><div class=\"line\"><span class=\"keyword\">FOR</span> <span class=\"keyword\">EACH</span> <span class=\"keyword\">ROW</span> </div><div class=\"line\">trigger_body</div></pre></td></tr></table></figure>\n<ul>\n<li>trigger_name：触发器的名称，不能与已经存在的触发器重复；</li>\n<li>trigger_time：{ BEFORE | AFTER }，表示在事件之前或之后触发；</li>\n<li>trigger_event:：{ INSERT |UPDATE | DELETE }，触发该触发器的具体事件；</li>\n<li>tbl_name：该触发器作用在tbl_name上；</li>\n<li>trigger_body：sql语句</li>\n</ul>\n<p>你必须拥有相当大的权限才能创建触发器（CREATE TRIGGER），如果你已经是Root用户，那么就足够了。这跟SQL的标准有所不同。</p>\n<h2 id=\"2、实例\"><a href=\"#2、实例\" class=\"headerlink\" title=\"2、实例\"></a>2、实例</h2><p>创建学生表</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"string\">`student`</span> (</div><div class=\"line\">  <span class=\"string\">`id`</span> <span class=\"built_in\">int</span>(<span class=\"number\">5</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> AUTO_INCREMENT,</div><div class=\"line\">  <span class=\"string\">`classId`</span> <span class=\"built_in\">int</span>(<span class=\"number\">5</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  PRIMARY <span class=\"keyword\">KEY</span> (<span class=\"string\">`id`</span>)</div><div class=\"line\">) <span class=\"keyword\">ENGINE</span>=<span class=\"keyword\">InnoDB</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">CHARSET</span>=utf8</div></pre></td></tr></table></figure>\n<p>创建班级表</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"string\">`class`</span> (</div><div class=\"line\">  <span class=\"string\">`id`</span> <span class=\"built_in\">int</span>(<span class=\"number\">5</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  <span class=\"string\">`name`</span> <span class=\"built_in\">varchar</span>(<span class=\"number\">10</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  PRIMARY <span class=\"keyword\">KEY</span> (<span class=\"string\">`id`</span>)</div><div class=\"line\">) <span class=\"keyword\">ENGINE</span>=<span class=\"keyword\">InnoDB</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">CHARSET</span>=utf8</div></pre></td></tr></table></figure>\n<p>创建插入触发器</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TRIGGER</span> tri_insert</div><div class=\"line\"><span class=\"keyword\">AFTER</span> <span class=\"keyword\">INSERT</span> </div><div class=\"line\"><span class=\"keyword\">ON</span> student</div><div class=\"line\"><span class=\"keyword\">FOR</span> <span class=\"keyword\">EACH</span> <span class=\"keyword\">ROW</span></div><div class=\"line\"><span class=\"keyword\">BEGIN</span></div><div class=\"line\">  <span class=\"keyword\">DECLARE</span> c <span class=\"built_in\">INT</span>;</div><div class=\"line\">  <span class=\"keyword\">SET</span> c = (<span class=\"keyword\">SELECT</span> <span class=\"keyword\">num</span> <span class=\"keyword\">from</span> <span class=\"keyword\">class</span> <span class=\"keyword\">WHERE</span> <span class=\"keyword\">id</span> = new.classId);</div><div class=\"line\">  <span class=\"keyword\">UPDATE</span> <span class=\"keyword\">class</span> <span class=\"keyword\">SET</span> <span class=\"keyword\">num</span> = c + <span class=\"number\">1</span> <span class=\"keyword\">WHERE</span> <span class=\"keyword\">id</span> = new.classId;</div><div class=\"line\"><span class=\"keyword\">END</span></div></pre></td></tr></table></figure>\n<p>插入一条数据到student表，class表对应的班级学生数+1</p>\n<h2 id=\"3、变量详解\"><a href=\"#3、变量详解\" class=\"headerlink\" title=\"3、变量详解\"></a>3、变量详解</h2><p>MySQL 中使用 DECLARE 来定义一局部变量，该变量只能在 BEGIN … END 复合语句中使用，并且应该定义在复合语句的开头，</p>\n<p>即其它语句之前，语法如下：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">DECLARE</span> var_name[,...] <span class=\"keyword\">type</span> [<span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">value</span>]</div></pre></td></tr></table></figure>\n<ul>\n<li>var_name 为变量名称，同 SQL 语句一样，变量名不区分大小写；</li>\n<li>type 为 MySQL 支持的任何数据类型；可以同时定义多个同类型的变量，用逗号隔开；</li>\n</ul>\n<p>变量初始值为 NULL，如果需要，可以使用DEFAULT子句提供默认值，值可以被指定为一个表达式。</p>\n<p>对变量赋值采用 SET 语句，语法为：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">SET</span> var_name = expr [,var_name = expr] ...</div></pre></td></tr></table></figure>\n<h2 id=\"4、NEW-与-OLD-详解\"><a href=\"#4、NEW-与-OLD-详解\" class=\"headerlink\" title=\"4、NEW 与 OLD 详解\"></a>4、NEW 与 OLD 详解</h2><p>上述示例中使用了NEW关键字，和 MS SQL Server 中的 INSERTED 和 DELETED 类似，MySQL 中定义了 NEW 和 OLD，用来表示</p>\n<p>触发器的所在表中，触发了触发器的那一行数据。<br>具体地：<br>在 INSERT 型触发器中，NEW用来表示将要（BEFORE）或已经（AFTER）插入的新数据；<br>在 UPDATE 型触发器中，OLD用来表示将要或已经被修改的原数据，NEW用来表示将要或已经修改为的新数据；<br>在 DELETE 型触发器中，OLD 用来表示将要或已经被删除的原数据；</p>\n<p>使用方法： NEW.columnName （columnName 为相应数据表某一列名）<br>另外，OLD 是只读的，而 NEW 则可以在触发器中使用 SET 赋值，这样不会再次触发触发器，造成循环调用（如每插入一个学生前，都在其学号前加“2013”）。</p>\n<h2 id=\"5、查看与删除触发器\"><a href=\"#5、查看与删除触发器\" class=\"headerlink\" title=\"5、查看与删除触发器\"></a>5、查看与删除触发器</h2><p>和查看数据库（show databases;）查看表格（showtables;）一样，查看触发器的语法如下：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">SHOW</span> <span class=\"keyword\">TRIGGERS</span> [<span class=\"keyword\">FROM</span> schema_name];</div></pre></td></tr></table></figure>\n<p>其中，schema_name 即 Schema 的名称，在 MySQL 中 Schema 和 Database 是一样的，也就是说，可以指定数据库名，这样就不必先“USE database_name;”了。</p>\n<p>和删除数据库、删除表格一样，删除触发器的语法如下：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">TRIGGER</span> [<span class=\"keyword\">IF</span> <span class=\"keyword\">EXISTS</span>] [schema_name.]trigger_name</div></pre></td></tr></table></figure>\n<h2 id=\"6、执行顺序\"><a href=\"#6、执行顺序\" class=\"headerlink\" title=\"6、执行顺序\"></a>6、执行顺序</h2><p>我们建立的数据库一般都是 InnoDB 数据库，其上建立的表是事务性表，也就是事务安全的。这时，若SQL语句或触发器执行失败，MySQL 会回滚事务，有：</p>\n<p>①如果 BEFORE 触发器执行失败，SQL 无法正确执行。<br>②SQL 执行失败时，AFTER 型触发器不会触发。<br>③AFTER 类型的触发器执行失败，SQL 会回滚。</p>"},{"title":"Java线程池的创建","date":"2017-10-12T03:13:25.000Z","_content":"## 1. Executor框架\n\n从JDK 1.5 开始，java.util.concurrent包中的Executor执行器将用来管理Thread对象，从而简化并发编程。\n\n**Executor**是一套线程池管理框架，接口里只有一个方法execute，执行Runnable任务。\n**ExecutorService**接口扩展了Executor，添加了线程生命周期的管理，提供任务终止、返回任务结果等方法。\n**AbstractExecutorService**实现了ExecutorService，提供例如submit方法的默认实现逻辑。\n\n然后到今天的主题**ThreadPoolExecutor**，继承了AbstractExecutorService，提供线程池的具体实现。\n\n<!--more-->\n\n## 2. ThreadPoolExecutor\n\n### 2.1 构造\n\nThreadPoolExecutor的构造方法有四种，下面是参数最全的构造：\n\n```java\npublic ThreadPoolExecutor(int corePoolSize, \n\t\tint maximumPoolSize, \n\t\tlong keepAliveTime, \n\t\tTimeUnit unit, \n\t\tBlockingQueue<Runnable> workQueue, \n\t\tThreadFactory threadFactory,\n        RejectedExecutionHandler handler) {\n\t\n}\n```\n\n - corePoolSize:线程池目标大小，即刚刚创建时的线程数\n - maximumPoolSize: 线程池的最大上限\n - keepAliveTime: 线程的存活时间，当线程池内的线程数量超过corePoolSize，超出存活时间的空闲线程就会被回收；\n - unit: 时间单位\n - workQueue: 缓存队列\n - threadFactory: 线程工厂\n - handler: 缓存队列饱和处理策略\n\n### 2.2 定制线程池\n\nThreadPoolExecutor中有几个预先设置好的线程池，通过Executors的工厂方法创建。\n\n#### 2.2.1 newFixedThreadPool\n\n```java\npublic static ExecutorService newFixedThreadPool(int nThreads) {\n        return new ThreadPoolExecutor(nThreads, nThreads,\n                                      0L, TimeUnit.MILLISECONDS,\n                                      new LinkedBlockingQueue<Runnable>());\n    }\n```\n\nnewFixedThreadPool的corePoolSize和maximumPoolSize都设置为传入的固定数量，keepAliveTim设置为0。线程池创建后，线程数量将会固定不变，适合需要线程很稳定的场合。\n\n#### 2.2.2 newSingleThreadExecutor\n\n```java\npublic static ExecutorService newSingleThreadExecutor() {\n        return new FinalizableDelegatedExecutorService\n            (new ThreadPoolExecutor(1, 1,\n                                    0L, TimeUnit.MILLISECONDS,\n                                    new LinkedBlockingQueue<Runnable>()));\n    }\n```\n\nnewSingleThreadExecutor是线程数量固定为1的newFixedThreadPool版本，保证池内的任务串行。注意到返回的是FinalizableDelegatedExecutorService，来看看源码：\n\n```java\nstatic class FinalizableDelegatedExecutorService\n    extends DelegatedExecutorService {\n    FinalizableDelegatedExecutorService(ExecutorService executor) {\n        super(executor);\n    }\n    protected void finalize() {\n        super.shutdown();\n    }\n}\n```\nFinalizableDelegatedExecutorService继承了DelegatedExecutorService，仅仅在gc时增加关闭线程池的操作，再来看看DelegatedExecutorService的源码：\n\n```java\nstatic class DelegatedExecutorService extends AbstractExecutorService {\n        private final ExecutorService e;\n        DelegatedExecutorService(ExecutorService executor) { e = executor; }\n        public void execute(Runnable command) { e.execute(command); }\n        public void shutdown() { e.shutdown(); }\n        public List<Runnable> shutdownNow() { return e.shutdownNow(); }\n        public boolean isShutdown() { return e.isShutdown(); }\n        public boolean isTerminated() { return e.isTerminated(); }\n        ...\n}\n```\nDelegatedExecutorService包装了ExecutorService，使其只暴露出ExecutorService的方法，因此不能再配置线程池的参数。本来，线程池创建的参数是可以调整的，ThreadPoolExecutor提供了set方法。使用newSingleThreadExecutor目的是生成单线程串行的线程池，如果还能配置线程池大小，那就没意思了。\n\nExecutors还提供了unconfigurableExecutorService方法，将普通线程池包装成不可配置的线程池。如果不想线程池被不明所以的后人修改，可以调用这个方法。\n\n#### 2.2.3 newCachedThreadPool\n\n```java\npublic static ExecutorService newCachedThreadPool() {\n    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,\n                                  60L, TimeUnit.SECONDS,\n                                  new SynchronousQueue<Runnable>());\n}\n```\n\nnewCachedThreadPool生成一个会缓存的线程池，线程数量可以从0到Integer.MAX_VALUE，超时时间为1分钟。线程池用起来的效果是：如果有空闲线程，会复用线程；如果没有空闲线程，会新建线程；如果线程空闲超过1分钟，将会被回收。\n\n#### 2.2.4 newScheduledThreadPool\n\n```java\npublic static ScheduledExecutorService newScheduledThreadPool(int corePoolSize) {\n        return new ScheduledThreadPoolExecutor(corePoolSize);\n    }\n```\n```java\npublic ScheduledThreadPoolExecutor(int corePoolSize) {\n        super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS,\n              new DelayedWorkQueue());\n    }\n```\n\nnewScheduledThreadPool将会创建一个可定时执行任务的线程池。这个不打算在本文展开，后续会另开文章细讲。\n\n### 2.3 等待队列\n\n看完上面四个预设置的线程池，回发现在构造中都有一个 **Queue** 参数。\n\n线程池的大小或有限（newFixedThreadPool）、或几乎无限（newCachedThreadPool），但是系统资源是有限的，任务的处理速度总有可能比不上任务的提交速度。因此，可以为ThreadPoolExecutor提供一个阻塞队列来保存因线程不足而等待的Runnable任务，这就是BlockingQueue。\n\nExecutor提供了以下几种等待队列（部分）：\n\n - ArrayBlockingQueue：数组结构的阻塞队列\n - LinkedBlockingQueue：链表结构的阻塞队列\n - PriorityBlockingQueue：有优先级的阻塞队列\n - SynchronousQueue：不会存储元素的阻塞队列\n - DelayedWorkQueue\n\nnewFixedThreadPool和newSingleThreadExecutor在默认情况下使用一个**无界的LinkedBlockingQueue**。要注意的是，如果任务一直提交，但线程池又不能及时处理，等待队列将会无限制地加长，系统资源总会有消耗殆尽的一刻。所以，推荐使用有界的等待队列，避免资源耗尽。但解决一个问题，又会带来新问题：队列填满之后，再来新任务，这个时候怎么办？后文会介绍如何处理队列饱和。\n\nnewCachedThreadPool使用的SynchronousQueue十分有趣，看名称是个队列，但它却不能存储元素。要将一个任务放进队列，必须有另一个线程去接收这个任务，一个进就有一个出，队列不会存储任何东西。因此，SynchronousQueue是一种移交机制，不能算是队列。newCachedThreadPool生成的是一个没有上限的线程池，理论上提交多少任务都可以，使用SynchronousQueue作为等待队列正合适。\n\n### 2.4 饱和策略\n\n在上一小节中说道，等待队列不能无限制的增长，但若队列填满了该如何处理？此时就是饱和策略在发挥作用。ThreadPoolExecutor的饱和策略通过传入RejectedExecutionHandler来实现。如果没有为构造函数传入，将会使用默认的defaultHandler。\n\n```java\nprivate static final RejectedExecutionHandler defaultHandler = new AbortPolicy();\n```\n\n - AbortPolicy\n\n```java\npublic static class AbortPolicy implements RejectedExecutionHandler {\n       public AbortPolicy() { }\n       public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n           throw new RejectedExecutionException(\"Task \" + r.toString() + \" rejected from \" + e.toString());\n       }\n   }\n```\n\nAbortPolicy是默认的实现，直接抛出一个RejectedExecutionException异常，让调用者自己处理。除此之外，还有几种饱和策略，来看一下\n\n - DiscardPolicy\n\n```java\npublic static class DiscardPolicy implements RejectedExecutionHandler {\n       public DiscardPolicy() { }\n       public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n       }\n   }\n```\nDiscardPolicy的rejectedExecution直接是空方法，什么也不干。如果队列满了，后续的任务都抛弃掉。\n\n - DiscardOldestPolicy\n\n```java\npublic static class DiscardOldestPolicy implements RejectedExecutionHandler {\n       public DiscardOldestPolicy() { }\n       public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n           if (!e.isShutdown()) {\n               e.getQueue().poll();\n               e.execute(r);\n           }\n       }\n   }\n```\n\nDiscardOldestPolicy会将等待队列里最旧的任务踢走，让新任务得以执行。\n\n - CallerRunsPolicy\n\n```java\npublic static class CallerRunsPolicy implements RejectedExecutionHandler {\n    public CallerRunsPolicy() { }\n    public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n        if (!e.isShutdown()) {\n            r.run();\n        }\n    }\n}\n```\n\nCallerRunsPolicy它既不抛弃新任务，也不抛弃旧任务，而是直接在当前线程运行这个任务。当前线程一般就是主线程啊，让主线程运行任务，说不定就阻塞了。如果不是想清楚了整套方案，还是少用这种策略为妙。\n\n### 2.5 ThreadFactory\n\n每当线程池需要创建一个新线程，都是通过线程工厂获取。如果不为ThreadPoolExecutor设定一个线程工厂，就会使用默认的defaultThreadFactory：\n\n```java\npublic static ThreadFactory defaultThreadFactory() {\n    return new DefaultThreadFactory();\n}\n```\n```java\nstatic class DefaultThreadFactory implements ThreadFactory {\n       private static final AtomicInteger poolNumber = new AtomicInteger(1);\n       private final ThreadGroup group;\n       private final AtomicInteger threadNumber = new AtomicInteger(1);\n       private final String namePrefix;\n\n       DefaultThreadFactory() {\n           SecurityManager s = System.getSecurityManager();\n           group = (s != null) ? s.getThreadGroup() :\n                                 Thread.currentThread().getThreadGroup();\n           namePrefix = \"pool-\" +\n                         poolNumber.getAndIncrement() +\n                        \"-thread-\";\n       }\n\n       public Thread newThread(Runnable r) {\n           Thread t = new Thread(group, r,\n                                 namePrefix + threadNumber.getAndIncrement(),\n                                 0);\n           if (t.isDaemon())\n               t.setDaemon(false);\n           if (t.getPriority() != Thread.NORM_PRIORITY)\n               t.setPriority(Thread.NORM_PRIORITY);\n           return t;\n       }\n   }\n```\n\n平时打印线程池里线程的name时，会输出形如pool-1-thread-1之类的名称，就是在这里设置的。这个默认的线程工厂，创建的线程是普通的非守护线程，如果需要定制，实现ThreadFactory后传给ThreadPoolExecutor即可。\n \n \n[参考文章链接][1]\n \n \n\n\n  [1]: http://www.jianshu.com/p/adbf37ef77bb","source":"_posts/Java线程池的创建.md","raw":"---\ntitle: Java线程池的创建\ncategories:\n  - JavaSE\ntags:\n  - Java\n  - 多线程\ndate: 2017-10-12 11:13:25\n---\n## 1. Executor框架\n\n从JDK 1.5 开始，java.util.concurrent包中的Executor执行器将用来管理Thread对象，从而简化并发编程。\n\n**Executor**是一套线程池管理框架，接口里只有一个方法execute，执行Runnable任务。\n**ExecutorService**接口扩展了Executor，添加了线程生命周期的管理，提供任务终止、返回任务结果等方法。\n**AbstractExecutorService**实现了ExecutorService，提供例如submit方法的默认实现逻辑。\n\n然后到今天的主题**ThreadPoolExecutor**，继承了AbstractExecutorService，提供线程池的具体实现。\n\n<!--more-->\n\n## 2. ThreadPoolExecutor\n\n### 2.1 构造\n\nThreadPoolExecutor的构造方法有四种，下面是参数最全的构造：\n\n```java\npublic ThreadPoolExecutor(int corePoolSize, \n\t\tint maximumPoolSize, \n\t\tlong keepAliveTime, \n\t\tTimeUnit unit, \n\t\tBlockingQueue<Runnable> workQueue, \n\t\tThreadFactory threadFactory,\n        RejectedExecutionHandler handler) {\n\t\n}\n```\n\n - corePoolSize:线程池目标大小，即刚刚创建时的线程数\n - maximumPoolSize: 线程池的最大上限\n - keepAliveTime: 线程的存活时间，当线程池内的线程数量超过corePoolSize，超出存活时间的空闲线程就会被回收；\n - unit: 时间单位\n - workQueue: 缓存队列\n - threadFactory: 线程工厂\n - handler: 缓存队列饱和处理策略\n\n### 2.2 定制线程池\n\nThreadPoolExecutor中有几个预先设置好的线程池，通过Executors的工厂方法创建。\n\n#### 2.2.1 newFixedThreadPool\n\n```java\npublic static ExecutorService newFixedThreadPool(int nThreads) {\n        return new ThreadPoolExecutor(nThreads, nThreads,\n                                      0L, TimeUnit.MILLISECONDS,\n                                      new LinkedBlockingQueue<Runnable>());\n    }\n```\n\nnewFixedThreadPool的corePoolSize和maximumPoolSize都设置为传入的固定数量，keepAliveTim设置为0。线程池创建后，线程数量将会固定不变，适合需要线程很稳定的场合。\n\n#### 2.2.2 newSingleThreadExecutor\n\n```java\npublic static ExecutorService newSingleThreadExecutor() {\n        return new FinalizableDelegatedExecutorService\n            (new ThreadPoolExecutor(1, 1,\n                                    0L, TimeUnit.MILLISECONDS,\n                                    new LinkedBlockingQueue<Runnable>()));\n    }\n```\n\nnewSingleThreadExecutor是线程数量固定为1的newFixedThreadPool版本，保证池内的任务串行。注意到返回的是FinalizableDelegatedExecutorService，来看看源码：\n\n```java\nstatic class FinalizableDelegatedExecutorService\n    extends DelegatedExecutorService {\n    FinalizableDelegatedExecutorService(ExecutorService executor) {\n        super(executor);\n    }\n    protected void finalize() {\n        super.shutdown();\n    }\n}\n```\nFinalizableDelegatedExecutorService继承了DelegatedExecutorService，仅仅在gc时增加关闭线程池的操作，再来看看DelegatedExecutorService的源码：\n\n```java\nstatic class DelegatedExecutorService extends AbstractExecutorService {\n        private final ExecutorService e;\n        DelegatedExecutorService(ExecutorService executor) { e = executor; }\n        public void execute(Runnable command) { e.execute(command); }\n        public void shutdown() { e.shutdown(); }\n        public List<Runnable> shutdownNow() { return e.shutdownNow(); }\n        public boolean isShutdown() { return e.isShutdown(); }\n        public boolean isTerminated() { return e.isTerminated(); }\n        ...\n}\n```\nDelegatedExecutorService包装了ExecutorService，使其只暴露出ExecutorService的方法，因此不能再配置线程池的参数。本来，线程池创建的参数是可以调整的，ThreadPoolExecutor提供了set方法。使用newSingleThreadExecutor目的是生成单线程串行的线程池，如果还能配置线程池大小，那就没意思了。\n\nExecutors还提供了unconfigurableExecutorService方法，将普通线程池包装成不可配置的线程池。如果不想线程池被不明所以的后人修改，可以调用这个方法。\n\n#### 2.2.3 newCachedThreadPool\n\n```java\npublic static ExecutorService newCachedThreadPool() {\n    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,\n                                  60L, TimeUnit.SECONDS,\n                                  new SynchronousQueue<Runnable>());\n}\n```\n\nnewCachedThreadPool生成一个会缓存的线程池，线程数量可以从0到Integer.MAX_VALUE，超时时间为1分钟。线程池用起来的效果是：如果有空闲线程，会复用线程；如果没有空闲线程，会新建线程；如果线程空闲超过1分钟，将会被回收。\n\n#### 2.2.4 newScheduledThreadPool\n\n```java\npublic static ScheduledExecutorService newScheduledThreadPool(int corePoolSize) {\n        return new ScheduledThreadPoolExecutor(corePoolSize);\n    }\n```\n```java\npublic ScheduledThreadPoolExecutor(int corePoolSize) {\n        super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS,\n              new DelayedWorkQueue());\n    }\n```\n\nnewScheduledThreadPool将会创建一个可定时执行任务的线程池。这个不打算在本文展开，后续会另开文章细讲。\n\n### 2.3 等待队列\n\n看完上面四个预设置的线程池，回发现在构造中都有一个 **Queue** 参数。\n\n线程池的大小或有限（newFixedThreadPool）、或几乎无限（newCachedThreadPool），但是系统资源是有限的，任务的处理速度总有可能比不上任务的提交速度。因此，可以为ThreadPoolExecutor提供一个阻塞队列来保存因线程不足而等待的Runnable任务，这就是BlockingQueue。\n\nExecutor提供了以下几种等待队列（部分）：\n\n - ArrayBlockingQueue：数组结构的阻塞队列\n - LinkedBlockingQueue：链表结构的阻塞队列\n - PriorityBlockingQueue：有优先级的阻塞队列\n - SynchronousQueue：不会存储元素的阻塞队列\n - DelayedWorkQueue\n\nnewFixedThreadPool和newSingleThreadExecutor在默认情况下使用一个**无界的LinkedBlockingQueue**。要注意的是，如果任务一直提交，但线程池又不能及时处理，等待队列将会无限制地加长，系统资源总会有消耗殆尽的一刻。所以，推荐使用有界的等待队列，避免资源耗尽。但解决一个问题，又会带来新问题：队列填满之后，再来新任务，这个时候怎么办？后文会介绍如何处理队列饱和。\n\nnewCachedThreadPool使用的SynchronousQueue十分有趣，看名称是个队列，但它却不能存储元素。要将一个任务放进队列，必须有另一个线程去接收这个任务，一个进就有一个出，队列不会存储任何东西。因此，SynchronousQueue是一种移交机制，不能算是队列。newCachedThreadPool生成的是一个没有上限的线程池，理论上提交多少任务都可以，使用SynchronousQueue作为等待队列正合适。\n\n### 2.4 饱和策略\n\n在上一小节中说道，等待队列不能无限制的增长，但若队列填满了该如何处理？此时就是饱和策略在发挥作用。ThreadPoolExecutor的饱和策略通过传入RejectedExecutionHandler来实现。如果没有为构造函数传入，将会使用默认的defaultHandler。\n\n```java\nprivate static final RejectedExecutionHandler defaultHandler = new AbortPolicy();\n```\n\n - AbortPolicy\n\n```java\npublic static class AbortPolicy implements RejectedExecutionHandler {\n       public AbortPolicy() { }\n       public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n           throw new RejectedExecutionException(\"Task \" + r.toString() + \" rejected from \" + e.toString());\n       }\n   }\n```\n\nAbortPolicy是默认的实现，直接抛出一个RejectedExecutionException异常，让调用者自己处理。除此之外，还有几种饱和策略，来看一下\n\n - DiscardPolicy\n\n```java\npublic static class DiscardPolicy implements RejectedExecutionHandler {\n       public DiscardPolicy() { }\n       public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n       }\n   }\n```\nDiscardPolicy的rejectedExecution直接是空方法，什么也不干。如果队列满了，后续的任务都抛弃掉。\n\n - DiscardOldestPolicy\n\n```java\npublic static class DiscardOldestPolicy implements RejectedExecutionHandler {\n       public DiscardOldestPolicy() { }\n       public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n           if (!e.isShutdown()) {\n               e.getQueue().poll();\n               e.execute(r);\n           }\n       }\n   }\n```\n\nDiscardOldestPolicy会将等待队列里最旧的任务踢走，让新任务得以执行。\n\n - CallerRunsPolicy\n\n```java\npublic static class CallerRunsPolicy implements RejectedExecutionHandler {\n    public CallerRunsPolicy() { }\n    public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n        if (!e.isShutdown()) {\n            r.run();\n        }\n    }\n}\n```\n\nCallerRunsPolicy它既不抛弃新任务，也不抛弃旧任务，而是直接在当前线程运行这个任务。当前线程一般就是主线程啊，让主线程运行任务，说不定就阻塞了。如果不是想清楚了整套方案，还是少用这种策略为妙。\n\n### 2.5 ThreadFactory\n\n每当线程池需要创建一个新线程，都是通过线程工厂获取。如果不为ThreadPoolExecutor设定一个线程工厂，就会使用默认的defaultThreadFactory：\n\n```java\npublic static ThreadFactory defaultThreadFactory() {\n    return new DefaultThreadFactory();\n}\n```\n```java\nstatic class DefaultThreadFactory implements ThreadFactory {\n       private static final AtomicInteger poolNumber = new AtomicInteger(1);\n       private final ThreadGroup group;\n       private final AtomicInteger threadNumber = new AtomicInteger(1);\n       private final String namePrefix;\n\n       DefaultThreadFactory() {\n           SecurityManager s = System.getSecurityManager();\n           group = (s != null) ? s.getThreadGroup() :\n                                 Thread.currentThread().getThreadGroup();\n           namePrefix = \"pool-\" +\n                         poolNumber.getAndIncrement() +\n                        \"-thread-\";\n       }\n\n       public Thread newThread(Runnable r) {\n           Thread t = new Thread(group, r,\n                                 namePrefix + threadNumber.getAndIncrement(),\n                                 0);\n           if (t.isDaemon())\n               t.setDaemon(false);\n           if (t.getPriority() != Thread.NORM_PRIORITY)\n               t.setPriority(Thread.NORM_PRIORITY);\n           return t;\n       }\n   }\n```\n\n平时打印线程池里线程的name时，会输出形如pool-1-thread-1之类的名称，就是在这里设置的。这个默认的线程工厂，创建的线程是普通的非守护线程，如果需要定制，实现ThreadFactory后传给ThreadPoolExecutor即可。\n \n \n[参考文章链接][1]\n \n \n\n\n  [1]: http://www.jianshu.com/p/adbf37ef77bb","slug":"Java线程池的创建","published":1,"updated":"2018-02-27T07:38:38.085Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspf0000mn8vfqd984uaj","content":"<h2 id=\"1-Executor框架\"><a href=\"#1-Executor框架\" class=\"headerlink\" title=\"1. Executor框架\"></a>1. Executor框架</h2><p>从JDK 1.5 开始，java.util.concurrent包中的Executor执行器将用来管理Thread对象，从而简化并发编程。</p>\n<p><strong>Executor</strong>是一套线程池管理框架，接口里只有一个方法execute，执行Runnable任务。<br><strong>ExecutorService</strong>接口扩展了Executor，添加了线程生命周期的管理，提供任务终止、返回任务结果等方法。<br><strong>AbstractExecutorService</strong>实现了ExecutorService，提供例如submit方法的默认实现逻辑。</p>\n<p>然后到今天的主题<strong>ThreadPoolExecutor</strong>，继承了AbstractExecutorService，提供线程池的具体实现。</p>\n<a id=\"more\"></a>\n<h2 id=\"2-ThreadPoolExecutor\"><a href=\"#2-ThreadPoolExecutor\" class=\"headerlink\" title=\"2. ThreadPoolExecutor\"></a>2. ThreadPoolExecutor</h2><h3 id=\"2-1-构造\"><a href=\"#2-1-构造\" class=\"headerlink\" title=\"2.1 构造\"></a>2.1 构造</h3><p>ThreadPoolExecutor的构造方法有四种，下面是参数最全的构造：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ThreadPoolExecutor</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize, </span></span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> maximumPoolSize, </div><div class=\"line\">\t\t<span class=\"keyword\">long</span> keepAliveTime, </div><div class=\"line\">\t\tTimeUnit unit, </div><div class=\"line\">\t\tBlockingQueue&lt;Runnable&gt; workQueue, </div><div class=\"line\">\t\tThreadFactory threadFactory,</div><div class=\"line\">        RejectedExecutionHandler handler) &#123;</div><div class=\"line\">\t</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<ul>\n<li>corePoolSize:线程池目标大小，即刚刚创建时的线程数</li>\n<li>maximumPoolSize: 线程池的最大上限</li>\n<li>keepAliveTime: 线程的存活时间，当线程池内的线程数量超过corePoolSize，超出存活时间的空闲线程就会被回收；</li>\n<li>unit: 时间单位</li>\n<li>workQueue: 缓存队列</li>\n<li>threadFactory: 线程工厂</li>\n<li>handler: 缓存队列饱和处理策略</li>\n</ul>\n<h3 id=\"2-2-定制线程池\"><a href=\"#2-2-定制线程池\" class=\"headerlink\" title=\"2.2 定制线程池\"></a>2.2 定制线程池</h3><p>ThreadPoolExecutor中有几个预先设置好的线程池，通过Executors的工厂方法创建。</p>\n<h4 id=\"2-2-1-newFixedThreadPool\"><a href=\"#2-2-1-newFixedThreadPool\" class=\"headerlink\" title=\"2.2.1 newFixedThreadPool\"></a>2.2.1 newFixedThreadPool</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ExecutorService <span class=\"title\">newFixedThreadPool</span><span class=\"params\">(<span class=\"keyword\">int</span> nThreads)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ThreadPoolExecutor(nThreads, nThreads,</div><div class=\"line\">                                      <span class=\"number\">0L</span>, TimeUnit.MILLISECONDS,</div><div class=\"line\">                                      <span class=\"keyword\">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<p>newFixedThreadPool的corePoolSize和maximumPoolSize都设置为传入的固定数量，keepAliveTim设置为0。线程池创建后，线程数量将会固定不变，适合需要线程很稳定的场合。</p>\n<h4 id=\"2-2-2-newSingleThreadExecutor\"><a href=\"#2-2-2-newSingleThreadExecutor\" class=\"headerlink\" title=\"2.2.2 newSingleThreadExecutor\"></a>2.2.2 newSingleThreadExecutor</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ExecutorService <span class=\"title\">newSingleThreadExecutor</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> FinalizableDelegatedExecutorService</div><div class=\"line\">            (<span class=\"keyword\">new</span> ThreadPoolExecutor(<span class=\"number\">1</span>, <span class=\"number\">1</span>,</div><div class=\"line\">                                    <span class=\"number\">0L</span>, TimeUnit.MILLISECONDS,</div><div class=\"line\">                                    <span class=\"keyword\">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<p>newSingleThreadExecutor是线程数量固定为1的newFixedThreadPool版本，保证池内的任务串行。注意到返回的是FinalizableDelegatedExecutorService，来看看源码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FinalizableDelegatedExecutorService</span></span></div><div class=\"line\">    <span class=\"keyword\">extends</span> <span class=\"title\">DelegatedExecutorService</span> &#123;</div><div class=\"line\">    FinalizableDelegatedExecutorService(ExecutorService executor) &#123;</div><div class=\"line\">        <span class=\"keyword\">super</span>(executor);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">finalize</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">super</span>.shutdown();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>FinalizableDelegatedExecutorService继承了DelegatedExecutorService，仅仅在gc时增加关闭线程池的操作，再来看看DelegatedExecutorService的源码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DelegatedExecutorService</span> <span class=\"keyword\">extends</span> <span class=\"title\">AbstractExecutorService</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ExecutorService e;</div><div class=\"line\">        DelegatedExecutorService(ExecutorService executor) &#123; e = executor; &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">execute</span><span class=\"params\">(Runnable command)</span> </span>&#123; e.execute(command); &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">shutdown</span><span class=\"params\">()</span> </span>&#123; e.shutdown(); &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Runnable&gt; <span class=\"title\">shutdownNow</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> e.shutdownNow(); &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isShutdown</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> e.isShutdown(); &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isTerminated</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> e.isTerminated(); &#125;</div><div class=\"line\">        ...</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>DelegatedExecutorService包装了ExecutorService，使其只暴露出ExecutorService的方法，因此不能再配置线程池的参数。本来，线程池创建的参数是可以调整的，ThreadPoolExecutor提供了set方法。使用newSingleThreadExecutor目的是生成单线程串行的线程池，如果还能配置线程池大小，那就没意思了。</p>\n<p>Executors还提供了unconfigurableExecutorService方法，将普通线程池包装成不可配置的线程池。如果不想线程池被不明所以的后人修改，可以调用这个方法。</p>\n<h4 id=\"2-2-3-newCachedThreadPool\"><a href=\"#2-2-3-newCachedThreadPool\" class=\"headerlink\" title=\"2.2.3 newCachedThreadPool\"></a>2.2.3 newCachedThreadPool</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ExecutorService <span class=\"title\">newCachedThreadPool</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ThreadPoolExecutor(<span class=\"number\">0</span>, Integer.MAX_VALUE,</div><div class=\"line\">                                  <span class=\"number\">60L</span>, TimeUnit.SECONDS,</div><div class=\"line\">                                  <span class=\"keyword\">new</span> SynchronousQueue&lt;Runnable&gt;());</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>newCachedThreadPool生成一个会缓存的线程池，线程数量可以从0到Integer.MAX_VALUE，超时时间为1分钟。线程池用起来的效果是：如果有空闲线程，会复用线程；如果没有空闲线程，会新建线程；如果线程空闲超过1分钟，将会被回收。</p>\n<h4 id=\"2-2-4-newScheduledThreadPool\"><a href=\"#2-2-4-newScheduledThreadPool\" class=\"headerlink\" title=\"2.2.4 newScheduledThreadPool\"></a>2.2.4 newScheduledThreadPool</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ScheduledExecutorService <span class=\"title\">newScheduledThreadPool</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ScheduledThreadPoolExecutor(corePoolSize);</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ScheduledThreadPoolExecutor</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">super</span>(corePoolSize, Integer.MAX_VALUE, <span class=\"number\">0</span>, NANOSECONDS,</div><div class=\"line\">              <span class=\"keyword\">new</span> DelayedWorkQueue());</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<p>newScheduledThreadPool将会创建一个可定时执行任务的线程池。这个不打算在本文展开，后续会另开文章细讲。</p>\n<h3 id=\"2-3-等待队列\"><a href=\"#2-3-等待队列\" class=\"headerlink\" title=\"2.3 等待队列\"></a>2.3 等待队列</h3><p>看完上面四个预设置的线程池，回发现在构造中都有一个 <strong>Queue</strong> 参数。</p>\n<p>线程池的大小或有限（newFixedThreadPool）、或几乎无限（newCachedThreadPool），但是系统资源是有限的，任务的处理速度总有可能比不上任务的提交速度。因此，可以为ThreadPoolExecutor提供一个阻塞队列来保存因线程不足而等待的Runnable任务，这就是BlockingQueue。</p>\n<p>Executor提供了以下几种等待队列（部分）：</p>\n<ul>\n<li>ArrayBlockingQueue：数组结构的阻塞队列</li>\n<li>LinkedBlockingQueue：链表结构的阻塞队列</li>\n<li>PriorityBlockingQueue：有优先级的阻塞队列</li>\n<li>SynchronousQueue：不会存储元素的阻塞队列</li>\n<li>DelayedWorkQueue</li>\n</ul>\n<p>newFixedThreadPool和newSingleThreadExecutor在默认情况下使用一个<strong>无界的LinkedBlockingQueue</strong>。要注意的是，如果任务一直提交，但线程池又不能及时处理，等待队列将会无限制地加长，系统资源总会有消耗殆尽的一刻。所以，推荐使用有界的等待队列，避免资源耗尽。但解决一个问题，又会带来新问题：队列填满之后，再来新任务，这个时候怎么办？后文会介绍如何处理队列饱和。</p>\n<p>newCachedThreadPool使用的SynchronousQueue十分有趣，看名称是个队列，但它却不能存储元素。要将一个任务放进队列，必须有另一个线程去接收这个任务，一个进就有一个出，队列不会存储任何东西。因此，SynchronousQueue是一种移交机制，不能算是队列。newCachedThreadPool生成的是一个没有上限的线程池，理论上提交多少任务都可以，使用SynchronousQueue作为等待队列正合适。</p>\n<h3 id=\"2-4-饱和策略\"><a href=\"#2-4-饱和策略\" class=\"headerlink\" title=\"2.4 饱和策略\"></a>2.4 饱和策略</h3><p>在上一小节中说道，等待队列不能无限制的增长，但若队列填满了该如何处理？此时就是饱和策略在发挥作用。ThreadPoolExecutor的饱和策略通过传入RejectedExecutionHandler来实现。如果没有为构造函数传入，将会使用默认的defaultHandler。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> RejectedExecutionHandler defaultHandler = <span class=\"keyword\">new</span> AbortPolicy();</div></pre></td></tr></table></figure>\n<ul>\n<li>AbortPolicy</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AbortPolicy</span> <span class=\"keyword\">implements</span> <span class=\"title\">RejectedExecutionHandler</span> </span>&#123;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">AbortPolicy</span><span class=\"params\">()</span> </span>&#123; &#125;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rejectedExecution</span><span class=\"params\">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class=\"line\">           <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RejectedExecutionException(<span class=\"string\">\"Task \"</span> + r.toString() + <span class=\"string\">\" rejected from \"</span> + e.toString());</div><div class=\"line\">       &#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n<p>AbortPolicy是默认的实现，直接抛出一个RejectedExecutionException异常，让调用者自己处理。除此之外，还有几种饱和策略，来看一下</p>\n<ul>\n<li>DiscardPolicy</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DiscardPolicy</span> <span class=\"keyword\">implements</span> <span class=\"title\">RejectedExecutionHandler</span> </span>&#123;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">DiscardPolicy</span><span class=\"params\">()</span> </span>&#123; &#125;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rejectedExecution</span><span class=\"params\">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class=\"line\">       &#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n<p>DiscardPolicy的rejectedExecution直接是空方法，什么也不干。如果队列满了，后续的任务都抛弃掉。</p>\n<ul>\n<li>DiscardOldestPolicy</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DiscardOldestPolicy</span> <span class=\"keyword\">implements</span> <span class=\"title\">RejectedExecutionHandler</span> </span>&#123;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">DiscardOldestPolicy</span><span class=\"params\">()</span> </span>&#123; &#125;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rejectedExecution</span><span class=\"params\">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class=\"line\">           <span class=\"keyword\">if</span> (!e.isShutdown()) &#123;</div><div class=\"line\">               e.getQueue().poll();</div><div class=\"line\">               e.execute(r);</div><div class=\"line\">           &#125;</div><div class=\"line\">       &#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n<p>DiscardOldestPolicy会将等待队列里最旧的任务踢走，让新任务得以执行。</p>\n<ul>\n<li>CallerRunsPolicy</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CallerRunsPolicy</span> <span class=\"keyword\">implements</span> <span class=\"title\">RejectedExecutionHandler</span> </span>&#123;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">CallerRunsPolicy</span><span class=\"params\">()</span> </span>&#123; &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rejectedExecution</span><span class=\"params\">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (!e.isShutdown()) &#123;</div><div class=\"line\">            r.run();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>CallerRunsPolicy它既不抛弃新任务，也不抛弃旧任务，而是直接在当前线程运行这个任务。当前线程一般就是主线程啊，让主线程运行任务，说不定就阻塞了。如果不是想清楚了整套方案，还是少用这种策略为妙。</p>\n<h3 id=\"2-5-ThreadFactory\"><a href=\"#2-5-ThreadFactory\" class=\"headerlink\" title=\"2.5 ThreadFactory\"></a>2.5 ThreadFactory</h3><p>每当线程池需要创建一个新线程，都是通过线程工厂获取。如果不为ThreadPoolExecutor设定一个线程工厂，就会使用默认的defaultThreadFactory：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ThreadFactory <span class=\"title\">defaultThreadFactory</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> DefaultThreadFactory();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DefaultThreadFactory</span> <span class=\"keyword\">implements</span> <span class=\"title\">ThreadFactory</span> </span>&#123;</div><div class=\"line\">       <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> AtomicInteger poolNumber = <span class=\"keyword\">new</span> AtomicInteger(<span class=\"number\">1</span>);</div><div class=\"line\">       <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ThreadGroup group;</div><div class=\"line\">       <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> AtomicInteger threadNumber = <span class=\"keyword\">new</span> AtomicInteger(<span class=\"number\">1</span>);</div><div class=\"line\">       <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> String namePrefix;</div><div class=\"line\"></div><div class=\"line\">       DefaultThreadFactory() &#123;</div><div class=\"line\">           SecurityManager s = System.getSecurityManager();</div><div class=\"line\">           group = (s != <span class=\"keyword\">null</span>) ? s.getThreadGroup() :</div><div class=\"line\">                                 Thread.currentThread().getThreadGroup();</div><div class=\"line\">           namePrefix = <span class=\"string\">\"pool-\"</span> +</div><div class=\"line\">                         poolNumber.getAndIncrement() +</div><div class=\"line\">                        <span class=\"string\">\"-thread-\"</span>;</div><div class=\"line\">       &#125;</div><div class=\"line\"></div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> Thread <span class=\"title\">newThread</span><span class=\"params\">(Runnable r)</span> </span>&#123;</div><div class=\"line\">           Thread t = <span class=\"keyword\">new</span> Thread(group, r,</div><div class=\"line\">                                 namePrefix + threadNumber.getAndIncrement(),</div><div class=\"line\">                                 <span class=\"number\">0</span>);</div><div class=\"line\">           <span class=\"keyword\">if</span> (t.isDaemon())</div><div class=\"line\">               t.setDaemon(<span class=\"keyword\">false</span>);</div><div class=\"line\">           <span class=\"keyword\">if</span> (t.getPriority() != Thread.NORM_PRIORITY)</div><div class=\"line\">               t.setPriority(Thread.NORM_PRIORITY);</div><div class=\"line\">           <span class=\"keyword\">return</span> t;</div><div class=\"line\">       &#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n<p>平时打印线程池里线程的name时，会输出形如pool-1-thread-1之类的名称，就是在这里设置的。这个默认的线程工厂，创建的线程是普通的非守护线程，如果需要定制，实现ThreadFactory后传给ThreadPoolExecutor即可。</p>\n<p><a href=\"http://www.jianshu.com/p/adbf37ef77bb\" target=\"_blank\" rel=\"noopener\">参考文章链接</a></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"1-Executor框架\"><a href=\"#1-Executor框架\" class=\"headerlink\" title=\"1. Executor框架\"></a>1. Executor框架</h2><p>从JDK 1.5 开始，java.util.concurrent包中的Executor执行器将用来管理Thread对象，从而简化并发编程。</p>\n<p><strong>Executor</strong>是一套线程池管理框架，接口里只有一个方法execute，执行Runnable任务。<br><strong>ExecutorService</strong>接口扩展了Executor，添加了线程生命周期的管理，提供任务终止、返回任务结果等方法。<br><strong>AbstractExecutorService</strong>实现了ExecutorService，提供例如submit方法的默认实现逻辑。</p>\n<p>然后到今天的主题<strong>ThreadPoolExecutor</strong>，继承了AbstractExecutorService，提供线程池的具体实现。</p>","more":"<h2 id=\"2-ThreadPoolExecutor\"><a href=\"#2-ThreadPoolExecutor\" class=\"headerlink\" title=\"2. ThreadPoolExecutor\"></a>2. ThreadPoolExecutor</h2><h3 id=\"2-1-构造\"><a href=\"#2-1-构造\" class=\"headerlink\" title=\"2.1 构造\"></a>2.1 构造</h3><p>ThreadPoolExecutor的构造方法有四种，下面是参数最全的构造：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ThreadPoolExecutor</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize, </span></span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> maximumPoolSize, </div><div class=\"line\">\t\t<span class=\"keyword\">long</span> keepAliveTime, </div><div class=\"line\">\t\tTimeUnit unit, </div><div class=\"line\">\t\tBlockingQueue&lt;Runnable&gt; workQueue, </div><div class=\"line\">\t\tThreadFactory threadFactory,</div><div class=\"line\">        RejectedExecutionHandler handler) &#123;</div><div class=\"line\">\t</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<ul>\n<li>corePoolSize:线程池目标大小，即刚刚创建时的线程数</li>\n<li>maximumPoolSize: 线程池的最大上限</li>\n<li>keepAliveTime: 线程的存活时间，当线程池内的线程数量超过corePoolSize，超出存活时间的空闲线程就会被回收；</li>\n<li>unit: 时间单位</li>\n<li>workQueue: 缓存队列</li>\n<li>threadFactory: 线程工厂</li>\n<li>handler: 缓存队列饱和处理策略</li>\n</ul>\n<h3 id=\"2-2-定制线程池\"><a href=\"#2-2-定制线程池\" class=\"headerlink\" title=\"2.2 定制线程池\"></a>2.2 定制线程池</h3><p>ThreadPoolExecutor中有几个预先设置好的线程池，通过Executors的工厂方法创建。</p>\n<h4 id=\"2-2-1-newFixedThreadPool\"><a href=\"#2-2-1-newFixedThreadPool\" class=\"headerlink\" title=\"2.2.1 newFixedThreadPool\"></a>2.2.1 newFixedThreadPool</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ExecutorService <span class=\"title\">newFixedThreadPool</span><span class=\"params\">(<span class=\"keyword\">int</span> nThreads)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ThreadPoolExecutor(nThreads, nThreads,</div><div class=\"line\">                                      <span class=\"number\">0L</span>, TimeUnit.MILLISECONDS,</div><div class=\"line\">                                      <span class=\"keyword\">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<p>newFixedThreadPool的corePoolSize和maximumPoolSize都设置为传入的固定数量，keepAliveTim设置为0。线程池创建后，线程数量将会固定不变，适合需要线程很稳定的场合。</p>\n<h4 id=\"2-2-2-newSingleThreadExecutor\"><a href=\"#2-2-2-newSingleThreadExecutor\" class=\"headerlink\" title=\"2.2.2 newSingleThreadExecutor\"></a>2.2.2 newSingleThreadExecutor</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ExecutorService <span class=\"title\">newSingleThreadExecutor</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> FinalizableDelegatedExecutorService</div><div class=\"line\">            (<span class=\"keyword\">new</span> ThreadPoolExecutor(<span class=\"number\">1</span>, <span class=\"number\">1</span>,</div><div class=\"line\">                                    <span class=\"number\">0L</span>, TimeUnit.MILLISECONDS,</div><div class=\"line\">                                    <span class=\"keyword\">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<p>newSingleThreadExecutor是线程数量固定为1的newFixedThreadPool版本，保证池内的任务串行。注意到返回的是FinalizableDelegatedExecutorService，来看看源码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FinalizableDelegatedExecutorService</span></span></div><div class=\"line\">    <span class=\"keyword\">extends</span> <span class=\"title\">DelegatedExecutorService</span> &#123;</div><div class=\"line\">    FinalizableDelegatedExecutorService(ExecutorService executor) &#123;</div><div class=\"line\">        <span class=\"keyword\">super</span>(executor);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">finalize</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">super</span>.shutdown();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>FinalizableDelegatedExecutorService继承了DelegatedExecutorService，仅仅在gc时增加关闭线程池的操作，再来看看DelegatedExecutorService的源码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DelegatedExecutorService</span> <span class=\"keyword\">extends</span> <span class=\"title\">AbstractExecutorService</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ExecutorService e;</div><div class=\"line\">        DelegatedExecutorService(ExecutorService executor) &#123; e = executor; &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">execute</span><span class=\"params\">(Runnable command)</span> </span>&#123; e.execute(command); &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">shutdown</span><span class=\"params\">()</span> </span>&#123; e.shutdown(); &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Runnable&gt; <span class=\"title\">shutdownNow</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> e.shutdownNow(); &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isShutdown</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> e.isShutdown(); &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isTerminated</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> e.isTerminated(); &#125;</div><div class=\"line\">        ...</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>DelegatedExecutorService包装了ExecutorService，使其只暴露出ExecutorService的方法，因此不能再配置线程池的参数。本来，线程池创建的参数是可以调整的，ThreadPoolExecutor提供了set方法。使用newSingleThreadExecutor目的是生成单线程串行的线程池，如果还能配置线程池大小，那就没意思了。</p>\n<p>Executors还提供了unconfigurableExecutorService方法，将普通线程池包装成不可配置的线程池。如果不想线程池被不明所以的后人修改，可以调用这个方法。</p>\n<h4 id=\"2-2-3-newCachedThreadPool\"><a href=\"#2-2-3-newCachedThreadPool\" class=\"headerlink\" title=\"2.2.3 newCachedThreadPool\"></a>2.2.3 newCachedThreadPool</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ExecutorService <span class=\"title\">newCachedThreadPool</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ThreadPoolExecutor(<span class=\"number\">0</span>, Integer.MAX_VALUE,</div><div class=\"line\">                                  <span class=\"number\">60L</span>, TimeUnit.SECONDS,</div><div class=\"line\">                                  <span class=\"keyword\">new</span> SynchronousQueue&lt;Runnable&gt;());</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>newCachedThreadPool生成一个会缓存的线程池，线程数量可以从0到Integer.MAX_VALUE，超时时间为1分钟。线程池用起来的效果是：如果有空闲线程，会复用线程；如果没有空闲线程，会新建线程；如果线程空闲超过1分钟，将会被回收。</p>\n<h4 id=\"2-2-4-newScheduledThreadPool\"><a href=\"#2-2-4-newScheduledThreadPool\" class=\"headerlink\" title=\"2.2.4 newScheduledThreadPool\"></a>2.2.4 newScheduledThreadPool</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ScheduledExecutorService <span class=\"title\">newScheduledThreadPool</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ScheduledThreadPoolExecutor(corePoolSize);</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ScheduledThreadPoolExecutor</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">super</span>(corePoolSize, Integer.MAX_VALUE, <span class=\"number\">0</span>, NANOSECONDS,</div><div class=\"line\">              <span class=\"keyword\">new</span> DelayedWorkQueue());</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<p>newScheduledThreadPool将会创建一个可定时执行任务的线程池。这个不打算在本文展开，后续会另开文章细讲。</p>\n<h3 id=\"2-3-等待队列\"><a href=\"#2-3-等待队列\" class=\"headerlink\" title=\"2.3 等待队列\"></a>2.3 等待队列</h3><p>看完上面四个预设置的线程池，回发现在构造中都有一个 <strong>Queue</strong> 参数。</p>\n<p>线程池的大小或有限（newFixedThreadPool）、或几乎无限（newCachedThreadPool），但是系统资源是有限的，任务的处理速度总有可能比不上任务的提交速度。因此，可以为ThreadPoolExecutor提供一个阻塞队列来保存因线程不足而等待的Runnable任务，这就是BlockingQueue。</p>\n<p>Executor提供了以下几种等待队列（部分）：</p>\n<ul>\n<li>ArrayBlockingQueue：数组结构的阻塞队列</li>\n<li>LinkedBlockingQueue：链表结构的阻塞队列</li>\n<li>PriorityBlockingQueue：有优先级的阻塞队列</li>\n<li>SynchronousQueue：不会存储元素的阻塞队列</li>\n<li>DelayedWorkQueue</li>\n</ul>\n<p>newFixedThreadPool和newSingleThreadExecutor在默认情况下使用一个<strong>无界的LinkedBlockingQueue</strong>。要注意的是，如果任务一直提交，但线程池又不能及时处理，等待队列将会无限制地加长，系统资源总会有消耗殆尽的一刻。所以，推荐使用有界的等待队列，避免资源耗尽。但解决一个问题，又会带来新问题：队列填满之后，再来新任务，这个时候怎么办？后文会介绍如何处理队列饱和。</p>\n<p>newCachedThreadPool使用的SynchronousQueue十分有趣，看名称是个队列，但它却不能存储元素。要将一个任务放进队列，必须有另一个线程去接收这个任务，一个进就有一个出，队列不会存储任何东西。因此，SynchronousQueue是一种移交机制，不能算是队列。newCachedThreadPool生成的是一个没有上限的线程池，理论上提交多少任务都可以，使用SynchronousQueue作为等待队列正合适。</p>\n<h3 id=\"2-4-饱和策略\"><a href=\"#2-4-饱和策略\" class=\"headerlink\" title=\"2.4 饱和策略\"></a>2.4 饱和策略</h3><p>在上一小节中说道，等待队列不能无限制的增长，但若队列填满了该如何处理？此时就是饱和策略在发挥作用。ThreadPoolExecutor的饱和策略通过传入RejectedExecutionHandler来实现。如果没有为构造函数传入，将会使用默认的defaultHandler。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> RejectedExecutionHandler defaultHandler = <span class=\"keyword\">new</span> AbortPolicy();</div></pre></td></tr></table></figure>\n<ul>\n<li>AbortPolicy</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AbortPolicy</span> <span class=\"keyword\">implements</span> <span class=\"title\">RejectedExecutionHandler</span> </span>&#123;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">AbortPolicy</span><span class=\"params\">()</span> </span>&#123; &#125;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rejectedExecution</span><span class=\"params\">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class=\"line\">           <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RejectedExecutionException(<span class=\"string\">\"Task \"</span> + r.toString() + <span class=\"string\">\" rejected from \"</span> + e.toString());</div><div class=\"line\">       &#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n<p>AbortPolicy是默认的实现，直接抛出一个RejectedExecutionException异常，让调用者自己处理。除此之外，还有几种饱和策略，来看一下</p>\n<ul>\n<li>DiscardPolicy</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DiscardPolicy</span> <span class=\"keyword\">implements</span> <span class=\"title\">RejectedExecutionHandler</span> </span>&#123;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">DiscardPolicy</span><span class=\"params\">()</span> </span>&#123; &#125;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rejectedExecution</span><span class=\"params\">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class=\"line\">       &#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n<p>DiscardPolicy的rejectedExecution直接是空方法，什么也不干。如果队列满了，后续的任务都抛弃掉。</p>\n<ul>\n<li>DiscardOldestPolicy</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DiscardOldestPolicy</span> <span class=\"keyword\">implements</span> <span class=\"title\">RejectedExecutionHandler</span> </span>&#123;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">DiscardOldestPolicy</span><span class=\"params\">()</span> </span>&#123; &#125;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rejectedExecution</span><span class=\"params\">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class=\"line\">           <span class=\"keyword\">if</span> (!e.isShutdown()) &#123;</div><div class=\"line\">               e.getQueue().poll();</div><div class=\"line\">               e.execute(r);</div><div class=\"line\">           &#125;</div><div class=\"line\">       &#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n<p>DiscardOldestPolicy会将等待队列里最旧的任务踢走，让新任务得以执行。</p>\n<ul>\n<li>CallerRunsPolicy</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CallerRunsPolicy</span> <span class=\"keyword\">implements</span> <span class=\"title\">RejectedExecutionHandler</span> </span>&#123;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">CallerRunsPolicy</span><span class=\"params\">()</span> </span>&#123; &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rejectedExecution</span><span class=\"params\">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (!e.isShutdown()) &#123;</div><div class=\"line\">            r.run();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>CallerRunsPolicy它既不抛弃新任务，也不抛弃旧任务，而是直接在当前线程运行这个任务。当前线程一般就是主线程啊，让主线程运行任务，说不定就阻塞了。如果不是想清楚了整套方案，还是少用这种策略为妙。</p>\n<h3 id=\"2-5-ThreadFactory\"><a href=\"#2-5-ThreadFactory\" class=\"headerlink\" title=\"2.5 ThreadFactory\"></a>2.5 ThreadFactory</h3><p>每当线程池需要创建一个新线程，都是通过线程工厂获取。如果不为ThreadPoolExecutor设定一个线程工厂，就会使用默认的defaultThreadFactory：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ThreadFactory <span class=\"title\">defaultThreadFactory</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> DefaultThreadFactory();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DefaultThreadFactory</span> <span class=\"keyword\">implements</span> <span class=\"title\">ThreadFactory</span> </span>&#123;</div><div class=\"line\">       <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> AtomicInteger poolNumber = <span class=\"keyword\">new</span> AtomicInteger(<span class=\"number\">1</span>);</div><div class=\"line\">       <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ThreadGroup group;</div><div class=\"line\">       <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> AtomicInteger threadNumber = <span class=\"keyword\">new</span> AtomicInteger(<span class=\"number\">1</span>);</div><div class=\"line\">       <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> String namePrefix;</div><div class=\"line\"></div><div class=\"line\">       DefaultThreadFactory() &#123;</div><div class=\"line\">           SecurityManager s = System.getSecurityManager();</div><div class=\"line\">           group = (s != <span class=\"keyword\">null</span>) ? s.getThreadGroup() :</div><div class=\"line\">                                 Thread.currentThread().getThreadGroup();</div><div class=\"line\">           namePrefix = <span class=\"string\">\"pool-\"</span> +</div><div class=\"line\">                         poolNumber.getAndIncrement() +</div><div class=\"line\">                        <span class=\"string\">\"-thread-\"</span>;</div><div class=\"line\">       &#125;</div><div class=\"line\"></div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> Thread <span class=\"title\">newThread</span><span class=\"params\">(Runnable r)</span> </span>&#123;</div><div class=\"line\">           Thread t = <span class=\"keyword\">new</span> Thread(group, r,</div><div class=\"line\">                                 namePrefix + threadNumber.getAndIncrement(),</div><div class=\"line\">                                 <span class=\"number\">0</span>);</div><div class=\"line\">           <span class=\"keyword\">if</span> (t.isDaemon())</div><div class=\"line\">               t.setDaemon(<span class=\"keyword\">false</span>);</div><div class=\"line\">           <span class=\"keyword\">if</span> (t.getPriority() != Thread.NORM_PRIORITY)</div><div class=\"line\">               t.setPriority(Thread.NORM_PRIORITY);</div><div class=\"line\">           <span class=\"keyword\">return</span> t;</div><div class=\"line\">       &#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n<p>平时打印线程池里线程的name时，会输出形如pool-1-thread-1之类的名称，就是在这里设置的。这个默认的线程工厂，创建的线程是普通的非守护线程，如果需要定制，实现ThreadFactory后传给ThreadPoolExecutor即可。</p>\n<p><a href=\"http://www.jianshu.com/p/adbf37ef77bb\" target=\"_blank\" rel=\"noopener\">参考文章链接</a></p>"},{"title":"SNMP学习总结(2)——snmp安装和配置","date":"2017-05-25T00:42:50.000Z","_content":"这篇博客简要介绍了snmp的安装\n<!-- more -->\n\n针对不同的操作系统有不同的操作流程，具体参见[孤傲苍狼的博客][1]。\n\n\n  [1]: http://www.cnblogs.com/xdp-gacl/category/613358.html","source":"_posts/SNMP学习总结(2)——snmp安装和配置.md","raw":"---\ntitle: SNMP学习总结(2)——snmp安装和配置\ndate: 2017-05-25 8:42:50\ncategories:\n  - SNMP\ntags:\n  - snmp\n  - network\n  - snmp4j\n---\n这篇博客简要介绍了snmp的安装\n<!-- more -->\n\n针对不同的操作系统有不同的操作流程，具体参见[孤傲苍狼的博客][1]。\n\n\n  [1]: http://www.cnblogs.com/xdp-gacl/category/613358.html","slug":"SNMP学习总结(2)——snmp安装和配置","published":1,"updated":"2018-02-27T07:38:38.091Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspf3000on8vf883m9wh0","content":"<p>这篇博客简要介绍了snmp的安装<br><a id=\"more\"></a></p>\n<p>针对不同的操作系统有不同的操作流程，具体参见<a href=\"http://www.cnblogs.com/xdp-gacl/category/613358.html\" target=\"_blank\" rel=\"noopener\">孤傲苍狼的博客</a>。</p>\n","site":{"data":{}},"excerpt":"<p>这篇博客简要介绍了snmp的安装<br>","more":"</p>\n<p>针对不同的操作系统有不同的操作流程，具体参见<a href=\"http://www.cnblogs.com/xdp-gacl/category/613358.html\" target=\"_blank\" rel=\"noopener\">孤傲苍狼的博客</a>。</p>"},{"title":"SNMP学习总结(1)——基本概念","date":"2017-05-25T00:42:50.000Z","_content":"这篇博客简要介绍了snmp协议的基本概念\n<!-- more -->\n## 1 SNMP简单概述\n\n### 1.1 什么是SNMP?\n\n　　SNMP是英文\"Simple Network Management Protocol\"的缩写，中文意思是“简单的网络管理协议”。它属于TCP/IP五层协议中的应用层协议，用于网络管理的协议。SNMP主要用于网络设备的管理。由于SNMP协议简单可靠 ，受到了众多厂商的欢迎，成为了目前最为广泛的网管协议。\n　　SNMP协议主要由两大部分组成：**SNMP管理站**和**SNMP代理**。SNMP管理站是一个中心节点，负责收集维护各个SNMP元素的信息，并对这些信息进行处理，最后反馈给网络管理员；而SNMP代理是运行在各个被管理的网络节点之上，负责统计该节点的各项信息，并且负责与SNMP管理站交互，接收并执行管理站的命令，上传各种本地的网络信息。\n　　SNMP管理站和SNMP代理之间是松散耦合。他们之间的通信是通过UDP协议完成的。一般情况下，SNMP管理站通过UDP协议向SNMP代理发送各种命令，当SNMP代理收到命令后，返回SNMP管理站需要的参数。但是当SNMP代理检测到网络元素异常的时候，也可以主动向SNMP管理站发送消息，通告当前异常状况。\n　　SNMP的基本思想：为不同种类的设备、不同厂家生产的设备、不同型号的设备，定义为一个统一的接口和协议，使得管理员可以是使用统一的外观面对这些需要管理的网络设备进行管理。通过网络，管理员可以管理位于不同物理空间的设备，从而大大提高网络管理的效率，简化网络管理员的工作。\n　　SNMP的工作方式：管理员需要向设备获取数据，所以SNMP提供了【读】操作；管理员需要向设备执行设置操作，所以SNMP提供了【写】操作；设备需要在重要状况改变的时候，向管理员通报事件的发生，所以SNMP提供了【Trap】操作。\n\n### 1.2 SNMP和UDP\n\nSNMP采用UDP协议在管理端和agent之间传输信息。 SNMP采用UDP161端口接收和发送请求，162端口接收trap，执行SNMP的设备缺省都必须采用这些端口。SNMP消息全部通过UDP端口161接收，只有Trap信息采用UDP端口162。\n \n### 1.3 Snmp版本\n\nSNMP目前共有v1，v2，v3这三个版本： \n\n - SNMP v1是SNMP协议的最初版本，不过依然是众多厂家实现SNMP基本方式。 \n - SNMP v2通常被指是基于community的SNMP V2。Community实质上就是密码。\n - SNMP v3 是最新版本的SNMP。它对网络管理最大的贡献在于其安全性。增加了对认证和密文传输的支持。\n\n## 2 SNMP工作原理\n　　在具体的实现上，SNMP为管理员提供了一个网管平台（NMS），又称为管理站，负责网管命令的发出、数据存储及数据分析。被监管的设备上运行一个SNMP代理（Agent），代理实现设备与管理站的SNMP通信。\n　　![snmp工作原理][1]\n　　管理站和代理端使用MIB进行接口统一，MIB定义了设备中的被管理对象。管理站和代理都实现相应的MIB对象，使得双方可以识别对方的数据，实现通信。管理站向代理请求MIB中定义的数据，代理端识别后，将管理设备提供的相关状态或参数等数据转换成MIB定义的格式，最后将该信息返回给管理站，完成一次管理操作。\n　　\n## 3 SNMP报文\n### 3.1 报文类型\n　　SNMP中定义了五种消息类型：Get-Request、Get-Response、Get-Next-Request、Set-Request和Trap。\n\n - Get-Request 、Get-Next-Request与Get-Response\nSNMP 管理站用Get-Request消息从拥有SNMP代理的网络设备中检索信息，而SNMP代理则用Get-Response消息响应。Get-Next- Request用于和Get-Request组合起来查询特定的表对象中的列元素。\n - Set-Request SNMP管理站用Set-Request 可以对网络设备进行远程配置（包括设备名、设备属性、删除设备或使某一个设备属性有效/无效等）。\n - Trap SNMP代理使用Trap向SNMP管理站发送非请求消息，一般用于描述某一事件的发生，如接口UP/DOWN，IP地址更改等。\n\n上面五种消息中Get-Request、Get-Next-Request和Set-Request是由管理站发送到代理侧的161端口的；后面两种Get-Response和Trap 是由代理进程发给管理进程的，其中Trap消息被发送到管理进程的162端口，所有数据都是走UDP封装。SNMP工作流程如图2：\n![SNMP工作流程][2]\n### 3.2 报文格式\nSNMP代理和管理站通过SNMP协议中的标准消息进行通信，每个消息都是一个单独的数据报。SNMP使用UDP（用户数据报协议）作为第四层协议（传输协议），进行无连接操作。SNMP消息报文包含两个部分：SNMP报头和协议数据单元PDU。\n![SNMP报文格式][3]\n\n**以下部分是报文格式的具体分析，有需要可以继续学习。**\n    \n　　在实际网络传输环境下，SNMP报文的长度取决于其所采用的编码方式。SNMP统一采用BER(Basic Encoding Rule)的编码规则，同时在正式SNMP规范中使用的是ASN.1语法，Abastract Syntax Notation v1，即抽象语法描述语言。这两个概念在后面实践环节再做进一步介绍，这里只要稍微了解一下即可，不妨碍我们对协议本身的分析。这里我们简单解释一下BER编码规则：\n　　BER作为ANS.1的基本编码规则，描述具体的ANS.1对象如何编码为比特流在网络上进行传输。BER编码规则由三部分组成：\n　　![BER编码方式][4]\n    SNMP中定义了几种基本的数据类型，其中v1和v2版有些改动，具体参见相应的RFC文档。这里我们只介绍几种最常见的类型：\n\n - INTEGER：一个整数\n - OCTER STRING： 0或多个8bit字节，每个字节在0~255之间取值\n - DisplayString：0或多个8bit字节，每个字节必须是ASCII码。在MIB-II中，所有该类型变量不能超过255个字符(0个字符可以)\n - NULL：代表相关的变量没有值\n - IpAddress：4字节长的OCTER STRING，以网络字节序表示IP地址\n - PhyAddress：6字节长的OCTER STRING，代表物理地址\n - Counter：非负整数，可以从0递增到232-1()。达到最大值后归0\n - TimeTicks：时间计数器，以0.01秒为单位递增，不同的变量可以有不同的递增幅度。所以在定义这种类型的变量时需要制定递增幅度\n - SEQUENCE：与C语言中的结构体类似\n - SEQUENCE OF：一个向量，参见后面ANS.1语法详细介绍章节\n\nSNMP报文在传输层是封装在UDP报文中的，而UDP又是基于IP网络的，因此，我们可以得到完整的报文描述结构，如下图所示：\n![SNMP协议报文格式][5]\nPDU类型其实包含两个字节，第一个字节表示真实的PDU的类型；第二个字节表示后面报文所占的字节总数。针对SNMPv1，这个字段取值如下：\n| PDU类型  | 名 称   |\n| :--------: | :-----:  |\n| 0     | get-request |\n| 1        |   get-next-request   |\n| 2        |    get-response    |\n| 3        |    set-request   |\n| 4        |    trap   |\n　　也就是说，trap的类型是4。但是在数据报文中，该字段一般表示为ax，其中x取[0,4]，即a0~a3表示相应的get、set等操作，a4表示trap报文。这里除了类型字段意外，其他字段均采用BER编码方式：\n![采用BER编码的字段][6]\n　　\n**实战演练之报文格式分析**\n　　Trap报文格式和上述图5所展示的结构有些差别，这里我们只分析SNMPv1和SNMPv2的Trap报文格式。trap报文前面的部分都一样，区别在PDU协议数据单元部分。\n\nSNMPv1 Trap报文\nSNMPv1的Trap报文格式如下所示：\n![SNMPv1的Trap报文格式][7]\n注意：除了PDU类型和PDU长度字段外，后面的每个字段都是BER编码方式。\n    trap类型”可以取以下值，其中0~6是已定义的特定trap，7及其以后的类型由供应商自定义。\n表2 trap类型、名称及描述信息\n| trap类型        | 名称   |  描述信息  |\n| :--------:   | :-----:  | :----:  |\n| ０     | coldStart |   代理进程对自己初始化     |\n| １        |   warmStart   |   代理进程对自己重新初始化   |\n| ２        |   linkDown    |  一个接口已从工作状态变为故障状态(报文中的第一个变量标识此接口)  |\n| ３     | linkUp |  一个接口已从故障状态变为工作状态(报文中的第一个变量标识此接口)     |\n| ４        |   authenticationFailure   |   从SNMP管理进程收到无效共同体的报文   |\n| ５        |    egpNeighborLoss    |  一个EGP邻站已变为故障状态(报文中的第一个变量包含邻站IP地址) |\n| ６     | enterpriseSpecific |   在这个特定的代码段中查找trap信息     |\n　　通过wireshark抓包工具，捕获一条如下的SNMP报文，接下来对其进行仔细分析。\nSNMPv1原始报文内容：\n\n<font color=\"green\">00 23 5a 9e 58 b9</font> <font color=\"blue\">00 4c 41 49 50 55</font> <font color=\"red\">08 005</font> <font color=\"gold\">45 00 00 48 00 00 40 00 40 11 a5 4e c0 a8 0a 01 c0 a8 0a 05</font> <font color=\"purple\">0c 00 00 a2 00 34 ff e0</font> 30 2a 02 01 00 04 06 70 75 62 6c 69 63 a4 1d 06 0a 2b 06 01 04 01 bf 08 03 02 0a 40 04 c0 a8 0a 01 02 01 00 02 01 00 43 01 0e 30 00\n \n目的MAC：<font color=\"green\">00 23 5a 9e 58 b9</font>\n源MAC：<font color=\"blue\">00 4c 41 49 50 55</font>\n协议类型：<font color=\"red\">08 005</font> ，为IP数据报\nIP头：<font color=\"gold\">45 00 00 48 00 00 40 00 40 11 a5 4e c0 a8 0a 01 c0 a8 0a 05</font>\nUDP头：<font color=\"purple\">0c 00 00 a2 00 34 ff e0</font>\n其余部分都为SNMP报文，接下来我们对照前面的报文结构体来逐个分析一下。\n\n - 30 表示SNMP消息是ASN.1的SEQUENCE类型；\n - 2a 表示该SNMP报文的总长度是42(0x2a)个字节，该字段所表示的报文长度起始于它后面的第一个字节直到报文结束；\n - 02 01 00 表示版本号，可见其确实为BER编码方式。02表示该字段是INTEGER类型；01表示该字段占1个字节；00表示版本号，该值为“版本号-1”；\n - 04 06 70 75 62 6c 69 63 表示团体名，04表示该字段为OCTET STRING类型；06表示该字段占6个字节；70 75 62 6c 69 63 表示团体名的ANSII码的十六进制形式，这里是“public”；\n - a4 1d 其中a4中的“4”表示这是一个trap报文，a4又叫报文的标签标记；1d表示后面还有29(0x1d)个字节的数据；\n - 06 0a 2b 06 01 04 01 bf 08 03 02 0a 企业OID标识。06表示该字段是个对象标识符，OBJECT IDENTIFIER；0a表示该字段占10(0x0a)个字节；关于SNMP的OID的编码方式有些奇特：例如1.3.6.1.2…. 取前两个数字分别记为x和y。编码时40*x+y，这里x=1，y=3，因此结果为40*1+3=43，即表示十六进制的2b。因此，这里的企业OID编码即为1.3.6.1.4.1.8072.3.2.10；\n - 40 04 c0 a8 0a 01 同样40表示该字段为OCTET STRING 类型；04表示IP地址占4个字节；IP地址为192.168.10.1；\n - 02 01 00 其中00表示trap类型为coldStart；\n - 02 01 00 其中00表示我们指定的trap即specific-trap也为coldStart类型；\n - 43 01 0e 43表示为TimeTicks类型；01表示该字段占1个字节；0e即十进制的14表示时间标签为0.14秒，这里时间计数器以0.01秒递增；\n - 30 00 30表示“键-值”值对的编码类型为SEQUENCE；00表示该字段占0个字节，即没有该字段。\n\nSNMPv2 Trap报文 \nSNMPv2的Trap报文格式如图8所示：\n![SNMPv2的Trap报文格式][8]\n同样的，这里除了trap类型和报文长度是标准网络字节序之外，其余协议字段也均为BER编码方式。可以看到v2版的trap报文正在向统一的报文格式发展，已经非常类似普通的SNMP请求、响应报文了。\nSNMPv2原始报文内容：\n00 23 5a 9e 58 b9 00 4c 41 49 50 55 08 00 45 00 00 7b 00 00 40 00 40 11 a5 1b c0 a8 0a 01 c0 a8 0a 05 0c 01 00 a2 00 67 04 bb 30 5d 02 01 01 04 06 70 75 62 6c 69 63 a7 50 02 04 17 73 2c fb 02 01 00 02 01 00 30 42 30 0d 06 08 2b 06 01 02 01 01 03 00 43 01 0e 30 17 06 0a 2b 06 01 06 03 01 01 04 01 00 06 09 2b 06 01 06 03 01 01 05 01 30 18 06 0a 2b 06 01 06 03 01 01 04 03 00 06 0a 2b 06 01 04 01 bf 08 03 02 0a\n \n目的MAC：00 23 5a 9e 58 b9\n源MAC：00 4c 41 49 50 55\n协议类型：08 00，IP报文\nIP头：45 00 00 7b 00 00 40 00 40 11 a5 1b c0 a8 0a 01 c0 a8 0a 05\nUDP头：0c 01 00 a2 00 67 04 bb\n余下部分全为SNMP报文内容，这里我们做一下简单的约定：\nxx 标注类型；xx 标注长度；xx 标注真正的数据。\n这样一来上面这串原始数据就好分析多了\n\n - 30 5d 整个SNMP报文的编码方式为30，即SEQUENCE类型，报文长度93(0x5d)字节；\n - 02 01 01 版本号01即v2版本；\n - 04 06 70 75 62 6c 69 63 团体名70 75 62 6c 69 63  即英文的“public”；\n - a7 50 a7表示trap类型为7，即厂商自定义trap；50表示PDU区段占80(0x50)字节；\n - 02 04 17 73 2c fb 请求ID为17 73 2c fb 十进制的393424123；\n - 02 01 00 错误状态0；\n - 02 01 00 错误索引0；\n - 30 42 “变量名-值”对编码类型30 即SEQUENCE类型；“变量名-值”所占总字节0x42，即66字节；\n - 30 0d 06 08 2b 06 01 02 01 01 03 00 43 01 0e 第一个“名-值”对区段编码方式30 即SEQUENCE类型；第一个“名-值”对总长度0x0d，13字节；第一个变量名的编码类型0x06，时间标签；第一个变量名占0x08个字节；第一个变量名2b 06 01 02 01 01 03 00，为1.3.6.1.2.1.1.3.0；第一个变量值为0x0e，即14；\n - 30 17 06 0a 2b 06 01 06 03 01 01 04 01 00 06 09 2b 06 01 06 03 01 01 05 01 第二个“名-值”对；变量名1.3.6.1.6.3.1.1.4.1.0；变量值1.3.6.1.6.3.1.1.5.1；\n - 30 18 06 0a 2b 06 01 06 03 01 01 04 03 00 06 0a 2b 06 01 04 01 bf 08 03 02 0a 第三个“名-值”对；变量名1.3.6.1.6.3.1.1.4.3.0；变量值1.3.6.1.4.1.8072.3.2.10；\n\n今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。\n  ------\n\n\n  [1]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274236dktq.jpg\n  [2]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274238733S.jpg\n  [3]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274240Yo8Q.jpg\n  [4]: http://blog.chinaunix.net/attachment/201206/21/23069658_134027424269yP.jpg\n  [5]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274245phSV.jpg\n  [6]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274247srSc.jpg\n  [7]: http://blog.chinaunix.net/attachment/201206/21/23069658_134027425066MR.jpg\n  [8]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274252oJOX.jpg","source":"_posts/SNMP学习总结(1)——基本概念.md","raw":"---\ntitle: SNMP学习总结(1)——基本概念\ndate: 2017-05-25 8:42:50\ncategories:\n  - SNMP\ntags:\n  - snmp\n  - network\n  - snmp4j\n---\n这篇博客简要介绍了snmp协议的基本概念\n<!-- more -->\n## 1 SNMP简单概述\n\n### 1.1 什么是SNMP?\n\n　　SNMP是英文\"Simple Network Management Protocol\"的缩写，中文意思是“简单的网络管理协议”。它属于TCP/IP五层协议中的应用层协议，用于网络管理的协议。SNMP主要用于网络设备的管理。由于SNMP协议简单可靠 ，受到了众多厂商的欢迎，成为了目前最为广泛的网管协议。\n　　SNMP协议主要由两大部分组成：**SNMP管理站**和**SNMP代理**。SNMP管理站是一个中心节点，负责收集维护各个SNMP元素的信息，并对这些信息进行处理，最后反馈给网络管理员；而SNMP代理是运行在各个被管理的网络节点之上，负责统计该节点的各项信息，并且负责与SNMP管理站交互，接收并执行管理站的命令，上传各种本地的网络信息。\n　　SNMP管理站和SNMP代理之间是松散耦合。他们之间的通信是通过UDP协议完成的。一般情况下，SNMP管理站通过UDP协议向SNMP代理发送各种命令，当SNMP代理收到命令后，返回SNMP管理站需要的参数。但是当SNMP代理检测到网络元素异常的时候，也可以主动向SNMP管理站发送消息，通告当前异常状况。\n　　SNMP的基本思想：为不同种类的设备、不同厂家生产的设备、不同型号的设备，定义为一个统一的接口和协议，使得管理员可以是使用统一的外观面对这些需要管理的网络设备进行管理。通过网络，管理员可以管理位于不同物理空间的设备，从而大大提高网络管理的效率，简化网络管理员的工作。\n　　SNMP的工作方式：管理员需要向设备获取数据，所以SNMP提供了【读】操作；管理员需要向设备执行设置操作，所以SNMP提供了【写】操作；设备需要在重要状况改变的时候，向管理员通报事件的发生，所以SNMP提供了【Trap】操作。\n\n### 1.2 SNMP和UDP\n\nSNMP采用UDP协议在管理端和agent之间传输信息。 SNMP采用UDP161端口接收和发送请求，162端口接收trap，执行SNMP的设备缺省都必须采用这些端口。SNMP消息全部通过UDP端口161接收，只有Trap信息采用UDP端口162。\n \n### 1.3 Snmp版本\n\nSNMP目前共有v1，v2，v3这三个版本： \n\n - SNMP v1是SNMP协议的最初版本，不过依然是众多厂家实现SNMP基本方式。 \n - SNMP v2通常被指是基于community的SNMP V2。Community实质上就是密码。\n - SNMP v3 是最新版本的SNMP。它对网络管理最大的贡献在于其安全性。增加了对认证和密文传输的支持。\n\n## 2 SNMP工作原理\n　　在具体的实现上，SNMP为管理员提供了一个网管平台（NMS），又称为管理站，负责网管命令的发出、数据存储及数据分析。被监管的设备上运行一个SNMP代理（Agent），代理实现设备与管理站的SNMP通信。\n　　![snmp工作原理][1]\n　　管理站和代理端使用MIB进行接口统一，MIB定义了设备中的被管理对象。管理站和代理都实现相应的MIB对象，使得双方可以识别对方的数据，实现通信。管理站向代理请求MIB中定义的数据，代理端识别后，将管理设备提供的相关状态或参数等数据转换成MIB定义的格式，最后将该信息返回给管理站，完成一次管理操作。\n　　\n## 3 SNMP报文\n### 3.1 报文类型\n　　SNMP中定义了五种消息类型：Get-Request、Get-Response、Get-Next-Request、Set-Request和Trap。\n\n - Get-Request 、Get-Next-Request与Get-Response\nSNMP 管理站用Get-Request消息从拥有SNMP代理的网络设备中检索信息，而SNMP代理则用Get-Response消息响应。Get-Next- Request用于和Get-Request组合起来查询特定的表对象中的列元素。\n - Set-Request SNMP管理站用Set-Request 可以对网络设备进行远程配置（包括设备名、设备属性、删除设备或使某一个设备属性有效/无效等）。\n - Trap SNMP代理使用Trap向SNMP管理站发送非请求消息，一般用于描述某一事件的发生，如接口UP/DOWN，IP地址更改等。\n\n上面五种消息中Get-Request、Get-Next-Request和Set-Request是由管理站发送到代理侧的161端口的；后面两种Get-Response和Trap 是由代理进程发给管理进程的，其中Trap消息被发送到管理进程的162端口，所有数据都是走UDP封装。SNMP工作流程如图2：\n![SNMP工作流程][2]\n### 3.2 报文格式\nSNMP代理和管理站通过SNMP协议中的标准消息进行通信，每个消息都是一个单独的数据报。SNMP使用UDP（用户数据报协议）作为第四层协议（传输协议），进行无连接操作。SNMP消息报文包含两个部分：SNMP报头和协议数据单元PDU。\n![SNMP报文格式][3]\n\n**以下部分是报文格式的具体分析，有需要可以继续学习。**\n    \n　　在实际网络传输环境下，SNMP报文的长度取决于其所采用的编码方式。SNMP统一采用BER(Basic Encoding Rule)的编码规则，同时在正式SNMP规范中使用的是ASN.1语法，Abastract Syntax Notation v1，即抽象语法描述语言。这两个概念在后面实践环节再做进一步介绍，这里只要稍微了解一下即可，不妨碍我们对协议本身的分析。这里我们简单解释一下BER编码规则：\n　　BER作为ANS.1的基本编码规则，描述具体的ANS.1对象如何编码为比特流在网络上进行传输。BER编码规则由三部分组成：\n　　![BER编码方式][4]\n    SNMP中定义了几种基本的数据类型，其中v1和v2版有些改动，具体参见相应的RFC文档。这里我们只介绍几种最常见的类型：\n\n - INTEGER：一个整数\n - OCTER STRING： 0或多个8bit字节，每个字节在0~255之间取值\n - DisplayString：0或多个8bit字节，每个字节必须是ASCII码。在MIB-II中，所有该类型变量不能超过255个字符(0个字符可以)\n - NULL：代表相关的变量没有值\n - IpAddress：4字节长的OCTER STRING，以网络字节序表示IP地址\n - PhyAddress：6字节长的OCTER STRING，代表物理地址\n - Counter：非负整数，可以从0递增到232-1()。达到最大值后归0\n - TimeTicks：时间计数器，以0.01秒为单位递增，不同的变量可以有不同的递增幅度。所以在定义这种类型的变量时需要制定递增幅度\n - SEQUENCE：与C语言中的结构体类似\n - SEQUENCE OF：一个向量，参见后面ANS.1语法详细介绍章节\n\nSNMP报文在传输层是封装在UDP报文中的，而UDP又是基于IP网络的，因此，我们可以得到完整的报文描述结构，如下图所示：\n![SNMP协议报文格式][5]\nPDU类型其实包含两个字节，第一个字节表示真实的PDU的类型；第二个字节表示后面报文所占的字节总数。针对SNMPv1，这个字段取值如下：\n| PDU类型  | 名 称   |\n| :--------: | :-----:  |\n| 0     | get-request |\n| 1        |   get-next-request   |\n| 2        |    get-response    |\n| 3        |    set-request   |\n| 4        |    trap   |\n　　也就是说，trap的类型是4。但是在数据报文中，该字段一般表示为ax，其中x取[0,4]，即a0~a3表示相应的get、set等操作，a4表示trap报文。这里除了类型字段意外，其他字段均采用BER编码方式：\n![采用BER编码的字段][6]\n　　\n**实战演练之报文格式分析**\n　　Trap报文格式和上述图5所展示的结构有些差别，这里我们只分析SNMPv1和SNMPv2的Trap报文格式。trap报文前面的部分都一样，区别在PDU协议数据单元部分。\n\nSNMPv1 Trap报文\nSNMPv1的Trap报文格式如下所示：\n![SNMPv1的Trap报文格式][7]\n注意：除了PDU类型和PDU长度字段外，后面的每个字段都是BER编码方式。\n    trap类型”可以取以下值，其中0~6是已定义的特定trap，7及其以后的类型由供应商自定义。\n表2 trap类型、名称及描述信息\n| trap类型        | 名称   |  描述信息  |\n| :--------:   | :-----:  | :----:  |\n| ０     | coldStart |   代理进程对自己初始化     |\n| １        |   warmStart   |   代理进程对自己重新初始化   |\n| ２        |   linkDown    |  一个接口已从工作状态变为故障状态(报文中的第一个变量标识此接口)  |\n| ３     | linkUp |  一个接口已从故障状态变为工作状态(报文中的第一个变量标识此接口)     |\n| ４        |   authenticationFailure   |   从SNMP管理进程收到无效共同体的报文   |\n| ５        |    egpNeighborLoss    |  一个EGP邻站已变为故障状态(报文中的第一个变量包含邻站IP地址) |\n| ６     | enterpriseSpecific |   在这个特定的代码段中查找trap信息     |\n　　通过wireshark抓包工具，捕获一条如下的SNMP报文，接下来对其进行仔细分析。\nSNMPv1原始报文内容：\n\n<font color=\"green\">00 23 5a 9e 58 b9</font> <font color=\"blue\">00 4c 41 49 50 55</font> <font color=\"red\">08 005</font> <font color=\"gold\">45 00 00 48 00 00 40 00 40 11 a5 4e c0 a8 0a 01 c0 a8 0a 05</font> <font color=\"purple\">0c 00 00 a2 00 34 ff e0</font> 30 2a 02 01 00 04 06 70 75 62 6c 69 63 a4 1d 06 0a 2b 06 01 04 01 bf 08 03 02 0a 40 04 c0 a8 0a 01 02 01 00 02 01 00 43 01 0e 30 00\n \n目的MAC：<font color=\"green\">00 23 5a 9e 58 b9</font>\n源MAC：<font color=\"blue\">00 4c 41 49 50 55</font>\n协议类型：<font color=\"red\">08 005</font> ，为IP数据报\nIP头：<font color=\"gold\">45 00 00 48 00 00 40 00 40 11 a5 4e c0 a8 0a 01 c0 a8 0a 05</font>\nUDP头：<font color=\"purple\">0c 00 00 a2 00 34 ff e0</font>\n其余部分都为SNMP报文，接下来我们对照前面的报文结构体来逐个分析一下。\n\n - 30 表示SNMP消息是ASN.1的SEQUENCE类型；\n - 2a 表示该SNMP报文的总长度是42(0x2a)个字节，该字段所表示的报文长度起始于它后面的第一个字节直到报文结束；\n - 02 01 00 表示版本号，可见其确实为BER编码方式。02表示该字段是INTEGER类型；01表示该字段占1个字节；00表示版本号，该值为“版本号-1”；\n - 04 06 70 75 62 6c 69 63 表示团体名，04表示该字段为OCTET STRING类型；06表示该字段占6个字节；70 75 62 6c 69 63 表示团体名的ANSII码的十六进制形式，这里是“public”；\n - a4 1d 其中a4中的“4”表示这是一个trap报文，a4又叫报文的标签标记；1d表示后面还有29(0x1d)个字节的数据；\n - 06 0a 2b 06 01 04 01 bf 08 03 02 0a 企业OID标识。06表示该字段是个对象标识符，OBJECT IDENTIFIER；0a表示该字段占10(0x0a)个字节；关于SNMP的OID的编码方式有些奇特：例如1.3.6.1.2…. 取前两个数字分别记为x和y。编码时40*x+y，这里x=1，y=3，因此结果为40*1+3=43，即表示十六进制的2b。因此，这里的企业OID编码即为1.3.6.1.4.1.8072.3.2.10；\n - 40 04 c0 a8 0a 01 同样40表示该字段为OCTET STRING 类型；04表示IP地址占4个字节；IP地址为192.168.10.1；\n - 02 01 00 其中00表示trap类型为coldStart；\n - 02 01 00 其中00表示我们指定的trap即specific-trap也为coldStart类型；\n - 43 01 0e 43表示为TimeTicks类型；01表示该字段占1个字节；0e即十进制的14表示时间标签为0.14秒，这里时间计数器以0.01秒递增；\n - 30 00 30表示“键-值”值对的编码类型为SEQUENCE；00表示该字段占0个字节，即没有该字段。\n\nSNMPv2 Trap报文 \nSNMPv2的Trap报文格式如图8所示：\n![SNMPv2的Trap报文格式][8]\n同样的，这里除了trap类型和报文长度是标准网络字节序之外，其余协议字段也均为BER编码方式。可以看到v2版的trap报文正在向统一的报文格式发展，已经非常类似普通的SNMP请求、响应报文了。\nSNMPv2原始报文内容：\n00 23 5a 9e 58 b9 00 4c 41 49 50 55 08 00 45 00 00 7b 00 00 40 00 40 11 a5 1b c0 a8 0a 01 c0 a8 0a 05 0c 01 00 a2 00 67 04 bb 30 5d 02 01 01 04 06 70 75 62 6c 69 63 a7 50 02 04 17 73 2c fb 02 01 00 02 01 00 30 42 30 0d 06 08 2b 06 01 02 01 01 03 00 43 01 0e 30 17 06 0a 2b 06 01 06 03 01 01 04 01 00 06 09 2b 06 01 06 03 01 01 05 01 30 18 06 0a 2b 06 01 06 03 01 01 04 03 00 06 0a 2b 06 01 04 01 bf 08 03 02 0a\n \n目的MAC：00 23 5a 9e 58 b9\n源MAC：00 4c 41 49 50 55\n协议类型：08 00，IP报文\nIP头：45 00 00 7b 00 00 40 00 40 11 a5 1b c0 a8 0a 01 c0 a8 0a 05\nUDP头：0c 01 00 a2 00 67 04 bb\n余下部分全为SNMP报文内容，这里我们做一下简单的约定：\nxx 标注类型；xx 标注长度；xx 标注真正的数据。\n这样一来上面这串原始数据就好分析多了\n\n - 30 5d 整个SNMP报文的编码方式为30，即SEQUENCE类型，报文长度93(0x5d)字节；\n - 02 01 01 版本号01即v2版本；\n - 04 06 70 75 62 6c 69 63 团体名70 75 62 6c 69 63  即英文的“public”；\n - a7 50 a7表示trap类型为7，即厂商自定义trap；50表示PDU区段占80(0x50)字节；\n - 02 04 17 73 2c fb 请求ID为17 73 2c fb 十进制的393424123；\n - 02 01 00 错误状态0；\n - 02 01 00 错误索引0；\n - 30 42 “变量名-值”对编码类型30 即SEQUENCE类型；“变量名-值”所占总字节0x42，即66字节；\n - 30 0d 06 08 2b 06 01 02 01 01 03 00 43 01 0e 第一个“名-值”对区段编码方式30 即SEQUENCE类型；第一个“名-值”对总长度0x0d，13字节；第一个变量名的编码类型0x06，时间标签；第一个变量名占0x08个字节；第一个变量名2b 06 01 02 01 01 03 00，为1.3.6.1.2.1.1.3.0；第一个变量值为0x0e，即14；\n - 30 17 06 0a 2b 06 01 06 03 01 01 04 01 00 06 09 2b 06 01 06 03 01 01 05 01 第二个“名-值”对；变量名1.3.6.1.6.3.1.1.4.1.0；变量值1.3.6.1.6.3.1.1.5.1；\n - 30 18 06 0a 2b 06 01 06 03 01 01 04 03 00 06 0a 2b 06 01 04 01 bf 08 03 02 0a 第三个“名-值”对；变量名1.3.6.1.6.3.1.1.4.3.0；变量值1.3.6.1.4.1.8072.3.2.10；\n\n今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。\n  ------\n\n\n  [1]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274236dktq.jpg\n  [2]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274238733S.jpg\n  [3]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274240Yo8Q.jpg\n  [4]: http://blog.chinaunix.net/attachment/201206/21/23069658_134027424269yP.jpg\n  [5]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274245phSV.jpg\n  [6]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274247srSc.jpg\n  [7]: http://blog.chinaunix.net/attachment/201206/21/23069658_134027425066MR.jpg\n  [8]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274252oJOX.jpg","slug":"SNMP学习总结(1)——基本概念","published":1,"updated":"2018-02-27T07:38:38.090Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspf6000tn8vfgvijlktz","content":"<p>这篇博客简要介绍了snmp协议的基本概念<br><a id=\"more\"></a></p>\n<h2 id=\"1-SNMP简单概述\"><a href=\"#1-SNMP简单概述\" class=\"headerlink\" title=\"1 SNMP简单概述\"></a>1 SNMP简单概述</h2><h3 id=\"1-1-什么是SNMP\"><a href=\"#1-1-什么是SNMP\" class=\"headerlink\" title=\"1.1 什么是SNMP?\"></a>1.1 什么是SNMP?</h3><p>　　SNMP是英文”Simple Network Management Protocol”的缩写，中文意思是“简单的网络管理协议”。它属于TCP/IP五层协议中的应用层协议，用于网络管理的协议。SNMP主要用于网络设备的管理。由于SNMP协议简单可靠 ，受到了众多厂商的欢迎，成为了目前最为广泛的网管协议。<br>　　SNMP协议主要由两大部分组成：<strong>SNMP管理站</strong>和<strong>SNMP代理</strong>。SNMP管理站是一个中心节点，负责收集维护各个SNMP元素的信息，并对这些信息进行处理，最后反馈给网络管理员；而SNMP代理是运行在各个被管理的网络节点之上，负责统计该节点的各项信息，并且负责与SNMP管理站交互，接收并执行管理站的命令，上传各种本地的网络信息。<br>　　SNMP管理站和SNMP代理之间是松散耦合。他们之间的通信是通过UDP协议完成的。一般情况下，SNMP管理站通过UDP协议向SNMP代理发送各种命令，当SNMP代理收到命令后，返回SNMP管理站需要的参数。但是当SNMP代理检测到网络元素异常的时候，也可以主动向SNMP管理站发送消息，通告当前异常状况。<br>　　SNMP的基本思想：为不同种类的设备、不同厂家生产的设备、不同型号的设备，定义为一个统一的接口和协议，使得管理员可以是使用统一的外观面对这些需要管理的网络设备进行管理。通过网络，管理员可以管理位于不同物理空间的设备，从而大大提高网络管理的效率，简化网络管理员的工作。<br>　　SNMP的工作方式：管理员需要向设备获取数据，所以SNMP提供了【读】操作；管理员需要向设备执行设置操作，所以SNMP提供了【写】操作；设备需要在重要状况改变的时候，向管理员通报事件的发生，所以SNMP提供了【Trap】操作。</p>\n<h3 id=\"1-2-SNMP和UDP\"><a href=\"#1-2-SNMP和UDP\" class=\"headerlink\" title=\"1.2 SNMP和UDP\"></a>1.2 SNMP和UDP</h3><p>SNMP采用UDP协议在管理端和agent之间传输信息。 SNMP采用UDP161端口接收和发送请求，162端口接收trap，执行SNMP的设备缺省都必须采用这些端口。SNMP消息全部通过UDP端口161接收，只有Trap信息采用UDP端口162。</p>\n<h3 id=\"1-3-Snmp版本\"><a href=\"#1-3-Snmp版本\" class=\"headerlink\" title=\"1.3 Snmp版本\"></a>1.3 Snmp版本</h3><p>SNMP目前共有v1，v2，v3这三个版本： </p>\n<ul>\n<li>SNMP v1是SNMP协议的最初版本，不过依然是众多厂家实现SNMP基本方式。 </li>\n<li>SNMP v2通常被指是基于community的SNMP V2。Community实质上就是密码。</li>\n<li>SNMP v3 是最新版本的SNMP。它对网络管理最大的贡献在于其安全性。增加了对认证和密文传输的支持。</li>\n</ul>\n<h2 id=\"2-SNMP工作原理\"><a href=\"#2-SNMP工作原理\" class=\"headerlink\" title=\"2 SNMP工作原理\"></a>2 SNMP工作原理</h2><p>　　在具体的实现上，SNMP为管理员提供了一个网管平台（NMS），又称为管理站，负责网管命令的发出、数据存储及数据分析。被监管的设备上运行一个SNMP代理（Agent），代理实现设备与管理站的SNMP通信。<br>　　<img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274236dktq.jpg\" alt=\"snmp工作原理\"><br>　　管理站和代理端使用MIB进行接口统一，MIB定义了设备中的被管理对象。管理站和代理都实现相应的MIB对象，使得双方可以识别对方的数据，实现通信。管理站向代理请求MIB中定义的数据，代理端识别后，将管理设备提供的相关状态或参数等数据转换成MIB定义的格式，最后将该信息返回给管理站，完成一次管理操作。\n　　</p>\n<h2 id=\"3-SNMP报文\"><a href=\"#3-SNMP报文\" class=\"headerlink\" title=\"3 SNMP报文\"></a>3 SNMP报文</h2><h3 id=\"3-1-报文类型\"><a href=\"#3-1-报文类型\" class=\"headerlink\" title=\"3.1 报文类型\"></a>3.1 报文类型</h3><p>　　SNMP中定义了五种消息类型：Get-Request、Get-Response、Get-Next-Request、Set-Request和Trap。</p>\n<ul>\n<li>Get-Request 、Get-Next-Request与Get-Response<br>SNMP 管理站用Get-Request消息从拥有SNMP代理的网络设备中检索信息，而SNMP代理则用Get-Response消息响应。Get-Next- Request用于和Get-Request组合起来查询特定的表对象中的列元素。</li>\n<li>Set-Request SNMP管理站用Set-Request 可以对网络设备进行远程配置（包括设备名、设备属性、删除设备或使某一个设备属性有效/无效等）。</li>\n<li>Trap SNMP代理使用Trap向SNMP管理站发送非请求消息，一般用于描述某一事件的发生，如接口UP/DOWN，IP地址更改等。</li>\n</ul>\n<p>上面五种消息中Get-Request、Get-Next-Request和Set-Request是由管理站发送到代理侧的161端口的；后面两种Get-Response和Trap 是由代理进程发给管理进程的，其中Trap消息被发送到管理进程的162端口，所有数据都是走UDP封装。SNMP工作流程如图2：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274238733S.jpg\" alt=\"SNMP工作流程\"></p>\n<h3 id=\"3-2-报文格式\"><a href=\"#3-2-报文格式\" class=\"headerlink\" title=\"3.2 报文格式\"></a>3.2 报文格式</h3><p>SNMP代理和管理站通过SNMP协议中的标准消息进行通信，每个消息都是一个单独的数据报。SNMP使用UDP（用户数据报协议）作为第四层协议（传输协议），进行无连接操作。SNMP消息报文包含两个部分：SNMP报头和协议数据单元PDU。<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274240Yo8Q.jpg\" alt=\"SNMP报文格式\"></p>\n<p><strong>以下部分是报文格式的具体分析，有需要可以继续学习。</strong></p>\n<p>　　在实际网络传输环境下，SNMP报文的长度取决于其所采用的编码方式。SNMP统一采用BER(Basic Encoding Rule)的编码规则，同时在正式SNMP规范中使用的是ASN.1语法，Abastract Syntax Notation v1，即抽象语法描述语言。这两个概念在后面实践环节再做进一步介绍，这里只要稍微了解一下即可，不妨碍我们对协议本身的分析。这里我们简单解释一下BER编码规则：<br>　　BER作为ANS.1的基本编码规则，描述具体的ANS.1对象如何编码为比特流在网络上进行传输。BER编码规则由三部分组成：<br>　　<img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_134027424269yP.jpg\" alt=\"BER编码方式\"><br>    SNMP中定义了几种基本的数据类型，其中v1和v2版有些改动，具体参见相应的RFC文档。这里我们只介绍几种最常见的类型：</p>\n<ul>\n<li>INTEGER：一个整数</li>\n<li>OCTER STRING： 0或多个8bit字节，每个字节在0~255之间取值</li>\n<li>DisplayString：0或多个8bit字节，每个字节必须是ASCII码。在MIB-II中，所有该类型变量不能超过255个字符(0个字符可以)</li>\n<li>NULL：代表相关的变量没有值</li>\n<li>IpAddress：4字节长的OCTER STRING，以网络字节序表示IP地址</li>\n<li>PhyAddress：6字节长的OCTER STRING，代表物理地址</li>\n<li>Counter：非负整数，可以从0递增到232-1()。达到最大值后归0</li>\n<li>TimeTicks：时间计数器，以0.01秒为单位递增，不同的变量可以有不同的递增幅度。所以在定义这种类型的变量时需要制定递增幅度</li>\n<li>SEQUENCE：与C语言中的结构体类似</li>\n<li>SEQUENCE OF：一个向量，参见后面ANS.1语法详细介绍章节</li>\n</ul>\n<p>SNMP报文在传输层是封装在UDP报文中的，而UDP又是基于IP网络的，因此，我们可以得到完整的报文描述结构，如下图所示：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274245phSV.jpg\" alt=\"SNMP协议报文格式\"><br>PDU类型其实包含两个字节，第一个字节表示真实的PDU的类型；第二个字节表示后面报文所占的字节总数。针对SNMPv1，这个字段取值如下：<br>| PDU类型  | 名 称   |<br>| :——–: | :—–:  |<br>| 0     | get-request |<br>| 1        |   get-next-request   |<br>| 2        |    get-response    |<br>| 3        |    set-request   |<br>| 4        |    trap   |<br>　　也就是说，trap的类型是4。但是在数据报文中，该字段一般表示为ax，其中x取[0,4]，即a0~a3表示相应的get、set等操作，a4表示trap报文。这里除了类型字段意外，其他字段均采用BER编码方式：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274247srSc.jpg\" alt=\"采用BER编码的字段\"><br>　　<br><strong>实战演练之报文格式分析</strong><br>　　Trap报文格式和上述图5所展示的结构有些差别，这里我们只分析SNMPv1和SNMPv2的Trap报文格式。trap报文前面的部分都一样，区别在PDU协议数据单元部分。</p>\n<p>SNMPv1 Trap报文<br>SNMPv1的Trap报文格式如下所示：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_134027425066MR.jpg\" alt=\"SNMPv1的Trap报文格式\"><br>注意：除了PDU类型和PDU长度字段外，后面的每个字段都是BER编码方式。<br>    trap类型”可以取以下值，其中0~6是已定义的特定trap，7及其以后的类型由供应商自定义。<br>表2 trap类型、名称及描述信息<br>| trap类型        | 名称   |  描述信息  |<br>| :——–:   | :—–:  | :—-:  |<br>| ０     | coldStart |   代理进程对自己初始化     |<br>| １        |   warmStart   |   代理进程对自己重新初始化   |<br>| ２        |   linkDown    |  一个接口已从工作状态变为故障状态(报文中的第一个变量标识此接口)  |<br>| ３     | linkUp |  一个接口已从故障状态变为工作状态(报文中的第一个变量标识此接口)     |<br>| ４        |   authenticationFailure   |   从SNMP管理进程收到无效共同体的报文   |<br>| ５        |    egpNeighborLoss    |  一个EGP邻站已变为故障状态(报文中的第一个变量包含邻站IP地址) |<br>| ６     | enterpriseSpecific |   在这个特定的代码段中查找trap信息     |<br>　　通过wireshark抓包工具，捕获一条如下的SNMP报文，接下来对其进行仔细分析。<br>SNMPv1原始报文内容：</p>\n<p><font color=\"green\">00 23 5a 9e 58 b9</font> <font color=\"blue\">00 4c 41 49 50 55</font> <font color=\"red\">08 005</font> <font color=\"gold\">45 00 00 48 00 00 40 00 40 11 a5 4e c0 a8 0a 01 c0 a8 0a 05</font> <font color=\"purple\">0c 00 00 a2 00 34 ff e0</font> 30 2a 02 01 00 04 06 70 75 62 6c 69 63 a4 1d 06 0a 2b 06 01 04 01 bf 08 03 02 0a 40 04 c0 a8 0a 01 02 01 00 02 01 00 43 01 0e 30 00</p>\n<p>目的MAC：<font color=\"green\">00 23 5a 9e 58 b9</font><br>源MAC：<font color=\"blue\">00 4c 41 49 50 55</font><br>协议类型：<font color=\"red\">08 005</font> ，为IP数据报<br>IP头：<font color=\"gold\">45 00 00 48 00 00 40 00 40 11 a5 4e c0 a8 0a 01 c0 a8 0a 05</font><br>UDP头：<font color=\"purple\">0c 00 00 a2 00 34 ff e0</font><br>其余部分都为SNMP报文，接下来我们对照前面的报文结构体来逐个分析一下。</p>\n<ul>\n<li>30 表示SNMP消息是ASN.1的SEQUENCE类型；</li>\n<li>2a 表示该SNMP报文的总长度是42(0x2a)个字节，该字段所表示的报文长度起始于它后面的第一个字节直到报文结束；</li>\n<li>02 01 00 表示版本号，可见其确实为BER编码方式。02表示该字段是INTEGER类型；01表示该字段占1个字节；00表示版本号，该值为“版本号-1”；</li>\n<li>04 06 70 75 62 6c 69 63 表示团体名，04表示该字段为OCTET STRING类型；06表示该字段占6个字节；70 75 62 6c 69 63 表示团体名的ANSII码的十六进制形式，这里是“public”；</li>\n<li>a4 1d 其中a4中的“4”表示这是一个trap报文，a4又叫报文的标签标记；1d表示后面还有29(0x1d)个字节的数据；</li>\n<li>06 0a 2b 06 01 04 01 bf 08 03 02 0a 企业OID标识。06表示该字段是个对象标识符，OBJECT IDENTIFIER；0a表示该字段占10(0x0a)个字节；关于SNMP的OID的编码方式有些奇特：例如1.3.6.1.2…. 取前两个数字分别记为x和y。编码时40<em>x+y，这里x=1，y=3，因此结果为40</em>1+3=43，即表示十六进制的2b。因此，这里的企业OID编码即为1.3.6.1.4.1.8072.3.2.10；</li>\n<li>40 04 c0 a8 0a 01 同样40表示该字段为OCTET STRING 类型；04表示IP地址占4个字节；IP地址为192.168.10.1；</li>\n<li>02 01 00 其中00表示trap类型为coldStart；</li>\n<li>02 01 00 其中00表示我们指定的trap即specific-trap也为coldStart类型；</li>\n<li>43 01 0e 43表示为TimeTicks类型；01表示该字段占1个字节；0e即十进制的14表示时间标签为0.14秒，这里时间计数器以0.01秒递增；</li>\n<li>30 00 30表示“键-值”值对的编码类型为SEQUENCE；00表示该字段占0个字节，即没有该字段。</li>\n</ul>\n<p>SNMPv2 Trap报文<br>SNMPv2的Trap报文格式如图8所示：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274252oJOX.jpg\" alt=\"SNMPv2的Trap报文格式\"><br>同样的，这里除了trap类型和报文长度是标准网络字节序之外，其余协议字段也均为BER编码方式。可以看到v2版的trap报文正在向统一的报文格式发展，已经非常类似普通的SNMP请求、响应报文了。<br>SNMPv2原始报文内容：<br>00 23 5a 9e 58 b9 00 4c 41 49 50 55 08 00 45 00 00 7b 00 00 40 00 40 11 a5 1b c0 a8 0a 01 c0 a8 0a 05 0c 01 00 a2 00 67 04 bb 30 5d 02 01 01 04 06 70 75 62 6c 69 63 a7 50 02 04 17 73 2c fb 02 01 00 02 01 00 30 42 30 0d 06 08 2b 06 01 02 01 01 03 00 43 01 0e 30 17 06 0a 2b 06 01 06 03 01 01 04 01 00 06 09 2b 06 01 06 03 01 01 05 01 30 18 06 0a 2b 06 01 06 03 01 01 04 03 00 06 0a 2b 06 01 04 01 bf 08 03 02 0a</p>\n<p>目的MAC：00 23 5a 9e 58 b9<br>源MAC：00 4c 41 49 50 55<br>协议类型：08 00，IP报文<br>IP头：45 00 00 7b 00 00 40 00 40 11 a5 1b c0 a8 0a 01 c0 a8 0a 05<br>UDP头：0c 01 00 a2 00 67 04 bb<br>余下部分全为SNMP报文内容，这里我们做一下简单的约定：<br>xx 标注类型；xx 标注长度；xx 标注真正的数据。<br>这样一来上面这串原始数据就好分析多了</p>\n<ul>\n<li>30 5d 整个SNMP报文的编码方式为30，即SEQUENCE类型，报文长度93(0x5d)字节；</li>\n<li>02 01 01 版本号01即v2版本；</li>\n<li>04 06 70 75 62 6c 69 63 团体名70 75 62 6c 69 63  即英文的“public”；</li>\n<li>a7 50 a7表示trap类型为7，即厂商自定义trap；50表示PDU区段占80(0x50)字节；</li>\n<li>02 04 17 73 2c fb 请求ID为17 73 2c fb 十进制的393424123；</li>\n<li>02 01 00 错误状态0；</li>\n<li>02 01 00 错误索引0；</li>\n<li>30 42 “变量名-值”对编码类型30 即SEQUENCE类型；“变量名-值”所占总字节0x42，即66字节；</li>\n<li>30 0d 06 08 2b 06 01 02 01 01 03 00 43 01 0e 第一个“名-值”对区段编码方式30 即SEQUENCE类型；第一个“名-值”对总长度0x0d，13字节；第一个变量名的编码类型0x06，时间标签；第一个变量名占0x08个字节；第一个变量名2b 06 01 02 01 01 03 00，为1.3.6.1.2.1.1.3.0；第一个变量值为0x0e，即14；</li>\n<li>30 17 06 0a 2b 06 01 06 03 01 01 04 01 00 06 09 2b 06 01 06 03 01 01 05 01 第二个“名-值”对；变量名1.3.6.1.6.3.1.1.4.1.0；变量值1.3.6.1.6.3.1.1.5.1；</li>\n<li>30 18 06 0a 2b 06 01 06 03 01 01 04 03 00 06 0a 2b 06 01 04 01 bf 08 03 02 0a 第三个“名-值”对；变量名1.3.6.1.6.3.1.1.4.3.0；变量值1.3.6.1.4.1.8072.3.2.10；</li>\n</ul>\n<h2 id=\"今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。\"><a href=\"#今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。\" class=\"headerlink\" title=\"今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。\"></a>今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。</h2>","site":{"data":{}},"excerpt":"<p>这篇博客简要介绍了snmp协议的基本概念<br>","more":"</p>\n<h2 id=\"1-SNMP简单概述\"><a href=\"#1-SNMP简单概述\" class=\"headerlink\" title=\"1 SNMP简单概述\"></a>1 SNMP简单概述</h2><h3 id=\"1-1-什么是SNMP\"><a href=\"#1-1-什么是SNMP\" class=\"headerlink\" title=\"1.1 什么是SNMP?\"></a>1.1 什么是SNMP?</h3><p>　　SNMP是英文”Simple Network Management Protocol”的缩写，中文意思是“简单的网络管理协议”。它属于TCP/IP五层协议中的应用层协议，用于网络管理的协议。SNMP主要用于网络设备的管理。由于SNMP协议简单可靠 ，受到了众多厂商的欢迎，成为了目前最为广泛的网管协议。<br>　　SNMP协议主要由两大部分组成：<strong>SNMP管理站</strong>和<strong>SNMP代理</strong>。SNMP管理站是一个中心节点，负责收集维护各个SNMP元素的信息，并对这些信息进行处理，最后反馈给网络管理员；而SNMP代理是运行在各个被管理的网络节点之上，负责统计该节点的各项信息，并且负责与SNMP管理站交互，接收并执行管理站的命令，上传各种本地的网络信息。<br>　　SNMP管理站和SNMP代理之间是松散耦合。他们之间的通信是通过UDP协议完成的。一般情况下，SNMP管理站通过UDP协议向SNMP代理发送各种命令，当SNMP代理收到命令后，返回SNMP管理站需要的参数。但是当SNMP代理检测到网络元素异常的时候，也可以主动向SNMP管理站发送消息，通告当前异常状况。<br>　　SNMP的基本思想：为不同种类的设备、不同厂家生产的设备、不同型号的设备，定义为一个统一的接口和协议，使得管理员可以是使用统一的外观面对这些需要管理的网络设备进行管理。通过网络，管理员可以管理位于不同物理空间的设备，从而大大提高网络管理的效率，简化网络管理员的工作。<br>　　SNMP的工作方式：管理员需要向设备获取数据，所以SNMP提供了【读】操作；管理员需要向设备执行设置操作，所以SNMP提供了【写】操作；设备需要在重要状况改变的时候，向管理员通报事件的发生，所以SNMP提供了【Trap】操作。</p>\n<h3 id=\"1-2-SNMP和UDP\"><a href=\"#1-2-SNMP和UDP\" class=\"headerlink\" title=\"1.2 SNMP和UDP\"></a>1.2 SNMP和UDP</h3><p>SNMP采用UDP协议在管理端和agent之间传输信息。 SNMP采用UDP161端口接收和发送请求，162端口接收trap，执行SNMP的设备缺省都必须采用这些端口。SNMP消息全部通过UDP端口161接收，只有Trap信息采用UDP端口162。</p>\n<h3 id=\"1-3-Snmp版本\"><a href=\"#1-3-Snmp版本\" class=\"headerlink\" title=\"1.3 Snmp版本\"></a>1.3 Snmp版本</h3><p>SNMP目前共有v1，v2，v3这三个版本： </p>\n<ul>\n<li>SNMP v1是SNMP协议的最初版本，不过依然是众多厂家实现SNMP基本方式。 </li>\n<li>SNMP v2通常被指是基于community的SNMP V2。Community实质上就是密码。</li>\n<li>SNMP v3 是最新版本的SNMP。它对网络管理最大的贡献在于其安全性。增加了对认证和密文传输的支持。</li>\n</ul>\n<h2 id=\"2-SNMP工作原理\"><a href=\"#2-SNMP工作原理\" class=\"headerlink\" title=\"2 SNMP工作原理\"></a>2 SNMP工作原理</h2><p>　　在具体的实现上，SNMP为管理员提供了一个网管平台（NMS），又称为管理站，负责网管命令的发出、数据存储及数据分析。被监管的设备上运行一个SNMP代理（Agent），代理实现设备与管理站的SNMP通信。<br>　　<img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274236dktq.jpg\" alt=\"snmp工作原理\"><br>　　管理站和代理端使用MIB进行接口统一，MIB定义了设备中的被管理对象。管理站和代理都实现相应的MIB对象，使得双方可以识别对方的数据，实现通信。管理站向代理请求MIB中定义的数据，代理端识别后，将管理设备提供的相关状态或参数等数据转换成MIB定义的格式，最后将该信息返回给管理站，完成一次管理操作。\n　　</p>\n<h2 id=\"3-SNMP报文\"><a href=\"#3-SNMP报文\" class=\"headerlink\" title=\"3 SNMP报文\"></a>3 SNMP报文</h2><h3 id=\"3-1-报文类型\"><a href=\"#3-1-报文类型\" class=\"headerlink\" title=\"3.1 报文类型\"></a>3.1 报文类型</h3><p>　　SNMP中定义了五种消息类型：Get-Request、Get-Response、Get-Next-Request、Set-Request和Trap。</p>\n<ul>\n<li>Get-Request 、Get-Next-Request与Get-Response<br>SNMP 管理站用Get-Request消息从拥有SNMP代理的网络设备中检索信息，而SNMP代理则用Get-Response消息响应。Get-Next- Request用于和Get-Request组合起来查询特定的表对象中的列元素。</li>\n<li>Set-Request SNMP管理站用Set-Request 可以对网络设备进行远程配置（包括设备名、设备属性、删除设备或使某一个设备属性有效/无效等）。</li>\n<li>Trap SNMP代理使用Trap向SNMP管理站发送非请求消息，一般用于描述某一事件的发生，如接口UP/DOWN，IP地址更改等。</li>\n</ul>\n<p>上面五种消息中Get-Request、Get-Next-Request和Set-Request是由管理站发送到代理侧的161端口的；后面两种Get-Response和Trap 是由代理进程发给管理进程的，其中Trap消息被发送到管理进程的162端口，所有数据都是走UDP封装。SNMP工作流程如图2：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274238733S.jpg\" alt=\"SNMP工作流程\"></p>\n<h3 id=\"3-2-报文格式\"><a href=\"#3-2-报文格式\" class=\"headerlink\" title=\"3.2 报文格式\"></a>3.2 报文格式</h3><p>SNMP代理和管理站通过SNMP协议中的标准消息进行通信，每个消息都是一个单独的数据报。SNMP使用UDP（用户数据报协议）作为第四层协议（传输协议），进行无连接操作。SNMP消息报文包含两个部分：SNMP报头和协议数据单元PDU。<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274240Yo8Q.jpg\" alt=\"SNMP报文格式\"></p>\n<p><strong>以下部分是报文格式的具体分析，有需要可以继续学习。</strong></p>\n<p>　　在实际网络传输环境下，SNMP报文的长度取决于其所采用的编码方式。SNMP统一采用BER(Basic Encoding Rule)的编码规则，同时在正式SNMP规范中使用的是ASN.1语法，Abastract Syntax Notation v1，即抽象语法描述语言。这两个概念在后面实践环节再做进一步介绍，这里只要稍微了解一下即可，不妨碍我们对协议本身的分析。这里我们简单解释一下BER编码规则：<br>　　BER作为ANS.1的基本编码规则，描述具体的ANS.1对象如何编码为比特流在网络上进行传输。BER编码规则由三部分组成：<br>　　<img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_134027424269yP.jpg\" alt=\"BER编码方式\"><br>    SNMP中定义了几种基本的数据类型，其中v1和v2版有些改动，具体参见相应的RFC文档。这里我们只介绍几种最常见的类型：</p>\n<ul>\n<li>INTEGER：一个整数</li>\n<li>OCTER STRING： 0或多个8bit字节，每个字节在0~255之间取值</li>\n<li>DisplayString：0或多个8bit字节，每个字节必须是ASCII码。在MIB-II中，所有该类型变量不能超过255个字符(0个字符可以)</li>\n<li>NULL：代表相关的变量没有值</li>\n<li>IpAddress：4字节长的OCTER STRING，以网络字节序表示IP地址</li>\n<li>PhyAddress：6字节长的OCTER STRING，代表物理地址</li>\n<li>Counter：非负整数，可以从0递增到232-1()。达到最大值后归0</li>\n<li>TimeTicks：时间计数器，以0.01秒为单位递增，不同的变量可以有不同的递增幅度。所以在定义这种类型的变量时需要制定递增幅度</li>\n<li>SEQUENCE：与C语言中的结构体类似</li>\n<li>SEQUENCE OF：一个向量，参见后面ANS.1语法详细介绍章节</li>\n</ul>\n<p>SNMP报文在传输层是封装在UDP报文中的，而UDP又是基于IP网络的，因此，我们可以得到完整的报文描述结构，如下图所示：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274245phSV.jpg\" alt=\"SNMP协议报文格式\"><br>PDU类型其实包含两个字节，第一个字节表示真实的PDU的类型；第二个字节表示后面报文所占的字节总数。针对SNMPv1，这个字段取值如下：<br>| PDU类型  | 名 称   |<br>| :——–: | :—–:  |<br>| 0     | get-request |<br>| 1        |   get-next-request   |<br>| 2        |    get-response    |<br>| 3        |    set-request   |<br>| 4        |    trap   |<br>　　也就是说，trap的类型是4。但是在数据报文中，该字段一般表示为ax，其中x取[0,4]，即a0~a3表示相应的get、set等操作，a4表示trap报文。这里除了类型字段意外，其他字段均采用BER编码方式：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274247srSc.jpg\" alt=\"采用BER编码的字段\"><br>　　<br><strong>实战演练之报文格式分析</strong><br>　　Trap报文格式和上述图5所展示的结构有些差别，这里我们只分析SNMPv1和SNMPv2的Trap报文格式。trap报文前面的部分都一样，区别在PDU协议数据单元部分。</p>\n<p>SNMPv1 Trap报文<br>SNMPv1的Trap报文格式如下所示：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_134027425066MR.jpg\" alt=\"SNMPv1的Trap报文格式\"><br>注意：除了PDU类型和PDU长度字段外，后面的每个字段都是BER编码方式。<br>    trap类型”可以取以下值，其中0~6是已定义的特定trap，7及其以后的类型由供应商自定义。<br>表2 trap类型、名称及描述信息<br>| trap类型        | 名称   |  描述信息  |<br>| :——–:   | :—–:  | :—-:  |<br>| ０     | coldStart |   代理进程对自己初始化     |<br>| １        |   warmStart   |   代理进程对自己重新初始化   |<br>| ２        |   linkDown    |  一个接口已从工作状态变为故障状态(报文中的第一个变量标识此接口)  |<br>| ３     | linkUp |  一个接口已从故障状态变为工作状态(报文中的第一个变量标识此接口)     |<br>| ４        |   authenticationFailure   |   从SNMP管理进程收到无效共同体的报文   |<br>| ５        |    egpNeighborLoss    |  一个EGP邻站已变为故障状态(报文中的第一个变量包含邻站IP地址) |<br>| ６     | enterpriseSpecific |   在这个特定的代码段中查找trap信息     |<br>　　通过wireshark抓包工具，捕获一条如下的SNMP报文，接下来对其进行仔细分析。<br>SNMPv1原始报文内容：</p>\n<p><font color=\"green\">00 23 5a 9e 58 b9</font> <font color=\"blue\">00 4c 41 49 50 55</font> <font color=\"red\">08 005</font> <font color=\"gold\">45 00 00 48 00 00 40 00 40 11 a5 4e c0 a8 0a 01 c0 a8 0a 05</font> <font color=\"purple\">0c 00 00 a2 00 34 ff e0</font> 30 2a 02 01 00 04 06 70 75 62 6c 69 63 a4 1d 06 0a 2b 06 01 04 01 bf 08 03 02 0a 40 04 c0 a8 0a 01 02 01 00 02 01 00 43 01 0e 30 00</p>\n<p>目的MAC：<font color=\"green\">00 23 5a 9e 58 b9</font><br>源MAC：<font color=\"blue\">00 4c 41 49 50 55</font><br>协议类型：<font color=\"red\">08 005</font> ，为IP数据报<br>IP头：<font color=\"gold\">45 00 00 48 00 00 40 00 40 11 a5 4e c0 a8 0a 01 c0 a8 0a 05</font><br>UDP头：<font color=\"purple\">0c 00 00 a2 00 34 ff e0</font><br>其余部分都为SNMP报文，接下来我们对照前面的报文结构体来逐个分析一下。</p>\n<ul>\n<li>30 表示SNMP消息是ASN.1的SEQUENCE类型；</li>\n<li>2a 表示该SNMP报文的总长度是42(0x2a)个字节，该字段所表示的报文长度起始于它后面的第一个字节直到报文结束；</li>\n<li>02 01 00 表示版本号，可见其确实为BER编码方式。02表示该字段是INTEGER类型；01表示该字段占1个字节；00表示版本号，该值为“版本号-1”；</li>\n<li>04 06 70 75 62 6c 69 63 表示团体名，04表示该字段为OCTET STRING类型；06表示该字段占6个字节；70 75 62 6c 69 63 表示团体名的ANSII码的十六进制形式，这里是“public”；</li>\n<li>a4 1d 其中a4中的“4”表示这是一个trap报文，a4又叫报文的标签标记；1d表示后面还有29(0x1d)个字节的数据；</li>\n<li>06 0a 2b 06 01 04 01 bf 08 03 02 0a 企业OID标识。06表示该字段是个对象标识符，OBJECT IDENTIFIER；0a表示该字段占10(0x0a)个字节；关于SNMP的OID的编码方式有些奇特：例如1.3.6.1.2…. 取前两个数字分别记为x和y。编码时40<em>x+y，这里x=1，y=3，因此结果为40</em>1+3=43，即表示十六进制的2b。因此，这里的企业OID编码即为1.3.6.1.4.1.8072.3.2.10；</li>\n<li>40 04 c0 a8 0a 01 同样40表示该字段为OCTET STRING 类型；04表示IP地址占4个字节；IP地址为192.168.10.1；</li>\n<li>02 01 00 其中00表示trap类型为coldStart；</li>\n<li>02 01 00 其中00表示我们指定的trap即specific-trap也为coldStart类型；</li>\n<li>43 01 0e 43表示为TimeTicks类型；01表示该字段占1个字节；0e即十进制的14表示时间标签为0.14秒，这里时间计数器以0.01秒递增；</li>\n<li>30 00 30表示“键-值”值对的编码类型为SEQUENCE；00表示该字段占0个字节，即没有该字段。</li>\n</ul>\n<p>SNMPv2 Trap报文<br>SNMPv2的Trap报文格式如图8所示：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274252oJOX.jpg\" alt=\"SNMPv2的Trap报文格式\"><br>同样的，这里除了trap类型和报文长度是标准网络字节序之外，其余协议字段也均为BER编码方式。可以看到v2版的trap报文正在向统一的报文格式发展，已经非常类似普通的SNMP请求、响应报文了。<br>SNMPv2原始报文内容：<br>00 23 5a 9e 58 b9 00 4c 41 49 50 55 08 00 45 00 00 7b 00 00 40 00 40 11 a5 1b c0 a8 0a 01 c0 a8 0a 05 0c 01 00 a2 00 67 04 bb 30 5d 02 01 01 04 06 70 75 62 6c 69 63 a7 50 02 04 17 73 2c fb 02 01 00 02 01 00 30 42 30 0d 06 08 2b 06 01 02 01 01 03 00 43 01 0e 30 17 06 0a 2b 06 01 06 03 01 01 04 01 00 06 09 2b 06 01 06 03 01 01 05 01 30 18 06 0a 2b 06 01 06 03 01 01 04 03 00 06 0a 2b 06 01 04 01 bf 08 03 02 0a</p>\n<p>目的MAC：00 23 5a 9e 58 b9<br>源MAC：00 4c 41 49 50 55<br>协议类型：08 00，IP报文<br>IP头：45 00 00 7b 00 00 40 00 40 11 a5 1b c0 a8 0a 01 c0 a8 0a 05<br>UDP头：0c 01 00 a2 00 67 04 bb<br>余下部分全为SNMP报文内容，这里我们做一下简单的约定：<br>xx 标注类型；xx 标注长度；xx 标注真正的数据。<br>这样一来上面这串原始数据就好分析多了</p>\n<ul>\n<li>30 5d 整个SNMP报文的编码方式为30，即SEQUENCE类型，报文长度93(0x5d)字节；</li>\n<li>02 01 01 版本号01即v2版本；</li>\n<li>04 06 70 75 62 6c 69 63 团体名70 75 62 6c 69 63  即英文的“public”；</li>\n<li>a7 50 a7表示trap类型为7，即厂商自定义trap；50表示PDU区段占80(0x50)字节；</li>\n<li>02 04 17 73 2c fb 请求ID为17 73 2c fb 十进制的393424123；</li>\n<li>02 01 00 错误状态0；</li>\n<li>02 01 00 错误索引0；</li>\n<li>30 42 “变量名-值”对编码类型30 即SEQUENCE类型；“变量名-值”所占总字节0x42，即66字节；</li>\n<li>30 0d 06 08 2b 06 01 02 01 01 03 00 43 01 0e 第一个“名-值”对区段编码方式30 即SEQUENCE类型；第一个“名-值”对总长度0x0d，13字节；第一个变量名的编码类型0x06，时间标签；第一个变量名占0x08个字节；第一个变量名2b 06 01 02 01 01 03 00，为1.3.6.1.2.1.1.3.0；第一个变量值为0x0e，即14；</li>\n<li>30 17 06 0a 2b 06 01 06 03 01 01 04 01 00 06 09 2b 06 01 06 03 01 01 05 01 第二个“名-值”对；变量名1.3.6.1.6.3.1.1.4.1.0；变量值1.3.6.1.6.3.1.1.5.1；</li>\n<li>30 18 06 0a 2b 06 01 06 03 01 01 04 03 00 06 0a 2b 06 01 04 01 bf 08 03 02 0a 第三个“名-值”对；变量名1.3.6.1.6.3.1.1.4.3.0；变量值1.3.6.1.4.1.8072.3.2.10；</li>\n</ul>\n<h2 id=\"今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。\"><a href=\"#今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。\" class=\"headerlink\" title=\"今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。\"></a>今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。</h2>"},{"title":"SNMP学习总结(3)——SNMP4J","date":"2017-05-25T00:42:50.000Z","_content":"这篇博客简要介绍了snmp4j协议栈的基本使用\n<!-- more -->\n## 1 snmp4j简介\n　　SNMP4J是一个用Java来实现SNMP(简单网络管理协议)协议的开源项目.它支持以命令行的形式进行管理与响应。SNMP4J是纯面向对象设计与SNMP++(用C++实现SNMPv1/v2c/v3)相类似。\n　　SNMP4J API 提供以下下特性：\n\n         - 支持MD5和SHA验证，DES，3DES,AES128、AES192和AES256加密的SNMPv3。\n         - 支持MPv1,MPv2C和MPv3，带执行的可阻塞的信息处理模块。\n         - 全部PDU格式。\n         - 可阻塞的传输拓扑。支持UPD、TCP、TLS 。\n         - 可阻塞的超时模块。\n         - 同步和异步请求。\n         - 命令发生器以及命令应答器的支持。\n         - 基于Apache license的开源免费。\n         - JAVA 1.4.1或更高版本(2.0或更高版本需要jdk1.6及以上的支持)。\n         - 基于LOG4J记录日志。\n         - 使用GETBULK实现Row-based的有效的异步表格获取。\n         - 支持多线程。\n         \n## 2 snmp4j重要的类及接口介绍\nSnmp4j包中最重要的三个概念，也是三个类：**Snmp**、**Target**、**PDU**\n### 2.1 Target类\n#### 2.1.1 共有方法\n　　Target表示被管理的设备。对于被管理的设备，我们关注它的Address,它所使用的的协议版本Version，访问它的用户名和密码，以及人为设置的跟他打交道的策略，比如超时时间、\n重传次数等。所以有如下方法：\n\n - 设置或获取IP地址\n```java\nvoid setAddress（Address address）   \nAddress getAddress（）\n```\n - 设置或获取协议版本\n```java\nvoid setVersion(int ver)\nint getVersion()\n```\n - 超时时间（单位：milliseconds）\n```java\nvoid   setTimeout(long out）\nlong getTimeout()\n```\n - 重传次数\n```java\nvoid setRetries(int retries)\nint getRetries()\n```\n - PUD最大值\n```java\nvoid setMaxSizeRequestPDU(int max)\nint getMaxSizeRequestPDU()\n```\n\n上面的方法对于snmp三个版本都是相同的，不同的在于安全方面。具体来说，Snmpv1，v2c采用共同体（community）方式，安全性很差；SnmpV3采用基于用户的安全（USM）方式，安全性能得到很大提高。\n\n#### 2.1.2 communityTarget\n对于Snmpv1，v2c，使用Target派生出一个子类CommunityTarget，增加了对Community的方法：\n```java\nvoid setMaxSizeRequestPDU(int max)\nint getMaxSizeRequestPDU()\n```\n#### 2.1.3 UserTarget\n对于SnmpV3，使用其子类UserTarget，增加了一些有关USM安全方面的设置，比如采用的安全模型、安全级别、访问该设备的用户名以及权威引擎ID（authoritative engine ID）：\n\n - 安全级别（支持三种安全级别）\n```java\nvoid setSecurityLevel(int level)\nint   getSecurityLevel()\n```\n - 访问用户名（该访问用户名称必须在设置USM的时候添加其相应的UsmUser）\n```java\nvoid setSecurityName(OctetString name)\nOctetString   getSecurityName()\n```\n - 安全模型（支持三种安全模型）\n```java\nvoid setSecurityModel(int model)\nint   getSecurityModel()\n```\n - 权威引擎ID（authoritative engine ID）\n```java\nvoid   setAuthoritativeEngineID(byte[] id)\nbyte[] getAuthoritativeEngineID（）\n```\n\n### 2.2 PDU类\n　　PDU（协议数据单元），用来表示管理站跟代理站点进行通信的数据。包括PDU的类型、传输的数据集合、错误说明等。\n　　该类是SNMP报文单元的抽象，其中PDU类适用于SNMPv1和SNMPv2c。ScopedPDU类继承于PDU类，适用于SNMPv3。\n　　Snmp4j针对Snmp的各个版本，开发了三个有关PDU的类。PDU（针对Snmpv2c）、PDUv1（针对Snmpv1）、ScopedPDU（针对Snmpv3），但三个类除各自特别的一些参数外，都基本相同。所以Snmp4j在设计的时候，将PDU设计成另外两个的超类，使他们能够共享大部分功能。\n　　\n### 2.3 Snmp类\n　　snmp类是SNMP4J的核心，它提供了发送和接收SNMP PDUs的方法，所有的SNMP PDU 类型都可以采用同步或者异步的方式被发送。\n　　Snmp采用独立的传输协议，通过`TransportMapping`接口调用`addTransportMapping(TransportMapping transportMapping)`方法或者采用默认的构造函数来实现传输映射，以此来实现信息的传输。\n　　\n\n\n\n\n","source":"_posts/SNMP学习笔记(3)——snmp4j.md","raw":"---\ntitle: SNMP学习总结(3)——SNMP4J\ndate: 2017-05-25 8:42:50\ncategories:\n  - SNMP\ntags:\n  - snmp\n  - network\n  - snmp4j\n---\n这篇博客简要介绍了snmp4j协议栈的基本使用\n<!-- more -->\n## 1 snmp4j简介\n　　SNMP4J是一个用Java来实现SNMP(简单网络管理协议)协议的开源项目.它支持以命令行的形式进行管理与响应。SNMP4J是纯面向对象设计与SNMP++(用C++实现SNMPv1/v2c/v3)相类似。\n　　SNMP4J API 提供以下下特性：\n\n         - 支持MD5和SHA验证，DES，3DES,AES128、AES192和AES256加密的SNMPv3。\n         - 支持MPv1,MPv2C和MPv3，带执行的可阻塞的信息处理模块。\n         - 全部PDU格式。\n         - 可阻塞的传输拓扑。支持UPD、TCP、TLS 。\n         - 可阻塞的超时模块。\n         - 同步和异步请求。\n         - 命令发生器以及命令应答器的支持。\n         - 基于Apache license的开源免费。\n         - JAVA 1.4.1或更高版本(2.0或更高版本需要jdk1.6及以上的支持)。\n         - 基于LOG4J记录日志。\n         - 使用GETBULK实现Row-based的有效的异步表格获取。\n         - 支持多线程。\n         \n## 2 snmp4j重要的类及接口介绍\nSnmp4j包中最重要的三个概念，也是三个类：**Snmp**、**Target**、**PDU**\n### 2.1 Target类\n#### 2.1.1 共有方法\n　　Target表示被管理的设备。对于被管理的设备，我们关注它的Address,它所使用的的协议版本Version，访问它的用户名和密码，以及人为设置的跟他打交道的策略，比如超时时间、\n重传次数等。所以有如下方法：\n\n - 设置或获取IP地址\n```java\nvoid setAddress（Address address）   \nAddress getAddress（）\n```\n - 设置或获取协议版本\n```java\nvoid setVersion(int ver)\nint getVersion()\n```\n - 超时时间（单位：milliseconds）\n```java\nvoid   setTimeout(long out）\nlong getTimeout()\n```\n - 重传次数\n```java\nvoid setRetries(int retries)\nint getRetries()\n```\n - PUD最大值\n```java\nvoid setMaxSizeRequestPDU(int max)\nint getMaxSizeRequestPDU()\n```\n\n上面的方法对于snmp三个版本都是相同的，不同的在于安全方面。具体来说，Snmpv1，v2c采用共同体（community）方式，安全性很差；SnmpV3采用基于用户的安全（USM）方式，安全性能得到很大提高。\n\n#### 2.1.2 communityTarget\n对于Snmpv1，v2c，使用Target派生出一个子类CommunityTarget，增加了对Community的方法：\n```java\nvoid setMaxSizeRequestPDU(int max)\nint getMaxSizeRequestPDU()\n```\n#### 2.1.3 UserTarget\n对于SnmpV3，使用其子类UserTarget，增加了一些有关USM安全方面的设置，比如采用的安全模型、安全级别、访问该设备的用户名以及权威引擎ID（authoritative engine ID）：\n\n - 安全级别（支持三种安全级别）\n```java\nvoid setSecurityLevel(int level)\nint   getSecurityLevel()\n```\n - 访问用户名（该访问用户名称必须在设置USM的时候添加其相应的UsmUser）\n```java\nvoid setSecurityName(OctetString name)\nOctetString   getSecurityName()\n```\n - 安全模型（支持三种安全模型）\n```java\nvoid setSecurityModel(int model)\nint   getSecurityModel()\n```\n - 权威引擎ID（authoritative engine ID）\n```java\nvoid   setAuthoritativeEngineID(byte[] id)\nbyte[] getAuthoritativeEngineID（）\n```\n\n### 2.2 PDU类\n　　PDU（协议数据单元），用来表示管理站跟代理站点进行通信的数据。包括PDU的类型、传输的数据集合、错误说明等。\n　　该类是SNMP报文单元的抽象，其中PDU类适用于SNMPv1和SNMPv2c。ScopedPDU类继承于PDU类，适用于SNMPv3。\n　　Snmp4j针对Snmp的各个版本，开发了三个有关PDU的类。PDU（针对Snmpv2c）、PDUv1（针对Snmpv1）、ScopedPDU（针对Snmpv3），但三个类除各自特别的一些参数外，都基本相同。所以Snmp4j在设计的时候，将PDU设计成另外两个的超类，使他们能够共享大部分功能。\n　　\n### 2.3 Snmp类\n　　snmp类是SNMP4J的核心，它提供了发送和接收SNMP PDUs的方法，所有的SNMP PDU 类型都可以采用同步或者异步的方式被发送。\n　　Snmp采用独立的传输协议，通过`TransportMapping`接口调用`addTransportMapping(TransportMapping transportMapping)`方法或者采用默认的构造函数来实现传输映射，以此来实现信息的传输。\n　　\n\n\n\n\n","slug":"SNMP学习笔记(3)——snmp4j","published":1,"updated":"2018-02-27T07:38:38.091Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspf8000un8vf2fyefzkr","content":"<p>这篇博客简要介绍了snmp4j协议栈的基本使用<br><a id=\"more\"></a></p>\n<h2 id=\"1-snmp4j简介\"><a href=\"#1-snmp4j简介\" class=\"headerlink\" title=\"1 snmp4j简介\"></a>1 snmp4j简介</h2><p>　　SNMP4J是一个用Java来实现SNMP(简单网络管理协议)协议的开源项目.它支持以命令行的形式进行管理与响应。SNMP4J是纯面向对象设计与SNMP++(用C++实现SNMPv1/v2c/v3)相类似。<br>　　SNMP4J API 提供以下下特性：</p>\n<pre><code>- 支持MD5和SHA验证，DES，3DES,AES128、AES192和AES256加密的SNMPv3。\n- 支持MPv1,MPv2C和MPv3，带执行的可阻塞的信息处理模块。\n- 全部PDU格式。\n- 可阻塞的传输拓扑。支持UPD、TCP、TLS 。\n- 可阻塞的超时模块。\n- 同步和异步请求。\n- 命令发生器以及命令应答器的支持。\n- 基于Apache license的开源免费。\n- JAVA 1.4.1或更高版本(2.0或更高版本需要jdk1.6及以上的支持)。\n- 基于LOG4J记录日志。\n- 使用GETBULK实现Row-based的有效的异步表格获取。\n- 支持多线程。\n</code></pre><h2 id=\"2-snmp4j重要的类及接口介绍\"><a href=\"#2-snmp4j重要的类及接口介绍\" class=\"headerlink\" title=\"2 snmp4j重要的类及接口介绍\"></a>2 snmp4j重要的类及接口介绍</h2><p>Snmp4j包中最重要的三个概念，也是三个类：<strong>Snmp</strong>、<strong>Target</strong>、<strong>PDU</strong></p>\n<h3 id=\"2-1-Target类\"><a href=\"#2-1-Target类\" class=\"headerlink\" title=\"2.1 Target类\"></a>2.1 Target类</h3><h4 id=\"2-1-1-共有方法\"><a href=\"#2-1-1-共有方法\" class=\"headerlink\" title=\"2.1.1 共有方法\"></a>2.1.1 共有方法</h4><p>　　Target表示被管理的设备。对于被管理的设备，我们关注它的Address,它所使用的的协议版本Version，访问它的用户名和密码，以及人为设置的跟他打交道的策略，比如超时时间、<br>重传次数等。所以有如下方法：</p>\n<ul>\n<li><p>设置或获取IP地址</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> setAddress（Address address）   </div><div class=\"line\">Address getAddress（）</div></pre></td></tr></table></figure>\n</li>\n<li><p>设置或获取协议版本</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setVersion</span><span class=\"params\">(<span class=\"keyword\">int</span> ver)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span> <span class=\"title\">getVersion</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>超时时间（单位：milliseconds）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span>   <span class=\"title\">setTimeout</span><span class=\"params\">(<span class=\"keyword\">long</span> out）</span></span></div><div class=\"line\"><span class=\"keyword\">long</span> getTimeout()</div></pre></td></tr></table></figure>\n</li>\n<li><p>重传次数</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setRetries</span><span class=\"params\">(<span class=\"keyword\">int</span> retries)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span> <span class=\"title\">getRetries</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>PUD最大值</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setMaxSizeRequestPDU</span><span class=\"params\">(<span class=\"keyword\">int</span> max)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span> <span class=\"title\">getMaxSizeRequestPDU</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>上面的方法对于snmp三个版本都是相同的，不同的在于安全方面。具体来说，Snmpv1，v2c采用共同体（community）方式，安全性很差；SnmpV3采用基于用户的安全（USM）方式，安全性能得到很大提高。</p>\n<h4 id=\"2-1-2-communityTarget\"><a href=\"#2-1-2-communityTarget\" class=\"headerlink\" title=\"2.1.2 communityTarget\"></a>2.1.2 communityTarget</h4><p>对于Snmpv1，v2c，使用Target派生出一个子类CommunityTarget，增加了对Community的方法：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setMaxSizeRequestPDU</span><span class=\"params\">(<span class=\"keyword\">int</span> max)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span> <span class=\"title\">getMaxSizeRequestPDU</span><span class=\"params\">()</span></div></pre></td></tr></table></figure></p>\n<h4 id=\"2-1-3-UserTarget\"><a href=\"#2-1-3-UserTarget\" class=\"headerlink\" title=\"2.1.3 UserTarget\"></a>2.1.3 UserTarget</h4><p>对于SnmpV3，使用其子类UserTarget，增加了一些有关USM安全方面的设置，比如采用的安全模型、安全级别、访问该设备的用户名以及权威引擎ID（authoritative engine ID）：</p>\n<ul>\n<li><p>安全级别（支持三种安全级别）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setSecurityLevel</span><span class=\"params\">(<span class=\"keyword\">int</span> level)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span>   <span class=\"title\">getSecurityLevel</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>访问用户名（该访问用户名称必须在设置USM的时候添加其相应的UsmUser）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setSecurityName</span><span class=\"params\">(OctetString name)</span></span></div><div class=\"line\">OctetString   <span class=\"title\">getSecurityName</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>安全模型（支持三种安全模型）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setSecurityModel</span><span class=\"params\">(<span class=\"keyword\">int</span> model)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span>   <span class=\"title\">getSecurityModel</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>权威引擎ID（authoritative engine ID）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span>   <span class=\"title\">setAuthoritativeEngineID</span><span class=\"params\">(<span class=\"keyword\">byte</span>[] id)</span></span></div><div class=\"line\"><span class=\"keyword\">byte</span>[] getAuthoritativeEngineID（）</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"2-2-PDU类\"><a href=\"#2-2-PDU类\" class=\"headerlink\" title=\"2.2 PDU类\"></a>2.2 PDU类</h3><p>　　PDU（协议数据单元），用来表示管理站跟代理站点进行通信的数据。包括PDU的类型、传输的数据集合、错误说明等。<br>　　该类是SNMP报文单元的抽象，其中PDU类适用于SNMPv1和SNMPv2c。ScopedPDU类继承于PDU类，适用于SNMPv3。<br>　　Snmp4j针对Snmp的各个版本，开发了三个有关PDU的类。PDU（针对Snmpv2c）、PDUv1（针对Snmpv1）、ScopedPDU（针对Snmpv3），但三个类除各自特别的一些参数外，都基本相同。所以Snmp4j在设计的时候，将PDU设计成另外两个的超类，使他们能够共享大部分功能。\n　　</p>\n<h3 id=\"2-3-Snmp类\"><a href=\"#2-3-Snmp类\" class=\"headerlink\" title=\"2.3 Snmp类\"></a>2.3 Snmp类</h3><p>　　snmp类是SNMP4J的核心，它提供了发送和接收SNMP PDUs的方法，所有的SNMP PDU 类型都可以采用同步或者异步的方式被发送。<br>　　Snmp采用独立的传输协议，通过<code>TransportMapping</code>接口调用<code>addTransportMapping(TransportMapping transportMapping)</code>方法或者采用默认的构造函数来实现传输映射，以此来实现信息的传输。\n　　</p>\n","site":{"data":{}},"excerpt":"<p>这篇博客简要介绍了snmp4j协议栈的基本使用<br>","more":"</p>\n<h2 id=\"1-snmp4j简介\"><a href=\"#1-snmp4j简介\" class=\"headerlink\" title=\"1 snmp4j简介\"></a>1 snmp4j简介</h2><p>　　SNMP4J是一个用Java来实现SNMP(简单网络管理协议)协议的开源项目.它支持以命令行的形式进行管理与响应。SNMP4J是纯面向对象设计与SNMP++(用C++实现SNMPv1/v2c/v3)相类似。<br>　　SNMP4J API 提供以下下特性：</p>\n<pre><code>- 支持MD5和SHA验证，DES，3DES,AES128、AES192和AES256加密的SNMPv3。\n- 支持MPv1,MPv2C和MPv3，带执行的可阻塞的信息处理模块。\n- 全部PDU格式。\n- 可阻塞的传输拓扑。支持UPD、TCP、TLS 。\n- 可阻塞的超时模块。\n- 同步和异步请求。\n- 命令发生器以及命令应答器的支持。\n- 基于Apache license的开源免费。\n- JAVA 1.4.1或更高版本(2.0或更高版本需要jdk1.6及以上的支持)。\n- 基于LOG4J记录日志。\n- 使用GETBULK实现Row-based的有效的异步表格获取。\n- 支持多线程。\n</code></pre><h2 id=\"2-snmp4j重要的类及接口介绍\"><a href=\"#2-snmp4j重要的类及接口介绍\" class=\"headerlink\" title=\"2 snmp4j重要的类及接口介绍\"></a>2 snmp4j重要的类及接口介绍</h2><p>Snmp4j包中最重要的三个概念，也是三个类：<strong>Snmp</strong>、<strong>Target</strong>、<strong>PDU</strong></p>\n<h3 id=\"2-1-Target类\"><a href=\"#2-1-Target类\" class=\"headerlink\" title=\"2.1 Target类\"></a>2.1 Target类</h3><h4 id=\"2-1-1-共有方法\"><a href=\"#2-1-1-共有方法\" class=\"headerlink\" title=\"2.1.1 共有方法\"></a>2.1.1 共有方法</h4><p>　　Target表示被管理的设备。对于被管理的设备，我们关注它的Address,它所使用的的协议版本Version，访问它的用户名和密码，以及人为设置的跟他打交道的策略，比如超时时间、<br>重传次数等。所以有如下方法：</p>\n<ul>\n<li><p>设置或获取IP地址</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> setAddress（Address address）   </div><div class=\"line\">Address getAddress（）</div></pre></td></tr></table></figure>\n</li>\n<li><p>设置或获取协议版本</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setVersion</span><span class=\"params\">(<span class=\"keyword\">int</span> ver)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span> <span class=\"title\">getVersion</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>超时时间（单位：milliseconds）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span>   <span class=\"title\">setTimeout</span><span class=\"params\">(<span class=\"keyword\">long</span> out）</span></span></div><div class=\"line\"><span class=\"keyword\">long</span> getTimeout()</div></pre></td></tr></table></figure>\n</li>\n<li><p>重传次数</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setRetries</span><span class=\"params\">(<span class=\"keyword\">int</span> retries)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span> <span class=\"title\">getRetries</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>PUD最大值</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setMaxSizeRequestPDU</span><span class=\"params\">(<span class=\"keyword\">int</span> max)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span> <span class=\"title\">getMaxSizeRequestPDU</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>上面的方法对于snmp三个版本都是相同的，不同的在于安全方面。具体来说，Snmpv1，v2c采用共同体（community）方式，安全性很差；SnmpV3采用基于用户的安全（USM）方式，安全性能得到很大提高。</p>\n<h4 id=\"2-1-2-communityTarget\"><a href=\"#2-1-2-communityTarget\" class=\"headerlink\" title=\"2.1.2 communityTarget\"></a>2.1.2 communityTarget</h4><p>对于Snmpv1，v2c，使用Target派生出一个子类CommunityTarget，增加了对Community的方法：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setMaxSizeRequestPDU</span><span class=\"params\">(<span class=\"keyword\">int</span> max)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span> <span class=\"title\">getMaxSizeRequestPDU</span><span class=\"params\">()</span></div></pre></td></tr></table></figure></p>\n<h4 id=\"2-1-3-UserTarget\"><a href=\"#2-1-3-UserTarget\" class=\"headerlink\" title=\"2.1.3 UserTarget\"></a>2.1.3 UserTarget</h4><p>对于SnmpV3，使用其子类UserTarget，增加了一些有关USM安全方面的设置，比如采用的安全模型、安全级别、访问该设备的用户名以及权威引擎ID（authoritative engine ID）：</p>\n<ul>\n<li><p>安全级别（支持三种安全级别）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setSecurityLevel</span><span class=\"params\">(<span class=\"keyword\">int</span> level)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span>   <span class=\"title\">getSecurityLevel</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>访问用户名（该访问用户名称必须在设置USM的时候添加其相应的UsmUser）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setSecurityName</span><span class=\"params\">(OctetString name)</span></span></div><div class=\"line\">OctetString   <span class=\"title\">getSecurityName</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>安全模型（支持三种安全模型）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setSecurityModel</span><span class=\"params\">(<span class=\"keyword\">int</span> model)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span>   <span class=\"title\">getSecurityModel</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>权威引擎ID（authoritative engine ID）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span>   <span class=\"title\">setAuthoritativeEngineID</span><span class=\"params\">(<span class=\"keyword\">byte</span>[] id)</span></span></div><div class=\"line\"><span class=\"keyword\">byte</span>[] getAuthoritativeEngineID（）</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"2-2-PDU类\"><a href=\"#2-2-PDU类\" class=\"headerlink\" title=\"2.2 PDU类\"></a>2.2 PDU类</h3><p>　　PDU（协议数据单元），用来表示管理站跟代理站点进行通信的数据。包括PDU的类型、传输的数据集合、错误说明等。<br>　　该类是SNMP报文单元的抽象，其中PDU类适用于SNMPv1和SNMPv2c。ScopedPDU类继承于PDU类，适用于SNMPv3。<br>　　Snmp4j针对Snmp的各个版本，开发了三个有关PDU的类。PDU（针对Snmpv2c）、PDUv1（针对Snmpv1）、ScopedPDU（针对Snmpv3），但三个类除各自特别的一些参数外，都基本相同。所以Snmp4j在设计的时候，将PDU设计成另外两个的超类，使他们能够共享大部分功能。\n　　</p>\n<h3 id=\"2-3-Snmp类\"><a href=\"#2-3-Snmp类\" class=\"headerlink\" title=\"2.3 Snmp类\"></a>2.3 Snmp类</h3><p>　　snmp类是SNMP4J的核心，它提供了发送和接收SNMP PDUs的方法，所有的SNMP PDU 类型都可以采用同步或者异步的方式被发送。<br>　　Snmp采用独立的传输协议，通过<code>TransportMapping</code>接口调用<code>addTransportMapping(TransportMapping transportMapping)</code>方法或者采用默认的构造函数来实现传输映射，以此来实现信息的传输。\n　　</p>"},{"title":"Struts2(1)——基本认识","date":"2017-12-20T02:46:08.000Z","_content":"Struts2就是一个web层框架，并且是使用MVC设计模式实现的的一个框架，之前使用的是Serlvet+JSP来开发web项目，现在用Struts2框架来替代他，那Struts2到底有哪些优点呢？那就需要我们自己来研究它了.\n请求    -----------　　Servlet      --------------  JSP　　　　serlvet+JSP\n\n请求    -----------    Action 　　  --------------  JSP　　　　Struts\n\n<!-- more -->\n\n## 1.工作原理\n\n![struts2][1]\n\n请求在struts2框架中的处理流程大概可以分为以下几步：\n\n 1. 客户端初始化一个指向servlet容器(例如Tomcat)的请求\n 2. 该请求经过一系列的过滤器（Filter）（这些过滤器中有一个叫做ActionContextCleanUp的可选过滤器，这个过滤器对于Struts2和其他框架的集成很有帮助，例如：SiteMesh Plugin）\n 3. 然后FilterDispather(StrutsPrepareAndExecuteFilter)被调用，询问ActionMapper来决定这个请是否需要调用某个Action。\n 4. 如果ActionMapper决定需要调用某个Action，FilterDispatcher把请求的处理交给ActionProxy.\n 5. ActionProxy通过ConfigurationManager询问框架的配置文件，找到需要调用的Action类 ,这里，我们一般是从struts.xml配置中读取。\n 6. ActionProxy创建一个ActionInvocation的实例\n 7. ActionInvocation实例使用命名模式来调用，在调用Action的过程前后，涉及到相关拦截器（Intercepter）的调用。\n 8. 一旦Action执行完毕，ActionInvocation负责根据struts.xml中的配置找到对应的返回结果。返回结果通常是（但不总是，也可能是另外的一个Action链）一个需要被表示的JSP或者FreeMarker的模版。在表示的过程中可以使用Struts2 框架中继承的标签。在这个过程中需要涉及到ActionMapper\n\n**在上述过程中所有的对象（Action，Results，Interceptors等）都是通过ObjectFactory来创建的。**\n \n \n## 2.配置文件\n\n|配置文件的名称|位置|主要内容|说明|\n| -------------|----|--------|----|\n|default.properties|struts2-core-2.3.15.3.jar/org/apache/struts2/default.properties|一些参数配置|程序员不能直接修改的|\n|struts-default.xml|struts2-core-2.3.15.3.jar/struts-default.xml|一些参数配置|程序员不能直接修改的|\n|struts.xml|应用的classpath中|struts的配置文件|程序员使用的|\n|struts.properties|应用的classpath中|struts的参数配置文件|程序员使用的|\n|web.xml|WEB-INF/web.xml|应用的配置文件|给过滤器配置参数|\n\n以上配置文件在应用被启动的时候就完成了加载；而且有加载的顺序要求。<font color=\"red\">后面的配置会覆盖掉前面配置文件中相同的信息。</font>\n\n### 2.1 default.properties\n\n|参数名称|参数的默认值|说明|\n|---|---|---|\n|struts.i18n.encoding|UTF-8|框架使用的默认编码|\n|struts.action.extension|action|进入框架核心的uri的后缀。多个值用逗号分隔|\n|struts.serve.static.browserCache|true|告诉客户端要不要缓存静态的资源|\n|struts.configuration.xml.reload|被注释掉了：建议true|每当xml配置文件被修改后，不需要重新加载应用就能够使配置生效。适合开发阶段|\n|struts.devMode|false|是否是开发模式。开发阶段应该设置为true|\n\n如何修改他们的默认值呢？\nstruts.xml:通过该文件来进行修改\n```XML\n<!--通过constant元素覆盖掉之前配置文件参数的默认值-->\n<constant name=\"struts.devMode\" value=\"true\" />\n```\n\n### 2.2 struts-default.xml\n\n![struts-default.xml][2]\n\n 这个文件定义了action返回结果类型，struts的拦截器，以及一些其他默认配置。\n\n### 2.3 struts.xml\n\n - 作用：希望程序员能够按照分包的思想管理你的动作配置\n - 属性：\n \n    - name:必须要的，给包取一个名字。唯一。\n    - extends：当前包需要继承的父包的名称。框架希望程序员能够用面向对象的方式管理你的包。子包能够继承父包中的所有配置。自己写的包一般情况下要继承一个name=struts-default的包（它在struts-default.xml中）\n    - abstract：把包声明成抽象包。没有任何<action>子元素的package就可以声明为抽象的包。\n    - namespace：名称空间。默认值是\"\"（空字符串）。名称空间+动作名称：构成了动作的访问路径。\n\n### 2.4 struts.properties\n\n这个文件是struts2框架的全局属性文件，也是自动加载的文件。该文件包含了系列的key-value对。该文件完全可以配置在struts.xml文件中，使用constant元素。下面是这个文件中一些常见的配置项及说明。\n\n```xml\n### 指定加载struts2配置文件管理器，默认为org.apache.struts2.config.DefaultConfiguration\n### 开发者可以自定义配置文件管理器，该类要实现Configuration接口，可以自动加载struts2配置文件。\n# struts.configuration=org.apache.struts2.config.DefaultConfiguration\n\n### 设置默认的locale和字符编码\n# struts.locale=en_US\nstruts.i18n.encoding=UTF-8\n\n\n### 指定struts的工厂类\n# struts.objectFactory = spring\n\n### 指定spring框架的装配模式\n### 装配方式有: name, type, auto, and constructor (name 是默认装配模式)\nstruts.objectFactory.spring.autoWire = name\n\n### 该属性指定整合spring时，是否对bean进行缓存，值为true or false,默认为true.\nstruts.objectFactory.spring.useClassCache = true\n\n### 指定类型检查\n#struts.objectTypeDeterminer = tiger\n#struts.objectTypeDeterminer = notiger\n\n### 该属性指定处理 MIME-type multipart/form-data，文件上传\n# struts.multipart.parser=cos\n# struts.multipart.parser=pell\nstruts.multipart.parser=jakarta\n# 指定上传文件时的临时目录，默认使用 javax.servlet.context.tempdir \nstruts.multipart.saveDir=\nstruts.multipart.maxSize=2097152\n\n### 加载自定义属性文件 (不要改写struts.properties!)\n# struts.custom.properties=application,org/apache/struts2/extension/custom\n\n### 指定请求url与action映射器，默认为org.apache.struts2.dispatcher.mapper.DefaultActionMapper\n#struts.mapper.class=org.apache.struts2.dispatcher.mapper.DefaultActionMapper\n\n### 指定action的后缀，默认为action\nstruts.action.extension=action\n\n### 被 FilterDispatcher使用\n### 如果为 true 则通过jar文件提供静态内容服务. \n### 如果为 false 则静态内容必须位于 <context_path>/struts\nstruts.serve.static=true\n\n### 被 FilterDispatcher使用\n### 指定浏览器是否缓存静态内容，测试阶段设置为false，发布阶段设置为true.\nstruts.serve.static.browserCache=true\n\n### 设置是否支持动态方法调用，true为支持，false不支持.\nstruts.enable.DynamicMethodInvocation = true\n\n### 设置是否可以在action中使用斜线，默认为false不可以，想使用需设置为true.\nstruts.enable.SlashesInActionNames = false\n\n### 是否允许使用表达式语法，默认为true.\nstruts.tag.altSyntax=true\n\n\n### 设置当struts.xml文件改动时，是否重新加载.\n### - struts.configuration.xml.reload = true\n### 设置struts是否为开发模式，默认为false,测试阶段一般设为true.\nstruts.devMode = false\n\n### 设置是否每次请求，都重新加载资源文件，默认值为false.\nstruts.i18n.reload=false\n\n###标准的UI主题\n### 默认的UI主题为xhtml,可以为simple,xhtml或ajax\nstruts.ui.theme=xhtml\n###模板目录\nstruts.ui.templateDir=template\n#设置模板类型. 可以为 ftl, vm, or jsp\nstruts.ui.templateSuffix=ftl\n\n###定位velocity.properties 文件.  默认 velocity.properties\nstruts.velocity.configfile = velocity.properties\n\n### 设置velocity的context.\nstruts.velocity.contexts =\n\n### 定位toolbox.\nstruts.velocity.toolboxlocation=\n\n### 指定web应用的端口.\nstruts.url.http.port = 80\n### 指定加密端口\nstruts.url.https.port = 443\n### 设置生成url时，是否包含参数.值可以为: none, get or all\nstruts.url.includeParams = get\n\n### 设置要加载的国际化资源文件，以逗号分隔.\n# struts.custom.i18n.resources=testmessages,testmessages2\n\n### 对于一些web应用服务器不能处理HttpServletRequest.getParameterMap()\n### 像 WebLogic, Orion, and OC4J等，须设置成true,默认为false.\nstruts.dispatcher.parametersWorkaround = false\n\n### 指定freemarker管理器\n#struts.freemarker.manager.classname=org.apache.struts2.views.freemarker.FreemarkerManager\n\n### 设置是否对freemarker的模板设置缓存\n### 效果相当于把template拷贝到 WEB_APP/templates.\nstruts.freemarker.templatesCache=false\n\n### 通常不需要修改此属性.\nstruts.freemarker.wrapper.altMap=true\n\n### 指定xslt result是否使用样式表缓存.开发阶段设为true,发布阶段设为false.\nstruts.xslt.nocache=false\n\n### 设置struts自动加载的文件列表.\nstruts.configuration.files=struts-default.xml,struts-plugin.xml,struts.xml\n\n### 设定是否一直在最后一个slash之前的任何位置选定namespace.\nstruts.mapper.alwaysSelectFullNamespace=false\n```\n\n### 2.5 web.xml\n\n配置struts2的核心过滤器和spring的加载器。\n这里针对struts2相关配置作介绍。\n\n```xml\n<!-- Struts2核心过滤器 -->\n<filter>\n\t<filter-name>struts2</filter-name>\n\t<filter-class>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter</filter-class>\n\t<!-- 指定action所在包路径 -->\n\t<init-param>  \n       \t<param-name>actionPackages</param-name>  \n       \t<param-value>com.topvision</param-value>  \n   \t</init-param>\n   \t<!-- 指定struts.xml文件路径，默认classpath下 -->\n   \t<init-param>\n   \t\t<param-name>filterConfig</param-name>\n   \t\t<param-value>classpath:struts.xml</param-value>\n   \t</init-param>\n</filter>\n<!-- 设置url过滤 -->\n<filter-mapping>\n\t<filter-name>struts2</filter-name>\n\t<url-pattern>/*</url-pattern>\n</filter-mapping>\n\n<!-- 编码 -->\n<filter>\n\t<filter-name>encodingFilter</filter-name>\n\t<filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>\n\t<init-param>\n\t\t<param-name>encoding</param-name>\n\t\t<param-value>UTF-8</param-value>\n\t</init-param>\n</filter>\n<filter-mapping>\n\t<filter-name>encodingFilter</filter-name>\n\t<url-pattern>/*</url-pattern>\n</filter-mapping>\n<!-- 404错误跳转 -->\n<error-page>\n\t<error-code>404</error-code>\n\t<location>/error.jsp?code=404</location>\n</error-page>\n<!-- 首页设置 -->\n<welcome-file-list>\n\t<welcome-file>index.html</welcome-file>\n\t<welcome-file>index.htm</welcome-file>\n\t<welcome-file>index.jsp</welcome-file>\n\t<welcome-file>default.html</welcome-file>\n\t<welcome-file>default.htm</welcome-file>\n\t<welcome-file>default.jsp</welcome-file>\n</welcome-file-list>\n```\n\n\n    \n\n\n\n \n \n \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts2.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts-default.xml.png","source":"_posts/Struts2-1-——基本认识.md","raw":"---\ntitle: Struts2(1)——基本认识\ncategories:\n  - Struts2\ntags:\n  - Struts2\ndate: 2017-12-20 10:46:08\n---\nStruts2就是一个web层框架，并且是使用MVC设计模式实现的的一个框架，之前使用的是Serlvet+JSP来开发web项目，现在用Struts2框架来替代他，那Struts2到底有哪些优点呢？那就需要我们自己来研究它了.\n请求    -----------　　Servlet      --------------  JSP　　　　serlvet+JSP\n\n请求    -----------    Action 　　  --------------  JSP　　　　Struts\n\n<!-- more -->\n\n## 1.工作原理\n\n![struts2][1]\n\n请求在struts2框架中的处理流程大概可以分为以下几步：\n\n 1. 客户端初始化一个指向servlet容器(例如Tomcat)的请求\n 2. 该请求经过一系列的过滤器（Filter）（这些过滤器中有一个叫做ActionContextCleanUp的可选过滤器，这个过滤器对于Struts2和其他框架的集成很有帮助，例如：SiteMesh Plugin）\n 3. 然后FilterDispather(StrutsPrepareAndExecuteFilter)被调用，询问ActionMapper来决定这个请是否需要调用某个Action。\n 4. 如果ActionMapper决定需要调用某个Action，FilterDispatcher把请求的处理交给ActionProxy.\n 5. ActionProxy通过ConfigurationManager询问框架的配置文件，找到需要调用的Action类 ,这里，我们一般是从struts.xml配置中读取。\n 6. ActionProxy创建一个ActionInvocation的实例\n 7. ActionInvocation实例使用命名模式来调用，在调用Action的过程前后，涉及到相关拦截器（Intercepter）的调用。\n 8. 一旦Action执行完毕，ActionInvocation负责根据struts.xml中的配置找到对应的返回结果。返回结果通常是（但不总是，也可能是另外的一个Action链）一个需要被表示的JSP或者FreeMarker的模版。在表示的过程中可以使用Struts2 框架中继承的标签。在这个过程中需要涉及到ActionMapper\n\n**在上述过程中所有的对象（Action，Results，Interceptors等）都是通过ObjectFactory来创建的。**\n \n \n## 2.配置文件\n\n|配置文件的名称|位置|主要内容|说明|\n| -------------|----|--------|----|\n|default.properties|struts2-core-2.3.15.3.jar/org/apache/struts2/default.properties|一些参数配置|程序员不能直接修改的|\n|struts-default.xml|struts2-core-2.3.15.3.jar/struts-default.xml|一些参数配置|程序员不能直接修改的|\n|struts.xml|应用的classpath中|struts的配置文件|程序员使用的|\n|struts.properties|应用的classpath中|struts的参数配置文件|程序员使用的|\n|web.xml|WEB-INF/web.xml|应用的配置文件|给过滤器配置参数|\n\n以上配置文件在应用被启动的时候就完成了加载；而且有加载的顺序要求。<font color=\"red\">后面的配置会覆盖掉前面配置文件中相同的信息。</font>\n\n### 2.1 default.properties\n\n|参数名称|参数的默认值|说明|\n|---|---|---|\n|struts.i18n.encoding|UTF-8|框架使用的默认编码|\n|struts.action.extension|action|进入框架核心的uri的后缀。多个值用逗号分隔|\n|struts.serve.static.browserCache|true|告诉客户端要不要缓存静态的资源|\n|struts.configuration.xml.reload|被注释掉了：建议true|每当xml配置文件被修改后，不需要重新加载应用就能够使配置生效。适合开发阶段|\n|struts.devMode|false|是否是开发模式。开发阶段应该设置为true|\n\n如何修改他们的默认值呢？\nstruts.xml:通过该文件来进行修改\n```XML\n<!--通过constant元素覆盖掉之前配置文件参数的默认值-->\n<constant name=\"struts.devMode\" value=\"true\" />\n```\n\n### 2.2 struts-default.xml\n\n![struts-default.xml][2]\n\n 这个文件定义了action返回结果类型，struts的拦截器，以及一些其他默认配置。\n\n### 2.3 struts.xml\n\n - 作用：希望程序员能够按照分包的思想管理你的动作配置\n - 属性：\n \n    - name:必须要的，给包取一个名字。唯一。\n    - extends：当前包需要继承的父包的名称。框架希望程序员能够用面向对象的方式管理你的包。子包能够继承父包中的所有配置。自己写的包一般情况下要继承一个name=struts-default的包（它在struts-default.xml中）\n    - abstract：把包声明成抽象包。没有任何<action>子元素的package就可以声明为抽象的包。\n    - namespace：名称空间。默认值是\"\"（空字符串）。名称空间+动作名称：构成了动作的访问路径。\n\n### 2.4 struts.properties\n\n这个文件是struts2框架的全局属性文件，也是自动加载的文件。该文件包含了系列的key-value对。该文件完全可以配置在struts.xml文件中，使用constant元素。下面是这个文件中一些常见的配置项及说明。\n\n```xml\n### 指定加载struts2配置文件管理器，默认为org.apache.struts2.config.DefaultConfiguration\n### 开发者可以自定义配置文件管理器，该类要实现Configuration接口，可以自动加载struts2配置文件。\n# struts.configuration=org.apache.struts2.config.DefaultConfiguration\n\n### 设置默认的locale和字符编码\n# struts.locale=en_US\nstruts.i18n.encoding=UTF-8\n\n\n### 指定struts的工厂类\n# struts.objectFactory = spring\n\n### 指定spring框架的装配模式\n### 装配方式有: name, type, auto, and constructor (name 是默认装配模式)\nstruts.objectFactory.spring.autoWire = name\n\n### 该属性指定整合spring时，是否对bean进行缓存，值为true or false,默认为true.\nstruts.objectFactory.spring.useClassCache = true\n\n### 指定类型检查\n#struts.objectTypeDeterminer = tiger\n#struts.objectTypeDeterminer = notiger\n\n### 该属性指定处理 MIME-type multipart/form-data，文件上传\n# struts.multipart.parser=cos\n# struts.multipart.parser=pell\nstruts.multipart.parser=jakarta\n# 指定上传文件时的临时目录，默认使用 javax.servlet.context.tempdir \nstruts.multipart.saveDir=\nstruts.multipart.maxSize=2097152\n\n### 加载自定义属性文件 (不要改写struts.properties!)\n# struts.custom.properties=application,org/apache/struts2/extension/custom\n\n### 指定请求url与action映射器，默认为org.apache.struts2.dispatcher.mapper.DefaultActionMapper\n#struts.mapper.class=org.apache.struts2.dispatcher.mapper.DefaultActionMapper\n\n### 指定action的后缀，默认为action\nstruts.action.extension=action\n\n### 被 FilterDispatcher使用\n### 如果为 true 则通过jar文件提供静态内容服务. \n### 如果为 false 则静态内容必须位于 <context_path>/struts\nstruts.serve.static=true\n\n### 被 FilterDispatcher使用\n### 指定浏览器是否缓存静态内容，测试阶段设置为false，发布阶段设置为true.\nstruts.serve.static.browserCache=true\n\n### 设置是否支持动态方法调用，true为支持，false不支持.\nstruts.enable.DynamicMethodInvocation = true\n\n### 设置是否可以在action中使用斜线，默认为false不可以，想使用需设置为true.\nstruts.enable.SlashesInActionNames = false\n\n### 是否允许使用表达式语法，默认为true.\nstruts.tag.altSyntax=true\n\n\n### 设置当struts.xml文件改动时，是否重新加载.\n### - struts.configuration.xml.reload = true\n### 设置struts是否为开发模式，默认为false,测试阶段一般设为true.\nstruts.devMode = false\n\n### 设置是否每次请求，都重新加载资源文件，默认值为false.\nstruts.i18n.reload=false\n\n###标准的UI主题\n### 默认的UI主题为xhtml,可以为simple,xhtml或ajax\nstruts.ui.theme=xhtml\n###模板目录\nstruts.ui.templateDir=template\n#设置模板类型. 可以为 ftl, vm, or jsp\nstruts.ui.templateSuffix=ftl\n\n###定位velocity.properties 文件.  默认 velocity.properties\nstruts.velocity.configfile = velocity.properties\n\n### 设置velocity的context.\nstruts.velocity.contexts =\n\n### 定位toolbox.\nstruts.velocity.toolboxlocation=\n\n### 指定web应用的端口.\nstruts.url.http.port = 80\n### 指定加密端口\nstruts.url.https.port = 443\n### 设置生成url时，是否包含参数.值可以为: none, get or all\nstruts.url.includeParams = get\n\n### 设置要加载的国际化资源文件，以逗号分隔.\n# struts.custom.i18n.resources=testmessages,testmessages2\n\n### 对于一些web应用服务器不能处理HttpServletRequest.getParameterMap()\n### 像 WebLogic, Orion, and OC4J等，须设置成true,默认为false.\nstruts.dispatcher.parametersWorkaround = false\n\n### 指定freemarker管理器\n#struts.freemarker.manager.classname=org.apache.struts2.views.freemarker.FreemarkerManager\n\n### 设置是否对freemarker的模板设置缓存\n### 效果相当于把template拷贝到 WEB_APP/templates.\nstruts.freemarker.templatesCache=false\n\n### 通常不需要修改此属性.\nstruts.freemarker.wrapper.altMap=true\n\n### 指定xslt result是否使用样式表缓存.开发阶段设为true,发布阶段设为false.\nstruts.xslt.nocache=false\n\n### 设置struts自动加载的文件列表.\nstruts.configuration.files=struts-default.xml,struts-plugin.xml,struts.xml\n\n### 设定是否一直在最后一个slash之前的任何位置选定namespace.\nstruts.mapper.alwaysSelectFullNamespace=false\n```\n\n### 2.5 web.xml\n\n配置struts2的核心过滤器和spring的加载器。\n这里针对struts2相关配置作介绍。\n\n```xml\n<!-- Struts2核心过滤器 -->\n<filter>\n\t<filter-name>struts2</filter-name>\n\t<filter-class>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter</filter-class>\n\t<!-- 指定action所在包路径 -->\n\t<init-param>  \n       \t<param-name>actionPackages</param-name>  \n       \t<param-value>com.topvision</param-value>  \n   \t</init-param>\n   \t<!-- 指定struts.xml文件路径，默认classpath下 -->\n   \t<init-param>\n   \t\t<param-name>filterConfig</param-name>\n   \t\t<param-value>classpath:struts.xml</param-value>\n   \t</init-param>\n</filter>\n<!-- 设置url过滤 -->\n<filter-mapping>\n\t<filter-name>struts2</filter-name>\n\t<url-pattern>/*</url-pattern>\n</filter-mapping>\n\n<!-- 编码 -->\n<filter>\n\t<filter-name>encodingFilter</filter-name>\n\t<filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>\n\t<init-param>\n\t\t<param-name>encoding</param-name>\n\t\t<param-value>UTF-8</param-value>\n\t</init-param>\n</filter>\n<filter-mapping>\n\t<filter-name>encodingFilter</filter-name>\n\t<url-pattern>/*</url-pattern>\n</filter-mapping>\n<!-- 404错误跳转 -->\n<error-page>\n\t<error-code>404</error-code>\n\t<location>/error.jsp?code=404</location>\n</error-page>\n<!-- 首页设置 -->\n<welcome-file-list>\n\t<welcome-file>index.html</welcome-file>\n\t<welcome-file>index.htm</welcome-file>\n\t<welcome-file>index.jsp</welcome-file>\n\t<welcome-file>default.html</welcome-file>\n\t<welcome-file>default.htm</welcome-file>\n\t<welcome-file>default.jsp</welcome-file>\n</welcome-file-list>\n```\n\n\n    \n\n\n\n \n \n \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts2.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts-default.xml.png","slug":"Struts2-1-——基本认识","published":1,"updated":"2018-02-27T07:38:38.092Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspfa000yn8vfavh04259","content":"<p>Struts2就是一个web层框架，并且是使用MVC设计模式实现的的一个框架，之前使用的是Serlvet+JSP来开发web项目，现在用Struts2框架来替代他，那Struts2到底有哪些优点呢？那就需要我们自己来研究它了.<br>请求    ———–　　Servlet      ————–  JSP　　　　serlvet+JSP</p>\n<p>请求    ———–    Action 　　  ————–  JSP　　　　Struts</p>\n<a id=\"more\"></a>\n<h2 id=\"1-工作原理\"><a href=\"#1-工作原理\" class=\"headerlink\" title=\"1.工作原理\"></a>1.工作原理</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts2.png\" alt=\"struts2\"></p>\n<p>请求在struts2框架中的处理流程大概可以分为以下几步：</p>\n<ol>\n<li>客户端初始化一个指向servlet容器(例如Tomcat)的请求</li>\n<li>该请求经过一系列的过滤器（Filter）（这些过滤器中有一个叫做ActionContextCleanUp的可选过滤器，这个过滤器对于Struts2和其他框架的集成很有帮助，例如：SiteMesh Plugin）</li>\n<li>然后FilterDispather(StrutsPrepareAndExecuteFilter)被调用，询问ActionMapper来决定这个请是否需要调用某个Action。</li>\n<li>如果ActionMapper决定需要调用某个Action，FilterDispatcher把请求的处理交给ActionProxy.</li>\n<li>ActionProxy通过ConfigurationManager询问框架的配置文件，找到需要调用的Action类 ,这里，我们一般是从struts.xml配置中读取。</li>\n<li>ActionProxy创建一个ActionInvocation的实例</li>\n<li>ActionInvocation实例使用命名模式来调用，在调用Action的过程前后，涉及到相关拦截器（Intercepter）的调用。</li>\n<li>一旦Action执行完毕，ActionInvocation负责根据struts.xml中的配置找到对应的返回结果。返回结果通常是（但不总是，也可能是另外的一个Action链）一个需要被表示的JSP或者FreeMarker的模版。在表示的过程中可以使用Struts2 框架中继承的标签。在这个过程中需要涉及到ActionMapper</li>\n</ol>\n<p><strong>在上述过程中所有的对象（Action，Results，Interceptors等）都是通过ObjectFactory来创建的。</strong></p>\n<h2 id=\"2-配置文件\"><a href=\"#2-配置文件\" class=\"headerlink\" title=\"2.配置文件\"></a>2.配置文件</h2><table>\n<thead>\n<tr>\n<th>配置文件的名称</th>\n<th>位置</th>\n<th>主要内容</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>default.properties</td>\n<td>struts2-core-2.3.15.3.jar/org/apache/struts2/default.properties</td>\n<td>一些参数配置</td>\n<td>程序员不能直接修改的</td>\n</tr>\n<tr>\n<td>struts-default.xml</td>\n<td>struts2-core-2.3.15.3.jar/struts-default.xml</td>\n<td>一些参数配置</td>\n<td>程序员不能直接修改的</td>\n</tr>\n<tr>\n<td>struts.xml</td>\n<td>应用的classpath中</td>\n<td>struts的配置文件</td>\n<td>程序员使用的</td>\n</tr>\n<tr>\n<td>struts.properties</td>\n<td>应用的classpath中</td>\n<td>struts的参数配置文件</td>\n<td>程序员使用的</td>\n</tr>\n<tr>\n<td>web.xml</td>\n<td>WEB-INF/web.xml</td>\n<td>应用的配置文件</td>\n<td>给过滤器配置参数</td>\n</tr>\n</tbody>\n</table>\n<p>以上配置文件在应用被启动的时候就完成了加载；而且有加载的顺序要求。<font color=\"red\">后面的配置会覆盖掉前面配置文件中相同的信息。</font></p>\n<h3 id=\"2-1-default-properties\"><a href=\"#2-1-default-properties\" class=\"headerlink\" title=\"2.1 default.properties\"></a>2.1 default.properties</h3><table>\n<thead>\n<tr>\n<th>参数名称</th>\n<th>参数的默认值</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>struts.i18n.encoding</td>\n<td>UTF-8</td>\n<td>框架使用的默认编码</td>\n</tr>\n<tr>\n<td>struts.action.extension</td>\n<td>action</td>\n<td>进入框架核心的uri的后缀。多个值用逗号分隔</td>\n</tr>\n<tr>\n<td>struts.serve.static.browserCache</td>\n<td>true</td>\n<td>告诉客户端要不要缓存静态的资源</td>\n</tr>\n<tr>\n<td>struts.configuration.xml.reload</td>\n<td>被注释掉了：建议true</td>\n<td>每当xml配置文件被修改后，不需要重新加载应用就能够使配置生效。适合开发阶段</td>\n</tr>\n<tr>\n<td>struts.devMode</td>\n<td>false</td>\n<td>是否是开发模式。开发阶段应该设置为true</td>\n</tr>\n</tbody>\n</table>\n<p>如何修改他们的默认值呢？<br>struts.xml:通过该文件来进行修改<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--通过constant元素覆盖掉之前配置文件参数的默认值--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.devMode\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div></pre></td></tr></table></figure></p>\n<h3 id=\"2-2-struts-default-xml\"><a href=\"#2-2-struts-default-xml\" class=\"headerlink\" title=\"2.2 struts-default.xml\"></a>2.2 struts-default.xml</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts-default.xml.png\" alt=\"struts-default.xml\"></p>\n<p> 这个文件定义了action返回结果类型，struts的拦截器，以及一些其他默认配置。</p>\n<h3 id=\"2-3-struts-xml\"><a href=\"#2-3-struts-xml\" class=\"headerlink\" title=\"2.3 struts.xml\"></a>2.3 struts.xml</h3><ul>\n<li>作用：希望程序员能够按照分包的思想管理你的动作配置</li>\n<li><p>属性：</p>\n<ul>\n<li>name:必须要的，给包取一个名字。唯一。</li>\n<li>extends：当前包需要继承的父包的名称。框架希望程序员能够用面向对象的方式管理你的包。子包能够继承父包中的所有配置。自己写的包一般情况下要继承一个name=struts-default的包（它在struts-default.xml中）</li>\n<li>abstract：把包声明成抽象包。没有任何<action>子元素的package就可以声明为抽象的包。</action></li>\n<li>namespace：名称空间。默认值是””（空字符串）。名称空间+动作名称：构成了动作的访问路径。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2-4-struts-properties\"><a href=\"#2-4-struts-properties\" class=\"headerlink\" title=\"2.4 struts.properties\"></a>2.4 struts.properties</h3><p>这个文件是struts2框架的全局属性文件，也是自动加载的文件。该文件包含了系列的key-value对。该文件完全可以配置在struts.xml文件中，使用constant元素。下面是这个文件中一些常见的配置项及说明。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div></pre></td><td class=\"code\"><pre><div class=\"line\">### 指定加载struts2配置文件管理器，默认为org.apache.struts2.config.DefaultConfiguration</div><div class=\"line\">### 开发者可以自定义配置文件管理器，该类要实现Configuration接口，可以自动加载struts2配置文件。</div><div class=\"line\"># struts.configuration=org.apache.struts2.config.DefaultConfiguration</div><div class=\"line\"></div><div class=\"line\">### 设置默认的locale和字符编码</div><div class=\"line\"># struts.locale=en_US</div><div class=\"line\">struts.i18n.encoding=UTF-8</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">### 指定struts的工厂类</div><div class=\"line\"># struts.objectFactory = spring</div><div class=\"line\"></div><div class=\"line\">### 指定spring框架的装配模式</div><div class=\"line\">### 装配方式有: name, type, auto, and constructor (name 是默认装配模式)</div><div class=\"line\">struts.objectFactory.spring.autoWire = name</div><div class=\"line\"></div><div class=\"line\">### 该属性指定整合spring时，是否对bean进行缓存，值为true or false,默认为true.</div><div class=\"line\">struts.objectFactory.spring.useClassCache = true</div><div class=\"line\"></div><div class=\"line\">### 指定类型检查</div><div class=\"line\">#struts.objectTypeDeterminer = tiger</div><div class=\"line\">#struts.objectTypeDeterminer = notiger</div><div class=\"line\"></div><div class=\"line\">### 该属性指定处理 MIME-type multipart/form-data，文件上传</div><div class=\"line\"># struts.multipart.parser=cos</div><div class=\"line\"># struts.multipart.parser=pell</div><div class=\"line\">struts.multipart.parser=jakarta</div><div class=\"line\"># 指定上传文件时的临时目录，默认使用 javax.servlet.context.tempdir </div><div class=\"line\">struts.multipart.saveDir=</div><div class=\"line\">struts.multipart.maxSize=2097152</div><div class=\"line\"></div><div class=\"line\">### 加载自定义属性文件 (不要改写struts.properties!)</div><div class=\"line\"># struts.custom.properties=application,org/apache/struts2/extension/custom</div><div class=\"line\"></div><div class=\"line\">### 指定请求url与action映射器，默认为org.apache.struts2.dispatcher.mapper.DefaultActionMapper</div><div class=\"line\">#struts.mapper.class=org.apache.struts2.dispatcher.mapper.DefaultActionMapper</div><div class=\"line\"></div><div class=\"line\">### 指定action的后缀，默认为action</div><div class=\"line\">struts.action.extension=action</div><div class=\"line\"></div><div class=\"line\">### 被 FilterDispatcher使用</div><div class=\"line\">### 如果为 true 则通过jar文件提供静态内容服务. </div><div class=\"line\">### 如果为 false 则静态内容必须位于 <span class=\"tag\">&lt;<span class=\"name\">context_path</span>&gt;</span>/struts</div><div class=\"line\">struts.serve.static=true</div><div class=\"line\"></div><div class=\"line\">### 被 FilterDispatcher使用</div><div class=\"line\">### 指定浏览器是否缓存静态内容，测试阶段设置为false，发布阶段设置为true.</div><div class=\"line\">struts.serve.static.browserCache=true</div><div class=\"line\"></div><div class=\"line\">### 设置是否支持动态方法调用，true为支持，false不支持.</div><div class=\"line\">struts.enable.DynamicMethodInvocation = true</div><div class=\"line\"></div><div class=\"line\">### 设置是否可以在action中使用斜线，默认为false不可以，想使用需设置为true.</div><div class=\"line\">struts.enable.SlashesInActionNames = false</div><div class=\"line\"></div><div class=\"line\">### 是否允许使用表达式语法，默认为true.</div><div class=\"line\">struts.tag.altSyntax=true</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">### 设置当struts.xml文件改动时，是否重新加载.</div><div class=\"line\">### - struts.configuration.xml.reload = true</div><div class=\"line\">### 设置struts是否为开发模式，默认为false,测试阶段一般设为true.</div><div class=\"line\">struts.devMode = false</div><div class=\"line\"></div><div class=\"line\">### 设置是否每次请求，都重新加载资源文件，默认值为false.</div><div class=\"line\">struts.i18n.reload=false</div><div class=\"line\"></div><div class=\"line\">###标准的UI主题</div><div class=\"line\">### 默认的UI主题为xhtml,可以为simple,xhtml或ajax</div><div class=\"line\">struts.ui.theme=xhtml</div><div class=\"line\">###模板目录</div><div class=\"line\">struts.ui.templateDir=template</div><div class=\"line\">#设置模板类型. 可以为 ftl, vm, or jsp</div><div class=\"line\">struts.ui.templateSuffix=ftl</div><div class=\"line\"></div><div class=\"line\">###定位velocity.properties 文件.  默认 velocity.properties</div><div class=\"line\">struts.velocity.configfile = velocity.properties</div><div class=\"line\"></div><div class=\"line\">### 设置velocity的context.</div><div class=\"line\">struts.velocity.contexts =</div><div class=\"line\"></div><div class=\"line\">### 定位toolbox.</div><div class=\"line\">struts.velocity.toolboxlocation=</div><div class=\"line\"></div><div class=\"line\">### 指定web应用的端口.</div><div class=\"line\">struts.url.http.port = 80</div><div class=\"line\">### 指定加密端口</div><div class=\"line\">struts.url.https.port = 443</div><div class=\"line\">### 设置生成url时，是否包含参数.值可以为: none, get or all</div><div class=\"line\">struts.url.includeParams = get</div><div class=\"line\"></div><div class=\"line\">### 设置要加载的国际化资源文件，以逗号分隔.</div><div class=\"line\"># struts.custom.i18n.resources=testmessages,testmessages2</div><div class=\"line\"></div><div class=\"line\">### 对于一些web应用服务器不能处理HttpServletRequest.getParameterMap()</div><div class=\"line\">### 像 WebLogic, Orion, and OC4J等，须设置成true,默认为false.</div><div class=\"line\">struts.dispatcher.parametersWorkaround = false</div><div class=\"line\"></div><div class=\"line\">### 指定freemarker管理器</div><div class=\"line\">#struts.freemarker.manager.classname=org.apache.struts2.views.freemarker.FreemarkerManager</div><div class=\"line\"></div><div class=\"line\">### 设置是否对freemarker的模板设置缓存</div><div class=\"line\">### 效果相当于把template拷贝到 WEB_APP/templates.</div><div class=\"line\">struts.freemarker.templatesCache=false</div><div class=\"line\"></div><div class=\"line\">### 通常不需要修改此属性.</div><div class=\"line\">struts.freemarker.wrapper.altMap=true</div><div class=\"line\"></div><div class=\"line\">### 指定xslt result是否使用样式表缓存.开发阶段设为true,发布阶段设为false.</div><div class=\"line\">struts.xslt.nocache=false</div><div class=\"line\"></div><div class=\"line\">### 设置struts自动加载的文件列表.</div><div class=\"line\">struts.configuration.files=struts-default.xml,struts-plugin.xml,struts.xml</div><div class=\"line\"></div><div class=\"line\">### 设定是否一直在最后一个slash之前的任何位置选定namespace.</div><div class=\"line\">struts.mapper.alwaysSelectFullNamespace=false</div></pre></td></tr></table></figure>\n<h3 id=\"2-5-web-xml\"><a href=\"#2-5-web-xml\" class=\"headerlink\" title=\"2.5 web.xml\"></a>2.5 web.xml</h3><p>配置struts2的核心过滤器和spring的加载器。<br>这里针对struts2相关配置作介绍。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- Struts2核心过滤器 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>struts2<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 指定action所在包路径 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span>  </div><div class=\"line\">       \t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>actionPackages<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span>  </div><div class=\"line\">       \t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>com.topvision<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span>  </div><div class=\"line\">   \t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">   \t<span class=\"comment\">&lt;!-- 指定struts.xml文件路径，默认classpath下 --&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">   \t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>filterConfig<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">   \t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:struts.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 设置url过滤 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>struts2<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">&lt;!-- 编码 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>encodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>encoding<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>encodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 404错误跳转 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">error-page</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">error-code</span>&gt;</span>404<span class=\"tag\">&lt;/<span class=\"name\">error-code</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">location</span>&gt;</span>/error.jsp?code=404<span class=\"tag\">&lt;/<span class=\"name\">location</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">error-page</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 首页设置 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">welcome-file-list</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.html<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.htm<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.jsp<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.html<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.htm<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.jsp<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">welcome-file-list</span>&gt;</span></div></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>Struts2就是一个web层框架，并且是使用MVC设计模式实现的的一个框架，之前使用的是Serlvet+JSP来开发web项目，现在用Struts2框架来替代他，那Struts2到底有哪些优点呢？那就需要我们自己来研究它了.<br>请求    ———–　　Servlet      ————–  JSP　　　　serlvet+JSP</p>\n<p>请求    ———–    Action 　　  ————–  JSP　　　　Struts</p>","more":"<h2 id=\"1-工作原理\"><a href=\"#1-工作原理\" class=\"headerlink\" title=\"1.工作原理\"></a>1.工作原理</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts2.png\" alt=\"struts2\"></p>\n<p>请求在struts2框架中的处理流程大概可以分为以下几步：</p>\n<ol>\n<li>客户端初始化一个指向servlet容器(例如Tomcat)的请求</li>\n<li>该请求经过一系列的过滤器（Filter）（这些过滤器中有一个叫做ActionContextCleanUp的可选过滤器，这个过滤器对于Struts2和其他框架的集成很有帮助，例如：SiteMesh Plugin）</li>\n<li>然后FilterDispather(StrutsPrepareAndExecuteFilter)被调用，询问ActionMapper来决定这个请是否需要调用某个Action。</li>\n<li>如果ActionMapper决定需要调用某个Action，FilterDispatcher把请求的处理交给ActionProxy.</li>\n<li>ActionProxy通过ConfigurationManager询问框架的配置文件，找到需要调用的Action类 ,这里，我们一般是从struts.xml配置中读取。</li>\n<li>ActionProxy创建一个ActionInvocation的实例</li>\n<li>ActionInvocation实例使用命名模式来调用，在调用Action的过程前后，涉及到相关拦截器（Intercepter）的调用。</li>\n<li>一旦Action执行完毕，ActionInvocation负责根据struts.xml中的配置找到对应的返回结果。返回结果通常是（但不总是，也可能是另外的一个Action链）一个需要被表示的JSP或者FreeMarker的模版。在表示的过程中可以使用Struts2 框架中继承的标签。在这个过程中需要涉及到ActionMapper</li>\n</ol>\n<p><strong>在上述过程中所有的对象（Action，Results，Interceptors等）都是通过ObjectFactory来创建的。</strong></p>\n<h2 id=\"2-配置文件\"><a href=\"#2-配置文件\" class=\"headerlink\" title=\"2.配置文件\"></a>2.配置文件</h2><table>\n<thead>\n<tr>\n<th>配置文件的名称</th>\n<th>位置</th>\n<th>主要内容</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>default.properties</td>\n<td>struts2-core-2.3.15.3.jar/org/apache/struts2/default.properties</td>\n<td>一些参数配置</td>\n<td>程序员不能直接修改的</td>\n</tr>\n<tr>\n<td>struts-default.xml</td>\n<td>struts2-core-2.3.15.3.jar/struts-default.xml</td>\n<td>一些参数配置</td>\n<td>程序员不能直接修改的</td>\n</tr>\n<tr>\n<td>struts.xml</td>\n<td>应用的classpath中</td>\n<td>struts的配置文件</td>\n<td>程序员使用的</td>\n</tr>\n<tr>\n<td>struts.properties</td>\n<td>应用的classpath中</td>\n<td>struts的参数配置文件</td>\n<td>程序员使用的</td>\n</tr>\n<tr>\n<td>web.xml</td>\n<td>WEB-INF/web.xml</td>\n<td>应用的配置文件</td>\n<td>给过滤器配置参数</td>\n</tr>\n</tbody>\n</table>\n<p>以上配置文件在应用被启动的时候就完成了加载；而且有加载的顺序要求。<font color=\"red\">后面的配置会覆盖掉前面配置文件中相同的信息。</font></p>\n<h3 id=\"2-1-default-properties\"><a href=\"#2-1-default-properties\" class=\"headerlink\" title=\"2.1 default.properties\"></a>2.1 default.properties</h3><table>\n<thead>\n<tr>\n<th>参数名称</th>\n<th>参数的默认值</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>struts.i18n.encoding</td>\n<td>UTF-8</td>\n<td>框架使用的默认编码</td>\n</tr>\n<tr>\n<td>struts.action.extension</td>\n<td>action</td>\n<td>进入框架核心的uri的后缀。多个值用逗号分隔</td>\n</tr>\n<tr>\n<td>struts.serve.static.browserCache</td>\n<td>true</td>\n<td>告诉客户端要不要缓存静态的资源</td>\n</tr>\n<tr>\n<td>struts.configuration.xml.reload</td>\n<td>被注释掉了：建议true</td>\n<td>每当xml配置文件被修改后，不需要重新加载应用就能够使配置生效。适合开发阶段</td>\n</tr>\n<tr>\n<td>struts.devMode</td>\n<td>false</td>\n<td>是否是开发模式。开发阶段应该设置为true</td>\n</tr>\n</tbody>\n</table>\n<p>如何修改他们的默认值呢？<br>struts.xml:通过该文件来进行修改<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--通过constant元素覆盖掉之前配置文件参数的默认值--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.devMode\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div></pre></td></tr></table></figure></p>\n<h3 id=\"2-2-struts-default-xml\"><a href=\"#2-2-struts-default-xml\" class=\"headerlink\" title=\"2.2 struts-default.xml\"></a>2.2 struts-default.xml</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts-default.xml.png\" alt=\"struts-default.xml\"></p>\n<p> 这个文件定义了action返回结果类型，struts的拦截器，以及一些其他默认配置。</p>\n<h3 id=\"2-3-struts-xml\"><a href=\"#2-3-struts-xml\" class=\"headerlink\" title=\"2.3 struts.xml\"></a>2.3 struts.xml</h3><ul>\n<li>作用：希望程序员能够按照分包的思想管理你的动作配置</li>\n<li><p>属性：</p>\n<ul>\n<li>name:必须要的，给包取一个名字。唯一。</li>\n<li>extends：当前包需要继承的父包的名称。框架希望程序员能够用面向对象的方式管理你的包。子包能够继承父包中的所有配置。自己写的包一般情况下要继承一个name=struts-default的包（它在struts-default.xml中）</li>\n<li>abstract：把包声明成抽象包。没有任何<action>子元素的package就可以声明为抽象的包。</action></li>\n<li>namespace：名称空间。默认值是””（空字符串）。名称空间+动作名称：构成了动作的访问路径。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2-4-struts-properties\"><a href=\"#2-4-struts-properties\" class=\"headerlink\" title=\"2.4 struts.properties\"></a>2.4 struts.properties</h3><p>这个文件是struts2框架的全局属性文件，也是自动加载的文件。该文件包含了系列的key-value对。该文件完全可以配置在struts.xml文件中，使用constant元素。下面是这个文件中一些常见的配置项及说明。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div></pre></td><td class=\"code\"><pre><div class=\"line\">### 指定加载struts2配置文件管理器，默认为org.apache.struts2.config.DefaultConfiguration</div><div class=\"line\">### 开发者可以自定义配置文件管理器，该类要实现Configuration接口，可以自动加载struts2配置文件。</div><div class=\"line\"># struts.configuration=org.apache.struts2.config.DefaultConfiguration</div><div class=\"line\"></div><div class=\"line\">### 设置默认的locale和字符编码</div><div class=\"line\"># struts.locale=en_US</div><div class=\"line\">struts.i18n.encoding=UTF-8</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">### 指定struts的工厂类</div><div class=\"line\"># struts.objectFactory = spring</div><div class=\"line\"></div><div class=\"line\">### 指定spring框架的装配模式</div><div class=\"line\">### 装配方式有: name, type, auto, and constructor (name 是默认装配模式)</div><div class=\"line\">struts.objectFactory.spring.autoWire = name</div><div class=\"line\"></div><div class=\"line\">### 该属性指定整合spring时，是否对bean进行缓存，值为true or false,默认为true.</div><div class=\"line\">struts.objectFactory.spring.useClassCache = true</div><div class=\"line\"></div><div class=\"line\">### 指定类型检查</div><div class=\"line\">#struts.objectTypeDeterminer = tiger</div><div class=\"line\">#struts.objectTypeDeterminer = notiger</div><div class=\"line\"></div><div class=\"line\">### 该属性指定处理 MIME-type multipart/form-data，文件上传</div><div class=\"line\"># struts.multipart.parser=cos</div><div class=\"line\"># struts.multipart.parser=pell</div><div class=\"line\">struts.multipart.parser=jakarta</div><div class=\"line\"># 指定上传文件时的临时目录，默认使用 javax.servlet.context.tempdir </div><div class=\"line\">struts.multipart.saveDir=</div><div class=\"line\">struts.multipart.maxSize=2097152</div><div class=\"line\"></div><div class=\"line\">### 加载自定义属性文件 (不要改写struts.properties!)</div><div class=\"line\"># struts.custom.properties=application,org/apache/struts2/extension/custom</div><div class=\"line\"></div><div class=\"line\">### 指定请求url与action映射器，默认为org.apache.struts2.dispatcher.mapper.DefaultActionMapper</div><div class=\"line\">#struts.mapper.class=org.apache.struts2.dispatcher.mapper.DefaultActionMapper</div><div class=\"line\"></div><div class=\"line\">### 指定action的后缀，默认为action</div><div class=\"line\">struts.action.extension=action</div><div class=\"line\"></div><div class=\"line\">### 被 FilterDispatcher使用</div><div class=\"line\">### 如果为 true 则通过jar文件提供静态内容服务. </div><div class=\"line\">### 如果为 false 则静态内容必须位于 <span class=\"tag\">&lt;<span class=\"name\">context_path</span>&gt;</span>/struts</div><div class=\"line\">struts.serve.static=true</div><div class=\"line\"></div><div class=\"line\">### 被 FilterDispatcher使用</div><div class=\"line\">### 指定浏览器是否缓存静态内容，测试阶段设置为false，发布阶段设置为true.</div><div class=\"line\">struts.serve.static.browserCache=true</div><div class=\"line\"></div><div class=\"line\">### 设置是否支持动态方法调用，true为支持，false不支持.</div><div class=\"line\">struts.enable.DynamicMethodInvocation = true</div><div class=\"line\"></div><div class=\"line\">### 设置是否可以在action中使用斜线，默认为false不可以，想使用需设置为true.</div><div class=\"line\">struts.enable.SlashesInActionNames = false</div><div class=\"line\"></div><div class=\"line\">### 是否允许使用表达式语法，默认为true.</div><div class=\"line\">struts.tag.altSyntax=true</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">### 设置当struts.xml文件改动时，是否重新加载.</div><div class=\"line\">### - struts.configuration.xml.reload = true</div><div class=\"line\">### 设置struts是否为开发模式，默认为false,测试阶段一般设为true.</div><div class=\"line\">struts.devMode = false</div><div class=\"line\"></div><div class=\"line\">### 设置是否每次请求，都重新加载资源文件，默认值为false.</div><div class=\"line\">struts.i18n.reload=false</div><div class=\"line\"></div><div class=\"line\">###标准的UI主题</div><div class=\"line\">### 默认的UI主题为xhtml,可以为simple,xhtml或ajax</div><div class=\"line\">struts.ui.theme=xhtml</div><div class=\"line\">###模板目录</div><div class=\"line\">struts.ui.templateDir=template</div><div class=\"line\">#设置模板类型. 可以为 ftl, vm, or jsp</div><div class=\"line\">struts.ui.templateSuffix=ftl</div><div class=\"line\"></div><div class=\"line\">###定位velocity.properties 文件.  默认 velocity.properties</div><div class=\"line\">struts.velocity.configfile = velocity.properties</div><div class=\"line\"></div><div class=\"line\">### 设置velocity的context.</div><div class=\"line\">struts.velocity.contexts =</div><div class=\"line\"></div><div class=\"line\">### 定位toolbox.</div><div class=\"line\">struts.velocity.toolboxlocation=</div><div class=\"line\"></div><div class=\"line\">### 指定web应用的端口.</div><div class=\"line\">struts.url.http.port = 80</div><div class=\"line\">### 指定加密端口</div><div class=\"line\">struts.url.https.port = 443</div><div class=\"line\">### 设置生成url时，是否包含参数.值可以为: none, get or all</div><div class=\"line\">struts.url.includeParams = get</div><div class=\"line\"></div><div class=\"line\">### 设置要加载的国际化资源文件，以逗号分隔.</div><div class=\"line\"># struts.custom.i18n.resources=testmessages,testmessages2</div><div class=\"line\"></div><div class=\"line\">### 对于一些web应用服务器不能处理HttpServletRequest.getParameterMap()</div><div class=\"line\">### 像 WebLogic, Orion, and OC4J等，须设置成true,默认为false.</div><div class=\"line\">struts.dispatcher.parametersWorkaround = false</div><div class=\"line\"></div><div class=\"line\">### 指定freemarker管理器</div><div class=\"line\">#struts.freemarker.manager.classname=org.apache.struts2.views.freemarker.FreemarkerManager</div><div class=\"line\"></div><div class=\"line\">### 设置是否对freemarker的模板设置缓存</div><div class=\"line\">### 效果相当于把template拷贝到 WEB_APP/templates.</div><div class=\"line\">struts.freemarker.templatesCache=false</div><div class=\"line\"></div><div class=\"line\">### 通常不需要修改此属性.</div><div class=\"line\">struts.freemarker.wrapper.altMap=true</div><div class=\"line\"></div><div class=\"line\">### 指定xslt result是否使用样式表缓存.开发阶段设为true,发布阶段设为false.</div><div class=\"line\">struts.xslt.nocache=false</div><div class=\"line\"></div><div class=\"line\">### 设置struts自动加载的文件列表.</div><div class=\"line\">struts.configuration.files=struts-default.xml,struts-plugin.xml,struts.xml</div><div class=\"line\"></div><div class=\"line\">### 设定是否一直在最后一个slash之前的任何位置选定namespace.</div><div class=\"line\">struts.mapper.alwaysSelectFullNamespace=false</div></pre></td></tr></table></figure>\n<h3 id=\"2-5-web-xml\"><a href=\"#2-5-web-xml\" class=\"headerlink\" title=\"2.5 web.xml\"></a>2.5 web.xml</h3><p>配置struts2的核心过滤器和spring的加载器。<br>这里针对struts2相关配置作介绍。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- Struts2核心过滤器 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>struts2<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 指定action所在包路径 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span>  </div><div class=\"line\">       \t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>actionPackages<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span>  </div><div class=\"line\">       \t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>com.topvision<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span>  </div><div class=\"line\">   \t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">   \t<span class=\"comment\">&lt;!-- 指定struts.xml文件路径，默认classpath下 --&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">   \t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>filterConfig<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">   \t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:struts.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 设置url过滤 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>struts2<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">&lt;!-- 编码 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>encodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>encoding<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>encodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 404错误跳转 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">error-page</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">error-code</span>&gt;</span>404<span class=\"tag\">&lt;/<span class=\"name\">error-code</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">location</span>&gt;</span>/error.jsp?code=404<span class=\"tag\">&lt;/<span class=\"name\">location</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">error-page</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 首页设置 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">welcome-file-list</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.html<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.htm<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.jsp<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.html<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.htm<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.jsp<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">welcome-file-list</span>&gt;</span></div></pre></td></tr></table></figure>"},{"title":"Struts2(2)——搭建struts及spring整合Demo","date":"2017-12-20T08:51:15.000Z","_content":"简单介绍struts2整合spring项目的搭建。\n<!--more-->\n\n![工程结构图][1]\n\n## 1、创建maven工程，引入jar依赖\n\npom.xml文件如下，maven相关知识请参看[maven学习][2]。\n属性：设置版本等信息\n依赖管理：锁定依赖jar包的具体版本\n依赖：\n\n 1. spring:\n 2. struts2\n 3. mybatis\n 4. mysql驱动\n 5. c3p0\n 6. slf4j\n 7. junit、jstl\n 8. servlet jsp\n\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\t<groupId>com.topvision</groupId>\n\t<artifactId>s2sm</artifactId>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<name>s2sm Maven Webapp</name>\n\t<url>http://maven.apache.org</url>\n\t\n\t<!-- 属性 -->\n\t<properties>\n\t\t<spring.version>4.3.12.RELEASE</spring.version>\n\t\t<mybatis.version>3.4.5</mybatis.version>\n\t\t<struts.version>2.3.24.1</struts.version>\n\t</properties>\n\t\n\t<!-- 锁定版本 -->\n\t<dependencyManagement>\n\t\t<dependencies>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-context</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-aspects</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-orm</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-test</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-web</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t\t<artifactId>struts2-core</artifactId>\n\t\t\t\t<version>${struts.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t\t<artifactId>struts2-spring-plugin</artifactId>\n\t\t\t\t<version>${struts.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t\t<artifactId>struts2-json-plugin</artifactId>\n\t\t\t\t<version>${struts.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t    <groupId>org.mybatis</groupId>\n\t\t\t    <artifactId>mybatis</artifactId>\n\t\t\t    <version>${mybatis.version}</version>\n\t\t\t</dependency>\n\t\t\t\n\t\t</dependencies>\n\t</dependencyManagement>\n\n\t<dependencies>\n\t\t<!-- Spring -->\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-test</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-context</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-aspects</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-orm</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-web</artifactId>\n\t\t</dependency>\n\t\t\n\t\t<!-- Struts -->\n\t\t<dependency>\n\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t<artifactId>struts2-core</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t<artifactId>struts2-spring-plugin</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t<artifactId>struts2-json-plugin</artifactId>\n\t\t</dependency>\n\t\t\n\t\t<!-- mybatis -->\n\t\t<dependency>\n\t\t    <groupId>org.mybatis</groupId>\n\t\t    <artifactId>mybatis</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t    <groupId>org.mybatis</groupId>\n\t\t    <artifactId>mybatis-spring</artifactId>\n\t\t    <version>1.3.1</version>\n\t\t</dependency>\n\t\t\n\t\t<!-- mysql驱动 -->\n\t\t<dependency>\n\t\t\t<groupId>mysql</groupId>\n\t\t\t<artifactId>mysql-connector-java</artifactId>\n\t\t\t<version>5.1.6</version>\n\t\t\t<scope>runtime</scope>\n\t\t</dependency>\n\t\t\n\t\t<!-- c3p0 -->\n\t\t<dependency>\n\t\t\t<groupId>c3p0</groupId>\n\t\t\t<artifactId>c3p0</artifactId>\n\t\t\t<version>0.9.1.2</version>\n\t\t</dependency>\n\t\t\n\t\t<!-- slf4j -->\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-log4j12</artifactId>\n\t\t\t<version>1.7.2</version>\n\t\t</dependency>\n\t\t<!-- junit -->\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>4.9</version>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t\t<!-- jstl -->\n\t\t<dependency>\n\t\t\t<groupId>javax.servlet</groupId>\n\t\t\t<artifactId>jstl</artifactId>\n\t\t\t<version>1.2</version>\n\t\t</dependency>\n\t  \t<!-- servlet jsp -->\n\t  \t<dependency>\n\t  \t\t<groupId>javax.servlet</groupId>\n\t  \t\t<artifactId>servlet-api</artifactId>\n\t  \t\t<version>2.5</version>\n\t  \t\t<scope>provided</scope>\n\t  \t</dependency>\n\t  \t<dependency>\n\t  \t\t<groupId>javax.servlet</groupId>\n\t  \t\t<artifactId>jsp-api</artifactId>\n\t  \t\t<version>2.0</version>\n\t  \t\t<scope>provided</scope>\n\t  \t</dependency>\n\t</dependencies>\n\t\n\t<build>\n\t\t<plugins>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n\t\t\t\t<artifactId>maven-compiler-plugin</artifactId>\n    \t\t\t<version>2.5</version>\n\t\t\t\t<configuration>\n\t\t\t\t\t<source>1.8</source>\n\t\t\t\t\t<target>1.8</target>\n\t\t\t\t\t<encoding>UTF-8</encoding>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t</plugins>\n\n\t\t<finalName>s2sm</finalName>\n\t</build>\n</project>\n\n```\n\n## 2、配置web.xml\n\n 1. 配置spring监听器\n\n    ```xml\n    <!-- applicationContext对象仅加载一次，在服务器器启动时加载 -->\n    <listener>\n    \t<listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>\n    </listener>\n    <context-param>\n    \t<param-name>contextConfigLocation</param-name>\n    \t<param-value>classpath:/config/applicationContext*.xml</param-value>\n    </context-param>\n    ```\n\n 2. 配置struts2核心过滤器\n\n    ```xml\n    <!-- Struts2核心过滤器 -->\n\t<filter>\n\t\t<filter-name>struts2</filter-name>\n\t\t<filter-class>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter</filter-class>\n\t\t<!-- 指定action所在包路径 -->\n\t\t<init-param>  \n        \t<param-name>actionPackages</param-name>  \n        \t<param-value>com.topvision</param-value>  \n    \t</init-param>\n    \t<!-- 指定struts.xml文件路径，默认classpath下 -->\n    \t<init-param>\n    \t\t<param-name>filterConfig</param-name>\n    \t\t<param-value>classpath:struts.xml</param-value>\n    \t</init-param>\n\t</filter>\n\t<!-- 设置url过滤 -->\n\t<filter-mapping>\n\t\t<filter-name>struts2</filter-name>\n\t\t<url-pattern>/*</url-pattern>\n\t</filter-mapping>\n    ```\n\n 3. 设置编码，防止乱码\n\n    ```xml\n    <!-- 编码 -->\n\t<filter>\n\t\t<filter-name>encodingFilter</filter-name>\n\t\t<filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>\n\t\t<init-param>\n\t\t\t<param-name>encoding</param-name>\n\t\t\t<param-value>UTF-8</param-value>\n\t\t</init-param>\n\t</filter>\n\t<filter-mapping>\n\t\t<filter-name>encodingFilter</filter-name>\n\t\t<url-pattern>/*</url-pattern>\n\t</filter-mapping>\n    ```\n\n 4. 设置首页\n\n    ```xml\n    <!-- 首页设置 -->\n    <welcome-file-list>\n    \t<welcome-file>index.html</welcome-file>\n    \t<welcome-file>index.htm</welcome-file>\n    \t<welcome-file>index.jsp</welcome-file>\n    \t<welcome-file>default.html</welcome-file>\n    \t<welcome-file>default.htm</welcome-file>\n    \t<welcome-file>default.jsp</welcome-file>\n    </welcome-file-list>\n    ```\n\n## 3、applicationContext.xml\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:context=\"http://www.springframework.org/schema/context\"\n       xmlns:tool=\"http://www.springframework.org/schema/tool\"\n       xmlns:tx=\"http://www.springframework.org/schema/tx\"\n       xmlns:aop=\"http://www.springframework.org/schema/aop\"\n       xsi:schemaLocation=\"\n\t\thttp://www.springframework.org/schema/beans \n\t\thttp://www.springframework.org/schema/beans/spring-beans-3.2.xsd\n\t\thttp://www.springframework.org/schema/context \n\t\thttp://www.springframework.org/schema/context/spring-context.xsd\n\t\thttp://www.springframework.org/schema/tx \n\t\thttp://www.springframework.org/schema/tx/spring-tx.xsd\n\t\thttp://www.springframework.org/schema/aop \n\t\thttp://www.springframework.org/schema/aop/spring-aop.xsd\n\t\thttp://www.springframework.org/schema/tool\n\t\thttp://www.springframework.org/schema/tool/spring-tool-3.2.xsd\n\t\t\">\n\t<!-- 开启注解配置Bean -->\n\t<!-- 设置扫描包路径 -->\n\t<context:annotation-config/>\n\t<context:component-scan base-package=\"com.topvision\"/>\n\t\n\t<!-- 开启注解事务 -->\n\t<tx:annotation-driven transaction-manager=\"transactionManager\"/>\n\t<!-- 事务管理器 -->\n\t<bean id=\"transactionManager\" class=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\">\n\t\t<property name=\"dataSource\" ref=\"dataSource\"></property>\n\t</bean>\t\n\t<!-- 数据库C3P0 -->\n\t<bean id=\"dataSource\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\">\n\t\t<property name=\"driverClass\" value=\"${s2sm.jdbc.driverClass}\"/>\n\t\t<property name=\"jdbcUrl\" value=\"${s2sm.jdbc.url}\"/>\n\t\t<property name=\"user\" value=\"${s2sm.jdbc.username}\"/>\n\t\t<property name=\"password\" value=\"${s2sm.jdbc.password}\"/>\n\t\t\n        <property name=\"initialPoolSize\" value=\"${s2sm.cpool.initialPoolSize}\" />\n        <property name=\"minPoolSize\" value=\"${s2sm.cpool.minPoolSize}\" />\n        <property name=\"maxPoolSize\" value=\"${s2sm.cpool.maxPoolSize}\" />\n        <property name=\"acquireIncrement\" value=\"${s2sm.cpool.acquireIncrement}\" />\n        <property name=\"maxIdleTime\" value=\"${s2sm.cpool.maxIdleTime}\"/>\n        <property name=\"acquireRetryAttempts\" value=\"${s2sm.cpool.acquireRetryAttempts}\"/>\n        <property name=\"acquireRetryDelay\" value=\"${s2sm.cpool.acquireRetryDelay}\"/>\n\t</bean>\n\t\n\t<!-- 加载properties -->\n\t<!-- <context:property-placeholder location=\"classpath:jdbc.properties\"/> -->\n\t<bean id=\"propertyConfigurer\" class=\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\">\n\t\t<property name=\"locations\">\n\t\t\t<list>\n\t\t\t\t<value>classpath:/config/*.properties</value>\n\t\t\t</list>\n\t\t</property>\n\t</bean>\n\t\n</beans>\n```\n\n## 4、Action编写\n\n```java\n@Controller\n@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\npublic class LoginAction extends BaseAction{\n    private static final long serialVersionUID = -4442251270114214406L;\n    private String username;\n    private String password;\n\n    public String loginTest() {\n        String key = username + \":\" + password;\n        ActionContext context2 = ActionContext.getContext(); \n        context2.put(\"key\", key);\n        return SUCCESS;\n    }\n\n    public String getUsername() {\n        return username;\n    }\n\n    public void setUsername(String username) {\n        this.username = username;\n    }\n\n    public String getPassword() {\n        return password;\n    }\n\n    public void setPassword(String password) {\n        this.password = password;\n    }\n\n}\n```\n\n## 5、配置struts.xml\n\nstruts.xml文件路径要与struts2核心过滤器中配置的路径一致，默认在classpath下即可。\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE struts PUBLIC\n\t\"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN\"\n\t\"http://struts.apache.org/dtds/struts-2.3.dtd\">\n\n<struts>\n    <!-- 所有匹配*.action的请求都由struts2处理 -->\n    <constant name=\"struts.action.extension\" value=\"tv,mb\" />\n    <!-- 主题  simple,xhtml,css_xhtml和ajax-->\n\t<constant name=\"struts.ui.theme\" value=\"simple\"/>\n\t\n    <!-- 是否启用开发模式 -->\n    <constant name=\"struts.devMode\" value=\"true\" />\n    <!-- struts配置文件改动后，是否重新加载，有助于开发 -->\n    <constant name=\"struts.configuration.xml.reload\" value=\"true\" />\n    <!-- 每次HTTP请求系统都重新加载资源文件，有助于开发 -->\n    <constant name=\"struts.i18n.reload\" value=\"true\" />\n    <!-- 设置浏览器是否缓存静态内容,开发是设为false,部署后true -->\n    <constant name=\"struts.serve.static.browserCache\" value=\"false\" />\n\t<!-- Content Model : ((package | include | bean | constant)*, unknown-handler-stack?) -->\n    \n\t<package name=\"login\" namespace=\"/aaa\" extends=\"struts-default\">\n\t\t<action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n\t\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t\t</action>\n\t\n\t</package>\n\n</struts>\n```\n\n## 6、测试\n\n 1. 首页设置\n    \n    ```jsp\n    <%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%>\n    <!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n    <html>\n    <head>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n    <title>Insert title here</title>\n    </head>\n    <body>\n    <a href=\"aaa/loginTest.tv?username=中文&password=123\">请点击这个链接</a><br>  \n    </body>\n    </html>\n    ```\n 2. login.jsp\n\n    ```jsp\n    <%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%>\n    <%@ taglib prefix=\"s\" uri=\"/struts-tags\" %>\n    <!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n    <html>\n    <head>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n    <title>成功</title>\n    </head>\n    <body>\n    <h2>跳转成功</h2>\n    <s:property value=\"@java.lang.Integer@MAX_VALUE\"/>\n    <s:property value=\"username\"/>\n    <s:property value=\"password\"/>\n    <s:debug></s:debug>\n    </body>\n    </html>\n    ```\n    \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/s2sm.png\n  [2]: https://www.zybuluo.com/mdeditor#772562","source":"_posts/Struts2-2-——搭建struts及spring整合Demo.md","raw":"---\ntitle: Struts2(2)——搭建struts及spring整合Demo\ncategories:\n  - Struts2\ntags:\n  - Struts2\ndate: 2017-12-20 16:51:15\n---\n简单介绍struts2整合spring项目的搭建。\n<!--more-->\n\n![工程结构图][1]\n\n## 1、创建maven工程，引入jar依赖\n\npom.xml文件如下，maven相关知识请参看[maven学习][2]。\n属性：设置版本等信息\n依赖管理：锁定依赖jar包的具体版本\n依赖：\n\n 1. spring:\n 2. struts2\n 3. mybatis\n 4. mysql驱动\n 5. c3p0\n 6. slf4j\n 7. junit、jstl\n 8. servlet jsp\n\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\t<groupId>com.topvision</groupId>\n\t<artifactId>s2sm</artifactId>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<name>s2sm Maven Webapp</name>\n\t<url>http://maven.apache.org</url>\n\t\n\t<!-- 属性 -->\n\t<properties>\n\t\t<spring.version>4.3.12.RELEASE</spring.version>\n\t\t<mybatis.version>3.4.5</mybatis.version>\n\t\t<struts.version>2.3.24.1</struts.version>\n\t</properties>\n\t\n\t<!-- 锁定版本 -->\n\t<dependencyManagement>\n\t\t<dependencies>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-context</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-aspects</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-orm</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-test</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-web</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t\t<artifactId>struts2-core</artifactId>\n\t\t\t\t<version>${struts.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t\t<artifactId>struts2-spring-plugin</artifactId>\n\t\t\t\t<version>${struts.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t\t<artifactId>struts2-json-plugin</artifactId>\n\t\t\t\t<version>${struts.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t    <groupId>org.mybatis</groupId>\n\t\t\t    <artifactId>mybatis</artifactId>\n\t\t\t    <version>${mybatis.version}</version>\n\t\t\t</dependency>\n\t\t\t\n\t\t</dependencies>\n\t</dependencyManagement>\n\n\t<dependencies>\n\t\t<!-- Spring -->\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-test</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-context</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-aspects</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-orm</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-web</artifactId>\n\t\t</dependency>\n\t\t\n\t\t<!-- Struts -->\n\t\t<dependency>\n\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t<artifactId>struts2-core</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t<artifactId>struts2-spring-plugin</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t<artifactId>struts2-json-plugin</artifactId>\n\t\t</dependency>\n\t\t\n\t\t<!-- mybatis -->\n\t\t<dependency>\n\t\t    <groupId>org.mybatis</groupId>\n\t\t    <artifactId>mybatis</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t    <groupId>org.mybatis</groupId>\n\t\t    <artifactId>mybatis-spring</artifactId>\n\t\t    <version>1.3.1</version>\n\t\t</dependency>\n\t\t\n\t\t<!-- mysql驱动 -->\n\t\t<dependency>\n\t\t\t<groupId>mysql</groupId>\n\t\t\t<artifactId>mysql-connector-java</artifactId>\n\t\t\t<version>5.1.6</version>\n\t\t\t<scope>runtime</scope>\n\t\t</dependency>\n\t\t\n\t\t<!-- c3p0 -->\n\t\t<dependency>\n\t\t\t<groupId>c3p0</groupId>\n\t\t\t<artifactId>c3p0</artifactId>\n\t\t\t<version>0.9.1.2</version>\n\t\t</dependency>\n\t\t\n\t\t<!-- slf4j -->\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-log4j12</artifactId>\n\t\t\t<version>1.7.2</version>\n\t\t</dependency>\n\t\t<!-- junit -->\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>4.9</version>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t\t<!-- jstl -->\n\t\t<dependency>\n\t\t\t<groupId>javax.servlet</groupId>\n\t\t\t<artifactId>jstl</artifactId>\n\t\t\t<version>1.2</version>\n\t\t</dependency>\n\t  \t<!-- servlet jsp -->\n\t  \t<dependency>\n\t  \t\t<groupId>javax.servlet</groupId>\n\t  \t\t<artifactId>servlet-api</artifactId>\n\t  \t\t<version>2.5</version>\n\t  \t\t<scope>provided</scope>\n\t  \t</dependency>\n\t  \t<dependency>\n\t  \t\t<groupId>javax.servlet</groupId>\n\t  \t\t<artifactId>jsp-api</artifactId>\n\t  \t\t<version>2.0</version>\n\t  \t\t<scope>provided</scope>\n\t  \t</dependency>\n\t</dependencies>\n\t\n\t<build>\n\t\t<plugins>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n\t\t\t\t<artifactId>maven-compiler-plugin</artifactId>\n    \t\t\t<version>2.5</version>\n\t\t\t\t<configuration>\n\t\t\t\t\t<source>1.8</source>\n\t\t\t\t\t<target>1.8</target>\n\t\t\t\t\t<encoding>UTF-8</encoding>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t</plugins>\n\n\t\t<finalName>s2sm</finalName>\n\t</build>\n</project>\n\n```\n\n## 2、配置web.xml\n\n 1. 配置spring监听器\n\n    ```xml\n    <!-- applicationContext对象仅加载一次，在服务器器启动时加载 -->\n    <listener>\n    \t<listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>\n    </listener>\n    <context-param>\n    \t<param-name>contextConfigLocation</param-name>\n    \t<param-value>classpath:/config/applicationContext*.xml</param-value>\n    </context-param>\n    ```\n\n 2. 配置struts2核心过滤器\n\n    ```xml\n    <!-- Struts2核心过滤器 -->\n\t<filter>\n\t\t<filter-name>struts2</filter-name>\n\t\t<filter-class>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter</filter-class>\n\t\t<!-- 指定action所在包路径 -->\n\t\t<init-param>  \n        \t<param-name>actionPackages</param-name>  \n        \t<param-value>com.topvision</param-value>  \n    \t</init-param>\n    \t<!-- 指定struts.xml文件路径，默认classpath下 -->\n    \t<init-param>\n    \t\t<param-name>filterConfig</param-name>\n    \t\t<param-value>classpath:struts.xml</param-value>\n    \t</init-param>\n\t</filter>\n\t<!-- 设置url过滤 -->\n\t<filter-mapping>\n\t\t<filter-name>struts2</filter-name>\n\t\t<url-pattern>/*</url-pattern>\n\t</filter-mapping>\n    ```\n\n 3. 设置编码，防止乱码\n\n    ```xml\n    <!-- 编码 -->\n\t<filter>\n\t\t<filter-name>encodingFilter</filter-name>\n\t\t<filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>\n\t\t<init-param>\n\t\t\t<param-name>encoding</param-name>\n\t\t\t<param-value>UTF-8</param-value>\n\t\t</init-param>\n\t</filter>\n\t<filter-mapping>\n\t\t<filter-name>encodingFilter</filter-name>\n\t\t<url-pattern>/*</url-pattern>\n\t</filter-mapping>\n    ```\n\n 4. 设置首页\n\n    ```xml\n    <!-- 首页设置 -->\n    <welcome-file-list>\n    \t<welcome-file>index.html</welcome-file>\n    \t<welcome-file>index.htm</welcome-file>\n    \t<welcome-file>index.jsp</welcome-file>\n    \t<welcome-file>default.html</welcome-file>\n    \t<welcome-file>default.htm</welcome-file>\n    \t<welcome-file>default.jsp</welcome-file>\n    </welcome-file-list>\n    ```\n\n## 3、applicationContext.xml\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:context=\"http://www.springframework.org/schema/context\"\n       xmlns:tool=\"http://www.springframework.org/schema/tool\"\n       xmlns:tx=\"http://www.springframework.org/schema/tx\"\n       xmlns:aop=\"http://www.springframework.org/schema/aop\"\n       xsi:schemaLocation=\"\n\t\thttp://www.springframework.org/schema/beans \n\t\thttp://www.springframework.org/schema/beans/spring-beans-3.2.xsd\n\t\thttp://www.springframework.org/schema/context \n\t\thttp://www.springframework.org/schema/context/spring-context.xsd\n\t\thttp://www.springframework.org/schema/tx \n\t\thttp://www.springframework.org/schema/tx/spring-tx.xsd\n\t\thttp://www.springframework.org/schema/aop \n\t\thttp://www.springframework.org/schema/aop/spring-aop.xsd\n\t\thttp://www.springframework.org/schema/tool\n\t\thttp://www.springframework.org/schema/tool/spring-tool-3.2.xsd\n\t\t\">\n\t<!-- 开启注解配置Bean -->\n\t<!-- 设置扫描包路径 -->\n\t<context:annotation-config/>\n\t<context:component-scan base-package=\"com.topvision\"/>\n\t\n\t<!-- 开启注解事务 -->\n\t<tx:annotation-driven transaction-manager=\"transactionManager\"/>\n\t<!-- 事务管理器 -->\n\t<bean id=\"transactionManager\" class=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\">\n\t\t<property name=\"dataSource\" ref=\"dataSource\"></property>\n\t</bean>\t\n\t<!-- 数据库C3P0 -->\n\t<bean id=\"dataSource\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\">\n\t\t<property name=\"driverClass\" value=\"${s2sm.jdbc.driverClass}\"/>\n\t\t<property name=\"jdbcUrl\" value=\"${s2sm.jdbc.url}\"/>\n\t\t<property name=\"user\" value=\"${s2sm.jdbc.username}\"/>\n\t\t<property name=\"password\" value=\"${s2sm.jdbc.password}\"/>\n\t\t\n        <property name=\"initialPoolSize\" value=\"${s2sm.cpool.initialPoolSize}\" />\n        <property name=\"minPoolSize\" value=\"${s2sm.cpool.minPoolSize}\" />\n        <property name=\"maxPoolSize\" value=\"${s2sm.cpool.maxPoolSize}\" />\n        <property name=\"acquireIncrement\" value=\"${s2sm.cpool.acquireIncrement}\" />\n        <property name=\"maxIdleTime\" value=\"${s2sm.cpool.maxIdleTime}\"/>\n        <property name=\"acquireRetryAttempts\" value=\"${s2sm.cpool.acquireRetryAttempts}\"/>\n        <property name=\"acquireRetryDelay\" value=\"${s2sm.cpool.acquireRetryDelay}\"/>\n\t</bean>\n\t\n\t<!-- 加载properties -->\n\t<!-- <context:property-placeholder location=\"classpath:jdbc.properties\"/> -->\n\t<bean id=\"propertyConfigurer\" class=\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\">\n\t\t<property name=\"locations\">\n\t\t\t<list>\n\t\t\t\t<value>classpath:/config/*.properties</value>\n\t\t\t</list>\n\t\t</property>\n\t</bean>\n\t\n</beans>\n```\n\n## 4、Action编写\n\n```java\n@Controller\n@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\npublic class LoginAction extends BaseAction{\n    private static final long serialVersionUID = -4442251270114214406L;\n    private String username;\n    private String password;\n\n    public String loginTest() {\n        String key = username + \":\" + password;\n        ActionContext context2 = ActionContext.getContext(); \n        context2.put(\"key\", key);\n        return SUCCESS;\n    }\n\n    public String getUsername() {\n        return username;\n    }\n\n    public void setUsername(String username) {\n        this.username = username;\n    }\n\n    public String getPassword() {\n        return password;\n    }\n\n    public void setPassword(String password) {\n        this.password = password;\n    }\n\n}\n```\n\n## 5、配置struts.xml\n\nstruts.xml文件路径要与struts2核心过滤器中配置的路径一致，默认在classpath下即可。\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE struts PUBLIC\n\t\"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN\"\n\t\"http://struts.apache.org/dtds/struts-2.3.dtd\">\n\n<struts>\n    <!-- 所有匹配*.action的请求都由struts2处理 -->\n    <constant name=\"struts.action.extension\" value=\"tv,mb\" />\n    <!-- 主题  simple,xhtml,css_xhtml和ajax-->\n\t<constant name=\"struts.ui.theme\" value=\"simple\"/>\n\t\n    <!-- 是否启用开发模式 -->\n    <constant name=\"struts.devMode\" value=\"true\" />\n    <!-- struts配置文件改动后，是否重新加载，有助于开发 -->\n    <constant name=\"struts.configuration.xml.reload\" value=\"true\" />\n    <!-- 每次HTTP请求系统都重新加载资源文件，有助于开发 -->\n    <constant name=\"struts.i18n.reload\" value=\"true\" />\n    <!-- 设置浏览器是否缓存静态内容,开发是设为false,部署后true -->\n    <constant name=\"struts.serve.static.browserCache\" value=\"false\" />\n\t<!-- Content Model : ((package | include | bean | constant)*, unknown-handler-stack?) -->\n    \n\t<package name=\"login\" namespace=\"/aaa\" extends=\"struts-default\">\n\t\t<action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n\t\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t\t</action>\n\t\n\t</package>\n\n</struts>\n```\n\n## 6、测试\n\n 1. 首页设置\n    \n    ```jsp\n    <%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%>\n    <!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n    <html>\n    <head>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n    <title>Insert title here</title>\n    </head>\n    <body>\n    <a href=\"aaa/loginTest.tv?username=中文&password=123\">请点击这个链接</a><br>  \n    </body>\n    </html>\n    ```\n 2. login.jsp\n\n    ```jsp\n    <%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%>\n    <%@ taglib prefix=\"s\" uri=\"/struts-tags\" %>\n    <!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n    <html>\n    <head>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n    <title>成功</title>\n    </head>\n    <body>\n    <h2>跳转成功</h2>\n    <s:property value=\"@java.lang.Integer@MAX_VALUE\"/>\n    <s:property value=\"username\"/>\n    <s:property value=\"password\"/>\n    <s:debug></s:debug>\n    </body>\n    </html>\n    ```\n    \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/s2sm.png\n  [2]: https://www.zybuluo.com/mdeditor#772562","slug":"Struts2-2-——搭建struts及spring整合Demo","published":1,"updated":"2018-02-27T07:38:38.093Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspfc0011n8vfzy4z4s4j","content":"<p>简单介绍struts2整合spring项目的搭建。<br><a id=\"more\"></a></p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/s2sm.png\" alt=\"工程结构图\"></p>\n<h2 id=\"1、创建maven工程，引入jar依赖\"><a href=\"#1、创建maven工程，引入jar依赖\" class=\"headerlink\" title=\"1、创建maven工程，引入jar依赖\"></a>1、创建maven工程，引入jar依赖</h2><p>pom.xml文件如下，maven相关知识请参看<a href=\"https://www.zybuluo.com/mdeditor#772562\" target=\"_blank\" rel=\"noopener\">maven学习</a>。<br>属性：设置版本等信息<br>依赖管理：锁定依赖jar包的具体版本<br>依赖：</p>\n<ol>\n<li>spring:</li>\n<li>struts2</li>\n<li>mybatis</li>\n<li>mysql驱动</li>\n<li>c3p0</li>\n<li>slf4j</li>\n<li>junit、jstl</li>\n<li>servlet jsp</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.topvision<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>s2sm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>s2sm Maven Webapp<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.apache.org<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 属性 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">spring.version</span>&gt;</span>4.3.12.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">spring.version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">mybatis.version</span>&gt;</span>3.4.5<span class=\"tag\">&lt;/<span class=\"name\">mybatis.version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">struts.version</span>&gt;</span>2.3.24.1<span class=\"tag\">&lt;/<span class=\"name\">struts.version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 锁定版本 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aspects<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-orm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;struts.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-spring-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;struts.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-json-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;struts.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t</div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- Spring --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aspects<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-orm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- Struts --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-spring-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-json-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mybatis --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-spring<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mysql驱动 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- c3p0 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- slf4j --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-log4j12<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- junit --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.9<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- jstl --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jstl<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t  \t<span class=\"comment\">&lt;!-- servlet jsp --&gt;</span></div><div class=\"line\">\t  \t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>servlet-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t  \t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t  \t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jsp-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t  \t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    \t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">encoding</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>s2sm<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"2、配置web-xml\"><a href=\"#2、配置web-xml\" class=\"headerlink\" title=\"2、配置web.xml\"></a>2、配置web.xml</h2><ol>\n<li><p>配置spring监听器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- applicationContext对象仅加载一次，在服务器器启动时加载 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">listener</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class=\"tag\">&lt;/<span class=\"name\">listener-class</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">listener</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context-param</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>contextConfigLocation<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:/config/applicationContext*.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">context-param</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>配置struts2核心过滤器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"comment\">&lt;!-- Struts2核心过滤器 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>struts2<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 指定action所在包路径 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span>  </div><div class=\"line\">       \t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>actionPackages<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span>  </div><div class=\"line\">       \t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>com.topvision<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span>  </div><div class=\"line\">   \t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">   \t<span class=\"comment\">&lt;!-- 指定struts.xml文件路径，默认classpath下 --&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">   \t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>filterConfig<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">   \t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:struts.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 设置url过滤 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>struts2<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>设置编码，防止乱码</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"comment\">&lt;!-- 编码 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>encodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>encoding<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>encodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>设置首页</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 首页设置 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">welcome-file-list</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.html<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.htm<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.jsp<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.html<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.htm<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.jsp<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">welcome-file-list</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"3、applicationContext-xml\"><a href=\"#3、applicationContext-xml\" class=\"headerlink\" title=\"3、applicationContext.xml\"></a>3、applicationContext.xml</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:tool</span>=<span class=\"string\">\"http://www.springframework.org/schema/tool\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:tx</span>=<span class=\"string\">\"http://www.springframework.org/schema/tx\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:aop</span>=<span class=\"string\">\"http://www.springframework.org/schema/aop\"</span></div><div class=\"line\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"</span></div><div class=\"line\">\t\thttp://www.springframework.org/schema/beans </div><div class=\"line\">\t\thttp://www.springframework.org/schema/beans/spring-beans-3.2.xsd</div><div class=\"line\">\t\thttp://www.springframework.org/schema/context </div><div class=\"line\">\t\thttp://www.springframework.org/schema/context/spring-context.xsd</div><div class=\"line\">\t\thttp://www.springframework.org/schema/tx </div><div class=\"line\">\t\thttp://www.springframework.org/schema/tx/spring-tx.xsd</div><div class=\"line\">\t\thttp://www.springframework.org/schema/aop </div><div class=\"line\">\t\thttp://www.springframework.org/schema/aop/spring-aop.xsd</div><div class=\"line\">\t\thttp://www.springframework.org/schema/tool</div><div class=\"line\">\t\thttp://www.springframework.org/schema/tool/spring-tool-3.2.xsd</div><div class=\"line\">\t\t\"&gt;</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 开启注解配置Bean --&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 设置扫描包路径 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">context:annotation-config</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision\"</span>/&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 开启注解事务 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">tx:annotation-driven</span> <span class=\"attr\">transaction-manager</span>=<span class=\"string\">\"transactionManager\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 事务管理器 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"transactionManager\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DataSourceTransactionManager\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span>\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 数据库C3P0 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.mchange.v2.c3p0.ComboPooledDataSource\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.driverClass&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.url&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.username&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.password&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"initialPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.initialPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"minPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.minPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"maxPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.maxPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireIncrement\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireIncrement&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"maxIdleTime\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.maxIdleTime&#125;\"</span>/&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireRetryAttempts\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireRetryAttempts&#125;\"</span>/&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireRetryDelay\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireRetryDelay&#125;\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 加载properties --&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- &lt;context:property-placeholder location=\"classpath:jdbc.properties\"/&gt; --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"propertyConfigurer\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"locations\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>classpath:/config/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"4、Action编写\"><a href=\"#4、Action编写\" class=\"headerlink\" title=\"4、Action编写\"></a>4、Action编写</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Controller</span></div><div class=\"line\"><span class=\"meta\">@Scope</span>(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LoginAction</span> <span class=\"keyword\">extends</span> <span class=\"title\">BaseAction</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">4442251270114214406L</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String username;</div><div class=\"line\">    <span class=\"keyword\">private</span> String password;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">loginTest</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        String key = username + <span class=\"string\">\":\"</span> + password;</div><div class=\"line\">        ActionContext context2 = ActionContext.getContext(); </div><div class=\"line\">        context2.put(<span class=\"string\">\"key\"</span>, key);</div><div class=\"line\">        <span class=\"keyword\">return</span> SUCCESS;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUsername</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> username;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUsername</span><span class=\"params\">(String username)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.username = username;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getPassword</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> password;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setPassword</span><span class=\"params\">(String password)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.password = password;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"5、配置struts-xml\"><a href=\"#5、配置struts-xml\" class=\"headerlink\" title=\"5、配置struts.xml\"></a>5、配置struts.xml</h2><p>struts.xml文件路径要与struts2核心过滤器中配置的路径一致，默认在classpath下即可。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE struts PUBLIC</span></div><div class=\"line\">\t\"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN\"</div><div class=\"line\">\t\"http://struts.apache.org/dtds/struts-2.3.dtd\"&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">struts</span>&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 所有匹配*.action的请求都由struts2处理 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.action.extension\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"tv,mb\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 主题  simple,xhtml,css_xhtml和ajax--&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.ui.theme\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"simple\"</span>/&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">    <span class=\"comment\">&lt;!-- 是否启用开发模式 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.devMode\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- struts配置文件改动后，是否重新加载，有助于开发 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.configuration.xml.reload\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 每次HTTP请求系统都重新加载资源文件，有助于开发 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.i18n.reload\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 设置浏览器是否缓存静态内容,开发是设为false,部署后true --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.serve.static.browserCache\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"false\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- Content Model : ((package | include | bean | constant)*, unknown-handler-stack?) --&gt;</span></div><div class=\"line\">    </div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"login\"</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"/aaa\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">struts</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"6、测试\"><a href=\"#6、测试\" class=\"headerlink\" title=\"6、测试\"></a>6、测试</h2><ol>\n<li><p>首页设置</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%&gt;</div><div class=\"line\">&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\"&gt;</div><div class=\"line\">&lt;html&gt;</div><div class=\"line\">&lt;head&gt;</div><div class=\"line\">&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"&gt;</div><div class=\"line\">&lt;title&gt;Insert title here&lt;/title&gt;</div><div class=\"line\">&lt;/head&gt;</div><div class=\"line\">&lt;body&gt;</div><div class=\"line\">&lt;a href=\"aaa/loginTest.tv?username=中文&amp;password=123\"&gt;请点击这个链接&lt;/a&gt;&lt;br&gt;  </div><div class=\"line\">&lt;/body&gt;</div><div class=\"line\">&lt;/html&gt;</div></pre></td></tr></table></figure>\n</li>\n<li><p>login.jsp</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%&gt;</div><div class=\"line\">&lt;%@ taglib prefix=\"s\" uri=\"/struts-tags\" %&gt;</div><div class=\"line\">&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\"&gt;</div><div class=\"line\">&lt;html&gt;</div><div class=\"line\">&lt;head&gt;</div><div class=\"line\">&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"&gt;</div><div class=\"line\">&lt;title&gt;成功&lt;/title&gt;</div><div class=\"line\">&lt;/head&gt;</div><div class=\"line\">&lt;body&gt;</div><div class=\"line\">&lt;h2&gt;跳转成功&lt;/h2&gt;</div><div class=\"line\">&lt;s:property value=\"@java.lang.Integer@MAX_VALUE\"/&gt;</div><div class=\"line\">&lt;s:property value=\"username\"/&gt;</div><div class=\"line\">&lt;s:property value=\"password\"/&gt;</div><div class=\"line\">&lt;s:debug&gt;&lt;/s:debug&gt;</div><div class=\"line\">&lt;/body&gt;</div><div class=\"line\">&lt;/html&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>简单介绍struts2整合spring项目的搭建。<br>","more":"</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/s2sm.png\" alt=\"工程结构图\"></p>\n<h2 id=\"1、创建maven工程，引入jar依赖\"><a href=\"#1、创建maven工程，引入jar依赖\" class=\"headerlink\" title=\"1、创建maven工程，引入jar依赖\"></a>1、创建maven工程，引入jar依赖</h2><p>pom.xml文件如下，maven相关知识请参看<a href=\"https://www.zybuluo.com/mdeditor#772562\" target=\"_blank\" rel=\"noopener\">maven学习</a>。<br>属性：设置版本等信息<br>依赖管理：锁定依赖jar包的具体版本<br>依赖：</p>\n<ol>\n<li>spring:</li>\n<li>struts2</li>\n<li>mybatis</li>\n<li>mysql驱动</li>\n<li>c3p0</li>\n<li>slf4j</li>\n<li>junit、jstl</li>\n<li>servlet jsp</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.topvision<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>s2sm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>s2sm Maven Webapp<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.apache.org<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 属性 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">spring.version</span>&gt;</span>4.3.12.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">spring.version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">mybatis.version</span>&gt;</span>3.4.5<span class=\"tag\">&lt;/<span class=\"name\">mybatis.version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">struts.version</span>&gt;</span>2.3.24.1<span class=\"tag\">&lt;/<span class=\"name\">struts.version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 锁定版本 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aspects<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-orm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;struts.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-spring-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;struts.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-json-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;struts.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t</div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- Spring --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aspects<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-orm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- Struts --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-spring-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-json-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mybatis --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-spring<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mysql驱动 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- c3p0 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- slf4j --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-log4j12<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- junit --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.9<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- jstl --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jstl<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t  \t<span class=\"comment\">&lt;!-- servlet jsp --&gt;</span></div><div class=\"line\">\t  \t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>servlet-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t  \t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t  \t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jsp-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t  \t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    \t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">encoding</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>s2sm<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"2、配置web-xml\"><a href=\"#2、配置web-xml\" class=\"headerlink\" title=\"2、配置web.xml\"></a>2、配置web.xml</h2><ol>\n<li><p>配置spring监听器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- applicationContext对象仅加载一次，在服务器器启动时加载 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">listener</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class=\"tag\">&lt;/<span class=\"name\">listener-class</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">listener</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context-param</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>contextConfigLocation<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:/config/applicationContext*.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">context-param</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>配置struts2核心过滤器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"comment\">&lt;!-- Struts2核心过滤器 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>struts2<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 指定action所在包路径 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span>  </div><div class=\"line\">       \t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>actionPackages<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span>  </div><div class=\"line\">       \t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>com.topvision<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span>  </div><div class=\"line\">   \t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">   \t<span class=\"comment\">&lt;!-- 指定struts.xml文件路径，默认classpath下 --&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">   \t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>filterConfig<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">   \t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:struts.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 设置url过滤 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>struts2<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>设置编码，防止乱码</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"comment\">&lt;!-- 编码 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>encodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>encoding<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>encodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>设置首页</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 首页设置 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">welcome-file-list</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.html<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.htm<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.jsp<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.html<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.htm<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.jsp<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">welcome-file-list</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"3、applicationContext-xml\"><a href=\"#3、applicationContext-xml\" class=\"headerlink\" title=\"3、applicationContext.xml\"></a>3、applicationContext.xml</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:tool</span>=<span class=\"string\">\"http://www.springframework.org/schema/tool\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:tx</span>=<span class=\"string\">\"http://www.springframework.org/schema/tx\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:aop</span>=<span class=\"string\">\"http://www.springframework.org/schema/aop\"</span></div><div class=\"line\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"</span></div><div class=\"line\">\t\thttp://www.springframework.org/schema/beans </div><div class=\"line\">\t\thttp://www.springframework.org/schema/beans/spring-beans-3.2.xsd</div><div class=\"line\">\t\thttp://www.springframework.org/schema/context </div><div class=\"line\">\t\thttp://www.springframework.org/schema/context/spring-context.xsd</div><div class=\"line\">\t\thttp://www.springframework.org/schema/tx </div><div class=\"line\">\t\thttp://www.springframework.org/schema/tx/spring-tx.xsd</div><div class=\"line\">\t\thttp://www.springframework.org/schema/aop </div><div class=\"line\">\t\thttp://www.springframework.org/schema/aop/spring-aop.xsd</div><div class=\"line\">\t\thttp://www.springframework.org/schema/tool</div><div class=\"line\">\t\thttp://www.springframework.org/schema/tool/spring-tool-3.2.xsd</div><div class=\"line\">\t\t\"&gt;</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 开启注解配置Bean --&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 设置扫描包路径 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">context:annotation-config</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision\"</span>/&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 开启注解事务 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">tx:annotation-driven</span> <span class=\"attr\">transaction-manager</span>=<span class=\"string\">\"transactionManager\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 事务管理器 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"transactionManager\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DataSourceTransactionManager\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span>\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 数据库C3P0 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.mchange.v2.c3p0.ComboPooledDataSource\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.driverClass&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.url&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.username&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.password&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"initialPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.initialPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"minPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.minPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"maxPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.maxPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireIncrement\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireIncrement&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"maxIdleTime\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.maxIdleTime&#125;\"</span>/&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireRetryAttempts\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireRetryAttempts&#125;\"</span>/&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireRetryDelay\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireRetryDelay&#125;\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 加载properties --&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- &lt;context:property-placeholder location=\"classpath:jdbc.properties\"/&gt; --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"propertyConfigurer\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"locations\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>classpath:/config/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"4、Action编写\"><a href=\"#4、Action编写\" class=\"headerlink\" title=\"4、Action编写\"></a>4、Action编写</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Controller</span></div><div class=\"line\"><span class=\"meta\">@Scope</span>(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LoginAction</span> <span class=\"keyword\">extends</span> <span class=\"title\">BaseAction</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">4442251270114214406L</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String username;</div><div class=\"line\">    <span class=\"keyword\">private</span> String password;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">loginTest</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        String key = username + <span class=\"string\">\":\"</span> + password;</div><div class=\"line\">        ActionContext context2 = ActionContext.getContext(); </div><div class=\"line\">        context2.put(<span class=\"string\">\"key\"</span>, key);</div><div class=\"line\">        <span class=\"keyword\">return</span> SUCCESS;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUsername</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> username;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUsername</span><span class=\"params\">(String username)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.username = username;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getPassword</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> password;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setPassword</span><span class=\"params\">(String password)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.password = password;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"5、配置struts-xml\"><a href=\"#5、配置struts-xml\" class=\"headerlink\" title=\"5、配置struts.xml\"></a>5、配置struts.xml</h2><p>struts.xml文件路径要与struts2核心过滤器中配置的路径一致，默认在classpath下即可。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE struts PUBLIC</span></div><div class=\"line\">\t\"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN\"</div><div class=\"line\">\t\"http://struts.apache.org/dtds/struts-2.3.dtd\"&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">struts</span>&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 所有匹配*.action的请求都由struts2处理 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.action.extension\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"tv,mb\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 主题  simple,xhtml,css_xhtml和ajax--&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.ui.theme\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"simple\"</span>/&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">    <span class=\"comment\">&lt;!-- 是否启用开发模式 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.devMode\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- struts配置文件改动后，是否重新加载，有助于开发 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.configuration.xml.reload\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 每次HTTP请求系统都重新加载资源文件，有助于开发 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.i18n.reload\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 设置浏览器是否缓存静态内容,开发是设为false,部署后true --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.serve.static.browserCache\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"false\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- Content Model : ((package | include | bean | constant)*, unknown-handler-stack?) --&gt;</span></div><div class=\"line\">    </div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"login\"</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"/aaa\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">struts</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"6、测试\"><a href=\"#6、测试\" class=\"headerlink\" title=\"6、测试\"></a>6、测试</h2><ol>\n<li><p>首页设置</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%&gt;</div><div class=\"line\">&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\"&gt;</div><div class=\"line\">&lt;html&gt;</div><div class=\"line\">&lt;head&gt;</div><div class=\"line\">&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"&gt;</div><div class=\"line\">&lt;title&gt;Insert title here&lt;/title&gt;</div><div class=\"line\">&lt;/head&gt;</div><div class=\"line\">&lt;body&gt;</div><div class=\"line\">&lt;a href=\"aaa/loginTest.tv?username=中文&amp;password=123\"&gt;请点击这个链接&lt;/a&gt;&lt;br&gt;  </div><div class=\"line\">&lt;/body&gt;</div><div class=\"line\">&lt;/html&gt;</div></pre></td></tr></table></figure>\n</li>\n<li><p>login.jsp</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%&gt;</div><div class=\"line\">&lt;%@ taglib prefix=\"s\" uri=\"/struts-tags\" %&gt;</div><div class=\"line\">&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\"&gt;</div><div class=\"line\">&lt;html&gt;</div><div class=\"line\">&lt;head&gt;</div><div class=\"line\">&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"&gt;</div><div class=\"line\">&lt;title&gt;成功&lt;/title&gt;</div><div class=\"line\">&lt;/head&gt;</div><div class=\"line\">&lt;body&gt;</div><div class=\"line\">&lt;h2&gt;跳转成功&lt;/h2&gt;</div><div class=\"line\">&lt;s:property value=\"@java.lang.Integer@MAX_VALUE\"/&gt;</div><div class=\"line\">&lt;s:property value=\"username\"/&gt;</div><div class=\"line\">&lt;s:property value=\"password\"/&gt;</div><div class=\"line\">&lt;s:debug&gt;&lt;/s:debug&gt;</div><div class=\"line\">&lt;/body&gt;</div><div class=\"line\">&lt;/html&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>"},{"title":"Struts2(3)——Action配置及访问方式","date":"2017-12-21T01:51:14.000Z","_content":"Action类构建及访问方式。\n<!-- more -->\n## 1、如何编写动作类\n\n 1. 普通POJO类做action(不推荐)\n 2. 实现Action接口，重写excute方法(不推荐)\n 3. 继承ActionSupport，写自己需要的方法。\n\n## 2、如何访问动作类\nstruts.xml中action的配置。\n```xml\n<package name=\"login\" namespace=\"/\" extends=\"struts-default\">\n\t<action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t</action>\n</package>\n```\n - package.name:包名，不能和其他package重复，唯一标识\n - package.namespace:命名空间，默认“”，优化访问路径\n - package.extends：自己写的package要继承struts-default这个包\n - action.name：动作的名称。让用户访问用的。\n - action.class：动作类的全名。\n    有默认值的，这个默认值是：com.opensymphony.xwork2.ActionSupport,在struts-default.xml中有配置：<default-class-ref class=\"com.opensymphony.xwork2.ActionSupport\" />\n - action.method：要执行的动作类中的动作方法。\n    有默认值的，这个默认值是：public String execute()方法\n\n\n如上会有一个缺点，就是每个方法都要在xml中配置一个action，较为麻烦。如何优化呢？有两个办法：动态方法调用和通配符。\n\n 1. 通配符\n\n    通配符使用的比较多，是人为的设置编码规则，体现出约定大于编码的规范。即action.name可以使用通配符星号(*)，在action.class、aciton.method、result.name处可以使用{n}方式匹配星号，举个例子就明白了。\n    ```xml\n    <action name=\"*_*\" class=\"{1}\" method=\"{2}\">\n        <result></result>\n    </action>\n    ```\n    请求路径：..../userAction_add，{1}匹配第一个*,为userAction, {2}匹配第二个*，为add。\n\n 2. 动态方法调用\n\n    在struts.xml中开启动态方法的使用。struts.enable.DynamicMethodInvocation = true。\n    ```xml\n    <!-- 让struts2支持动态方法调用,可以使用通配符 -->\n    <constant name=\"struts.enable.DynamicMethodInvocation\" value=\"true\" />\n    ```\n    那么就可以直接使用http://localhost:8080/xxx/xxxAction!add,直接调用xxxAction中的add方法了，并且在struts.xml中的action配置中，就不需要配置method属性的值了。这样做就解决了写死method值的问题\n\n## 3、动作类生命周期\n\n诞生：每次用户访问时。\n活着：动作没有响应结束。\n死亡：响应结束。\n\n多例的；没有线程安全问题。（与struts1所不同的）。\n因为动作类是一个非常普通的Java类，创建它需要消耗的资源可以省略不计。\n\n## 4、动作类访问Servlet的API\n\n 1. 实现xxxAware接口\n\n    ServletContextAware, ServletRequestAware,ServletResponseAware,SessionAware.\n    \n    struts2提供了这四个Aware接口用于Action类的实现，从而注入对应的application、request、response，session。这和ActionContext一样是解耦的，即没有引入servlet相关的包，是在struts2内部的。\n    \n    通过XxxAware接口的实现，可以方便的获取web资源。\n    \n    ```java\n    public class BaseAction extends ActionSupport implements SessionAware,ServletRequestAware, ServletResponseAware, ServletContextAware {\n        private static final long serialVersionUID = -6318930077865937364L;\n        protected Logger logger = LoggerFactory.getLogger(getClass());\n        protected Map<String, Object> session;\n        protected HttpServletRequest request;\n        protected HttpServletResponse response;\n        protected ServletContext context;\n    \n        @Override\n        public void setSession(Map<String, Object> session) {\n            this.session = session;\n        }\n    \n        @Override\n        public void setServletRequest(HttpServletRequest request) {\n            this.request = request;\n        }\n    \n        @Override\n        public void setServletResponse(HttpServletResponse response) {\n            this.response = response;\n        }\n    \n        @Override\n        public void setServletContext(ServletContext context) {\n            this.context = context;\n        }\n    }\n    ```\n\n 2. 直接耦合构造\n\n    ```java\n    ServletContext servletContext = ServletActionContext.getServletContext();\n    HttpServletRequest request = ServletActionContext.getRequest();\n    HttpSession session = request.getSession();\n    ```\n \n\n\n","source":"_posts/Struts2-3-——Action配置及访问方式.md","raw":"---\ntitle: Struts2(3)——Action配置及访问方式\ncategories:\n  - Struts2\ntags:\n  - Struts2\ndate: 2017-12-21 09:51:14\n---\nAction类构建及访问方式。\n<!-- more -->\n## 1、如何编写动作类\n\n 1. 普通POJO类做action(不推荐)\n 2. 实现Action接口，重写excute方法(不推荐)\n 3. 继承ActionSupport，写自己需要的方法。\n\n## 2、如何访问动作类\nstruts.xml中action的配置。\n```xml\n<package name=\"login\" namespace=\"/\" extends=\"struts-default\">\n\t<action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t</action>\n</package>\n```\n - package.name:包名，不能和其他package重复，唯一标识\n - package.namespace:命名空间，默认“”，优化访问路径\n - package.extends：自己写的package要继承struts-default这个包\n - action.name：动作的名称。让用户访问用的。\n - action.class：动作类的全名。\n    有默认值的，这个默认值是：com.opensymphony.xwork2.ActionSupport,在struts-default.xml中有配置：<default-class-ref class=\"com.opensymphony.xwork2.ActionSupport\" />\n - action.method：要执行的动作类中的动作方法。\n    有默认值的，这个默认值是：public String execute()方法\n\n\n如上会有一个缺点，就是每个方法都要在xml中配置一个action，较为麻烦。如何优化呢？有两个办法：动态方法调用和通配符。\n\n 1. 通配符\n\n    通配符使用的比较多，是人为的设置编码规则，体现出约定大于编码的规范。即action.name可以使用通配符星号(*)，在action.class、aciton.method、result.name处可以使用{n}方式匹配星号，举个例子就明白了。\n    ```xml\n    <action name=\"*_*\" class=\"{1}\" method=\"{2}\">\n        <result></result>\n    </action>\n    ```\n    请求路径：..../userAction_add，{1}匹配第一个*,为userAction, {2}匹配第二个*，为add。\n\n 2. 动态方法调用\n\n    在struts.xml中开启动态方法的使用。struts.enable.DynamicMethodInvocation = true。\n    ```xml\n    <!-- 让struts2支持动态方法调用,可以使用通配符 -->\n    <constant name=\"struts.enable.DynamicMethodInvocation\" value=\"true\" />\n    ```\n    那么就可以直接使用http://localhost:8080/xxx/xxxAction!add,直接调用xxxAction中的add方法了，并且在struts.xml中的action配置中，就不需要配置method属性的值了。这样做就解决了写死method值的问题\n\n## 3、动作类生命周期\n\n诞生：每次用户访问时。\n活着：动作没有响应结束。\n死亡：响应结束。\n\n多例的；没有线程安全问题。（与struts1所不同的）。\n因为动作类是一个非常普通的Java类，创建它需要消耗的资源可以省略不计。\n\n## 4、动作类访问Servlet的API\n\n 1. 实现xxxAware接口\n\n    ServletContextAware, ServletRequestAware,ServletResponseAware,SessionAware.\n    \n    struts2提供了这四个Aware接口用于Action类的实现，从而注入对应的application、request、response，session。这和ActionContext一样是解耦的，即没有引入servlet相关的包，是在struts2内部的。\n    \n    通过XxxAware接口的实现，可以方便的获取web资源。\n    \n    ```java\n    public class BaseAction extends ActionSupport implements SessionAware,ServletRequestAware, ServletResponseAware, ServletContextAware {\n        private static final long serialVersionUID = -6318930077865937364L;\n        protected Logger logger = LoggerFactory.getLogger(getClass());\n        protected Map<String, Object> session;\n        protected HttpServletRequest request;\n        protected HttpServletResponse response;\n        protected ServletContext context;\n    \n        @Override\n        public void setSession(Map<String, Object> session) {\n            this.session = session;\n        }\n    \n        @Override\n        public void setServletRequest(HttpServletRequest request) {\n            this.request = request;\n        }\n    \n        @Override\n        public void setServletResponse(HttpServletResponse response) {\n            this.response = response;\n        }\n    \n        @Override\n        public void setServletContext(ServletContext context) {\n            this.context = context;\n        }\n    }\n    ```\n\n 2. 直接耦合构造\n\n    ```java\n    ServletContext servletContext = ServletActionContext.getServletContext();\n    HttpServletRequest request = ServletActionContext.getRequest();\n    HttpSession session = request.getSession();\n    ```\n \n\n\n","slug":"Struts2-3-——Action配置及访问方式","published":1,"updated":"2018-02-27T07:38:38.093Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspfe0014n8vfkuigdevn","content":"<p>Action类构建及访问方式。<br><a id=\"more\"></a></p>\n<h2 id=\"1、如何编写动作类\"><a href=\"#1、如何编写动作类\" class=\"headerlink\" title=\"1、如何编写动作类\"></a>1、如何编写动作类</h2><ol>\n<li>普通POJO类做action(不推荐)</li>\n<li>实现Action接口，重写excute方法(不推荐)</li>\n<li>继承ActionSupport，写自己需要的方法。</li>\n</ol>\n<h2 id=\"2、如何访问动作类\"><a href=\"#2、如何访问动作类\" class=\"headerlink\" title=\"2、如何访问动作类\"></a>2、如何访问动作类</h2><p>struts.xml中action的配置。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"login\"</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"/\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<ul>\n<li>package.name:包名，不能和其他package重复，唯一标识</li>\n<li>package.namespace:命名空间，默认“”，优化访问路径</li>\n<li>package.extends：自己写的package要继承struts-default这个包</li>\n<li>action.name：动作的名称。让用户访问用的。</li>\n<li>action.class：动作类的全名。<br> 有默认值的，这个默认值是：com.opensymphony.xwork2.ActionSupport,在struts-default.xml中有配置：<default-class-ref class=\"com.opensymphony.xwork2.ActionSupport\"></default-class-ref></li>\n<li>action.method：要执行的动作类中的动作方法。<br> 有默认值的，这个默认值是：public String execute()方法</li>\n</ul>\n<p>如上会有一个缺点，就是每个方法都要在xml中配置一个action，较为麻烦。如何优化呢？有两个办法：动态方法调用和通配符。</p>\n<ol>\n<li><p>通配符</p>\n<p>通配符使用的比较多，是人为的设置编码规则，体现出约定大于编码的规范。即action.name可以使用通配符星号(*)，在action.class、aciton.method、result.name处可以使用{n}方式匹配星号，举个例子就明白了。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"*_*\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"&#123;1&#125;\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"&#123;2&#125;\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>请求路径：…./userAction_add，{1}匹配第一个<em>,为userAction, {2}匹配第二个</em>，为add。</p>\n</li>\n<li><p>动态方法调用</p>\n<p>在struts.xml中开启动态方法的使用。struts.enable.DynamicMethodInvocation = true。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 让struts2支持动态方法调用,可以使用通配符 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.enable.DynamicMethodInvocation\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div></pre></td></tr></table></figure>\n<p>那么就可以直接使用<a href=\"http://localhost:8080/xxx/xxxAction!add,直接调用xxxAction中的add方法了，并且在struts.xml中的action配置中，就不需要配置method属性的值了。这样做就解决了写死method值的问题\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/xxx/xxxAction!add,直接调用xxxAction中的add方法了，并且在struts.xml中的action配置中，就不需要配置method属性的值了。这样做就解决了写死method值的问题</a></p>\n</li>\n</ol>\n<h2 id=\"3、动作类生命周期\"><a href=\"#3、动作类生命周期\" class=\"headerlink\" title=\"3、动作类生命周期\"></a>3、动作类生命周期</h2><p>诞生：每次用户访问时。<br>活着：动作没有响应结束。<br>死亡：响应结束。</p>\n<p>多例的；没有线程安全问题。（与struts1所不同的）。<br>因为动作类是一个非常普通的Java类，创建它需要消耗的资源可以省略不计。</p>\n<h2 id=\"4、动作类访问Servlet的API\"><a href=\"#4、动作类访问Servlet的API\" class=\"headerlink\" title=\"4、动作类访问Servlet的API\"></a>4、动作类访问Servlet的API</h2><ol>\n<li><p>实现xxxAware接口</p>\n<p>ServletContextAware, ServletRequestAware,ServletResponseAware,SessionAware.</p>\n<p>struts2提供了这四个Aware接口用于Action类的实现，从而注入对应的application、request、response，session。这和ActionContext一样是解耦的，即没有引入servlet相关的包，是在struts2内部的。</p>\n<p>通过XxxAware接口的实现，可以方便的获取web资源。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BaseAction</span> <span class=\"keyword\">extends</span> <span class=\"title\">ActionSupport</span> <span class=\"keyword\">implements</span> <span class=\"title\">SessionAware</span>,<span class=\"title\">ServletRequestAware</span>, <span class=\"title\">ServletResponseAware</span>, <span class=\"title\">ServletContextAware</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">6318930077865937364L</span>;</div><div class=\"line\">    <span class=\"keyword\">protected</span> Logger logger = LoggerFactory.getLogger(getClass());</div><div class=\"line\">    <span class=\"keyword\">protected</span> Map&lt;String, Object&gt; session;</div><div class=\"line\">    <span class=\"keyword\">protected</span> HttpServletRequest request;</div><div class=\"line\">    <span class=\"keyword\">protected</span> HttpServletResponse response;</div><div class=\"line\">    <span class=\"keyword\">protected</span> ServletContext context;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setSession</span><span class=\"params\">(Map&lt;String, Object&gt; session)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.session = session;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setServletRequest</span><span class=\"params\">(HttpServletRequest request)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.request = request;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setServletResponse</span><span class=\"params\">(HttpServletResponse response)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.response = response;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setServletContext</span><span class=\"params\">(ServletContext context)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.context = context;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>直接耦合构造</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">ServletContext servletContext = ServletActionContext.getServletContext();</div><div class=\"line\">HttpServletRequest request = ServletActionContext.getRequest();</div><div class=\"line\">HttpSession session = request.getSession();</div></pre></td></tr></table></figure>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>Action类构建及访问方式。<br>","more":"</p>\n<h2 id=\"1、如何编写动作类\"><a href=\"#1、如何编写动作类\" class=\"headerlink\" title=\"1、如何编写动作类\"></a>1、如何编写动作类</h2><ol>\n<li>普通POJO类做action(不推荐)</li>\n<li>实现Action接口，重写excute方法(不推荐)</li>\n<li>继承ActionSupport，写自己需要的方法。</li>\n</ol>\n<h2 id=\"2、如何访问动作类\"><a href=\"#2、如何访问动作类\" class=\"headerlink\" title=\"2、如何访问动作类\"></a>2、如何访问动作类</h2><p>struts.xml中action的配置。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"login\"</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"/\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<ul>\n<li>package.name:包名，不能和其他package重复，唯一标识</li>\n<li>package.namespace:命名空间，默认“”，优化访问路径</li>\n<li>package.extends：自己写的package要继承struts-default这个包</li>\n<li>action.name：动作的名称。让用户访问用的。</li>\n<li>action.class：动作类的全名。<br> 有默认值的，这个默认值是：com.opensymphony.xwork2.ActionSupport,在struts-default.xml中有配置：<default-class-ref class=\"com.opensymphony.xwork2.ActionSupport\"></default-class-ref></li>\n<li>action.method：要执行的动作类中的动作方法。<br> 有默认值的，这个默认值是：public String execute()方法</li>\n</ul>\n<p>如上会有一个缺点，就是每个方法都要在xml中配置一个action，较为麻烦。如何优化呢？有两个办法：动态方法调用和通配符。</p>\n<ol>\n<li><p>通配符</p>\n<p>通配符使用的比较多，是人为的设置编码规则，体现出约定大于编码的规范。即action.name可以使用通配符星号(*)，在action.class、aciton.method、result.name处可以使用{n}方式匹配星号，举个例子就明白了。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"*_*\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"&#123;1&#125;\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"&#123;2&#125;\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>请求路径：…./userAction_add，{1}匹配第一个<em>,为userAction, {2}匹配第二个</em>，为add。</p>\n</li>\n<li><p>动态方法调用</p>\n<p>在struts.xml中开启动态方法的使用。struts.enable.DynamicMethodInvocation = true。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 让struts2支持动态方法调用,可以使用通配符 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.enable.DynamicMethodInvocation\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div></pre></td></tr></table></figure>\n<p>那么就可以直接使用<a href=\"http://localhost:8080/xxx/xxxAction!add,直接调用xxxAction中的add方法了，并且在struts.xml中的action配置中，就不需要配置method属性的值了。这样做就解决了写死method值的问题\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/xxx/xxxAction!add,直接调用xxxAction中的add方法了，并且在struts.xml中的action配置中，就不需要配置method属性的值了。这样做就解决了写死method值的问题</a></p>\n</li>\n</ol>\n<h2 id=\"3、动作类生命周期\"><a href=\"#3、动作类生命周期\" class=\"headerlink\" title=\"3、动作类生命周期\"></a>3、动作类生命周期</h2><p>诞生：每次用户访问时。<br>活着：动作没有响应结束。<br>死亡：响应结束。</p>\n<p>多例的；没有线程安全问题。（与struts1所不同的）。<br>因为动作类是一个非常普通的Java类，创建它需要消耗的资源可以省略不计。</p>\n<h2 id=\"4、动作类访问Servlet的API\"><a href=\"#4、动作类访问Servlet的API\" class=\"headerlink\" title=\"4、动作类访问Servlet的API\"></a>4、动作类访问Servlet的API</h2><ol>\n<li><p>实现xxxAware接口</p>\n<p>ServletContextAware, ServletRequestAware,ServletResponseAware,SessionAware.</p>\n<p>struts2提供了这四个Aware接口用于Action类的实现，从而注入对应的application、request、response，session。这和ActionContext一样是解耦的，即没有引入servlet相关的包，是在struts2内部的。</p>\n<p>通过XxxAware接口的实现，可以方便的获取web资源。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BaseAction</span> <span class=\"keyword\">extends</span> <span class=\"title\">ActionSupport</span> <span class=\"keyword\">implements</span> <span class=\"title\">SessionAware</span>,<span class=\"title\">ServletRequestAware</span>, <span class=\"title\">ServletResponseAware</span>, <span class=\"title\">ServletContextAware</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">6318930077865937364L</span>;</div><div class=\"line\">    <span class=\"keyword\">protected</span> Logger logger = LoggerFactory.getLogger(getClass());</div><div class=\"line\">    <span class=\"keyword\">protected</span> Map&lt;String, Object&gt; session;</div><div class=\"line\">    <span class=\"keyword\">protected</span> HttpServletRequest request;</div><div class=\"line\">    <span class=\"keyword\">protected</span> HttpServletResponse response;</div><div class=\"line\">    <span class=\"keyword\">protected</span> ServletContext context;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setSession</span><span class=\"params\">(Map&lt;String, Object&gt; session)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.session = session;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setServletRequest</span><span class=\"params\">(HttpServletRequest request)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.request = request;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setServletResponse</span><span class=\"params\">(HttpServletResponse response)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.response = response;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setServletContext</span><span class=\"params\">(ServletContext context)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.context = context;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>直接耦合构造</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">ServletContext servletContext = ServletActionContext.getServletContext();</div><div class=\"line\">HttpServletRequest request = ServletActionContext.getRequest();</div><div class=\"line\">HttpSession session = request.getSession();</div></pre></td></tr></table></figure>\n</li>\n</ol>"},{"title":"Struts2(4)——数据封装和类型转换","date":"2017-12-21T02:10:28.000Z","_content":"\n![数据封装][1]\n<!--more-->\n\n## 数据封装\n\n### 静态参数封装\n\n 1. 静态参数即在action中固定不变的参数，在struts.xml中配置action时赋值。\n\n    ```xml\n    <package name=\"login\" namespace=\"/\" extends=\"struts-default\">\n    \t<action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n    \t\t<param name=\"username\">xiaoyue</param>\n    \t\t<param name=\"password\">123456</param>\n    \t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n    \t</action>\n    </package>\n    ```\n\n 2. 在action中创建对应属性，提供getter和setter方法。\n\n    ```java\n    @Controller\n    @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n    public class LoginAction extends BaseAction{\n        private static final long serialVersionUID = -4442251270114214406L;\n        private String username;\n        private String password;\n        \n        public String loginTest() {\n            System.out.println(username);\n            System.out.println(password);\n            return SUCCESS;\n        }\n        \n        public String getUsername() {\n            return username;\n        }\n        public void setUsername(String username) {\n            this.username = username;\n        }\n        public String getPassword() {\n            return password;\n        }\n        public void setPassword(String password) {\n            this.password = password;\n        }\n    }\n    ```\n输出结果\n    ```java\n    xiaoyue\n    123456\n    ```\n    \n静态参数封装依赖的是静态参数拦截器staticParams。\n![staticParams][2]\n该拦截器会将静态参数放入值栈中，而action就在值栈中的栈顶，自然就会找到该action中的对应属性，然后进行赋值了。想查看源码，参考该篇博文：[struts2 18拦截器详解(十四) --- StaticParametersInterceptor][3]\n\n### 动态参数封装\n\n属性驱动和模型驱动都非常重要，都需要掌握，如果还不会ognl表达式，那么可以在学完ognl表达后在回过头来看即可。\n\n#### 属性驱动\n\n 1. 基本属性驱动\n\n    表单：\n    ```jsp\n    <form action=\"aaa/loginTest.tv\" method=\"post\">\n    \t<input type=\"text\" name=\"username\">\n    \t<button type=\"submit\">提交</button>\n    </form>  \n    ```\n    action：提供对应属性及getter和setter方法\n    ```java\n    private String username;\n    public String getUsername() {\n        return username;\n    }\n    public void setUsername(String username) {\n        this.username = username;\n    }\n    ```\n    \n    依赖params拦截器注入数据\n    ![params][4]\n    该拦截器做的事有两件，一是对提交的参数进行数据校验，判断是否合法，判断是否合法的标准就是拦截器中的excludeParams参数的正则表达式的值。二是将其封装到值栈中的栈顶元素中去，而当前action就在栈顶，所以能够将参数放入action中。通过查看[struts2 18拦截器详解(十五) --- ParametersInterceptor][5]来了解其源码 。\n    \n 2. ognl属性驱动\n\n    表单，封装对象\n    ```jsp\n    <form action=\"aaa/loginTest.tv\" method=\"post\">\n    \t姓名：<input type=\"text\" name=\"user.username\"><br>\n    \t年龄：<input type=\"text\" name=\"user.age\"><br>\n    \t<button type=\"submit\">提交</button>\n    </form>\n    ```\n    创建JavaBean对象\n    ```java\n    public class User implements Serializable {\n        private static final long serialVersionUID = 4340332295972232437L;\n        private String username;\n        private int age;\n        public String getUsername() {\n            return username;\n        }\n        public void setUsername(String username) {\n            this.username = username;\n        }\n        public int getAge() {\n            return age;\n        }\n        public void setAge(int age) {\n            this.age = age;\n        }\n    }\n    ```\n    Action接收：创建对象，提供getter和setter\n    ```java\n    private User user = new User();\n    \n    public User getUser() {\n        return user;\n    }\n\n    public void setUser(User user) {\n        this.user = user;\n    }\n    ```\n    \n    在jsp页面中的user.username和user.age其实就是ognl表达式，代表着往根(root，值栈valueStack)中存放值，而值栈中的栈顶元素也就是为当前action，我们在action中设置user的get、set属性，即可以让存进来的值匹配到，进而将对应属性赋值成功。\n \n#### 模型驱动\n\n 实现ModelDriven接口，提供一个方法getModel()，编写对象实例。\n \n jsp表单：\n```jsp\n<form action=\"aaa/loginTest.tv\" method=\"post\">\n    姓名：<input type=\"text\" name=\"user.username\"><br>\n    年龄：<input type=\"text\" name=\"user.age\"><br>\n    <button type=\"submit\">提交</button>\n</form> \n```\n\nAction类实现ModelDriven接口，提供getModel()方法\n```java\nprivate User user = new User();\n    \n@Override\npublic User getModel() {\n    return null;\n}\n```\n\n分析：这有一个专门的拦截器，叫做modelDriven。\n![modelDriven][6]\n源码分析：[struts2 18拦截器详解(十) --- ModelDrivenInterceptor][7]\n其实原理就是，该拦截器将getModel方法返回的结果压入值栈，而我们的表单参数会从值栈中从上往下进行查找，自然就直接将参数封装到User对象中了。\n\n\n## 类型转换\n\n从表单元素提交过来的都是String类型的，而我们在servlet中获取到表单元素后，得到的是Object类型，也就是需要我们自己手动转型，但是在struts2中，我们却不需要，是因为有这么一个机制，参数类型自动转型，获取过来的参数都是String类型的，但是如果我们需要int型，double型等，都会帮我们自己转换。\n\n这里需要注意一点，在使用struts2中的日期自动转型时，表单中的日期字符串的格式是固定的，必须是2014-12-06，也就是yyyy-mm-dd这样的格式，其他格式的话，不能够转型成功，这对有些人来说，就有些不舒服，使用习惯不一样，但是没关系，struts2能够让我们自定义类型转换器，格式让我们自己来决定。\n\n例如：表单输入**2013-12-23**，接收date为**Tue Dec 23 00:00:00 CST 2014**\n\n### 自定义类型转换器\n\n 1. 编写转换器类继承StrutsTypeConverter,实现两个抽象方法\n\n    ```java\n    public class DateConverter extends StrutsTypeConverter{\n        \n        SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");\n        /* \n         * context:struts2的数据中心\n         * values:输入的数据\n         * toClass:要转换成的类型\n         */\n        @Override\n        public Object convertFromString(Map context, String[] values, Class toClass) {\n            if (values != null && values.length > 0) {\n                String value = values[0];\n                if (toClass == Date.class) {\n                    try {\n                        return sdf.parse(value);\n                    } catch (ParseException e) {\n                        e.printStackTrace();\n                    }\n                }\n            }\n            return null;\n        }\n    \n        @Override\n        public String convertToString(Map context, Object o) {\n            if (o != null && o.getClass() == Date.class) {\n                return sdf.format(o);\n            }\n            return null;\n        }\n    \n    }\n    ```\n\n 2. 注册类型转换器\n \n    ![转换器位置说明][8]\n\n    2.1 注册局部转换器\n    \n    在需要转换的Action同级目录，创建一个properties.\n    位置：action类同包\n    名称：actionClass-conversion.properties\n    actionClass:action类的类名\n    conversion.properties：固定名\n    \n    文件内容：\n    ```properties\n    date = com.topvision.s2sm.plantform.converter.DateConverter\n    ```\n    \n    2.2 注册全局转换\n    \n    在src下创建一个properties。\n    位置：src\n    名称：xwork-conversion.properties 固定写法\n    文件内容：\n    ```properties\n    java.util.date = com.topvision.s2sm.plantform.converter.DateConverter\n    ```\n    \n\n \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/dataTransform.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/staticParam.png\n  [3]: http://blog.csdn.net/xtayfjpk/article/details/14133589\n  [4]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/params.png\n  [5]: http://blog.csdn.net/xtayfjpk/article/details/14180981\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/modelDriven.png\n  [7]: http://blog.csdn.net/xtayfjpk/article/details/14004457\n  [8]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/conversion.png","source":"_posts/Struts2-4-——数据封装和类型转换.md","raw":"---\ntitle: Struts2(4)——数据封装和类型转换\ncategories:\n  - Struts2\ntags:\n  - Struts2\ndate: 2017-12-21 10:10:28\n---\n\n![数据封装][1]\n<!--more-->\n\n## 数据封装\n\n### 静态参数封装\n\n 1. 静态参数即在action中固定不变的参数，在struts.xml中配置action时赋值。\n\n    ```xml\n    <package name=\"login\" namespace=\"/\" extends=\"struts-default\">\n    \t<action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n    \t\t<param name=\"username\">xiaoyue</param>\n    \t\t<param name=\"password\">123456</param>\n    \t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n    \t</action>\n    </package>\n    ```\n\n 2. 在action中创建对应属性，提供getter和setter方法。\n\n    ```java\n    @Controller\n    @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n    public class LoginAction extends BaseAction{\n        private static final long serialVersionUID = -4442251270114214406L;\n        private String username;\n        private String password;\n        \n        public String loginTest() {\n            System.out.println(username);\n            System.out.println(password);\n            return SUCCESS;\n        }\n        \n        public String getUsername() {\n            return username;\n        }\n        public void setUsername(String username) {\n            this.username = username;\n        }\n        public String getPassword() {\n            return password;\n        }\n        public void setPassword(String password) {\n            this.password = password;\n        }\n    }\n    ```\n输出结果\n    ```java\n    xiaoyue\n    123456\n    ```\n    \n静态参数封装依赖的是静态参数拦截器staticParams。\n![staticParams][2]\n该拦截器会将静态参数放入值栈中，而action就在值栈中的栈顶，自然就会找到该action中的对应属性，然后进行赋值了。想查看源码，参考该篇博文：[struts2 18拦截器详解(十四) --- StaticParametersInterceptor][3]\n\n### 动态参数封装\n\n属性驱动和模型驱动都非常重要，都需要掌握，如果还不会ognl表达式，那么可以在学完ognl表达后在回过头来看即可。\n\n#### 属性驱动\n\n 1. 基本属性驱动\n\n    表单：\n    ```jsp\n    <form action=\"aaa/loginTest.tv\" method=\"post\">\n    \t<input type=\"text\" name=\"username\">\n    \t<button type=\"submit\">提交</button>\n    </form>  \n    ```\n    action：提供对应属性及getter和setter方法\n    ```java\n    private String username;\n    public String getUsername() {\n        return username;\n    }\n    public void setUsername(String username) {\n        this.username = username;\n    }\n    ```\n    \n    依赖params拦截器注入数据\n    ![params][4]\n    该拦截器做的事有两件，一是对提交的参数进行数据校验，判断是否合法，判断是否合法的标准就是拦截器中的excludeParams参数的正则表达式的值。二是将其封装到值栈中的栈顶元素中去，而当前action就在栈顶，所以能够将参数放入action中。通过查看[struts2 18拦截器详解(十五) --- ParametersInterceptor][5]来了解其源码 。\n    \n 2. ognl属性驱动\n\n    表单，封装对象\n    ```jsp\n    <form action=\"aaa/loginTest.tv\" method=\"post\">\n    \t姓名：<input type=\"text\" name=\"user.username\"><br>\n    \t年龄：<input type=\"text\" name=\"user.age\"><br>\n    \t<button type=\"submit\">提交</button>\n    </form>\n    ```\n    创建JavaBean对象\n    ```java\n    public class User implements Serializable {\n        private static final long serialVersionUID = 4340332295972232437L;\n        private String username;\n        private int age;\n        public String getUsername() {\n            return username;\n        }\n        public void setUsername(String username) {\n            this.username = username;\n        }\n        public int getAge() {\n            return age;\n        }\n        public void setAge(int age) {\n            this.age = age;\n        }\n    }\n    ```\n    Action接收：创建对象，提供getter和setter\n    ```java\n    private User user = new User();\n    \n    public User getUser() {\n        return user;\n    }\n\n    public void setUser(User user) {\n        this.user = user;\n    }\n    ```\n    \n    在jsp页面中的user.username和user.age其实就是ognl表达式，代表着往根(root，值栈valueStack)中存放值，而值栈中的栈顶元素也就是为当前action，我们在action中设置user的get、set属性，即可以让存进来的值匹配到，进而将对应属性赋值成功。\n \n#### 模型驱动\n\n 实现ModelDriven接口，提供一个方法getModel()，编写对象实例。\n \n jsp表单：\n```jsp\n<form action=\"aaa/loginTest.tv\" method=\"post\">\n    姓名：<input type=\"text\" name=\"user.username\"><br>\n    年龄：<input type=\"text\" name=\"user.age\"><br>\n    <button type=\"submit\">提交</button>\n</form> \n```\n\nAction类实现ModelDriven接口，提供getModel()方法\n```java\nprivate User user = new User();\n    \n@Override\npublic User getModel() {\n    return null;\n}\n```\n\n分析：这有一个专门的拦截器，叫做modelDriven。\n![modelDriven][6]\n源码分析：[struts2 18拦截器详解(十) --- ModelDrivenInterceptor][7]\n其实原理就是，该拦截器将getModel方法返回的结果压入值栈，而我们的表单参数会从值栈中从上往下进行查找，自然就直接将参数封装到User对象中了。\n\n\n## 类型转换\n\n从表单元素提交过来的都是String类型的，而我们在servlet中获取到表单元素后，得到的是Object类型，也就是需要我们自己手动转型，但是在struts2中，我们却不需要，是因为有这么一个机制，参数类型自动转型，获取过来的参数都是String类型的，但是如果我们需要int型，double型等，都会帮我们自己转换。\n\n这里需要注意一点，在使用struts2中的日期自动转型时，表单中的日期字符串的格式是固定的，必须是2014-12-06，也就是yyyy-mm-dd这样的格式，其他格式的话，不能够转型成功，这对有些人来说，就有些不舒服，使用习惯不一样，但是没关系，struts2能够让我们自定义类型转换器，格式让我们自己来决定。\n\n例如：表单输入**2013-12-23**，接收date为**Tue Dec 23 00:00:00 CST 2014**\n\n### 自定义类型转换器\n\n 1. 编写转换器类继承StrutsTypeConverter,实现两个抽象方法\n\n    ```java\n    public class DateConverter extends StrutsTypeConverter{\n        \n        SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");\n        /* \n         * context:struts2的数据中心\n         * values:输入的数据\n         * toClass:要转换成的类型\n         */\n        @Override\n        public Object convertFromString(Map context, String[] values, Class toClass) {\n            if (values != null && values.length > 0) {\n                String value = values[0];\n                if (toClass == Date.class) {\n                    try {\n                        return sdf.parse(value);\n                    } catch (ParseException e) {\n                        e.printStackTrace();\n                    }\n                }\n            }\n            return null;\n        }\n    \n        @Override\n        public String convertToString(Map context, Object o) {\n            if (o != null && o.getClass() == Date.class) {\n                return sdf.format(o);\n            }\n            return null;\n        }\n    \n    }\n    ```\n\n 2. 注册类型转换器\n \n    ![转换器位置说明][8]\n\n    2.1 注册局部转换器\n    \n    在需要转换的Action同级目录，创建一个properties.\n    位置：action类同包\n    名称：actionClass-conversion.properties\n    actionClass:action类的类名\n    conversion.properties：固定名\n    \n    文件内容：\n    ```properties\n    date = com.topvision.s2sm.plantform.converter.DateConverter\n    ```\n    \n    2.2 注册全局转换\n    \n    在src下创建一个properties。\n    位置：src\n    名称：xwork-conversion.properties 固定写法\n    文件内容：\n    ```properties\n    java.util.date = com.topvision.s2sm.plantform.converter.DateConverter\n    ```\n    \n\n \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/dataTransform.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/staticParam.png\n  [3]: http://blog.csdn.net/xtayfjpk/article/details/14133589\n  [4]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/params.png\n  [5]: http://blog.csdn.net/xtayfjpk/article/details/14180981\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/modelDriven.png\n  [7]: http://blog.csdn.net/xtayfjpk/article/details/14004457\n  [8]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/conversion.png","slug":"Struts2-4-——数据封装和类型转换","published":1,"updated":"2018-02-27T07:38:38.094Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspfh0018n8vfkpt4kdp4","content":"<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/dataTransform.png\" alt=\"数据封装\"><br><a id=\"more\"></a></p>\n<h2 id=\"数据封装\"><a href=\"#数据封装\" class=\"headerlink\" title=\"数据封装\"></a>数据封装</h2><h3 id=\"静态参数封装\"><a href=\"#静态参数封装\" class=\"headerlink\" title=\"静态参数封装\"></a>静态参数封装</h3><ol>\n<li><p>静态参数即在action中固定不变的参数，在struts.xml中配置action时赋值。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"login\"</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"/\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span>&gt;</span>xiaoyue<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span>&gt;</span>123456<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>在action中创建对应属性，提供getter和setter方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Controller</span></div><div class=\"line\"><span class=\"meta\">@Scope</span>(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LoginAction</span> <span class=\"keyword\">extends</span> <span class=\"title\">BaseAction</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">4442251270114214406L</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String username;</div><div class=\"line\">    <span class=\"keyword\">private</span> String password;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">loginTest</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        System.out.println(username);</div><div class=\"line\">        System.out.println(password);</div><div class=\"line\">        <span class=\"keyword\">return</span> SUCCESS;</div><div class=\"line\">    &#125;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUsername</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> username;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUsername</span><span class=\"params\">(String username)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.username = username;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getPassword</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> password;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setPassword</span><span class=\"params\">(String password)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.password = password;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>输出结果<br>    <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">xiaoyue</div><div class=\"line\"><span class=\"number\">123456</span></div></pre></td></tr></table></figure></p>\n<p>静态参数封装依赖的是静态参数拦截器staticParams。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/staticParam.png\" alt=\"staticParams\"><br>该拦截器会将静态参数放入值栈中，而action就在值栈中的栈顶，自然就会找到该action中的对应属性，然后进行赋值了。想查看源码，参考该篇博文：<a href=\"http://blog.csdn.net/xtayfjpk/article/details/14133589\" target=\"_blank\" rel=\"noopener\">struts2 18拦截器详解(十四) — StaticParametersInterceptor</a></p>\n<h3 id=\"动态参数封装\"><a href=\"#动态参数封装\" class=\"headerlink\" title=\"动态参数封装\"></a>动态参数封装</h3><p>属性驱动和模型驱动都非常重要，都需要掌握，如果还不会ognl表达式，那么可以在学完ognl表达后在回过头来看即可。</p>\n<h4 id=\"属性驱动\"><a href=\"#属性驱动\" class=\"headerlink\" title=\"属性驱动\"></a>属性驱动</h4><ol>\n<li><p>基本属性驱动</p>\n<p>表单：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;form action=\"aaa/loginTest.tv\" method=\"post\"&gt;</div><div class=\"line\">\t&lt;input type=\"text\" name=\"username\"&gt;</div><div class=\"line\">\t&lt;button type=\"submit\"&gt;提交&lt;/button&gt;</div><div class=\"line\">&lt;/form&gt;</div></pre></td></tr></table></figure>\n<p>action：提供对应属性及getter和setter方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> String username;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUsername</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> username;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUsername</span><span class=\"params\">(String username)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.username = username;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>依赖params拦截器注入数据\n![params][4]\n该拦截器做的事有两件，一是对提交的参数进行数据校验，判断是否合法，判断是否合法的标准就是拦截器中的excludeParams参数的正则表达式的值。二是将其封装到值栈中的栈顶元素中去，而当前action就在栈顶，所以能够将参数放入action中。通过查看[struts2 18拦截器详解(十五) --- ParametersInterceptor][5]来了解其源码 。\n</code></pre><ol>\n<li><p>ognl属性驱动</p>\n<p>表单，封装对象</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;form action=\"aaa/loginTest.tv\" method=\"post\"&gt;</div><div class=\"line\">\t姓名：&lt;input type=\"text\" name=\"user.username\"&gt;&lt;br&gt;</div><div class=\"line\">\t年龄：&lt;input type=\"text\" name=\"user.age\"&gt;&lt;br&gt;</div><div class=\"line\">\t&lt;button type=\"submit\"&gt;提交&lt;/button&gt;</div><div class=\"line\">&lt;/form&gt;</div></pre></td></tr></table></figure>\n<p>创建JavaBean对象</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> <span class=\"keyword\">implements</span> <span class=\"title\">Serializable</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">4340332295972232437L</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String username;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> age;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUsername</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> username;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUsername</span><span class=\"params\">(String username)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.username = username;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getAge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> age;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setAge</span><span class=\"params\">(<span class=\"keyword\">int</span> age)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.age = age;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Action接收：创建对象，提供getter和setter</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> User user = <span class=\"keyword\">new</span> User();</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">getUser</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> user;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUser</span><span class=\"params\">(User user)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.user = user;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>在jsp页面中的user.username和user.age其实就是ognl表达式，代表着往根(root，值栈valueStack)中存放值，而值栈中的栈顶元素也就是为当前action，我们在action中设置user的get、set属性，即可以让存进来的值匹配到，进而将对应属性赋值成功。\n</code></pre><h4 id=\"模型驱动\"><a href=\"#模型驱动\" class=\"headerlink\" title=\"模型驱动\"></a>模型驱动</h4><p> 实现ModelDriven接口，提供一个方法getModel()，编写对象实例。</p>\n<p> jsp表单：<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;form action=\"aaa/loginTest.tv\" method=\"post\"&gt;</div><div class=\"line\">    姓名：&lt;input type=\"text\" name=\"user.username\"&gt;&lt;br&gt;</div><div class=\"line\">    年龄：&lt;input type=\"text\" name=\"user.age\"&gt;&lt;br&gt;</div><div class=\"line\">    &lt;button type=\"submit\"&gt;提交&lt;/button&gt;</div><div class=\"line\">&lt;/form&gt;</div></pre></td></tr></table></figure></p>\n<p>Action类实现ModelDriven接口，提供getModel()方法<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> User user = <span class=\"keyword\">new</span> User();</div><div class=\"line\">    </div><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">getModel</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>分析：这有一个专门的拦截器，叫做modelDriven。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/modelDriven.png\" alt=\"modelDriven\"><br>源码分析：<a href=\"http://blog.csdn.net/xtayfjpk/article/details/14004457\" target=\"_blank\" rel=\"noopener\">struts2 18拦截器详解(十) — ModelDrivenInterceptor</a><br>其实原理就是，该拦截器将getModel方法返回的结果压入值栈，而我们的表单参数会从值栈中从上往下进行查找，自然就直接将参数封装到User对象中了。</p>\n<h2 id=\"类型转换\"><a href=\"#类型转换\" class=\"headerlink\" title=\"类型转换\"></a>类型转换</h2><p>从表单元素提交过来的都是String类型的，而我们在servlet中获取到表单元素后，得到的是Object类型，也就是需要我们自己手动转型，但是在struts2中，我们却不需要，是因为有这么一个机制，参数类型自动转型，获取过来的参数都是String类型的，但是如果我们需要int型，double型等，都会帮我们自己转换。</p>\n<p>这里需要注意一点，在使用struts2中的日期自动转型时，表单中的日期字符串的格式是固定的，必须是2014-12-06，也就是yyyy-mm-dd这样的格式，其他格式的话，不能够转型成功，这对有些人来说，就有些不舒服，使用习惯不一样，但是没关系，struts2能够让我们自定义类型转换器，格式让我们自己来决定。</p>\n<p>例如：表单输入<strong>2013-12-23</strong>，接收date为<strong>Tue Dec 23 00:00:00 CST 2014</strong></p>\n<h3 id=\"自定义类型转换器\"><a href=\"#自定义类型转换器\" class=\"headerlink\" title=\"自定义类型转换器\"></a>自定义类型转换器</h3><ol>\n<li><p>编写转换器类继承StrutsTypeConverter,实现两个抽象方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DateConverter</span> <span class=\"keyword\">extends</span> <span class=\"title\">StrutsTypeConverter</span></span>&#123;</div><div class=\"line\">    </div><div class=\"line\">    SimpleDateFormat sdf = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">\"yyyy-MM-dd\"</span>);</div><div class=\"line\">    <span class=\"comment\">/* </span></div><div class=\"line\">     * context:struts2的数据中心</div><div class=\"line\">     * values:输入的数据</div><div class=\"line\">     * toClass:要转换成的类型</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">convertFromString</span><span class=\"params\">(Map context, String[] values, Class toClass)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (values != <span class=\"keyword\">null</span> &amp;&amp; values.length &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            String value = values[<span class=\"number\">0</span>];</div><div class=\"line\">            <span class=\"keyword\">if</span> (toClass == Date.class) &#123;</div><div class=\"line\">                <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                    <span class=\"keyword\">return</span> sdf.parse(value);</div><div class=\"line\">                &#125; <span class=\"keyword\">catch</span> (ParseException e) &#123;</div><div class=\"line\">                    e.printStackTrace();</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">convertToString</span><span class=\"params\">(Map context, Object o)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (o != <span class=\"keyword\">null</span> &amp;&amp; o.getClass() == Date.class) &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> sdf.format(o);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>注册类型转换器</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/conversion.png\" alt=\"转换器位置说明\"></p>\n<p>2.1 注册局部转换器</p>\n<p>在需要转换的Action同级目录，创建一个properties.<br>位置：action类同包<br>名称：actionClass-conversion.properties<br>actionClass:action类的类名<br>conversion.properties：固定名</p>\n<p>文件内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">date = com.topvision.s2sm.plantform.converter.DateConverter</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>2.2 注册全局转换\n\n在src下创建一个properties。\n位置：src\n名称：xwork-conversion.properties 固定写法\n文件内容：\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">java.util.date = com.topvision.s2sm.plantform.converter.DateConverter</div></pre></td></tr></table></figure>\n</code></pre>","site":{"data":{}},"excerpt":"<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/dataTransform.png\" alt=\"数据封装\"><br>","more":"</p>\n<h2 id=\"数据封装\"><a href=\"#数据封装\" class=\"headerlink\" title=\"数据封装\"></a>数据封装</h2><h3 id=\"静态参数封装\"><a href=\"#静态参数封装\" class=\"headerlink\" title=\"静态参数封装\"></a>静态参数封装</h3><ol>\n<li><p>静态参数即在action中固定不变的参数，在struts.xml中配置action时赋值。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"login\"</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"/\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span>&gt;</span>xiaoyue<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span>&gt;</span>123456<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>在action中创建对应属性，提供getter和setter方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Controller</span></div><div class=\"line\"><span class=\"meta\">@Scope</span>(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LoginAction</span> <span class=\"keyword\">extends</span> <span class=\"title\">BaseAction</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">4442251270114214406L</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String username;</div><div class=\"line\">    <span class=\"keyword\">private</span> String password;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">loginTest</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        System.out.println(username);</div><div class=\"line\">        System.out.println(password);</div><div class=\"line\">        <span class=\"keyword\">return</span> SUCCESS;</div><div class=\"line\">    &#125;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUsername</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> username;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUsername</span><span class=\"params\">(String username)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.username = username;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getPassword</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> password;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setPassword</span><span class=\"params\">(String password)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.password = password;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>输出结果<br>    <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">xiaoyue</div><div class=\"line\"><span class=\"number\">123456</span></div></pre></td></tr></table></figure></p>\n<p>静态参数封装依赖的是静态参数拦截器staticParams。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/staticParam.png\" alt=\"staticParams\"><br>该拦截器会将静态参数放入值栈中，而action就在值栈中的栈顶，自然就会找到该action中的对应属性，然后进行赋值了。想查看源码，参考该篇博文：<a href=\"http://blog.csdn.net/xtayfjpk/article/details/14133589\" target=\"_blank\" rel=\"noopener\">struts2 18拦截器详解(十四) — StaticParametersInterceptor</a></p>\n<h3 id=\"动态参数封装\"><a href=\"#动态参数封装\" class=\"headerlink\" title=\"动态参数封装\"></a>动态参数封装</h3><p>属性驱动和模型驱动都非常重要，都需要掌握，如果还不会ognl表达式，那么可以在学完ognl表达后在回过头来看即可。</p>\n<h4 id=\"属性驱动\"><a href=\"#属性驱动\" class=\"headerlink\" title=\"属性驱动\"></a>属性驱动</h4><ol>\n<li><p>基本属性驱动</p>\n<p>表单：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;form action=\"aaa/loginTest.tv\" method=\"post\"&gt;</div><div class=\"line\">\t&lt;input type=\"text\" name=\"username\"&gt;</div><div class=\"line\">\t&lt;button type=\"submit\"&gt;提交&lt;/button&gt;</div><div class=\"line\">&lt;/form&gt;</div></pre></td></tr></table></figure>\n<p>action：提供对应属性及getter和setter方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> String username;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUsername</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> username;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUsername</span><span class=\"params\">(String username)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.username = username;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>依赖params拦截器注入数据\n![params][4]\n该拦截器做的事有两件，一是对提交的参数进行数据校验，判断是否合法，判断是否合法的标准就是拦截器中的excludeParams参数的正则表达式的值。二是将其封装到值栈中的栈顶元素中去，而当前action就在栈顶，所以能够将参数放入action中。通过查看[struts2 18拦截器详解(十五) --- ParametersInterceptor][5]来了解其源码 。\n</code></pre><ol>\n<li><p>ognl属性驱动</p>\n<p>表单，封装对象</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;form action=\"aaa/loginTest.tv\" method=\"post\"&gt;</div><div class=\"line\">\t姓名：&lt;input type=\"text\" name=\"user.username\"&gt;&lt;br&gt;</div><div class=\"line\">\t年龄：&lt;input type=\"text\" name=\"user.age\"&gt;&lt;br&gt;</div><div class=\"line\">\t&lt;button type=\"submit\"&gt;提交&lt;/button&gt;</div><div class=\"line\">&lt;/form&gt;</div></pre></td></tr></table></figure>\n<p>创建JavaBean对象</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> <span class=\"keyword\">implements</span> <span class=\"title\">Serializable</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">4340332295972232437L</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String username;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> age;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUsername</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> username;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUsername</span><span class=\"params\">(String username)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.username = username;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getAge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> age;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setAge</span><span class=\"params\">(<span class=\"keyword\">int</span> age)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.age = age;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Action接收：创建对象，提供getter和setter</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> User user = <span class=\"keyword\">new</span> User();</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">getUser</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> user;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUser</span><span class=\"params\">(User user)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.user = user;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>在jsp页面中的user.username和user.age其实就是ognl表达式，代表着往根(root，值栈valueStack)中存放值，而值栈中的栈顶元素也就是为当前action，我们在action中设置user的get、set属性，即可以让存进来的值匹配到，进而将对应属性赋值成功。\n</code></pre><h4 id=\"模型驱动\"><a href=\"#模型驱动\" class=\"headerlink\" title=\"模型驱动\"></a>模型驱动</h4><p> 实现ModelDriven接口，提供一个方法getModel()，编写对象实例。</p>\n<p> jsp表单：<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;form action=\"aaa/loginTest.tv\" method=\"post\"&gt;</div><div class=\"line\">    姓名：&lt;input type=\"text\" name=\"user.username\"&gt;&lt;br&gt;</div><div class=\"line\">    年龄：&lt;input type=\"text\" name=\"user.age\"&gt;&lt;br&gt;</div><div class=\"line\">    &lt;button type=\"submit\"&gt;提交&lt;/button&gt;</div><div class=\"line\">&lt;/form&gt;</div></pre></td></tr></table></figure></p>\n<p>Action类实现ModelDriven接口，提供getModel()方法<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> User user = <span class=\"keyword\">new</span> User();</div><div class=\"line\">    </div><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">getModel</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>分析：这有一个专门的拦截器，叫做modelDriven。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/modelDriven.png\" alt=\"modelDriven\"><br>源码分析：<a href=\"http://blog.csdn.net/xtayfjpk/article/details/14004457\" target=\"_blank\" rel=\"noopener\">struts2 18拦截器详解(十) — ModelDrivenInterceptor</a><br>其实原理就是，该拦截器将getModel方法返回的结果压入值栈，而我们的表单参数会从值栈中从上往下进行查找，自然就直接将参数封装到User对象中了。</p>\n<h2 id=\"类型转换\"><a href=\"#类型转换\" class=\"headerlink\" title=\"类型转换\"></a>类型转换</h2><p>从表单元素提交过来的都是String类型的，而我们在servlet中获取到表单元素后，得到的是Object类型，也就是需要我们自己手动转型，但是在struts2中，我们却不需要，是因为有这么一个机制，参数类型自动转型，获取过来的参数都是String类型的，但是如果我们需要int型，double型等，都会帮我们自己转换。</p>\n<p>这里需要注意一点，在使用struts2中的日期自动转型时，表单中的日期字符串的格式是固定的，必须是2014-12-06，也就是yyyy-mm-dd这样的格式，其他格式的话，不能够转型成功，这对有些人来说，就有些不舒服，使用习惯不一样，但是没关系，struts2能够让我们自定义类型转换器，格式让我们自己来决定。</p>\n<p>例如：表单输入<strong>2013-12-23</strong>，接收date为<strong>Tue Dec 23 00:00:00 CST 2014</strong></p>\n<h3 id=\"自定义类型转换器\"><a href=\"#自定义类型转换器\" class=\"headerlink\" title=\"自定义类型转换器\"></a>自定义类型转换器</h3><ol>\n<li><p>编写转换器类继承StrutsTypeConverter,实现两个抽象方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DateConverter</span> <span class=\"keyword\">extends</span> <span class=\"title\">StrutsTypeConverter</span></span>&#123;</div><div class=\"line\">    </div><div class=\"line\">    SimpleDateFormat sdf = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">\"yyyy-MM-dd\"</span>);</div><div class=\"line\">    <span class=\"comment\">/* </span></div><div class=\"line\">     * context:struts2的数据中心</div><div class=\"line\">     * values:输入的数据</div><div class=\"line\">     * toClass:要转换成的类型</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">convertFromString</span><span class=\"params\">(Map context, String[] values, Class toClass)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (values != <span class=\"keyword\">null</span> &amp;&amp; values.length &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            String value = values[<span class=\"number\">0</span>];</div><div class=\"line\">            <span class=\"keyword\">if</span> (toClass == Date.class) &#123;</div><div class=\"line\">                <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                    <span class=\"keyword\">return</span> sdf.parse(value);</div><div class=\"line\">                &#125; <span class=\"keyword\">catch</span> (ParseException e) &#123;</div><div class=\"line\">                    e.printStackTrace();</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">convertToString</span><span class=\"params\">(Map context, Object o)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (o != <span class=\"keyword\">null</span> &amp;&amp; o.getClass() == Date.class) &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> sdf.format(o);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>注册类型转换器</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/conversion.png\" alt=\"转换器位置说明\"></p>\n<p>2.1 注册局部转换器</p>\n<p>在需要转换的Action同级目录，创建一个properties.<br>位置：action类同包<br>名称：actionClass-conversion.properties<br>actionClass:action类的类名<br>conversion.properties：固定名</p>\n<p>文件内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">date = com.topvision.s2sm.plantform.converter.DateConverter</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>2.2 注册全局转换\n\n在src下创建一个properties。\n位置：src\n名称：xwork-conversion.properties 固定写法\n文件内容：\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">java.util.date = com.topvision.s2sm.plantform.converter.DateConverter</div></pre></td></tr></table></figure>\n</code></pre>"},{"title":"Struts2(5)——拦截器","date":"2017-12-21T07:41:25.000Z","_content":"\n## 1、简介\n\nstruts2中很多的核心功能都是拦截器完成的。比如：params(封装动态参数)、staticParams（静态参数封装）、i18n(国际化)、modelDrivern（模型驱动）、servletConfig（注入servletAPI）等。\n<font color=\"red\">作用：在执行动作前或后进行拦截</font>\n<!-- more -->\n\n```xml\n<default-interceptor-ref name=\"defaultStack\"/>\n```\n```xml\n<interceptor-stack name=\"defaultStack\">\n    <interceptor-ref name=\"exception\"/>\n    <interceptor-ref name=\"alias\"/>\n    <interceptor-ref name=\"servletConfig\"/>\n    <interceptor-ref name=\"i18n\"/>\n    <interceptor-ref name=\"prepare\"/>\n    <interceptor-ref name=\"chain\"/>\n    <interceptor-ref name=\"scopedModelDriven\"/>\n    <interceptor-ref name=\"modelDriven\"/>\n    <interceptor-ref name=\"fileUpload\"/>\n    <interceptor-ref name=\"checkbox\"/>\n    <interceptor-ref name=\"datetime\"/>\n    <interceptor-ref name=\"multiselect\"/>\n    <interceptor-ref name=\"staticParams\"/>\n    <interceptor-ref name=\"actionMappingParams\"/>\n    <interceptor-ref name=\"params\"/>\n    <interceptor-ref name=\"conversionError\"/>\n    <interceptor-ref name=\"validation\">\n        <param name=\"excludeMethods\">input,back,cancel,browse</param>\n    </interceptor-ref>\n    <interceptor-ref name=\"workflow\">\n        <param name=\"excludeMethods\">input,back,cancel,browse</param>\n    </interceptor-ref>\n    <interceptor-ref name=\"debugging\"/>\n    <interceptor-ref name=\"deprecation\"/>\n</interceptor-stack>\n```\n\n## 2、运作图\n![此处输入图片的描述][1]\n\n结论：\n    动作方法执行前：拦截器会按照顺序依次进行拦截\n    执行动作方法\n    返回结果视图\n拦截器会按照原来的顺序的相反顺序再次进行拦截\n\n执行过程中：ActionInvocation保存了需要用到的数据\n\n\n## 3、自定义拦截器\n熟悉拦截器的体系：所有的拦截器都直接或间接的实现了Interceptor接口\n\n![此处输入图片的描述][2]\n\n### 3.1 创建拦截器类，继承AbstractInterceptor或实现Interceotor\n\n```java\npublic class MyInterceptor extends AbstractInterceptor {\n\n    private static final long serialVersionUID = -828084112876621948L;\n\n    @Override\n    public String intercept(ActionInvocation invocation) throws Exception {\n        System.out.println(\"MyInterceptor拦截前\");\n        String invoke = invocation.invoke();//放行\n        System.out.println(\"MyInterceptor拦截后\");\n        return invoke;\n    }\n}\n```\n    \n### 3.2 注册拦截器\n\n在struts.xml中注册拦截器，可以针对单个action配置，也可全局配置\n    \n\n 1. 针对单个action配置\n\n    首先在package中声明拦截器\n    ```xml\n    <interceptors>\n    \t\t<interceptor name=\"myInterceptor\" class=\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"></interceptor>\n    </interceptors>\n    ```\n    然后在action中声明引用该拦截器\n    ```xml\n    <action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n\t\t<!-- \n\t\t\t如果没有声明拦截器，默认使用struts-default.xml中的defaultStack\n\t\t\t如果声明了，则defaultStack失效\n\t\t -->\n\t\t<interceptor-ref name=\"myInterceptor\"></interceptor-ref>\n\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t\t<result name=\"input\">/error.jsp</result>\n\t</action>\n    ```\n    但是一般不用这种，因为Struts2有这么一种机制，一旦为Action指定了拦截器，那么就不会再为这个Action执行默认拦截器了，即defaultStack这个拦截器栈中的拦截器都不会执行，也就是说，这个Action没有输入校验、没有参数注入、没有国际化、没有…，这是不行的，所以我们需要在这个<action>元素中再引用defaultStack拦截器栈。\n    \n 2. 全局配置（常用）\n\n    创建一个拦截器栈，包含默认拦截器栈和自定义拦截器。\n\n    ```xml\n    <package name=\"default\" extends=\"struts-default\">\n    \t<interceptors>\n\t    \t<!-- 自定义拦截器 -->\n    \t\t<interceptor name=\"myInterceptor\" class=\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"></interceptor>\n    \t\t<!-- 自定义拦截器栈 -->\n    \t\t<interceptor-stack name=\"myStack\">\n    \t\t\t<interceptor-ref name=\"defaultStack\"/>\n    \t\t\t<interceptor-ref name=\"myInterceptor\"/>\n    \t\t</interceptor-stack>\n    \t</interceptors>\n    \t<!-- 指定默认拦截器 -->\n    \t<default-interceptor-ref name=\"myStack\"></default-interceptor-ref>\n    ```\n\n## 4、MethodFilterInterceptor\n\n是AbstractInterceptor的子类：\nsetIncludeMethods(String includeMethods):设置需要拦截的方法，多个方法用逗号分隔\nsetExcludeMethods(String excludeMethods):设置不需要拦截的方法，多个方法用逗号分隔\n\n \n```java\npublic class MethodInterDemo extends MethodFilterInterceptor{\n\n    private static final long serialVersionUID = -9060068603523571867L;\n    \n    @Override\n    protected String doIntercept(ActionInvocation invocation) throws Exception {\n        //拦截前操作\n        String invoke = invocation.invoke();\n        //拦截后操作\n        return invoke;\n    }\n\n}\n```\n\n配置xml\n```xml\n<package name=\"default\" extends=\"struts-default\">\n\t<interceptors>\n    \t<!-- 自定义拦截器 -->\n\t\t<interceptor name=\"myInterceptor\" class=\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"></interceptor>\n\t\t<interceptor name=\"methodInterceptor\" class=\"com.topvision.s2sm.plantform.interceptor.MethodInterDemo\"></interceptor>\n\t\t\n\t\t<!-- 自定义拦截器栈 -->\n\t\t<interceptor-stack name=\"myStack\">\n\t\t\t<interceptor-ref name=\"defaultStack\"/>\n\t\t\t<interceptor-ref name=\"myInterceptor\"/>\n\t\t\t<interceptor-ref name=\"methodInterceptor\"/>\n\t\t</interceptor-stack>\n\t</interceptors>\n\t<!-- 指定默认拦截器 -->\n\t<default-interceptor-ref name=\"myStack\"></default-interceptor-ref>\n\n</package>\n```\n\n设置指定action\n\n```xml\n<package name=\"login\" namespace=\"/\" extends=\"default\">\n\t<action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n\t\t<interceptor-ref name=\"myStack\">\n\t\t\t<!-- 设置不需要methodInterDemo拦截的方法 -->\n\t\t\t<param name=\"methodInterDemo.excludeMethods\">loginTest</param>\n\t\t\t<!-- 设置需要methodInterDemo拦截的方法 -->\n\t\t\t<param name=\"methodInterDemo.includeMethods\">aaa</param>\n\t\t</interceptor-ref>\n\t\t\n\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t\t<result name=\"input\">/error.jsp</result>\n\t</action>\n</package>\n```\n\n \n\n \n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts2.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/Interceptor.png","source":"_posts/Struts2-5-——拦截器.md","raw":"---\ntitle: Struts2(5)——拦截器\ncategories:\n  - Struts2\ntags:\n  - Struts2\ndate: 2017-12-21 15:41:25\n---\n\n## 1、简介\n\nstruts2中很多的核心功能都是拦截器完成的。比如：params(封装动态参数)、staticParams（静态参数封装）、i18n(国际化)、modelDrivern（模型驱动）、servletConfig（注入servletAPI）等。\n<font color=\"red\">作用：在执行动作前或后进行拦截</font>\n<!-- more -->\n\n```xml\n<default-interceptor-ref name=\"defaultStack\"/>\n```\n```xml\n<interceptor-stack name=\"defaultStack\">\n    <interceptor-ref name=\"exception\"/>\n    <interceptor-ref name=\"alias\"/>\n    <interceptor-ref name=\"servletConfig\"/>\n    <interceptor-ref name=\"i18n\"/>\n    <interceptor-ref name=\"prepare\"/>\n    <interceptor-ref name=\"chain\"/>\n    <interceptor-ref name=\"scopedModelDriven\"/>\n    <interceptor-ref name=\"modelDriven\"/>\n    <interceptor-ref name=\"fileUpload\"/>\n    <interceptor-ref name=\"checkbox\"/>\n    <interceptor-ref name=\"datetime\"/>\n    <interceptor-ref name=\"multiselect\"/>\n    <interceptor-ref name=\"staticParams\"/>\n    <interceptor-ref name=\"actionMappingParams\"/>\n    <interceptor-ref name=\"params\"/>\n    <interceptor-ref name=\"conversionError\"/>\n    <interceptor-ref name=\"validation\">\n        <param name=\"excludeMethods\">input,back,cancel,browse</param>\n    </interceptor-ref>\n    <interceptor-ref name=\"workflow\">\n        <param name=\"excludeMethods\">input,back,cancel,browse</param>\n    </interceptor-ref>\n    <interceptor-ref name=\"debugging\"/>\n    <interceptor-ref name=\"deprecation\"/>\n</interceptor-stack>\n```\n\n## 2、运作图\n![此处输入图片的描述][1]\n\n结论：\n    动作方法执行前：拦截器会按照顺序依次进行拦截\n    执行动作方法\n    返回结果视图\n拦截器会按照原来的顺序的相反顺序再次进行拦截\n\n执行过程中：ActionInvocation保存了需要用到的数据\n\n\n## 3、自定义拦截器\n熟悉拦截器的体系：所有的拦截器都直接或间接的实现了Interceptor接口\n\n![此处输入图片的描述][2]\n\n### 3.1 创建拦截器类，继承AbstractInterceptor或实现Interceotor\n\n```java\npublic class MyInterceptor extends AbstractInterceptor {\n\n    private static final long serialVersionUID = -828084112876621948L;\n\n    @Override\n    public String intercept(ActionInvocation invocation) throws Exception {\n        System.out.println(\"MyInterceptor拦截前\");\n        String invoke = invocation.invoke();//放行\n        System.out.println(\"MyInterceptor拦截后\");\n        return invoke;\n    }\n}\n```\n    \n### 3.2 注册拦截器\n\n在struts.xml中注册拦截器，可以针对单个action配置，也可全局配置\n    \n\n 1. 针对单个action配置\n\n    首先在package中声明拦截器\n    ```xml\n    <interceptors>\n    \t\t<interceptor name=\"myInterceptor\" class=\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"></interceptor>\n    </interceptors>\n    ```\n    然后在action中声明引用该拦截器\n    ```xml\n    <action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n\t\t<!-- \n\t\t\t如果没有声明拦截器，默认使用struts-default.xml中的defaultStack\n\t\t\t如果声明了，则defaultStack失效\n\t\t -->\n\t\t<interceptor-ref name=\"myInterceptor\"></interceptor-ref>\n\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t\t<result name=\"input\">/error.jsp</result>\n\t</action>\n    ```\n    但是一般不用这种，因为Struts2有这么一种机制，一旦为Action指定了拦截器，那么就不会再为这个Action执行默认拦截器了，即defaultStack这个拦截器栈中的拦截器都不会执行，也就是说，这个Action没有输入校验、没有参数注入、没有国际化、没有…，这是不行的，所以我们需要在这个<action>元素中再引用defaultStack拦截器栈。\n    \n 2. 全局配置（常用）\n\n    创建一个拦截器栈，包含默认拦截器栈和自定义拦截器。\n\n    ```xml\n    <package name=\"default\" extends=\"struts-default\">\n    \t<interceptors>\n\t    \t<!-- 自定义拦截器 -->\n    \t\t<interceptor name=\"myInterceptor\" class=\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"></interceptor>\n    \t\t<!-- 自定义拦截器栈 -->\n    \t\t<interceptor-stack name=\"myStack\">\n    \t\t\t<interceptor-ref name=\"defaultStack\"/>\n    \t\t\t<interceptor-ref name=\"myInterceptor\"/>\n    \t\t</interceptor-stack>\n    \t</interceptors>\n    \t<!-- 指定默认拦截器 -->\n    \t<default-interceptor-ref name=\"myStack\"></default-interceptor-ref>\n    ```\n\n## 4、MethodFilterInterceptor\n\n是AbstractInterceptor的子类：\nsetIncludeMethods(String includeMethods):设置需要拦截的方法，多个方法用逗号分隔\nsetExcludeMethods(String excludeMethods):设置不需要拦截的方法，多个方法用逗号分隔\n\n \n```java\npublic class MethodInterDemo extends MethodFilterInterceptor{\n\n    private static final long serialVersionUID = -9060068603523571867L;\n    \n    @Override\n    protected String doIntercept(ActionInvocation invocation) throws Exception {\n        //拦截前操作\n        String invoke = invocation.invoke();\n        //拦截后操作\n        return invoke;\n    }\n\n}\n```\n\n配置xml\n```xml\n<package name=\"default\" extends=\"struts-default\">\n\t<interceptors>\n    \t<!-- 自定义拦截器 -->\n\t\t<interceptor name=\"myInterceptor\" class=\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"></interceptor>\n\t\t<interceptor name=\"methodInterceptor\" class=\"com.topvision.s2sm.plantform.interceptor.MethodInterDemo\"></interceptor>\n\t\t\n\t\t<!-- 自定义拦截器栈 -->\n\t\t<interceptor-stack name=\"myStack\">\n\t\t\t<interceptor-ref name=\"defaultStack\"/>\n\t\t\t<interceptor-ref name=\"myInterceptor\"/>\n\t\t\t<interceptor-ref name=\"methodInterceptor\"/>\n\t\t</interceptor-stack>\n\t</interceptors>\n\t<!-- 指定默认拦截器 -->\n\t<default-interceptor-ref name=\"myStack\"></default-interceptor-ref>\n\n</package>\n```\n\n设置指定action\n\n```xml\n<package name=\"login\" namespace=\"/\" extends=\"default\">\n\t<action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n\t\t<interceptor-ref name=\"myStack\">\n\t\t\t<!-- 设置不需要methodInterDemo拦截的方法 -->\n\t\t\t<param name=\"methodInterDemo.excludeMethods\">loginTest</param>\n\t\t\t<!-- 设置需要methodInterDemo拦截的方法 -->\n\t\t\t<param name=\"methodInterDemo.includeMethods\">aaa</param>\n\t\t</interceptor-ref>\n\t\t\n\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t\t<result name=\"input\">/error.jsp</result>\n\t</action>\n</package>\n```\n\n \n\n \n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts2.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/Interceptor.png","slug":"Struts2-5-——拦截器","published":1,"updated":"2018-02-27T07:38:38.095Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspfj0019n8vfnkrsnods","content":"<h2 id=\"1、简介\"><a href=\"#1、简介\" class=\"headerlink\" title=\"1、简介\"></a>1、简介</h2><p>struts2中很多的核心功能都是拦截器完成的。比如：params(封装动态参数)、staticParams（静态参数封装）、i18n(国际化)、modelDrivern（模型驱动）、servletConfig（注入servletAPI）等。</p>\n<p><font color=\"red\">作用：在执行动作前或后进行拦截</font><br><a id=\"more\"></a></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">default-interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"defaultStack\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">interceptor-stack</span> <span class=\"attr\">name</span>=<span class=\"string\">\"defaultStack\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"exception\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"alias\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"servletConfig\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"i18n\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"prepare\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"chain\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"scopedModelDriven\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"modelDriven\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"fileUpload\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"checkbox\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"datetime\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"multiselect\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"staticParams\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"actionMappingParams\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"params\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"conversionError\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"validation\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"excludeMethods\"</span>&gt;</span>input,back,cancel,browse<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">interceptor-ref</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"workflow\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"excludeMethods\"</span>&gt;</span>input,back,cancel,browse<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">interceptor-ref</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"debugging\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"deprecation\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">interceptor-stack</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"2、运作图\"><a href=\"#2、运作图\" class=\"headerlink\" title=\"2、运作图\"></a>2、运作图</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts2.png\" alt=\"此处输入图片的描述\"></p>\n<p>结论：<br>    动作方法执行前：拦截器会按照顺序依次进行拦截<br>    执行动作方法<br>    返回结果视图<br>拦截器会按照原来的顺序的相反顺序再次进行拦截</p>\n<p>执行过程中：ActionInvocation保存了需要用到的数据</p>\n<h2 id=\"3、自定义拦截器\"><a href=\"#3、自定义拦截器\" class=\"headerlink\" title=\"3、自定义拦截器\"></a>3、自定义拦截器</h2><p>熟悉拦截器的体系：所有的拦截器都直接或间接的实现了Interceptor接口</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/Interceptor.png\" alt=\"此处输入图片的描述\"></p>\n<h3 id=\"3-1-创建拦截器类，继承AbstractInterceptor或实现Interceotor\"><a href=\"#3-1-创建拦截器类，继承AbstractInterceptor或实现Interceotor\" class=\"headerlink\" title=\"3.1 创建拦截器类，继承AbstractInterceptor或实现Interceotor\"></a>3.1 创建拦截器类，继承AbstractInterceptor或实现Interceotor</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyInterceptor</span> <span class=\"keyword\">extends</span> <span class=\"title\">AbstractInterceptor</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">828084112876621948L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">intercept</span><span class=\"params\">(ActionInvocation invocation)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"MyInterceptor拦截前\"</span>);</div><div class=\"line\">        String invoke = invocation.invoke();<span class=\"comment\">//放行</span></div><div class=\"line\">        System.out.println(<span class=\"string\">\"MyInterceptor拦截后\"</span>);</div><div class=\"line\">        <span class=\"keyword\">return</span> invoke;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"3-2-注册拦截器\"><a href=\"#3-2-注册拦截器\" class=\"headerlink\" title=\"3.2 注册拦截器\"></a>3.2 注册拦截器</h3><p>在struts.xml中注册拦截器，可以针对单个action配置，也可全局配置</p>\n<ol>\n<li><p>针对单个action配置</p>\n<p>首先在package中声明拦截器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">interceptors</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>然后在action中声明引用该拦截器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- </span></div><div class=\"line\">\t\t如果没有声明拦截器，默认使用struts-default.xml中的defaultStack</div><div class=\"line\">\t\t如果声明了，则defaultStack失效</div><div class=\"line\">\t --&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor-ref</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">name</span>=<span class=\"string\">\"input\"</span>&gt;</span>/error.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>但是一般不用这种，因为Struts2有这么一种机制，一旦为Action指定了拦截器，那么就不会再为这个Action执行默认拦截器了，即defaultStack这个拦截器栈中的拦截器都不会执行，也就是说，这个Action没有输入校验、没有参数注入、没有国际化、没有…，这是不行的，所以我们需要在这个<action>元素中再引用defaultStack拦截器栈。</action></p>\n</li>\n<li><p>全局配置（常用）</p>\n<p>创建一个拦截器栈，包含默认拦截器栈和自定义拦截器。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"default\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\"> \t<span class=\"comment\">&lt;!-- 自定义拦截器 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 自定义拦截器栈 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-stack</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"defaultStack\"</span>/&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">interceptor-stack</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 指定默认拦截器 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">default-interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">default-interceptor-ref</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"4、MethodFilterInterceptor\"><a href=\"#4、MethodFilterInterceptor\" class=\"headerlink\" title=\"4、MethodFilterInterceptor\"></a>4、MethodFilterInterceptor</h2><p>是AbstractInterceptor的子类：<br>setIncludeMethods(String includeMethods):设置需要拦截的方法，多个方法用逗号分隔<br>setExcludeMethods(String excludeMethods):设置不需要拦截的方法，多个方法用逗号分隔</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MethodInterDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">MethodFilterInterceptor</span></span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">9060068603523571867L</span>;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> String <span class=\"title\">doIntercept</span><span class=\"params\">(ActionInvocation invocation)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//拦截前操作</span></div><div class=\"line\">        String invoke = invocation.invoke();</div><div class=\"line\">        <span class=\"comment\">//拦截后操作</span></div><div class=\"line\">        <span class=\"keyword\">return</span> invoke;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>配置xml<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"default\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\">    \t<span class=\"comment\">&lt;!-- 自定义拦截器 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor</span> <span class=\"attr\">name</span>=<span class=\"string\">\"methodInterceptor\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.plantform.interceptor.MethodInterDemo\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 自定义拦截器栈 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-stack</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"defaultStack\"</span>/&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span>/&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"methodInterceptor\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">interceptor-stack</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 指定默认拦截器 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">default-interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">default-interceptor-ref</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>设置指定action</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"login\"</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"/\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 设置不需要methodInterDemo拦截的方法 --&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"methodInterDemo.excludeMethods\"</span>&gt;</span>loginTest<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 设置需要methodInterDemo拦截的方法 --&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"methodInterDemo.includeMethods\"</span>&gt;</span>aaa<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">interceptor-ref</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">name</span>=<span class=\"string\">\"input\"</span>&gt;</span>/error.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<h2 id=\"1、简介\"><a href=\"#1、简介\" class=\"headerlink\" title=\"1、简介\"></a>1、简介</h2><p>struts2中很多的核心功能都是拦截器完成的。比如：params(封装动态参数)、staticParams（静态参数封装）、i18n(国际化)、modelDrivern（模型驱动）、servletConfig（注入servletAPI）等。</p>\n<p><font color=\"red\">作用：在执行动作前或后进行拦截</font><br>","more":"</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">default-interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"defaultStack\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">interceptor-stack</span> <span class=\"attr\">name</span>=<span class=\"string\">\"defaultStack\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"exception\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"alias\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"servletConfig\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"i18n\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"prepare\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"chain\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"scopedModelDriven\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"modelDriven\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"fileUpload\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"checkbox\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"datetime\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"multiselect\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"staticParams\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"actionMappingParams\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"params\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"conversionError\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"validation\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"excludeMethods\"</span>&gt;</span>input,back,cancel,browse<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">interceptor-ref</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"workflow\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"excludeMethods\"</span>&gt;</span>input,back,cancel,browse<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">interceptor-ref</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"debugging\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"deprecation\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">interceptor-stack</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"2、运作图\"><a href=\"#2、运作图\" class=\"headerlink\" title=\"2、运作图\"></a>2、运作图</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts2.png\" alt=\"此处输入图片的描述\"></p>\n<p>结论：<br>    动作方法执行前：拦截器会按照顺序依次进行拦截<br>    执行动作方法<br>    返回结果视图<br>拦截器会按照原来的顺序的相反顺序再次进行拦截</p>\n<p>执行过程中：ActionInvocation保存了需要用到的数据</p>\n<h2 id=\"3、自定义拦截器\"><a href=\"#3、自定义拦截器\" class=\"headerlink\" title=\"3、自定义拦截器\"></a>3、自定义拦截器</h2><p>熟悉拦截器的体系：所有的拦截器都直接或间接的实现了Interceptor接口</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/Interceptor.png\" alt=\"此处输入图片的描述\"></p>\n<h3 id=\"3-1-创建拦截器类，继承AbstractInterceptor或实现Interceotor\"><a href=\"#3-1-创建拦截器类，继承AbstractInterceptor或实现Interceotor\" class=\"headerlink\" title=\"3.1 创建拦截器类，继承AbstractInterceptor或实现Interceotor\"></a>3.1 创建拦截器类，继承AbstractInterceptor或实现Interceotor</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyInterceptor</span> <span class=\"keyword\">extends</span> <span class=\"title\">AbstractInterceptor</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">828084112876621948L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">intercept</span><span class=\"params\">(ActionInvocation invocation)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"MyInterceptor拦截前\"</span>);</div><div class=\"line\">        String invoke = invocation.invoke();<span class=\"comment\">//放行</span></div><div class=\"line\">        System.out.println(<span class=\"string\">\"MyInterceptor拦截后\"</span>);</div><div class=\"line\">        <span class=\"keyword\">return</span> invoke;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"3-2-注册拦截器\"><a href=\"#3-2-注册拦截器\" class=\"headerlink\" title=\"3.2 注册拦截器\"></a>3.2 注册拦截器</h3><p>在struts.xml中注册拦截器，可以针对单个action配置，也可全局配置</p>\n<ol>\n<li><p>针对单个action配置</p>\n<p>首先在package中声明拦截器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">interceptors</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>然后在action中声明引用该拦截器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- </span></div><div class=\"line\">\t\t如果没有声明拦截器，默认使用struts-default.xml中的defaultStack</div><div class=\"line\">\t\t如果声明了，则defaultStack失效</div><div class=\"line\">\t --&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor-ref</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">name</span>=<span class=\"string\">\"input\"</span>&gt;</span>/error.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>但是一般不用这种，因为Struts2有这么一种机制，一旦为Action指定了拦截器，那么就不会再为这个Action执行默认拦截器了，即defaultStack这个拦截器栈中的拦截器都不会执行，也就是说，这个Action没有输入校验、没有参数注入、没有国际化、没有…，这是不行的，所以我们需要在这个<action>元素中再引用defaultStack拦截器栈。</action></p>\n</li>\n<li><p>全局配置（常用）</p>\n<p>创建一个拦截器栈，包含默认拦截器栈和自定义拦截器。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"default\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\"> \t<span class=\"comment\">&lt;!-- 自定义拦截器 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 自定义拦截器栈 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-stack</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"defaultStack\"</span>/&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">interceptor-stack</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 指定默认拦截器 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">default-interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">default-interceptor-ref</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"4、MethodFilterInterceptor\"><a href=\"#4、MethodFilterInterceptor\" class=\"headerlink\" title=\"4、MethodFilterInterceptor\"></a>4、MethodFilterInterceptor</h2><p>是AbstractInterceptor的子类：<br>setIncludeMethods(String includeMethods):设置需要拦截的方法，多个方法用逗号分隔<br>setExcludeMethods(String excludeMethods):设置不需要拦截的方法，多个方法用逗号分隔</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MethodInterDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">MethodFilterInterceptor</span></span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">9060068603523571867L</span>;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> String <span class=\"title\">doIntercept</span><span class=\"params\">(ActionInvocation invocation)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//拦截前操作</span></div><div class=\"line\">        String invoke = invocation.invoke();</div><div class=\"line\">        <span class=\"comment\">//拦截后操作</span></div><div class=\"line\">        <span class=\"keyword\">return</span> invoke;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>配置xml<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"default\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\">    \t<span class=\"comment\">&lt;!-- 自定义拦截器 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor</span> <span class=\"attr\">name</span>=<span class=\"string\">\"methodInterceptor\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.plantform.interceptor.MethodInterDemo\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 自定义拦截器栈 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-stack</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"defaultStack\"</span>/&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span>/&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"methodInterceptor\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">interceptor-stack</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 指定默认拦截器 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">default-interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">default-interceptor-ref</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>设置指定action</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"login\"</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"/\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 设置不需要methodInterDemo拦截的方法 --&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"methodInterDemo.excludeMethods\"</span>&gt;</span>loginTest<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 设置需要methodInterDemo拦截的方法 --&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"methodInterDemo.includeMethods\"</span>&gt;</span>aaa<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">interceptor-ref</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">name</span>=<span class=\"string\">\"input\"</span>&gt;</span>/error.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div></pre></td></tr></table></figure>"},{"title":"Struts2(6)——Struts标签、国际化、文件上传下载","date":"2017-12-21T12:35:45.000Z","_content":"\nstruts2标签的使用，国际化及文件上传下载。\n<!-- more -->\n## 1、struts标签\n\n[Struts2标签库常用标签][1]\n\n## 2、国际化 \n\nStruts2在ActionSupport中为我们提供了getText()来获取国际化value.\n\n### 2.1 定义资源包\n\n 1. 全局资源\n \n    创建资源文件\n\n        格式：基本名称_语言_国家.properties　\n        例如：resources_zh_CN.properties\n              resources_en_US.properties\n    \n    指定文在所在位置及文件名\n    ```xml\n     <!-- 国际化资源文件路径及名称 -->\n    <constant name=\"struts.custom.i18n.resources\"\n        value=\"com/topvision/s2sm/resources\" />\n    ```\n    \n 2. 包范围\n\n    在包下创建资源文件，不用在xml中指定文件路径\n    \n        文件名：package_zh_CN.properties\n                package_zh_CN.properties\n    \n  3. Action范围\n    \n    在Action同级目录创建资源文件，不用在xml中指定文件路径。\n\n        文件名：ActionName_zh_CN.properties\n        ActionName是对应action的名字\n        \n### 2.2 获取资源包内容\n\n获取国际化\n    \n   \n\n -  Action： this.getText(key)\n -  Jsp: 使用<s:text/>标签， <s:text name=\"key\" />\n -  配置文件:key(直接使用国际化配置文件中的key值即可获得)\n\n自由选择消息资源包\n\n```xml\n<!--自己随意指定消息资源包-->\n<s:i18n name=\"com/topvision/package\">\n    <s:text name=\"key\"></s:text>\n</s:i18n>\n```\n\n## 3、文件上传下载\n\n### 3.1 上传\n\nStruts2上传对表单有要求：\n\n 1. post提交\n 2. 表单的enctype必须为multipart/form-data\n 3. 表单提供如下类型的input\n \n    ```jsp\n    <input type=\"file\" name=\"name\"/>\n    ```\n\nStruts2中如何实现文件上传的：\n\n 1. 借助一个fileUpload拦截器完成的；\n 2. 最底层的还是借助的commons-fileupload这个组件；\n\n\n单文件上传\n\n 1. 准备表单\n\n    ```jsp\n    <form action=\"aaa/upload.tv\" method=\"post\" enctype=\"multipart/form-data\">\n    \t<input type=\"file\" name=\"upload\">\n    \t<button type=\"submit\">上传</button>\n    </form>\n    ```\n    \n 2. action\n\n    ```java\n    private File upload;//input标签的name属性\n    private String uploadFileName; //name属性+FileName\n    private String uploadContentType;//name属性+ContentType\n    \n    public String upload() throws IOException {\n        ServletContext servletContext = ServletActionContext.getServletContext();\n        String realPath = servletContext.getRealPath(\"/WEB-INF/file\");\n        File file = new File(realPath);\n        if (!file.exists()) {\n            file.mkdirs();\n        }\n        \n        /*InputStream is = new FileInputStream(upload);\n        OutputStream os = new FileOutputStream(new File(file, uploadFileName));\n        \n        int len = -1;\n        byte b[] = new byte[1024];\n        while ((len = is.read(b)) != -1) {\n            os.write(b, 0, len);\n        }*/\n        \n        FileUtils.moveFile(upload, new File(file, uploadFileName));\n        \n        is.close();\n        os.close();\n        \n        return SUCCESS;\n    }\n    ```\n\n  3. 配置xml\n\n    ```xml\n    <action name=\"upload\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"upload2\">\n\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t</action>\n    ```\n      \n \n    \n\n\n多文件上传\n\n第一种，比较煞笔的，多写几个上传框\n第二种:使用　uploadify 插件\n \n### 3.2 下载\n\naction配置\n\n```java\nprivate InputStream inputStream;\npublic String download() throws FileNotFoundException {\n    ServletContext servletContext = ServletActionContext.getServletContext();\n    String realPath = servletContext.getRealPath(\"/WEB-INF/web.xml\");\n    inputStream = new FileInputStream(realPath);\n    return SUCCESS;\n}\n\npublic InputStream getInputStream() {\n    return inputStream;\n}\npublic void setInputStream(InputStream inputStream) {\n    this.inputStream = inputStream;\n}\n```\n\nxml配置\n\n```xml\n<result name=\"success\" type=\"stream\">\n\t<!-- 设置输入流来源 -->\n\t<param name=\"inputstream\">inputstream</param>\n\t<!-- 响应头 -->\n\t<param name=\"contentDisposition\">attachment;filename=web.xml</param>\n\t<!-- 传的什么类型数据，在tomcat的web.xml中有定义 -->\n\t<param name=\"contentType\">application/xml</param>\t\n\t<!-- 下载缓存 ,默认1024-->\t\t\t\n\t<param name=\"bufferSize\">10240</param>\n\t<!-- 下载文件大小 -->\n\t<param name=\"contentLength\">10240</param>\n</result>\n```\n\n   \n \n  [1]: http://blog.csdn.net/q547550831/article/details/53326042\n\n\n\n\n","source":"_posts/Struts2-6-——Struts标签、国际化、文件上传下载.md","raw":"---\ntitle: Struts2(6)——Struts标签、国际化、文件上传下载\ncategories:\n  - Struts2\ntags:\n  - Struts2\ndate: 2017-12-21 20:35:45\n---\n\nstruts2标签的使用，国际化及文件上传下载。\n<!-- more -->\n## 1、struts标签\n\n[Struts2标签库常用标签][1]\n\n## 2、国际化 \n\nStruts2在ActionSupport中为我们提供了getText()来获取国际化value.\n\n### 2.1 定义资源包\n\n 1. 全局资源\n \n    创建资源文件\n\n        格式：基本名称_语言_国家.properties　\n        例如：resources_zh_CN.properties\n              resources_en_US.properties\n    \n    指定文在所在位置及文件名\n    ```xml\n     <!-- 国际化资源文件路径及名称 -->\n    <constant name=\"struts.custom.i18n.resources\"\n        value=\"com/topvision/s2sm/resources\" />\n    ```\n    \n 2. 包范围\n\n    在包下创建资源文件，不用在xml中指定文件路径\n    \n        文件名：package_zh_CN.properties\n                package_zh_CN.properties\n    \n  3. Action范围\n    \n    在Action同级目录创建资源文件，不用在xml中指定文件路径。\n\n        文件名：ActionName_zh_CN.properties\n        ActionName是对应action的名字\n        \n### 2.2 获取资源包内容\n\n获取国际化\n    \n   \n\n -  Action： this.getText(key)\n -  Jsp: 使用<s:text/>标签， <s:text name=\"key\" />\n -  配置文件:key(直接使用国际化配置文件中的key值即可获得)\n\n自由选择消息资源包\n\n```xml\n<!--自己随意指定消息资源包-->\n<s:i18n name=\"com/topvision/package\">\n    <s:text name=\"key\"></s:text>\n</s:i18n>\n```\n\n## 3、文件上传下载\n\n### 3.1 上传\n\nStruts2上传对表单有要求：\n\n 1. post提交\n 2. 表单的enctype必须为multipart/form-data\n 3. 表单提供如下类型的input\n \n    ```jsp\n    <input type=\"file\" name=\"name\"/>\n    ```\n\nStruts2中如何实现文件上传的：\n\n 1. 借助一个fileUpload拦截器完成的；\n 2. 最底层的还是借助的commons-fileupload这个组件；\n\n\n单文件上传\n\n 1. 准备表单\n\n    ```jsp\n    <form action=\"aaa/upload.tv\" method=\"post\" enctype=\"multipart/form-data\">\n    \t<input type=\"file\" name=\"upload\">\n    \t<button type=\"submit\">上传</button>\n    </form>\n    ```\n    \n 2. action\n\n    ```java\n    private File upload;//input标签的name属性\n    private String uploadFileName; //name属性+FileName\n    private String uploadContentType;//name属性+ContentType\n    \n    public String upload() throws IOException {\n        ServletContext servletContext = ServletActionContext.getServletContext();\n        String realPath = servletContext.getRealPath(\"/WEB-INF/file\");\n        File file = new File(realPath);\n        if (!file.exists()) {\n            file.mkdirs();\n        }\n        \n        /*InputStream is = new FileInputStream(upload);\n        OutputStream os = new FileOutputStream(new File(file, uploadFileName));\n        \n        int len = -1;\n        byte b[] = new byte[1024];\n        while ((len = is.read(b)) != -1) {\n            os.write(b, 0, len);\n        }*/\n        \n        FileUtils.moveFile(upload, new File(file, uploadFileName));\n        \n        is.close();\n        os.close();\n        \n        return SUCCESS;\n    }\n    ```\n\n  3. 配置xml\n\n    ```xml\n    <action name=\"upload\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"upload2\">\n\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t</action>\n    ```\n      \n \n    \n\n\n多文件上传\n\n第一种，比较煞笔的，多写几个上传框\n第二种:使用　uploadify 插件\n \n### 3.2 下载\n\naction配置\n\n```java\nprivate InputStream inputStream;\npublic String download() throws FileNotFoundException {\n    ServletContext servletContext = ServletActionContext.getServletContext();\n    String realPath = servletContext.getRealPath(\"/WEB-INF/web.xml\");\n    inputStream = new FileInputStream(realPath);\n    return SUCCESS;\n}\n\npublic InputStream getInputStream() {\n    return inputStream;\n}\npublic void setInputStream(InputStream inputStream) {\n    this.inputStream = inputStream;\n}\n```\n\nxml配置\n\n```xml\n<result name=\"success\" type=\"stream\">\n\t<!-- 设置输入流来源 -->\n\t<param name=\"inputstream\">inputstream</param>\n\t<!-- 响应头 -->\n\t<param name=\"contentDisposition\">attachment;filename=web.xml</param>\n\t<!-- 传的什么类型数据，在tomcat的web.xml中有定义 -->\n\t<param name=\"contentType\">application/xml</param>\t\n\t<!-- 下载缓存 ,默认1024-->\t\t\t\n\t<param name=\"bufferSize\">10240</param>\n\t<!-- 下载文件大小 -->\n\t<param name=\"contentLength\">10240</param>\n</result>\n```\n\n   \n \n  [1]: http://blog.csdn.net/q547550831/article/details/53326042\n\n\n\n\n","slug":"Struts2-6-——Struts标签、国际化、文件上传下载","published":1,"updated":"2018-02-27T07:38:38.096Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspfo001dn8vf23unqrcr","content":"<p>struts2标签的使用，国际化及文件上传下载。<br><a id=\"more\"></a></p>\n<h2 id=\"1、struts标签\"><a href=\"#1、struts标签\" class=\"headerlink\" title=\"1、struts标签\"></a>1、struts标签</h2><p><a href=\"http://blog.csdn.net/q547550831/article/details/53326042\" target=\"_blank\" rel=\"noopener\">Struts2标签库常用标签</a></p>\n<h2 id=\"2、国际化\"><a href=\"#2、国际化\" class=\"headerlink\" title=\"2、国际化\"></a>2、国际化</h2><p>Struts2在ActionSupport中为我们提供了getText()来获取国际化value.</p>\n<h3 id=\"2-1-定义资源包\"><a href=\"#2-1-定义资源包\" class=\"headerlink\" title=\"2.1 定义资源包\"></a>2.1 定义资源包</h3><ol>\n<li><p>全局资源</p>\n<p>创建资源文件</p>\n<pre><code>格式：基本名称_语言_国家.properties　\n例如：resources_zh_CN.properties\n      resources_en_US.properties\n</code></pre><p>指定文在所在位置及文件名</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"comment\">&lt;!-- 国际化资源文件路径及名称 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.custom.i18n.resources\"</span></span></div><div class=\"line\">    <span class=\"attr\">value</span>=<span class=\"string\">\"com/topvision/s2sm/resources\"</span> /&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>包范围</p>\n<p>在包下创建资源文件，不用在xml中指定文件路径</p>\n<pre><code>文件名：package_zh_CN.properties\n        package_zh_CN.properties\n</code></pre><ol>\n<li>Action范围</li>\n</ol>\n<p>在Action同级目录创建资源文件，不用在xml中指定文件路径。</p>\n<pre><code>文件名：ActionName_zh_CN.properties\nActionName是对应action的名字\n</code></pre></li>\n</ol>\n<h3 id=\"2-2-获取资源包内容\"><a href=\"#2-2-获取资源包内容\" class=\"headerlink\" title=\"2.2 获取资源包内容\"></a>2.2 获取资源包内容</h3><p>获取国际化</p>\n<ul>\n<li>Action： this.getText(key)</li>\n<li>Jsp: 使用<s:text>标签， <s:text name=\"key\"></s:text></s:text></li>\n<li>配置文件:key(直接使用国际化配置文件中的key值即可获得)</li>\n</ul>\n<p>自由选择消息资源包</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--自己随意指定消息资源包--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">s:i18n</span> <span class=\"attr\">name</span>=<span class=\"string\">\"com/topvision/package\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">s:text</span> <span class=\"attr\">name</span>=<span class=\"string\">\"key\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">s:text</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">s:i18n</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"3、文件上传下载\"><a href=\"#3、文件上传下载\" class=\"headerlink\" title=\"3、文件上传下载\"></a>3、文件上传下载</h2><h3 id=\"3-1-上传\"><a href=\"#3-1-上传\" class=\"headerlink\" title=\"3.1 上传\"></a>3.1 上传</h3><p>Struts2上传对表单有要求：</p>\n<ol>\n<li>post提交</li>\n<li>表单的enctype必须为multipart/form-data</li>\n<li><p>表单提供如下类型的input</p>\n<figure class=\"highlight jsp\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;input type=<span class=\"string\">\"file\"</span> name=<span class=\"string\">\"name\"</span>/&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>Struts2中如何实现文件上传的：</p>\n<ol>\n<li>借助一个fileUpload拦截器完成的；</li>\n<li>最底层的还是借助的commons-fileupload这个组件；</li>\n</ol>\n<p>单文件上传</p>\n<ol>\n<li><p>准备表单</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;form action=\"aaa/upload.tv\" method=\"post\" enctype=\"multipart/form-data\"&gt;</div><div class=\"line\">\t&lt;input type=\"file\" name=\"upload\"&gt;</div><div class=\"line\">\t&lt;button type=\"submit\"&gt;上传&lt;/button&gt;</div><div class=\"line\">&lt;/form&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>action</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> File upload;<span class=\"comment\">//input标签的name属性</span></div><div class=\"line\"><span class=\"keyword\">private</span> String uploadFileName; <span class=\"comment\">//name属性+FileName</span></div><div class=\"line\"><span class=\"keyword\">private</span> String uploadContentType;<span class=\"comment\">//name属性+ContentType</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">upload</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</div><div class=\"line\">    ServletContext servletContext = ServletActionContext.getServletContext();</div><div class=\"line\">    String realPath = servletContext.getRealPath(<span class=\"string\">\"/WEB-INF/file\"</span>);</div><div class=\"line\">    File file = <span class=\"keyword\">new</span> File(realPath);</div><div class=\"line\">    <span class=\"keyword\">if</span> (!file.exists()) &#123;</div><div class=\"line\">        file.mkdirs();</div><div class=\"line\">    &#125;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"comment\">/*InputStream is = new FileInputStream(upload);</span></div><div class=\"line\">    OutputStream os = new FileOutputStream(new File(file, uploadFileName));</div><div class=\"line\">    </div><div class=\"line\">    int len = -1;</div><div class=\"line\">    byte b[] = new byte[1024];</div><div class=\"line\">    while ((len = is.read(b)) != -1) &#123;</div><div class=\"line\">        os.write(b, 0, len);</div><div class=\"line\">    &#125;*/</div><div class=\"line\">    </div><div class=\"line\">    FileUtils.moveFile(upload, <span class=\"keyword\">new</span> File(file, uploadFileName));</div><div class=\"line\">    </div><div class=\"line\">    is.close();</div><div class=\"line\">    os.close();</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">return</span> SUCCESS;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<ol>\n<li>配置xml</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"upload\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"upload2\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>多文件上传</p>\n<p>第一种，比较煞笔的，多写几个上传框<br>第二种:使用　uploadify 插件</p>\n<h3 id=\"3-2-下载\"><a href=\"#3-2-下载\" class=\"headerlink\" title=\"3.2 下载\"></a>3.2 下载</h3><p>action配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> InputStream inputStream;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">download</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> FileNotFoundException </span>&#123;</div><div class=\"line\">    ServletContext servletContext = ServletActionContext.getServletContext();</div><div class=\"line\">    String realPath = servletContext.getRealPath(<span class=\"string\">\"/WEB-INF/web.xml\"</span>);</div><div class=\"line\">    inputStream = <span class=\"keyword\">new</span> FileInputStream(realPath);</div><div class=\"line\">    <span class=\"keyword\">return</span> SUCCESS;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> InputStream <span class=\"title\">getInputStream</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> inputStream;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setInputStream</span><span class=\"params\">(InputStream inputStream)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.inputStream = inputStream;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>xml配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">name</span>=<span class=\"string\">\"success\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"stream\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 设置输入流来源 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"inputstream\"</span>&gt;</span>inputstream<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 响应头 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"contentDisposition\"</span>&gt;</span>attachment;filename=web.xml<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 传的什么类型数据，在tomcat的web.xml中有定义 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"contentType\"</span>&gt;</span>application/xml<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span>\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 下载缓存 ,默认1024--&gt;</span>\t\t\t</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"bufferSize\"</span>&gt;</span>10240<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 下载文件大小 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"contentLength\"</span>&gt;</span>10240<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>struts2标签的使用，国际化及文件上传下载。<br>","more":"</p>\n<h2 id=\"1、struts标签\"><a href=\"#1、struts标签\" class=\"headerlink\" title=\"1、struts标签\"></a>1、struts标签</h2><p><a href=\"http://blog.csdn.net/q547550831/article/details/53326042\" target=\"_blank\" rel=\"noopener\">Struts2标签库常用标签</a></p>\n<h2 id=\"2、国际化\"><a href=\"#2、国际化\" class=\"headerlink\" title=\"2、国际化\"></a>2、国际化</h2><p>Struts2在ActionSupport中为我们提供了getText()来获取国际化value.</p>\n<h3 id=\"2-1-定义资源包\"><a href=\"#2-1-定义资源包\" class=\"headerlink\" title=\"2.1 定义资源包\"></a>2.1 定义资源包</h3><ol>\n<li><p>全局资源</p>\n<p>创建资源文件</p>\n<pre><code>格式：基本名称_语言_国家.properties　\n例如：resources_zh_CN.properties\n      resources_en_US.properties\n</code></pre><p>指定文在所在位置及文件名</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"comment\">&lt;!-- 国际化资源文件路径及名称 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.custom.i18n.resources\"</span></span></div><div class=\"line\">    <span class=\"attr\">value</span>=<span class=\"string\">\"com/topvision/s2sm/resources\"</span> /&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>包范围</p>\n<p>在包下创建资源文件，不用在xml中指定文件路径</p>\n<pre><code>文件名：package_zh_CN.properties\n        package_zh_CN.properties\n</code></pre><ol>\n<li>Action范围</li>\n</ol>\n<p>在Action同级目录创建资源文件，不用在xml中指定文件路径。</p>\n<pre><code>文件名：ActionName_zh_CN.properties\nActionName是对应action的名字\n</code></pre></li>\n</ol>\n<h3 id=\"2-2-获取资源包内容\"><a href=\"#2-2-获取资源包内容\" class=\"headerlink\" title=\"2.2 获取资源包内容\"></a>2.2 获取资源包内容</h3><p>获取国际化</p>\n<ul>\n<li>Action： this.getText(key)</li>\n<li>Jsp: 使用<s:text>标签， <s:text name=\"key\"></s:text></s:text></li>\n<li>配置文件:key(直接使用国际化配置文件中的key值即可获得)</li>\n</ul>\n<p>自由选择消息资源包</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--自己随意指定消息资源包--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">s:i18n</span> <span class=\"attr\">name</span>=<span class=\"string\">\"com/topvision/package\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">s:text</span> <span class=\"attr\">name</span>=<span class=\"string\">\"key\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">s:text</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">s:i18n</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"3、文件上传下载\"><a href=\"#3、文件上传下载\" class=\"headerlink\" title=\"3、文件上传下载\"></a>3、文件上传下载</h2><h3 id=\"3-1-上传\"><a href=\"#3-1-上传\" class=\"headerlink\" title=\"3.1 上传\"></a>3.1 上传</h3><p>Struts2上传对表单有要求：</p>\n<ol>\n<li>post提交</li>\n<li>表单的enctype必须为multipart/form-data</li>\n<li><p>表单提供如下类型的input</p>\n<figure class=\"highlight jsp\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;input type=<span class=\"string\">\"file\"</span> name=<span class=\"string\">\"name\"</span>/&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>Struts2中如何实现文件上传的：</p>\n<ol>\n<li>借助一个fileUpload拦截器完成的；</li>\n<li>最底层的还是借助的commons-fileupload这个组件；</li>\n</ol>\n<p>单文件上传</p>\n<ol>\n<li><p>准备表单</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;form action=\"aaa/upload.tv\" method=\"post\" enctype=\"multipart/form-data\"&gt;</div><div class=\"line\">\t&lt;input type=\"file\" name=\"upload\"&gt;</div><div class=\"line\">\t&lt;button type=\"submit\"&gt;上传&lt;/button&gt;</div><div class=\"line\">&lt;/form&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>action</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> File upload;<span class=\"comment\">//input标签的name属性</span></div><div class=\"line\"><span class=\"keyword\">private</span> String uploadFileName; <span class=\"comment\">//name属性+FileName</span></div><div class=\"line\"><span class=\"keyword\">private</span> String uploadContentType;<span class=\"comment\">//name属性+ContentType</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">upload</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</div><div class=\"line\">    ServletContext servletContext = ServletActionContext.getServletContext();</div><div class=\"line\">    String realPath = servletContext.getRealPath(<span class=\"string\">\"/WEB-INF/file\"</span>);</div><div class=\"line\">    File file = <span class=\"keyword\">new</span> File(realPath);</div><div class=\"line\">    <span class=\"keyword\">if</span> (!file.exists()) &#123;</div><div class=\"line\">        file.mkdirs();</div><div class=\"line\">    &#125;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"comment\">/*InputStream is = new FileInputStream(upload);</span></div><div class=\"line\">    OutputStream os = new FileOutputStream(new File(file, uploadFileName));</div><div class=\"line\">    </div><div class=\"line\">    int len = -1;</div><div class=\"line\">    byte b[] = new byte[1024];</div><div class=\"line\">    while ((len = is.read(b)) != -1) &#123;</div><div class=\"line\">        os.write(b, 0, len);</div><div class=\"line\">    &#125;*/</div><div class=\"line\">    </div><div class=\"line\">    FileUtils.moveFile(upload, <span class=\"keyword\">new</span> File(file, uploadFileName));</div><div class=\"line\">    </div><div class=\"line\">    is.close();</div><div class=\"line\">    os.close();</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">return</span> SUCCESS;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<ol>\n<li>配置xml</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"upload\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"upload2\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>多文件上传</p>\n<p>第一种，比较煞笔的，多写几个上传框<br>第二种:使用　uploadify 插件</p>\n<h3 id=\"3-2-下载\"><a href=\"#3-2-下载\" class=\"headerlink\" title=\"3.2 下载\"></a>3.2 下载</h3><p>action配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> InputStream inputStream;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">download</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> FileNotFoundException </span>&#123;</div><div class=\"line\">    ServletContext servletContext = ServletActionContext.getServletContext();</div><div class=\"line\">    String realPath = servletContext.getRealPath(<span class=\"string\">\"/WEB-INF/web.xml\"</span>);</div><div class=\"line\">    inputStream = <span class=\"keyword\">new</span> FileInputStream(realPath);</div><div class=\"line\">    <span class=\"keyword\">return</span> SUCCESS;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> InputStream <span class=\"title\">getInputStream</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> inputStream;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setInputStream</span><span class=\"params\">(InputStream inputStream)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.inputStream = inputStream;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>xml配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">name</span>=<span class=\"string\">\"success\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"stream\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 设置输入流来源 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"inputstream\"</span>&gt;</span>inputstream<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 响应头 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"contentDisposition\"</span>&gt;</span>attachment;filename=web.xml<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 传的什么类型数据，在tomcat的web.xml中有定义 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"contentType\"</span>&gt;</span>application/xml<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span>\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 下载缓存 ,默认1024--&gt;</span>\t\t\t</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"bufferSize\"</span>&gt;</span>10240<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 下载文件大小 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"contentLength\"</span>&gt;</span>10240<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div></pre></td></tr></table></figure>"},{"title":"hexo+github搭建个人博客","date":"2017-04-27T10:54:43.000Z","_content":"## 1.前言\n使用github pages服务搭建博客的好处有：\n1.全是静态文件，访问速度快；\n2.免费方便，不用花一分钱就可以搭建一个自由的个人博客，不需要服务器不需要后台；\n3.可以随意绑定自己的域名，不仔细看的话根本看不出来你的网站是基于github的；\n4.数据绝对安全，基于github的版本管理，想恢复到哪个历史版本都行；\n5.博客内容可以轻松打包、转移、发布到其它平台；\n<!-- more -->\n6.等等；\n\n### 1.1准备工作\n\n - 创建github账号       [github注册地址](https://github.com/)\n - 安装node.js、npm     [node.js下载地址](https://nodejs.org/en/download/)\n - 安装git for windows  [git下载地址](https://git-scm.com/downloads)\n \n**本文所使用的环境**\n - windows10\n - git@1.9.5\n - node.js@6.10.2\n - hexo@\n\n## 2.搭建github博客\n### 2.1创建仓库\n登陆github,打开新建页面，如图![步骤一](/images/blog/newRepository.png)\n![步骤二](/images/blog/step2.png)\n新建仓库名必须为**你的用户名.github.io**,假如说你的用户名是test,那仓库名为test.github.io,将来的博客访问地址就是http://test.github.io 了，是不是很方便？\n由此可见，每一个github账户最多只能创建一个这样可以直接使用域名访问的仓库。\n**几个注意的地方：**\n1.注册的邮箱一定要验证，否则不会成功；\n2.仓库名字必须是：username.github.io，其中username是你的用户名；\n3.仓库创建成功不会立即生效，需要过一段时间，大概10-30分钟，或者更久\n###2.2绑定域名\n这一步不是必须，若不绑定则可用默认的http://xxx.github.io来访问，若想自己拥有一个域名，则需要注册，这一步留待以后再将，直接下一步。\n## 3.配置SSH key\n为什么要配置这个呢？因为你提交代码肯定要拥有你的github权限才可以，但是直接使用用户名和密码太不安全了，所以我们使用ssh key来解决本地和服务器的连接问题。\n在电脑任意位置进入**git bash**\n`$ cd ~/. ssh #检查本机已存在的ssh密钥` \n如果提示：No such file or directory 说明你是第一次使用git\n`ssh-keygen -t rsa -C \"邮件地址\"`\n然后连续3次回车，最终会生成一个文件在用户目录下，打开用户目录，找到**.ssh\\id_rsa.pub**文件，文本编辑器打开并复制里面的内容，打开你的github主页，进入个人设置 -> SSH and GPG keys -> New SSH key：将刚复制的内容粘贴到key那里，title随便填，保存。\n![步骤三](/images/blog/step3.png)\n**测试是否设置成功**\n`$ ssh -T git@github.com # 注意邮箱地址不用改`\n如果提示Are you sure you want to continue connecting (yes/no)?，输入yes，然后会看到：\n\nHi xiaoyue! You've successfully authenticated, but GitHub does not provide shell access.\n\n看到这个信息说明SSH已配置成功！\n此时你还需要配置：\n```bash\n$ git config --global user.name \"liuxianan\"// 你的github用户名，非昵称\n$ git config --global user.email  \"xxx@qq.com\"// 填写你的github注册邮箱\n```\n\n## 4.使用hexo写博客\n### 4.1hexo简介\nHexo是一个简单、快速、强大的基于 Github Pages 的博客发布工具，支持Markdown格式，有众多优秀插件和主题。\n\n官网： http://hexo.io\ngithub: https://github.com/hexojs/hexo\n###4.2原理\n由于github pages存放的都是静态文件，博客存放的不只是文章内容，还有文章列表、分类、标签、翻页等动态内容，假如每次写完一篇文章都要手动更新博文目录和相关链接信息，相信谁都会疯掉，所以hexo所做的就是将这些md文件都放在本地，每次写完文章后调用写好的命令来批量完成相关页面的生成，然后再将有改动的页面提交到github。\n\n**注意事项**\n\n 1. 很多命令既可以用Windows的cmd来完成，也可以使用git bash来完成，但是部分命令会有一些问题，为避免不必要的问题，建议全部使用git bash来执行；\n 2. hexo不同版本差别比较大，网上很多文章的配置信息都是基于2.x的，所以注意不要被误导；\n 3. hexo有2种_config.yml文件，一个是根目录下的全局的_config.yml，一个是各个theme下的；\n\n**安装hexo**\n`$ npm install -g hexo`\n若上面的命令失败，建议使用下面的代理命令\n`此处输入代码`\n\n**初始化**\n在电脑的某个地方新建一个名为hexo的文件夹（名字可以随便取），比如我的是*F:\\Workspaces\\hexo*，由于这个文件夹将来就作为你存放代码的地方，所以最好不要随便放。\n`$ cd /f/Workspaces/hexo/`\n`$ hexo init`\nhexo会自动下载一些文件到这个目录，包括node_modules。继续执行下面两条命令\n`$ hexo g # 生成`\n`$ hexo s # 启动服务`\n执行以上命令之后，hexo就会在public文件夹生成相关html文件，这些文件将来都是要提交到github去的。\n\n**hexo s**是开启本地预览服务，打开浏览器访问 http://localhost:4000 即可看到内容，很多人会碰到浏览器一直在转圈但是就是加载不出来的问题，一般情况下是因为端口占用的缘故，因为4000这个端口太常见了，解决端口冲突问题请参考这篇文章：\n\nhttp://blog.liuxianan.com/windows-port-bind.html\n\n第一次初始化的时候hexo已经帮我们写了一篇名为 Hello World 的文章，默认的主题比较丑。\n\n## 5.配置主题\n### 5.1更换主题\n既然默认主题很丑，那我们别的不做，首先来替换一个好看点的主题。这是 [官方主题](https://hexo.io/themes/)。\n个人比较喜欢的主题：[hexo-theme-next](https://github.com/iissnan/hexo-theme-next) 和[hexo-theme-yilia](https://github.com/litten/hexo-theme-yilia)\n以next主题为例，首先clone这个主题：\n\n进入之前建立的hexo目录，在git bash中执行clone命令\n\n`$ git clone https://github.com/iissnan/hexo-theme-next.git themes/next`\n\n下载的主题到了hexo>theme文件夹下。\n修改##hexo##根目录下的**_config.yml**文件中的**theme: landscape**改为**theme: yilia**，然后重新执行**hexo g**来重新生成静态文件，**hexo s**部署到本地，**localhost:4000**预览博客效果。\n\n如果出现一些莫名其妙的问题，可以先执行**hexo clean**来清理一下public的内容，然后再来重新生成和发布。\n\n","source":"_posts/hexo+github搭建个人博客.md","raw":"---\ntitle: hexo+github搭建个人博客\ndate: 2017-04-27 18:54:43\ncategories:\n\t- 杂七杂八\ntags:\n\t- github\n\t- hexo\n\t- next\n---\n## 1.前言\n使用github pages服务搭建博客的好处有：\n1.全是静态文件，访问速度快；\n2.免费方便，不用花一分钱就可以搭建一个自由的个人博客，不需要服务器不需要后台；\n3.可以随意绑定自己的域名，不仔细看的话根本看不出来你的网站是基于github的；\n4.数据绝对安全，基于github的版本管理，想恢复到哪个历史版本都行；\n5.博客内容可以轻松打包、转移、发布到其它平台；\n<!-- more -->\n6.等等；\n\n### 1.1准备工作\n\n - 创建github账号       [github注册地址](https://github.com/)\n - 安装node.js、npm     [node.js下载地址](https://nodejs.org/en/download/)\n - 安装git for windows  [git下载地址](https://git-scm.com/downloads)\n \n**本文所使用的环境**\n - windows10\n - git@1.9.5\n - node.js@6.10.2\n - hexo@\n\n## 2.搭建github博客\n### 2.1创建仓库\n登陆github,打开新建页面，如图![步骤一](/images/blog/newRepository.png)\n![步骤二](/images/blog/step2.png)\n新建仓库名必须为**你的用户名.github.io**,假如说你的用户名是test,那仓库名为test.github.io,将来的博客访问地址就是http://test.github.io 了，是不是很方便？\n由此可见，每一个github账户最多只能创建一个这样可以直接使用域名访问的仓库。\n**几个注意的地方：**\n1.注册的邮箱一定要验证，否则不会成功；\n2.仓库名字必须是：username.github.io，其中username是你的用户名；\n3.仓库创建成功不会立即生效，需要过一段时间，大概10-30分钟，或者更久\n###2.2绑定域名\n这一步不是必须，若不绑定则可用默认的http://xxx.github.io来访问，若想自己拥有一个域名，则需要注册，这一步留待以后再将，直接下一步。\n## 3.配置SSH key\n为什么要配置这个呢？因为你提交代码肯定要拥有你的github权限才可以，但是直接使用用户名和密码太不安全了，所以我们使用ssh key来解决本地和服务器的连接问题。\n在电脑任意位置进入**git bash**\n`$ cd ~/. ssh #检查本机已存在的ssh密钥` \n如果提示：No such file or directory 说明你是第一次使用git\n`ssh-keygen -t rsa -C \"邮件地址\"`\n然后连续3次回车，最终会生成一个文件在用户目录下，打开用户目录，找到**.ssh\\id_rsa.pub**文件，文本编辑器打开并复制里面的内容，打开你的github主页，进入个人设置 -> SSH and GPG keys -> New SSH key：将刚复制的内容粘贴到key那里，title随便填，保存。\n![步骤三](/images/blog/step3.png)\n**测试是否设置成功**\n`$ ssh -T git@github.com # 注意邮箱地址不用改`\n如果提示Are you sure you want to continue connecting (yes/no)?，输入yes，然后会看到：\n\nHi xiaoyue! You've successfully authenticated, but GitHub does not provide shell access.\n\n看到这个信息说明SSH已配置成功！\n此时你还需要配置：\n```bash\n$ git config --global user.name \"liuxianan\"// 你的github用户名，非昵称\n$ git config --global user.email  \"xxx@qq.com\"// 填写你的github注册邮箱\n```\n\n## 4.使用hexo写博客\n### 4.1hexo简介\nHexo是一个简单、快速、强大的基于 Github Pages 的博客发布工具，支持Markdown格式，有众多优秀插件和主题。\n\n官网： http://hexo.io\ngithub: https://github.com/hexojs/hexo\n###4.2原理\n由于github pages存放的都是静态文件，博客存放的不只是文章内容，还有文章列表、分类、标签、翻页等动态内容，假如每次写完一篇文章都要手动更新博文目录和相关链接信息，相信谁都会疯掉，所以hexo所做的就是将这些md文件都放在本地，每次写完文章后调用写好的命令来批量完成相关页面的生成，然后再将有改动的页面提交到github。\n\n**注意事项**\n\n 1. 很多命令既可以用Windows的cmd来完成，也可以使用git bash来完成，但是部分命令会有一些问题，为避免不必要的问题，建议全部使用git bash来执行；\n 2. hexo不同版本差别比较大，网上很多文章的配置信息都是基于2.x的，所以注意不要被误导；\n 3. hexo有2种_config.yml文件，一个是根目录下的全局的_config.yml，一个是各个theme下的；\n\n**安装hexo**\n`$ npm install -g hexo`\n若上面的命令失败，建议使用下面的代理命令\n`此处输入代码`\n\n**初始化**\n在电脑的某个地方新建一个名为hexo的文件夹（名字可以随便取），比如我的是*F:\\Workspaces\\hexo*，由于这个文件夹将来就作为你存放代码的地方，所以最好不要随便放。\n`$ cd /f/Workspaces/hexo/`\n`$ hexo init`\nhexo会自动下载一些文件到这个目录，包括node_modules。继续执行下面两条命令\n`$ hexo g # 生成`\n`$ hexo s # 启动服务`\n执行以上命令之后，hexo就会在public文件夹生成相关html文件，这些文件将来都是要提交到github去的。\n\n**hexo s**是开启本地预览服务，打开浏览器访问 http://localhost:4000 即可看到内容，很多人会碰到浏览器一直在转圈但是就是加载不出来的问题，一般情况下是因为端口占用的缘故，因为4000这个端口太常见了，解决端口冲突问题请参考这篇文章：\n\nhttp://blog.liuxianan.com/windows-port-bind.html\n\n第一次初始化的时候hexo已经帮我们写了一篇名为 Hello World 的文章，默认的主题比较丑。\n\n## 5.配置主题\n### 5.1更换主题\n既然默认主题很丑，那我们别的不做，首先来替换一个好看点的主题。这是 [官方主题](https://hexo.io/themes/)。\n个人比较喜欢的主题：[hexo-theme-next](https://github.com/iissnan/hexo-theme-next) 和[hexo-theme-yilia](https://github.com/litten/hexo-theme-yilia)\n以next主题为例，首先clone这个主题：\n\n进入之前建立的hexo目录，在git bash中执行clone命令\n\n`$ git clone https://github.com/iissnan/hexo-theme-next.git themes/next`\n\n下载的主题到了hexo>theme文件夹下。\n修改##hexo##根目录下的**_config.yml**文件中的**theme: landscape**改为**theme: yilia**，然后重新执行**hexo g**来重新生成静态文件，**hexo s**部署到本地，**localhost:4000**预览博客效果。\n\n如果出现一些莫名其妙的问题，可以先执行**hexo clean**来清理一下public的内容，然后再来重新生成和发布。\n\n","slug":"hexo+github搭建个人博客","published":1,"updated":"2018-02-27T07:38:38.096Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspfq001fn8vf7v32zkcr","content":"<h2 id=\"1-前言\"><a href=\"#1-前言\" class=\"headerlink\" title=\"1.前言\"></a>1.前言</h2><p>使用github pages服务搭建博客的好处有：<br>1.全是静态文件，访问速度快；<br>2.免费方便，不用花一分钱就可以搭建一个自由的个人博客，不需要服务器不需要后台；<br>3.可以随意绑定自己的域名，不仔细看的话根本看不出来你的网站是基于github的；<br>4.数据绝对安全，基于github的版本管理，想恢复到哪个历史版本都行；<br>5.博客内容可以轻松打包、转移、发布到其它平台；<br><a id=\"more\"></a><br>6.等等；</p>\n<h3 id=\"1-1准备工作\"><a href=\"#1-1准备工作\" class=\"headerlink\" title=\"1.1准备工作\"></a>1.1准备工作</h3><ul>\n<li>创建github账号       <a href=\"https://github.com/\" target=\"_blank\" rel=\"noopener\">github注册地址</a></li>\n<li>安装node.js、npm     <a href=\"https://nodejs.org/en/download/\" target=\"_blank\" rel=\"noopener\">node.js下载地址</a></li>\n<li>安装git for windows  <a href=\"https://git-scm.com/downloads\" target=\"_blank\" rel=\"noopener\">git下载地址</a></li>\n</ul>\n<p><strong>本文所使用的环境</strong></p>\n<ul>\n<li>windows10</li>\n<li>git@1.9.5</li>\n<li>node.js@6.10.2</li>\n<li>hexo@</li>\n</ul>\n<h2 id=\"2-搭建github博客\"><a href=\"#2-搭建github博客\" class=\"headerlink\" title=\"2.搭建github博客\"></a>2.搭建github博客</h2><h3 id=\"2-1创建仓库\"><a href=\"#2-1创建仓库\" class=\"headerlink\" title=\"2.1创建仓库\"></a>2.1创建仓库</h3><p>登陆github,打开新建页面，如图<img src=\"/images/blog/newRepository.png\" alt=\"步骤一\"><br><img src=\"/images/blog/step2.png\" alt=\"步骤二\"><br>新建仓库名必须为<strong>你的用户名.github.io</strong>,假如说你的用户名是test,那仓库名为test.github.io,将来的博客访问地址就是<a href=\"http://test.github.io\" target=\"_blank\" rel=\"noopener\">http://test.github.io</a> 了，是不是很方便？<br>由此可见，每一个github账户最多只能创建一个这样可以直接使用域名访问的仓库。<br><strong>几个注意的地方：</strong><br>1.注册的邮箱一定要验证，否则不会成功；<br>2.仓库名字必须是：username.github.io，其中username是你的用户名；<br>3.仓库创建成功不会立即生效，需要过一段时间，大概10-30分钟，或者更久</p>\n<p>###2.2绑定域名<br>这一步不是必须，若不绑定则可用默认的<a href=\"http://xxx.github.io来访问，若想自己拥有一个域名，则需要注册，这一步留待以后再将，直接下一步。\" target=\"_blank\" rel=\"noopener\">http://xxx.github.io来访问，若想自己拥有一个域名，则需要注册，这一步留待以后再将，直接下一步。</a></p>\n<h2 id=\"3-配置SSH-key\"><a href=\"#3-配置SSH-key\" class=\"headerlink\" title=\"3.配置SSH key\"></a>3.配置SSH key</h2><p>为什么要配置这个呢？因为你提交代码肯定要拥有你的github权限才可以，但是直接使用用户名和密码太不安全了，所以我们使用ssh key来解决本地和服务器的连接问题。<br>在电脑任意位置进入<strong>git bash</strong><br><code>$ cd ~/. ssh #检查本机已存在的ssh密钥</code><br>如果提示：No such file or directory 说明你是第一次使用git<br><code>ssh-keygen -t rsa -C &quot;邮件地址&quot;</code><br>然后连续3次回车，最终会生成一个文件在用户目录下，打开用户目录，找到<strong>.ssh\\id_rsa.pub</strong>文件，文本编辑器打开并复制里面的内容，打开你的github主页，进入个人设置 -&gt; SSH and GPG keys -&gt; New SSH key：将刚复制的内容粘贴到key那里，title随便填，保存。<br><img src=\"/images/blog/step3.png\" alt=\"步骤三\"><br><strong>测试是否设置成功</strong><br><code>$ ssh -T git@github.com # 注意邮箱地址不用改</code><br>如果提示Are you sure you want to continue connecting (yes/no)?，输入yes，然后会看到：</p>\n<p>Hi xiaoyue! You’ve successfully authenticated, but GitHub does not provide shell access.</p>\n<p>看到这个信息说明SSH已配置成功！<br>此时你还需要配置：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ git config --global user.name <span class=\"string\">\"liuxianan\"</span>// 你的github用户名，非昵称</div><div class=\"line\">$ git config --global user.email  <span class=\"string\">\"xxx@qq.com\"</span>// 填写你的github注册邮箱</div></pre></td></tr></table></figure></p>\n<h2 id=\"4-使用hexo写博客\"><a href=\"#4-使用hexo写博客\" class=\"headerlink\" title=\"4.使用hexo写博客\"></a>4.使用hexo写博客</h2><h3 id=\"4-1hexo简介\"><a href=\"#4-1hexo简介\" class=\"headerlink\" title=\"4.1hexo简介\"></a>4.1hexo简介</h3><p>Hexo是一个简单、快速、强大的基于 Github Pages 的博客发布工具，支持Markdown格式，有众多优秀插件和主题。</p>\n<p>官网： <a href=\"http://hexo.io\" target=\"_blank\" rel=\"noopener\">http://hexo.io</a><br>github: <a href=\"https://github.com/hexojs/hexo\" target=\"_blank\" rel=\"noopener\">https://github.com/hexojs/hexo</a></p>\n<p>###4.2原理<br>由于github pages存放的都是静态文件，博客存放的不只是文章内容，还有文章列表、分类、标签、翻页等动态内容，假如每次写完一篇文章都要手动更新博文目录和相关链接信息，相信谁都会疯掉，所以hexo所做的就是将这些md文件都放在本地，每次写完文章后调用写好的命令来批量完成相关页面的生成，然后再将有改动的页面提交到github。</p>\n<p><strong>注意事项</strong></p>\n<ol>\n<li>很多命令既可以用Windows的cmd来完成，也可以使用git bash来完成，但是部分命令会有一些问题，为避免不必要的问题，建议全部使用git bash来执行；</li>\n<li>hexo不同版本差别比较大，网上很多文章的配置信息都是基于2.x的，所以注意不要被误导；</li>\n<li>hexo有2种_config.yml文件，一个是根目录下的全局的_config.yml，一个是各个theme下的；</li>\n</ol>\n<p><strong>安装hexo</strong><br><code>$ npm install -g hexo</code><br>若上面的命令失败，建议使用下面的代理命令<br><code>此处输入代码</code></p>\n<p><strong>初始化</strong><br>在电脑的某个地方新建一个名为hexo的文件夹（名字可以随便取），比如我的是<em>F:\\Workspaces\\hexo</em>，由于这个文件夹将来就作为你存放代码的地方，所以最好不要随便放。<br><code>$ cd /f/Workspaces/hexo/</code><br><code>$ hexo init</code><br>hexo会自动下载一些文件到这个目录，包括node_modules。继续执行下面两条命令<br><code>$ hexo g # 生成</code><br><code>$ hexo s # 启动服务</code><br>执行以上命令之后，hexo就会在public文件夹生成相关html文件，这些文件将来都是要提交到github去的。</p>\n<p><strong>hexo s</strong>是开启本地预览服务，打开浏览器访问 <a href=\"http://localhost:4000\" target=\"_blank\" rel=\"noopener\">http://localhost:4000</a> 即可看到内容，很多人会碰到浏览器一直在转圈但是就是加载不出来的问题，一般情况下是因为端口占用的缘故，因为4000这个端口太常见了，解决端口冲突问题请参考这篇文章：</p>\n<p><a href=\"http://blog.liuxianan.com/windows-port-bind.html\" target=\"_blank\" rel=\"noopener\">http://blog.liuxianan.com/windows-port-bind.html</a></p>\n<p>第一次初始化的时候hexo已经帮我们写了一篇名为 Hello World 的文章，默认的主题比较丑。</p>\n<h2 id=\"5-配置主题\"><a href=\"#5-配置主题\" class=\"headerlink\" title=\"5.配置主题\"></a>5.配置主题</h2><h3 id=\"5-1更换主题\"><a href=\"#5-1更换主题\" class=\"headerlink\" title=\"5.1更换主题\"></a>5.1更换主题</h3><p>既然默认主题很丑，那我们别的不做，首先来替换一个好看点的主题。这是 <a href=\"https://hexo.io/themes/\" target=\"_blank\" rel=\"noopener\">官方主题</a>。<br>个人比较喜欢的主题：<a href=\"https://github.com/iissnan/hexo-theme-next\" target=\"_blank\" rel=\"noopener\">hexo-theme-next</a> 和<a href=\"https://github.com/litten/hexo-theme-yilia\" target=\"_blank\" rel=\"noopener\">hexo-theme-yilia</a><br>以next主题为例，首先clone这个主题：</p>\n<p>进入之前建立的hexo目录，在git bash中执行clone命令</p>\n<p><code>$ git clone https://github.com/iissnan/hexo-theme-next.git themes/next</code></p>\n<p>下载的主题到了hexo&gt;theme文件夹下。<br>修改##hexo##根目录下的<strong>_config.yml</strong>文件中的<strong>theme: landscape</strong>改为<strong>theme: yilia</strong>，然后重新执行<strong>hexo g</strong>来重新生成静态文件，<strong>hexo s</strong>部署到本地，<strong>localhost:4000</strong>预览博客效果。</p>\n<p>如果出现一些莫名其妙的问题，可以先执行<strong>hexo clean</strong>来清理一下public的内容，然后再来重新生成和发布。</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"1-前言\"><a href=\"#1-前言\" class=\"headerlink\" title=\"1.前言\"></a>1.前言</h2><p>使用github pages服务搭建博客的好处有：<br>1.全是静态文件，访问速度快；<br>2.免费方便，不用花一分钱就可以搭建一个自由的个人博客，不需要服务器不需要后台；<br>3.可以随意绑定自己的域名，不仔细看的话根本看不出来你的网站是基于github的；<br>4.数据绝对安全，基于github的版本管理，想恢复到哪个历史版本都行；<br>5.博客内容可以轻松打包、转移、发布到其它平台；<br>","more":"<br>6.等等；</p>\n<h3 id=\"1-1准备工作\"><a href=\"#1-1准备工作\" class=\"headerlink\" title=\"1.1准备工作\"></a>1.1准备工作</h3><ul>\n<li>创建github账号       <a href=\"https://github.com/\" target=\"_blank\" rel=\"noopener\">github注册地址</a></li>\n<li>安装node.js、npm     <a href=\"https://nodejs.org/en/download/\" target=\"_blank\" rel=\"noopener\">node.js下载地址</a></li>\n<li>安装git for windows  <a href=\"https://git-scm.com/downloads\" target=\"_blank\" rel=\"noopener\">git下载地址</a></li>\n</ul>\n<p><strong>本文所使用的环境</strong></p>\n<ul>\n<li>windows10</li>\n<li>git@1.9.5</li>\n<li>node.js@6.10.2</li>\n<li>hexo@</li>\n</ul>\n<h2 id=\"2-搭建github博客\"><a href=\"#2-搭建github博客\" class=\"headerlink\" title=\"2.搭建github博客\"></a>2.搭建github博客</h2><h3 id=\"2-1创建仓库\"><a href=\"#2-1创建仓库\" class=\"headerlink\" title=\"2.1创建仓库\"></a>2.1创建仓库</h3><p>登陆github,打开新建页面，如图<img src=\"/images/blog/newRepository.png\" alt=\"步骤一\"><br><img src=\"/images/blog/step2.png\" alt=\"步骤二\"><br>新建仓库名必须为<strong>你的用户名.github.io</strong>,假如说你的用户名是test,那仓库名为test.github.io,将来的博客访问地址就是<a href=\"http://test.github.io\" target=\"_blank\" rel=\"noopener\">http://test.github.io</a> 了，是不是很方便？<br>由此可见，每一个github账户最多只能创建一个这样可以直接使用域名访问的仓库。<br><strong>几个注意的地方：</strong><br>1.注册的邮箱一定要验证，否则不会成功；<br>2.仓库名字必须是：username.github.io，其中username是你的用户名；<br>3.仓库创建成功不会立即生效，需要过一段时间，大概10-30分钟，或者更久</p>\n<p>###2.2绑定域名<br>这一步不是必须，若不绑定则可用默认的<a href=\"http://xxx.github.io来访问，若想自己拥有一个域名，则需要注册，这一步留待以后再将，直接下一步。\" target=\"_blank\" rel=\"noopener\">http://xxx.github.io来访问，若想自己拥有一个域名，则需要注册，这一步留待以后再将，直接下一步。</a></p>\n<h2 id=\"3-配置SSH-key\"><a href=\"#3-配置SSH-key\" class=\"headerlink\" title=\"3.配置SSH key\"></a>3.配置SSH key</h2><p>为什么要配置这个呢？因为你提交代码肯定要拥有你的github权限才可以，但是直接使用用户名和密码太不安全了，所以我们使用ssh key来解决本地和服务器的连接问题。<br>在电脑任意位置进入<strong>git bash</strong><br><code>$ cd ~/. ssh #检查本机已存在的ssh密钥</code><br>如果提示：No such file or directory 说明你是第一次使用git<br><code>ssh-keygen -t rsa -C &quot;邮件地址&quot;</code><br>然后连续3次回车，最终会生成一个文件在用户目录下，打开用户目录，找到<strong>.ssh\\id_rsa.pub</strong>文件，文本编辑器打开并复制里面的内容，打开你的github主页，进入个人设置 -&gt; SSH and GPG keys -&gt; New SSH key：将刚复制的内容粘贴到key那里，title随便填，保存。<br><img src=\"/images/blog/step3.png\" alt=\"步骤三\"><br><strong>测试是否设置成功</strong><br><code>$ ssh -T git@github.com # 注意邮箱地址不用改</code><br>如果提示Are you sure you want to continue connecting (yes/no)?，输入yes，然后会看到：</p>\n<p>Hi xiaoyue! You’ve successfully authenticated, but GitHub does not provide shell access.</p>\n<p>看到这个信息说明SSH已配置成功！<br>此时你还需要配置：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ git config --global user.name <span class=\"string\">\"liuxianan\"</span>// 你的github用户名，非昵称</div><div class=\"line\">$ git config --global user.email  <span class=\"string\">\"xxx@qq.com\"</span>// 填写你的github注册邮箱</div></pre></td></tr></table></figure></p>\n<h2 id=\"4-使用hexo写博客\"><a href=\"#4-使用hexo写博客\" class=\"headerlink\" title=\"4.使用hexo写博客\"></a>4.使用hexo写博客</h2><h3 id=\"4-1hexo简介\"><a href=\"#4-1hexo简介\" class=\"headerlink\" title=\"4.1hexo简介\"></a>4.1hexo简介</h3><p>Hexo是一个简单、快速、强大的基于 Github Pages 的博客发布工具，支持Markdown格式，有众多优秀插件和主题。</p>\n<p>官网： <a href=\"http://hexo.io\" target=\"_blank\" rel=\"noopener\">http://hexo.io</a><br>github: <a href=\"https://github.com/hexojs/hexo\" target=\"_blank\" rel=\"noopener\">https://github.com/hexojs/hexo</a></p>\n<p>###4.2原理<br>由于github pages存放的都是静态文件，博客存放的不只是文章内容，还有文章列表、分类、标签、翻页等动态内容，假如每次写完一篇文章都要手动更新博文目录和相关链接信息，相信谁都会疯掉，所以hexo所做的就是将这些md文件都放在本地，每次写完文章后调用写好的命令来批量完成相关页面的生成，然后再将有改动的页面提交到github。</p>\n<p><strong>注意事项</strong></p>\n<ol>\n<li>很多命令既可以用Windows的cmd来完成，也可以使用git bash来完成，但是部分命令会有一些问题，为避免不必要的问题，建议全部使用git bash来执行；</li>\n<li>hexo不同版本差别比较大，网上很多文章的配置信息都是基于2.x的，所以注意不要被误导；</li>\n<li>hexo有2种_config.yml文件，一个是根目录下的全局的_config.yml，一个是各个theme下的；</li>\n</ol>\n<p><strong>安装hexo</strong><br><code>$ npm install -g hexo</code><br>若上面的命令失败，建议使用下面的代理命令<br><code>此处输入代码</code></p>\n<p><strong>初始化</strong><br>在电脑的某个地方新建一个名为hexo的文件夹（名字可以随便取），比如我的是<em>F:\\Workspaces\\hexo</em>，由于这个文件夹将来就作为你存放代码的地方，所以最好不要随便放。<br><code>$ cd /f/Workspaces/hexo/</code><br><code>$ hexo init</code><br>hexo会自动下载一些文件到这个目录，包括node_modules。继续执行下面两条命令<br><code>$ hexo g # 生成</code><br><code>$ hexo s # 启动服务</code><br>执行以上命令之后，hexo就会在public文件夹生成相关html文件，这些文件将来都是要提交到github去的。</p>\n<p><strong>hexo s</strong>是开启本地预览服务，打开浏览器访问 <a href=\"http://localhost:4000\" target=\"_blank\" rel=\"noopener\">http://localhost:4000</a> 即可看到内容，很多人会碰到浏览器一直在转圈但是就是加载不出来的问题，一般情况下是因为端口占用的缘故，因为4000这个端口太常见了，解决端口冲突问题请参考这篇文章：</p>\n<p><a href=\"http://blog.liuxianan.com/windows-port-bind.html\" target=\"_blank\" rel=\"noopener\">http://blog.liuxianan.com/windows-port-bind.html</a></p>\n<p>第一次初始化的时候hexo已经帮我们写了一篇名为 Hello World 的文章，默认的主题比较丑。</p>\n<h2 id=\"5-配置主题\"><a href=\"#5-配置主题\" class=\"headerlink\" title=\"5.配置主题\"></a>5.配置主题</h2><h3 id=\"5-1更换主题\"><a href=\"#5-1更换主题\" class=\"headerlink\" title=\"5.1更换主题\"></a>5.1更换主题</h3><p>既然默认主题很丑，那我们别的不做，首先来替换一个好看点的主题。这是 <a href=\"https://hexo.io/themes/\" target=\"_blank\" rel=\"noopener\">官方主题</a>。<br>个人比较喜欢的主题：<a href=\"https://github.com/iissnan/hexo-theme-next\" target=\"_blank\" rel=\"noopener\">hexo-theme-next</a> 和<a href=\"https://github.com/litten/hexo-theme-yilia\" target=\"_blank\" rel=\"noopener\">hexo-theme-yilia</a><br>以next主题为例，首先clone这个主题：</p>\n<p>进入之前建立的hexo目录，在git bash中执行clone命令</p>\n<p><code>$ git clone https://github.com/iissnan/hexo-theme-next.git themes/next</code></p>\n<p>下载的主题到了hexo&gt;theme文件夹下。<br>修改##hexo##根目录下的<strong>_config.yml</strong>文件中的<strong>theme: landscape</strong>改为<strong>theme: yilia</strong>，然后重新执行<strong>hexo g</strong>来重新生成静态文件，<strong>hexo s</strong>部署到本地，<strong>localhost:4000</strong>预览博客效果。</p>\n<p>如果出现一些莫名其妙的问题，可以先执行<strong>hexo clean</strong>来清理一下public的内容，然后再来重新生成和发布。</p>"},{"title":"spring(1)——框架简介","date":"2017-06-12T05:19:16.000Z","_content":"\n这篇博客介绍了spring框架的组成及应用\n<!--more-->\n## 1.什么是spring框架？\nspring是一个轻量级的JAVA开发框架，由Rod Johnson创建。spring对应用对象（如javaBean）的生命周期进行管理，它是一个“粘合平台”，将很多技术粘合在一起，形成一个整体，使每个组件发挥最大功效。\n\n## 2.架构概述\n![spring架构][1]\n\n -  核心容器\n    - spring-bean是整个核心，Bean的定义、Bean 的创建以及对Bean的解析。\n    - spring-context是bean关系集合，也就是IOC容器\n    - spring-core发现、维护和管理变之间的关系\n    - spring-expression是EL遍地是语言的扩展，支持设置和获取对象属性，调用对象方法，操作数组、集合等。\n - 面向切面编程（AOP）和工具（Instruementation）\n    - Spring AOP模块提供了满足AOP Alliance规范的实现，还整合了AspectJ这种AOP语言级的框架。通过AOP能降低耦合。\n - 消息\n    - spring-messaging模块为集成messaging api和消息协议提供支持。\n - 数据访问集成\n    - 事务模块：该模块用于Spring管理事务，只要是Spring管理对象都能得到Spring管理事务的好处，无需在代码中进行事务控制了，而且支持编程和声明性的事务管理。\n    - JDBC模块：提供了一个JBDC的样例模板，使用这些模板能消除传统冗长的JDBC编码还有必须的事务控制，而且能享受到Spring管理事务的好处。\n    - ORM模块：提供与流行的“对象-关系”映射框架的无缝集成，包括hibernate、JPA、MyBatis等。而且可以使用Spring事务管理，无需额外控制事务。\n    - OXM模块：提供了一个对Object/XML映射实现，将Java对象映射成XML数据，或者将XML数据映射成java对象，Object/XML映射实现包括JAXB、Castor、XMLBeans和XStream。\n    - JMS模块：用于JMS(Java Messaging Service)，提供一套 “消息生产者、消息消费者”模板用于更加简单的使用JMS，JMS用于用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。\n - web集成\n    - 该模块建立在AoolicationContext模块之上，提供了Web应用的功能。如文件上传、FreeMarker等。\n    - Spring可以整合Struts2等MVC框架。Spring自己提供了MVC框架Spring MVC。\n - Test\n    - Spring可以用非容器依赖的编程方式进行几乎所有的测试工作，支持JUnit和TestNG等测试框架。\n\n## 3.资源包整理\n[spring资源下载链接][2]\n\n- 核心\n    - spring-beans-4.2.5.RELEASE.jar\n    - spring-context-4.2.5.RELEASE.jar\n    - spring-context-support-4.2.5.RELEASE.jar\n    - spring-core-4.2.5.RELEASE.jar\n    - spring-expression-4.2.5.RELEASE.jar\n- AOP\n    - spring-aop-4.2.5.RELEASE.jar\n    - spring-aspects-4.2.5.RELEASE.jar\n    - spring-instrument-4.2.5.RELEASE.jar\n    - spring-instrument-tomcat-4.2.5.RELEASE.jar\n    - spring-messaging-4.2.5.RELEASE.jar\n- WEB\n    - spring-web-4.2.5.RELEASE.jar\n    - spring-websocket-4.2.5.RELEASE.jar\n    - spring-webmvc-4.2.5.RELEASE.jar\n    - spring-webmvc-portlet-4.2.5.RELEASE.jar\n- DATA\n    - spring-jdbc-4.2.5.RELEASE.jar\n    - spring-jms-4.2.5.RELEASE.jar\n    - spring-orm-4.2.5.RELEASE.jar\n    - spring-oxm-4.2.5.RELEASE.jar\n    - spring-tx-4.2.5.RELEASE.jar\n- TEST\n    - spring-test-4.2.5.RELEASE.jar\n- LOG\n    - commons-logging-1.1.1.jar\n    - commons-logging\n    - log4j-1.2.15.jar\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/Spring/spring.png\n  [2]: http://maven.springframework.org/release/org/springframework/spring","source":"_posts/spring-1——框架简介.md","raw":"---\ntitle: spring(1)——框架简介\ncategories:\n  - Spring\ntags:\n  - Spring\ndate: 2017-06-12 13:19:16\n---\n\n这篇博客介绍了spring框架的组成及应用\n<!--more-->\n## 1.什么是spring框架？\nspring是一个轻量级的JAVA开发框架，由Rod Johnson创建。spring对应用对象（如javaBean）的生命周期进行管理，它是一个“粘合平台”，将很多技术粘合在一起，形成一个整体，使每个组件发挥最大功效。\n\n## 2.架构概述\n![spring架构][1]\n\n -  核心容器\n    - spring-bean是整个核心，Bean的定义、Bean 的创建以及对Bean的解析。\n    - spring-context是bean关系集合，也就是IOC容器\n    - spring-core发现、维护和管理变之间的关系\n    - spring-expression是EL遍地是语言的扩展，支持设置和获取对象属性，调用对象方法，操作数组、集合等。\n - 面向切面编程（AOP）和工具（Instruementation）\n    - Spring AOP模块提供了满足AOP Alliance规范的实现，还整合了AspectJ这种AOP语言级的框架。通过AOP能降低耦合。\n - 消息\n    - spring-messaging模块为集成messaging api和消息协议提供支持。\n - 数据访问集成\n    - 事务模块：该模块用于Spring管理事务，只要是Spring管理对象都能得到Spring管理事务的好处，无需在代码中进行事务控制了，而且支持编程和声明性的事务管理。\n    - JDBC模块：提供了一个JBDC的样例模板，使用这些模板能消除传统冗长的JDBC编码还有必须的事务控制，而且能享受到Spring管理事务的好处。\n    - ORM模块：提供与流行的“对象-关系”映射框架的无缝集成，包括hibernate、JPA、MyBatis等。而且可以使用Spring事务管理，无需额外控制事务。\n    - OXM模块：提供了一个对Object/XML映射实现，将Java对象映射成XML数据，或者将XML数据映射成java对象，Object/XML映射实现包括JAXB、Castor、XMLBeans和XStream。\n    - JMS模块：用于JMS(Java Messaging Service)，提供一套 “消息生产者、消息消费者”模板用于更加简单的使用JMS，JMS用于用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。\n - web集成\n    - 该模块建立在AoolicationContext模块之上，提供了Web应用的功能。如文件上传、FreeMarker等。\n    - Spring可以整合Struts2等MVC框架。Spring自己提供了MVC框架Spring MVC。\n - Test\n    - Spring可以用非容器依赖的编程方式进行几乎所有的测试工作，支持JUnit和TestNG等测试框架。\n\n## 3.资源包整理\n[spring资源下载链接][2]\n\n- 核心\n    - spring-beans-4.2.5.RELEASE.jar\n    - spring-context-4.2.5.RELEASE.jar\n    - spring-context-support-4.2.5.RELEASE.jar\n    - spring-core-4.2.5.RELEASE.jar\n    - spring-expression-4.2.5.RELEASE.jar\n- AOP\n    - spring-aop-4.2.5.RELEASE.jar\n    - spring-aspects-4.2.5.RELEASE.jar\n    - spring-instrument-4.2.5.RELEASE.jar\n    - spring-instrument-tomcat-4.2.5.RELEASE.jar\n    - spring-messaging-4.2.5.RELEASE.jar\n- WEB\n    - spring-web-4.2.5.RELEASE.jar\n    - spring-websocket-4.2.5.RELEASE.jar\n    - spring-webmvc-4.2.5.RELEASE.jar\n    - spring-webmvc-portlet-4.2.5.RELEASE.jar\n- DATA\n    - spring-jdbc-4.2.5.RELEASE.jar\n    - spring-jms-4.2.5.RELEASE.jar\n    - spring-orm-4.2.5.RELEASE.jar\n    - spring-oxm-4.2.5.RELEASE.jar\n    - spring-tx-4.2.5.RELEASE.jar\n- TEST\n    - spring-test-4.2.5.RELEASE.jar\n- LOG\n    - commons-logging-1.1.1.jar\n    - commons-logging\n    - log4j-1.2.15.jar\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/Spring/spring.png\n  [2]: http://maven.springframework.org/release/org/springframework/spring","slug":"spring-1——框架简介","published":1,"updated":"2018-02-27T07:38:38.099Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspfu001kn8vfkeib5ekl","content":"<p>这篇博客介绍了spring框架的组成及应用<br><a id=\"more\"></a></p>\n<h2 id=\"1-什么是spring框架？\"><a href=\"#1-什么是spring框架？\" class=\"headerlink\" title=\"1.什么是spring框架？\"></a>1.什么是spring框架？</h2><p>spring是一个轻量级的JAVA开发框架，由Rod Johnson创建。spring对应用对象（如javaBean）的生命周期进行管理，它是一个“粘合平台”，将很多技术粘合在一起，形成一个整体，使每个组件发挥最大功效。</p>\n<h2 id=\"2-架构概述\"><a href=\"#2-架构概述\" class=\"headerlink\" title=\"2.架构概述\"></a>2.架构概述</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/Spring/spring.png\" alt=\"spring架构\"></p>\n<ul>\n<li>核心容器<ul>\n<li>spring-bean是整个核心，Bean的定义、Bean 的创建以及对Bean的解析。</li>\n<li>spring-context是bean关系集合，也就是IOC容器</li>\n<li>spring-core发现、维护和管理变之间的关系</li>\n<li>spring-expression是EL遍地是语言的扩展，支持设置和获取对象属性，调用对象方法，操作数组、集合等。</li>\n</ul>\n</li>\n<li>面向切面编程（AOP）和工具（Instruementation）<ul>\n<li>Spring AOP模块提供了满足AOP Alliance规范的实现，还整合了AspectJ这种AOP语言级的框架。通过AOP能降低耦合。</li>\n</ul>\n</li>\n<li>消息<ul>\n<li>spring-messaging模块为集成messaging api和消息协议提供支持。</li>\n</ul>\n</li>\n<li>数据访问集成<ul>\n<li>事务模块：该模块用于Spring管理事务，只要是Spring管理对象都能得到Spring管理事务的好处，无需在代码中进行事务控制了，而且支持编程和声明性的事务管理。</li>\n<li>JDBC模块：提供了一个JBDC的样例模板，使用这些模板能消除传统冗长的JDBC编码还有必须的事务控制，而且能享受到Spring管理事务的好处。</li>\n<li>ORM模块：提供与流行的“对象-关系”映射框架的无缝集成，包括hibernate、JPA、MyBatis等。而且可以使用Spring事务管理，无需额外控制事务。</li>\n<li>OXM模块：提供了一个对Object/XML映射实现，将Java对象映射成XML数据，或者将XML数据映射成java对象，Object/XML映射实现包括JAXB、Castor、XMLBeans和XStream。</li>\n<li>JMS模块：用于JMS(Java Messaging Service)，提供一套 “消息生产者、消息消费者”模板用于更加简单的使用JMS，JMS用于用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。</li>\n</ul>\n</li>\n<li>web集成<ul>\n<li>该模块建立在AoolicationContext模块之上，提供了Web应用的功能。如文件上传、FreeMarker等。</li>\n<li>Spring可以整合Struts2等MVC框架。Spring自己提供了MVC框架Spring MVC。</li>\n</ul>\n</li>\n<li>Test<ul>\n<li>Spring可以用非容器依赖的编程方式进行几乎所有的测试工作，支持JUnit和TestNG等测试框架。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"3-资源包整理\"><a href=\"#3-资源包整理\" class=\"headerlink\" title=\"3.资源包整理\"></a>3.资源包整理</h2><p><a href=\"http://maven.springframework.org/release/org/springframework/spring\" target=\"_blank\" rel=\"noopener\">spring资源下载链接</a></p>\n<ul>\n<li>核心<ul>\n<li>spring-beans-4.2.5.RELEASE.jar</li>\n<li>spring-context-4.2.5.RELEASE.jar</li>\n<li>spring-context-support-4.2.5.RELEASE.jar</li>\n<li>spring-core-4.2.5.RELEASE.jar</li>\n<li>spring-expression-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>AOP<ul>\n<li>spring-aop-4.2.5.RELEASE.jar</li>\n<li>spring-aspects-4.2.5.RELEASE.jar</li>\n<li>spring-instrument-4.2.5.RELEASE.jar</li>\n<li>spring-instrument-tomcat-4.2.5.RELEASE.jar</li>\n<li>spring-messaging-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>WEB<ul>\n<li>spring-web-4.2.5.RELEASE.jar</li>\n<li>spring-websocket-4.2.5.RELEASE.jar</li>\n<li>spring-webmvc-4.2.5.RELEASE.jar</li>\n<li>spring-webmvc-portlet-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>DATA<ul>\n<li>spring-jdbc-4.2.5.RELEASE.jar</li>\n<li>spring-jms-4.2.5.RELEASE.jar</li>\n<li>spring-orm-4.2.5.RELEASE.jar</li>\n<li>spring-oxm-4.2.5.RELEASE.jar</li>\n<li>spring-tx-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>TEST<ul>\n<li>spring-test-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>LOG<ul>\n<li>commons-logging-1.1.1.jar</li>\n<li>commons-logging</li>\n<li>log4j-1.2.15.jar</li>\n</ul>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>这篇博客介绍了spring框架的组成及应用<br>","more":"</p>\n<h2 id=\"1-什么是spring框架？\"><a href=\"#1-什么是spring框架？\" class=\"headerlink\" title=\"1.什么是spring框架？\"></a>1.什么是spring框架？</h2><p>spring是一个轻量级的JAVA开发框架，由Rod Johnson创建。spring对应用对象（如javaBean）的生命周期进行管理，它是一个“粘合平台”，将很多技术粘合在一起，形成一个整体，使每个组件发挥最大功效。</p>\n<h2 id=\"2-架构概述\"><a href=\"#2-架构概述\" class=\"headerlink\" title=\"2.架构概述\"></a>2.架构概述</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/Spring/spring.png\" alt=\"spring架构\"></p>\n<ul>\n<li>核心容器<ul>\n<li>spring-bean是整个核心，Bean的定义、Bean 的创建以及对Bean的解析。</li>\n<li>spring-context是bean关系集合，也就是IOC容器</li>\n<li>spring-core发现、维护和管理变之间的关系</li>\n<li>spring-expression是EL遍地是语言的扩展，支持设置和获取对象属性，调用对象方法，操作数组、集合等。</li>\n</ul>\n</li>\n<li>面向切面编程（AOP）和工具（Instruementation）<ul>\n<li>Spring AOP模块提供了满足AOP Alliance规范的实现，还整合了AspectJ这种AOP语言级的框架。通过AOP能降低耦合。</li>\n</ul>\n</li>\n<li>消息<ul>\n<li>spring-messaging模块为集成messaging api和消息协议提供支持。</li>\n</ul>\n</li>\n<li>数据访问集成<ul>\n<li>事务模块：该模块用于Spring管理事务，只要是Spring管理对象都能得到Spring管理事务的好处，无需在代码中进行事务控制了，而且支持编程和声明性的事务管理。</li>\n<li>JDBC模块：提供了一个JBDC的样例模板，使用这些模板能消除传统冗长的JDBC编码还有必须的事务控制，而且能享受到Spring管理事务的好处。</li>\n<li>ORM模块：提供与流行的“对象-关系”映射框架的无缝集成，包括hibernate、JPA、MyBatis等。而且可以使用Spring事务管理，无需额外控制事务。</li>\n<li>OXM模块：提供了一个对Object/XML映射实现，将Java对象映射成XML数据，或者将XML数据映射成java对象，Object/XML映射实现包括JAXB、Castor、XMLBeans和XStream。</li>\n<li>JMS模块：用于JMS(Java Messaging Service)，提供一套 “消息生产者、消息消费者”模板用于更加简单的使用JMS，JMS用于用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。</li>\n</ul>\n</li>\n<li>web集成<ul>\n<li>该模块建立在AoolicationContext模块之上，提供了Web应用的功能。如文件上传、FreeMarker等。</li>\n<li>Spring可以整合Struts2等MVC框架。Spring自己提供了MVC框架Spring MVC。</li>\n</ul>\n</li>\n<li>Test<ul>\n<li>Spring可以用非容器依赖的编程方式进行几乎所有的测试工作，支持JUnit和TestNG等测试框架。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"3-资源包整理\"><a href=\"#3-资源包整理\" class=\"headerlink\" title=\"3.资源包整理\"></a>3.资源包整理</h2><p><a href=\"http://maven.springframework.org/release/org/springframework/spring\" target=\"_blank\" rel=\"noopener\">spring资源下载链接</a></p>\n<ul>\n<li>核心<ul>\n<li>spring-beans-4.2.5.RELEASE.jar</li>\n<li>spring-context-4.2.5.RELEASE.jar</li>\n<li>spring-context-support-4.2.5.RELEASE.jar</li>\n<li>spring-core-4.2.5.RELEASE.jar</li>\n<li>spring-expression-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>AOP<ul>\n<li>spring-aop-4.2.5.RELEASE.jar</li>\n<li>spring-aspects-4.2.5.RELEASE.jar</li>\n<li>spring-instrument-4.2.5.RELEASE.jar</li>\n<li>spring-instrument-tomcat-4.2.5.RELEASE.jar</li>\n<li>spring-messaging-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>WEB<ul>\n<li>spring-web-4.2.5.RELEASE.jar</li>\n<li>spring-websocket-4.2.5.RELEASE.jar</li>\n<li>spring-webmvc-4.2.5.RELEASE.jar</li>\n<li>spring-webmvc-portlet-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>DATA<ul>\n<li>spring-jdbc-4.2.5.RELEASE.jar</li>\n<li>spring-jms-4.2.5.RELEASE.jar</li>\n<li>spring-orm-4.2.5.RELEASE.jar</li>\n<li>spring-oxm-4.2.5.RELEASE.jar</li>\n<li>spring-tx-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>TEST<ul>\n<li>spring-test-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>LOG<ul>\n<li>commons-logging-1.1.1.jar</li>\n<li>commons-logging</li>\n<li>log4j-1.2.15.jar</li>\n</ul>\n</li>\n</ul>"},{"title":"html5+常用功能","date":"2017-05-19T10:09:53.000Z","_content":"这篇博文介绍了html5+在webApp开发中经常使用的功能模块\n<!--more-->\n## 获取wifi信息 ##\n\n 1. 获取wifi的IP\n``` javascript\nfunction getOnuIp() {\n    if(mui.os.android) {\n        var Context = plus.android.importClass(\"android.content.Context\");\n        var WifiManager = plus.android.importClass(\"android.net.wifi.WifiManager\");\n        var WifiInfo = plus.android.importClass(\"android.net.wifi.WifiInfo\");\n\n        var wifiManager = plus.android.runtimeMainActivity().getSystemService(Context.WIFI_SERVICE);\n        var wifiInfo = wifiManager.getConnectionInfo();\n        var ipAddress = wifiInfo.getIpAddress();\n        if(ipAddress == 0) return \"未连接wifi\";\n        return((ipAddress & 0xff) + \".\" + (ipAddress >> 8 & 0xff) + \".\" + (ipAddress >> 16 & 0xff) + \".\" + (ipAddress >> 24 & 0xff));\n    } else if(mui.os.ios) {\n        mui.toast(\"ios暂未获\");\n    }\n}\n```\n\n 2. 获取wifi的网关\n```javascript\nfunction getOnuIp() {\n    if(mui.os.android) {\n        var Context = plus.android.importClass(\"android.content.Context\");\n        var WifiManager = plus.android.importClass(\"android.net.wifi.WifiManager\");\n        var WifiInfo = plus.android.importClass(\"android.net.wifi.WifiInfo\");\n        var DhcpInfo=plus.android.importClass(\"android.net.DhcpInfo\");\n        var wifiManager = plus.android.runtimeMainActivity().getSystemService(Context.WIFI_SERVICE);\n        var dhcpInfo = wifiManager.getDhcpInfo()\n        var begin=dhcpInfo.toString().indexOf(\"gateway\");\n        var end=dhcpInfo.toString().indexOf(\"netmask\");\n        var ipAddress = dhcpInfo.toString().substring(begin+7,end).trim();  \n        if(ipAddress == 0) return \"未连接wifi\";\n        return ipAddress;\n//        return((ipAddress & 0xff) + \".\" + (ipAddress >> 8 & 0xff) + \".\" + (ipAddress >> 16 & 0xff) + \".\" + (ipAddress >> 24 & 0xff));\n    } else if(mui.os.ios) {\n        var WifiManager = plus.ios.importClass(\"WifiManager\");\n        var wifiManager = new WifiManager();\n        var gateWay = wifiManager.defaultGateWay();\n        return gateWay;\n    }\n}\n```\n\n## 软键盘 ##\n\n 1. 强制打开全键盘\n```javascript\n//弹出软键盘，搜索框获得焦点\nvar nativeWebview, imm, InputMethodManager;\nvar initNativeObjects = function() {\n    if(mui.os.android) {\n        var main = plus.android.runtimeMainActivity();\n        var Context = plus.android.importClass(\"android.content.Context\");\n        InputMethodManager = plus.android.importClass(\"android.view.inputmethod.InputMethodManager\");\n        imm = main.getSystemService(Context.INPUT_METHOD_SERVICE);\n    } else {\n        nativeWebview = plus.webview.currentWebview().nativeInstanceObject();\n    }\n};\nvar showSoftInput = function() {\n    if(mui.os.android) {\n        imm.toggleSoftInput(0, InputMethodManager.SHOW_FORCED);\n    } else {\n        nativeWebview.plusCallMethod({\n            \"setKeyboardDisplayRequiresUserAction\": false\n        });\n    }\n    setTimeout(function() {\n        //此处可写具体逻辑设置获取焦点的input\n        var inputElem = document.querySelector('input');\n        inputElem.focus();\n    }, 200);\n};\nvar showSoftInput2 = function() {\n    var nativeWebview = plus.webview.currentWebview().nativeInstanceObject();\n    if(mui.os.android) {\n        //强制当前webview获得焦点\n        plus.android.importClass(nativeWebview);\n        nativeWebview.requestFocus();\n        imm.toggleSoftInput(0, InputMethodManager.SHOW_FORCED);\n    } else {\n        nativeWebview.plusCallMethod({\n            \"setKeyboardDisplayRequiresUserAction\": false\n        });\n    }\n    setTimeout(function() {\n        //此处可写具体逻辑设置获取焦点的input\n        var inputElem = document.querySelector('input');\n        inputElem.select();\n    }, 200);\n};\n```\n 2. 关闭软键盘\n```javascript\ndocument.activeElement.blur(); //隐藏软键盘 \n```\n## 两次点击退出 ##\n```javascript\n//首页返回键处理  \n//处理逻辑：2秒内，连续两次按返回键，则退出应用  \n//首次按键，提示‘再按一次退出应用’  \nif(!first) {\n    first = new Date().getTime();\n    mui.toast('再按一次退出应用');\n    setTimeout(function() {\n        first = null;\n    }, 2000);\n    return false;\n} else {\n    if(new Date().getTime() - first < 2000) {\n        plus.runtime.quit();\n    }\n}\n```\n## 注销关闭其他窗口 ##\n```javascript\n/*监听注销按钮*/\ndocument.getElementById(\"logoutBtn\").addEventListener(\"tap\", function() {\n    var btnArray = ['是', '否'];\n    mui.confirm('您确定退出?', '', btnArray, function(e) {\n        if(e.index == 0) {\n            // 获取所有Webview窗口\n            var launchWebview = plus.webview.getLaunchWebview();\n            var curr = plus.webview.currentWebview();\n            var wvs = plus.webview.all();\n            for(var i = 0, len = wvs.length; i < len; i++) {\n                //关闭除setting页面和首页外的其他页面\n                if(wvs[i].getURL() == curr.getURL() || wvs[i].getURL() == launchWebview.getURL())\n                    continue;\n                plus.webview.close(wvs[i]);\n            }\n            //清除已存储的账号信息\n            myStorage.removeItem('ONU.token.username');\n            myStorage.removeItem('ONU.token.password');\n            myStorage.removeItem('ONU.token.autoLogin');\n            myStorage.removeItem('isLogin');\n            //注销静默登录的定时器\n            //clearInterval('backLoading()');\n            //打开login页面后再关闭setting页面\n            launchWebview.show();\n            curr.close();\n        }\n    })\n});\n```\n","source":"_posts/html5-常用功能.md","raw":"---\ntitle: html5+常用功能\ndate: 2017-05-19 18:09:53\ncategories:\n\t- DCloud\ntags:\n\t- html5+\n\t- native.js\n---\n这篇博文介绍了html5+在webApp开发中经常使用的功能模块\n<!--more-->\n## 获取wifi信息 ##\n\n 1. 获取wifi的IP\n``` javascript\nfunction getOnuIp() {\n    if(mui.os.android) {\n        var Context = plus.android.importClass(\"android.content.Context\");\n        var WifiManager = plus.android.importClass(\"android.net.wifi.WifiManager\");\n        var WifiInfo = plus.android.importClass(\"android.net.wifi.WifiInfo\");\n\n        var wifiManager = plus.android.runtimeMainActivity().getSystemService(Context.WIFI_SERVICE);\n        var wifiInfo = wifiManager.getConnectionInfo();\n        var ipAddress = wifiInfo.getIpAddress();\n        if(ipAddress == 0) return \"未连接wifi\";\n        return((ipAddress & 0xff) + \".\" + (ipAddress >> 8 & 0xff) + \".\" + (ipAddress >> 16 & 0xff) + \".\" + (ipAddress >> 24 & 0xff));\n    } else if(mui.os.ios) {\n        mui.toast(\"ios暂未获\");\n    }\n}\n```\n\n 2. 获取wifi的网关\n```javascript\nfunction getOnuIp() {\n    if(mui.os.android) {\n        var Context = plus.android.importClass(\"android.content.Context\");\n        var WifiManager = plus.android.importClass(\"android.net.wifi.WifiManager\");\n        var WifiInfo = plus.android.importClass(\"android.net.wifi.WifiInfo\");\n        var DhcpInfo=plus.android.importClass(\"android.net.DhcpInfo\");\n        var wifiManager = plus.android.runtimeMainActivity().getSystemService(Context.WIFI_SERVICE);\n        var dhcpInfo = wifiManager.getDhcpInfo()\n        var begin=dhcpInfo.toString().indexOf(\"gateway\");\n        var end=dhcpInfo.toString().indexOf(\"netmask\");\n        var ipAddress = dhcpInfo.toString().substring(begin+7,end).trim();  \n        if(ipAddress == 0) return \"未连接wifi\";\n        return ipAddress;\n//        return((ipAddress & 0xff) + \".\" + (ipAddress >> 8 & 0xff) + \".\" + (ipAddress >> 16 & 0xff) + \".\" + (ipAddress >> 24 & 0xff));\n    } else if(mui.os.ios) {\n        var WifiManager = plus.ios.importClass(\"WifiManager\");\n        var wifiManager = new WifiManager();\n        var gateWay = wifiManager.defaultGateWay();\n        return gateWay;\n    }\n}\n```\n\n## 软键盘 ##\n\n 1. 强制打开全键盘\n```javascript\n//弹出软键盘，搜索框获得焦点\nvar nativeWebview, imm, InputMethodManager;\nvar initNativeObjects = function() {\n    if(mui.os.android) {\n        var main = plus.android.runtimeMainActivity();\n        var Context = plus.android.importClass(\"android.content.Context\");\n        InputMethodManager = plus.android.importClass(\"android.view.inputmethod.InputMethodManager\");\n        imm = main.getSystemService(Context.INPUT_METHOD_SERVICE);\n    } else {\n        nativeWebview = plus.webview.currentWebview().nativeInstanceObject();\n    }\n};\nvar showSoftInput = function() {\n    if(mui.os.android) {\n        imm.toggleSoftInput(0, InputMethodManager.SHOW_FORCED);\n    } else {\n        nativeWebview.plusCallMethod({\n            \"setKeyboardDisplayRequiresUserAction\": false\n        });\n    }\n    setTimeout(function() {\n        //此处可写具体逻辑设置获取焦点的input\n        var inputElem = document.querySelector('input');\n        inputElem.focus();\n    }, 200);\n};\nvar showSoftInput2 = function() {\n    var nativeWebview = plus.webview.currentWebview().nativeInstanceObject();\n    if(mui.os.android) {\n        //强制当前webview获得焦点\n        plus.android.importClass(nativeWebview);\n        nativeWebview.requestFocus();\n        imm.toggleSoftInput(0, InputMethodManager.SHOW_FORCED);\n    } else {\n        nativeWebview.plusCallMethod({\n            \"setKeyboardDisplayRequiresUserAction\": false\n        });\n    }\n    setTimeout(function() {\n        //此处可写具体逻辑设置获取焦点的input\n        var inputElem = document.querySelector('input');\n        inputElem.select();\n    }, 200);\n};\n```\n 2. 关闭软键盘\n```javascript\ndocument.activeElement.blur(); //隐藏软键盘 \n```\n## 两次点击退出 ##\n```javascript\n//首页返回键处理  \n//处理逻辑：2秒内，连续两次按返回键，则退出应用  \n//首次按键，提示‘再按一次退出应用’  \nif(!first) {\n    first = new Date().getTime();\n    mui.toast('再按一次退出应用');\n    setTimeout(function() {\n        first = null;\n    }, 2000);\n    return false;\n} else {\n    if(new Date().getTime() - first < 2000) {\n        plus.runtime.quit();\n    }\n}\n```\n## 注销关闭其他窗口 ##\n```javascript\n/*监听注销按钮*/\ndocument.getElementById(\"logoutBtn\").addEventListener(\"tap\", function() {\n    var btnArray = ['是', '否'];\n    mui.confirm('您确定退出?', '', btnArray, function(e) {\n        if(e.index == 0) {\n            // 获取所有Webview窗口\n            var launchWebview = plus.webview.getLaunchWebview();\n            var curr = plus.webview.currentWebview();\n            var wvs = plus.webview.all();\n            for(var i = 0, len = wvs.length; i < len; i++) {\n                //关闭除setting页面和首页外的其他页面\n                if(wvs[i].getURL() == curr.getURL() || wvs[i].getURL() == launchWebview.getURL())\n                    continue;\n                plus.webview.close(wvs[i]);\n            }\n            //清除已存储的账号信息\n            myStorage.removeItem('ONU.token.username');\n            myStorage.removeItem('ONU.token.password');\n            myStorage.removeItem('ONU.token.autoLogin');\n            myStorage.removeItem('isLogin');\n            //注销静默登录的定时器\n            //clearInterval('backLoading()');\n            //打开login页面后再关闭setting页面\n            launchWebview.show();\n            curr.close();\n        }\n    })\n});\n```\n","slug":"html5-常用功能","published":1,"updated":"2018-02-27T07:38:38.097Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspfw001mn8vf6f84zrbb","content":"<p>这篇博文介绍了html5+在webApp开发中经常使用的功能模块<br><a id=\"more\"></a></p>\n<h2 id=\"获取wifi信息\"><a href=\"#获取wifi信息\" class=\"headerlink\" title=\"获取wifi信息\"></a>获取wifi信息</h2><ol>\n<li><p>获取wifi的IP</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getOnuIp</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> Context = plus.android.importClass(<span class=\"string\">\"android.content.Context\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiManager = plus.android.importClass(<span class=\"string\">\"android.net.wifi.WifiManager\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiInfo = plus.android.importClass(<span class=\"string\">\"android.net.wifi.WifiInfo\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">var</span> wifiManager = plus.android.runtimeMainActivity().getSystemService(Context.WIFI_SERVICE);</div><div class=\"line\">        <span class=\"keyword\">var</span> wifiInfo = wifiManager.getConnectionInfo();</div><div class=\"line\">        <span class=\"keyword\">var</span> ipAddress = wifiInfo.getIpAddress();</div><div class=\"line\">        <span class=\"keyword\">if</span>(ipAddress == <span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"string\">\"未连接wifi\"</span>;</div><div class=\"line\">        <span class=\"keyword\">return</span>((ipAddress &amp; <span class=\"number\">0xff</span>) + <span class=\"string\">\".\"</span> + (ipAddress &gt;&gt; <span class=\"number\">8</span> &amp; <span class=\"number\">0xff</span>) + <span class=\"string\">\".\"</span> + (ipAddress &gt;&gt; <span class=\"number\">16</span> &amp; <span class=\"number\">0xff</span>) + <span class=\"string\">\".\"</span> + (ipAddress &gt;&gt; <span class=\"number\">24</span> &amp; <span class=\"number\">0xff</span>));</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(mui.os.ios) &#123;</div><div class=\"line\">        mui.toast(<span class=\"string\">\"ios暂未获\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>获取wifi的网关</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getOnuIp</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> Context = plus.android.importClass(<span class=\"string\">\"android.content.Context\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiManager = plus.android.importClass(<span class=\"string\">\"android.net.wifi.WifiManager\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiInfo = plus.android.importClass(<span class=\"string\">\"android.net.wifi.WifiInfo\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> DhcpInfo=plus.android.importClass(<span class=\"string\">\"android.net.DhcpInfo\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> wifiManager = plus.android.runtimeMainActivity().getSystemService(Context.WIFI_SERVICE);</div><div class=\"line\">        <span class=\"keyword\">var</span> dhcpInfo = wifiManager.getDhcpInfo()</div><div class=\"line\">        <span class=\"keyword\">var</span> begin=dhcpInfo.toString().indexOf(<span class=\"string\">\"gateway\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> end=dhcpInfo.toString().indexOf(<span class=\"string\">\"netmask\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> ipAddress = dhcpInfo.toString().substring(begin+<span class=\"number\">7</span>,end).trim();  </div><div class=\"line\">        <span class=\"keyword\">if</span>(ipAddress == <span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"string\">\"未连接wifi\"</span>;</div><div class=\"line\">        <span class=\"keyword\">return</span> ipAddress;</div><div class=\"line\"><span class=\"comment\">//        return((ipAddress &amp; 0xff) + \".\" + (ipAddress &gt;&gt; 8 &amp; 0xff) + \".\" + (ipAddress &gt;&gt; 16 &amp; 0xff) + \".\" + (ipAddress &gt;&gt; 24 &amp; 0xff));</span></div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(mui.os.ios) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiManager = plus.ios.importClass(<span class=\"string\">\"WifiManager\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> wifiManager = <span class=\"keyword\">new</span> WifiManager();</div><div class=\"line\">        <span class=\"keyword\">var</span> gateWay = wifiManager.defaultGateWay();</div><div class=\"line\">        <span class=\"keyword\">return</span> gateWay;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"软键盘\"><a href=\"#软键盘\" class=\"headerlink\" title=\"软键盘\"></a>软键盘</h2><ol>\n<li><p>强制打开全键盘</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//弹出软键盘，搜索框获得焦点</span></div><div class=\"line\"><span class=\"keyword\">var</span> nativeWebview, imm, InputMethodManager;</div><div class=\"line\"><span class=\"keyword\">var</span> initNativeObjects = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> main = plus.android.runtimeMainActivity();</div><div class=\"line\">        <span class=\"keyword\">var</span> Context = plus.android.importClass(<span class=\"string\">\"android.content.Context\"</span>);</div><div class=\"line\">        InputMethodManager = plus.android.importClass(<span class=\"string\">\"android.view.inputmethod.InputMethodManager\"</span>);</div><div class=\"line\">        imm = main.getSystemService(Context.INPUT_METHOD_SERVICE);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        nativeWebview = plus.webview.currentWebview().nativeInstanceObject();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;;</div><div class=\"line\"><span class=\"keyword\">var</span> showSoftInput = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        imm.toggleSoftInput(<span class=\"number\">0</span>, InputMethodManager.SHOW_FORCED);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        nativeWebview.plusCallMethod(&#123;</div><div class=\"line\">            <span class=\"string\">\"setKeyboardDisplayRequiresUserAction\"</span>: <span class=\"literal\">false</span></div><div class=\"line\">        &#125;);</div><div class=\"line\">    &#125;</div><div class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//此处可写具体逻辑设置获取焦点的input</span></div><div class=\"line\">        <span class=\"keyword\">var</span> inputElem = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'input'</span>);</div><div class=\"line\">        inputElem.focus();</div><div class=\"line\">    &#125;, <span class=\"number\">200</span>);</div><div class=\"line\">&#125;;</div><div class=\"line\"><span class=\"keyword\">var</span> showSoftInput2 = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> nativeWebview = plus.webview.currentWebview().nativeInstanceObject();</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        <span class=\"comment\">//强制当前webview获得焦点</span></div><div class=\"line\">        plus.android.importClass(nativeWebview);</div><div class=\"line\">        nativeWebview.requestFocus();</div><div class=\"line\">        imm.toggleSoftInput(<span class=\"number\">0</span>, InputMethodManager.SHOW_FORCED);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        nativeWebview.plusCallMethod(&#123;</div><div class=\"line\">            <span class=\"string\">\"setKeyboardDisplayRequiresUserAction\"</span>: <span class=\"literal\">false</span></div><div class=\"line\">        &#125;);</div><div class=\"line\">    &#125;</div><div class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//此处可写具体逻辑设置获取焦点的input</span></div><div class=\"line\">        <span class=\"keyword\">var</span> inputElem = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'input'</span>);</div><div class=\"line\">        inputElem.select();</div><div class=\"line\">    &#125;, <span class=\"number\">200</span>);</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure>\n</li>\n<li><p>关闭软键盘</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">document</span>.activeElement.blur(); <span class=\"comment\">//隐藏软键盘</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"两次点击退出\"><a href=\"#两次点击退出\" class=\"headerlink\" title=\"两次点击退出\"></a>两次点击退出</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//首页返回键处理  </span></div><div class=\"line\"><span class=\"comment\">//处理逻辑：2秒内，连续两次按返回键，则退出应用  </span></div><div class=\"line\"><span class=\"comment\">//首次按键，提示‘再按一次退出应用’  </span></div><div class=\"line\"><span class=\"keyword\">if</span>(!first) &#123;</div><div class=\"line\">    first = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime();</div><div class=\"line\">    mui.toast(<span class=\"string\">'再按一次退出应用'</span>);</div><div class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        first = <span class=\"literal\">null</span>;</div><div class=\"line\">    &#125;, <span class=\"number\">2000</span>);</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime() - first &lt; <span class=\"number\">2000</span>) &#123;</div><div class=\"line\">        plus.runtime.quit();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"注销关闭其他窗口\"><a href=\"#注销关闭其他窗口\" class=\"headerlink\" title=\"注销关闭其他窗口\"></a>注销关闭其他窗口</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/*监听注销按钮*/</span></div><div class=\"line\"><span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"logoutBtn\"</span>).addEventListener(<span class=\"string\">\"tap\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> btnArray = [<span class=\"string\">'是'</span>, <span class=\"string\">'否'</span>];</div><div class=\"line\">    mui.confirm(<span class=\"string\">'您确定退出?'</span>, <span class=\"string\">''</span>, btnArray, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span>(e.index == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            <span class=\"comment\">// 获取所有Webview窗口</span></div><div class=\"line\">            <span class=\"keyword\">var</span> launchWebview = plus.webview.getLaunchWebview();</div><div class=\"line\">            <span class=\"keyword\">var</span> curr = plus.webview.currentWebview();</div><div class=\"line\">            <span class=\"keyword\">var</span> wvs = plus.webview.all();</div><div class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = wvs.length; i &lt; len; i++) &#123;</div><div class=\"line\">                <span class=\"comment\">//关闭除setting页面和首页外的其他页面</span></div><div class=\"line\">                <span class=\"keyword\">if</span>(wvs[i].getURL() == curr.getURL() || wvs[i].getURL() == launchWebview.getURL())</div><div class=\"line\">                    <span class=\"keyword\">continue</span>;</div><div class=\"line\">                plus.webview.close(wvs[i]);</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"comment\">//清除已存储的账号信息</span></div><div class=\"line\">            myStorage.removeItem(<span class=\"string\">'ONU.token.username'</span>);</div><div class=\"line\">            myStorage.removeItem(<span class=\"string\">'ONU.token.password'</span>);</div><div class=\"line\">            myStorage.removeItem(<span class=\"string\">'ONU.token.autoLogin'</span>);</div><div class=\"line\">            myStorage.removeItem(<span class=\"string\">'isLogin'</span>);</div><div class=\"line\">            <span class=\"comment\">//注销静默登录的定时器</span></div><div class=\"line\">            <span class=\"comment\">//clearInterval('backLoading()');</span></div><div class=\"line\">            <span class=\"comment\">//打开login页面后再关闭setting页面</span></div><div class=\"line\">            launchWebview.show();</div><div class=\"line\">            curr.close();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;)</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>这篇博文介绍了html5+在webApp开发中经常使用的功能模块<br>","more":"</p>\n<h2 id=\"获取wifi信息\"><a href=\"#获取wifi信息\" class=\"headerlink\" title=\"获取wifi信息\"></a>获取wifi信息</h2><ol>\n<li><p>获取wifi的IP</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getOnuIp</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> Context = plus.android.importClass(<span class=\"string\">\"android.content.Context\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiManager = plus.android.importClass(<span class=\"string\">\"android.net.wifi.WifiManager\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiInfo = plus.android.importClass(<span class=\"string\">\"android.net.wifi.WifiInfo\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">var</span> wifiManager = plus.android.runtimeMainActivity().getSystemService(Context.WIFI_SERVICE);</div><div class=\"line\">        <span class=\"keyword\">var</span> wifiInfo = wifiManager.getConnectionInfo();</div><div class=\"line\">        <span class=\"keyword\">var</span> ipAddress = wifiInfo.getIpAddress();</div><div class=\"line\">        <span class=\"keyword\">if</span>(ipAddress == <span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"string\">\"未连接wifi\"</span>;</div><div class=\"line\">        <span class=\"keyword\">return</span>((ipAddress &amp; <span class=\"number\">0xff</span>) + <span class=\"string\">\".\"</span> + (ipAddress &gt;&gt; <span class=\"number\">8</span> &amp; <span class=\"number\">0xff</span>) + <span class=\"string\">\".\"</span> + (ipAddress &gt;&gt; <span class=\"number\">16</span> &amp; <span class=\"number\">0xff</span>) + <span class=\"string\">\".\"</span> + (ipAddress &gt;&gt; <span class=\"number\">24</span> &amp; <span class=\"number\">0xff</span>));</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(mui.os.ios) &#123;</div><div class=\"line\">        mui.toast(<span class=\"string\">\"ios暂未获\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>获取wifi的网关</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getOnuIp</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> Context = plus.android.importClass(<span class=\"string\">\"android.content.Context\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiManager = plus.android.importClass(<span class=\"string\">\"android.net.wifi.WifiManager\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiInfo = plus.android.importClass(<span class=\"string\">\"android.net.wifi.WifiInfo\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> DhcpInfo=plus.android.importClass(<span class=\"string\">\"android.net.DhcpInfo\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> wifiManager = plus.android.runtimeMainActivity().getSystemService(Context.WIFI_SERVICE);</div><div class=\"line\">        <span class=\"keyword\">var</span> dhcpInfo = wifiManager.getDhcpInfo()</div><div class=\"line\">        <span class=\"keyword\">var</span> begin=dhcpInfo.toString().indexOf(<span class=\"string\">\"gateway\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> end=dhcpInfo.toString().indexOf(<span class=\"string\">\"netmask\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> ipAddress = dhcpInfo.toString().substring(begin+<span class=\"number\">7</span>,end).trim();  </div><div class=\"line\">        <span class=\"keyword\">if</span>(ipAddress == <span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"string\">\"未连接wifi\"</span>;</div><div class=\"line\">        <span class=\"keyword\">return</span> ipAddress;</div><div class=\"line\"><span class=\"comment\">//        return((ipAddress &amp; 0xff) + \".\" + (ipAddress &gt;&gt; 8 &amp; 0xff) + \".\" + (ipAddress &gt;&gt; 16 &amp; 0xff) + \".\" + (ipAddress &gt;&gt; 24 &amp; 0xff));</span></div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(mui.os.ios) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiManager = plus.ios.importClass(<span class=\"string\">\"WifiManager\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> wifiManager = <span class=\"keyword\">new</span> WifiManager();</div><div class=\"line\">        <span class=\"keyword\">var</span> gateWay = wifiManager.defaultGateWay();</div><div class=\"line\">        <span class=\"keyword\">return</span> gateWay;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"软键盘\"><a href=\"#软键盘\" class=\"headerlink\" title=\"软键盘\"></a>软键盘</h2><ol>\n<li><p>强制打开全键盘</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//弹出软键盘，搜索框获得焦点</span></div><div class=\"line\"><span class=\"keyword\">var</span> nativeWebview, imm, InputMethodManager;</div><div class=\"line\"><span class=\"keyword\">var</span> initNativeObjects = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> main = plus.android.runtimeMainActivity();</div><div class=\"line\">        <span class=\"keyword\">var</span> Context = plus.android.importClass(<span class=\"string\">\"android.content.Context\"</span>);</div><div class=\"line\">        InputMethodManager = plus.android.importClass(<span class=\"string\">\"android.view.inputmethod.InputMethodManager\"</span>);</div><div class=\"line\">        imm = main.getSystemService(Context.INPUT_METHOD_SERVICE);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        nativeWebview = plus.webview.currentWebview().nativeInstanceObject();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;;</div><div class=\"line\"><span class=\"keyword\">var</span> showSoftInput = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        imm.toggleSoftInput(<span class=\"number\">0</span>, InputMethodManager.SHOW_FORCED);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        nativeWebview.plusCallMethod(&#123;</div><div class=\"line\">            <span class=\"string\">\"setKeyboardDisplayRequiresUserAction\"</span>: <span class=\"literal\">false</span></div><div class=\"line\">        &#125;);</div><div class=\"line\">    &#125;</div><div class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//此处可写具体逻辑设置获取焦点的input</span></div><div class=\"line\">        <span class=\"keyword\">var</span> inputElem = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'input'</span>);</div><div class=\"line\">        inputElem.focus();</div><div class=\"line\">    &#125;, <span class=\"number\">200</span>);</div><div class=\"line\">&#125;;</div><div class=\"line\"><span class=\"keyword\">var</span> showSoftInput2 = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> nativeWebview = plus.webview.currentWebview().nativeInstanceObject();</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        <span class=\"comment\">//强制当前webview获得焦点</span></div><div class=\"line\">        plus.android.importClass(nativeWebview);</div><div class=\"line\">        nativeWebview.requestFocus();</div><div class=\"line\">        imm.toggleSoftInput(<span class=\"number\">0</span>, InputMethodManager.SHOW_FORCED);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        nativeWebview.plusCallMethod(&#123;</div><div class=\"line\">            <span class=\"string\">\"setKeyboardDisplayRequiresUserAction\"</span>: <span class=\"literal\">false</span></div><div class=\"line\">        &#125;);</div><div class=\"line\">    &#125;</div><div class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//此处可写具体逻辑设置获取焦点的input</span></div><div class=\"line\">        <span class=\"keyword\">var</span> inputElem = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'input'</span>);</div><div class=\"line\">        inputElem.select();</div><div class=\"line\">    &#125;, <span class=\"number\">200</span>);</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure>\n</li>\n<li><p>关闭软键盘</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">document</span>.activeElement.blur(); <span class=\"comment\">//隐藏软键盘</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"两次点击退出\"><a href=\"#两次点击退出\" class=\"headerlink\" title=\"两次点击退出\"></a>两次点击退出</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//首页返回键处理  </span></div><div class=\"line\"><span class=\"comment\">//处理逻辑：2秒内，连续两次按返回键，则退出应用  </span></div><div class=\"line\"><span class=\"comment\">//首次按键，提示‘再按一次退出应用’  </span></div><div class=\"line\"><span class=\"keyword\">if</span>(!first) &#123;</div><div class=\"line\">    first = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime();</div><div class=\"line\">    mui.toast(<span class=\"string\">'再按一次退出应用'</span>);</div><div class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        first = <span class=\"literal\">null</span>;</div><div class=\"line\">    &#125;, <span class=\"number\">2000</span>);</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime() - first &lt; <span class=\"number\">2000</span>) &#123;</div><div class=\"line\">        plus.runtime.quit();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"注销关闭其他窗口\"><a href=\"#注销关闭其他窗口\" class=\"headerlink\" title=\"注销关闭其他窗口\"></a>注销关闭其他窗口</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/*监听注销按钮*/</span></div><div class=\"line\"><span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"logoutBtn\"</span>).addEventListener(<span class=\"string\">\"tap\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> btnArray = [<span class=\"string\">'是'</span>, <span class=\"string\">'否'</span>];</div><div class=\"line\">    mui.confirm(<span class=\"string\">'您确定退出?'</span>, <span class=\"string\">''</span>, btnArray, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span>(e.index == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            <span class=\"comment\">// 获取所有Webview窗口</span></div><div class=\"line\">            <span class=\"keyword\">var</span> launchWebview = plus.webview.getLaunchWebview();</div><div class=\"line\">            <span class=\"keyword\">var</span> curr = plus.webview.currentWebview();</div><div class=\"line\">            <span class=\"keyword\">var</span> wvs = plus.webview.all();</div><div class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = wvs.length; i &lt; len; i++) &#123;</div><div class=\"line\">                <span class=\"comment\">//关闭除setting页面和首页外的其他页面</span></div><div class=\"line\">                <span class=\"keyword\">if</span>(wvs[i].getURL() == curr.getURL() || wvs[i].getURL() == launchWebview.getURL())</div><div class=\"line\">                    <span class=\"keyword\">continue</span>;</div><div class=\"line\">                plus.webview.close(wvs[i]);</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"comment\">//清除已存储的账号信息</span></div><div class=\"line\">            myStorage.removeItem(<span class=\"string\">'ONU.token.username'</span>);</div><div class=\"line\">            myStorage.removeItem(<span class=\"string\">'ONU.token.password'</span>);</div><div class=\"line\">            myStorage.removeItem(<span class=\"string\">'ONU.token.autoLogin'</span>);</div><div class=\"line\">            myStorage.removeItem(<span class=\"string\">'isLogin'</span>);</div><div class=\"line\">            <span class=\"comment\">//注销静默登录的定时器</span></div><div class=\"line\">            <span class=\"comment\">//clearInterval('backLoading()');</span></div><div class=\"line\">            <span class=\"comment\">//打开login页面后再关闭setting页面</span></div><div class=\"line\">            launchWebview.show();</div><div class=\"line\">            curr.close();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;)</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>"},{"title":"spring(2)——IOC浅析","date":"2017-06-14T01:59:11.000Z","_content":"\n这篇博客简单分析了IOC和DI的原理及区别，并介绍了基于xml和注解的Bean配置方式。\n<!--more-->\n## 1. 什么是IOC?\n\n### 1.1 IoC(Inversion of Control)控制反转\n - 控制:控制的双方是什么？谁控制谁？\n    -  主控方：Spring\n    -  被控方：应用程序所使用的资源\n    -  (原始)应用程序控制自己执行操作需要使用的外部资源\n    -  (Spring)Spring控制整个程序中所需要使用的外部资源\n - 反转:什么是反转？反转什么？\n    -  正向：应用程序直接调用资源\n    -  反向：应用程序依赖Spring为其提供资源\n    -  反转的是资源的控制权\n    -  应用程序由主动调用资源，变为被动的等待Spring提供资源\n - 有什么好处？\n    -  正向缺点：应用程序控制的资源分布在程序的每一个地方\n    -  反向的优点：所有的资源都在Spring中，便于管理\n    -  总结：Spring反向控制应用程序所需要使用的外部资源。资源受Spring管理，利用率最大化。\n\n### 1.2 spring演进模式\n\tA.基于分层设计\n\t\tUserAction\t\t\t使用UserService,new UserService()\n\t\tUserService\t\t\t使用UserDAO,new UserDAO()\n\t\tUserDAO\n\tB.工厂模式，使用面向接口编程设计，解决层与层之间的紧耦合\n\t\t制作接口，制作实现类，制作对象工厂\n```java\nA a = AFactory.createA();  \nB b = BFactory.createB();  \na.setB(b);\n```\n\tC.工厂模式+配置\n\t\t制作XML文件，将实现类配置到XML文件中\n\t\t读取XML文件中的配置信息，得到实现类的类名\n\t\t使用反射思想，获取实现类对象 class.newInstance();\n```java\nA a = Factory.create(“a”);  \nB b = Factory.create(“b”);  \na.setB(b);  \n```\n```xml\n<!--配置xml-->\na=AImpl  \nb=BImpl\n```\n\tD.自动的工厂+配置\n```java\n//返回装配好的a   \nA a = Factory.create(“a”);  \n```\n```xml\n<!--xml配置-->\n<bean id=“a” class=“AImpl”>  \n    <property name=“b” ref=“b”/>  \n</bean>  \n<bean id=“b” class=“BImpl”/>  \n```\n    E.工厂由Spring提供，实现类使用XML格式配置\n        工厂由Spring提供，实现类使用XML格式配置\n```java\n//返回装配好的a   \nA a = ApplicationContext.getBean(“a”);  \n```\n```xml\n<!--xml配置-->\n<bean id=“a” class=“AImpl”>  \n    <property name=“b” ref=“b”/>  \n</bean>  \n<bean id=“b” class=“BImpl”/>  \n```\n## 2. 什么是DI？\n### 2.1 DI的概念\nDI(Dependency Injection)依赖注入，指应用程序依赖Spring为其提供运行时所需的资源.\n\n- 谁依赖于谁？            -------   应用程序依赖于IoC容器\n- 为什么需要依赖？        -------   应用程序依赖于IoC容器装配类之间的关系\n- 依赖什么东西？          -------   依赖了IoC容器的装配功能\n- 谁注入于谁？            -------   IoC容器注入应用程序\n- 注入什么东西？          -------   注入应用程序需要的资源（类之间的关系）\n\n更能描述容器其特点的名字——“依赖注入”（Dependency Injection）\nIoC容器应该具有依赖注入功能，因此也可以叫DI容器 \n\n### 2.2 DI实现方式\n\n 1. 构造器注入\n 2. setter注入\n 3. 接口注入\n\n## 3. IOC和DI的关系？\nIOC和DI其实是同一概念的两种说法，两者站立的角度不一样。\nIOC：从spring的角度看，资源的控制权限被反转了\nDI：从应用程序的角度看，应用程序要依赖spring为其注入资源。\n\n## 4. BeanFactory\n\n 1. BeanFactory是ApplicationContext的顶层父接口，使用BeanFactory接口也可以完成获取Bean的操作.\n 2. 操作步骤:\n    ```java\n    //初始化Resource对象\n    Resource res = new ClassPathResource(\"applicationContext.xml\");\n    //初始化BeanFactory对象\n    BeanFactory bf = new XmlBeanFactory(res);\n    //根据id名称获取Bean\n    UserService service = (UserService) bf.getBean(\"userService\");\n    ```\n    \n 3. AppplicationContext与BeanFactory的区别\n   A. 加载方式不同\n\n        AppplicationContext：立即加载，加载配置文件时即加载\n\t\tBeanFactory:延迟加载，获取Bean实例时才加载\n   B. AppplicationContext具有更多的功能\n   \n        国际化处理\n        事件传递\n        Bean自动装配\n        各种不同应用层的Context实现\n        注意：实际开发中，优先选择ApplicationContext对象，避免使用BeanFactory\n\n 4. Schema风格离线约束配置方式\n        A.拷贝访问路径\n\t\tB.打开MyEclipse设置中的XML catalog选项\n\t\tC.创建新的映射\n\t\tD.选择对应的schema风格的约束文件\n\t\tE.将key type修改为schema location\n\t\tF.将要配置的路径复制到key中\n\n## 5. Bean配置（XML）\n### 5.1 Bean初始化\n\n 1. 构造器初始化（重点）\n    **Bean对应的类必须提供一个默认无参可访问的构造方法**\n 2. 静态工厂初始化\n \n    ```xml\n    <bean id=\"userService2\" \n        <!--配置中所配置的class配置成工厂类的类名-->\n        class=\"com.topvision.bean.UserStataicFactory\"\n        <!--配置工厂类中的创建实例的静态方法-->\n        factory-method=\"getInst\">\n    </bean>\n    ```\n 3. 实例工厂初始化\n    提供一个实例工厂类，使用其中的实例方法获取对象。由于该工厂类本身需要创建对象，因此该对象必须受Spring控制，所以必须配置该工厂类为Bean.\n\n    ```xml\n    <!—实例化工厂Bean -->\n    <bean id=\"uf\" class=\"com.topvision.bean.UserFactory\"></bean>\n    <!--使用实例工厂创建Bean -->\n    <!--factory-bean: 配置实例工厂在Spring范围内对应的Bean的id名称-->\n    <!--factory-method：配置工厂类中的创建实例的实例方法-->\n    <bean id=\"userService3\"  factory-bean=\"uf\" factory-method=\"getInst2\"></bean>\n    ```\n    \n### 5.2 Bean的作用域\n\nSpring初始化的Bean默认为单例模式，如果想修改成非单例模式需要修改Bean的作用范围。\n```xml   \n<bean id=”beanId” class=”BeanClassName” scope=”prototype”></bean>\n```\n\t\tscope属性：\n\t\t\tsingleton：单例\n\t\t\tprototype：非单例\n\t\t\trequest：请求对象范围request.setAttribute(\"beanId\",obj);\n\t\t\tsession：会话Session范围request.getSession().setAttribute(\"beanId\",obj);\n\t\t\tglobalSession：全局会话,分布式服务器\n\t\t\t\n### 5.3 Bean的生命周期\n定义Bean初始化与销毁时的动作，属于回调方法配置\n定义bean时指定两个回调方法，控制bean的初始化与销毁操作时执行的动作\n\n- init-method：初始化回调方法名，配置的方法必须由bean对象提供\n- destroy-method：销毁回调方法名，配置的方法必须由bean对象提供\n\n```xml\n<bean id=\"user\" class=\"com.topvision.lifecycle.User\" init-method=\"init\" destroy-method=\"destroy\" scope=\"prototype\"></bean>\n```\n\n- 销毁操作只针对scope=\"singletion\"的对象，对于非单例对象无效\n- 单例对象的销毁是在IoC容器关闭时发生，使用ClassPathXmlApplicationContext对象close方法完成\n- 非单例Bean对象的内存回收交由JVM完成——GC\n\n### 5.4 Bean属性注入\n\n 1. 构造器注入（了解）\n    A.在domain中提供对象的构造方法\n    B.xml配置中设置构造方法的参数\n    ```xml\n    <!-- constructor-arg:使用构造器传递参数  -->\n    <!-- value:赋值 -->\n    <bean id=\"bean6\" class=\"com.topvision.bean.xml.Bean6\">\n        <constructor-arg value=\"topvision\"/>\n        <constructor-arg value=\"2017\"/>\n    </bean>\n    ```\n    注意：如果类型匹配不成功，可以为配置中指定index索引属性，对应构造器中参数的位置.\n    ```xml\n\t<bean id=\"bean6\" class=\"com.topvision.bean.xml.Bean6\">\n\t\t<constructor-arg index=\"0\" value=\"2014\" type=\"java.lang.Integer\"></constructor-arg>\n\t    <constructor-arg index=\"1\" value=\"topvision\" type=\"java.lang.String\"></constructor-arg>\n\t</bean>\n\t```\n\t说明：构造器传参受构造器参数位置和类型的限定，因此不常使用\n\t\n 2. setter注入\n **前提：setter注入要求Bean必须提供无参可访问构造方法**\n\n    A.注入简单类型\n        \n        1.提供对应要注入的属性\n        2.为每个要注入的属性提供对应的标准封装setter方法\n        3.在配置中为Bean指定要注入的属性，使用property元素 name=“属性名” value=”值”\n    ```xml\n    <property name=\"属性名\" value=\"值\"/>\n    ```\n    B.注入引用类型\n         \n        1.为某个Bean注入引用类型的值，首先在Bean对应的类中声明对应的属性\n    ```java\n    private TeacherDAO dao;\n    ``` \n\n\t\t2.为每个要注入的属性提供对应的标准封装setter方法 (访问器)\n    ```xml\n \tpublic void setDao(TeacherDAO dao) {\n\t\tthis.dao = dao;\n\t}\n    ```\n        3.必须保障引入的对象是Spring控制的Bean\n    ```xml\n    <!-- 声明引用类型的资源为Bean -->\n    <bean id=\"teacherDao\" class=\"com.topvision.di.setter.TeacherDAO\">\t</bean>\n    ```\n        4.在Bean的属性注入中，使用ref引用对应的资源 ref=”beanId/beanName”\n    ```xml\n    <!-- setter注入 -->\n\t<!-- name:属性名 -->\n\t<!-- value:简单类型的值 -->\n\t<!-- ref:引用别的Bean，beanId/beanName -->\n\t<bean id=\"bean7\" class=\"com.topvision.bean.xml.Bean7\">\n\t\t<property name=\"name\" value=\"topvision\"/>\n\t\t<property name=\"age\" value=\"8\"/>\n\t\t<property name=\"dao\" ref=\"teacherDao\"></property>\n\t</bean>\n    ```\n    \n## 6. Bean配置（注解）\n从Spring2.5开始提供使用注解的形式配置Bean。\n\n### 6.1 配置Bean使用@Component注解\n如需为Bean定义名称，在参数中添加Bean名称@Component(\"beanName\")\n\n### 6.2 设定Spring的自动扫描路径\n用于检测对应的Bean是否配置了注解，并加载配置了注解的类\n\n - 开启context空间的支持\n```xml\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n  \txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n   \txmlns:context=\"http://www.springframework.org/schema/context\" \n   \txsi:schemaLocation=\"\n\thttp://www.springframework.org/schema/beans \n\thttp://www.springframework.org/schema/beans/spring-beans.xsd\n\thttp://www.springframework.org/schema/context \t\t\t\t\t\n\thttp://www.springframework.org/schema/context/spring-context.xsd\">\n\t\n```\n - 开启自动扫描功能，并指定扫描的路径\n```xml\n<context:component-scan base-package=\"com.topvision.annotation\"></context:component-scan>\n```\n说明：扫描路径可以设置多个，中间使用,隔开，扫描路径包含指定包和子包内所有的类,通常使用*号通配符匹配路径\n\n### 6.3 Spring提供的三个注解\n\n 1. @Repository 用于数据层实现类标注\n 2. @Service 用于业务逻辑层实现类标注\n 3. @Controller 用于控制层实现类进行标注\n\n### 6.4 注入简单类型\n\n 1. 在属性名上方声明该属性自动装配@Autowired\n 2. 在属性名上方声明该属性注入的值@Value(value)\n```java\n@Autowired\n@Value(\"topvision\")\nprivate String msg;\n```\n注意：注解自动装配属性值无需提供对应属性的setter方法\n\n### 6.5 注入引用类型\n\n - 在属性名上方声明该属性自动装配@Autowired\n - 在属性名上方声明该属性注入的值@Qualifier(bean引用名称)\n```java\n@Autowired\n@Qualifier(\"anno2\")\nprivate AnnotationOther other;\n```\n\n### 6.6 Autowired\nAutowired的required属性用用于声明自动装配的数据是必须的。\n\n 1. 如果required=true，必须为其装配数据，如果没有值，抛出异常\n 2. 如果required=false，自动装配数据失败，则注入值为null\n\n### 6.7 Resource\n\n 1. 格式一：@Resource(name=\"myImpl\")\n 2. 格式二：@Autowired(required=false)\n　　　　@Qualifier(\"myImpl\")\n以上两种格式效果相同\n\n### 6.8 Bean声明周期注解\n\n 1. @PostConstruct\n    功能：为当前Bean指定init-method参数\n\t格式：定义在成员方法的上方，兼容静态方法\n 2. @PreDestroy\n    功能：为当前Bean指定destory-method参数\n\t格式：定义在成员方法的上方，兼容静态方法\n\t注意：要求当前类被注册为Bean，否则无效果\n\n### 6.9 Bean作用域注解\n\n在类的定义上方添加@Scope指定Bean的作用域\n常用：@Scope(\"prototype\")\n默认：@Scope(\"singleton\")\n\n### 6.10 配置类注解\n**@Configuration**配置当前类为配置类，用于加载其中配置的Bean，与静态工厂初始化Bean很相似\n**@Bean(name=\"b1\")**将配置类中的某个方法的返回值声明为Bean，该方法必须返回一个对象\n```java\n@Configuration\t\t\t//设定该类参与自动扫描\npublic class MyBeanFactory {\n\t@Bean(name={\"aa\",\"bb\",\"cc\"})//设定该方法的返回值是一个Bean\n\tpublic static BookService getInst(){\n\t\treturn new BookService();\n\t}\n}\n```\n以上操作必须基于自动扫描功能，如不开启自动扫描，Spring将无法查找到对应的注解配置\n\n### 6.11 AnnotationConfigApplicationContext不使用自动扫描\n\nAnnotationConfigApplicationContext对象可以手工加载基于注解配置的Bean\n```java\n//用于手工添加注解开发Bean的上下文对象\nAnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext();\n//加载配置管理类\nctx.register(MyConfiguration.class);\n//刷新上下文对象\nctx.refresh();\n```\n\n注意：注册完成后一定要进行刷新，否则加载的Bean将无法被使用\n\n## 博客链接\n\n 1. [源码解读Spring IOC原理][1]\n 2. [Spring源代码解析][2]\n\n\n    \n\n\n  [1]: http://www.cnblogs.com/ITtangtang/p/3978349.html\n  [2]: http://www.cnblogs.com/dazhaxie/archive/2012/06/18/2553300.html","source":"_posts/spring-2——IOC浅析.md","raw":"---\ntitle: spring(2)——IOC浅析\ncategories:\n  - Spring\ntags:\n  - Spring\n  - IOC\ndate: 2017-06-14 09:59:11\n---\n\n这篇博客简单分析了IOC和DI的原理及区别，并介绍了基于xml和注解的Bean配置方式。\n<!--more-->\n## 1. 什么是IOC?\n\n### 1.1 IoC(Inversion of Control)控制反转\n - 控制:控制的双方是什么？谁控制谁？\n    -  主控方：Spring\n    -  被控方：应用程序所使用的资源\n    -  (原始)应用程序控制自己执行操作需要使用的外部资源\n    -  (Spring)Spring控制整个程序中所需要使用的外部资源\n - 反转:什么是反转？反转什么？\n    -  正向：应用程序直接调用资源\n    -  反向：应用程序依赖Spring为其提供资源\n    -  反转的是资源的控制权\n    -  应用程序由主动调用资源，变为被动的等待Spring提供资源\n - 有什么好处？\n    -  正向缺点：应用程序控制的资源分布在程序的每一个地方\n    -  反向的优点：所有的资源都在Spring中，便于管理\n    -  总结：Spring反向控制应用程序所需要使用的外部资源。资源受Spring管理，利用率最大化。\n\n### 1.2 spring演进模式\n\tA.基于分层设计\n\t\tUserAction\t\t\t使用UserService,new UserService()\n\t\tUserService\t\t\t使用UserDAO,new UserDAO()\n\t\tUserDAO\n\tB.工厂模式，使用面向接口编程设计，解决层与层之间的紧耦合\n\t\t制作接口，制作实现类，制作对象工厂\n```java\nA a = AFactory.createA();  \nB b = BFactory.createB();  \na.setB(b);\n```\n\tC.工厂模式+配置\n\t\t制作XML文件，将实现类配置到XML文件中\n\t\t读取XML文件中的配置信息，得到实现类的类名\n\t\t使用反射思想，获取实现类对象 class.newInstance();\n```java\nA a = Factory.create(“a”);  \nB b = Factory.create(“b”);  \na.setB(b);  \n```\n```xml\n<!--配置xml-->\na=AImpl  \nb=BImpl\n```\n\tD.自动的工厂+配置\n```java\n//返回装配好的a   \nA a = Factory.create(“a”);  \n```\n```xml\n<!--xml配置-->\n<bean id=“a” class=“AImpl”>  \n    <property name=“b” ref=“b”/>  \n</bean>  \n<bean id=“b” class=“BImpl”/>  \n```\n    E.工厂由Spring提供，实现类使用XML格式配置\n        工厂由Spring提供，实现类使用XML格式配置\n```java\n//返回装配好的a   \nA a = ApplicationContext.getBean(“a”);  \n```\n```xml\n<!--xml配置-->\n<bean id=“a” class=“AImpl”>  \n    <property name=“b” ref=“b”/>  \n</bean>  \n<bean id=“b” class=“BImpl”/>  \n```\n## 2. 什么是DI？\n### 2.1 DI的概念\nDI(Dependency Injection)依赖注入，指应用程序依赖Spring为其提供运行时所需的资源.\n\n- 谁依赖于谁？            -------   应用程序依赖于IoC容器\n- 为什么需要依赖？        -------   应用程序依赖于IoC容器装配类之间的关系\n- 依赖什么东西？          -------   依赖了IoC容器的装配功能\n- 谁注入于谁？            -------   IoC容器注入应用程序\n- 注入什么东西？          -------   注入应用程序需要的资源（类之间的关系）\n\n更能描述容器其特点的名字——“依赖注入”（Dependency Injection）\nIoC容器应该具有依赖注入功能，因此也可以叫DI容器 \n\n### 2.2 DI实现方式\n\n 1. 构造器注入\n 2. setter注入\n 3. 接口注入\n\n## 3. IOC和DI的关系？\nIOC和DI其实是同一概念的两种说法，两者站立的角度不一样。\nIOC：从spring的角度看，资源的控制权限被反转了\nDI：从应用程序的角度看，应用程序要依赖spring为其注入资源。\n\n## 4. BeanFactory\n\n 1. BeanFactory是ApplicationContext的顶层父接口，使用BeanFactory接口也可以完成获取Bean的操作.\n 2. 操作步骤:\n    ```java\n    //初始化Resource对象\n    Resource res = new ClassPathResource(\"applicationContext.xml\");\n    //初始化BeanFactory对象\n    BeanFactory bf = new XmlBeanFactory(res);\n    //根据id名称获取Bean\n    UserService service = (UserService) bf.getBean(\"userService\");\n    ```\n    \n 3. AppplicationContext与BeanFactory的区别\n   A. 加载方式不同\n\n        AppplicationContext：立即加载，加载配置文件时即加载\n\t\tBeanFactory:延迟加载，获取Bean实例时才加载\n   B. AppplicationContext具有更多的功能\n   \n        国际化处理\n        事件传递\n        Bean自动装配\n        各种不同应用层的Context实现\n        注意：实际开发中，优先选择ApplicationContext对象，避免使用BeanFactory\n\n 4. Schema风格离线约束配置方式\n        A.拷贝访问路径\n\t\tB.打开MyEclipse设置中的XML catalog选项\n\t\tC.创建新的映射\n\t\tD.选择对应的schema风格的约束文件\n\t\tE.将key type修改为schema location\n\t\tF.将要配置的路径复制到key中\n\n## 5. Bean配置（XML）\n### 5.1 Bean初始化\n\n 1. 构造器初始化（重点）\n    **Bean对应的类必须提供一个默认无参可访问的构造方法**\n 2. 静态工厂初始化\n \n    ```xml\n    <bean id=\"userService2\" \n        <!--配置中所配置的class配置成工厂类的类名-->\n        class=\"com.topvision.bean.UserStataicFactory\"\n        <!--配置工厂类中的创建实例的静态方法-->\n        factory-method=\"getInst\">\n    </bean>\n    ```\n 3. 实例工厂初始化\n    提供一个实例工厂类，使用其中的实例方法获取对象。由于该工厂类本身需要创建对象，因此该对象必须受Spring控制，所以必须配置该工厂类为Bean.\n\n    ```xml\n    <!—实例化工厂Bean -->\n    <bean id=\"uf\" class=\"com.topvision.bean.UserFactory\"></bean>\n    <!--使用实例工厂创建Bean -->\n    <!--factory-bean: 配置实例工厂在Spring范围内对应的Bean的id名称-->\n    <!--factory-method：配置工厂类中的创建实例的实例方法-->\n    <bean id=\"userService3\"  factory-bean=\"uf\" factory-method=\"getInst2\"></bean>\n    ```\n    \n### 5.2 Bean的作用域\n\nSpring初始化的Bean默认为单例模式，如果想修改成非单例模式需要修改Bean的作用范围。\n```xml   \n<bean id=”beanId” class=”BeanClassName” scope=”prototype”></bean>\n```\n\t\tscope属性：\n\t\t\tsingleton：单例\n\t\t\tprototype：非单例\n\t\t\trequest：请求对象范围request.setAttribute(\"beanId\",obj);\n\t\t\tsession：会话Session范围request.getSession().setAttribute(\"beanId\",obj);\n\t\t\tglobalSession：全局会话,分布式服务器\n\t\t\t\n### 5.3 Bean的生命周期\n定义Bean初始化与销毁时的动作，属于回调方法配置\n定义bean时指定两个回调方法，控制bean的初始化与销毁操作时执行的动作\n\n- init-method：初始化回调方法名，配置的方法必须由bean对象提供\n- destroy-method：销毁回调方法名，配置的方法必须由bean对象提供\n\n```xml\n<bean id=\"user\" class=\"com.topvision.lifecycle.User\" init-method=\"init\" destroy-method=\"destroy\" scope=\"prototype\"></bean>\n```\n\n- 销毁操作只针对scope=\"singletion\"的对象，对于非单例对象无效\n- 单例对象的销毁是在IoC容器关闭时发生，使用ClassPathXmlApplicationContext对象close方法完成\n- 非单例Bean对象的内存回收交由JVM完成——GC\n\n### 5.4 Bean属性注入\n\n 1. 构造器注入（了解）\n    A.在domain中提供对象的构造方法\n    B.xml配置中设置构造方法的参数\n    ```xml\n    <!-- constructor-arg:使用构造器传递参数  -->\n    <!-- value:赋值 -->\n    <bean id=\"bean6\" class=\"com.topvision.bean.xml.Bean6\">\n        <constructor-arg value=\"topvision\"/>\n        <constructor-arg value=\"2017\"/>\n    </bean>\n    ```\n    注意：如果类型匹配不成功，可以为配置中指定index索引属性，对应构造器中参数的位置.\n    ```xml\n\t<bean id=\"bean6\" class=\"com.topvision.bean.xml.Bean6\">\n\t\t<constructor-arg index=\"0\" value=\"2014\" type=\"java.lang.Integer\"></constructor-arg>\n\t    <constructor-arg index=\"1\" value=\"topvision\" type=\"java.lang.String\"></constructor-arg>\n\t</bean>\n\t```\n\t说明：构造器传参受构造器参数位置和类型的限定，因此不常使用\n\t\n 2. setter注入\n **前提：setter注入要求Bean必须提供无参可访问构造方法**\n\n    A.注入简单类型\n        \n        1.提供对应要注入的属性\n        2.为每个要注入的属性提供对应的标准封装setter方法\n        3.在配置中为Bean指定要注入的属性，使用property元素 name=“属性名” value=”值”\n    ```xml\n    <property name=\"属性名\" value=\"值\"/>\n    ```\n    B.注入引用类型\n         \n        1.为某个Bean注入引用类型的值，首先在Bean对应的类中声明对应的属性\n    ```java\n    private TeacherDAO dao;\n    ``` \n\n\t\t2.为每个要注入的属性提供对应的标准封装setter方法 (访问器)\n    ```xml\n \tpublic void setDao(TeacherDAO dao) {\n\t\tthis.dao = dao;\n\t}\n    ```\n        3.必须保障引入的对象是Spring控制的Bean\n    ```xml\n    <!-- 声明引用类型的资源为Bean -->\n    <bean id=\"teacherDao\" class=\"com.topvision.di.setter.TeacherDAO\">\t</bean>\n    ```\n        4.在Bean的属性注入中，使用ref引用对应的资源 ref=”beanId/beanName”\n    ```xml\n    <!-- setter注入 -->\n\t<!-- name:属性名 -->\n\t<!-- value:简单类型的值 -->\n\t<!-- ref:引用别的Bean，beanId/beanName -->\n\t<bean id=\"bean7\" class=\"com.topvision.bean.xml.Bean7\">\n\t\t<property name=\"name\" value=\"topvision\"/>\n\t\t<property name=\"age\" value=\"8\"/>\n\t\t<property name=\"dao\" ref=\"teacherDao\"></property>\n\t</bean>\n    ```\n    \n## 6. Bean配置（注解）\n从Spring2.5开始提供使用注解的形式配置Bean。\n\n### 6.1 配置Bean使用@Component注解\n如需为Bean定义名称，在参数中添加Bean名称@Component(\"beanName\")\n\n### 6.2 设定Spring的自动扫描路径\n用于检测对应的Bean是否配置了注解，并加载配置了注解的类\n\n - 开启context空间的支持\n```xml\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n  \txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n   \txmlns:context=\"http://www.springframework.org/schema/context\" \n   \txsi:schemaLocation=\"\n\thttp://www.springframework.org/schema/beans \n\thttp://www.springframework.org/schema/beans/spring-beans.xsd\n\thttp://www.springframework.org/schema/context \t\t\t\t\t\n\thttp://www.springframework.org/schema/context/spring-context.xsd\">\n\t\n```\n - 开启自动扫描功能，并指定扫描的路径\n```xml\n<context:component-scan base-package=\"com.topvision.annotation\"></context:component-scan>\n```\n说明：扫描路径可以设置多个，中间使用,隔开，扫描路径包含指定包和子包内所有的类,通常使用*号通配符匹配路径\n\n### 6.3 Spring提供的三个注解\n\n 1. @Repository 用于数据层实现类标注\n 2. @Service 用于业务逻辑层实现类标注\n 3. @Controller 用于控制层实现类进行标注\n\n### 6.4 注入简单类型\n\n 1. 在属性名上方声明该属性自动装配@Autowired\n 2. 在属性名上方声明该属性注入的值@Value(value)\n```java\n@Autowired\n@Value(\"topvision\")\nprivate String msg;\n```\n注意：注解自动装配属性值无需提供对应属性的setter方法\n\n### 6.5 注入引用类型\n\n - 在属性名上方声明该属性自动装配@Autowired\n - 在属性名上方声明该属性注入的值@Qualifier(bean引用名称)\n```java\n@Autowired\n@Qualifier(\"anno2\")\nprivate AnnotationOther other;\n```\n\n### 6.6 Autowired\nAutowired的required属性用用于声明自动装配的数据是必须的。\n\n 1. 如果required=true，必须为其装配数据，如果没有值，抛出异常\n 2. 如果required=false，自动装配数据失败，则注入值为null\n\n### 6.7 Resource\n\n 1. 格式一：@Resource(name=\"myImpl\")\n 2. 格式二：@Autowired(required=false)\n　　　　@Qualifier(\"myImpl\")\n以上两种格式效果相同\n\n### 6.8 Bean声明周期注解\n\n 1. @PostConstruct\n    功能：为当前Bean指定init-method参数\n\t格式：定义在成员方法的上方，兼容静态方法\n 2. @PreDestroy\n    功能：为当前Bean指定destory-method参数\n\t格式：定义在成员方法的上方，兼容静态方法\n\t注意：要求当前类被注册为Bean，否则无效果\n\n### 6.9 Bean作用域注解\n\n在类的定义上方添加@Scope指定Bean的作用域\n常用：@Scope(\"prototype\")\n默认：@Scope(\"singleton\")\n\n### 6.10 配置类注解\n**@Configuration**配置当前类为配置类，用于加载其中配置的Bean，与静态工厂初始化Bean很相似\n**@Bean(name=\"b1\")**将配置类中的某个方法的返回值声明为Bean，该方法必须返回一个对象\n```java\n@Configuration\t\t\t//设定该类参与自动扫描\npublic class MyBeanFactory {\n\t@Bean(name={\"aa\",\"bb\",\"cc\"})//设定该方法的返回值是一个Bean\n\tpublic static BookService getInst(){\n\t\treturn new BookService();\n\t}\n}\n```\n以上操作必须基于自动扫描功能，如不开启自动扫描，Spring将无法查找到对应的注解配置\n\n### 6.11 AnnotationConfigApplicationContext不使用自动扫描\n\nAnnotationConfigApplicationContext对象可以手工加载基于注解配置的Bean\n```java\n//用于手工添加注解开发Bean的上下文对象\nAnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext();\n//加载配置管理类\nctx.register(MyConfiguration.class);\n//刷新上下文对象\nctx.refresh();\n```\n\n注意：注册完成后一定要进行刷新，否则加载的Bean将无法被使用\n\n## 博客链接\n\n 1. [源码解读Spring IOC原理][1]\n 2. [Spring源代码解析][2]\n\n\n    \n\n\n  [1]: http://www.cnblogs.com/ITtangtang/p/3978349.html\n  [2]: http://www.cnblogs.com/dazhaxie/archive/2012/06/18/2553300.html","slug":"spring-2——IOC浅析","published":1,"updated":"2018-02-27T07:38:38.100Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspfy001qn8vfz79hujpb","content":"<p>这篇博客简单分析了IOC和DI的原理及区别，并介绍了基于xml和注解的Bean配置方式。<br><a id=\"more\"></a></p>\n<h2 id=\"1-什么是IOC\"><a href=\"#1-什么是IOC\" class=\"headerlink\" title=\"1. 什么是IOC?\"></a>1. 什么是IOC?</h2><h3 id=\"1-1-IoC-Inversion-of-Control-控制反转\"><a href=\"#1-1-IoC-Inversion-of-Control-控制反转\" class=\"headerlink\" title=\"1.1 IoC(Inversion of Control)控制反转\"></a>1.1 IoC(Inversion of Control)控制反转</h3><ul>\n<li>控制:控制的双方是什么？谁控制谁？<ul>\n<li>主控方：Spring</li>\n<li>被控方：应用程序所使用的资源</li>\n<li>(原始)应用程序控制自己执行操作需要使用的外部资源</li>\n<li>(Spring)Spring控制整个程序中所需要使用的外部资源</li>\n</ul>\n</li>\n<li>反转:什么是反转？反转什么？<ul>\n<li>正向：应用程序直接调用资源</li>\n<li>反向：应用程序依赖Spring为其提供资源</li>\n<li>反转的是资源的控制权</li>\n<li>应用程序由主动调用资源，变为被动的等待Spring提供资源</li>\n</ul>\n</li>\n<li>有什么好处？<ul>\n<li>正向缺点：应用程序控制的资源分布在程序的每一个地方</li>\n<li>反向的优点：所有的资源都在Spring中，便于管理</li>\n<li>总结：Spring反向控制应用程序所需要使用的外部资源。资源受Spring管理，利用率最大化。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"1-2-spring演进模式\"><a href=\"#1-2-spring演进模式\" class=\"headerlink\" title=\"1.2 spring演进模式\"></a>1.2 spring演进模式</h3><pre><code>A.基于分层设计\n    UserAction            使用UserService,new UserService()\n    UserService            使用UserDAO,new UserDAO()\n    UserDAO\nB.工厂模式，使用面向接口编程设计，解决层与层之间的紧耦合\n    制作接口，制作实现类，制作对象工厂\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">A a = AFactory.createA();  </div><div class=\"line\">B b = BFactory.createB();  </div><div class=\"line\">a.setB(b);</div></pre></td></tr></table></figure>\n<pre><code>C.工厂模式+配置\n    制作XML文件，将实现类配置到XML文件中\n    读取XML文件中的配置信息，得到实现类的类名\n    使用反射思想，获取实现类对象 class.newInstance();\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">A a = Factory.create(“a”);  </div><div class=\"line\">B b = Factory.create(“b”);  </div><div class=\"line\">a.setB(b);</div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--配置xml--&gt;</span></div><div class=\"line\">a=AImpl  </div><div class=\"line\">b=BImpl</div></pre></td></tr></table></figure>\n<pre><code>D.自动的工厂+配置\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//返回装配好的a   </span></div><div class=\"line\">A a = Factory.create(“a”);</div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--xml配置--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">“a”</span> <span class=\"attr\">class</span>=<span class=\"string\">“AImpl”</span>&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">“b”</span> <span class=\"attr\">ref</span>=<span class=\"string\">“b”/</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">“b”</span> <span class=\"attr\">class</span>=<span class=\"string\">“BImpl”/</span>&gt;</span></div></pre></td></tr></table></figure>\n<pre><code>E.工厂由Spring提供，实现类使用XML格式配置\n    工厂由Spring提供，实现类使用XML格式配置\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//返回装配好的a   </span></div><div class=\"line\">A a = ApplicationContext.getBean(“a”);</div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--xml配置--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">“a”</span> <span class=\"attr\">class</span>=<span class=\"string\">“AImpl”</span>&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">“b”</span> <span class=\"attr\">ref</span>=<span class=\"string\">“b”/</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">“b”</span> <span class=\"attr\">class</span>=<span class=\"string\">“BImpl”/</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"2-什么是DI？\"><a href=\"#2-什么是DI？\" class=\"headerlink\" title=\"2. 什么是DI？\"></a>2. 什么是DI？</h2><h3 id=\"2-1-DI的概念\"><a href=\"#2-1-DI的概念\" class=\"headerlink\" title=\"2.1 DI的概念\"></a>2.1 DI的概念</h3><p>DI(Dependency Injection)依赖注入，指应用程序依赖Spring为其提供运行时所需的资源.</p>\n<ul>\n<li>谁依赖于谁？            ——-   应用程序依赖于IoC容器</li>\n<li>为什么需要依赖？        ——-   应用程序依赖于IoC容器装配类之间的关系</li>\n<li>依赖什么东西？          ——-   依赖了IoC容器的装配功能</li>\n<li>谁注入于谁？            ——-   IoC容器注入应用程序</li>\n<li>注入什么东西？          ——-   注入应用程序需要的资源（类之间的关系）</li>\n</ul>\n<p>更能描述容器其特点的名字——“依赖注入”（Dependency Injection）<br>IoC容器应该具有依赖注入功能，因此也可以叫DI容器 </p>\n<h3 id=\"2-2-DI实现方式\"><a href=\"#2-2-DI实现方式\" class=\"headerlink\" title=\"2.2 DI实现方式\"></a>2.2 DI实现方式</h3><ol>\n<li>构造器注入</li>\n<li>setter注入</li>\n<li>接口注入</li>\n</ol>\n<h2 id=\"3-IOC和DI的关系？\"><a href=\"#3-IOC和DI的关系？\" class=\"headerlink\" title=\"3. IOC和DI的关系？\"></a>3. IOC和DI的关系？</h2><p>IOC和DI其实是同一概念的两种说法，两者站立的角度不一样。<br>IOC：从spring的角度看，资源的控制权限被反转了<br>DI：从应用程序的角度看，应用程序要依赖spring为其注入资源。</p>\n<h2 id=\"4-BeanFactory\"><a href=\"#4-BeanFactory\" class=\"headerlink\" title=\"4. BeanFactory\"></a>4. BeanFactory</h2><ol>\n<li>BeanFactory是ApplicationContext的顶层父接口，使用BeanFactory接口也可以完成获取Bean的操作.</li>\n<li>操作步骤:<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//初始化Resource对象</span></div><div class=\"line\">Resource res = <span class=\"keyword\">new</span> ClassPathResource(<span class=\"string\">\"applicationContext.xml\"</span>);</div><div class=\"line\"><span class=\"comment\">//初始化BeanFactory对象</span></div><div class=\"line\">BeanFactory bf = <span class=\"keyword\">new</span> XmlBeanFactory(res);</div><div class=\"line\"><span class=\"comment\">//根据id名称获取Bean</span></div><div class=\"line\">UserService service = (UserService) bf.getBean(<span class=\"string\">\"userService\"</span>);</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>AppplicationContext与BeanFactory的区别<br>A. 加载方式不同</p>\n<pre><code>AppplicationContext：立即加载，加载配置文件时即加载\nBeanFactory:延迟加载，获取Bean实例时才加载\n</code></pre><p>B. AppplicationContext具有更多的功能</p>\n<pre><code>国际化处理\n事件传递\nBean自动装配\n各种不同应用层的Context实现\n注意：实际开发中，优先选择ApplicationContext对象，避免使用BeanFactory\n</code></pre></li>\n<li><p>Schema风格离线约束配置方式</p>\n<pre><code>A.拷贝访问路径\nB.打开MyEclipse设置中的XML catalog选项\nC.创建新的映射\nD.选择对应的schema风格的约束文件\nE.将key type修改为schema location\nF.将要配置的路径复制到key中\n</code></pre></li>\n</ol>\n<h2 id=\"5-Bean配置（XML）\"><a href=\"#5-Bean配置（XML）\" class=\"headerlink\" title=\"5. Bean配置（XML）\"></a>5. Bean配置（XML）</h2><h3 id=\"5-1-Bean初始化\"><a href=\"#5-1-Bean初始化\" class=\"headerlink\" title=\"5.1 Bean初始化\"></a>5.1 Bean初始化</h3><ol>\n<li>构造器初始化（重点）<br><strong>Bean对应的类必须提供一个默认无参可访问的构造方法</strong></li>\n<li><p>静态工厂初始化</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;bean id=\"userService2\" </div><div class=\"line\">    &lt;!--配置中所配置的class配置成工厂类的类名--&gt;</div><div class=\"line\">    class=\"com.topvision.bean.UserStataicFactory\"</div><div class=\"line\">    &lt;!--配置工厂类中的创建实例的静态方法--&gt;</div><div class=\"line\">    factory-method=\"getInst\"&gt;</div><div class=\"line\">&lt;/bean&gt;</div></pre></td></tr></table></figure>\n</li>\n<li><p>实例工厂初始化<br>提供一个实例工厂类，使用其中的实例方法获取对象。由于该工厂类本身需要创建对象，因此该对象必须受Spring控制，所以必须配置该工厂类为Bean.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">!—实例化工厂Bean</span> <span class=\"attr\">--</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"uf\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.bean.UserFactory\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!--使用实例工厂创建Bean --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!--factory-bean: 配置实例工厂在Spring范围内对应的Bean的id名称--&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!--factory-method：配置工厂类中的创建实例的实例方法--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"userService3\"</span>  <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"uf\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getInst2\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"5-2-Bean的作用域\"><a href=\"#5-2-Bean的作用域\" class=\"headerlink\" title=\"5.2 Bean的作用域\"></a>5.2 Bean的作用域</h3><p>Spring初始化的Bean默认为单例模式，如果想修改成非单例模式需要修改Bean的作用范围。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">”beanId”</span> <span class=\"attr\">class</span>=<span class=\"string\">”BeanClassName”</span> <span class=\"attr\">scope</span>=<span class=\"string\">”prototype”</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<pre><code>scope属性：\n    singleton：单例\n    prototype：非单例\n    request：请求对象范围request.setAttribute(&quot;beanId&quot;,obj);\n    session：会话Session范围request.getSession().setAttribute(&quot;beanId&quot;,obj);\n    globalSession：全局会话,分布式服务器\n</code></pre><h3 id=\"5-3-Bean的生命周期\"><a href=\"#5-3-Bean的生命周期\" class=\"headerlink\" title=\"5.3 Bean的生命周期\"></a>5.3 Bean的生命周期</h3><p>定义Bean初始化与销毁时的动作，属于回调方法配置<br>定义bean时指定两个回调方法，控制bean的初始化与销毁操作时执行的动作</p>\n<ul>\n<li>init-method：初始化回调方法名，配置的方法必须由bean对象提供</li>\n<li>destroy-method：销毁回调方法名，配置的方法必须由bean对象提供</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.lifecycle.User\"</span> <span class=\"attr\">init-method</span>=<span class=\"string\">\"init\"</span> <span class=\"attr\">destroy-method</span>=<span class=\"string\">\"destroy\"</span> <span class=\"attr\">scope</span>=<span class=\"string\">\"prototype\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<ul>\n<li>销毁操作只针对scope=”singletion”的对象，对于非单例对象无效</li>\n<li>单例对象的销毁是在IoC容器关闭时发生，使用ClassPathXmlApplicationContext对象close方法完成</li>\n<li>非单例Bean对象的内存回收交由JVM完成——GC</li>\n</ul>\n<h3 id=\"5-4-Bean属性注入\"><a href=\"#5-4-Bean属性注入\" class=\"headerlink\" title=\"5.4 Bean属性注入\"></a>5.4 Bean属性注入</h3><ol>\n<li><p>构造器注入（了解）<br>A.在domain中提供对象的构造方法<br>B.xml配置中设置构造方法的参数</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- constructor-arg:使用构造器传递参数  --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- value:赋值 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"bean6\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.bean.xml.Bean6\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">value</span>=<span class=\"string\">\"topvision\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">value</span>=<span class=\"string\">\"2017\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>注意：如果类型匹配不成功，可以为配置中指定index索引属性，对应构造器中参数的位置.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"bean6\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.bean.xml.Bean6\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">index</span>=<span class=\"string\">\"0\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"2014\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"java.lang.Integer\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">constructor-arg</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">index</span>=<span class=\"string\">\"1\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"topvision\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"java.lang.String\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">constructor-arg</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>说明：构造器传参受构造器参数位置和类型的限定，因此不常使用</p>\n</li>\n<li><p>setter注入<br><strong>前提：setter注入要求Bean必须提供无参可访问构造方法</strong></p>\n<p>A.注入简单类型</p>\n<pre><code>1.提供对应要注入的属性\n2.为每个要注入的属性提供对应的标准封装setter方法\n3.在配置中为Bean指定要注入的属性，使用property元素 name=“属性名” value=”值”\n</code></pre><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"属性名\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"值\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>B.注入引用类型</p>\n<pre><code>1.为某个Bean注入引用类型的值，首先在Bean对应的类中声明对应的属性\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"keyword\">private</span> TeacherDAO dao;</div><div class=\"line\">   ``` </div><div class=\"line\"></div><div class=\"line\">\t<span class=\"number\">2</span>.为每个要注入的属性提供对应的标准封装setter方法 (访问器)</div><div class=\"line\">   ```<span class=\"function\">xml</span></div><div class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setDao</span><span class=\"params\">(TeacherDAO dao)</span> &#123;</div><div class=\"line\">\t<span class=\"keyword\">this</span>.dao = dao;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<pre><code>3.必须保障引入的对象是Spring控制的Bean\n</code></pre><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 声明引用类型的资源为Bean --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"teacherDao\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.di.setter.TeacherDAO\"</span>&gt;</span>\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<pre><code>4.在Bean的属性注入中，使用ref引用对应的资源 ref=”beanId/beanName”\n</code></pre><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"comment\">&lt;!-- setter注入 --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- name:属性名 --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- value:简单类型的值 --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- ref:引用别的Bean，beanId/beanName --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"bean7\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.bean.xml.Bean7\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"name\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"topvision\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"age\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"8\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dao\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"teacherDao\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"6-Bean配置（注解）\"><a href=\"#6-Bean配置（注解）\" class=\"headerlink\" title=\"6. Bean配置（注解）\"></a>6. Bean配置（注解）</h2><p>从Spring2.5开始提供使用注解的形式配置Bean。</p>\n<h3 id=\"6-1-配置Bean使用-Component注解\"><a href=\"#6-1-配置Bean使用-Component注解\" class=\"headerlink\" title=\"6.1 配置Bean使用@Component注解\"></a>6.1 配置Bean使用@Component注解</h3><p>如需为Bean定义名称，在参数中添加Bean名称@Component(“beanName”)</p>\n<h3 id=\"6-2-设定Spring的自动扫描路径\"><a href=\"#6-2-设定Spring的自动扫描路径\" class=\"headerlink\" title=\"6.2 设定Spring的自动扫描路径\"></a>6.2 设定Spring的自动扫描路径</h3><p>用于检测对应的Bean是否配置了注解，并加载配置了注解的类</p>\n<ul>\n<li><p>开启context空间的支持</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">  \t<span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">   \t<span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span> </div><div class=\"line\">   \t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"</span></div><div class=\"line\">\thttp://www.springframework.org/schema/beans </div><div class=\"line\">\thttp://www.springframework.org/schema/beans/spring-beans.xsd</div><div class=\"line\">\thttp://www.springframework.org/schema/context \t\t\t\t\t</div><div class=\"line\">\thttp://www.springframework.org/schema/context/spring-context.xsd\"&gt;</div></pre></td></tr></table></figure>\n</li>\n<li><p>开启自动扫描功能，并指定扫描的路径</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.annotation\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">context:component-scan</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>说明：扫描路径可以设置多个，中间使用,隔开，扫描路径包含指定包和子包内所有的类,通常使用*号通配符匹配路径</p>\n<h3 id=\"6-3-Spring提供的三个注解\"><a href=\"#6-3-Spring提供的三个注解\" class=\"headerlink\" title=\"6.3 Spring提供的三个注解\"></a>6.3 Spring提供的三个注解</h3><ol>\n<li>@Repository 用于数据层实现类标注</li>\n<li>@Service 用于业务逻辑层实现类标注</li>\n<li>@Controller 用于控制层实现类进行标注</li>\n</ol>\n<h3 id=\"6-4-注入简单类型\"><a href=\"#6-4-注入简单类型\" class=\"headerlink\" title=\"6.4 注入简单类型\"></a>6.4 注入简单类型</h3><ol>\n<li>在属性名上方声明该属性自动装配@Autowired</li>\n<li>在属性名上方声明该属性注入的值@Value(value)<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Autowired</span></div><div class=\"line\"><span class=\"meta\">@Value</span>(<span class=\"string\">\"topvision\"</span>)</div><div class=\"line\"><span class=\"keyword\">private</span> String msg;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>注意：注解自动装配属性值无需提供对应属性的setter方法</p>\n<h3 id=\"6-5-注入引用类型\"><a href=\"#6-5-注入引用类型\" class=\"headerlink\" title=\"6.5 注入引用类型\"></a>6.5 注入引用类型</h3><ul>\n<li>在属性名上方声明该属性自动装配@Autowired</li>\n<li>在属性名上方声明该属性注入的值@Qualifier(bean引用名称)<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Autowired</span></div><div class=\"line\"><span class=\"meta\">@Qualifier</span>(<span class=\"string\">\"anno2\"</span>)</div><div class=\"line\"><span class=\"keyword\">private</span> AnnotationOther other;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"6-6-Autowired\"><a href=\"#6-6-Autowired\" class=\"headerlink\" title=\"6.6 Autowired\"></a>6.6 Autowired</h3><p>Autowired的required属性用用于声明自动装配的数据是必须的。</p>\n<ol>\n<li>如果required=true，必须为其装配数据，如果没有值，抛出异常</li>\n<li>如果required=false，自动装配数据失败，则注入值为null</li>\n</ol>\n<h3 id=\"6-7-Resource\"><a href=\"#6-7-Resource\" class=\"headerlink\" title=\"6.7 Resource\"></a>6.7 Resource</h3><ol>\n<li>格式一：@Resource(name=”myImpl”)</li>\n<li>格式二：@Autowired(required=false)<br>　　　　@Qualifier(“myImpl”)<br>以上两种格式效果相同</li>\n</ol>\n<h3 id=\"6-8-Bean声明周期注解\"><a href=\"#6-8-Bean声明周期注解\" class=\"headerlink\" title=\"6.8 Bean声明周期注解\"></a>6.8 Bean声明周期注解</h3><ol>\n<li>@PostConstruct<br>功能：为当前Bean指定init-method参数<br>格式：定义在成员方法的上方，兼容静态方法</li>\n<li>@PreDestroy<br>功能：为当前Bean指定destory-method参数<br>格式：定义在成员方法的上方，兼容静态方法<br>注意：要求当前类被注册为Bean，否则无效果</li>\n</ol>\n<h3 id=\"6-9-Bean作用域注解\"><a href=\"#6-9-Bean作用域注解\" class=\"headerlink\" title=\"6.9 Bean作用域注解\"></a>6.9 Bean作用域注解</h3><p>在类的定义上方添加@Scope指定Bean的作用域<br>常用：@Scope(“prototype”)<br>默认：@Scope(“singleton”)</p>\n<h3 id=\"6-10-配置类注解\"><a href=\"#6-10-配置类注解\" class=\"headerlink\" title=\"6.10 配置类注解\"></a>6.10 配置类注解</h3><p><strong>@Configuration</strong>配置当前类为配置类，用于加载其中配置的Bean，与静态工厂初始化Bean很相似<br><strong>@Bean(name=”b1”)</strong>将配置类中的某个方法的返回值声明为Bean，该方法必须返回一个对象<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Configuration</span>\t\t\t<span class=\"comment\">//设定该类参与自动扫描</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyBeanFactory</span> </span>&#123;</div><div class=\"line\">\t<span class=\"meta\">@Bean</span>(name=&#123;<span class=\"string\">\"aa\"</span>,<span class=\"string\">\"bb\"</span>,<span class=\"string\">\"cc\"</span>&#125;)<span class=\"comment\">//设定该方法的返回值是一个Bean</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> BookService <span class=\"title\">getInst</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> BookService();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>以上操作必须基于自动扫描功能，如不开启自动扫描，Spring将无法查找到对应的注解配置</p>\n<h3 id=\"6-11-AnnotationConfigApplicationContext不使用自动扫描\"><a href=\"#6-11-AnnotationConfigApplicationContext不使用自动扫描\" class=\"headerlink\" title=\"6.11 AnnotationConfigApplicationContext不使用自动扫描\"></a>6.11 AnnotationConfigApplicationContext不使用自动扫描</h3><p>AnnotationConfigApplicationContext对象可以手工加载基于注解配置的Bean<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//用于手工添加注解开发Bean的上下文对象</span></div><div class=\"line\">AnnotationConfigApplicationContext ctx = <span class=\"keyword\">new</span> AnnotationConfigApplicationContext();</div><div class=\"line\"><span class=\"comment\">//加载配置管理类</span></div><div class=\"line\">ctx.register(MyConfiguration.class);</div><div class=\"line\"><span class=\"comment\">//刷新上下文对象</span></div><div class=\"line\">ctx.refresh();</div></pre></td></tr></table></figure></p>\n<p>注意：注册完成后一定要进行刷新，否则加载的Bean将无法被使用</p>\n<h2 id=\"博客链接\"><a href=\"#博客链接\" class=\"headerlink\" title=\"博客链接\"></a>博客链接</h2><ol>\n<li><a href=\"http://www.cnblogs.com/ITtangtang/p/3978349.html\" target=\"_blank\" rel=\"noopener\">源码解读Spring IOC原理</a></li>\n<li><a href=\"http://www.cnblogs.com/dazhaxie/archive/2012/06/18/2553300.html\" target=\"_blank\" rel=\"noopener\">Spring源代码解析</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>这篇博客简单分析了IOC和DI的原理及区别，并介绍了基于xml和注解的Bean配置方式。<br>","more":"</p>\n<h2 id=\"1-什么是IOC\"><a href=\"#1-什么是IOC\" class=\"headerlink\" title=\"1. 什么是IOC?\"></a>1. 什么是IOC?</h2><h3 id=\"1-1-IoC-Inversion-of-Control-控制反转\"><a href=\"#1-1-IoC-Inversion-of-Control-控制反转\" class=\"headerlink\" title=\"1.1 IoC(Inversion of Control)控制反转\"></a>1.1 IoC(Inversion of Control)控制反转</h3><ul>\n<li>控制:控制的双方是什么？谁控制谁？<ul>\n<li>主控方：Spring</li>\n<li>被控方：应用程序所使用的资源</li>\n<li>(原始)应用程序控制自己执行操作需要使用的外部资源</li>\n<li>(Spring)Spring控制整个程序中所需要使用的外部资源</li>\n</ul>\n</li>\n<li>反转:什么是反转？反转什么？<ul>\n<li>正向：应用程序直接调用资源</li>\n<li>反向：应用程序依赖Spring为其提供资源</li>\n<li>反转的是资源的控制权</li>\n<li>应用程序由主动调用资源，变为被动的等待Spring提供资源</li>\n</ul>\n</li>\n<li>有什么好处？<ul>\n<li>正向缺点：应用程序控制的资源分布在程序的每一个地方</li>\n<li>反向的优点：所有的资源都在Spring中，便于管理</li>\n<li>总结：Spring反向控制应用程序所需要使用的外部资源。资源受Spring管理，利用率最大化。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"1-2-spring演进模式\"><a href=\"#1-2-spring演进模式\" class=\"headerlink\" title=\"1.2 spring演进模式\"></a>1.2 spring演进模式</h3><pre><code>A.基于分层设计\n    UserAction            使用UserService,new UserService()\n    UserService            使用UserDAO,new UserDAO()\n    UserDAO\nB.工厂模式，使用面向接口编程设计，解决层与层之间的紧耦合\n    制作接口，制作实现类，制作对象工厂\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">A a = AFactory.createA();  </div><div class=\"line\">B b = BFactory.createB();  </div><div class=\"line\">a.setB(b);</div></pre></td></tr></table></figure>\n<pre><code>C.工厂模式+配置\n    制作XML文件，将实现类配置到XML文件中\n    读取XML文件中的配置信息，得到实现类的类名\n    使用反射思想，获取实现类对象 class.newInstance();\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">A a = Factory.create(“a”);  </div><div class=\"line\">B b = Factory.create(“b”);  </div><div class=\"line\">a.setB(b);</div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--配置xml--&gt;</span></div><div class=\"line\">a=AImpl  </div><div class=\"line\">b=BImpl</div></pre></td></tr></table></figure>\n<pre><code>D.自动的工厂+配置\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//返回装配好的a   </span></div><div class=\"line\">A a = Factory.create(“a”);</div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--xml配置--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">“a”</span> <span class=\"attr\">class</span>=<span class=\"string\">“AImpl”</span>&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">“b”</span> <span class=\"attr\">ref</span>=<span class=\"string\">“b”/</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">“b”</span> <span class=\"attr\">class</span>=<span class=\"string\">“BImpl”/</span>&gt;</span></div></pre></td></tr></table></figure>\n<pre><code>E.工厂由Spring提供，实现类使用XML格式配置\n    工厂由Spring提供，实现类使用XML格式配置\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//返回装配好的a   </span></div><div class=\"line\">A a = ApplicationContext.getBean(“a”);</div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--xml配置--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">“a”</span> <span class=\"attr\">class</span>=<span class=\"string\">“AImpl”</span>&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">“b”</span> <span class=\"attr\">ref</span>=<span class=\"string\">“b”/</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">“b”</span> <span class=\"attr\">class</span>=<span class=\"string\">“BImpl”/</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"2-什么是DI？\"><a href=\"#2-什么是DI？\" class=\"headerlink\" title=\"2. 什么是DI？\"></a>2. 什么是DI？</h2><h3 id=\"2-1-DI的概念\"><a href=\"#2-1-DI的概念\" class=\"headerlink\" title=\"2.1 DI的概念\"></a>2.1 DI的概念</h3><p>DI(Dependency Injection)依赖注入，指应用程序依赖Spring为其提供运行时所需的资源.</p>\n<ul>\n<li>谁依赖于谁？            ——-   应用程序依赖于IoC容器</li>\n<li>为什么需要依赖？        ——-   应用程序依赖于IoC容器装配类之间的关系</li>\n<li>依赖什么东西？          ——-   依赖了IoC容器的装配功能</li>\n<li>谁注入于谁？            ——-   IoC容器注入应用程序</li>\n<li>注入什么东西？          ——-   注入应用程序需要的资源（类之间的关系）</li>\n</ul>\n<p>更能描述容器其特点的名字——“依赖注入”（Dependency Injection）<br>IoC容器应该具有依赖注入功能，因此也可以叫DI容器 </p>\n<h3 id=\"2-2-DI实现方式\"><a href=\"#2-2-DI实现方式\" class=\"headerlink\" title=\"2.2 DI实现方式\"></a>2.2 DI实现方式</h3><ol>\n<li>构造器注入</li>\n<li>setter注入</li>\n<li>接口注入</li>\n</ol>\n<h2 id=\"3-IOC和DI的关系？\"><a href=\"#3-IOC和DI的关系？\" class=\"headerlink\" title=\"3. IOC和DI的关系？\"></a>3. IOC和DI的关系？</h2><p>IOC和DI其实是同一概念的两种说法，两者站立的角度不一样。<br>IOC：从spring的角度看，资源的控制权限被反转了<br>DI：从应用程序的角度看，应用程序要依赖spring为其注入资源。</p>\n<h2 id=\"4-BeanFactory\"><a href=\"#4-BeanFactory\" class=\"headerlink\" title=\"4. BeanFactory\"></a>4. BeanFactory</h2><ol>\n<li>BeanFactory是ApplicationContext的顶层父接口，使用BeanFactory接口也可以完成获取Bean的操作.</li>\n<li>操作步骤:<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//初始化Resource对象</span></div><div class=\"line\">Resource res = <span class=\"keyword\">new</span> ClassPathResource(<span class=\"string\">\"applicationContext.xml\"</span>);</div><div class=\"line\"><span class=\"comment\">//初始化BeanFactory对象</span></div><div class=\"line\">BeanFactory bf = <span class=\"keyword\">new</span> XmlBeanFactory(res);</div><div class=\"line\"><span class=\"comment\">//根据id名称获取Bean</span></div><div class=\"line\">UserService service = (UserService) bf.getBean(<span class=\"string\">\"userService\"</span>);</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>AppplicationContext与BeanFactory的区别<br>A. 加载方式不同</p>\n<pre><code>AppplicationContext：立即加载，加载配置文件时即加载\nBeanFactory:延迟加载，获取Bean实例时才加载\n</code></pre><p>B. AppplicationContext具有更多的功能</p>\n<pre><code>国际化处理\n事件传递\nBean自动装配\n各种不同应用层的Context实现\n注意：实际开发中，优先选择ApplicationContext对象，避免使用BeanFactory\n</code></pre></li>\n<li><p>Schema风格离线约束配置方式</p>\n<pre><code>A.拷贝访问路径\nB.打开MyEclipse设置中的XML catalog选项\nC.创建新的映射\nD.选择对应的schema风格的约束文件\nE.将key type修改为schema location\nF.将要配置的路径复制到key中\n</code></pre></li>\n</ol>\n<h2 id=\"5-Bean配置（XML）\"><a href=\"#5-Bean配置（XML）\" class=\"headerlink\" title=\"5. Bean配置（XML）\"></a>5. Bean配置（XML）</h2><h3 id=\"5-1-Bean初始化\"><a href=\"#5-1-Bean初始化\" class=\"headerlink\" title=\"5.1 Bean初始化\"></a>5.1 Bean初始化</h3><ol>\n<li>构造器初始化（重点）<br><strong>Bean对应的类必须提供一个默认无参可访问的构造方法</strong></li>\n<li><p>静态工厂初始化</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;bean id=\"userService2\" </div><div class=\"line\">    &lt;!--配置中所配置的class配置成工厂类的类名--&gt;</div><div class=\"line\">    class=\"com.topvision.bean.UserStataicFactory\"</div><div class=\"line\">    &lt;!--配置工厂类中的创建实例的静态方法--&gt;</div><div class=\"line\">    factory-method=\"getInst\"&gt;</div><div class=\"line\">&lt;/bean&gt;</div></pre></td></tr></table></figure>\n</li>\n<li><p>实例工厂初始化<br>提供一个实例工厂类，使用其中的实例方法获取对象。由于该工厂类本身需要创建对象，因此该对象必须受Spring控制，所以必须配置该工厂类为Bean.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">!—实例化工厂Bean</span> <span class=\"attr\">--</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"uf\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.bean.UserFactory\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!--使用实例工厂创建Bean --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!--factory-bean: 配置实例工厂在Spring范围内对应的Bean的id名称--&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!--factory-method：配置工厂类中的创建实例的实例方法--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"userService3\"</span>  <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"uf\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getInst2\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"5-2-Bean的作用域\"><a href=\"#5-2-Bean的作用域\" class=\"headerlink\" title=\"5.2 Bean的作用域\"></a>5.2 Bean的作用域</h3><p>Spring初始化的Bean默认为单例模式，如果想修改成非单例模式需要修改Bean的作用范围。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">”beanId”</span> <span class=\"attr\">class</span>=<span class=\"string\">”BeanClassName”</span> <span class=\"attr\">scope</span>=<span class=\"string\">”prototype”</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<pre><code>scope属性：\n    singleton：单例\n    prototype：非单例\n    request：请求对象范围request.setAttribute(&quot;beanId&quot;,obj);\n    session：会话Session范围request.getSession().setAttribute(&quot;beanId&quot;,obj);\n    globalSession：全局会话,分布式服务器\n</code></pre><h3 id=\"5-3-Bean的生命周期\"><a href=\"#5-3-Bean的生命周期\" class=\"headerlink\" title=\"5.3 Bean的生命周期\"></a>5.3 Bean的生命周期</h3><p>定义Bean初始化与销毁时的动作，属于回调方法配置<br>定义bean时指定两个回调方法，控制bean的初始化与销毁操作时执行的动作</p>\n<ul>\n<li>init-method：初始化回调方法名，配置的方法必须由bean对象提供</li>\n<li>destroy-method：销毁回调方法名，配置的方法必须由bean对象提供</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.lifecycle.User\"</span> <span class=\"attr\">init-method</span>=<span class=\"string\">\"init\"</span> <span class=\"attr\">destroy-method</span>=<span class=\"string\">\"destroy\"</span> <span class=\"attr\">scope</span>=<span class=\"string\">\"prototype\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<ul>\n<li>销毁操作只针对scope=”singletion”的对象，对于非单例对象无效</li>\n<li>单例对象的销毁是在IoC容器关闭时发生，使用ClassPathXmlApplicationContext对象close方法完成</li>\n<li>非单例Bean对象的内存回收交由JVM完成——GC</li>\n</ul>\n<h3 id=\"5-4-Bean属性注入\"><a href=\"#5-4-Bean属性注入\" class=\"headerlink\" title=\"5.4 Bean属性注入\"></a>5.4 Bean属性注入</h3><ol>\n<li><p>构造器注入（了解）<br>A.在domain中提供对象的构造方法<br>B.xml配置中设置构造方法的参数</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- constructor-arg:使用构造器传递参数  --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- value:赋值 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"bean6\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.bean.xml.Bean6\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">value</span>=<span class=\"string\">\"topvision\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">value</span>=<span class=\"string\">\"2017\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>注意：如果类型匹配不成功，可以为配置中指定index索引属性，对应构造器中参数的位置.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"bean6\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.bean.xml.Bean6\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">index</span>=<span class=\"string\">\"0\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"2014\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"java.lang.Integer\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">constructor-arg</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">index</span>=<span class=\"string\">\"1\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"topvision\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"java.lang.String\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">constructor-arg</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>说明：构造器传参受构造器参数位置和类型的限定，因此不常使用</p>\n</li>\n<li><p>setter注入<br><strong>前提：setter注入要求Bean必须提供无参可访问构造方法</strong></p>\n<p>A.注入简单类型</p>\n<pre><code>1.提供对应要注入的属性\n2.为每个要注入的属性提供对应的标准封装setter方法\n3.在配置中为Bean指定要注入的属性，使用property元素 name=“属性名” value=”值”\n</code></pre><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"属性名\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"值\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>B.注入引用类型</p>\n<pre><code>1.为某个Bean注入引用类型的值，首先在Bean对应的类中声明对应的属性\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"keyword\">private</span> TeacherDAO dao;</div><div class=\"line\">   ``` </div><div class=\"line\"></div><div class=\"line\">\t<span class=\"number\">2</span>.为每个要注入的属性提供对应的标准封装setter方法 (访问器)</div><div class=\"line\">   ```<span class=\"function\">xml</span></div><div class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setDao</span><span class=\"params\">(TeacherDAO dao)</span> &#123;</div><div class=\"line\">\t<span class=\"keyword\">this</span>.dao = dao;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<pre><code>3.必须保障引入的对象是Spring控制的Bean\n</code></pre><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 声明引用类型的资源为Bean --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"teacherDao\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.di.setter.TeacherDAO\"</span>&gt;</span>\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<pre><code>4.在Bean的属性注入中，使用ref引用对应的资源 ref=”beanId/beanName”\n</code></pre><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"comment\">&lt;!-- setter注入 --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- name:属性名 --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- value:简单类型的值 --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- ref:引用别的Bean，beanId/beanName --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"bean7\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.bean.xml.Bean7\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"name\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"topvision\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"age\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"8\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dao\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"teacherDao\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"6-Bean配置（注解）\"><a href=\"#6-Bean配置（注解）\" class=\"headerlink\" title=\"6. Bean配置（注解）\"></a>6. Bean配置（注解）</h2><p>从Spring2.5开始提供使用注解的形式配置Bean。</p>\n<h3 id=\"6-1-配置Bean使用-Component注解\"><a href=\"#6-1-配置Bean使用-Component注解\" class=\"headerlink\" title=\"6.1 配置Bean使用@Component注解\"></a>6.1 配置Bean使用@Component注解</h3><p>如需为Bean定义名称，在参数中添加Bean名称@Component(“beanName”)</p>\n<h3 id=\"6-2-设定Spring的自动扫描路径\"><a href=\"#6-2-设定Spring的自动扫描路径\" class=\"headerlink\" title=\"6.2 设定Spring的自动扫描路径\"></a>6.2 设定Spring的自动扫描路径</h3><p>用于检测对应的Bean是否配置了注解，并加载配置了注解的类</p>\n<ul>\n<li><p>开启context空间的支持</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">  \t<span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">   \t<span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span> </div><div class=\"line\">   \t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"</span></div><div class=\"line\">\thttp://www.springframework.org/schema/beans </div><div class=\"line\">\thttp://www.springframework.org/schema/beans/spring-beans.xsd</div><div class=\"line\">\thttp://www.springframework.org/schema/context \t\t\t\t\t</div><div class=\"line\">\thttp://www.springframework.org/schema/context/spring-context.xsd\"&gt;</div></pre></td></tr></table></figure>\n</li>\n<li><p>开启自动扫描功能，并指定扫描的路径</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.annotation\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">context:component-scan</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>说明：扫描路径可以设置多个，中间使用,隔开，扫描路径包含指定包和子包内所有的类,通常使用*号通配符匹配路径</p>\n<h3 id=\"6-3-Spring提供的三个注解\"><a href=\"#6-3-Spring提供的三个注解\" class=\"headerlink\" title=\"6.3 Spring提供的三个注解\"></a>6.3 Spring提供的三个注解</h3><ol>\n<li>@Repository 用于数据层实现类标注</li>\n<li>@Service 用于业务逻辑层实现类标注</li>\n<li>@Controller 用于控制层实现类进行标注</li>\n</ol>\n<h3 id=\"6-4-注入简单类型\"><a href=\"#6-4-注入简单类型\" class=\"headerlink\" title=\"6.4 注入简单类型\"></a>6.4 注入简单类型</h3><ol>\n<li>在属性名上方声明该属性自动装配@Autowired</li>\n<li>在属性名上方声明该属性注入的值@Value(value)<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Autowired</span></div><div class=\"line\"><span class=\"meta\">@Value</span>(<span class=\"string\">\"topvision\"</span>)</div><div class=\"line\"><span class=\"keyword\">private</span> String msg;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>注意：注解自动装配属性值无需提供对应属性的setter方法</p>\n<h3 id=\"6-5-注入引用类型\"><a href=\"#6-5-注入引用类型\" class=\"headerlink\" title=\"6.5 注入引用类型\"></a>6.5 注入引用类型</h3><ul>\n<li>在属性名上方声明该属性自动装配@Autowired</li>\n<li>在属性名上方声明该属性注入的值@Qualifier(bean引用名称)<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Autowired</span></div><div class=\"line\"><span class=\"meta\">@Qualifier</span>(<span class=\"string\">\"anno2\"</span>)</div><div class=\"line\"><span class=\"keyword\">private</span> AnnotationOther other;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"6-6-Autowired\"><a href=\"#6-6-Autowired\" class=\"headerlink\" title=\"6.6 Autowired\"></a>6.6 Autowired</h3><p>Autowired的required属性用用于声明自动装配的数据是必须的。</p>\n<ol>\n<li>如果required=true，必须为其装配数据，如果没有值，抛出异常</li>\n<li>如果required=false，自动装配数据失败，则注入值为null</li>\n</ol>\n<h3 id=\"6-7-Resource\"><a href=\"#6-7-Resource\" class=\"headerlink\" title=\"6.7 Resource\"></a>6.7 Resource</h3><ol>\n<li>格式一：@Resource(name=”myImpl”)</li>\n<li>格式二：@Autowired(required=false)<br>　　　　@Qualifier(“myImpl”)<br>以上两种格式效果相同</li>\n</ol>\n<h3 id=\"6-8-Bean声明周期注解\"><a href=\"#6-8-Bean声明周期注解\" class=\"headerlink\" title=\"6.8 Bean声明周期注解\"></a>6.8 Bean声明周期注解</h3><ol>\n<li>@PostConstruct<br>功能：为当前Bean指定init-method参数<br>格式：定义在成员方法的上方，兼容静态方法</li>\n<li>@PreDestroy<br>功能：为当前Bean指定destory-method参数<br>格式：定义在成员方法的上方，兼容静态方法<br>注意：要求当前类被注册为Bean，否则无效果</li>\n</ol>\n<h3 id=\"6-9-Bean作用域注解\"><a href=\"#6-9-Bean作用域注解\" class=\"headerlink\" title=\"6.9 Bean作用域注解\"></a>6.9 Bean作用域注解</h3><p>在类的定义上方添加@Scope指定Bean的作用域<br>常用：@Scope(“prototype”)<br>默认：@Scope(“singleton”)</p>\n<h3 id=\"6-10-配置类注解\"><a href=\"#6-10-配置类注解\" class=\"headerlink\" title=\"6.10 配置类注解\"></a>6.10 配置类注解</h3><p><strong>@Configuration</strong>配置当前类为配置类，用于加载其中配置的Bean，与静态工厂初始化Bean很相似<br><strong>@Bean(name=”b1”)</strong>将配置类中的某个方法的返回值声明为Bean，该方法必须返回一个对象<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Configuration</span>\t\t\t<span class=\"comment\">//设定该类参与自动扫描</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyBeanFactory</span> </span>&#123;</div><div class=\"line\">\t<span class=\"meta\">@Bean</span>(name=&#123;<span class=\"string\">\"aa\"</span>,<span class=\"string\">\"bb\"</span>,<span class=\"string\">\"cc\"</span>&#125;)<span class=\"comment\">//设定该方法的返回值是一个Bean</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> BookService <span class=\"title\">getInst</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> BookService();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>以上操作必须基于自动扫描功能，如不开启自动扫描，Spring将无法查找到对应的注解配置</p>\n<h3 id=\"6-11-AnnotationConfigApplicationContext不使用自动扫描\"><a href=\"#6-11-AnnotationConfigApplicationContext不使用自动扫描\" class=\"headerlink\" title=\"6.11 AnnotationConfigApplicationContext不使用自动扫描\"></a>6.11 AnnotationConfigApplicationContext不使用自动扫描</h3><p>AnnotationConfigApplicationContext对象可以手工加载基于注解配置的Bean<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//用于手工添加注解开发Bean的上下文对象</span></div><div class=\"line\">AnnotationConfigApplicationContext ctx = <span class=\"keyword\">new</span> AnnotationConfigApplicationContext();</div><div class=\"line\"><span class=\"comment\">//加载配置管理类</span></div><div class=\"line\">ctx.register(MyConfiguration.class);</div><div class=\"line\"><span class=\"comment\">//刷新上下文对象</span></div><div class=\"line\">ctx.refresh();</div></pre></td></tr></table></figure></p>\n<p>注意：注册完成后一定要进行刷新，否则加载的Bean将无法被使用</p>\n<h2 id=\"博客链接\"><a href=\"#博客链接\" class=\"headerlink\" title=\"博客链接\"></a>博客链接</h2><ol>\n<li><a href=\"http://www.cnblogs.com/ITtangtang/p/3978349.html\" target=\"_blank\" rel=\"noopener\">源码解读Spring IOC原理</a></li>\n<li><a href=\"http://www.cnblogs.com/dazhaxie/archive/2012/06/18/2553300.html\" target=\"_blank\" rel=\"noopener\">Spring源代码解析</a></li>\n</ol>"},{"title":"spring(4)——持久层封装","date":"2017-06-16T09:42:52.000Z","_content":"\n这边博客介绍了持久层的集中封装方式。\n<!--more-->\n\n## 1. 持久层访问方式\n![数据访问方式][1]\n\n## 2. JDBC\n\n\n## 3. JDBCTemplete\n### 3.1 原始jdbcTemplete\n```java\nDriverManagerDataSource dataSource = new DriverManagerDataSource();\ndataSource.setDriverClassName(\"com.mysql.jdbc.Driver\");\ndataSource.setUrl(\"jdbc:mysql://localhost:3306/springdb\");\ndataSource.setUsername(\"root\");\ndataSource.setPassword(\"***********\");\n\nJdbcTemplate template = new JdbcTemplate(dataSource);\ntemplate.execute(\"insert into student values(1,'张三',23)\");\n```\n\n### 3.2 Spring开发jdbcTemplete\n\n 1. 设置Bean\n    ```xml\n    <bean id=\"dao\" class=\"com.topvision.daotest.Dao\">\n    \t<property name=\"jdbcTemplate\" ref=\"jdbcTemplate\" />\n    </bean>\n    \n    <bean id=\"jdbcTemplate\" class=\"org.springframework.jdbc.core.JdbcTemplate\">\n    \t<property name=\"dataSource\" ref=\"dataSource\" />\n    </bean>\n    \n    <bean id=\"dataSource\" class=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n    \t<property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n    \t<property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\" />\n    \t<property name=\"username\" value=\"root\" />\n    \t<property name=\"password\" value=\"xiaoyue*AZ2V65\" />\n    </bean>\n    ```\n 2. 编写dao层测试类\n\n    ```java\n    @Test\n    public void Demo1() {\n        ClassPathXmlApplicationContext ctx = new ClassPathXmlApplicationContext(\"jdbcTemplete.xml\");\n        JdbcTemplate jdbcTemplate = (JdbcTemplate) ctx.getBean(\"jdbcTemplate\");\n        jdbcTemplate.execute(\"insert into student values(5,'23423',24)\");\n    }\n    ```\n    或者注解式\n    \n    开启注解扫描\n    ```xml\n    <context:component-scan base-package=\"com.topvision.daotest\"/>\n    ```\n    去掉dao层的bean,即如下配置\n    ```xml\n    <bean id=\"dao\" class=\"com.topvision.daotest.Dao\">\n    \t<property name=\"jdbcTemplate\" ref=\"jdbcTemplate\" />\n    </bean>\n    ```\n    \n    编写测试类\n    ```java\n    @RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations=\"classpath:jdbcTemplete.xml\")\npublic class Dao {\n\t\n    \t@Autowired\n    \tprivate JdbcTemplate jdbcTemplate;\n    \n    \tpublic void setJdbcTemplate(JdbcTemplate jdbcTemplate) {\n    \t\tthis.jdbcTemplate = jdbcTemplate;\n    \t}\n    \t@Test\n    \tpublic void Demo2() {\n    \t\tjdbcTemplate.execute(\"insert into student values(8,'王五',25)\");\n    \t}\n\t}\n    ```\n\n\n## 3. jdbcDaoSupport\nJdbcDaoSupport是JDBC数据访问对象的超类，其实它使用的还是jdbcTemplete，不过需要DI依赖注入dataSource或者jdbcTemplete.\n\n### 3.1 xml方式\n\n 1. xml配置文件\n \n ```xml\n<bean id=\"jdbcDaoSupportTest\" class=\"com.topvision.daotest.JDBCDaoSupportTest\">\n\t\t<bean id=\"jdbcDaoSupportTest\" class=\"com.topvision.daotest.JDBCDaoSupportTest\">\n\t\t<!-- 必须为继承JdbcDaoSupport的类注入JdbcTemplate，变量名为jdbcTemplate -->\n\t\t<!-- <property name=\"jdbcTemplate\" ref=\"jdbcTemplate\"/> -->\n\t\t<!-- 还可以注入DataSource对象，由JdbcDaoSupport自动创建JdbcTemplate对象 -->\n\t\t<property name=\"dataSource\" ref=\"dataSource\" />\n\t</bean>\n\t\n    <bean id=\"dataSource\"\n    \tclass=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n    \t<property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n    \t<property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\" />\n    \t<property name=\"username\" value=\"root\" />\n    \t<property name=\"password\" value=\"*****\" />\n    </bean>\n ```\n 2. 测试类\n \n ```java\n public class JDBCDaoSupportTest extends JdbcDaoSupport{\n\t\n\tprivate static ClassPathXmlApplicationContext ctx;\n\n\t@Test\n\tpublic void Demo2() {\n\t\tctx = new ClassPathXmlApplicationContext(\"jdbcDaoSupport.xml\");\n\t\tJDBCDaoSupportTest bean = (JDBCDaoSupportTest) ctx.getBean(\"jdbcDaoSupportTest\");\n\t\tJdbcTemplate template = bean.getJdbcTemplate();\n\t\tString sql = \"select name from student where id = ?\";\n\t\tString name = template.queryForObject(sql, String.class,1);\n\t\tSystem.out.println(name);\n\t}\n}\n ```\n\n### 3.2 注解方式\n\n 1. xml配置\n \n ```xml\n <bean id=\"dataSource\"\n\tclass=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n\t<property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n\t<property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\" />\n\t<property name=\"username\" value=\"root\" />\n\t<property name=\"password\" value=\"*****\" />\n</bean>\n ```\n \n 2. 测试类\n ```java\n public class JDBCDaoSupportTest extends JdbcDaoSupport{\n\n    \t@Autowired\n    \tprivate DataSource dataSource;\n    \t\n    \t@PostConstruct\n    \tprivate void init() {\n    \t\tsetDataSource(dataSource);\n    \t}\n    \n    \t@Test\n    \tpublic void Demo1() {\n    \t\tJdbcTemplate template = this.getJdbcTemplate();\n    \t\tString sql = \"select name from student where id = ?\";\n    \t\tString name = template.queryForObject(sql, String.class,1);\n    \t\tSystem.out.println(name);\n    \t}\n}\n ```\n \n\n 3. 注入dataSource注意事项\n 查看jdbcDaoSupport源码，可以注入dataSource或者注入jdbcTemplete\n 注入方法有两种：\n \n 构造方法中注入：\n\n    ```java\n    @Autowired\n    UserVODaoImpl(DataSource dataSource) {\n        setDataSource(dataSource);\n    }\n    ```\n 实例化前注入\n \n ```java\n    @Autowired\n    private DataSource dataSource;\n    \n    @PostConstruct\n    private void init() {\n    \tsetDataSource(dataSource);\n    }\n ```\n \n## 4. Hibernate\n## 5. Mybatis\n\n## 6. DataSource\n\n### 6.1 Spring内置DriverManagerDataSource\n\n 1. 资源包\n\n    ```xml\n    <dependency>\n    \t<groupId>org.springframework</groupId>\n    \t<artifactId>spring-jdbc</artifactId>\n    </dependency>\n    ```  \n    \n 2. 配置项\n \n    ```xml\n    <bean id=\"dataSource\" class=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n        <property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n        <property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\"/>\n        <property name=\"username\" value=\"root\" />\n        <property name=\"password\" value=\"****\" />\n    </bean>\n    ```\n    \n    \n### 6.2 DBCP\n\n 3. 资源包\n     \n    ```xml\n    <dependency>\n        <groupId>org.apache.commons</groupId>\n        <artifactId>com.springsource.org.apache.commons.dbcp</artifactId>\n        <version>1.2.2.osgi</version>\n    </dependency>\n    <dependency>\n        <groupId>org.apache.commons</groupId>\n        <artifactId>com.springsource.org.apache.commons.pool</artifactId>\n        <version>1.5.3</version>\n    </dependency>\n    ```  \n    \n\n 4. 配置项\n    \n    ```xml\n\t<bean id=\"dataSource\" class=\"org.apache.commons.dbcp.BasicDataSource\">\n\t\t<property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n\t\t<property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\" />\n\t\t<property name=\"username\" value=\"root\" />\n\t\t<property name=\"password\" value=\"*****\" />\n\t</bean>\n    ```\n### 6.3 C3P0\n\n 5. 资源包\n     \n    ```xml\n    <dependency>\n\t\t<groupId>com.mchange.c3p0</groupId>\n\t\t<artifactId>com.springsource.com.mchange.v2.c3p0</artifactId>\n\t\t<version>0.9.1.2</version>\n\t</dependency>\n    ```  \n    \n\n 6. 配置项\n    \n    ```xml\n\t<bean id=\"dataSource3\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\">\n\t\t<property name=\"driverClass\" value=\"${driverClass}\" />\n\t\t<property name=\"jdbcUrl\" value=\"${url}\" />\n\t\t<property name=\"user\" value=\"${jdbc_username}\" />\n\t\t<property name=\"password\" value=\"${password}\" />\n\t</bean>\n    ```\n    \n### 6.4 外部properties输入参数\n\n 1. 编写properties文件(jdbc.properties)\n \n ```properties\ndriverClass=com.mysql.jdbc.Driver\nurl=jdbc:mysql://localhost:3306/springdb\njdbc_username=root\npassword=*****\n ```\n\n 2. 在spring配置文件中扫描properties\n \n 方式一：可用*匹配加载多个\n ```xml\n <context:property-placeholder location=\"classpath:jdbc.properties\"/>\n ```\n 方式二：一个property对应一个文件\n ```xml\n <bean class=\"org.springframework.beans.factory.config.PropertyPlaceholdeConfigurer\">\n\t\t<property name=\"location\" value=\"classpath:jdbc.properties\" />\n\t\t<property name=\"location\" value=\"classpath:dsafgusd\" />\n\t</bean>\n ```\n 3. 用&{key}的方式引入\n \n```xml\n<bean id=\"dataSource3\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\">\n\t<property name=\"driverClass\" value=\"${driverClass}\" />\n\t<property name=\"jdbcUrl\" value=\"${url}\" />\n\t<property name=\"user\" value=\"${jdbc_username}\" />\n\t<property name=\"password\" value=\"${password}\" />\n</bean>\n```\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/Spring/DataAccess.png","source":"_posts/spring-4-——持久层封装.md","raw":"---\ntitle: spring(4)——持久层封装\ndate: 2017-06-16 17:42:52\ncategories:\n  - Spring\ntags:\n  - Spring\n---\n\n这边博客介绍了持久层的集中封装方式。\n<!--more-->\n\n## 1. 持久层访问方式\n![数据访问方式][1]\n\n## 2. JDBC\n\n\n## 3. JDBCTemplete\n### 3.1 原始jdbcTemplete\n```java\nDriverManagerDataSource dataSource = new DriverManagerDataSource();\ndataSource.setDriverClassName(\"com.mysql.jdbc.Driver\");\ndataSource.setUrl(\"jdbc:mysql://localhost:3306/springdb\");\ndataSource.setUsername(\"root\");\ndataSource.setPassword(\"***********\");\n\nJdbcTemplate template = new JdbcTemplate(dataSource);\ntemplate.execute(\"insert into student values(1,'张三',23)\");\n```\n\n### 3.2 Spring开发jdbcTemplete\n\n 1. 设置Bean\n    ```xml\n    <bean id=\"dao\" class=\"com.topvision.daotest.Dao\">\n    \t<property name=\"jdbcTemplate\" ref=\"jdbcTemplate\" />\n    </bean>\n    \n    <bean id=\"jdbcTemplate\" class=\"org.springframework.jdbc.core.JdbcTemplate\">\n    \t<property name=\"dataSource\" ref=\"dataSource\" />\n    </bean>\n    \n    <bean id=\"dataSource\" class=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n    \t<property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n    \t<property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\" />\n    \t<property name=\"username\" value=\"root\" />\n    \t<property name=\"password\" value=\"xiaoyue*AZ2V65\" />\n    </bean>\n    ```\n 2. 编写dao层测试类\n\n    ```java\n    @Test\n    public void Demo1() {\n        ClassPathXmlApplicationContext ctx = new ClassPathXmlApplicationContext(\"jdbcTemplete.xml\");\n        JdbcTemplate jdbcTemplate = (JdbcTemplate) ctx.getBean(\"jdbcTemplate\");\n        jdbcTemplate.execute(\"insert into student values(5,'23423',24)\");\n    }\n    ```\n    或者注解式\n    \n    开启注解扫描\n    ```xml\n    <context:component-scan base-package=\"com.topvision.daotest\"/>\n    ```\n    去掉dao层的bean,即如下配置\n    ```xml\n    <bean id=\"dao\" class=\"com.topvision.daotest.Dao\">\n    \t<property name=\"jdbcTemplate\" ref=\"jdbcTemplate\" />\n    </bean>\n    ```\n    \n    编写测试类\n    ```java\n    @RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations=\"classpath:jdbcTemplete.xml\")\npublic class Dao {\n\t\n    \t@Autowired\n    \tprivate JdbcTemplate jdbcTemplate;\n    \n    \tpublic void setJdbcTemplate(JdbcTemplate jdbcTemplate) {\n    \t\tthis.jdbcTemplate = jdbcTemplate;\n    \t}\n    \t@Test\n    \tpublic void Demo2() {\n    \t\tjdbcTemplate.execute(\"insert into student values(8,'王五',25)\");\n    \t}\n\t}\n    ```\n\n\n## 3. jdbcDaoSupport\nJdbcDaoSupport是JDBC数据访问对象的超类，其实它使用的还是jdbcTemplete，不过需要DI依赖注入dataSource或者jdbcTemplete.\n\n### 3.1 xml方式\n\n 1. xml配置文件\n \n ```xml\n<bean id=\"jdbcDaoSupportTest\" class=\"com.topvision.daotest.JDBCDaoSupportTest\">\n\t\t<bean id=\"jdbcDaoSupportTest\" class=\"com.topvision.daotest.JDBCDaoSupportTest\">\n\t\t<!-- 必须为继承JdbcDaoSupport的类注入JdbcTemplate，变量名为jdbcTemplate -->\n\t\t<!-- <property name=\"jdbcTemplate\" ref=\"jdbcTemplate\"/> -->\n\t\t<!-- 还可以注入DataSource对象，由JdbcDaoSupport自动创建JdbcTemplate对象 -->\n\t\t<property name=\"dataSource\" ref=\"dataSource\" />\n\t</bean>\n\t\n    <bean id=\"dataSource\"\n    \tclass=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n    \t<property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n    \t<property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\" />\n    \t<property name=\"username\" value=\"root\" />\n    \t<property name=\"password\" value=\"*****\" />\n    </bean>\n ```\n 2. 测试类\n \n ```java\n public class JDBCDaoSupportTest extends JdbcDaoSupport{\n\t\n\tprivate static ClassPathXmlApplicationContext ctx;\n\n\t@Test\n\tpublic void Demo2() {\n\t\tctx = new ClassPathXmlApplicationContext(\"jdbcDaoSupport.xml\");\n\t\tJDBCDaoSupportTest bean = (JDBCDaoSupportTest) ctx.getBean(\"jdbcDaoSupportTest\");\n\t\tJdbcTemplate template = bean.getJdbcTemplate();\n\t\tString sql = \"select name from student where id = ?\";\n\t\tString name = template.queryForObject(sql, String.class,1);\n\t\tSystem.out.println(name);\n\t}\n}\n ```\n\n### 3.2 注解方式\n\n 1. xml配置\n \n ```xml\n <bean id=\"dataSource\"\n\tclass=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n\t<property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n\t<property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\" />\n\t<property name=\"username\" value=\"root\" />\n\t<property name=\"password\" value=\"*****\" />\n</bean>\n ```\n \n 2. 测试类\n ```java\n public class JDBCDaoSupportTest extends JdbcDaoSupport{\n\n    \t@Autowired\n    \tprivate DataSource dataSource;\n    \t\n    \t@PostConstruct\n    \tprivate void init() {\n    \t\tsetDataSource(dataSource);\n    \t}\n    \n    \t@Test\n    \tpublic void Demo1() {\n    \t\tJdbcTemplate template = this.getJdbcTemplate();\n    \t\tString sql = \"select name from student where id = ?\";\n    \t\tString name = template.queryForObject(sql, String.class,1);\n    \t\tSystem.out.println(name);\n    \t}\n}\n ```\n \n\n 3. 注入dataSource注意事项\n 查看jdbcDaoSupport源码，可以注入dataSource或者注入jdbcTemplete\n 注入方法有两种：\n \n 构造方法中注入：\n\n    ```java\n    @Autowired\n    UserVODaoImpl(DataSource dataSource) {\n        setDataSource(dataSource);\n    }\n    ```\n 实例化前注入\n \n ```java\n    @Autowired\n    private DataSource dataSource;\n    \n    @PostConstruct\n    private void init() {\n    \tsetDataSource(dataSource);\n    }\n ```\n \n## 4. Hibernate\n## 5. Mybatis\n\n## 6. DataSource\n\n### 6.1 Spring内置DriverManagerDataSource\n\n 1. 资源包\n\n    ```xml\n    <dependency>\n    \t<groupId>org.springframework</groupId>\n    \t<artifactId>spring-jdbc</artifactId>\n    </dependency>\n    ```  \n    \n 2. 配置项\n \n    ```xml\n    <bean id=\"dataSource\" class=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n        <property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n        <property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\"/>\n        <property name=\"username\" value=\"root\" />\n        <property name=\"password\" value=\"****\" />\n    </bean>\n    ```\n    \n    \n### 6.2 DBCP\n\n 3. 资源包\n     \n    ```xml\n    <dependency>\n        <groupId>org.apache.commons</groupId>\n        <artifactId>com.springsource.org.apache.commons.dbcp</artifactId>\n        <version>1.2.2.osgi</version>\n    </dependency>\n    <dependency>\n        <groupId>org.apache.commons</groupId>\n        <artifactId>com.springsource.org.apache.commons.pool</artifactId>\n        <version>1.5.3</version>\n    </dependency>\n    ```  \n    \n\n 4. 配置项\n    \n    ```xml\n\t<bean id=\"dataSource\" class=\"org.apache.commons.dbcp.BasicDataSource\">\n\t\t<property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n\t\t<property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\" />\n\t\t<property name=\"username\" value=\"root\" />\n\t\t<property name=\"password\" value=\"*****\" />\n\t</bean>\n    ```\n### 6.3 C3P0\n\n 5. 资源包\n     \n    ```xml\n    <dependency>\n\t\t<groupId>com.mchange.c3p0</groupId>\n\t\t<artifactId>com.springsource.com.mchange.v2.c3p0</artifactId>\n\t\t<version>0.9.1.2</version>\n\t</dependency>\n    ```  \n    \n\n 6. 配置项\n    \n    ```xml\n\t<bean id=\"dataSource3\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\">\n\t\t<property name=\"driverClass\" value=\"${driverClass}\" />\n\t\t<property name=\"jdbcUrl\" value=\"${url}\" />\n\t\t<property name=\"user\" value=\"${jdbc_username}\" />\n\t\t<property name=\"password\" value=\"${password}\" />\n\t</bean>\n    ```\n    \n### 6.4 外部properties输入参数\n\n 1. 编写properties文件(jdbc.properties)\n \n ```properties\ndriverClass=com.mysql.jdbc.Driver\nurl=jdbc:mysql://localhost:3306/springdb\njdbc_username=root\npassword=*****\n ```\n\n 2. 在spring配置文件中扫描properties\n \n 方式一：可用*匹配加载多个\n ```xml\n <context:property-placeholder location=\"classpath:jdbc.properties\"/>\n ```\n 方式二：一个property对应一个文件\n ```xml\n <bean class=\"org.springframework.beans.factory.config.PropertyPlaceholdeConfigurer\">\n\t\t<property name=\"location\" value=\"classpath:jdbc.properties\" />\n\t\t<property name=\"location\" value=\"classpath:dsafgusd\" />\n\t</bean>\n ```\n 3. 用&{key}的方式引入\n \n```xml\n<bean id=\"dataSource3\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\">\n\t<property name=\"driverClass\" value=\"${driverClass}\" />\n\t<property name=\"jdbcUrl\" value=\"${url}\" />\n\t<property name=\"user\" value=\"${jdbc_username}\" />\n\t<property name=\"password\" value=\"${password}\" />\n</bean>\n```\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/Spring/DataAccess.png","slug":"spring-4-——持久层封装","published":1,"updated":"2018-02-27T07:38:38.101Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspg0001sn8vfahsclh77","content":"<p>这边博客介绍了持久层的集中封装方式。<br><a id=\"more\"></a></p>\n<h2 id=\"1-持久层访问方式\"><a href=\"#1-持久层访问方式\" class=\"headerlink\" title=\"1. 持久层访问方式\"></a>1. 持久层访问方式</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/Spring/DataAccess.png\" alt=\"数据访问方式\"></p>\n<h2 id=\"2-JDBC\"><a href=\"#2-JDBC\" class=\"headerlink\" title=\"2. JDBC\"></a>2. JDBC</h2><h2 id=\"3-JDBCTemplete\"><a href=\"#3-JDBCTemplete\" class=\"headerlink\" title=\"3. JDBCTemplete\"></a>3. JDBCTemplete</h2><h3 id=\"3-1-原始jdbcTemplete\"><a href=\"#3-1-原始jdbcTemplete\" class=\"headerlink\" title=\"3.1 原始jdbcTemplete\"></a>3.1 原始jdbcTemplete</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">DriverManagerDataSource dataSource = <span class=\"keyword\">new</span> DriverManagerDataSource();</div><div class=\"line\">dataSource.setDriverClassName(<span class=\"string\">\"com.mysql.jdbc.Driver\"</span>);</div><div class=\"line\">dataSource.setUrl(<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span>);</div><div class=\"line\">dataSource.setUsername(<span class=\"string\">\"root\"</span>);</div><div class=\"line\">dataSource.setPassword(<span class=\"string\">\"***********\"</span>);</div><div class=\"line\"></div><div class=\"line\">JdbcTemplate template = <span class=\"keyword\">new</span> JdbcTemplate(dataSource);</div><div class=\"line\">template.execute(<span class=\"string\">\"insert into student values(1,'张三',23)\"</span>);</div></pre></td></tr></table></figure>\n<h3 id=\"3-2-Spring开发jdbcTemplete\"><a href=\"#3-2-Spring开发jdbcTemplete\" class=\"headerlink\" title=\"3.2 Spring开发jdbcTemplete\"></a>3.2 Spring开发jdbcTemplete</h3><ol>\n<li><p>设置Bean</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dao\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.daotest.Dao\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcTemplate\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"jdbcTemplate\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"jdbcTemplate\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.core.JdbcTemplate\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DriverManagerDataSource\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"xiaoyue*AZ2V65\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>编写dao层测试类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    ClassPathXmlApplicationContext ctx = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(<span class=\"string\">\"jdbcTemplete.xml\"</span>);</div><div class=\"line\">    JdbcTemplate jdbcTemplate = (JdbcTemplate) ctx.getBean(<span class=\"string\">\"jdbcTemplate\"</span>);</div><div class=\"line\">    jdbcTemplate.execute(<span class=\"string\">\"insert into student values(5,'23423',24)\"</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>或者注解式</p>\n<p>开启注解扫描</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.daotest\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>去掉dao层的bean,即如下配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dao\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.daotest.Dao\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcTemplate\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"jdbcTemplate\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>编写测试类\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"meta\">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class=\"line\"><span class=\"meta\">@ContextConfiguration</span>(locations=<span class=\"string\">\"classpath:jdbcTemplete.xml\"</span>)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Dao</span> </span>&#123;</div><div class=\"line\">\t</div><div class=\"line\">    \t<span class=\"meta\">@Autowired</span></div><div class=\"line\">    \t<span class=\"keyword\">private</span> JdbcTemplate jdbcTemplate;</div><div class=\"line\">    </div><div class=\"line\">    \t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setJdbcTemplate</span><span class=\"params\">(JdbcTemplate jdbcTemplate)</span> </span>&#123;</div><div class=\"line\">    \t\t<span class=\"keyword\">this</span>.jdbcTemplate = jdbcTemplate;</div><div class=\"line\">    \t&#125;</div><div class=\"line\">    \t<span class=\"meta\">@Test</span></div><div class=\"line\">    \t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo2</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    \t\tjdbcTemplate.execute(<span class=\"string\">\"insert into student values(8,'王五',25)\"</span>);</div><div class=\"line\">    \t&#125;</div><div class=\"line\">\t&#125;</div></pre></td></tr></table></figure>\n</code></pre><h2 id=\"3-jdbcDaoSupport\"><a href=\"#3-jdbcDaoSupport\" class=\"headerlink\" title=\"3. jdbcDaoSupport\"></a>3. jdbcDaoSupport</h2><p>JdbcDaoSupport是JDBC数据访问对象的超类，其实它使用的还是jdbcTemplete，不过需要DI依赖注入dataSource或者jdbcTemplete.</p>\n<h3 id=\"3-1-xml方式\"><a href=\"#3-1-xml方式\" class=\"headerlink\" title=\"3.1 xml方式\"></a>3.1 xml方式</h3><ol>\n<li><p>xml配置文件</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"jdbcDaoSupportTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.daotest.JDBCDaoSupportTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"jdbcDaoSupportTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.daotest.JDBCDaoSupportTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 必须为继承JdbcDaoSupport的类注入JdbcTemplate，变量名为jdbcTemplate --&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- &lt;property name=\"jdbcTemplate\" ref=\"jdbcTemplate\"/&gt; --&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 还可以注入DataSource对象，由JdbcDaoSupport自动创建JdbcTemplate对象 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span></span></div><div class=\"line\">    \t<span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DriverManagerDataSource\"</span>&gt;</div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span> /&gt;</span></div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"*****\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>测试类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JDBCDaoSupportTest</span> <span class=\"keyword\">extends</span> <span class=\"title\">JdbcDaoSupport</span></span>&#123;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> ClassPathXmlApplicationContext ctx;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo2</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tctx = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(<span class=\"string\">\"jdbcDaoSupport.xml\"</span>);</div><div class=\"line\">\t\tJDBCDaoSupportTest bean = (JDBCDaoSupportTest) ctx.getBean(<span class=\"string\">\"jdbcDaoSupportTest\"</span>);</div><div class=\"line\">\t\tJdbcTemplate template = bean.getJdbcTemplate();</div><div class=\"line\">\t\tString sql = <span class=\"string\">\"select name from student where id = ?\"</span>;</div><div class=\"line\">\t\tString name = template.queryForObject(sql, String.class,<span class=\"number\">1</span>);</div><div class=\"line\">\t\tSystem.out.println(name);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"3-2-注解方式\"><a href=\"#3-2-注解方式\" class=\"headerlink\" title=\"3.2 注解方式\"></a>3.2 注解方式</h3><ol>\n<li><p>xml配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span></span></div><div class=\"line\">\t<span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DriverManagerDataSource\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"*****\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li>测试类<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JDBCDaoSupportTest</span> <span class=\"keyword\">extends</span> <span class=\"title\">JdbcDaoSupport</span></span>&#123;</div><div class=\"line\"></div><div class=\"line\">    \t<span class=\"meta\">@Autowired</span></div><div class=\"line\">    \t<span class=\"keyword\">private</span> DataSource dataSource;</div><div class=\"line\">    \t</div><div class=\"line\">    \t<span class=\"meta\">@PostConstruct</span></div><div class=\"line\">    \t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    \t\tsetDataSource(dataSource);</div><div class=\"line\">    \t&#125;</div><div class=\"line\">    </div><div class=\"line\">    \t<span class=\"meta\">@Test</span></div><div class=\"line\">    \t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    \t\tJdbcTemplate template = <span class=\"keyword\">this</span>.getJdbcTemplate();</div><div class=\"line\">    \t\tString sql = <span class=\"string\">\"select name from student where id = ?\"</span>;</div><div class=\"line\">    \t\tString name = template.queryForObject(sql, String.class,<span class=\"number\">1</span>);</div><div class=\"line\">    \t\tSystem.out.println(name);</div><div class=\"line\">    \t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>注入dataSource注意事项<br>查看jdbcDaoSupport源码，可以注入dataSource或者注入jdbcTemplete<br>注入方法有两种：</p>\n<p>构造方法中注入：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Autowired</span></div><div class=\"line\">UserVODaoImpl(DataSource dataSource) &#123;</div><div class=\"line\">    setDataSource(dataSource);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>实例化前注入</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Autowired</span></div><div class=\"line\"><span class=\"keyword\">private</span> DataSource dataSource;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@PostConstruct</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tsetDataSource(dataSource);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"4-Hibernate\"><a href=\"#4-Hibernate\" class=\"headerlink\" title=\"4. Hibernate\"></a>4. Hibernate</h2><h2 id=\"5-Mybatis\"><a href=\"#5-Mybatis\" class=\"headerlink\" title=\"5. Mybatis\"></a>5. Mybatis</h2><h2 id=\"6-DataSource\"><a href=\"#6-DataSource\" class=\"headerlink\" title=\"6. DataSource\"></a>6. DataSource</h2><h3 id=\"6-1-Spring内置DriverManagerDataSource\"><a href=\"#6-1-Spring内置DriverManagerDataSource\" class=\"headerlink\" title=\"6.1 Spring内置DriverManagerDataSource\"></a>6.1 Spring内置DriverManagerDataSource</h3><ol>\n<li><p>资源包</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-jdbc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   ```  </div><div class=\"line\">   </div><div class=\"line\">2. 配置项</div><div class=\"line\"></div><div class=\"line\">   ```xml</div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DriverManagerDataSource\"</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span>/&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"****\"</span> /&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"6-2-DBCP\"><a href=\"#6-2-DBCP\" class=\"headerlink\" title=\"6.2 DBCP\"></a>6.2 DBCP</h3><ol>\n<li><p>资源包</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.commons<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>com.springsource.org.apache.commons.dbcp<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.2.osgi<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.commons<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>com.springsource.org.apache.commons.pool<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.5.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   ```  </div><div class=\"line\">   </div><div class=\"line\"></div><div class=\"line\">4. 配置项</div><div class=\"line\">   </div><div class=\"line\">   ```xml</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.apache.commons.dbcp.BasicDataSource\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"*****\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"6-3-C3P0\"><a href=\"#6-3-C3P0\" class=\"headerlink\" title=\"6.3 C3P0\"></a>6.3 C3P0</h3><ol>\n<li><p>资源包</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.mchange.c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>com.springsource.com.mchange.v2.c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   ```  </div><div class=\"line\">   </div><div class=\"line\"></div><div class=\"line\">6. 配置项</div><div class=\"line\">   </div><div class=\"line\">   ```xml</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource3\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.mchange.v2.c3p0.ComboPooledDataSource\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;driverClass&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;url&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc_username&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;password&#125;\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"6-4-外部properties输入参数\"><a href=\"#6-4-外部properties输入参数\" class=\"headerlink\" title=\"6.4 外部properties输入参数\"></a>6.4 外部properties输入参数</h3><ol>\n<li><p>编写properties文件(jdbc.properties)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">driverClass=com.mysql.jdbc.Driver</div><div class=\"line\">url=jdbc:mysql://localhost:3306/springdb</div><div class=\"line\">jdbc_username=root</div><div class=\"line\">password=*****</div></pre></td></tr></table></figure>\n</li>\n<li><p>在spring配置文件中扫描properties</p>\n<p>方式一：可用*匹配加载多个</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:property-placeholder</span> <span class=\"attr\">location</span>=<span class=\"string\">\"classpath:jdbc.properties\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>方式二：一个property对应一个文件</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.beans.factory.config.PropertyPlaceholdeConfigurer\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"location\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"classpath:jdbc.properties\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"location\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"classpath:dsafgusd\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>用&amp;{key}的方式引入</p>\n</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource3\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.mchange.v2.c3p0.ComboPooledDataSource\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;driverClass&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;url&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc_username&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;password&#125;\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>这边博客介绍了持久层的集中封装方式。<br>","more":"</p>\n<h2 id=\"1-持久层访问方式\"><a href=\"#1-持久层访问方式\" class=\"headerlink\" title=\"1. 持久层访问方式\"></a>1. 持久层访问方式</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/Spring/DataAccess.png\" alt=\"数据访问方式\"></p>\n<h2 id=\"2-JDBC\"><a href=\"#2-JDBC\" class=\"headerlink\" title=\"2. JDBC\"></a>2. JDBC</h2><h2 id=\"3-JDBCTemplete\"><a href=\"#3-JDBCTemplete\" class=\"headerlink\" title=\"3. JDBCTemplete\"></a>3. JDBCTemplete</h2><h3 id=\"3-1-原始jdbcTemplete\"><a href=\"#3-1-原始jdbcTemplete\" class=\"headerlink\" title=\"3.1 原始jdbcTemplete\"></a>3.1 原始jdbcTemplete</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">DriverManagerDataSource dataSource = <span class=\"keyword\">new</span> DriverManagerDataSource();</div><div class=\"line\">dataSource.setDriverClassName(<span class=\"string\">\"com.mysql.jdbc.Driver\"</span>);</div><div class=\"line\">dataSource.setUrl(<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span>);</div><div class=\"line\">dataSource.setUsername(<span class=\"string\">\"root\"</span>);</div><div class=\"line\">dataSource.setPassword(<span class=\"string\">\"***********\"</span>);</div><div class=\"line\"></div><div class=\"line\">JdbcTemplate template = <span class=\"keyword\">new</span> JdbcTemplate(dataSource);</div><div class=\"line\">template.execute(<span class=\"string\">\"insert into student values(1,'张三',23)\"</span>);</div></pre></td></tr></table></figure>\n<h3 id=\"3-2-Spring开发jdbcTemplete\"><a href=\"#3-2-Spring开发jdbcTemplete\" class=\"headerlink\" title=\"3.2 Spring开发jdbcTemplete\"></a>3.2 Spring开发jdbcTemplete</h3><ol>\n<li><p>设置Bean</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dao\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.daotest.Dao\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcTemplate\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"jdbcTemplate\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"jdbcTemplate\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.core.JdbcTemplate\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DriverManagerDataSource\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"xiaoyue*AZ2V65\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>编写dao层测试类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    ClassPathXmlApplicationContext ctx = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(<span class=\"string\">\"jdbcTemplete.xml\"</span>);</div><div class=\"line\">    JdbcTemplate jdbcTemplate = (JdbcTemplate) ctx.getBean(<span class=\"string\">\"jdbcTemplate\"</span>);</div><div class=\"line\">    jdbcTemplate.execute(<span class=\"string\">\"insert into student values(5,'23423',24)\"</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>或者注解式</p>\n<p>开启注解扫描</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.daotest\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>去掉dao层的bean,即如下配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dao\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.daotest.Dao\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcTemplate\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"jdbcTemplate\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>编写测试类\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"meta\">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class=\"line\"><span class=\"meta\">@ContextConfiguration</span>(locations=<span class=\"string\">\"classpath:jdbcTemplete.xml\"</span>)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Dao</span> </span>&#123;</div><div class=\"line\">\t</div><div class=\"line\">    \t<span class=\"meta\">@Autowired</span></div><div class=\"line\">    \t<span class=\"keyword\">private</span> JdbcTemplate jdbcTemplate;</div><div class=\"line\">    </div><div class=\"line\">    \t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setJdbcTemplate</span><span class=\"params\">(JdbcTemplate jdbcTemplate)</span> </span>&#123;</div><div class=\"line\">    \t\t<span class=\"keyword\">this</span>.jdbcTemplate = jdbcTemplate;</div><div class=\"line\">    \t&#125;</div><div class=\"line\">    \t<span class=\"meta\">@Test</span></div><div class=\"line\">    \t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo2</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    \t\tjdbcTemplate.execute(<span class=\"string\">\"insert into student values(8,'王五',25)\"</span>);</div><div class=\"line\">    \t&#125;</div><div class=\"line\">\t&#125;</div></pre></td></tr></table></figure>\n</code></pre><h2 id=\"3-jdbcDaoSupport\"><a href=\"#3-jdbcDaoSupport\" class=\"headerlink\" title=\"3. jdbcDaoSupport\"></a>3. jdbcDaoSupport</h2><p>JdbcDaoSupport是JDBC数据访问对象的超类，其实它使用的还是jdbcTemplete，不过需要DI依赖注入dataSource或者jdbcTemplete.</p>\n<h3 id=\"3-1-xml方式\"><a href=\"#3-1-xml方式\" class=\"headerlink\" title=\"3.1 xml方式\"></a>3.1 xml方式</h3><ol>\n<li><p>xml配置文件</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"jdbcDaoSupportTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.daotest.JDBCDaoSupportTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"jdbcDaoSupportTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.daotest.JDBCDaoSupportTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 必须为继承JdbcDaoSupport的类注入JdbcTemplate，变量名为jdbcTemplate --&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- &lt;property name=\"jdbcTemplate\" ref=\"jdbcTemplate\"/&gt; --&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 还可以注入DataSource对象，由JdbcDaoSupport自动创建JdbcTemplate对象 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span></span></div><div class=\"line\">    \t<span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DriverManagerDataSource\"</span>&gt;</div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span> /&gt;</span></div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"*****\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>测试类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JDBCDaoSupportTest</span> <span class=\"keyword\">extends</span> <span class=\"title\">JdbcDaoSupport</span></span>&#123;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> ClassPathXmlApplicationContext ctx;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo2</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tctx = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(<span class=\"string\">\"jdbcDaoSupport.xml\"</span>);</div><div class=\"line\">\t\tJDBCDaoSupportTest bean = (JDBCDaoSupportTest) ctx.getBean(<span class=\"string\">\"jdbcDaoSupportTest\"</span>);</div><div class=\"line\">\t\tJdbcTemplate template = bean.getJdbcTemplate();</div><div class=\"line\">\t\tString sql = <span class=\"string\">\"select name from student where id = ?\"</span>;</div><div class=\"line\">\t\tString name = template.queryForObject(sql, String.class,<span class=\"number\">1</span>);</div><div class=\"line\">\t\tSystem.out.println(name);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"3-2-注解方式\"><a href=\"#3-2-注解方式\" class=\"headerlink\" title=\"3.2 注解方式\"></a>3.2 注解方式</h3><ol>\n<li><p>xml配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span></span></div><div class=\"line\">\t<span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DriverManagerDataSource\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"*****\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li>测试类<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JDBCDaoSupportTest</span> <span class=\"keyword\">extends</span> <span class=\"title\">JdbcDaoSupport</span></span>&#123;</div><div class=\"line\"></div><div class=\"line\">    \t<span class=\"meta\">@Autowired</span></div><div class=\"line\">    \t<span class=\"keyword\">private</span> DataSource dataSource;</div><div class=\"line\">    \t</div><div class=\"line\">    \t<span class=\"meta\">@PostConstruct</span></div><div class=\"line\">    \t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    \t\tsetDataSource(dataSource);</div><div class=\"line\">    \t&#125;</div><div class=\"line\">    </div><div class=\"line\">    \t<span class=\"meta\">@Test</span></div><div class=\"line\">    \t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    \t\tJdbcTemplate template = <span class=\"keyword\">this</span>.getJdbcTemplate();</div><div class=\"line\">    \t\tString sql = <span class=\"string\">\"select name from student where id = ?\"</span>;</div><div class=\"line\">    \t\tString name = template.queryForObject(sql, String.class,<span class=\"number\">1</span>);</div><div class=\"line\">    \t\tSystem.out.println(name);</div><div class=\"line\">    \t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>注入dataSource注意事项<br>查看jdbcDaoSupport源码，可以注入dataSource或者注入jdbcTemplete<br>注入方法有两种：</p>\n<p>构造方法中注入：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Autowired</span></div><div class=\"line\">UserVODaoImpl(DataSource dataSource) &#123;</div><div class=\"line\">    setDataSource(dataSource);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>实例化前注入</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Autowired</span></div><div class=\"line\"><span class=\"keyword\">private</span> DataSource dataSource;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@PostConstruct</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tsetDataSource(dataSource);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"4-Hibernate\"><a href=\"#4-Hibernate\" class=\"headerlink\" title=\"4. Hibernate\"></a>4. Hibernate</h2><h2 id=\"5-Mybatis\"><a href=\"#5-Mybatis\" class=\"headerlink\" title=\"5. Mybatis\"></a>5. Mybatis</h2><h2 id=\"6-DataSource\"><a href=\"#6-DataSource\" class=\"headerlink\" title=\"6. DataSource\"></a>6. DataSource</h2><h3 id=\"6-1-Spring内置DriverManagerDataSource\"><a href=\"#6-1-Spring内置DriverManagerDataSource\" class=\"headerlink\" title=\"6.1 Spring内置DriverManagerDataSource\"></a>6.1 Spring内置DriverManagerDataSource</h3><ol>\n<li><p>资源包</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-jdbc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   ```  </div><div class=\"line\">   </div><div class=\"line\">2. 配置项</div><div class=\"line\"></div><div class=\"line\">   ```xml</div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DriverManagerDataSource\"</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span>/&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"****\"</span> /&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"6-2-DBCP\"><a href=\"#6-2-DBCP\" class=\"headerlink\" title=\"6.2 DBCP\"></a>6.2 DBCP</h3><ol>\n<li><p>资源包</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.commons<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>com.springsource.org.apache.commons.dbcp<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.2.osgi<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.commons<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>com.springsource.org.apache.commons.pool<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.5.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   ```  </div><div class=\"line\">   </div><div class=\"line\"></div><div class=\"line\">4. 配置项</div><div class=\"line\">   </div><div class=\"line\">   ```xml</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.apache.commons.dbcp.BasicDataSource\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"*****\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"6-3-C3P0\"><a href=\"#6-3-C3P0\" class=\"headerlink\" title=\"6.3 C3P0\"></a>6.3 C3P0</h3><ol>\n<li><p>资源包</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.mchange.c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>com.springsource.com.mchange.v2.c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   ```  </div><div class=\"line\">   </div><div class=\"line\"></div><div class=\"line\">6. 配置项</div><div class=\"line\">   </div><div class=\"line\">   ```xml</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource3\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.mchange.v2.c3p0.ComboPooledDataSource\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;driverClass&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;url&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc_username&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;password&#125;\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"6-4-外部properties输入参数\"><a href=\"#6-4-外部properties输入参数\" class=\"headerlink\" title=\"6.4 外部properties输入参数\"></a>6.4 外部properties输入参数</h3><ol>\n<li><p>编写properties文件(jdbc.properties)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">driverClass=com.mysql.jdbc.Driver</div><div class=\"line\">url=jdbc:mysql://localhost:3306/springdb</div><div class=\"line\">jdbc_username=root</div><div class=\"line\">password=*****</div></pre></td></tr></table></figure>\n</li>\n<li><p>在spring配置文件中扫描properties</p>\n<p>方式一：可用*匹配加载多个</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:property-placeholder</span> <span class=\"attr\">location</span>=<span class=\"string\">\"classpath:jdbc.properties\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>方式二：一个property对应一个文件</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.beans.factory.config.PropertyPlaceholdeConfigurer\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"location\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"classpath:jdbc.properties\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"location\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"classpath:dsafgusd\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>用&amp;{key}的方式引入</p>\n</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource3\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.mchange.v2.c3p0.ComboPooledDataSource\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;driverClass&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;url&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc_username&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;password&#125;\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>"},{"title":"spring(3)——AOP浅析","date":"2017-06-14T09:05:36.000Z","_content":"这篇博客简要介绍了Spring AOP的执行过程及实现。\n<!--more-->\n## 1. AOP简介\nAOP（Aspect Oriented Programming），即面向切面编程，可以说是OOP（Object Oriented Programming，面向对象编程）的补充和完善。OOP引入封装、继承、多态等概念来建立一种对象层次结构，用于模拟公共行为的一个集合。不过OOP允许开发者定义纵向的关系，但并不适合定义横向的关系，例如日志功能。日志代码往往横向地散布在所有对象层次中，而与它对应的对象的核心功能毫无关系对于其他类型的代码，如安全性、异常处理和透明的持续性也都是如此，这种散布在各处的无关的代码被称为横切（cross cutting），在OOP设计中，它导致了大量代码的重复，而不利于各个模块的重用。\n\nAOP技术恰恰相反，它利用一种称为\"横切\"的技术，剖解开封装的对象内部，并将那些影响了多个类的公共行为封装到一个可重用模块，并将其命名为\"Aspect\"，即切面。所谓\"切面\"，简单说就是那些与业务无关，却为业务模块所共同调用的逻辑或责任封装起来，便于减少系统的重复代码，降低模块之间的耦合度，并有利于未来的可操作性和可维护性。\n\n使用\"横切\"技术，AOP把软件系统分为两个部分：核心关注点和横切关注点。业务处理的主要流程是核心关注点，与之关系不大的部分是横切关注点。横切关注点的一个特点是，他们经常发生在核心关注点的多处，而各处基本相似，比如权限认证、日志、事物。AOP的作用在于分离系统中的各种关注点，将核心关注点和横切关注点分离开来。\n\n## 2. AOP核心概念\n\n - **连接点(Joinpoint)**:被拦截到的点，因为Spring只支持方法类型的连接点，所以在Spring中连接点指的就是被拦截到的方法，实际上连接点还可以是字段或者构造器\n - **切入点(Pointcut**):要被增强的方法，定义了切入发生的地点\n - **通知(advice)**:要执行的增强方法，定义了切入的时机和执行的动作\n - **切面(Aspect)**:切入点和通知的对应关系，也就是两者结合的称呼\n - **目标对象(Target Object)**:包含切入点的运行时对象，也就是被代理的对象\n - **AOP代理(aop proxy)**:代理对象\n - **织入(Weaving)**:是一个将通知功能加入原始字节码的动态过程，共有三种方法，Spring使用的是运行时织入。\n\n## 3. AOP运行环境\n\n - Spring核心包（4个）\n - 日志包（两个）\n - AOP包（4个）\n    - Spring进行AOP开发(1个)spring-aop-4.2.5.RELEASE.jar\n    - Spring整合AspectJ框架spring-aspects-4.2.5.RELEASE.jar\n    - AOP联盟规范(1个)com.springsource.org.aopalliance-1.0.0.jar\n    - aspectJ支持(1个)com.springsource.org.aspectj.weaver-1.7.2.RELEASE.jar\n\n## 4. XML实现\n\n### 4.1 在配置文件中开启AOP空间\n### 4.2 编写连接点类，即需要增强的业务类\n    业务类可以有上层接口(JDK代理)，也可以没有(cglib代理)\n    \n - 业务类接口\n\n    ```java\n    public interface ImSleep {\n\t    public void sleep();\n    }\n    ```\n    \n - 业务类实现\n    \n    ```java\n\tpublic class HumanSleep implements ImSleep{\n\t\n    \t@Override\n    \tpublic void sleep() {\n    \t\tSystem.out.println(\"我要睡觉了\");\n    \t}\n    }\n    ```\n### 4.3 编写通知类，即增强方法所在的类\n\n```java\npublic class TimeHandler {\n    //通知方法\n\tpublic void printTime() {\n\t\tSystem.out.println(\"CurrentTime=\" + System.currentTimeMillis());\n\t}\n}\n```\n\n### 4.4 在xml中配置切面，即关联切入点和通知\n \n```xml\n<bean id=\"humanSleep\" class=\"com.topvision.ssm.domian.HumanSleep\"/>\n<bean id=\"timeHandler\" class=\"com.topvision.ssm.domian.TimeHandler\"/>\n\t\n<aop:config>\n    //配置切面，ref关联通知类\n\t<aop:aspect id=\"time\" ref=\"timeHandler\">\n\t    //切入点，匹配要切入的业务类\n\t\t<aop:pointcut expression=\"execution(*com.topvision.ssm.domian.HumanSleep.sleep())\" id=\"addTime\"/>\n\t\t//通知类型，执行通知类中的那个方法，关联的切入点\n\t\t<aop:before method=\"printTime\" pointcut-ref=\"addTime\"/>\n\t\t<aop:after method=\"printTime\" pointcut-ref=\"addTime\"/>\n\t</aop:aspect>\n</aop:config>\n```\n\n### 4.5 测试类\n\n```java\nApplicationContext ctx = new ClassPathXmlApplicationContext(\"applicationContext.xml\");\nImSleep human = (ImSleep) ctx.getBean(\"humanSleep\");\nhuman.sleep();\n```\n\n## 5. 注解实现\n### 5.1 开启aop注解\n核心配置文件中添加以下配置，功能等同于注解配置Bean的自动扫描路径\n```xml\n//开启bean扫描\n<context:component-scan base-package=\"com.topvision.ssm.*\"/> \n//开启aop注解扫描\n<aop:aspectj-autoproxy/>\n```\n### 5.2 配置业务类\n```java\n@Component\npublic class Bussiness {\n\t\n\t/**\n\t * 切入点\n\t */\n\tpublic String delete(String obj) {\n\t\tSystem.out.println(\"==========调用切入点：\" + obj + \"说：你敢删除我！===========\\n\");\n\t\treturn obj + \"：瞄～\";\n\t}\n\n\tpublic String add(String obj) {\n\t\tSystem.out.println(\"================这个方法不能被切。。。============== \\n\");\n\t\treturn obj + \"：瞄～ 嘿嘿！\";\n\t}\n\n\tpublic String modify(String obj) {\n\t\tSystem.out.println(\"=================这个也设置加入切吧====================\\n\");\n\t\treturn obj + \"：瞄改瞄啊！\";\n\t}\n}\n```\n### 5.3 配置通知类\n```java\n/**\n * 定义切面\n * \n * @Aspect : 标记为切面类\n * @Pointcut : 指定匹配切点\n * @Before : 指定前置通知，value中指定切入点匹配\n * @AfterReturning ：后置通知，具有可以指定返回值\n * @AfterThrowing ：异常通知\n * \n * @author yanbin\n * \n */\n@Component\n@Aspect\npublic class AspectAdvice {\n\n    /**\n     * 指定切入点匹配表达式，注意它是以方法的形式进行声明的。\n     */\n    @Pointcut(\"execution(* com.topvision.*..*.*(..))\")\n    public void anyMethod() {\n    }\n\n    /**\n     * 前置通知\n     * \n     * @param jp\n     */\n    @Before(value = \"execution(* com.topvision.ssm.domian.Bussiness.delete(..))\")\n    public void doBefore(JoinPoint jp) {\n        System.out.println(\"===========进入before advice============ \\n\");\n\n        System.out.print(\"准备在\" + jp.getTarget().getClass() + \"对象上用\");\n        System.out.print(jp.getSignature().getName() + \"方法进行对 '\");\n        System.out.print(jp.getArgs()[0] + \"'进行删除！\\n\\n\");\n\n        System.out.println(\"要进入切入点方法了 \\n\");\n    }\n\n    /**\n     * 后置通知\n     * \n     * @param jp\n     *            连接点\n     * @param result\n     *            返回值\n     */\n    @AfterReturning(value = \"anyMethod()\", returning = \"result\")\n    public void doAfter(JoinPoint jp, String result) {\n        System.out.println(\"==========进入after advice=========== \\n\");\n        System.out.println(\"切入点方法执行完了 \\n\");\n\n        System.out.print(jp.getArgs()[0] + \"在\");\n        System.out.print(jp.getTarget().getClass() + \"对象上被\");\n        System.out.print(jp.getSignature().getName() + \"方法删除了\");\n        System.out.print(\"只留下：\" + result + \"\\n\\n\");\n    }\n\n    /**\n     * 环绕通知\n     * \n     * @param pjp\n     *            连接点\n     */\n    @Around(value = \"anyMethod()\")\n    public void doAround(ProceedingJoinPoint pjp) throws Throwable {\n        System.out.println(\"===========进入around环绕方法！=========== \\n\");\n\n        // 调用目标方法之前执行的动作\n        System.out.println(\"调用方法之前: 执行！\\n\");\n\n        // 调用方法的参数\n        Object[] args = pjp.getArgs();\n        // 调用的方法名\n        String method = pjp.getSignature().getName();\n        // 获取目标对象\n        Object target = pjp.getTarget();\n        // 执行完方法的返回值：调用proceed()方法，就会触发切入点方法执行\n        Object result = pjp.proceed();\n\n        System.out.println(\"输出：\" + args[0] + \";\" + method + \";\" + target + \";\" + result + \"\\n\");\n        System.out.println(\"调用方法结束：之后执行！\\n\");\n    }\n\n    /**\n     * 异常通知\n     * \n     * @param jp\n     * @param e\n     */\n    @AfterThrowing(value = \"anyMethod())\", throwing = \"e\")\n    public void doThrow(JoinPoint jp, Throwable e) {\n        System.out.println(\"删除出错啦\");\n    }\n\n}\n```\n### 5.4 测试类（集成junit）\n\n```java\n@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations=\"classpath:applicationContext.xml\")\npublic class Test01{\n\t\n\t@Autowired\n\tprivate Bussiness bs;\n\t\n\t@Test\n\tpublic void BSTest() {\n\t\tbs.delete(\"qwe\");\n\t}\n}\n```\n## 6. 切入点表达式及通知\n### 6.1 切入点表达式\n格式：execution(切入点表达式)\nexecution([方法的访问控制修饰符] 方法的返回值 包名.类名/接口名.方法名(参数)) \n注意：方法的访问控制修饰符可以省略\n```xml\ncom.topvision.*.dao.UserDAO.add() com包下的topvision包下的任意包下的dao包下的...\n *..*.*()      任意包下的任意类中的任意方法\n```\n\t\t\t\t\t\t\n**方法参数**\n\n - add()\t\t无参数\n - add(*)\t\t一个参数\n - add(int)\t\t一个int型参数\n - add(*,*)\t\t两个参数\n - add(*,int)\t\t两个参数，第一个任意，第二个int\n - add(..)\t\t任意参数\n - add(*,..)\t\t至少一个参数\n\n### 6.2 通知类型\n\n 1. 类型\nbefore:在原始操作前运行\n\tafter: 在原始操作后运行，无论方法是否抛出异常\n\tafterReturning:在原始操作后运行，只有方法正常结束才运行，抛出异常则不运行\n\tafterThrowing:在原始操作中如果抛出异常，运行\n\taround: 在原始操作前后运行，通过ProceedingJoinPoint对象调用procee()方法完成对原始操作的调用\n\n 2. 格式\n    ```xml\n    <aop:before pointcut-ref=\"pt2\" method=\"before\"/> \n    <aop:after pointcut-ref=\"pt2\" method=\"after\"/> \n    <aop:after-returning pointcut-ref=\"pt2\" method=\"afterReturning\"/> \n    <aop:after-throwing pointcut-ref=\"pt2\" method=\"afterThrowing\"/> \n    <aop:around pointcut-ref=\"pt2\" method=\"around\"/>\n    ```\n\n### 6.3 获取通知参数\n为环绕通知之外的通知方法定义形参**JoinPoint**，该参数必须是通知方法的第一个参数。\n获取参数：Obejct[] args = jp.getArgs();\t\n范例：\n\n```java\npublic void before(JoinPoint jp){\t\n\tObject[] objs = jp.getArgs();\n\tSystem.out.println(\"before......\"+objs[0]+\",\"+objs[1]);\n}\n```\n为环绕通知方法定义形参**ProceedingJoinPoint**对象\n获取参数：Obejct[] args = pjp.getArgs();\n\n \n\n### 6.4 获取通知返回值\nafterReturning 与 around可以获取方法的返回值\n    \n- around通知获取返回值\n**ProceedingJoinPoint**对象执行调用原始操作的返回值就是原始方法的运行返回值。\n\n```java\nObject res = pt.proceed(args);\n```\n注意：如果原始方法返回值为void类型，则around方法返回值设置为Object。如果原始方法返回值为非void类型，则around方法内必须将原始方法调用的结果返回。\n原始方法返回值为void类型的，通知内获取的返回值统一为null。\n\n```java\npublic Object around(ProceedingJoinPoint pjp) throws Throwable{\n\tObject res = pjp.proceed(args);\n\treturn res;\n}\n```\n\n- afterReturning通知获取返回值\n在通知方法的参数中，声明一个Object类型的参数，用于保存方法的返回值\n\n```java\npublic void afterReturning(JoinPoint jp,Object abc){\n    System.out.println(\"afterReturning......\"+ abc);\n}\n```\n在配置文件中，为afterReturning声明保存返回值的变量名\n\n### 6.5 获取异常值\n异常对象的获取方式与返回值很相似，声明变量，在配置中声明保存异常对象的变量名。\n```xml\n<aop:after-throwing pointcut-ref=\"pt\" method=\"afterThrowing\" throwing=\"e\"/>\n```\n```java\npublic void afterThrowing (Throwable e){\n\tSystem.out.println(\"afterThrowing.......\"+ e);\n}\n```\n\n \n## 7. JDK代理与cglib代理\n\n\n\n\n\n","source":"_posts/spring-3——AOP浅析.md","raw":"---\ntitle: spring(3)——AOP浅析\ncategories:\n  - Spring\ntags:\n  - Spring\n  - AOP\ndate: 2017-06-14 17:05:36\n---\n这篇博客简要介绍了Spring AOP的执行过程及实现。\n<!--more-->\n## 1. AOP简介\nAOP（Aspect Oriented Programming），即面向切面编程，可以说是OOP（Object Oriented Programming，面向对象编程）的补充和完善。OOP引入封装、继承、多态等概念来建立一种对象层次结构，用于模拟公共行为的一个集合。不过OOP允许开发者定义纵向的关系，但并不适合定义横向的关系，例如日志功能。日志代码往往横向地散布在所有对象层次中，而与它对应的对象的核心功能毫无关系对于其他类型的代码，如安全性、异常处理和透明的持续性也都是如此，这种散布在各处的无关的代码被称为横切（cross cutting），在OOP设计中，它导致了大量代码的重复，而不利于各个模块的重用。\n\nAOP技术恰恰相反，它利用一种称为\"横切\"的技术，剖解开封装的对象内部，并将那些影响了多个类的公共行为封装到一个可重用模块，并将其命名为\"Aspect\"，即切面。所谓\"切面\"，简单说就是那些与业务无关，却为业务模块所共同调用的逻辑或责任封装起来，便于减少系统的重复代码，降低模块之间的耦合度，并有利于未来的可操作性和可维护性。\n\n使用\"横切\"技术，AOP把软件系统分为两个部分：核心关注点和横切关注点。业务处理的主要流程是核心关注点，与之关系不大的部分是横切关注点。横切关注点的一个特点是，他们经常发生在核心关注点的多处，而各处基本相似，比如权限认证、日志、事物。AOP的作用在于分离系统中的各种关注点，将核心关注点和横切关注点分离开来。\n\n## 2. AOP核心概念\n\n - **连接点(Joinpoint)**:被拦截到的点，因为Spring只支持方法类型的连接点，所以在Spring中连接点指的就是被拦截到的方法，实际上连接点还可以是字段或者构造器\n - **切入点(Pointcut**):要被增强的方法，定义了切入发生的地点\n - **通知(advice)**:要执行的增强方法，定义了切入的时机和执行的动作\n - **切面(Aspect)**:切入点和通知的对应关系，也就是两者结合的称呼\n - **目标对象(Target Object)**:包含切入点的运行时对象，也就是被代理的对象\n - **AOP代理(aop proxy)**:代理对象\n - **织入(Weaving)**:是一个将通知功能加入原始字节码的动态过程，共有三种方法，Spring使用的是运行时织入。\n\n## 3. AOP运行环境\n\n - Spring核心包（4个）\n - 日志包（两个）\n - AOP包（4个）\n    - Spring进行AOP开发(1个)spring-aop-4.2.5.RELEASE.jar\n    - Spring整合AspectJ框架spring-aspects-4.2.5.RELEASE.jar\n    - AOP联盟规范(1个)com.springsource.org.aopalliance-1.0.0.jar\n    - aspectJ支持(1个)com.springsource.org.aspectj.weaver-1.7.2.RELEASE.jar\n\n## 4. XML实现\n\n### 4.1 在配置文件中开启AOP空间\n### 4.2 编写连接点类，即需要增强的业务类\n    业务类可以有上层接口(JDK代理)，也可以没有(cglib代理)\n    \n - 业务类接口\n\n    ```java\n    public interface ImSleep {\n\t    public void sleep();\n    }\n    ```\n    \n - 业务类实现\n    \n    ```java\n\tpublic class HumanSleep implements ImSleep{\n\t\n    \t@Override\n    \tpublic void sleep() {\n    \t\tSystem.out.println(\"我要睡觉了\");\n    \t}\n    }\n    ```\n### 4.3 编写通知类，即增强方法所在的类\n\n```java\npublic class TimeHandler {\n    //通知方法\n\tpublic void printTime() {\n\t\tSystem.out.println(\"CurrentTime=\" + System.currentTimeMillis());\n\t}\n}\n```\n\n### 4.4 在xml中配置切面，即关联切入点和通知\n \n```xml\n<bean id=\"humanSleep\" class=\"com.topvision.ssm.domian.HumanSleep\"/>\n<bean id=\"timeHandler\" class=\"com.topvision.ssm.domian.TimeHandler\"/>\n\t\n<aop:config>\n    //配置切面，ref关联通知类\n\t<aop:aspect id=\"time\" ref=\"timeHandler\">\n\t    //切入点，匹配要切入的业务类\n\t\t<aop:pointcut expression=\"execution(*com.topvision.ssm.domian.HumanSleep.sleep())\" id=\"addTime\"/>\n\t\t//通知类型，执行通知类中的那个方法，关联的切入点\n\t\t<aop:before method=\"printTime\" pointcut-ref=\"addTime\"/>\n\t\t<aop:after method=\"printTime\" pointcut-ref=\"addTime\"/>\n\t</aop:aspect>\n</aop:config>\n```\n\n### 4.5 测试类\n\n```java\nApplicationContext ctx = new ClassPathXmlApplicationContext(\"applicationContext.xml\");\nImSleep human = (ImSleep) ctx.getBean(\"humanSleep\");\nhuman.sleep();\n```\n\n## 5. 注解实现\n### 5.1 开启aop注解\n核心配置文件中添加以下配置，功能等同于注解配置Bean的自动扫描路径\n```xml\n//开启bean扫描\n<context:component-scan base-package=\"com.topvision.ssm.*\"/> \n//开启aop注解扫描\n<aop:aspectj-autoproxy/>\n```\n### 5.2 配置业务类\n```java\n@Component\npublic class Bussiness {\n\t\n\t/**\n\t * 切入点\n\t */\n\tpublic String delete(String obj) {\n\t\tSystem.out.println(\"==========调用切入点：\" + obj + \"说：你敢删除我！===========\\n\");\n\t\treturn obj + \"：瞄～\";\n\t}\n\n\tpublic String add(String obj) {\n\t\tSystem.out.println(\"================这个方法不能被切。。。============== \\n\");\n\t\treturn obj + \"：瞄～ 嘿嘿！\";\n\t}\n\n\tpublic String modify(String obj) {\n\t\tSystem.out.println(\"=================这个也设置加入切吧====================\\n\");\n\t\treturn obj + \"：瞄改瞄啊！\";\n\t}\n}\n```\n### 5.3 配置通知类\n```java\n/**\n * 定义切面\n * \n * @Aspect : 标记为切面类\n * @Pointcut : 指定匹配切点\n * @Before : 指定前置通知，value中指定切入点匹配\n * @AfterReturning ：后置通知，具有可以指定返回值\n * @AfterThrowing ：异常通知\n * \n * @author yanbin\n * \n */\n@Component\n@Aspect\npublic class AspectAdvice {\n\n    /**\n     * 指定切入点匹配表达式，注意它是以方法的形式进行声明的。\n     */\n    @Pointcut(\"execution(* com.topvision.*..*.*(..))\")\n    public void anyMethod() {\n    }\n\n    /**\n     * 前置通知\n     * \n     * @param jp\n     */\n    @Before(value = \"execution(* com.topvision.ssm.domian.Bussiness.delete(..))\")\n    public void doBefore(JoinPoint jp) {\n        System.out.println(\"===========进入before advice============ \\n\");\n\n        System.out.print(\"准备在\" + jp.getTarget().getClass() + \"对象上用\");\n        System.out.print(jp.getSignature().getName() + \"方法进行对 '\");\n        System.out.print(jp.getArgs()[0] + \"'进行删除！\\n\\n\");\n\n        System.out.println(\"要进入切入点方法了 \\n\");\n    }\n\n    /**\n     * 后置通知\n     * \n     * @param jp\n     *            连接点\n     * @param result\n     *            返回值\n     */\n    @AfterReturning(value = \"anyMethod()\", returning = \"result\")\n    public void doAfter(JoinPoint jp, String result) {\n        System.out.println(\"==========进入after advice=========== \\n\");\n        System.out.println(\"切入点方法执行完了 \\n\");\n\n        System.out.print(jp.getArgs()[0] + \"在\");\n        System.out.print(jp.getTarget().getClass() + \"对象上被\");\n        System.out.print(jp.getSignature().getName() + \"方法删除了\");\n        System.out.print(\"只留下：\" + result + \"\\n\\n\");\n    }\n\n    /**\n     * 环绕通知\n     * \n     * @param pjp\n     *            连接点\n     */\n    @Around(value = \"anyMethod()\")\n    public void doAround(ProceedingJoinPoint pjp) throws Throwable {\n        System.out.println(\"===========进入around环绕方法！=========== \\n\");\n\n        // 调用目标方法之前执行的动作\n        System.out.println(\"调用方法之前: 执行！\\n\");\n\n        // 调用方法的参数\n        Object[] args = pjp.getArgs();\n        // 调用的方法名\n        String method = pjp.getSignature().getName();\n        // 获取目标对象\n        Object target = pjp.getTarget();\n        // 执行完方法的返回值：调用proceed()方法，就会触发切入点方法执行\n        Object result = pjp.proceed();\n\n        System.out.println(\"输出：\" + args[0] + \";\" + method + \";\" + target + \";\" + result + \"\\n\");\n        System.out.println(\"调用方法结束：之后执行！\\n\");\n    }\n\n    /**\n     * 异常通知\n     * \n     * @param jp\n     * @param e\n     */\n    @AfterThrowing(value = \"anyMethod())\", throwing = \"e\")\n    public void doThrow(JoinPoint jp, Throwable e) {\n        System.out.println(\"删除出错啦\");\n    }\n\n}\n```\n### 5.4 测试类（集成junit）\n\n```java\n@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations=\"classpath:applicationContext.xml\")\npublic class Test01{\n\t\n\t@Autowired\n\tprivate Bussiness bs;\n\t\n\t@Test\n\tpublic void BSTest() {\n\t\tbs.delete(\"qwe\");\n\t}\n}\n```\n## 6. 切入点表达式及通知\n### 6.1 切入点表达式\n格式：execution(切入点表达式)\nexecution([方法的访问控制修饰符] 方法的返回值 包名.类名/接口名.方法名(参数)) \n注意：方法的访问控制修饰符可以省略\n```xml\ncom.topvision.*.dao.UserDAO.add() com包下的topvision包下的任意包下的dao包下的...\n *..*.*()      任意包下的任意类中的任意方法\n```\n\t\t\t\t\t\t\n**方法参数**\n\n - add()\t\t无参数\n - add(*)\t\t一个参数\n - add(int)\t\t一个int型参数\n - add(*,*)\t\t两个参数\n - add(*,int)\t\t两个参数，第一个任意，第二个int\n - add(..)\t\t任意参数\n - add(*,..)\t\t至少一个参数\n\n### 6.2 通知类型\n\n 1. 类型\nbefore:在原始操作前运行\n\tafter: 在原始操作后运行，无论方法是否抛出异常\n\tafterReturning:在原始操作后运行，只有方法正常结束才运行，抛出异常则不运行\n\tafterThrowing:在原始操作中如果抛出异常，运行\n\taround: 在原始操作前后运行，通过ProceedingJoinPoint对象调用procee()方法完成对原始操作的调用\n\n 2. 格式\n    ```xml\n    <aop:before pointcut-ref=\"pt2\" method=\"before\"/> \n    <aop:after pointcut-ref=\"pt2\" method=\"after\"/> \n    <aop:after-returning pointcut-ref=\"pt2\" method=\"afterReturning\"/> \n    <aop:after-throwing pointcut-ref=\"pt2\" method=\"afterThrowing\"/> \n    <aop:around pointcut-ref=\"pt2\" method=\"around\"/>\n    ```\n\n### 6.3 获取通知参数\n为环绕通知之外的通知方法定义形参**JoinPoint**，该参数必须是通知方法的第一个参数。\n获取参数：Obejct[] args = jp.getArgs();\t\n范例：\n\n```java\npublic void before(JoinPoint jp){\t\n\tObject[] objs = jp.getArgs();\n\tSystem.out.println(\"before......\"+objs[0]+\",\"+objs[1]);\n}\n```\n为环绕通知方法定义形参**ProceedingJoinPoint**对象\n获取参数：Obejct[] args = pjp.getArgs();\n\n \n\n### 6.4 获取通知返回值\nafterReturning 与 around可以获取方法的返回值\n    \n- around通知获取返回值\n**ProceedingJoinPoint**对象执行调用原始操作的返回值就是原始方法的运行返回值。\n\n```java\nObject res = pt.proceed(args);\n```\n注意：如果原始方法返回值为void类型，则around方法返回值设置为Object。如果原始方法返回值为非void类型，则around方法内必须将原始方法调用的结果返回。\n原始方法返回值为void类型的，通知内获取的返回值统一为null。\n\n```java\npublic Object around(ProceedingJoinPoint pjp) throws Throwable{\n\tObject res = pjp.proceed(args);\n\treturn res;\n}\n```\n\n- afterReturning通知获取返回值\n在通知方法的参数中，声明一个Object类型的参数，用于保存方法的返回值\n\n```java\npublic void afterReturning(JoinPoint jp,Object abc){\n    System.out.println(\"afterReturning......\"+ abc);\n}\n```\n在配置文件中，为afterReturning声明保存返回值的变量名\n\n### 6.5 获取异常值\n异常对象的获取方式与返回值很相似，声明变量，在配置中声明保存异常对象的变量名。\n```xml\n<aop:after-throwing pointcut-ref=\"pt\" method=\"afterThrowing\" throwing=\"e\"/>\n```\n```java\npublic void afterThrowing (Throwable e){\n\tSystem.out.println(\"afterThrowing.......\"+ e);\n}\n```\n\n \n## 7. JDK代理与cglib代理\n\n\n\n\n\n","slug":"spring-3——AOP浅析","published":1,"updated":"2018-02-27T07:38:38.100Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspg3001vn8vfjn9u3uyz","content":"<p>这篇博客简要介绍了Spring AOP的执行过程及实现。<br><a id=\"more\"></a></p>\n<h2 id=\"1-AOP简介\"><a href=\"#1-AOP简介\" class=\"headerlink\" title=\"1. AOP简介\"></a>1. AOP简介</h2><p>AOP（Aspect Oriented Programming），即面向切面编程，可以说是OOP（Object Oriented Programming，面向对象编程）的补充和完善。OOP引入封装、继承、多态等概念来建立一种对象层次结构，用于模拟公共行为的一个集合。不过OOP允许开发者定义纵向的关系，但并不适合定义横向的关系，例如日志功能。日志代码往往横向地散布在所有对象层次中，而与它对应的对象的核心功能毫无关系对于其他类型的代码，如安全性、异常处理和透明的持续性也都是如此，这种散布在各处的无关的代码被称为横切（cross cutting），在OOP设计中，它导致了大量代码的重复，而不利于各个模块的重用。</p>\n<p>AOP技术恰恰相反，它利用一种称为”横切”的技术，剖解开封装的对象内部，并将那些影响了多个类的公共行为封装到一个可重用模块，并将其命名为”Aspect”，即切面。所谓”切面”，简单说就是那些与业务无关，却为业务模块所共同调用的逻辑或责任封装起来，便于减少系统的重复代码，降低模块之间的耦合度，并有利于未来的可操作性和可维护性。</p>\n<p>使用”横切”技术，AOP把软件系统分为两个部分：核心关注点和横切关注点。业务处理的主要流程是核心关注点，与之关系不大的部分是横切关注点。横切关注点的一个特点是，他们经常发生在核心关注点的多处，而各处基本相似，比如权限认证、日志、事物。AOP的作用在于分离系统中的各种关注点，将核心关注点和横切关注点分离开来。</p>\n<h2 id=\"2-AOP核心概念\"><a href=\"#2-AOP核心概念\" class=\"headerlink\" title=\"2. AOP核心概念\"></a>2. AOP核心概念</h2><ul>\n<li><strong>连接点(Joinpoint)</strong>:被拦截到的点，因为Spring只支持方法类型的连接点，所以在Spring中连接点指的就是被拦截到的方法，实际上连接点还可以是字段或者构造器</li>\n<li><strong>切入点(Pointcut</strong>):要被增强的方法，定义了切入发生的地点</li>\n<li><strong>通知(advice)</strong>:要执行的增强方法，定义了切入的时机和执行的动作</li>\n<li><strong>切面(Aspect)</strong>:切入点和通知的对应关系，也就是两者结合的称呼</li>\n<li><strong>目标对象(Target Object)</strong>:包含切入点的运行时对象，也就是被代理的对象</li>\n<li><strong>AOP代理(aop proxy)</strong>:代理对象</li>\n<li><strong>织入(Weaving)</strong>:是一个将通知功能加入原始字节码的动态过程，共有三种方法，Spring使用的是运行时织入。</li>\n</ul>\n<h2 id=\"3-AOP运行环境\"><a href=\"#3-AOP运行环境\" class=\"headerlink\" title=\"3. AOP运行环境\"></a>3. AOP运行环境</h2><ul>\n<li>Spring核心包（4个）</li>\n<li>日志包（两个）</li>\n<li>AOP包（4个）<ul>\n<li>Spring进行AOP开发(1个)spring-aop-4.2.5.RELEASE.jar</li>\n<li>Spring整合AspectJ框架spring-aspects-4.2.5.RELEASE.jar</li>\n<li>AOP联盟规范(1个)com.springsource.org.aopalliance-1.0.0.jar</li>\n<li>aspectJ支持(1个)com.springsource.org.aspectj.weaver-1.7.2.RELEASE.jar</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"4-XML实现\"><a href=\"#4-XML实现\" class=\"headerlink\" title=\"4. XML实现\"></a>4. XML实现</h2><h3 id=\"4-1-在配置文件中开启AOP空间\"><a href=\"#4-1-在配置文件中开启AOP空间\" class=\"headerlink\" title=\"4.1 在配置文件中开启AOP空间\"></a>4.1 在配置文件中开启AOP空间</h3><h3 id=\"4-2-编写连接点类，即需要增强的业务类\"><a href=\"#4-2-编写连接点类，即需要增强的业务类\" class=\"headerlink\" title=\"4.2 编写连接点类，即需要增强的业务类\"></a>4.2 编写连接点类，即需要增强的业务类</h3><pre><code>业务类可以有上层接口(JDK代理)，也可以没有(cglib代理)\n</code></pre><ul>\n<li><p>业务类接口</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ImSleep</span> </span>&#123;</div><div class=\"line\"> <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sleep</span><span class=\"params\">()</span></span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul>\n<li><p>业务类实现</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HumanSleep</span> <span class=\"keyword\">implements</span> <span class=\"title\">ImSleep</span></span>&#123;</div><div class=\"line\"></div><div class=\"line\">   \t<span class=\"meta\">@Override</span></div><div class=\"line\">   \t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sleep</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">   \t\tSystem.out.println(<span class=\"string\">\"我要睡觉了\"</span>);</div><div class=\"line\">   \t&#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"4-3-编写通知类，即增强方法所在的类\"><a href=\"#4-3-编写通知类，即增强方法所在的类\" class=\"headerlink\" title=\"4.3 编写通知类，即增强方法所在的类\"></a>4.3 编写通知类，即增强方法所在的类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TimeHandler</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//通知方法</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">printTime</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"CurrentTime=\"</span> + System.currentTimeMillis());</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"4-4-在xml中配置切面，即关联切入点和通知\"><a href=\"#4-4-在xml中配置切面，即关联切入点和通知\" class=\"headerlink\" title=\"4.4 在xml中配置切面，即关联切入点和通知\"></a>4.4 在xml中配置切面，即关联切入点和通知</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"humanSleep\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.ssm.domian.HumanSleep\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"timeHandler\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.ssm.domian.TimeHandler\"</span>/&gt;</span></div><div class=\"line\">\t</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:config</span>&gt;</span></div><div class=\"line\">    //配置切面，ref关联通知类</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">aop:aspect</span> <span class=\"attr\">id</span>=<span class=\"string\">\"time\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"timeHandler\"</span>&gt;</span></div><div class=\"line\">\t    //切入点，匹配要切入的业务类</div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">aop:pointcut</span> <span class=\"attr\">expression</span>=<span class=\"string\">\"execution(*com.topvision.ssm.domian.HumanSleep.sleep())\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"addTime\"</span>/&gt;</span></div><div class=\"line\">\t\t//通知类型，执行通知类中的那个方法，关联的切入点</div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">aop:before</span> <span class=\"attr\">method</span>=<span class=\"string\">\"printTime\"</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"addTime\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">aop:after</span> <span class=\"attr\">method</span>=<span class=\"string\">\"printTime\"</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"addTime\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">aop:aspect</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">aop:config</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"4-5-测试类\"><a href=\"#4-5-测试类\" class=\"headerlink\" title=\"4.5 测试类\"></a>4.5 测试类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">ApplicationContext ctx = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(<span class=\"string\">\"applicationContext.xml\"</span>);</div><div class=\"line\">ImSleep human = (ImSleep) ctx.getBean(<span class=\"string\">\"humanSleep\"</span>);</div><div class=\"line\">human.sleep();</div></pre></td></tr></table></figure>\n<h2 id=\"5-注解实现\"><a href=\"#5-注解实现\" class=\"headerlink\" title=\"5. 注解实现\"></a>5. 注解实现</h2><h3 id=\"5-1-开启aop注解\"><a href=\"#5-1-开启aop注解\" class=\"headerlink\" title=\"5.1 开启aop注解\"></a>5.1 开启aop注解</h3><p>核心配置文件中添加以下配置，功能等同于注解配置Bean的自动扫描路径<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">//开启bean扫描</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.ssm.*\"</span>/&gt;</span> </div><div class=\"line\">//开启aop注解扫描</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:aspectj-autoproxy</span>/&gt;</span></div></pre></td></tr></table></figure></p>\n<h3 id=\"5-2-配置业务类\"><a href=\"#5-2-配置业务类\" class=\"headerlink\" title=\"5.2 配置业务类\"></a>5.2 配置业务类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Component</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Bussiness</span> </span>&#123;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * 切入点</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">delete</span><span class=\"params\">(String obj)</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"==========调用切入点：\"</span> + obj + <span class=\"string\">\"说：你敢删除我！===========\\n\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> obj + <span class=\"string\">\"：瞄～\"</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">add</span><span class=\"params\">(String obj)</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"================这个方法不能被切。。。============== \\n\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> obj + <span class=\"string\">\"：瞄～ 嘿嘿！\"</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">modify</span><span class=\"params\">(String obj)</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"=================这个也设置加入切吧====================\\n\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> obj + <span class=\"string\">\"：瞄改瞄啊！\"</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"5-3-配置通知类\"><a href=\"#5-3-配置通知类\" class=\"headerlink\" title=\"5.3 配置通知类\"></a>5.3 配置通知类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 定义切面</div><div class=\"line\"> * </div><div class=\"line\"> * <span class=\"doctag\">@Aspect</span> : 标记为切面类</div><div class=\"line\"> * <span class=\"doctag\">@Pointcut</span> : 指定匹配切点</div><div class=\"line\"> * <span class=\"doctag\">@Before</span> : 指定前置通知，value中指定切入点匹配</div><div class=\"line\"> * <span class=\"doctag\">@AfterReturning</span> ：后置通知，具有可以指定返回值</div><div class=\"line\"> * <span class=\"doctag\">@AfterThrowing</span> ：异常通知</div><div class=\"line\"> * </div><div class=\"line\"> * <span class=\"doctag\">@author</span> yanbin</div><div class=\"line\"> * </div><div class=\"line\"> */</div><div class=\"line\"><span class=\"meta\">@Component</span></div><div class=\"line\"><span class=\"meta\">@Aspect</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AspectAdvice</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 指定切入点匹配表达式，注意它是以方法的形式进行声明的。</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Pointcut</span>(<span class=\"string\">\"execution(* com.topvision.*..*.*(..))\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">anyMethod</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 前置通知</div><div class=\"line\">     * </div><div class=\"line\">     * <span class=\"doctag\">@param</span> jp</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Before</span>(value = <span class=\"string\">\"execution(* com.topvision.ssm.domian.Bussiness.delete(..))\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doBefore</span><span class=\"params\">(JoinPoint jp)</span> </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"===========进入before advice============ \\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        System.out.print(<span class=\"string\">\"准备在\"</span> + jp.getTarget().getClass() + <span class=\"string\">\"对象上用\"</span>);</div><div class=\"line\">        System.out.print(jp.getSignature().getName() + <span class=\"string\">\"方法进行对 '\"</span>);</div><div class=\"line\">        System.out.print(jp.getArgs()[<span class=\"number\">0</span>] + <span class=\"string\">\"'进行删除！\\n\\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        System.out.println(<span class=\"string\">\"要进入切入点方法了 \\n\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 后置通知</div><div class=\"line\">     * </div><div class=\"line\">     * <span class=\"doctag\">@param</span> jp</div><div class=\"line\">     *            连接点</div><div class=\"line\">     * <span class=\"doctag\">@param</span> result</div><div class=\"line\">     *            返回值</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@AfterReturning</span>(value = <span class=\"string\">\"anyMethod()\"</span>, returning = <span class=\"string\">\"result\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doAfter</span><span class=\"params\">(JoinPoint jp, String result)</span> </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"==========进入after advice=========== \\n\"</span>);</div><div class=\"line\">        System.out.println(<span class=\"string\">\"切入点方法执行完了 \\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        System.out.print(jp.getArgs()[<span class=\"number\">0</span>] + <span class=\"string\">\"在\"</span>);</div><div class=\"line\">        System.out.print(jp.getTarget().getClass() + <span class=\"string\">\"对象上被\"</span>);</div><div class=\"line\">        System.out.print(jp.getSignature().getName() + <span class=\"string\">\"方法删除了\"</span>);</div><div class=\"line\">        System.out.print(<span class=\"string\">\"只留下：\"</span> + result + <span class=\"string\">\"\\n\\n\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 环绕通知</div><div class=\"line\">     * </div><div class=\"line\">     * <span class=\"doctag\">@param</span> pjp</div><div class=\"line\">     *            连接点</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Around</span>(value = <span class=\"string\">\"anyMethod()\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doAround</span><span class=\"params\">(ProceedingJoinPoint pjp)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"===========进入around环绕方法！=========== \\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">// 调用目标方法之前执行的动作</span></div><div class=\"line\">        System.out.println(<span class=\"string\">\"调用方法之前: 执行！\\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">// 调用方法的参数</span></div><div class=\"line\">        Object[] args = pjp.getArgs();</div><div class=\"line\">        <span class=\"comment\">// 调用的方法名</span></div><div class=\"line\">        String method = pjp.getSignature().getName();</div><div class=\"line\">        <span class=\"comment\">// 获取目标对象</span></div><div class=\"line\">        Object target = pjp.getTarget();</div><div class=\"line\">        <span class=\"comment\">// 执行完方法的返回值：调用proceed()方法，就会触发切入点方法执行</span></div><div class=\"line\">        Object result = pjp.proceed();</div><div class=\"line\"></div><div class=\"line\">        System.out.println(<span class=\"string\">\"输出：\"</span> + args[<span class=\"number\">0</span>] + <span class=\"string\">\";\"</span> + method + <span class=\"string\">\";\"</span> + target + <span class=\"string\">\";\"</span> + result + <span class=\"string\">\"\\n\"</span>);</div><div class=\"line\">        System.out.println(<span class=\"string\">\"调用方法结束：之后执行！\\n\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 异常通知</div><div class=\"line\">     * </div><div class=\"line\">     * <span class=\"doctag\">@param</span> jp</div><div class=\"line\">     * <span class=\"doctag\">@param</span> e</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@AfterThrowing</span>(value = <span class=\"string\">\"anyMethod())\"</span>, throwing = <span class=\"string\">\"e\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doThrow</span><span class=\"params\">(JoinPoint jp, Throwable e)</span> </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"删除出错啦\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"5-4-测试类（集成junit）\"><a href=\"#5-4-测试类（集成junit）\" class=\"headerlink\" title=\"5.4 测试类（集成junit）\"></a>5.4 测试类（集成junit）</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class=\"line\"><span class=\"meta\">@ContextConfiguration</span>(locations=<span class=\"string\">\"classpath:applicationContext.xml\"</span>)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Test01</span></span>&#123;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"meta\">@Autowired</span></div><div class=\"line\">\t<span class=\"keyword\">private</span> Bussiness bs;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">BSTest</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tbs.delete(<span class=\"string\">\"qwe\"</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"6-切入点表达式及通知\"><a href=\"#6-切入点表达式及通知\" class=\"headerlink\" title=\"6. 切入点表达式及通知\"></a>6. 切入点表达式及通知</h2><h3 id=\"6-1-切入点表达式\"><a href=\"#6-1-切入点表达式\" class=\"headerlink\" title=\"6.1 切入点表达式\"></a>6.1 切入点表达式</h3><p>格式：execution(切入点表达式)<br>execution([方法的访问控制修饰符] 方法的返回值 包名.类名/接口名.方法名(参数))<br>注意：方法的访问控制修饰符可以省略<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">com.topvision.*.dao.UserDAO.add() com包下的topvision包下的任意包下的dao包下的...</div><div class=\"line\"> *..*.*()      任意包下的任意类中的任意方法</div></pre></td></tr></table></figure></p>\n<p><strong>方法参数</strong></p>\n<ul>\n<li>add()        无参数</li>\n<li>add(*)        一个参数</li>\n<li>add(int)        一个int型参数</li>\n<li>add(<em>,</em>)        两个参数</li>\n<li>add(*,int)        两个参数，第一个任意，第二个int</li>\n<li>add(..)        任意参数</li>\n<li>add(*,..)        至少一个参数</li>\n</ul>\n<h3 id=\"6-2-通知类型\"><a href=\"#6-2-通知类型\" class=\"headerlink\" title=\"6.2 通知类型\"></a>6.2 通知类型</h3><ol>\n<li><p>类型<br>before:在原始操作前运行<br>after: 在原始操作后运行，无论方法是否抛出异常<br>afterReturning:在原始操作后运行，只有方法正常结束才运行，抛出异常则不运行<br>afterThrowing:在原始操作中如果抛出异常，运行<br>around: 在原始操作前后运行，通过ProceedingJoinPoint对象调用procee()方法完成对原始操作的调用</p>\n</li>\n<li><p>格式</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:before</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"before\"</span>/&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:after</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"after\"</span>/&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:after-returning</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"afterReturning\"</span>/&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:after-throwing</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"afterThrowing\"</span>/&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:around</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"around\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"6-3-获取通知参数\"><a href=\"#6-3-获取通知参数\" class=\"headerlink\" title=\"6.3 获取通知参数\"></a>6.3 获取通知参数</h3><p>为环绕通知之外的通知方法定义形参<strong>JoinPoint</strong>，该参数必须是通知方法的第一个参数。<br>获取参数：Obejct[] args = jp.getArgs();<br>范例：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">before</span><span class=\"params\">(JoinPoint jp)</span></span>&#123;\t</div><div class=\"line\">\tObject[] objs = jp.getArgs();</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"before......\"</span>+objs[<span class=\"number\">0</span>]+<span class=\"string\">\",\"</span>+objs[<span class=\"number\">1</span>]);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>为环绕通知方法定义形参<strong>ProceedingJoinPoint</strong>对象<br>获取参数：Obejct[] args = pjp.getArgs();</p>\n<h3 id=\"6-4-获取通知返回值\"><a href=\"#6-4-获取通知返回值\" class=\"headerlink\" title=\"6.4 获取通知返回值\"></a>6.4 获取通知返回值</h3><p>afterReturning 与 around可以获取方法的返回值</p>\n<ul>\n<li>around通知获取返回值<br><strong>ProceedingJoinPoint</strong>对象执行调用原始操作的返回值就是原始方法的运行返回值。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">Object res = pt.proceed(args);</div></pre></td></tr></table></figure>\n<p>注意：如果原始方法返回值为void类型，则around方法返回值设置为Object。如果原始方法返回值为非void类型，则around方法内必须将原始方法调用的结果返回。<br>原始方法返回值为void类型的，通知内获取的返回值统一为null。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">around</span><span class=\"params\">(ProceedingJoinPoint pjp)</span> <span class=\"keyword\">throws</span> Throwable</span>&#123;</div><div class=\"line\">\tObject res = pjp.proceed(args);</div><div class=\"line\">\t<span class=\"keyword\">return</span> res;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<ul>\n<li>afterReturning通知获取返回值<br>在通知方法的参数中，声明一个Object类型的参数，用于保存方法的返回值</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterReturning</span><span class=\"params\">(JoinPoint jp,Object abc)</span></span>&#123;</div><div class=\"line\">    System.out.println(<span class=\"string\">\"afterReturning......\"</span>+ abc);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>在配置文件中，为afterReturning声明保存返回值的变量名</p>\n<h3 id=\"6-5-获取异常值\"><a href=\"#6-5-获取异常值\" class=\"headerlink\" title=\"6.5 获取异常值\"></a>6.5 获取异常值</h3><p>异常对象的获取方式与返回值很相似，声明变量，在配置中声明保存异常对象的变量名。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:after-throwing</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"afterThrowing\"</span> <span class=\"attr\">throwing</span>=<span class=\"string\">\"e\"</span>/&gt;</span></div></pre></td></tr></table></figure></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterThrowing</span> <span class=\"params\">(Throwable e)</span></span>&#123;</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"afterThrowing.......\"</span>+ e);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"7-JDK代理与cglib代理\"><a href=\"#7-JDK代理与cglib代理\" class=\"headerlink\" title=\"7. JDK代理与cglib代理\"></a>7. JDK代理与cglib代理</h2>","site":{"data":{}},"excerpt":"<p>这篇博客简要介绍了Spring AOP的执行过程及实现。<br>","more":"</p>\n<h2 id=\"1-AOP简介\"><a href=\"#1-AOP简介\" class=\"headerlink\" title=\"1. AOP简介\"></a>1. AOP简介</h2><p>AOP（Aspect Oriented Programming），即面向切面编程，可以说是OOP（Object Oriented Programming，面向对象编程）的补充和完善。OOP引入封装、继承、多态等概念来建立一种对象层次结构，用于模拟公共行为的一个集合。不过OOP允许开发者定义纵向的关系，但并不适合定义横向的关系，例如日志功能。日志代码往往横向地散布在所有对象层次中，而与它对应的对象的核心功能毫无关系对于其他类型的代码，如安全性、异常处理和透明的持续性也都是如此，这种散布在各处的无关的代码被称为横切（cross cutting），在OOP设计中，它导致了大量代码的重复，而不利于各个模块的重用。</p>\n<p>AOP技术恰恰相反，它利用一种称为”横切”的技术，剖解开封装的对象内部，并将那些影响了多个类的公共行为封装到一个可重用模块，并将其命名为”Aspect”，即切面。所谓”切面”，简单说就是那些与业务无关，却为业务模块所共同调用的逻辑或责任封装起来，便于减少系统的重复代码，降低模块之间的耦合度，并有利于未来的可操作性和可维护性。</p>\n<p>使用”横切”技术，AOP把软件系统分为两个部分：核心关注点和横切关注点。业务处理的主要流程是核心关注点，与之关系不大的部分是横切关注点。横切关注点的一个特点是，他们经常发生在核心关注点的多处，而各处基本相似，比如权限认证、日志、事物。AOP的作用在于分离系统中的各种关注点，将核心关注点和横切关注点分离开来。</p>\n<h2 id=\"2-AOP核心概念\"><a href=\"#2-AOP核心概念\" class=\"headerlink\" title=\"2. AOP核心概念\"></a>2. AOP核心概念</h2><ul>\n<li><strong>连接点(Joinpoint)</strong>:被拦截到的点，因为Spring只支持方法类型的连接点，所以在Spring中连接点指的就是被拦截到的方法，实际上连接点还可以是字段或者构造器</li>\n<li><strong>切入点(Pointcut</strong>):要被增强的方法，定义了切入发生的地点</li>\n<li><strong>通知(advice)</strong>:要执行的增强方法，定义了切入的时机和执行的动作</li>\n<li><strong>切面(Aspect)</strong>:切入点和通知的对应关系，也就是两者结合的称呼</li>\n<li><strong>目标对象(Target Object)</strong>:包含切入点的运行时对象，也就是被代理的对象</li>\n<li><strong>AOP代理(aop proxy)</strong>:代理对象</li>\n<li><strong>织入(Weaving)</strong>:是一个将通知功能加入原始字节码的动态过程，共有三种方法，Spring使用的是运行时织入。</li>\n</ul>\n<h2 id=\"3-AOP运行环境\"><a href=\"#3-AOP运行环境\" class=\"headerlink\" title=\"3. AOP运行环境\"></a>3. AOP运行环境</h2><ul>\n<li>Spring核心包（4个）</li>\n<li>日志包（两个）</li>\n<li>AOP包（4个）<ul>\n<li>Spring进行AOP开发(1个)spring-aop-4.2.5.RELEASE.jar</li>\n<li>Spring整合AspectJ框架spring-aspects-4.2.5.RELEASE.jar</li>\n<li>AOP联盟规范(1个)com.springsource.org.aopalliance-1.0.0.jar</li>\n<li>aspectJ支持(1个)com.springsource.org.aspectj.weaver-1.7.2.RELEASE.jar</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"4-XML实现\"><a href=\"#4-XML实现\" class=\"headerlink\" title=\"4. XML实现\"></a>4. XML实现</h2><h3 id=\"4-1-在配置文件中开启AOP空间\"><a href=\"#4-1-在配置文件中开启AOP空间\" class=\"headerlink\" title=\"4.1 在配置文件中开启AOP空间\"></a>4.1 在配置文件中开启AOP空间</h3><h3 id=\"4-2-编写连接点类，即需要增强的业务类\"><a href=\"#4-2-编写连接点类，即需要增强的业务类\" class=\"headerlink\" title=\"4.2 编写连接点类，即需要增强的业务类\"></a>4.2 编写连接点类，即需要增强的业务类</h3><pre><code>业务类可以有上层接口(JDK代理)，也可以没有(cglib代理)\n</code></pre><ul>\n<li><p>业务类接口</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ImSleep</span> </span>&#123;</div><div class=\"line\"> <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sleep</span><span class=\"params\">()</span></span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul>\n<li><p>业务类实现</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HumanSleep</span> <span class=\"keyword\">implements</span> <span class=\"title\">ImSleep</span></span>&#123;</div><div class=\"line\"></div><div class=\"line\">   \t<span class=\"meta\">@Override</span></div><div class=\"line\">   \t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sleep</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">   \t\tSystem.out.println(<span class=\"string\">\"我要睡觉了\"</span>);</div><div class=\"line\">   \t&#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"4-3-编写通知类，即增强方法所在的类\"><a href=\"#4-3-编写通知类，即增强方法所在的类\" class=\"headerlink\" title=\"4.3 编写通知类，即增强方法所在的类\"></a>4.3 编写通知类，即增强方法所在的类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TimeHandler</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//通知方法</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">printTime</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"CurrentTime=\"</span> + System.currentTimeMillis());</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"4-4-在xml中配置切面，即关联切入点和通知\"><a href=\"#4-4-在xml中配置切面，即关联切入点和通知\" class=\"headerlink\" title=\"4.4 在xml中配置切面，即关联切入点和通知\"></a>4.4 在xml中配置切面，即关联切入点和通知</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"humanSleep\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.ssm.domian.HumanSleep\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"timeHandler\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.ssm.domian.TimeHandler\"</span>/&gt;</span></div><div class=\"line\">\t</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:config</span>&gt;</span></div><div class=\"line\">    //配置切面，ref关联通知类</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">aop:aspect</span> <span class=\"attr\">id</span>=<span class=\"string\">\"time\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"timeHandler\"</span>&gt;</span></div><div class=\"line\">\t    //切入点，匹配要切入的业务类</div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">aop:pointcut</span> <span class=\"attr\">expression</span>=<span class=\"string\">\"execution(*com.topvision.ssm.domian.HumanSleep.sleep())\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"addTime\"</span>/&gt;</span></div><div class=\"line\">\t\t//通知类型，执行通知类中的那个方法，关联的切入点</div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">aop:before</span> <span class=\"attr\">method</span>=<span class=\"string\">\"printTime\"</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"addTime\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">aop:after</span> <span class=\"attr\">method</span>=<span class=\"string\">\"printTime\"</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"addTime\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">aop:aspect</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">aop:config</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"4-5-测试类\"><a href=\"#4-5-测试类\" class=\"headerlink\" title=\"4.5 测试类\"></a>4.5 测试类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">ApplicationContext ctx = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(<span class=\"string\">\"applicationContext.xml\"</span>);</div><div class=\"line\">ImSleep human = (ImSleep) ctx.getBean(<span class=\"string\">\"humanSleep\"</span>);</div><div class=\"line\">human.sleep();</div></pre></td></tr></table></figure>\n<h2 id=\"5-注解实现\"><a href=\"#5-注解实现\" class=\"headerlink\" title=\"5. 注解实现\"></a>5. 注解实现</h2><h3 id=\"5-1-开启aop注解\"><a href=\"#5-1-开启aop注解\" class=\"headerlink\" title=\"5.1 开启aop注解\"></a>5.1 开启aop注解</h3><p>核心配置文件中添加以下配置，功能等同于注解配置Bean的自动扫描路径<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">//开启bean扫描</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.ssm.*\"</span>/&gt;</span> </div><div class=\"line\">//开启aop注解扫描</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:aspectj-autoproxy</span>/&gt;</span></div></pre></td></tr></table></figure></p>\n<h3 id=\"5-2-配置业务类\"><a href=\"#5-2-配置业务类\" class=\"headerlink\" title=\"5.2 配置业务类\"></a>5.2 配置业务类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Component</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Bussiness</span> </span>&#123;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * 切入点</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">delete</span><span class=\"params\">(String obj)</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"==========调用切入点：\"</span> + obj + <span class=\"string\">\"说：你敢删除我！===========\\n\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> obj + <span class=\"string\">\"：瞄～\"</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">add</span><span class=\"params\">(String obj)</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"================这个方法不能被切。。。============== \\n\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> obj + <span class=\"string\">\"：瞄～ 嘿嘿！\"</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">modify</span><span class=\"params\">(String obj)</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"=================这个也设置加入切吧====================\\n\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> obj + <span class=\"string\">\"：瞄改瞄啊！\"</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"5-3-配置通知类\"><a href=\"#5-3-配置通知类\" class=\"headerlink\" title=\"5.3 配置通知类\"></a>5.3 配置通知类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 定义切面</div><div class=\"line\"> * </div><div class=\"line\"> * <span class=\"doctag\">@Aspect</span> : 标记为切面类</div><div class=\"line\"> * <span class=\"doctag\">@Pointcut</span> : 指定匹配切点</div><div class=\"line\"> * <span class=\"doctag\">@Before</span> : 指定前置通知，value中指定切入点匹配</div><div class=\"line\"> * <span class=\"doctag\">@AfterReturning</span> ：后置通知，具有可以指定返回值</div><div class=\"line\"> * <span class=\"doctag\">@AfterThrowing</span> ：异常通知</div><div class=\"line\"> * </div><div class=\"line\"> * <span class=\"doctag\">@author</span> yanbin</div><div class=\"line\"> * </div><div class=\"line\"> */</div><div class=\"line\"><span class=\"meta\">@Component</span></div><div class=\"line\"><span class=\"meta\">@Aspect</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AspectAdvice</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 指定切入点匹配表达式，注意它是以方法的形式进行声明的。</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Pointcut</span>(<span class=\"string\">\"execution(* com.topvision.*..*.*(..))\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">anyMethod</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 前置通知</div><div class=\"line\">     * </div><div class=\"line\">     * <span class=\"doctag\">@param</span> jp</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Before</span>(value = <span class=\"string\">\"execution(* com.topvision.ssm.domian.Bussiness.delete(..))\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doBefore</span><span class=\"params\">(JoinPoint jp)</span> </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"===========进入before advice============ \\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        System.out.print(<span class=\"string\">\"准备在\"</span> + jp.getTarget().getClass() + <span class=\"string\">\"对象上用\"</span>);</div><div class=\"line\">        System.out.print(jp.getSignature().getName() + <span class=\"string\">\"方法进行对 '\"</span>);</div><div class=\"line\">        System.out.print(jp.getArgs()[<span class=\"number\">0</span>] + <span class=\"string\">\"'进行删除！\\n\\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        System.out.println(<span class=\"string\">\"要进入切入点方法了 \\n\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 后置通知</div><div class=\"line\">     * </div><div class=\"line\">     * <span class=\"doctag\">@param</span> jp</div><div class=\"line\">     *            连接点</div><div class=\"line\">     * <span class=\"doctag\">@param</span> result</div><div class=\"line\">     *            返回值</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@AfterReturning</span>(value = <span class=\"string\">\"anyMethod()\"</span>, returning = <span class=\"string\">\"result\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doAfter</span><span class=\"params\">(JoinPoint jp, String result)</span> </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"==========进入after advice=========== \\n\"</span>);</div><div class=\"line\">        System.out.println(<span class=\"string\">\"切入点方法执行完了 \\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        System.out.print(jp.getArgs()[<span class=\"number\">0</span>] + <span class=\"string\">\"在\"</span>);</div><div class=\"line\">        System.out.print(jp.getTarget().getClass() + <span class=\"string\">\"对象上被\"</span>);</div><div class=\"line\">        System.out.print(jp.getSignature().getName() + <span class=\"string\">\"方法删除了\"</span>);</div><div class=\"line\">        System.out.print(<span class=\"string\">\"只留下：\"</span> + result + <span class=\"string\">\"\\n\\n\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 环绕通知</div><div class=\"line\">     * </div><div class=\"line\">     * <span class=\"doctag\">@param</span> pjp</div><div class=\"line\">     *            连接点</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Around</span>(value = <span class=\"string\">\"anyMethod()\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doAround</span><span class=\"params\">(ProceedingJoinPoint pjp)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"===========进入around环绕方法！=========== \\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">// 调用目标方法之前执行的动作</span></div><div class=\"line\">        System.out.println(<span class=\"string\">\"调用方法之前: 执行！\\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">// 调用方法的参数</span></div><div class=\"line\">        Object[] args = pjp.getArgs();</div><div class=\"line\">        <span class=\"comment\">// 调用的方法名</span></div><div class=\"line\">        String method = pjp.getSignature().getName();</div><div class=\"line\">        <span class=\"comment\">// 获取目标对象</span></div><div class=\"line\">        Object target = pjp.getTarget();</div><div class=\"line\">        <span class=\"comment\">// 执行完方法的返回值：调用proceed()方法，就会触发切入点方法执行</span></div><div class=\"line\">        Object result = pjp.proceed();</div><div class=\"line\"></div><div class=\"line\">        System.out.println(<span class=\"string\">\"输出：\"</span> + args[<span class=\"number\">0</span>] + <span class=\"string\">\";\"</span> + method + <span class=\"string\">\";\"</span> + target + <span class=\"string\">\";\"</span> + result + <span class=\"string\">\"\\n\"</span>);</div><div class=\"line\">        System.out.println(<span class=\"string\">\"调用方法结束：之后执行！\\n\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 异常通知</div><div class=\"line\">     * </div><div class=\"line\">     * <span class=\"doctag\">@param</span> jp</div><div class=\"line\">     * <span class=\"doctag\">@param</span> e</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@AfterThrowing</span>(value = <span class=\"string\">\"anyMethod())\"</span>, throwing = <span class=\"string\">\"e\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doThrow</span><span class=\"params\">(JoinPoint jp, Throwable e)</span> </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"删除出错啦\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"5-4-测试类（集成junit）\"><a href=\"#5-4-测试类（集成junit）\" class=\"headerlink\" title=\"5.4 测试类（集成junit）\"></a>5.4 测试类（集成junit）</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class=\"line\"><span class=\"meta\">@ContextConfiguration</span>(locations=<span class=\"string\">\"classpath:applicationContext.xml\"</span>)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Test01</span></span>&#123;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"meta\">@Autowired</span></div><div class=\"line\">\t<span class=\"keyword\">private</span> Bussiness bs;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">BSTest</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tbs.delete(<span class=\"string\">\"qwe\"</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"6-切入点表达式及通知\"><a href=\"#6-切入点表达式及通知\" class=\"headerlink\" title=\"6. 切入点表达式及通知\"></a>6. 切入点表达式及通知</h2><h3 id=\"6-1-切入点表达式\"><a href=\"#6-1-切入点表达式\" class=\"headerlink\" title=\"6.1 切入点表达式\"></a>6.1 切入点表达式</h3><p>格式：execution(切入点表达式)<br>execution([方法的访问控制修饰符] 方法的返回值 包名.类名/接口名.方法名(参数))<br>注意：方法的访问控制修饰符可以省略<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">com.topvision.*.dao.UserDAO.add() com包下的topvision包下的任意包下的dao包下的...</div><div class=\"line\"> *..*.*()      任意包下的任意类中的任意方法</div></pre></td></tr></table></figure></p>\n<p><strong>方法参数</strong></p>\n<ul>\n<li>add()        无参数</li>\n<li>add(*)        一个参数</li>\n<li>add(int)        一个int型参数</li>\n<li>add(<em>,</em>)        两个参数</li>\n<li>add(*,int)        两个参数，第一个任意，第二个int</li>\n<li>add(..)        任意参数</li>\n<li>add(*,..)        至少一个参数</li>\n</ul>\n<h3 id=\"6-2-通知类型\"><a href=\"#6-2-通知类型\" class=\"headerlink\" title=\"6.2 通知类型\"></a>6.2 通知类型</h3><ol>\n<li><p>类型<br>before:在原始操作前运行<br>after: 在原始操作后运行，无论方法是否抛出异常<br>afterReturning:在原始操作后运行，只有方法正常结束才运行，抛出异常则不运行<br>afterThrowing:在原始操作中如果抛出异常，运行<br>around: 在原始操作前后运行，通过ProceedingJoinPoint对象调用procee()方法完成对原始操作的调用</p>\n</li>\n<li><p>格式</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:before</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"before\"</span>/&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:after</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"after\"</span>/&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:after-returning</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"afterReturning\"</span>/&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:after-throwing</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"afterThrowing\"</span>/&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:around</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"around\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"6-3-获取通知参数\"><a href=\"#6-3-获取通知参数\" class=\"headerlink\" title=\"6.3 获取通知参数\"></a>6.3 获取通知参数</h3><p>为环绕通知之外的通知方法定义形参<strong>JoinPoint</strong>，该参数必须是通知方法的第一个参数。<br>获取参数：Obejct[] args = jp.getArgs();<br>范例：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">before</span><span class=\"params\">(JoinPoint jp)</span></span>&#123;\t</div><div class=\"line\">\tObject[] objs = jp.getArgs();</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"before......\"</span>+objs[<span class=\"number\">0</span>]+<span class=\"string\">\",\"</span>+objs[<span class=\"number\">1</span>]);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>为环绕通知方法定义形参<strong>ProceedingJoinPoint</strong>对象<br>获取参数：Obejct[] args = pjp.getArgs();</p>\n<h3 id=\"6-4-获取通知返回值\"><a href=\"#6-4-获取通知返回值\" class=\"headerlink\" title=\"6.4 获取通知返回值\"></a>6.4 获取通知返回值</h3><p>afterReturning 与 around可以获取方法的返回值</p>\n<ul>\n<li>around通知获取返回值<br><strong>ProceedingJoinPoint</strong>对象执行调用原始操作的返回值就是原始方法的运行返回值。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">Object res = pt.proceed(args);</div></pre></td></tr></table></figure>\n<p>注意：如果原始方法返回值为void类型，则around方法返回值设置为Object。如果原始方法返回值为非void类型，则around方法内必须将原始方法调用的结果返回。<br>原始方法返回值为void类型的，通知内获取的返回值统一为null。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">around</span><span class=\"params\">(ProceedingJoinPoint pjp)</span> <span class=\"keyword\">throws</span> Throwable</span>&#123;</div><div class=\"line\">\tObject res = pjp.proceed(args);</div><div class=\"line\">\t<span class=\"keyword\">return</span> res;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<ul>\n<li>afterReturning通知获取返回值<br>在通知方法的参数中，声明一个Object类型的参数，用于保存方法的返回值</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterReturning</span><span class=\"params\">(JoinPoint jp,Object abc)</span></span>&#123;</div><div class=\"line\">    System.out.println(<span class=\"string\">\"afterReturning......\"</span>+ abc);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>在配置文件中，为afterReturning声明保存返回值的变量名</p>\n<h3 id=\"6-5-获取异常值\"><a href=\"#6-5-获取异常值\" class=\"headerlink\" title=\"6.5 获取异常值\"></a>6.5 获取异常值</h3><p>异常对象的获取方式与返回值很相似，声明变量，在配置中声明保存异常对象的变量名。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:after-throwing</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"afterThrowing\"</span> <span class=\"attr\">throwing</span>=<span class=\"string\">\"e\"</span>/&gt;</span></div></pre></td></tr></table></figure></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterThrowing</span> <span class=\"params\">(Throwable e)</span></span>&#123;</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"afterThrowing.......\"</span>+ e);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"7-JDK代理与cglib代理\"><a href=\"#7-JDK代理与cglib代理\" class=\"headerlink\" title=\"7. JDK代理与cglib代理\"></a>7. JDK代理与cglib代理</h2>"},{"title":"使用i18next完成前端国际化","date":"2017-09-30T01:53:44.000Z","_content":"i18next是一个用来支持应用国际化的javascript库,不依赖于其他第三方js库如jQuuery。[i18next官方网站][3]\n<!--more-->\n\n# 1 初始化init\n\n```javascript\ni18next\n    .use(i18nextXHRBackend)\n    .init({\n        fallbackLng: 'en',\n        lng: 'en',\n        debug: false,\n        ns: 'strings',\n        defaultNS: 'strings',\n        backend: {\n            loadPath: src + '/{{lng}}/{{ns}}.json', //在每个html中定义localesPath，即localesPath文件夹路径\n            crossDomain: true\n        }\n    }, function(err, t) {\n        // init set content\n        var array = document.querySelectorAll('[data-i18n]');\n        if(array){\n            for(var i = 0, len = array.length; i < len; i++) {\n                var value = array[i].getAttribute('data-i18n');\n                array[i].innerHTML = i18next.t(value);\n            }\n        };\n\n        var inputs = document.querySelectorAll('input');\n        if(inputs) {\n            for(var i = 0, len = inputs.length; i < len; i++) {\n            \tvar placeholder = inputs[i].getAttribute(\"placeholder\");\n            \tvar value = inputs[i].getAttribute('data-i18n');\n            \tif(placeholder != null){\n                \tinputs[i].setAttribute(\"placeholder\", i18next.t(value));\n                }\n            }\n        }\n    });\n```\n\n# 2 API\n\n## 2.1 init\n\n    i18next.init(options, callback)\n    \n```javascript\ni18next.init({\n    fallbackLng: 'en',\n    ns: ['file1', 'file2'],\n    defaultNS: 'file1',\n    debug: true\n}, (err, t) => {\n    if(err) return console.log('something went wrong loading', err);\n    t('key'); // -> same as i18next.t\n});\n\n// with only callback\ni18next.init((err, t) => {\n    if(err) return console.log('something went wrong loading', err);\n    t('key'); // -> same as i18next.t\n});\n```\n\n - debug:default false，是否输出日志\n - fallbackLng:default 'dev',当当前语言中找不到key，则去fallbackLng中查找\n - lng:default undefined,设置当前翻译的语言\n - ns：default 'translation'，命名空间，可以是数组，可以理解为国际化文件的名字\n - defaultNS：default 'translation'，如果没有找到设置的ns文件，则去找defaultNS文件\n - backend：设置国际化文件路径，需要配合***i18nextXHRBackend***插件使用，可以跨域读取网络文件，可以读取本地文件。具体配置参看[i18next-xhr-backend][1]\n    -  loadPath： 文件路径\n    -  crossDomain： 是否强制跨域\n\n## 2.2 use\n    \n    i18next.use(module)\n    \n用来添加插件,如下代码所示，注意：一定要在工程中引入对应的js文件\n```javascript\ni18next\n  .use(Backend)\n  .use(Cache)\n  .use(LanguageDetector)\n  .use(postProcessor)\n  .init(options, callback);\n```\n\n## 2.3 t\n\n    i18next.t(keys, options)\n\n在js中手动查找key得到对应翻译，options可省略，基本用法如下，详细用法请参看[interpolation][2]\n\n```javascript\ni18next.t('common.hello') 或 t('common.hello')\n```\n\n# 3 小结\n\n以上是i18next的基本使用，可以满足基本的国际化需求。对于更加复杂的国际化需求，请参看官方文档。\n\n说明：\n\n 1. 国际化文件为json格式\n 2. 国际化文件路径建议设置为 locales/语言（国家代码）/命名空间.json\n 3. 对应第2条，loadPath设置为 locales文件夹路径/{{lng}}/{{ns}}.json\n\n    \n \n\n\n\n  [1]: https://github.com/i18next/i18next-xhr-backend\n  [2]: https://www.i18next.com/interpolation.html\n  [3]: https://github.com/i18next/i18next","source":"_posts/使用i18next完成前端国际化.md","raw":"---\ntitle: 使用i18next完成前端国际化\ncategories:\n  - Web\ntags:\n  - 国际化\ndate: 2017-09-30 09:53:44\n---\ni18next是一个用来支持应用国际化的javascript库,不依赖于其他第三方js库如jQuuery。[i18next官方网站][3]\n<!--more-->\n\n# 1 初始化init\n\n```javascript\ni18next\n    .use(i18nextXHRBackend)\n    .init({\n        fallbackLng: 'en',\n        lng: 'en',\n        debug: false,\n        ns: 'strings',\n        defaultNS: 'strings',\n        backend: {\n            loadPath: src + '/{{lng}}/{{ns}}.json', //在每个html中定义localesPath，即localesPath文件夹路径\n            crossDomain: true\n        }\n    }, function(err, t) {\n        // init set content\n        var array = document.querySelectorAll('[data-i18n]');\n        if(array){\n            for(var i = 0, len = array.length; i < len; i++) {\n                var value = array[i].getAttribute('data-i18n');\n                array[i].innerHTML = i18next.t(value);\n            }\n        };\n\n        var inputs = document.querySelectorAll('input');\n        if(inputs) {\n            for(var i = 0, len = inputs.length; i < len; i++) {\n            \tvar placeholder = inputs[i].getAttribute(\"placeholder\");\n            \tvar value = inputs[i].getAttribute('data-i18n');\n            \tif(placeholder != null){\n                \tinputs[i].setAttribute(\"placeholder\", i18next.t(value));\n                }\n            }\n        }\n    });\n```\n\n# 2 API\n\n## 2.1 init\n\n    i18next.init(options, callback)\n    \n```javascript\ni18next.init({\n    fallbackLng: 'en',\n    ns: ['file1', 'file2'],\n    defaultNS: 'file1',\n    debug: true\n}, (err, t) => {\n    if(err) return console.log('something went wrong loading', err);\n    t('key'); // -> same as i18next.t\n});\n\n// with only callback\ni18next.init((err, t) => {\n    if(err) return console.log('something went wrong loading', err);\n    t('key'); // -> same as i18next.t\n});\n```\n\n - debug:default false，是否输出日志\n - fallbackLng:default 'dev',当当前语言中找不到key，则去fallbackLng中查找\n - lng:default undefined,设置当前翻译的语言\n - ns：default 'translation'，命名空间，可以是数组，可以理解为国际化文件的名字\n - defaultNS：default 'translation'，如果没有找到设置的ns文件，则去找defaultNS文件\n - backend：设置国际化文件路径，需要配合***i18nextXHRBackend***插件使用，可以跨域读取网络文件，可以读取本地文件。具体配置参看[i18next-xhr-backend][1]\n    -  loadPath： 文件路径\n    -  crossDomain： 是否强制跨域\n\n## 2.2 use\n    \n    i18next.use(module)\n    \n用来添加插件,如下代码所示，注意：一定要在工程中引入对应的js文件\n```javascript\ni18next\n  .use(Backend)\n  .use(Cache)\n  .use(LanguageDetector)\n  .use(postProcessor)\n  .init(options, callback);\n```\n\n## 2.3 t\n\n    i18next.t(keys, options)\n\n在js中手动查找key得到对应翻译，options可省略，基本用法如下，详细用法请参看[interpolation][2]\n\n```javascript\ni18next.t('common.hello') 或 t('common.hello')\n```\n\n# 3 小结\n\n以上是i18next的基本使用，可以满足基本的国际化需求。对于更加复杂的国际化需求，请参看官方文档。\n\n说明：\n\n 1. 国际化文件为json格式\n 2. 国际化文件路径建议设置为 locales/语言（国家代码）/命名空间.json\n 3. 对应第2条，loadPath设置为 locales文件夹路径/{{lng}}/{{ns}}.json\n\n    \n \n\n\n\n  [1]: https://github.com/i18next/i18next-xhr-backend\n  [2]: https://www.i18next.com/interpolation.html\n  [3]: https://github.com/i18next/i18next","slug":"使用i18next完成前端国际化","published":1,"updated":"2018-02-27T07:38:38.102Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspg8001zn8vfmc55lrdv","content":"<p>i18next是一个用来支持应用国际化的javascript库,不依赖于其他第三方js库如jQuuery。<a href=\"https://github.com/i18next/i18next\" target=\"_blank\" rel=\"noopener\">i18next官方网站</a><br><a id=\"more\"></a></p>\n<h1 id=\"1-初始化init\"><a href=\"#1-初始化init\" class=\"headerlink\" title=\"1 初始化init\"></a>1 初始化init</h1><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\">i18next</div><div class=\"line\">    .use(i18nextXHRBackend)</div><div class=\"line\">    .init(&#123;</div><div class=\"line\">        <span class=\"attr\">fallbackLng</span>: <span class=\"string\">'en'</span>,</div><div class=\"line\">        <span class=\"attr\">lng</span>: <span class=\"string\">'en'</span>,</div><div class=\"line\">        <span class=\"attr\">debug</span>: <span class=\"literal\">false</span>,</div><div class=\"line\">        <span class=\"attr\">ns</span>: <span class=\"string\">'strings'</span>,</div><div class=\"line\">        <span class=\"attr\">defaultNS</span>: <span class=\"string\">'strings'</span>,</div><div class=\"line\">        <span class=\"attr\">backend</span>: &#123;</div><div class=\"line\">            <span class=\"attr\">loadPath</span>: src + <span class=\"string\">'/&#123;&#123;lng&#125;&#125;/&#123;&#123;ns&#125;&#125;.json'</span>, <span class=\"comment\">//在每个html中定义localesPath，即localesPath文件夹路径</span></div><div class=\"line\">            crossDomain: <span class=\"literal\">true</span></div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, t</span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// init set content</span></div><div class=\"line\">        <span class=\"keyword\">var</span> array = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">'[data-i18n]'</span>);</div><div class=\"line\">        <span class=\"keyword\">if</span>(array)&#123;</div><div class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = array.length; i &lt; len; i++) &#123;</div><div class=\"line\">                <span class=\"keyword\">var</span> value = array[i].getAttribute(<span class=\"string\">'data-i18n'</span>);</div><div class=\"line\">                array[i].innerHTML = i18next.t(value);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">var</span> inputs = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">'input'</span>);</div><div class=\"line\">        <span class=\"keyword\">if</span>(inputs) &#123;</div><div class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = inputs.length; i &lt; len; i++) &#123;</div><div class=\"line\">            \t<span class=\"keyword\">var</span> placeholder = inputs[i].getAttribute(<span class=\"string\">\"placeholder\"</span>);</div><div class=\"line\">            \t<span class=\"keyword\">var</span> value = inputs[i].getAttribute(<span class=\"string\">'data-i18n'</span>);</div><div class=\"line\">            \t<span class=\"keyword\">if</span>(placeholder != <span class=\"literal\">null</span>)&#123;</div><div class=\"line\">                \tinputs[i].setAttribute(<span class=\"string\">\"placeholder\"</span>, i18next.t(value));</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;);</div></pre></td></tr></table></figure>\n<h1 id=\"2-API\"><a href=\"#2-API\" class=\"headerlink\" title=\"2 API\"></a>2 API</h1><h2 id=\"2-1-init\"><a href=\"#2-1-init\" class=\"headerlink\" title=\"2.1 init\"></a>2.1 init</h2><pre><code>i18next.init(options, callback)\n</code></pre><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">i18next.init(&#123;</div><div class=\"line\">    <span class=\"attr\">fallbackLng</span>: <span class=\"string\">'en'</span>,</div><div class=\"line\">    <span class=\"attr\">ns</span>: [<span class=\"string\">'file1'</span>, <span class=\"string\">'file2'</span>],</div><div class=\"line\">    <span class=\"attr\">defaultNS</span>: <span class=\"string\">'file1'</span>,</div><div class=\"line\">    <span class=\"attr\">debug</span>: <span class=\"literal\">true</span></div><div class=\"line\">&#125;, (err, t) =&gt; &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(err) <span class=\"keyword\">return</span> <span class=\"built_in\">console</span>.log(<span class=\"string\">'something went wrong loading'</span>, err);</div><div class=\"line\">    t(<span class=\"string\">'key'</span>); <span class=\"comment\">// -&gt; same as i18next.t</span></div><div class=\"line\">&#125;);</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// with only callback</span></div><div class=\"line\">i18next.init(<span class=\"function\">(<span class=\"params\">err, t</span>) =&gt;</span> &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(err) <span class=\"keyword\">return</span> <span class=\"built_in\">console</span>.log(<span class=\"string\">'something went wrong loading'</span>, err);</div><div class=\"line\">    t(<span class=\"string\">'key'</span>); <span class=\"comment\">// -&gt; same as i18next.t</span></div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<ul>\n<li>debug:default false，是否输出日志</li>\n<li>fallbackLng:default ‘dev’,当当前语言中找不到key，则去fallbackLng中查找</li>\n<li>lng:default undefined,设置当前翻译的语言</li>\n<li>ns：default ‘translation’，命名空间，可以是数组，可以理解为国际化文件的名字</li>\n<li>defaultNS：default ‘translation’，如果没有找到设置的ns文件，则去找defaultNS文件</li>\n<li>backend：设置国际化文件路径，需要配合<strong><em>i18nextXHRBackend</em></strong>插件使用，可以跨域读取网络文件，可以读取本地文件。具体配置参看<a href=\"https://github.com/i18next/i18next-xhr-backend\" target=\"_blank\" rel=\"noopener\">i18next-xhr-backend</a><ul>\n<li>loadPath： 文件路径</li>\n<li>crossDomain： 是否强制跨域</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"2-2-use\"><a href=\"#2-2-use\" class=\"headerlink\" title=\"2.2 use\"></a>2.2 use</h2><pre><code>i18next.use(module)\n</code></pre><p>用来添加插件,如下代码所示，注意：一定要在工程中引入对应的js文件<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">i18next</div><div class=\"line\">  .use(Backend)</div><div class=\"line\">  .use(Cache)</div><div class=\"line\">  .use(LanguageDetector)</div><div class=\"line\">  .use(postProcessor)</div><div class=\"line\">  .init(options, callback);</div></pre></td></tr></table></figure></p>\n<h2 id=\"2-3-t\"><a href=\"#2-3-t\" class=\"headerlink\" title=\"2.3 t\"></a>2.3 t</h2><pre><code>i18next.t(keys, options)\n</code></pre><p>在js中手动查找key得到对应翻译，options可省略，基本用法如下，详细用法请参看<a href=\"https://www.i18next.com/interpolation.html\" target=\"_blank\" rel=\"noopener\">interpolation</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">i18next.t(<span class=\"string\">'common.hello'</span>) 或 t(<span class=\"string\">'common.hello'</span>)</div></pre></td></tr></table></figure>\n<h1 id=\"3-小结\"><a href=\"#3-小结\" class=\"headerlink\" title=\"3 小结\"></a>3 小结</h1><p>以上是i18next的基本使用，可以满足基本的国际化需求。对于更加复杂的国际化需求，请参看官方文档。</p>\n<p>说明：</p>\n<ol>\n<li>国际化文件为json格式</li>\n<li>国际化文件路径建议设置为 locales/语言（国家代码）/命名空间.json</li>\n<li>对应第2条，loadPath设置为 locales文件夹路径//.json</li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>i18next是一个用来支持应用国际化的javascript库,不依赖于其他第三方js库如jQuuery。<a href=\"https://github.com/i18next/i18next\" target=\"_blank\" rel=\"noopener\">i18next官方网站</a><br>","more":"</p>\n<h1 id=\"1-初始化init\"><a href=\"#1-初始化init\" class=\"headerlink\" title=\"1 初始化init\"></a>1 初始化init</h1><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\">i18next</div><div class=\"line\">    .use(i18nextXHRBackend)</div><div class=\"line\">    .init(&#123;</div><div class=\"line\">        <span class=\"attr\">fallbackLng</span>: <span class=\"string\">'en'</span>,</div><div class=\"line\">        <span class=\"attr\">lng</span>: <span class=\"string\">'en'</span>,</div><div class=\"line\">        <span class=\"attr\">debug</span>: <span class=\"literal\">false</span>,</div><div class=\"line\">        <span class=\"attr\">ns</span>: <span class=\"string\">'strings'</span>,</div><div class=\"line\">        <span class=\"attr\">defaultNS</span>: <span class=\"string\">'strings'</span>,</div><div class=\"line\">        <span class=\"attr\">backend</span>: &#123;</div><div class=\"line\">            <span class=\"attr\">loadPath</span>: src + <span class=\"string\">'/&#123;&#123;lng&#125;&#125;/&#123;&#123;ns&#125;&#125;.json'</span>, <span class=\"comment\">//在每个html中定义localesPath，即localesPath文件夹路径</span></div><div class=\"line\">            crossDomain: <span class=\"literal\">true</span></div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, t</span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// init set content</span></div><div class=\"line\">        <span class=\"keyword\">var</span> array = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">'[data-i18n]'</span>);</div><div class=\"line\">        <span class=\"keyword\">if</span>(array)&#123;</div><div class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = array.length; i &lt; len; i++) &#123;</div><div class=\"line\">                <span class=\"keyword\">var</span> value = array[i].getAttribute(<span class=\"string\">'data-i18n'</span>);</div><div class=\"line\">                array[i].innerHTML = i18next.t(value);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">var</span> inputs = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">'input'</span>);</div><div class=\"line\">        <span class=\"keyword\">if</span>(inputs) &#123;</div><div class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = inputs.length; i &lt; len; i++) &#123;</div><div class=\"line\">            \t<span class=\"keyword\">var</span> placeholder = inputs[i].getAttribute(<span class=\"string\">\"placeholder\"</span>);</div><div class=\"line\">            \t<span class=\"keyword\">var</span> value = inputs[i].getAttribute(<span class=\"string\">'data-i18n'</span>);</div><div class=\"line\">            \t<span class=\"keyword\">if</span>(placeholder != <span class=\"literal\">null</span>)&#123;</div><div class=\"line\">                \tinputs[i].setAttribute(<span class=\"string\">\"placeholder\"</span>, i18next.t(value));</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;);</div></pre></td></tr></table></figure>\n<h1 id=\"2-API\"><a href=\"#2-API\" class=\"headerlink\" title=\"2 API\"></a>2 API</h1><h2 id=\"2-1-init\"><a href=\"#2-1-init\" class=\"headerlink\" title=\"2.1 init\"></a>2.1 init</h2><pre><code>i18next.init(options, callback)\n</code></pre><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">i18next.init(&#123;</div><div class=\"line\">    <span class=\"attr\">fallbackLng</span>: <span class=\"string\">'en'</span>,</div><div class=\"line\">    <span class=\"attr\">ns</span>: [<span class=\"string\">'file1'</span>, <span class=\"string\">'file2'</span>],</div><div class=\"line\">    <span class=\"attr\">defaultNS</span>: <span class=\"string\">'file1'</span>,</div><div class=\"line\">    <span class=\"attr\">debug</span>: <span class=\"literal\">true</span></div><div class=\"line\">&#125;, (err, t) =&gt; &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(err) <span class=\"keyword\">return</span> <span class=\"built_in\">console</span>.log(<span class=\"string\">'something went wrong loading'</span>, err);</div><div class=\"line\">    t(<span class=\"string\">'key'</span>); <span class=\"comment\">// -&gt; same as i18next.t</span></div><div class=\"line\">&#125;);</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// with only callback</span></div><div class=\"line\">i18next.init(<span class=\"function\">(<span class=\"params\">err, t</span>) =&gt;</span> &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(err) <span class=\"keyword\">return</span> <span class=\"built_in\">console</span>.log(<span class=\"string\">'something went wrong loading'</span>, err);</div><div class=\"line\">    t(<span class=\"string\">'key'</span>); <span class=\"comment\">// -&gt; same as i18next.t</span></div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<ul>\n<li>debug:default false，是否输出日志</li>\n<li>fallbackLng:default ‘dev’,当当前语言中找不到key，则去fallbackLng中查找</li>\n<li>lng:default undefined,设置当前翻译的语言</li>\n<li>ns：default ‘translation’，命名空间，可以是数组，可以理解为国际化文件的名字</li>\n<li>defaultNS：default ‘translation’，如果没有找到设置的ns文件，则去找defaultNS文件</li>\n<li>backend：设置国际化文件路径，需要配合<strong><em>i18nextXHRBackend</em></strong>插件使用，可以跨域读取网络文件，可以读取本地文件。具体配置参看<a href=\"https://github.com/i18next/i18next-xhr-backend\" target=\"_blank\" rel=\"noopener\">i18next-xhr-backend</a><ul>\n<li>loadPath： 文件路径</li>\n<li>crossDomain： 是否强制跨域</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"2-2-use\"><a href=\"#2-2-use\" class=\"headerlink\" title=\"2.2 use\"></a>2.2 use</h2><pre><code>i18next.use(module)\n</code></pre><p>用来添加插件,如下代码所示，注意：一定要在工程中引入对应的js文件<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">i18next</div><div class=\"line\">  .use(Backend)</div><div class=\"line\">  .use(Cache)</div><div class=\"line\">  .use(LanguageDetector)</div><div class=\"line\">  .use(postProcessor)</div><div class=\"line\">  .init(options, callback);</div></pre></td></tr></table></figure></p>\n<h2 id=\"2-3-t\"><a href=\"#2-3-t\" class=\"headerlink\" title=\"2.3 t\"></a>2.3 t</h2><pre><code>i18next.t(keys, options)\n</code></pre><p>在js中手动查找key得到对应翻译，options可省略，基本用法如下，详细用法请参看<a href=\"https://www.i18next.com/interpolation.html\" target=\"_blank\" rel=\"noopener\">interpolation</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">i18next.t(<span class=\"string\">'common.hello'</span>) 或 t(<span class=\"string\">'common.hello'</span>)</div></pre></td></tr></table></figure>\n<h1 id=\"3-小结\"><a href=\"#3-小结\" class=\"headerlink\" title=\"3 小结\"></a>3 小结</h1><p>以上是i18next的基本使用，可以满足基本的国际化需求。对于更加复杂的国际化需求，请参看官方文档。</p>\n<p>说明：</p>\n<ol>\n<li>国际化文件为json格式</li>\n<li>国际化文件路径建议设置为 locales/语言（国家代码）/命名空间.json</li>\n<li>对应第2条，loadPath设置为 locales文件夹路径//.json</li>\n</ol>"},{"title":"使用jquery.i18n完成前端国际化","date":"2017-08-31T05:15:33.000Z","_content":"本文对 jQuery 国际化插件 jQuery.i18n.properties 进行了介绍，并用实际例子介绍了如何使用 jQuery.i18n.properties 插件实现 Web 前端的国际化。总结起来，jQuery.i18n.properties 具有轻量级（压缩后仅 4kb）、简单易用等特点，但是作为一个普及度不高的轻量级插件，不一定适用于大型的或对效率要求极高的场景。\n<!--more-->\n## 1. 简介\n\njQuery.i18n.properties 是一款轻量级的 jQuery 国际化插件。与 Java 里的资源文件类似，jQuery.i18n.properties 采用 .properties 文件对 JavaScript 进行国际化。jQuery.i18n.properties 插件根据用户指定的（或浏览器提供的 ）语言和国家编码（符合 ISO-639 和 ISO-3166 标准）来解析对应的以“.properties”为后缀的资源文件。\n\n利用资源文件实现国际化是一种比较流行的方式，例如 Android 应用就可以采用以语言和国家编码命名的资源文件来实现国际化。jQuery.i18n.properties 插件中的资源文件以“.properties”为后缀，包含了区域相关的键值对。我们知道，Java 程序也可以使用以 .properties 为后缀的资源文件来实现国际化，因此，当我们要在 Java 程序和前端 JavaScript 程序中共享资源文件时，这种方式就显得特别有用。jQuery.i18n.properties 插件首先加载默认的资源文件（例如：strings.properties），然后加载针对特定语言环境的资源文件（例如：strings_zh.properties），这就保证了在未提供某种语言的翻译时，默认值始终有效。开发人员可以以 JavaScript 变量（或函数）或 Map 的方式使用资源文件中的 key。\n\n总的来说，jQuery.i18n.properties 有一下一些特点：\n\n 1. 使用 Java 标准的 .properties 文件作为资源文件，资源文件命名有以下三种格式：\n\n    ```javascript\n    basename_properties \n    basename_language.properties \n    basename_language_country.properties\n    ```\n 2. 使用 ISO-639 作为语言编码标准，ISO-3166 作为国家名称编码标准\n 3. 按顺序加载默认资源文件和指定语言环境的资源文件，保证默认值始终可用\n 4. 未指定语言环境时使用浏览器提供的语言\n 5. 可以在资源字符串中使用占位符（例如：hello= 你好 {0}! 今天是 {1}。）\n 6. 资源文件中的 Key 支持命名空间（例如：com.company.msgs.hello = Hello!）\n 7. 支持跨行的值\n 8. 可以以 JavaScript 变量（或函数）或 Map 的方式使用资源文件中的 Key\n\n## 2. API\n\njQuery.i18n.properties 的 API 非常简单，只有少数几个 API，即 jQuery.i18n.properties()、jQuery.i18n.prop()、jQuery.i18n.browserLang()。当然，和其他 jQuery 插件一样，我们也可以采用 $.i18n.properties()、$.i18n.prop() 和 $.i18n.browserLang() 的形式使用这用这些 API。\n\n### 2.1 jQuery.i18n.properties(setting)\n\n该方法加载资源文件，其中 settings 是配置加载选项的一系列键值对，各配置项的具体描述如表 1 所示。\n\n**表 1. settings**\n选项| 描述 | 类型 | 可选\n-------|----------\nname | 资源文件的名称，例如 strings 或 [strings1,strings2]，前者代表一个资源文件，后者代表资源文件数组。| String或String[] | 否\npath | 资源文件所在目录的路径 | String | 是\nmode | 加载模式：“vars”表示以JavaScript变量或函数的形式使用资源文件中的Key，“map”表示以 Map 的方式使用资源文件中的Key，“both”表示可以同时使用两种方式。如果资源文件中的 Key 包含 JavaScript 的关键字，则只能采用“map”。默认值是“vars”。 | String | 是\nlanguage | ISO-639 指定的语言编码（如：“en”表示英文、“zh”表示中文），或同时使用ISO-639 指定的语言编码和ISO-3166指定的国家编码（如：“en_US”，“zh_CN”等）。如果不指定，则采用浏览器报告的语言编码。 | String | 是\ncache | 指定浏览器是否对资源文件进行缓存，默认为 false。 | boolean | 是\nencoding | 加载资源文件时使用的编码。默认为 UTF-8。 | String | 是\ncallback | \t代码执行完成时运行的回调函数 | function | 是\n\njQuery.i18n.properties() 的使用方法如清单 1 所示。\n\n清单 1. jQuery.i18n.properties() 用法\n\n```javascript\njQuery.i18n.properties({ \n   name:'strings',// 资源文件名称\n   path:'bundle/',// 资源文件所在目录路径\n   mode:'both',// 模式：变量或 Map \n   language:'pt_PT',// 对应的语言\n   cache:false, \n   encoding: 'UTF-8', \n   callback: function() {// 回调方法\n   } \n});\n```\n\n### 2.2 jQuery.i18n.prop(key)\n\n该方法以 map 的方式使用资源文件中的值，其中 key 指的是资源文件中的 key。当 key 指定的值含有占位符时，可以使用 jQuery.i18n.prop(key,var1,var2 … ) 的形式，其中 var1,var2 …对各占位符依次进行替换。例如资源文件中有“msg_hello= 您好 {0}，今天是 {1}。”的键值对，则我们可以采用“jQuery.i18n.prop( ‘ msg_hello ’ , ’小明’ , ’星期一’ );”的形式使用 msg_hello。\n\n### 2.3 jQuery.i18n.browserLang() \n\n用于获取浏览浏览器的语言信息，这里不再单独介绍。\n\n## 3. 示例\n\n### 3.1 建立资源文件\n\n如下图所示：\n![工程结构][1]\n\n在 i18n 目录下创建 strings_en.properties 和，stirngs_zh.properties 两个资源文件，其中 strings_en.properties 对应英文翻译，如清单 2 所示；string_zh.properties 对应中文翻译，如清单 3 所示。\n\n清单 2. stirngs_en.properties\n\n```properties\nloginTitle              = Login NM3000\nusername                = username\nusernameEnter           = please enter username\npassword                = password\npasswordEnter           = please enter password\nautoLogin               = AutoLogin\nlogin                   = Login\ncopyright               = Topvision All Rights Reserved\n```\n\n清单3. strings_zh.properties\n\n```properties\nloginTitle             = 登录NM3000\nusername                = 用户名\npassword                = 密码\nautoLogin               = 自动登录\nlogin                   = 登录\n```\n\n### 3.2 引用插件\n和其他 jQuery 插件一样，jQuery.i18n.properties插件依赖jQuery，因此我们首先需要引用 jQuery。jQuery.i18n.properties 对 jQuery 的版本没有明确要求。我们使用清单 4 所示的方式在 index.html 中引用 jQuery 和 jQuery.i18n.properties 插件。\n \n 清单 4. 引用 jQuery.i18n.properties\n```javascript\n<script type=\"text/javascript\" src=\"../../lib/jquery/jquery.min.js\"></script>\n<script type=\"text/javascript\" src=\"../../lib/jquery/jquery.i18n.properties-min-1.0.9.js\"></script>\n```\n\n### 3.3 使用\n\n```javascript\n$(function() {\n    lang = (jQuery.i18n.browserLang().substring(0, 2)); //默认从浏览器语言读取\n    jQuery.i18n.properties({\n        name: 'strings',\n        path: '../../i18n/', //资源文件路径\n        mode: 'map', //用Map的方式使用资源文件中的值\n        language: 'en',\n        callback: function() { //加载成功后设置显示内容\n            $('#title').html($.i18n.prop('loginTitle'));\n            ...\n        }\n    });\n})\n```\n\n## 4. 注意事项\n\n### 4.1 资源文件命名\n\n var lang = jQuery.i18n.browserLang() 获取的语言是zh-CN、en-US格式，\n jQuery.i18n.properties 默认的资源文件命名方式为“zh_CN”、“en_US”的形式\n \n 设置插件语言的时候一定要和资源文件的语言代码一致，否则无法解析。\n \n## 5. 总结\n\n本文对 jQuery 国际化插件 jQuery.i18n.properties 进行了介绍，并用实际例子介绍了如何使用 jQuery.i18n.properties 插件实现 Web 前端的国际化。总结起来，jQuery.i18n.properties 具有轻量级（压缩后仅 4kb）、简单易用等特点，但是作为一个普及度不高的轻量级插件，不一定适用于大型的或对效率要求极高的场景。\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/web/jqueryi18n%E7%A4%BA%E4%BE%8B%E5%B7%A5%E7%A8%8B%E7%9B%AE%E5%BD%95.png","source":"_posts/使用jquery-i18n完成前端国际化.md","raw":"---\ntitle: 使用jquery.i18n完成前端国际化\ncategories:\n  - Web\ntags:\n  - 国际化\ndate: 2017-08-31 13:15:33\n---\n本文对 jQuery 国际化插件 jQuery.i18n.properties 进行了介绍，并用实际例子介绍了如何使用 jQuery.i18n.properties 插件实现 Web 前端的国际化。总结起来，jQuery.i18n.properties 具有轻量级（压缩后仅 4kb）、简单易用等特点，但是作为一个普及度不高的轻量级插件，不一定适用于大型的或对效率要求极高的场景。\n<!--more-->\n## 1. 简介\n\njQuery.i18n.properties 是一款轻量级的 jQuery 国际化插件。与 Java 里的资源文件类似，jQuery.i18n.properties 采用 .properties 文件对 JavaScript 进行国际化。jQuery.i18n.properties 插件根据用户指定的（或浏览器提供的 ）语言和国家编码（符合 ISO-639 和 ISO-3166 标准）来解析对应的以“.properties”为后缀的资源文件。\n\n利用资源文件实现国际化是一种比较流行的方式，例如 Android 应用就可以采用以语言和国家编码命名的资源文件来实现国际化。jQuery.i18n.properties 插件中的资源文件以“.properties”为后缀，包含了区域相关的键值对。我们知道，Java 程序也可以使用以 .properties 为后缀的资源文件来实现国际化，因此，当我们要在 Java 程序和前端 JavaScript 程序中共享资源文件时，这种方式就显得特别有用。jQuery.i18n.properties 插件首先加载默认的资源文件（例如：strings.properties），然后加载针对特定语言环境的资源文件（例如：strings_zh.properties），这就保证了在未提供某种语言的翻译时，默认值始终有效。开发人员可以以 JavaScript 变量（或函数）或 Map 的方式使用资源文件中的 key。\n\n总的来说，jQuery.i18n.properties 有一下一些特点：\n\n 1. 使用 Java 标准的 .properties 文件作为资源文件，资源文件命名有以下三种格式：\n\n    ```javascript\n    basename_properties \n    basename_language.properties \n    basename_language_country.properties\n    ```\n 2. 使用 ISO-639 作为语言编码标准，ISO-3166 作为国家名称编码标准\n 3. 按顺序加载默认资源文件和指定语言环境的资源文件，保证默认值始终可用\n 4. 未指定语言环境时使用浏览器提供的语言\n 5. 可以在资源字符串中使用占位符（例如：hello= 你好 {0}! 今天是 {1}。）\n 6. 资源文件中的 Key 支持命名空间（例如：com.company.msgs.hello = Hello!）\n 7. 支持跨行的值\n 8. 可以以 JavaScript 变量（或函数）或 Map 的方式使用资源文件中的 Key\n\n## 2. API\n\njQuery.i18n.properties 的 API 非常简单，只有少数几个 API，即 jQuery.i18n.properties()、jQuery.i18n.prop()、jQuery.i18n.browserLang()。当然，和其他 jQuery 插件一样，我们也可以采用 $.i18n.properties()、$.i18n.prop() 和 $.i18n.browserLang() 的形式使用这用这些 API。\n\n### 2.1 jQuery.i18n.properties(setting)\n\n该方法加载资源文件，其中 settings 是配置加载选项的一系列键值对，各配置项的具体描述如表 1 所示。\n\n**表 1. settings**\n选项| 描述 | 类型 | 可选\n-------|----------\nname | 资源文件的名称，例如 strings 或 [strings1,strings2]，前者代表一个资源文件，后者代表资源文件数组。| String或String[] | 否\npath | 资源文件所在目录的路径 | String | 是\nmode | 加载模式：“vars”表示以JavaScript变量或函数的形式使用资源文件中的Key，“map”表示以 Map 的方式使用资源文件中的Key，“both”表示可以同时使用两种方式。如果资源文件中的 Key 包含 JavaScript 的关键字，则只能采用“map”。默认值是“vars”。 | String | 是\nlanguage | ISO-639 指定的语言编码（如：“en”表示英文、“zh”表示中文），或同时使用ISO-639 指定的语言编码和ISO-3166指定的国家编码（如：“en_US”，“zh_CN”等）。如果不指定，则采用浏览器报告的语言编码。 | String | 是\ncache | 指定浏览器是否对资源文件进行缓存，默认为 false。 | boolean | 是\nencoding | 加载资源文件时使用的编码。默认为 UTF-8。 | String | 是\ncallback | \t代码执行完成时运行的回调函数 | function | 是\n\njQuery.i18n.properties() 的使用方法如清单 1 所示。\n\n清单 1. jQuery.i18n.properties() 用法\n\n```javascript\njQuery.i18n.properties({ \n   name:'strings',// 资源文件名称\n   path:'bundle/',// 资源文件所在目录路径\n   mode:'both',// 模式：变量或 Map \n   language:'pt_PT',// 对应的语言\n   cache:false, \n   encoding: 'UTF-8', \n   callback: function() {// 回调方法\n   } \n});\n```\n\n### 2.2 jQuery.i18n.prop(key)\n\n该方法以 map 的方式使用资源文件中的值，其中 key 指的是资源文件中的 key。当 key 指定的值含有占位符时，可以使用 jQuery.i18n.prop(key,var1,var2 … ) 的形式，其中 var1,var2 …对各占位符依次进行替换。例如资源文件中有“msg_hello= 您好 {0}，今天是 {1}。”的键值对，则我们可以采用“jQuery.i18n.prop( ‘ msg_hello ’ , ’小明’ , ’星期一’ );”的形式使用 msg_hello。\n\n### 2.3 jQuery.i18n.browserLang() \n\n用于获取浏览浏览器的语言信息，这里不再单独介绍。\n\n## 3. 示例\n\n### 3.1 建立资源文件\n\n如下图所示：\n![工程结构][1]\n\n在 i18n 目录下创建 strings_en.properties 和，stirngs_zh.properties 两个资源文件，其中 strings_en.properties 对应英文翻译，如清单 2 所示；string_zh.properties 对应中文翻译，如清单 3 所示。\n\n清单 2. stirngs_en.properties\n\n```properties\nloginTitle              = Login NM3000\nusername                = username\nusernameEnter           = please enter username\npassword                = password\npasswordEnter           = please enter password\nautoLogin               = AutoLogin\nlogin                   = Login\ncopyright               = Topvision All Rights Reserved\n```\n\n清单3. strings_zh.properties\n\n```properties\nloginTitle             = 登录NM3000\nusername                = 用户名\npassword                = 密码\nautoLogin               = 自动登录\nlogin                   = 登录\n```\n\n### 3.2 引用插件\n和其他 jQuery 插件一样，jQuery.i18n.properties插件依赖jQuery，因此我们首先需要引用 jQuery。jQuery.i18n.properties 对 jQuery 的版本没有明确要求。我们使用清单 4 所示的方式在 index.html 中引用 jQuery 和 jQuery.i18n.properties 插件。\n \n 清单 4. 引用 jQuery.i18n.properties\n```javascript\n<script type=\"text/javascript\" src=\"../../lib/jquery/jquery.min.js\"></script>\n<script type=\"text/javascript\" src=\"../../lib/jquery/jquery.i18n.properties-min-1.0.9.js\"></script>\n```\n\n### 3.3 使用\n\n```javascript\n$(function() {\n    lang = (jQuery.i18n.browserLang().substring(0, 2)); //默认从浏览器语言读取\n    jQuery.i18n.properties({\n        name: 'strings',\n        path: '../../i18n/', //资源文件路径\n        mode: 'map', //用Map的方式使用资源文件中的值\n        language: 'en',\n        callback: function() { //加载成功后设置显示内容\n            $('#title').html($.i18n.prop('loginTitle'));\n            ...\n        }\n    });\n})\n```\n\n## 4. 注意事项\n\n### 4.1 资源文件命名\n\n var lang = jQuery.i18n.browserLang() 获取的语言是zh-CN、en-US格式，\n jQuery.i18n.properties 默认的资源文件命名方式为“zh_CN”、“en_US”的形式\n \n 设置插件语言的时候一定要和资源文件的语言代码一致，否则无法解析。\n \n## 5. 总结\n\n本文对 jQuery 国际化插件 jQuery.i18n.properties 进行了介绍，并用实际例子介绍了如何使用 jQuery.i18n.properties 插件实现 Web 前端的国际化。总结起来，jQuery.i18n.properties 具有轻量级（压缩后仅 4kb）、简单易用等特点，但是作为一个普及度不高的轻量级插件，不一定适用于大型的或对效率要求极高的场景。\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/web/jqueryi18n%E7%A4%BA%E4%BE%8B%E5%B7%A5%E7%A8%8B%E7%9B%AE%E5%BD%95.png","slug":"使用jquery-i18n完成前端国际化","published":1,"updated":"2018-02-27T07:38:38.103Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspga0022n8vfxtrntdmp","content":"<p>本文对 jQuery 国际化插件 jQuery.i18n.properties 进行了介绍，并用实际例子介绍了如何使用 jQuery.i18n.properties 插件实现 Web 前端的国际化。总结起来，jQuery.i18n.properties 具有轻量级（压缩后仅 4kb）、简单易用等特点，但是作为一个普及度不高的轻量级插件，不一定适用于大型的或对效率要求极高的场景。<br><a id=\"more\"></a></p>\n<h2 id=\"1-简介\"><a href=\"#1-简介\" class=\"headerlink\" title=\"1. 简介\"></a>1. 简介</h2><p>jQuery.i18n.properties 是一款轻量级的 jQuery 国际化插件。与 Java 里的资源文件类似，jQuery.i18n.properties 采用 .properties 文件对 JavaScript 进行国际化。jQuery.i18n.properties 插件根据用户指定的（或浏览器提供的 ）语言和国家编码（符合 ISO-639 和 ISO-3166 标准）来解析对应的以“.properties”为后缀的资源文件。</p>\n<p>利用资源文件实现国际化是一种比较流行的方式，例如 Android 应用就可以采用以语言和国家编码命名的资源文件来实现国际化。jQuery.i18n.properties 插件中的资源文件以“.properties”为后缀，包含了区域相关的键值对。我们知道，Java 程序也可以使用以 .properties 为后缀的资源文件来实现国际化，因此，当我们要在 Java 程序和前端 JavaScript 程序中共享资源文件时，这种方式就显得特别有用。jQuery.i18n.properties 插件首先加载默认的资源文件（例如：strings.properties），然后加载针对特定语言环境的资源文件（例如：strings_zh.properties），这就保证了在未提供某种语言的翻译时，默认值始终有效。开发人员可以以 JavaScript 变量（或函数）或 Map 的方式使用资源文件中的 key。</p>\n<p>总的来说，jQuery.i18n.properties 有一下一些特点：</p>\n<ol>\n<li><p>使用 Java 标准的 .properties 文件作为资源文件，资源文件命名有以下三种格式：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">basename_properties </div><div class=\"line\">basename_language.properties </div><div class=\"line\">basename_language_country.properties</div></pre></td></tr></table></figure>\n</li>\n<li><p>使用 ISO-639 作为语言编码标准，ISO-3166 作为国家名称编码标准</p>\n</li>\n<li>按顺序加载默认资源文件和指定语言环境的资源文件，保证默认值始终可用</li>\n<li>未指定语言环境时使用浏览器提供的语言</li>\n<li>可以在资源字符串中使用占位符（例如：hello= 你好 {0}! 今天是 {1}。）</li>\n<li>资源文件中的 Key 支持命名空间（例如：com.company.msgs.hello = Hello!）</li>\n<li>支持跨行的值</li>\n<li>可以以 JavaScript 变量（或函数）或 Map 的方式使用资源文件中的 Key</li>\n</ol>\n<h2 id=\"2-API\"><a href=\"#2-API\" class=\"headerlink\" title=\"2. API\"></a>2. API</h2><p>jQuery.i18n.properties 的 API 非常简单，只有少数几个 API，即 jQuery.i18n.properties()、jQuery.i18n.prop()、jQuery.i18n.browserLang()。当然，和其他 jQuery 插件一样，我们也可以采用 $.i18n.properties()、$.i18n.prop() 和 $.i18n.browserLang() 的形式使用这用这些 API。</p>\n<h3 id=\"2-1-jQuery-i18n-properties-setting\"><a href=\"#2-1-jQuery-i18n-properties-setting\" class=\"headerlink\" title=\"2.1 jQuery.i18n.properties(setting)\"></a>2.1 jQuery.i18n.properties(setting)</h3><p>该方法加载资源文件，其中 settings 是配置加载选项的一系列键值对，各配置项的具体描述如表 1 所示。</p>\n<p><strong>表 1. settings</strong><br>选项| 描述 | 类型 | 可选<br>——-|———-<br>name | 资源文件的名称，例如 strings 或 [strings1,strings2]，前者代表一个资源文件，后者代表资源文件数组。| String或String[] | 否<br>path | 资源文件所在目录的路径 | String | 是<br>mode | 加载模式：“vars”表示以JavaScript变量或函数的形式使用资源文件中的Key，“map”表示以 Map 的方式使用资源文件中的Key，“both”表示可以同时使用两种方式。如果资源文件中的 Key 包含 JavaScript 的关键字，则只能采用“map”。默认值是“vars”。 | String | 是<br>language | ISO-639 指定的语言编码（如：“en”表示英文、“zh”表示中文），或同时使用ISO-639 指定的语言编码和ISO-3166指定的国家编码（如：“en_US”，“zh_CN”等）。如果不指定，则采用浏览器报告的语言编码。 | String | 是<br>cache | 指定浏览器是否对资源文件进行缓存，默认为 false。 | boolean | 是<br>encoding | 加载资源文件时使用的编码。默认为 UTF-8。 | String | 是<br>callback |     代码执行完成时运行的回调函数 | function | 是</p>\n<p>jQuery.i18n.properties() 的使用方法如清单 1 所示。</p>\n<p>清单 1. jQuery.i18n.properties() 用法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">jQuery.i18n.properties(&#123; </div><div class=\"line\">   <span class=\"attr\">name</span>:<span class=\"string\">'strings'</span>,<span class=\"comment\">// 资源文件名称</span></div><div class=\"line\">   path:<span class=\"string\">'bundle/'</span>,<span class=\"comment\">// 资源文件所在目录路径</span></div><div class=\"line\">   mode:<span class=\"string\">'both'</span>,<span class=\"comment\">// 模式：变量或 Map </span></div><div class=\"line\">   language:<span class=\"string\">'pt_PT'</span>,<span class=\"comment\">// 对应的语言</span></div><div class=\"line\">   cache:<span class=\"literal\">false</span>, </div><div class=\"line\">   <span class=\"attr\">encoding</span>: <span class=\"string\">'UTF-8'</span>, </div><div class=\"line\">   <span class=\"attr\">callback</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;<span class=\"comment\">// 回调方法</span></div><div class=\"line\">   &#125; </div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<h3 id=\"2-2-jQuery-i18n-prop-key\"><a href=\"#2-2-jQuery-i18n-prop-key\" class=\"headerlink\" title=\"2.2 jQuery.i18n.prop(key)\"></a>2.2 jQuery.i18n.prop(key)</h3><p>该方法以 map 的方式使用资源文件中的值，其中 key 指的是资源文件中的 key。当 key 指定的值含有占位符时，可以使用 jQuery.i18n.prop(key,var1,var2 … ) 的形式，其中 var1,var2 …对各占位符依次进行替换。例如资源文件中有“msg_hello= 您好 {0}，今天是 {1}。”的键值对，则我们可以采用“jQuery.i18n.prop( ‘ msg_hello ’ , ’小明’ , ’星期一’ );”的形式使用 msg_hello。</p>\n<h3 id=\"2-3-jQuery-i18n-browserLang\"><a href=\"#2-3-jQuery-i18n-browserLang\" class=\"headerlink\" title=\"2.3 jQuery.i18n.browserLang()\"></a>2.3 jQuery.i18n.browserLang()</h3><p>用于获取浏览浏览器的语言信息，这里不再单独介绍。</p>\n<h2 id=\"3-示例\"><a href=\"#3-示例\" class=\"headerlink\" title=\"3. 示例\"></a>3. 示例</h2><h3 id=\"3-1-建立资源文件\"><a href=\"#3-1-建立资源文件\" class=\"headerlink\" title=\"3.1 建立资源文件\"></a>3.1 建立资源文件</h3><p>如下图所示：<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/web/jqueryi18n%E7%A4%BA%E4%BE%8B%E5%B7%A5%E7%A8%8B%E7%9B%AE%E5%BD%95.png\" alt=\"工程结构\"></p>\n<p>在 i18n 目录下创建 strings_en.properties 和，stirngs_zh.properties 两个资源文件，其中 strings_en.properties 对应英文翻译，如清单 2 所示；string_zh.properties 对应中文翻译，如清单 3 所示。</p>\n<p>清单 2. stirngs_en.properties</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">loginTitle              = Login NM3000</div><div class=\"line\">username                = username</div><div class=\"line\">usernameEnter           = please enter username</div><div class=\"line\">password                = password</div><div class=\"line\">passwordEnter           = please enter password</div><div class=\"line\">autoLogin               = AutoLogin</div><div class=\"line\">login                   = Login</div><div class=\"line\">copyright               = Topvision All Rights Reserved</div></pre></td></tr></table></figure>\n<p>清单3. strings_zh.properties</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">loginTitle             = 登录NM3000</div><div class=\"line\">username                = 用户名</div><div class=\"line\">password                = 密码</div><div class=\"line\">autoLogin               = 自动登录</div><div class=\"line\">login                   = 登录</div></pre></td></tr></table></figure>\n<h3 id=\"3-2-引用插件\"><a href=\"#3-2-引用插件\" class=\"headerlink\" title=\"3.2 引用插件\"></a>3.2 引用插件</h3><p>和其他 jQuery 插件一样，jQuery.i18n.properties插件依赖jQuery，因此我们首先需要引用 jQuery。jQuery.i18n.properties 对 jQuery 的版本没有明确要求。我们使用清单 4 所示的方式在 index.html 中引用 jQuery 和 jQuery.i18n.properties 插件。</p>\n<p> 清单 4. 引用 jQuery.i18n.properties<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;script type=<span class=\"string\">\"text/javascript\"</span> src=<span class=\"string\">\"../../lib/jquery/jquery.min.js\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div><div class=\"line\">&lt;script type=<span class=\"string\">\"text/javascript\"</span> src=<span class=\"string\">\"../../lib/jquery/jquery.i18n.properties-min-1.0.9.js\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div></pre></td></tr></table></figure></p>\n<h3 id=\"3-3-使用\"><a href=\"#3-3-使用\" class=\"headerlink\" title=\"3.3 使用\"></a>3.3 使用</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">$(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    lang = (jQuery.i18n.browserLang().substring(<span class=\"number\">0</span>, <span class=\"number\">2</span>)); <span class=\"comment\">//默认从浏览器语言读取</span></div><div class=\"line\">    jQuery.i18n.properties(&#123;</div><div class=\"line\">        <span class=\"attr\">name</span>: <span class=\"string\">'strings'</span>,</div><div class=\"line\">        <span class=\"attr\">path</span>: <span class=\"string\">'../../i18n/'</span>, <span class=\"comment\">//资源文件路径</span></div><div class=\"line\">        mode: <span class=\"string\">'map'</span>, <span class=\"comment\">//用Map的方式使用资源文件中的值</span></div><div class=\"line\">        language: <span class=\"string\">'en'</span>,</div><div class=\"line\">        <span class=\"attr\">callback</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; <span class=\"comment\">//加载成功后设置显示内容</span></div><div class=\"line\">            $(<span class=\"string\">'#title'</span>).html($.i18n.prop(<span class=\"string\">'loginTitle'</span>));</div><div class=\"line\">            ...</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;);</div><div class=\"line\">&#125;)</div></pre></td></tr></table></figure>\n<h2 id=\"4-注意事项\"><a href=\"#4-注意事项\" class=\"headerlink\" title=\"4. 注意事项\"></a>4. 注意事项</h2><h3 id=\"4-1-资源文件命名\"><a href=\"#4-1-资源文件命名\" class=\"headerlink\" title=\"4.1 资源文件命名\"></a>4.1 资源文件命名</h3><p> var lang = jQuery.i18n.browserLang() 获取的语言是zh-CN、en-US格式，<br> jQuery.i18n.properties 默认的资源文件命名方式为“zh_CN”、“en_US”的形式</p>\n<p> 设置插件语言的时候一定要和资源文件的语言代码一致，否则无法解析。</p>\n<h2 id=\"5-总结\"><a href=\"#5-总结\" class=\"headerlink\" title=\"5. 总结\"></a>5. 总结</h2><p>本文对 jQuery 国际化插件 jQuery.i18n.properties 进行了介绍，并用实际例子介绍了如何使用 jQuery.i18n.properties 插件实现 Web 前端的国际化。总结起来，jQuery.i18n.properties 具有轻量级（压缩后仅 4kb）、简单易用等特点，但是作为一个普及度不高的轻量级插件，不一定适用于大型的或对效率要求极高的场景。</p>\n","site":{"data":{}},"excerpt":"<p>本文对 jQuery 国际化插件 jQuery.i18n.properties 进行了介绍，并用实际例子介绍了如何使用 jQuery.i18n.properties 插件实现 Web 前端的国际化。总结起来，jQuery.i18n.properties 具有轻量级（压缩后仅 4kb）、简单易用等特点，但是作为一个普及度不高的轻量级插件，不一定适用于大型的或对效率要求极高的场景。<br>","more":"</p>\n<h2 id=\"1-简介\"><a href=\"#1-简介\" class=\"headerlink\" title=\"1. 简介\"></a>1. 简介</h2><p>jQuery.i18n.properties 是一款轻量级的 jQuery 国际化插件。与 Java 里的资源文件类似，jQuery.i18n.properties 采用 .properties 文件对 JavaScript 进行国际化。jQuery.i18n.properties 插件根据用户指定的（或浏览器提供的 ）语言和国家编码（符合 ISO-639 和 ISO-3166 标准）来解析对应的以“.properties”为后缀的资源文件。</p>\n<p>利用资源文件实现国际化是一种比较流行的方式，例如 Android 应用就可以采用以语言和国家编码命名的资源文件来实现国际化。jQuery.i18n.properties 插件中的资源文件以“.properties”为后缀，包含了区域相关的键值对。我们知道，Java 程序也可以使用以 .properties 为后缀的资源文件来实现国际化，因此，当我们要在 Java 程序和前端 JavaScript 程序中共享资源文件时，这种方式就显得特别有用。jQuery.i18n.properties 插件首先加载默认的资源文件（例如：strings.properties），然后加载针对特定语言环境的资源文件（例如：strings_zh.properties），这就保证了在未提供某种语言的翻译时，默认值始终有效。开发人员可以以 JavaScript 变量（或函数）或 Map 的方式使用资源文件中的 key。</p>\n<p>总的来说，jQuery.i18n.properties 有一下一些特点：</p>\n<ol>\n<li><p>使用 Java 标准的 .properties 文件作为资源文件，资源文件命名有以下三种格式：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">basename_properties </div><div class=\"line\">basename_language.properties </div><div class=\"line\">basename_language_country.properties</div></pre></td></tr></table></figure>\n</li>\n<li><p>使用 ISO-639 作为语言编码标准，ISO-3166 作为国家名称编码标准</p>\n</li>\n<li>按顺序加载默认资源文件和指定语言环境的资源文件，保证默认值始终可用</li>\n<li>未指定语言环境时使用浏览器提供的语言</li>\n<li>可以在资源字符串中使用占位符（例如：hello= 你好 {0}! 今天是 {1}。）</li>\n<li>资源文件中的 Key 支持命名空间（例如：com.company.msgs.hello = Hello!）</li>\n<li>支持跨行的值</li>\n<li>可以以 JavaScript 变量（或函数）或 Map 的方式使用资源文件中的 Key</li>\n</ol>\n<h2 id=\"2-API\"><a href=\"#2-API\" class=\"headerlink\" title=\"2. API\"></a>2. API</h2><p>jQuery.i18n.properties 的 API 非常简单，只有少数几个 API，即 jQuery.i18n.properties()、jQuery.i18n.prop()、jQuery.i18n.browserLang()。当然，和其他 jQuery 插件一样，我们也可以采用 $.i18n.properties()、$.i18n.prop() 和 $.i18n.browserLang() 的形式使用这用这些 API。</p>\n<h3 id=\"2-1-jQuery-i18n-properties-setting\"><a href=\"#2-1-jQuery-i18n-properties-setting\" class=\"headerlink\" title=\"2.1 jQuery.i18n.properties(setting)\"></a>2.1 jQuery.i18n.properties(setting)</h3><p>该方法加载资源文件，其中 settings 是配置加载选项的一系列键值对，各配置项的具体描述如表 1 所示。</p>\n<p><strong>表 1. settings</strong><br>选项| 描述 | 类型 | 可选<br>——-|———-<br>name | 资源文件的名称，例如 strings 或 [strings1,strings2]，前者代表一个资源文件，后者代表资源文件数组。| String或String[] | 否<br>path | 资源文件所在目录的路径 | String | 是<br>mode | 加载模式：“vars”表示以JavaScript变量或函数的形式使用资源文件中的Key，“map”表示以 Map 的方式使用资源文件中的Key，“both”表示可以同时使用两种方式。如果资源文件中的 Key 包含 JavaScript 的关键字，则只能采用“map”。默认值是“vars”。 | String | 是<br>language | ISO-639 指定的语言编码（如：“en”表示英文、“zh”表示中文），或同时使用ISO-639 指定的语言编码和ISO-3166指定的国家编码（如：“en_US”，“zh_CN”等）。如果不指定，则采用浏览器报告的语言编码。 | String | 是<br>cache | 指定浏览器是否对资源文件进行缓存，默认为 false。 | boolean | 是<br>encoding | 加载资源文件时使用的编码。默认为 UTF-8。 | String | 是<br>callback |     代码执行完成时运行的回调函数 | function | 是</p>\n<p>jQuery.i18n.properties() 的使用方法如清单 1 所示。</p>\n<p>清单 1. jQuery.i18n.properties() 用法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">jQuery.i18n.properties(&#123; </div><div class=\"line\">   <span class=\"attr\">name</span>:<span class=\"string\">'strings'</span>,<span class=\"comment\">// 资源文件名称</span></div><div class=\"line\">   path:<span class=\"string\">'bundle/'</span>,<span class=\"comment\">// 资源文件所在目录路径</span></div><div class=\"line\">   mode:<span class=\"string\">'both'</span>,<span class=\"comment\">// 模式：变量或 Map </span></div><div class=\"line\">   language:<span class=\"string\">'pt_PT'</span>,<span class=\"comment\">// 对应的语言</span></div><div class=\"line\">   cache:<span class=\"literal\">false</span>, </div><div class=\"line\">   <span class=\"attr\">encoding</span>: <span class=\"string\">'UTF-8'</span>, </div><div class=\"line\">   <span class=\"attr\">callback</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;<span class=\"comment\">// 回调方法</span></div><div class=\"line\">   &#125; </div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<h3 id=\"2-2-jQuery-i18n-prop-key\"><a href=\"#2-2-jQuery-i18n-prop-key\" class=\"headerlink\" title=\"2.2 jQuery.i18n.prop(key)\"></a>2.2 jQuery.i18n.prop(key)</h3><p>该方法以 map 的方式使用资源文件中的值，其中 key 指的是资源文件中的 key。当 key 指定的值含有占位符时，可以使用 jQuery.i18n.prop(key,var1,var2 … ) 的形式，其中 var1,var2 …对各占位符依次进行替换。例如资源文件中有“msg_hello= 您好 {0}，今天是 {1}。”的键值对，则我们可以采用“jQuery.i18n.prop( ‘ msg_hello ’ , ’小明’ , ’星期一’ );”的形式使用 msg_hello。</p>\n<h3 id=\"2-3-jQuery-i18n-browserLang\"><a href=\"#2-3-jQuery-i18n-browserLang\" class=\"headerlink\" title=\"2.3 jQuery.i18n.browserLang()\"></a>2.3 jQuery.i18n.browserLang()</h3><p>用于获取浏览浏览器的语言信息，这里不再单独介绍。</p>\n<h2 id=\"3-示例\"><a href=\"#3-示例\" class=\"headerlink\" title=\"3. 示例\"></a>3. 示例</h2><h3 id=\"3-1-建立资源文件\"><a href=\"#3-1-建立资源文件\" class=\"headerlink\" title=\"3.1 建立资源文件\"></a>3.1 建立资源文件</h3><p>如下图所示：<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/web/jqueryi18n%E7%A4%BA%E4%BE%8B%E5%B7%A5%E7%A8%8B%E7%9B%AE%E5%BD%95.png\" alt=\"工程结构\"></p>\n<p>在 i18n 目录下创建 strings_en.properties 和，stirngs_zh.properties 两个资源文件，其中 strings_en.properties 对应英文翻译，如清单 2 所示；string_zh.properties 对应中文翻译，如清单 3 所示。</p>\n<p>清单 2. stirngs_en.properties</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">loginTitle              = Login NM3000</div><div class=\"line\">username                = username</div><div class=\"line\">usernameEnter           = please enter username</div><div class=\"line\">password                = password</div><div class=\"line\">passwordEnter           = please enter password</div><div class=\"line\">autoLogin               = AutoLogin</div><div class=\"line\">login                   = Login</div><div class=\"line\">copyright               = Topvision All Rights Reserved</div></pre></td></tr></table></figure>\n<p>清单3. strings_zh.properties</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">loginTitle             = 登录NM3000</div><div class=\"line\">username                = 用户名</div><div class=\"line\">password                = 密码</div><div class=\"line\">autoLogin               = 自动登录</div><div class=\"line\">login                   = 登录</div></pre></td></tr></table></figure>\n<h3 id=\"3-2-引用插件\"><a href=\"#3-2-引用插件\" class=\"headerlink\" title=\"3.2 引用插件\"></a>3.2 引用插件</h3><p>和其他 jQuery 插件一样，jQuery.i18n.properties插件依赖jQuery，因此我们首先需要引用 jQuery。jQuery.i18n.properties 对 jQuery 的版本没有明确要求。我们使用清单 4 所示的方式在 index.html 中引用 jQuery 和 jQuery.i18n.properties 插件。</p>\n<p> 清单 4. 引用 jQuery.i18n.properties<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;script type=<span class=\"string\">\"text/javascript\"</span> src=<span class=\"string\">\"../../lib/jquery/jquery.min.js\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div><div class=\"line\">&lt;script type=<span class=\"string\">\"text/javascript\"</span> src=<span class=\"string\">\"../../lib/jquery/jquery.i18n.properties-min-1.0.9.js\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div></pre></td></tr></table></figure></p>\n<h3 id=\"3-3-使用\"><a href=\"#3-3-使用\" class=\"headerlink\" title=\"3.3 使用\"></a>3.3 使用</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">$(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    lang = (jQuery.i18n.browserLang().substring(<span class=\"number\">0</span>, <span class=\"number\">2</span>)); <span class=\"comment\">//默认从浏览器语言读取</span></div><div class=\"line\">    jQuery.i18n.properties(&#123;</div><div class=\"line\">        <span class=\"attr\">name</span>: <span class=\"string\">'strings'</span>,</div><div class=\"line\">        <span class=\"attr\">path</span>: <span class=\"string\">'../../i18n/'</span>, <span class=\"comment\">//资源文件路径</span></div><div class=\"line\">        mode: <span class=\"string\">'map'</span>, <span class=\"comment\">//用Map的方式使用资源文件中的值</span></div><div class=\"line\">        language: <span class=\"string\">'en'</span>,</div><div class=\"line\">        <span class=\"attr\">callback</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; <span class=\"comment\">//加载成功后设置显示内容</span></div><div class=\"line\">            $(<span class=\"string\">'#title'</span>).html($.i18n.prop(<span class=\"string\">'loginTitle'</span>));</div><div class=\"line\">            ...</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;);</div><div class=\"line\">&#125;)</div></pre></td></tr></table></figure>\n<h2 id=\"4-注意事项\"><a href=\"#4-注意事项\" class=\"headerlink\" title=\"4. 注意事项\"></a>4. 注意事项</h2><h3 id=\"4-1-资源文件命名\"><a href=\"#4-1-资源文件命名\" class=\"headerlink\" title=\"4.1 资源文件命名\"></a>4.1 资源文件命名</h3><p> var lang = jQuery.i18n.browserLang() 获取的语言是zh-CN、en-US格式，<br> jQuery.i18n.properties 默认的资源文件命名方式为“zh_CN”、“en_US”的形式</p>\n<p> 设置插件语言的时候一定要和资源文件的语言代码一致，否则无法解析。</p>\n<h2 id=\"5-总结\"><a href=\"#5-总结\" class=\"headerlink\" title=\"5. 总结\"></a>5. 总结</h2><p>本文对 jQuery 国际化插件 jQuery.i18n.properties 进行了介绍，并用实际例子介绍了如何使用 jQuery.i18n.properties 插件实现 Web 前端的国际化。总结起来，jQuery.i18n.properties 具有轻量级（压缩后仅 4kb）、简单易用等特点，但是作为一个普及度不高的轻量级插件，不一定适用于大型的或对效率要求极高的场景。</p>"},{"title":"基于MUI及Html5+开发app","date":"2017-04-28T09:07:22.000Z","_content":"这边博客简要介绍了使用MUI和5+开发APP的流程\n<!-- more -->\n## MUI简介\n[MUI官网](http://dev.dcloud.net.cn/mui/)&nbsp&nbspMUI是最接近原生APP体验的高性能前端框架，不依赖任何第三方JS库，以iOS平台UI为基础，补充部分Android平台特有的UI控件。\n\n## 工具\n- [HBilder](http://www.dcloud.io/)\n- [5+ SDK](http://ask.dcloud.net.cn/article/103)\n- Android Studio + Android SDK\n\n## html5+简介\n[HTML5+规范](http://www.html5plus.org/doc/h5p.html)\n\n## 开发步骤\n\n    1.在Hbuilder中创建移动app项目\n    2.在manifest.json文件中按照提示配置app相关信息，包括权限选择，这个地方和下面将要提到的androidManifest.xml文件是相互独立的\n    3.新建View文件夹编写html，新建js、css文件夹放置对应文件\n    4.若使用5+相关的东西,如下操作： \n      - 在5+ SDK中，对应Feature-Android.xls文件，使用哪个模块，就在xls文件中找到对应模块\n      - 将文件中提到的相关文件从5+ SDK中的HBuilder-Integrate工程中找到，并移入android工程中\n    5.参照[5+ API](http://www.html5plus.org/doc/h5p.html),编写相关代码\n    \n## 调试\n调试可使用真机调试和模拟调试，建议真机调试，涉及到5+的代码只能在真机上运行。\n","source":"_posts/基于MUI及Html5-开发app.md","raw":"---\ntitle: 基于MUI及Html5+开发app\ndate: 2017-04-28 17:07:22\ncategories:\n    - DCloud\ntags:\n    - MUI\n    - html5+\n---\n这边博客简要介绍了使用MUI和5+开发APP的流程\n<!-- more -->\n## MUI简介\n[MUI官网](http://dev.dcloud.net.cn/mui/)&nbsp&nbspMUI是最接近原生APP体验的高性能前端框架，不依赖任何第三方JS库，以iOS平台UI为基础，补充部分Android平台特有的UI控件。\n\n## 工具\n- [HBilder](http://www.dcloud.io/)\n- [5+ SDK](http://ask.dcloud.net.cn/article/103)\n- Android Studio + Android SDK\n\n## html5+简介\n[HTML5+规范](http://www.html5plus.org/doc/h5p.html)\n\n## 开发步骤\n\n    1.在Hbuilder中创建移动app项目\n    2.在manifest.json文件中按照提示配置app相关信息，包括权限选择，这个地方和下面将要提到的androidManifest.xml文件是相互独立的\n    3.新建View文件夹编写html，新建js、css文件夹放置对应文件\n    4.若使用5+相关的东西,如下操作： \n      - 在5+ SDK中，对应Feature-Android.xls文件，使用哪个模块，就在xls文件中找到对应模块\n      - 将文件中提到的相关文件从5+ SDK中的HBuilder-Integrate工程中找到，并移入android工程中\n    5.参照[5+ API](http://www.html5plus.org/doc/h5p.html),编写相关代码\n    \n## 调试\n调试可使用真机调试和模拟调试，建议真机调试，涉及到5+的代码只能在真机上运行。\n","slug":"基于MUI及Html5-开发app","published":1,"updated":"2018-02-27T07:38:38.103Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspgd0025n8vfvzbtmpk5","content":"<p>这边博客简要介绍了使用MUI和5+开发APP的流程<br><a id=\"more\"></a></p>\n<h2 id=\"MUI简介\"><a href=\"#MUI简介\" class=\"headerlink\" title=\"MUI简介\"></a>MUI简介</h2><p><a href=\"http://dev.dcloud.net.cn/mui/\" target=\"_blank\" rel=\"noopener\">MUI官网</a>&amp;nbsp&amp;nbspMUI是最接近原生APP体验的高性能前端框架，不依赖任何第三方JS库，以iOS平台UI为基础，补充部分Android平台特有的UI控件。</p>\n<h2 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h2><ul>\n<li><a href=\"http://www.dcloud.io/\" target=\"_blank\" rel=\"noopener\">HBilder</a></li>\n<li><a href=\"http://ask.dcloud.net.cn/article/103\" target=\"_blank\" rel=\"noopener\">5+ SDK</a></li>\n<li>Android Studio + Android SDK</li>\n</ul>\n<h2 id=\"html5-简介\"><a href=\"#html5-简介\" class=\"headerlink\" title=\"html5+简介\"></a>html5+简介</h2><p><a href=\"http://www.html5plus.org/doc/h5p.html\" target=\"_blank\" rel=\"noopener\">HTML5+规范</a></p>\n<h2 id=\"开发步骤\"><a href=\"#开发步骤\" class=\"headerlink\" title=\"开发步骤\"></a>开发步骤</h2><pre><code>1.在Hbuilder中创建移动app项目\n2.在manifest.json文件中按照提示配置app相关信息，包括权限选择，这个地方和下面将要提到的androidManifest.xml文件是相互独立的\n3.新建View文件夹编写html，新建js、css文件夹放置对应文件\n4.若使用5+相关的东西,如下操作： \n  - 在5+ SDK中，对应Feature-Android.xls文件，使用哪个模块，就在xls文件中找到对应模块\n  - 将文件中提到的相关文件从5+ SDK中的HBuilder-Integrate工程中找到，并移入android工程中\n5.参照[5+ API](http://www.html5plus.org/doc/h5p.html),编写相关代码\n</code></pre><h2 id=\"调试\"><a href=\"#调试\" class=\"headerlink\" title=\"调试\"></a>调试</h2><p>调试可使用真机调试和模拟调试，建议真机调试，涉及到5+的代码只能在真机上运行。</p>\n","site":{"data":{}},"excerpt":"<p>这边博客简要介绍了使用MUI和5+开发APP的流程<br>","more":"</p>\n<h2 id=\"MUI简介\"><a href=\"#MUI简介\" class=\"headerlink\" title=\"MUI简介\"></a>MUI简介</h2><p><a href=\"http://dev.dcloud.net.cn/mui/\" target=\"_blank\" rel=\"noopener\">MUI官网</a>&amp;nbsp&amp;nbspMUI是最接近原生APP体验的高性能前端框架，不依赖任何第三方JS库，以iOS平台UI为基础，补充部分Android平台特有的UI控件。</p>\n<h2 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h2><ul>\n<li><a href=\"http://www.dcloud.io/\" target=\"_blank\" rel=\"noopener\">HBilder</a></li>\n<li><a href=\"http://ask.dcloud.net.cn/article/103\" target=\"_blank\" rel=\"noopener\">5+ SDK</a></li>\n<li>Android Studio + Android SDK</li>\n</ul>\n<h2 id=\"html5-简介\"><a href=\"#html5-简介\" class=\"headerlink\" title=\"html5+简介\"></a>html5+简介</h2><p><a href=\"http://www.html5plus.org/doc/h5p.html\" target=\"_blank\" rel=\"noopener\">HTML5+规范</a></p>\n<h2 id=\"开发步骤\"><a href=\"#开发步骤\" class=\"headerlink\" title=\"开发步骤\"></a>开发步骤</h2><pre><code>1.在Hbuilder中创建移动app项目\n2.在manifest.json文件中按照提示配置app相关信息，包括权限选择，这个地方和下面将要提到的androidManifest.xml文件是相互独立的\n3.新建View文件夹编写html，新建js、css文件夹放置对应文件\n4.若使用5+相关的东西,如下操作： \n  - 在5+ SDK中，对应Feature-Android.xls文件，使用哪个模块，就在xls文件中找到对应模块\n  - 将文件中提到的相关文件从5+ SDK中的HBuilder-Integrate工程中找到，并移入android工程中\n5.参照[5+ API](http://www.html5plus.org/doc/h5p.html),编写相关代码\n</code></pre><h2 id=\"调试\"><a href=\"#调试\" class=\"headerlink\" title=\"调试\"></a>调试</h2><p>调试可使用真机调试和模拟调试，建议真机调试，涉及到5+的代码只能在真机上运行。</p>"},{"title":"多线程","date":"2017-09-30T01:22:54.000Z","_content":"\n本文简单介绍了多线程的基本概念、基于Thread和Runnable实现多线程编程及简单的线程安全问题示例。\n<!--more-->\n\n# 1 概述\n\n## 1.1 进程与线程\n\n - 进程是正在执行的程序    JVM是一个进程.\n - 线程进程中用于控制程序执行的控制单元(执行路径)\n - 进程中至少有一个线程,对于JVM,启动时至少有两个线程:JVM的主线程和JVM的垃圾回收线程\n\n## 1.2 并行与并发\n\n - 并行就是两个任务同时运行，就是甲任务进行的同时，乙任务也在进行。(需要多核CPU)\n - 并发是指两个任务都请求运行，而处理器只能按受一个任务，就把这两个任务安排轮流进行，由于时间间隔较短，使人感觉两个任务都在运行。\n\n## 1.3 基本实现方式\n\n### 1.3.1 继承Thread类覆盖run方法\n\n```java\npackage com.topvision.thread;\n\npublic class ThreadDemo1 {\n\tpublic static void main(String[] args) {\n\t\tDemo1 d1 = new Demo1();\n\t\td1.start();\n\t\tfor (int i = 0; i < 60; i++) {\n\t\t\tSystem.out.println(Thread.currentThread().getName() + i);\n\t\t}\n\t}\n}\n\nclass Demo1 extends Thread {\n\t@Override\n\tpublic void run() {\n\t\tfor (int i = 0; i < 10; i++) {\n\t\t\tSystem.out.println(Thread.currentThread().getName() + i);\n\t\t}\n\t}\n}\n```\n\n### 1.3.2 实现Runnable接口实现run方法\n\n```java\npublic class ThreadDemo1 {\n\tpublic static void main(String[] args) {\n\t\tThread d2 = new Thread(new Demo2());\n\t\td2.start();\n\t\tfor (int i = 0; i < 60; i++) {\n\t\t\tSystem.out.println(Thread.currentThread().getName() + i);\n\t\t}\n\t}\n}\nclass Demo2 implements Runnable {\n\n\t@Override\n\tpublic void run() {\n\t\tfor (int i = 0; i < 10; i++) {\n\t\t\tSystem.out.println(Thread.currentThread().getName() + i);\n\t\t}\n\t}\n}\n```\n\n## 1.4 继承Thread与实现Runnable的区别\n\n - 查看源码的区别:\n\t* a.继承Thread : 由于子类重写了Thread类的run(), 当调用start()时, 直接找子类的run()方法\n\t* b.实现Runnable : 构造函数中传入了Runnable的引用, 成员变量记住了它, start()调用run()方法时内部判断成员变量Runnable的引用是否为空, 不为空编译时看的是Runnable的run(),运行时执行的是子类的run()方法\n - 继承Thread\n\t* 好处是:可以直接使用Thread类中的方法,代码简单\n\t* 弊端是:如果已经有了父类,就不能用这种方法\n - 实现Runnable接口\n\t* 好处是:即使自己定义的线程类有了父类也没关系,因为有了父类也可以实现接口,而且接口是可以多实现的\n\t* 弊端是:不能直接使用Thread中的方法需要先获取到线程对象后,才能得到Thread的方法,代码复杂\n\n# 2 基本API\n\n与人有生老病死一样，线程也同样要经历开始（等待）、运行、挂起和停止四种不同的状态。这四种状态都可以通过Thread类中的方法进行控制。下面给出了Thread类中和这四种状态相关的方法。\n\n 1. 开始线程\n \n    publicvoid start( );\n    publicvoid run( );\n\n 2. 挂起和唤醒线程\n \n    publicvoid resume( );     // 不建议使用\n    publicvoid suspend( );    // 不建议使用\n    publicstaticvoid sleep(long millis);\n    publicstaticvoid sleep(long millis, int nanos);\n\n 3. 终止线程\n \n    publicvoid stop( );       // 不建议使用\n    publicvoid interrupt( );\n\n 4. 得到线程状态\n \n    publicboolean isAlive( );\n    publicboolean isInterrupted( );\n    publicstaticboolean interrupted( );\n\n 5. join方法\n \n    publicvoid join( ) throws InterruptedException;\n\n线程在建立后并不马上执行run方法中的代码，而是处于等待状态。线程处于等待状态时，可以通过Thread类的方法来设置线程不各种属性，如线程的优先级（setPriority）、线程名(setName)和线程的类型（setDaemon）等。\n\n当调用start方法后，线程开始执行run方法中的代码。线程进入运行状态。可以通过Thread类的isAlive方法来判断线程是否处于运行状态。当线程处于运行状态时，isAlive返回true，当isAlive返回false时，可能线程处于等待状态，也可能处于停止状态。\n\n一但线程开始执行run方法，就会一直到这个run方法执行完成这个线程才退出。但在线程执行的过程中，可以通过两个方法使线程暂时停止执行。这两个方法是suspend和sleep。在使用suspend挂起线程后，可以通过resume方法唤醒线程。而使用sleep使线程休眠后，只能在设定的时间后使线程处于就绪状态（在线程休眠结束后，线程不一定会马上执行，只是进入了就绪状态，等待着系统进行调度）。\n\n## 2.1 设置及获取线程名字\n\n 1. 构造方法中传入名字 new Thread(\"张三\"){}\n 2. 线程对象设置名字  thread.setName()\n 3. 线程对象获取名字  thread.getName()  Thread.currentThread().hetName()\n\n## 2.2 休眠线程Sleep\n\n1. sleep方法有两个重载形式，其中一个重载形式不仅可以设毫秒，而且还可以设纳秒(1,000,000纳秒等于1毫秒)。但大多数操作系统平台上的Java虚拟机都无法精确到纳秒，因此，如果对sleep设置了纳秒，Java虚拟机将取最接近这个值的毫秒。\n\n2. 在使用sleep方法时必须使用throws或try{…}catch{…}。因为run方法无法使用throws，所以只能使用try{…}catch{…}。当在线程休眠的过程中，使用interrupt方法中断线程时sleep会抛出一个InterruptedException异常。sleep方法的定义如下：\n\n        publicstaticvoid sleep(long millis) throws InterruptedException\n        publicstaticvoid sleep(long millis, int nanos) throws InterruptedException\n        \n## 2.3 守护线程Daemon\n\n**setDaemon(), 设置一个线程为守护线程, 该线程不会单独执行, 当其他非守护线程都执行结束后, 自动退出\t**\n\n```java\npublic class ThreadDemo4 {\n\t/**\n\t * @param args\n\t * 守护线程\n\t */\n\tpublic static void main(String[] args) {\n\t\tThread t1 = new Thread() {\n\t\t\tpublic void run() {\n\t\t\t\tfor (int i = 0; i < 10; i++) {\n\t\t\t\t\tSystem.out.println(getName() + \"...aaaaaaaaaaaaaaaaaaaa\");\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tThread t2 = new Thread() {\n\t\t\tpublic void run() {\n\t\t\t\tfor (int i = 0; i < 5000; i++) {\n\t\t\t\t\tSystem.out.println(getName() + \"...bb\" + i);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tt2.setDaemon(true); // 设置为守护线程\n\n\t\tt1.start();\n\t\tt2.start();\n\t}\n}\n```\n\n## 2.4 加入线程Join\n\njoin方法的功能就是使异步执行的线程变成同步执行。也就是说，当调用线程实例的start方法后，这个方法会立即返回，如果在调用start方法后后需要使用一个由这个线程计算得到的值，就必须使用join方法。如果不使用join方法，就不能保证当执行到start方法后面的某条语句时，这个线程一定会执行完。而使用join方法后，直到这个线程退出，程序才会往下执行。下面的代码演示了join的用法。\n\n## 2.5 礼让线程Yield\n\nThread.yield()方法作用是：暂停当前正在执行的线程对象，并执行其他线程。\nyield()应该做的是让当前运行线程回到可运行状态，以允许具有相同优先级的其他线程获得运行机会。因此，使用yield()的目的是让相同优先级的线程之间能适当的轮转执行。但是，实际中无法保证yield()达到让步目的，因为让步的线程还有可能被线程调度程序再次选中。\n \n结论：yield()从未导致线程转到等待/睡眠/阻塞状态。在大多数情况下，yield()将导致线程从运行状态转到可运行状态，但有可能没有效果。\n\n## 2.6 设置线程优先级Priority\n\nsetPriority不一定起作用的，在不同的操作系统不同的jvm上，效果也可能不同。现在很多jvm的线程的实现都使用的操作系统线程，设置优先级也是使用的操作系统优先级，java层面有10个优先级别，假设操作系统只有3个优先级别，那么jvm可能将1-4级映射到操作系统的1级，5-7级映射到操作系统的2级，剩下的映射到3级，这样的话，在java层面，将优先级设置为5,6,7，其实本质就是一样的了。\n\n另外，操作系统也不能保证设置了优先级的线程就一定会先运行或得到更多的CPU时间。\n在实际使用中，不建议使用该方法\n\n# 3 同步\n\n* 当多线程并发, 有多段代码同时执行时, 我们希望某一段代码执行的过程中CPU不要切换到其他线程工作. 这时就需要同步.\n* 如果两段代码是同步的, 那么同一时间只能执行一段, 在一段代码没执行结束之前, 不会执行另外一段代码.\n\n## 3.1 同步代码块\n\n* 使用synchronized关键字加上一个锁对象来定义一段代码, 这就叫同步代码块\n* 多个同步代码块如果使用相同的锁对象, 那么他们就是同步的\n\n```java\npublic class ThreadDemo6 {\n\tpublic static void main(String[] args) {\n\t\tPrint p = new Print();\n\t\tnew Thread(){\n\t\t\tpublic void run() {\n\t\t\t\twhile (true) {\n\t\t\t\t\tp.print1();\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\t\t\n\t\tnew Thread(){\n\t\t\tpublic void run() {\n\t\t\t\twhile (true) {\n\t\t\t\t\tp.print2();\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\t}\n}\n\nclass Print {\n\n\tpublic void print1() {\n\t\tsynchronized (ThreadDemo6.class) {\n\t\t\ttry {\n\t\t\t\tThread.sleep(1000);\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t\tSystem.out.println(\"鼎\");\n\t\t\tSystem.out.println(\"点\");\n\t\t\tSystem.out.println(\"视\");\n\t\t\tSystem.out.println(\"讯\");\n\t\t}\n\t}\n\n\tpublic void print2() {\n\t\tsynchronized (ThreadDemo6.class) {\n\t\t\ttry {\n\t\t\t\tThread.sleep(1000);\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t\tSystem.out.println(\"T\");\n\t\t\tSystem.out.println(\"O\");\n\t\t\tSystem.out.println(\"P\");\n\t\t\tSystem.out.println(\"V\");\n\t\t\tSystem.out.println(\"I\");\n\t\t\tSystem.out.println(\"S\");\n\t\t\tSystem.out.println(\"I\");\n\t\t\tSystem.out.println(\"O\");\n\t\t\tSystem.out.println(\"N\");\n\t\t}\n\t}\n}\n```\n\n## 3.2 同步方法\n\n* 使用synchronized关键字修饰一个方法, 该方法中所有的代码都是同步的\n* 注意锁对象\n\n```java\n//同步方法，锁对象是this\npublic synchronized void print1() {\n\tSystem.out.println(\"鼎\");\n\tSystem.out.println(\"点\");\n\tSystem.out.println(\"视\");\n\tSystem.out.println(\"讯\");\n}\n```\n\n```java\n//静态同步方法，锁对象是字节码文件\npublic static synchronized void print1() {\n\tSystem.out.println(\"鼎\");\n\tSystem.out.println(\"点\");\n\tSystem.out.println(\"视\");\n\tSystem.out.println(\"讯\");\n}\n```\n\n## 3.3 线程安全\n\n* 多线程并发操作同一数据时, 就有可能出现线程安全问题\n* 使用同步技术可以解决这种问题, 把操作数据的代码进行同步, 不要多个线程一起操作。\n\n```java\npackage com.topvision.thread;\n\npublic class ThreadTicket1 {\n\tpublic static void main(String[] args) {\n\t\t/*new Ticket1().start();\n\t\tnew Ticket1().start();\n\t\tnew Ticket1().start();\n\t\tnew Ticket1().start();*/\n\t\tTicket2 t2 = new Ticket2();\n\t\tnew Thread(t2).start();\n\t\tnew Thread(t2).start();\n\t\tnew Thread(t2).start();\n\t\tnew Thread(t2).start();\n\t}\n}\n\nclass Ticket1 extends Thread {\n\tprivate static int ticktets = 100;\n\n\tpublic void run() {\n\t\twhile (true) {\n\t\t\tsynchronized (Ticket1.class) {\n\t\t\t\tif (ticktets <= 0) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tSystem.out.println(\"这是第\" + ticktets-- + \"张票\");\n\t\t\t}\n\t\t}\n\n\t}\n}\n\nclass Ticket2 implements Runnable {\n\tprivate int ticktets = 100;\n\n\t@Override\n\tpublic void run() {\n\t\t// TODO Auto-generated method stub\n\t\twhile (true) {\n\t\t\tsynchronized (this) {\n\t\t\t\tif (ticktets <= 0) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tSystem.out.println(\"这是第\" + ticktets-- + \"张票\");\n\t\t\t}\n\t\t}\n\t}\n\n}\n```\n\n## 3.4 死锁\n\n两个线程各自拥有对方需要的锁对象，等待对方释放，因此互相等待，程序卡死。\n* 多线程同步的时候, 如果同步代码嵌套, 使用相同锁, 就有可能出现死锁\n* 尽量不要嵌套使用\n\n```java\npackage com.topvision.thread;\n\n\npublic class ThreadDemo8 {\n\t/**\n\t * @param args\n\t */\n\tprivate static String s1 = \"筷子左\";\n\tprivate static String s2 = \"筷子右\";\n\n\tpublic static void main(String[] args) {\n\t\tnew Thread() {\n\t\t\tpublic void run() {\n\t\t\t\twhile (true) {\n\t\t\t\t\tsynchronized (s1) {\n\t\t\t\t\t\tSystem.out.println(getName() + \"...获取\" + s1 + \"等待\" + s2);\n\t\t\t\t\t\tsynchronized (s2) {\n\t\t\t\t\t\t\tSystem.out.println(getName() + \"...拿到\" + s2 + \"开吃\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\n\t\tnew Thread() {\n\t\t\tpublic void run() {\n\t\t\t\twhile (true) {\n\t\t\t\t\tsynchronized (s2) {\n\t\t\t\t\t\tSystem.out.println(getName() + \"...获取\" + s2 + \"等待\" + s1);\n\t\t\t\t\t\tsynchronized (s1) {\n\t\t\t\t\t\t\tSystem.out.println(getName() + \"...拿到\" + s1 + \"开吃\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\t}\n}\n```\n\n\n\n\n\n\n\n\n \n\t\n \n \n","source":"_posts/多线程.md","raw":"---\ntitle: 多线程\ncategories:\n  - JavaSE\ntags:\n  - 多线程 \n  - Java\ndate: 2017-09-30 09:22:54\n---\n\n本文简单介绍了多线程的基本概念、基于Thread和Runnable实现多线程编程及简单的线程安全问题示例。\n<!--more-->\n\n# 1 概述\n\n## 1.1 进程与线程\n\n - 进程是正在执行的程序    JVM是一个进程.\n - 线程进程中用于控制程序执行的控制单元(执行路径)\n - 进程中至少有一个线程,对于JVM,启动时至少有两个线程:JVM的主线程和JVM的垃圾回收线程\n\n## 1.2 并行与并发\n\n - 并行就是两个任务同时运行，就是甲任务进行的同时，乙任务也在进行。(需要多核CPU)\n - 并发是指两个任务都请求运行，而处理器只能按受一个任务，就把这两个任务安排轮流进行，由于时间间隔较短，使人感觉两个任务都在运行。\n\n## 1.3 基本实现方式\n\n### 1.3.1 继承Thread类覆盖run方法\n\n```java\npackage com.topvision.thread;\n\npublic class ThreadDemo1 {\n\tpublic static void main(String[] args) {\n\t\tDemo1 d1 = new Demo1();\n\t\td1.start();\n\t\tfor (int i = 0; i < 60; i++) {\n\t\t\tSystem.out.println(Thread.currentThread().getName() + i);\n\t\t}\n\t}\n}\n\nclass Demo1 extends Thread {\n\t@Override\n\tpublic void run() {\n\t\tfor (int i = 0; i < 10; i++) {\n\t\t\tSystem.out.println(Thread.currentThread().getName() + i);\n\t\t}\n\t}\n}\n```\n\n### 1.3.2 实现Runnable接口实现run方法\n\n```java\npublic class ThreadDemo1 {\n\tpublic static void main(String[] args) {\n\t\tThread d2 = new Thread(new Demo2());\n\t\td2.start();\n\t\tfor (int i = 0; i < 60; i++) {\n\t\t\tSystem.out.println(Thread.currentThread().getName() + i);\n\t\t}\n\t}\n}\nclass Demo2 implements Runnable {\n\n\t@Override\n\tpublic void run() {\n\t\tfor (int i = 0; i < 10; i++) {\n\t\t\tSystem.out.println(Thread.currentThread().getName() + i);\n\t\t}\n\t}\n}\n```\n\n## 1.4 继承Thread与实现Runnable的区别\n\n - 查看源码的区别:\n\t* a.继承Thread : 由于子类重写了Thread类的run(), 当调用start()时, 直接找子类的run()方法\n\t* b.实现Runnable : 构造函数中传入了Runnable的引用, 成员变量记住了它, start()调用run()方法时内部判断成员变量Runnable的引用是否为空, 不为空编译时看的是Runnable的run(),运行时执行的是子类的run()方法\n - 继承Thread\n\t* 好处是:可以直接使用Thread类中的方法,代码简单\n\t* 弊端是:如果已经有了父类,就不能用这种方法\n - 实现Runnable接口\n\t* 好处是:即使自己定义的线程类有了父类也没关系,因为有了父类也可以实现接口,而且接口是可以多实现的\n\t* 弊端是:不能直接使用Thread中的方法需要先获取到线程对象后,才能得到Thread的方法,代码复杂\n\n# 2 基本API\n\n与人有生老病死一样，线程也同样要经历开始（等待）、运行、挂起和停止四种不同的状态。这四种状态都可以通过Thread类中的方法进行控制。下面给出了Thread类中和这四种状态相关的方法。\n\n 1. 开始线程\n \n    publicvoid start( );\n    publicvoid run( );\n\n 2. 挂起和唤醒线程\n \n    publicvoid resume( );     // 不建议使用\n    publicvoid suspend( );    // 不建议使用\n    publicstaticvoid sleep(long millis);\n    publicstaticvoid sleep(long millis, int nanos);\n\n 3. 终止线程\n \n    publicvoid stop( );       // 不建议使用\n    publicvoid interrupt( );\n\n 4. 得到线程状态\n \n    publicboolean isAlive( );\n    publicboolean isInterrupted( );\n    publicstaticboolean interrupted( );\n\n 5. join方法\n \n    publicvoid join( ) throws InterruptedException;\n\n线程在建立后并不马上执行run方法中的代码，而是处于等待状态。线程处于等待状态时，可以通过Thread类的方法来设置线程不各种属性，如线程的优先级（setPriority）、线程名(setName)和线程的类型（setDaemon）等。\n\n当调用start方法后，线程开始执行run方法中的代码。线程进入运行状态。可以通过Thread类的isAlive方法来判断线程是否处于运行状态。当线程处于运行状态时，isAlive返回true，当isAlive返回false时，可能线程处于等待状态，也可能处于停止状态。\n\n一但线程开始执行run方法，就会一直到这个run方法执行完成这个线程才退出。但在线程执行的过程中，可以通过两个方法使线程暂时停止执行。这两个方法是suspend和sleep。在使用suspend挂起线程后，可以通过resume方法唤醒线程。而使用sleep使线程休眠后，只能在设定的时间后使线程处于就绪状态（在线程休眠结束后，线程不一定会马上执行，只是进入了就绪状态，等待着系统进行调度）。\n\n## 2.1 设置及获取线程名字\n\n 1. 构造方法中传入名字 new Thread(\"张三\"){}\n 2. 线程对象设置名字  thread.setName()\n 3. 线程对象获取名字  thread.getName()  Thread.currentThread().hetName()\n\n## 2.2 休眠线程Sleep\n\n1. sleep方法有两个重载形式，其中一个重载形式不仅可以设毫秒，而且还可以设纳秒(1,000,000纳秒等于1毫秒)。但大多数操作系统平台上的Java虚拟机都无法精确到纳秒，因此，如果对sleep设置了纳秒，Java虚拟机将取最接近这个值的毫秒。\n\n2. 在使用sleep方法时必须使用throws或try{…}catch{…}。因为run方法无法使用throws，所以只能使用try{…}catch{…}。当在线程休眠的过程中，使用interrupt方法中断线程时sleep会抛出一个InterruptedException异常。sleep方法的定义如下：\n\n        publicstaticvoid sleep(long millis) throws InterruptedException\n        publicstaticvoid sleep(long millis, int nanos) throws InterruptedException\n        \n## 2.3 守护线程Daemon\n\n**setDaemon(), 设置一个线程为守护线程, 该线程不会单独执行, 当其他非守护线程都执行结束后, 自动退出\t**\n\n```java\npublic class ThreadDemo4 {\n\t/**\n\t * @param args\n\t * 守护线程\n\t */\n\tpublic static void main(String[] args) {\n\t\tThread t1 = new Thread() {\n\t\t\tpublic void run() {\n\t\t\t\tfor (int i = 0; i < 10; i++) {\n\t\t\t\t\tSystem.out.println(getName() + \"...aaaaaaaaaaaaaaaaaaaa\");\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tThread t2 = new Thread() {\n\t\t\tpublic void run() {\n\t\t\t\tfor (int i = 0; i < 5000; i++) {\n\t\t\t\t\tSystem.out.println(getName() + \"...bb\" + i);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tt2.setDaemon(true); // 设置为守护线程\n\n\t\tt1.start();\n\t\tt2.start();\n\t}\n}\n```\n\n## 2.4 加入线程Join\n\njoin方法的功能就是使异步执行的线程变成同步执行。也就是说，当调用线程实例的start方法后，这个方法会立即返回，如果在调用start方法后后需要使用一个由这个线程计算得到的值，就必须使用join方法。如果不使用join方法，就不能保证当执行到start方法后面的某条语句时，这个线程一定会执行完。而使用join方法后，直到这个线程退出，程序才会往下执行。下面的代码演示了join的用法。\n\n## 2.5 礼让线程Yield\n\nThread.yield()方法作用是：暂停当前正在执行的线程对象，并执行其他线程。\nyield()应该做的是让当前运行线程回到可运行状态，以允许具有相同优先级的其他线程获得运行机会。因此，使用yield()的目的是让相同优先级的线程之间能适当的轮转执行。但是，实际中无法保证yield()达到让步目的，因为让步的线程还有可能被线程调度程序再次选中。\n \n结论：yield()从未导致线程转到等待/睡眠/阻塞状态。在大多数情况下，yield()将导致线程从运行状态转到可运行状态，但有可能没有效果。\n\n## 2.6 设置线程优先级Priority\n\nsetPriority不一定起作用的，在不同的操作系统不同的jvm上，效果也可能不同。现在很多jvm的线程的实现都使用的操作系统线程，设置优先级也是使用的操作系统优先级，java层面有10个优先级别，假设操作系统只有3个优先级别，那么jvm可能将1-4级映射到操作系统的1级，5-7级映射到操作系统的2级，剩下的映射到3级，这样的话，在java层面，将优先级设置为5,6,7，其实本质就是一样的了。\n\n另外，操作系统也不能保证设置了优先级的线程就一定会先运行或得到更多的CPU时间。\n在实际使用中，不建议使用该方法\n\n# 3 同步\n\n* 当多线程并发, 有多段代码同时执行时, 我们希望某一段代码执行的过程中CPU不要切换到其他线程工作. 这时就需要同步.\n* 如果两段代码是同步的, 那么同一时间只能执行一段, 在一段代码没执行结束之前, 不会执行另外一段代码.\n\n## 3.1 同步代码块\n\n* 使用synchronized关键字加上一个锁对象来定义一段代码, 这就叫同步代码块\n* 多个同步代码块如果使用相同的锁对象, 那么他们就是同步的\n\n```java\npublic class ThreadDemo6 {\n\tpublic static void main(String[] args) {\n\t\tPrint p = new Print();\n\t\tnew Thread(){\n\t\t\tpublic void run() {\n\t\t\t\twhile (true) {\n\t\t\t\t\tp.print1();\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\t\t\n\t\tnew Thread(){\n\t\t\tpublic void run() {\n\t\t\t\twhile (true) {\n\t\t\t\t\tp.print2();\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\t}\n}\n\nclass Print {\n\n\tpublic void print1() {\n\t\tsynchronized (ThreadDemo6.class) {\n\t\t\ttry {\n\t\t\t\tThread.sleep(1000);\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t\tSystem.out.println(\"鼎\");\n\t\t\tSystem.out.println(\"点\");\n\t\t\tSystem.out.println(\"视\");\n\t\t\tSystem.out.println(\"讯\");\n\t\t}\n\t}\n\n\tpublic void print2() {\n\t\tsynchronized (ThreadDemo6.class) {\n\t\t\ttry {\n\t\t\t\tThread.sleep(1000);\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t\tSystem.out.println(\"T\");\n\t\t\tSystem.out.println(\"O\");\n\t\t\tSystem.out.println(\"P\");\n\t\t\tSystem.out.println(\"V\");\n\t\t\tSystem.out.println(\"I\");\n\t\t\tSystem.out.println(\"S\");\n\t\t\tSystem.out.println(\"I\");\n\t\t\tSystem.out.println(\"O\");\n\t\t\tSystem.out.println(\"N\");\n\t\t}\n\t}\n}\n```\n\n## 3.2 同步方法\n\n* 使用synchronized关键字修饰一个方法, 该方法中所有的代码都是同步的\n* 注意锁对象\n\n```java\n//同步方法，锁对象是this\npublic synchronized void print1() {\n\tSystem.out.println(\"鼎\");\n\tSystem.out.println(\"点\");\n\tSystem.out.println(\"视\");\n\tSystem.out.println(\"讯\");\n}\n```\n\n```java\n//静态同步方法，锁对象是字节码文件\npublic static synchronized void print1() {\n\tSystem.out.println(\"鼎\");\n\tSystem.out.println(\"点\");\n\tSystem.out.println(\"视\");\n\tSystem.out.println(\"讯\");\n}\n```\n\n## 3.3 线程安全\n\n* 多线程并发操作同一数据时, 就有可能出现线程安全问题\n* 使用同步技术可以解决这种问题, 把操作数据的代码进行同步, 不要多个线程一起操作。\n\n```java\npackage com.topvision.thread;\n\npublic class ThreadTicket1 {\n\tpublic static void main(String[] args) {\n\t\t/*new Ticket1().start();\n\t\tnew Ticket1().start();\n\t\tnew Ticket1().start();\n\t\tnew Ticket1().start();*/\n\t\tTicket2 t2 = new Ticket2();\n\t\tnew Thread(t2).start();\n\t\tnew Thread(t2).start();\n\t\tnew Thread(t2).start();\n\t\tnew Thread(t2).start();\n\t}\n}\n\nclass Ticket1 extends Thread {\n\tprivate static int ticktets = 100;\n\n\tpublic void run() {\n\t\twhile (true) {\n\t\t\tsynchronized (Ticket1.class) {\n\t\t\t\tif (ticktets <= 0) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tSystem.out.println(\"这是第\" + ticktets-- + \"张票\");\n\t\t\t}\n\t\t}\n\n\t}\n}\n\nclass Ticket2 implements Runnable {\n\tprivate int ticktets = 100;\n\n\t@Override\n\tpublic void run() {\n\t\t// TODO Auto-generated method stub\n\t\twhile (true) {\n\t\t\tsynchronized (this) {\n\t\t\t\tif (ticktets <= 0) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tSystem.out.println(\"这是第\" + ticktets-- + \"张票\");\n\t\t\t}\n\t\t}\n\t}\n\n}\n```\n\n## 3.4 死锁\n\n两个线程各自拥有对方需要的锁对象，等待对方释放，因此互相等待，程序卡死。\n* 多线程同步的时候, 如果同步代码嵌套, 使用相同锁, 就有可能出现死锁\n* 尽量不要嵌套使用\n\n```java\npackage com.topvision.thread;\n\n\npublic class ThreadDemo8 {\n\t/**\n\t * @param args\n\t */\n\tprivate static String s1 = \"筷子左\";\n\tprivate static String s2 = \"筷子右\";\n\n\tpublic static void main(String[] args) {\n\t\tnew Thread() {\n\t\t\tpublic void run() {\n\t\t\t\twhile (true) {\n\t\t\t\t\tsynchronized (s1) {\n\t\t\t\t\t\tSystem.out.println(getName() + \"...获取\" + s1 + \"等待\" + s2);\n\t\t\t\t\t\tsynchronized (s2) {\n\t\t\t\t\t\t\tSystem.out.println(getName() + \"...拿到\" + s2 + \"开吃\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\n\t\tnew Thread() {\n\t\t\tpublic void run() {\n\t\t\t\twhile (true) {\n\t\t\t\t\tsynchronized (s2) {\n\t\t\t\t\t\tSystem.out.println(getName() + \"...获取\" + s2 + \"等待\" + s1);\n\t\t\t\t\t\tsynchronized (s1) {\n\t\t\t\t\t\t\tSystem.out.println(getName() + \"...拿到\" + s1 + \"开吃\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\t}\n}\n```\n\n\n\n\n\n\n\n\n \n\t\n \n \n","slug":"多线程","published":1,"updated":"2018-02-27T07:38:38.104Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspgf0029n8vfgzzsi9c2","content":"<p>本文简单介绍了多线程的基本概念、基于Thread和Runnable实现多线程编程及简单的线程安全问题示例。<br><a id=\"more\"></a></p>\n<h1 id=\"1-概述\"><a href=\"#1-概述\" class=\"headerlink\" title=\"1 概述\"></a>1 概述</h1><h2 id=\"1-1-进程与线程\"><a href=\"#1-1-进程与线程\" class=\"headerlink\" title=\"1.1 进程与线程\"></a>1.1 进程与线程</h2><ul>\n<li>进程是正在执行的程序    JVM是一个进程.</li>\n<li>线程进程中用于控制程序执行的控制单元(执行路径)</li>\n<li>进程中至少有一个线程,对于JVM,启动时至少有两个线程:JVM的主线程和JVM的垃圾回收线程</li>\n</ul>\n<h2 id=\"1-2-并行与并发\"><a href=\"#1-2-并行与并发\" class=\"headerlink\" title=\"1.2 并行与并发\"></a>1.2 并行与并发</h2><ul>\n<li>并行就是两个任务同时运行，就是甲任务进行的同时，乙任务也在进行。(需要多核CPU)</li>\n<li>并发是指两个任务都请求运行，而处理器只能按受一个任务，就把这两个任务安排轮流进行，由于时间间隔较短，使人感觉两个任务都在运行。</li>\n</ul>\n<h2 id=\"1-3-基本实现方式\"><a href=\"#1-3-基本实现方式\" class=\"headerlink\" title=\"1.3 基本实现方式\"></a>1.3 基本实现方式</h2><h3 id=\"1-3-1-继承Thread类覆盖run方法\"><a href=\"#1-3-1-继承Thread类覆盖run方法\" class=\"headerlink\" title=\"1.3.1 继承Thread类覆盖run方法\"></a>1.3.1 继承Thread类覆盖run方法</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.topvision.thread;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo1</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tDemo1 d1 = <span class=\"keyword\">new</span> Demo1();</div><div class=\"line\">\t\td1.start();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">60</span>; i++) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName() + i);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo1</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;</div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName() + i);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-3-2-实现Runnable接口实现run方法\"><a href=\"#1-3-2-实现Runnable接口实现run方法\" class=\"headerlink\" title=\"1.3.2 实现Runnable接口实现run方法\"></a>1.3.2 实现Runnable接口实现run方法</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo1</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tThread d2 = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Demo2());</div><div class=\"line\">\t\td2.start();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">60</span>; i++) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName() + i);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo2</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName() + i);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"1-4-继承Thread与实现Runnable的区别\"><a href=\"#1-4-继承Thread与实现Runnable的区别\" class=\"headerlink\" title=\"1.4 继承Thread与实现Runnable的区别\"></a>1.4 继承Thread与实现Runnable的区别</h2><ul>\n<li>查看源码的区别:<ul>\n<li>a.继承Thread : 由于子类重写了Thread类的run(), 当调用start()时, 直接找子类的run()方法</li>\n<li>b.实现Runnable : 构造函数中传入了Runnable的引用, 成员变量记住了它, start()调用run()方法时内部判断成员变量Runnable的引用是否为空, 不为空编译时看的是Runnable的run(),运行时执行的是子类的run()方法</li>\n</ul>\n</li>\n<li>继承Thread<ul>\n<li>好处是:可以直接使用Thread类中的方法,代码简单</li>\n<li>弊端是:如果已经有了父类,就不能用这种方法</li>\n</ul>\n</li>\n<li>实现Runnable接口<ul>\n<li>好处是:即使自己定义的线程类有了父类也没关系,因为有了父类也可以实现接口,而且接口是可以多实现的</li>\n<li>弊端是:不能直接使用Thread中的方法需要先获取到线程对象后,才能得到Thread的方法,代码复杂</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"2-基本API\"><a href=\"#2-基本API\" class=\"headerlink\" title=\"2 基本API\"></a>2 基本API</h1><p>与人有生老病死一样，线程也同样要经历开始（等待）、运行、挂起和停止四种不同的状态。这四种状态都可以通过Thread类中的方法进行控制。下面给出了Thread类中和这四种状态相关的方法。</p>\n<ol>\n<li><p>开始线程</p>\n<p>publicvoid start( );<br>publicvoid run( );</p>\n</li>\n<li><p>挂起和唤醒线程</p>\n<p>publicvoid resume( );     // 不建议使用<br>publicvoid suspend( );    // 不建议使用<br>publicstaticvoid sleep(long millis);<br>publicstaticvoid sleep(long millis, int nanos);</p>\n</li>\n<li><p>终止线程</p>\n<p>publicvoid stop( );       // 不建议使用<br>publicvoid interrupt( );</p>\n</li>\n<li><p>得到线程状态</p>\n<p>publicboolean isAlive( );<br>publicboolean isInterrupted( );<br>publicstaticboolean interrupted( );</p>\n</li>\n<li><p>join方法</p>\n<p>publicvoid join( ) throws InterruptedException;</p>\n</li>\n</ol>\n<p>线程在建立后并不马上执行run方法中的代码，而是处于等待状态。线程处于等待状态时，可以通过Thread类的方法来设置线程不各种属性，如线程的优先级（setPriority）、线程名(setName)和线程的类型（setDaemon）等。</p>\n<p>当调用start方法后，线程开始执行run方法中的代码。线程进入运行状态。可以通过Thread类的isAlive方法来判断线程是否处于运行状态。当线程处于运行状态时，isAlive返回true，当isAlive返回false时，可能线程处于等待状态，也可能处于停止状态。</p>\n<p>一但线程开始执行run方法，就会一直到这个run方法执行完成这个线程才退出。但在线程执行的过程中，可以通过两个方法使线程暂时停止执行。这两个方法是suspend和sleep。在使用suspend挂起线程后，可以通过resume方法唤醒线程。而使用sleep使线程休眠后，只能在设定的时间后使线程处于就绪状态（在线程休眠结束后，线程不一定会马上执行，只是进入了就绪状态，等待着系统进行调度）。</p>\n<h2 id=\"2-1-设置及获取线程名字\"><a href=\"#2-1-设置及获取线程名字\" class=\"headerlink\" title=\"2.1 设置及获取线程名字\"></a>2.1 设置及获取线程名字</h2><ol>\n<li>构造方法中传入名字 new Thread(“张三”){}</li>\n<li>线程对象设置名字  thread.setName()</li>\n<li>线程对象获取名字  thread.getName()  Thread.currentThread().hetName()</li>\n</ol>\n<h2 id=\"2-2-休眠线程Sleep\"><a href=\"#2-2-休眠线程Sleep\" class=\"headerlink\" title=\"2.2 休眠线程Sleep\"></a>2.2 休眠线程Sleep</h2><ol>\n<li><p>sleep方法有两个重载形式，其中一个重载形式不仅可以设毫秒，而且还可以设纳秒(1,000,000纳秒等于1毫秒)。但大多数操作系统平台上的Java虚拟机都无法精确到纳秒，因此，如果对sleep设置了纳秒，Java虚拟机将取最接近这个值的毫秒。</p>\n</li>\n<li><p>在使用sleep方法时必须使用throws或try{…}catch{…}。因为run方法无法使用throws，所以只能使用try{…}catch{…}。当在线程休眠的过程中，使用interrupt方法中断线程时sleep会抛出一个InterruptedException异常。sleep方法的定义如下：</p>\n<pre><code>publicstaticvoid sleep(long millis) throws InterruptedException\npublicstaticvoid sleep(long millis, int nanos) throws InterruptedException\n</code></pre></li>\n</ol>\n<h2 id=\"2-3-守护线程Daemon\"><a href=\"#2-3-守护线程Daemon\" class=\"headerlink\" title=\"2.3 守护线程Daemon\"></a>2.3 守护线程Daemon</h2><p><strong>setDaemon(), 设置一个线程为守护线程, 该线程不会单独执行, 当其他非守护线程都执行结束后, 自动退出    </strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo4</span> </span>&#123;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * <span class=\"doctag\">@param</span> args</div><div class=\"line\">\t * 守护线程</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tThread t1 = <span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...aaaaaaaaaaaaaaaaaaaa\"</span>);</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;;</div><div class=\"line\"></div><div class=\"line\">\t\tThread t2 = <span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5000</span>; i++) &#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...bb\"</span> + i);</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;;</div><div class=\"line\"></div><div class=\"line\">\t\tt2.setDaemon(<span class=\"keyword\">true</span>); <span class=\"comment\">// 设置为守护线程</span></div><div class=\"line\"></div><div class=\"line\">\t\tt1.start();</div><div class=\"line\">\t\tt2.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"2-4-加入线程Join\"><a href=\"#2-4-加入线程Join\" class=\"headerlink\" title=\"2.4 加入线程Join\"></a>2.4 加入线程Join</h2><p>join方法的功能就是使异步执行的线程变成同步执行。也就是说，当调用线程实例的start方法后，这个方法会立即返回，如果在调用start方法后后需要使用一个由这个线程计算得到的值，就必须使用join方法。如果不使用join方法，就不能保证当执行到start方法后面的某条语句时，这个线程一定会执行完。而使用join方法后，直到这个线程退出，程序才会往下执行。下面的代码演示了join的用法。</p>\n<h2 id=\"2-5-礼让线程Yield\"><a href=\"#2-5-礼让线程Yield\" class=\"headerlink\" title=\"2.5 礼让线程Yield\"></a>2.5 礼让线程Yield</h2><p>Thread.yield()方法作用是：暂停当前正在执行的线程对象，并执行其他线程。<br>yield()应该做的是让当前运行线程回到可运行状态，以允许具有相同优先级的其他线程获得运行机会。因此，使用yield()的目的是让相同优先级的线程之间能适当的轮转执行。但是，实际中无法保证yield()达到让步目的，因为让步的线程还有可能被线程调度程序再次选中。</p>\n<p>结论：yield()从未导致线程转到等待/睡眠/阻塞状态。在大多数情况下，yield()将导致线程从运行状态转到可运行状态，但有可能没有效果。</p>\n<h2 id=\"2-6-设置线程优先级Priority\"><a href=\"#2-6-设置线程优先级Priority\" class=\"headerlink\" title=\"2.6 设置线程优先级Priority\"></a>2.6 设置线程优先级Priority</h2><p>setPriority不一定起作用的，在不同的操作系统不同的jvm上，效果也可能不同。现在很多jvm的线程的实现都使用的操作系统线程，设置优先级也是使用的操作系统优先级，java层面有10个优先级别，假设操作系统只有3个优先级别，那么jvm可能将1-4级映射到操作系统的1级，5-7级映射到操作系统的2级，剩下的映射到3级，这样的话，在java层面，将优先级设置为5,6,7，其实本质就是一样的了。</p>\n<p>另外，操作系统也不能保证设置了优先级的线程就一定会先运行或得到更多的CPU时间。<br>在实际使用中，不建议使用该方法</p>\n<h1 id=\"3-同步\"><a href=\"#3-同步\" class=\"headerlink\" title=\"3 同步\"></a>3 同步</h1><ul>\n<li>当多线程并发, 有多段代码同时执行时, 我们希望某一段代码执行的过程中CPU不要切换到其他线程工作. 这时就需要同步.</li>\n<li>如果两段代码是同步的, 那么同一时间只能执行一段, 在一段代码没执行结束之前, 不会执行另外一段代码.</li>\n</ul>\n<h2 id=\"3-1-同步代码块\"><a href=\"#3-1-同步代码块\" class=\"headerlink\" title=\"3.1 同步代码块\"></a>3.1 同步代码块</h2><ul>\n<li>使用synchronized关键字加上一个锁对象来定义一段代码, 这就叫同步代码块</li>\n<li>多个同步代码块如果使用相同的锁对象, 那么他们就是同步的</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo6</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tPrint p = <span class=\"keyword\">new</span> Print();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread()&#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t\t\tp.print1();</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread()&#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t\t\tp.print2();</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Print</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">print1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">synchronized</span> (ThreadDemo6.class) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\tThread.sleep(<span class=\"number\">1000</span>);</div><div class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"鼎\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"点\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"视\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"讯\"</span>);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">print2</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">synchronized</span> (ThreadDemo6.class) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\tThread.sleep(<span class=\"number\">1000</span>);</div><div class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"T\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"O\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"P\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"V\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"I\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"S\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"I\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"O\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"N\"</span>);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"3-2-同步方法\"><a href=\"#3-2-同步方法\" class=\"headerlink\" title=\"3.2 同步方法\"></a>3.2 同步方法</h2><ul>\n<li>使用synchronized关键字修饰一个方法, 该方法中所有的代码都是同步的</li>\n<li>注意锁对象</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//同步方法，锁对象是this</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">print1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"鼎\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"点\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"视\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"讯\"</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//静态同步方法，锁对象是字节码文件</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">print1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"鼎\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"点\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"视\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"讯\"</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"3-3-线程安全\"><a href=\"#3-3-线程安全\" class=\"headerlink\" title=\"3.3 线程安全\"></a>3.3 线程安全</h2><ul>\n<li>多线程并发操作同一数据时, 就有可能出现线程安全问题</li>\n<li>使用同步技术可以解决这种问题, 把操作数据的代码进行同步, 不要多个线程一起操作。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.topvision.thread;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadTicket1</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">/*new Ticket1().start();</span></div><div class=\"line\">\t\tnew Ticket1().start();</div><div class=\"line\">\t\tnew Ticket1().start();</div><div class=\"line\">\t\tnew Ticket1().start();*/</div><div class=\"line\">\t\tTicket2 t2 = <span class=\"keyword\">new</span> Ticket2();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(t2).start();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(t2).start();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(t2).start();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(t2).start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Ticket1</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> ticktets = <span class=\"number\">100</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">synchronized</span> (Ticket1.class) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (ticktets &lt;= <span class=\"number\">0</span>) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\tSystem.out.println(<span class=\"string\">\"这是第\"</span> + ticktets-- + <span class=\"string\">\"张票\"</span>);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Ticket2</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">int</span> ticktets = <span class=\"number\">100</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">// TODO Auto-generated method stub</span></div><div class=\"line\">\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">synchronized</span> (<span class=\"keyword\">this</span>) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (ticktets &lt;= <span class=\"number\">0</span>) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\tSystem.out.println(<span class=\"string\">\"这是第\"</span> + ticktets-- + <span class=\"string\">\"张票\"</span>);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"3-4-死锁\"><a href=\"#3-4-死锁\" class=\"headerlink\" title=\"3.4 死锁\"></a>3.4 死锁</h2><p>两个线程各自拥有对方需要的锁对象，等待对方释放，因此互相等待，程序卡死。</p>\n<ul>\n<li>多线程同步的时候, 如果同步代码嵌套, 使用相同锁, 就有可能出现死锁</li>\n<li>尽量不要嵌套使用</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.topvision.thread;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo8</span> </span>&#123;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * <span class=\"doctag\">@param</span> args</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String s1 = <span class=\"string\">\"筷子左\"</span>;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String s2 = <span class=\"string\">\"筷子右\"</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">synchronized</span> (s1) &#123;</div><div class=\"line\">\t\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...获取\"</span> + s1 + <span class=\"string\">\"等待\"</span> + s2);</div><div class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">synchronized</span> (s2) &#123;</div><div class=\"line\">\t\t\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...拿到\"</span> + s2 + <span class=\"string\">\"开吃\"</span>);</div><div class=\"line\">\t\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">synchronized</span> (s2) &#123;</div><div class=\"line\">\t\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...获取\"</span> + s2 + <span class=\"string\">\"等待\"</span> + s1);</div><div class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">synchronized</span> (s1) &#123;</div><div class=\"line\">\t\t\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...拿到\"</span> + s1 + <span class=\"string\">\"开吃\"</span>);</div><div class=\"line\">\t\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>本文简单介绍了多线程的基本概念、基于Thread和Runnable实现多线程编程及简单的线程安全问题示例。<br>","more":"</p>\n<h1 id=\"1-概述\"><a href=\"#1-概述\" class=\"headerlink\" title=\"1 概述\"></a>1 概述</h1><h2 id=\"1-1-进程与线程\"><a href=\"#1-1-进程与线程\" class=\"headerlink\" title=\"1.1 进程与线程\"></a>1.1 进程与线程</h2><ul>\n<li>进程是正在执行的程序    JVM是一个进程.</li>\n<li>线程进程中用于控制程序执行的控制单元(执行路径)</li>\n<li>进程中至少有一个线程,对于JVM,启动时至少有两个线程:JVM的主线程和JVM的垃圾回收线程</li>\n</ul>\n<h2 id=\"1-2-并行与并发\"><a href=\"#1-2-并行与并发\" class=\"headerlink\" title=\"1.2 并行与并发\"></a>1.2 并行与并发</h2><ul>\n<li>并行就是两个任务同时运行，就是甲任务进行的同时，乙任务也在进行。(需要多核CPU)</li>\n<li>并发是指两个任务都请求运行，而处理器只能按受一个任务，就把这两个任务安排轮流进行，由于时间间隔较短，使人感觉两个任务都在运行。</li>\n</ul>\n<h2 id=\"1-3-基本实现方式\"><a href=\"#1-3-基本实现方式\" class=\"headerlink\" title=\"1.3 基本实现方式\"></a>1.3 基本实现方式</h2><h3 id=\"1-3-1-继承Thread类覆盖run方法\"><a href=\"#1-3-1-继承Thread类覆盖run方法\" class=\"headerlink\" title=\"1.3.1 继承Thread类覆盖run方法\"></a>1.3.1 继承Thread类覆盖run方法</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.topvision.thread;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo1</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tDemo1 d1 = <span class=\"keyword\">new</span> Demo1();</div><div class=\"line\">\t\td1.start();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">60</span>; i++) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName() + i);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo1</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;</div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName() + i);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-3-2-实现Runnable接口实现run方法\"><a href=\"#1-3-2-实现Runnable接口实现run方法\" class=\"headerlink\" title=\"1.3.2 实现Runnable接口实现run方法\"></a>1.3.2 实现Runnable接口实现run方法</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo1</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tThread d2 = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Demo2());</div><div class=\"line\">\t\td2.start();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">60</span>; i++) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName() + i);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo2</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName() + i);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"1-4-继承Thread与实现Runnable的区别\"><a href=\"#1-4-继承Thread与实现Runnable的区别\" class=\"headerlink\" title=\"1.4 继承Thread与实现Runnable的区别\"></a>1.4 继承Thread与实现Runnable的区别</h2><ul>\n<li>查看源码的区别:<ul>\n<li>a.继承Thread : 由于子类重写了Thread类的run(), 当调用start()时, 直接找子类的run()方法</li>\n<li>b.实现Runnable : 构造函数中传入了Runnable的引用, 成员变量记住了它, start()调用run()方法时内部判断成员变量Runnable的引用是否为空, 不为空编译时看的是Runnable的run(),运行时执行的是子类的run()方法</li>\n</ul>\n</li>\n<li>继承Thread<ul>\n<li>好处是:可以直接使用Thread类中的方法,代码简单</li>\n<li>弊端是:如果已经有了父类,就不能用这种方法</li>\n</ul>\n</li>\n<li>实现Runnable接口<ul>\n<li>好处是:即使自己定义的线程类有了父类也没关系,因为有了父类也可以实现接口,而且接口是可以多实现的</li>\n<li>弊端是:不能直接使用Thread中的方法需要先获取到线程对象后,才能得到Thread的方法,代码复杂</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"2-基本API\"><a href=\"#2-基本API\" class=\"headerlink\" title=\"2 基本API\"></a>2 基本API</h1><p>与人有生老病死一样，线程也同样要经历开始（等待）、运行、挂起和停止四种不同的状态。这四种状态都可以通过Thread类中的方法进行控制。下面给出了Thread类中和这四种状态相关的方法。</p>\n<ol>\n<li><p>开始线程</p>\n<p>publicvoid start( );<br>publicvoid run( );</p>\n</li>\n<li><p>挂起和唤醒线程</p>\n<p>publicvoid resume( );     // 不建议使用<br>publicvoid suspend( );    // 不建议使用<br>publicstaticvoid sleep(long millis);<br>publicstaticvoid sleep(long millis, int nanos);</p>\n</li>\n<li><p>终止线程</p>\n<p>publicvoid stop( );       // 不建议使用<br>publicvoid interrupt( );</p>\n</li>\n<li><p>得到线程状态</p>\n<p>publicboolean isAlive( );<br>publicboolean isInterrupted( );<br>publicstaticboolean interrupted( );</p>\n</li>\n<li><p>join方法</p>\n<p>publicvoid join( ) throws InterruptedException;</p>\n</li>\n</ol>\n<p>线程在建立后并不马上执行run方法中的代码，而是处于等待状态。线程处于等待状态时，可以通过Thread类的方法来设置线程不各种属性，如线程的优先级（setPriority）、线程名(setName)和线程的类型（setDaemon）等。</p>\n<p>当调用start方法后，线程开始执行run方法中的代码。线程进入运行状态。可以通过Thread类的isAlive方法来判断线程是否处于运行状态。当线程处于运行状态时，isAlive返回true，当isAlive返回false时，可能线程处于等待状态，也可能处于停止状态。</p>\n<p>一但线程开始执行run方法，就会一直到这个run方法执行完成这个线程才退出。但在线程执行的过程中，可以通过两个方法使线程暂时停止执行。这两个方法是suspend和sleep。在使用suspend挂起线程后，可以通过resume方法唤醒线程。而使用sleep使线程休眠后，只能在设定的时间后使线程处于就绪状态（在线程休眠结束后，线程不一定会马上执行，只是进入了就绪状态，等待着系统进行调度）。</p>\n<h2 id=\"2-1-设置及获取线程名字\"><a href=\"#2-1-设置及获取线程名字\" class=\"headerlink\" title=\"2.1 设置及获取线程名字\"></a>2.1 设置及获取线程名字</h2><ol>\n<li>构造方法中传入名字 new Thread(“张三”){}</li>\n<li>线程对象设置名字  thread.setName()</li>\n<li>线程对象获取名字  thread.getName()  Thread.currentThread().hetName()</li>\n</ol>\n<h2 id=\"2-2-休眠线程Sleep\"><a href=\"#2-2-休眠线程Sleep\" class=\"headerlink\" title=\"2.2 休眠线程Sleep\"></a>2.2 休眠线程Sleep</h2><ol>\n<li><p>sleep方法有两个重载形式，其中一个重载形式不仅可以设毫秒，而且还可以设纳秒(1,000,000纳秒等于1毫秒)。但大多数操作系统平台上的Java虚拟机都无法精确到纳秒，因此，如果对sleep设置了纳秒，Java虚拟机将取最接近这个值的毫秒。</p>\n</li>\n<li><p>在使用sleep方法时必须使用throws或try{…}catch{…}。因为run方法无法使用throws，所以只能使用try{…}catch{…}。当在线程休眠的过程中，使用interrupt方法中断线程时sleep会抛出一个InterruptedException异常。sleep方法的定义如下：</p>\n<pre><code>publicstaticvoid sleep(long millis) throws InterruptedException\npublicstaticvoid sleep(long millis, int nanos) throws InterruptedException\n</code></pre></li>\n</ol>\n<h2 id=\"2-3-守护线程Daemon\"><a href=\"#2-3-守护线程Daemon\" class=\"headerlink\" title=\"2.3 守护线程Daemon\"></a>2.3 守护线程Daemon</h2><p><strong>setDaemon(), 设置一个线程为守护线程, 该线程不会单独执行, 当其他非守护线程都执行结束后, 自动退出    </strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo4</span> </span>&#123;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * <span class=\"doctag\">@param</span> args</div><div class=\"line\">\t * 守护线程</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tThread t1 = <span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...aaaaaaaaaaaaaaaaaaaa\"</span>);</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;;</div><div class=\"line\"></div><div class=\"line\">\t\tThread t2 = <span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5000</span>; i++) &#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...bb\"</span> + i);</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;;</div><div class=\"line\"></div><div class=\"line\">\t\tt2.setDaemon(<span class=\"keyword\">true</span>); <span class=\"comment\">// 设置为守护线程</span></div><div class=\"line\"></div><div class=\"line\">\t\tt1.start();</div><div class=\"line\">\t\tt2.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"2-4-加入线程Join\"><a href=\"#2-4-加入线程Join\" class=\"headerlink\" title=\"2.4 加入线程Join\"></a>2.4 加入线程Join</h2><p>join方法的功能就是使异步执行的线程变成同步执行。也就是说，当调用线程实例的start方法后，这个方法会立即返回，如果在调用start方法后后需要使用一个由这个线程计算得到的值，就必须使用join方法。如果不使用join方法，就不能保证当执行到start方法后面的某条语句时，这个线程一定会执行完。而使用join方法后，直到这个线程退出，程序才会往下执行。下面的代码演示了join的用法。</p>\n<h2 id=\"2-5-礼让线程Yield\"><a href=\"#2-5-礼让线程Yield\" class=\"headerlink\" title=\"2.5 礼让线程Yield\"></a>2.5 礼让线程Yield</h2><p>Thread.yield()方法作用是：暂停当前正在执行的线程对象，并执行其他线程。<br>yield()应该做的是让当前运行线程回到可运行状态，以允许具有相同优先级的其他线程获得运行机会。因此，使用yield()的目的是让相同优先级的线程之间能适当的轮转执行。但是，实际中无法保证yield()达到让步目的，因为让步的线程还有可能被线程调度程序再次选中。</p>\n<p>结论：yield()从未导致线程转到等待/睡眠/阻塞状态。在大多数情况下，yield()将导致线程从运行状态转到可运行状态，但有可能没有效果。</p>\n<h2 id=\"2-6-设置线程优先级Priority\"><a href=\"#2-6-设置线程优先级Priority\" class=\"headerlink\" title=\"2.6 设置线程优先级Priority\"></a>2.6 设置线程优先级Priority</h2><p>setPriority不一定起作用的，在不同的操作系统不同的jvm上，效果也可能不同。现在很多jvm的线程的实现都使用的操作系统线程，设置优先级也是使用的操作系统优先级，java层面有10个优先级别，假设操作系统只有3个优先级别，那么jvm可能将1-4级映射到操作系统的1级，5-7级映射到操作系统的2级，剩下的映射到3级，这样的话，在java层面，将优先级设置为5,6,7，其实本质就是一样的了。</p>\n<p>另外，操作系统也不能保证设置了优先级的线程就一定会先运行或得到更多的CPU时间。<br>在实际使用中，不建议使用该方法</p>\n<h1 id=\"3-同步\"><a href=\"#3-同步\" class=\"headerlink\" title=\"3 同步\"></a>3 同步</h1><ul>\n<li>当多线程并发, 有多段代码同时执行时, 我们希望某一段代码执行的过程中CPU不要切换到其他线程工作. 这时就需要同步.</li>\n<li>如果两段代码是同步的, 那么同一时间只能执行一段, 在一段代码没执行结束之前, 不会执行另外一段代码.</li>\n</ul>\n<h2 id=\"3-1-同步代码块\"><a href=\"#3-1-同步代码块\" class=\"headerlink\" title=\"3.1 同步代码块\"></a>3.1 同步代码块</h2><ul>\n<li>使用synchronized关键字加上一个锁对象来定义一段代码, 这就叫同步代码块</li>\n<li>多个同步代码块如果使用相同的锁对象, 那么他们就是同步的</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo6</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tPrint p = <span class=\"keyword\">new</span> Print();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread()&#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t\t\tp.print1();</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread()&#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t\t\tp.print2();</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Print</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">print1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">synchronized</span> (ThreadDemo6.class) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\tThread.sleep(<span class=\"number\">1000</span>);</div><div class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"鼎\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"点\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"视\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"讯\"</span>);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">print2</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">synchronized</span> (ThreadDemo6.class) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\tThread.sleep(<span class=\"number\">1000</span>);</div><div class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"T\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"O\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"P\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"V\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"I\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"S\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"I\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"O\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"N\"</span>);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"3-2-同步方法\"><a href=\"#3-2-同步方法\" class=\"headerlink\" title=\"3.2 同步方法\"></a>3.2 同步方法</h2><ul>\n<li>使用synchronized关键字修饰一个方法, 该方法中所有的代码都是同步的</li>\n<li>注意锁对象</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//同步方法，锁对象是this</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">print1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"鼎\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"点\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"视\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"讯\"</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//静态同步方法，锁对象是字节码文件</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">print1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"鼎\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"点\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"视\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"讯\"</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"3-3-线程安全\"><a href=\"#3-3-线程安全\" class=\"headerlink\" title=\"3.3 线程安全\"></a>3.3 线程安全</h2><ul>\n<li>多线程并发操作同一数据时, 就有可能出现线程安全问题</li>\n<li>使用同步技术可以解决这种问题, 把操作数据的代码进行同步, 不要多个线程一起操作。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.topvision.thread;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadTicket1</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">/*new Ticket1().start();</span></div><div class=\"line\">\t\tnew Ticket1().start();</div><div class=\"line\">\t\tnew Ticket1().start();</div><div class=\"line\">\t\tnew Ticket1().start();*/</div><div class=\"line\">\t\tTicket2 t2 = <span class=\"keyword\">new</span> Ticket2();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(t2).start();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(t2).start();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(t2).start();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(t2).start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Ticket1</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> ticktets = <span class=\"number\">100</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">synchronized</span> (Ticket1.class) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (ticktets &lt;= <span class=\"number\">0</span>) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\tSystem.out.println(<span class=\"string\">\"这是第\"</span> + ticktets-- + <span class=\"string\">\"张票\"</span>);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Ticket2</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">int</span> ticktets = <span class=\"number\">100</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">// TODO Auto-generated method stub</span></div><div class=\"line\">\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">synchronized</span> (<span class=\"keyword\">this</span>) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (ticktets &lt;= <span class=\"number\">0</span>) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\tSystem.out.println(<span class=\"string\">\"这是第\"</span> + ticktets-- + <span class=\"string\">\"张票\"</span>);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"3-4-死锁\"><a href=\"#3-4-死锁\" class=\"headerlink\" title=\"3.4 死锁\"></a>3.4 死锁</h2><p>两个线程各自拥有对方需要的锁对象，等待对方释放，因此互相等待，程序卡死。</p>\n<ul>\n<li>多线程同步的时候, 如果同步代码嵌套, 使用相同锁, 就有可能出现死锁</li>\n<li>尽量不要嵌套使用</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.topvision.thread;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo8</span> </span>&#123;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * <span class=\"doctag\">@param</span> args</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String s1 = <span class=\"string\">\"筷子左\"</span>;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String s2 = <span class=\"string\">\"筷子右\"</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">synchronized</span> (s1) &#123;</div><div class=\"line\">\t\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...获取\"</span> + s1 + <span class=\"string\">\"等待\"</span> + s2);</div><div class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">synchronized</span> (s2) &#123;</div><div class=\"line\">\t\t\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...拿到\"</span> + s2 + <span class=\"string\">\"开吃\"</span>);</div><div class=\"line\">\t\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">synchronized</span> (s2) &#123;</div><div class=\"line\">\t\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...获取\"</span> + s2 + <span class=\"string\">\"等待\"</span> + s1);</div><div class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">synchronized</span> (s1) &#123;</div><div class=\"line\">\t\t\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...拿到\"</span> + s1 + <span class=\"string\">\"开吃\"</span>);</div><div class=\"line\">\t\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>"},{"title":"网站数据分析","date":"2017-07-18T00:40:13.000Z","_content":"\n我们需要问自己几个问题： \n访问者来自哪里？ -- 页面布局合理吗？ \n访问者在寻找什么？ -- 网站导航清晰吗？ \n哪些页面最受欢迎？ -- 哪些功能存在问题？ \n访问者从哪里进入？ -- 网站内容有效吗？ \n访问者从哪里离开？ -- 转化路径靠谱吗？\n\n<!-- more -->\n\n对所有网站来说，页面都可以被划分为三个类别：导航页、功能页、内容页。 \n导航页：引导访问者找到信息 \n功能页：帮助访问者完成特定任务 \n内容页：向访问者展示信息并帮助进行决策\n\n有两种诡异行为： \n1、在导航页中途离开 \n2、从内容页重新返回导航页面\n\n没有规范的分析流程容易使最后的结果逻辑混乱或偏离原来的主题\n\n## 数据获取方式\n\n1、网站日志文件 \n有两个缺点。1、原始的日志文件记录了很多统计中用不到的内容，很难筛选内容；2、很多在页面的操作（点击，ajax）无法被记录。\n\n2、Web Beacons \n在需要统计的网站页面嵌入一个1*1的透明图片，用户完全察觉不到。当用户访问网页的同时会请求透明图片，并完成页面访问记录工作。 \nWeb Beacons实现了日志记录服务器与网站应用服务器的分离。一般的网站页面，传统日志记录6-10条，用可控的图片嵌入方式大幅降低日志记录数。\n\n3、JS页面标记 \n嵌入的不再是图片，而是代码。 \n当用户访问网页时同时执行JS代码，会将一些统计需要的信息以url参数的形式附带在图片请求地址的后面，然后再向日志服务器请求图片。这样，日志服务器就可以获得比较完整的访问数据。\n\ncookie+session相同，是同一个用户在同义词访问过程中进行的操作。将相同的session的点根据发生时间的先后，和页面浏览关系的前后关系连成线。这样，将原先只有页面浏览的日志记录规划到相应的访问层面。底层的表可以从单纯记录页面浏览拆分为记录页面浏览和网站访问的两个表。\n\n页面浏览表（PageView）： \n浏览时间、页面url、session、停留时长、第几步\n\n访问表（Visit）： \nsession、起始时间、结束时间、进入页面、离开页面、访问页面数、ip、cookie、referral\n","source":"_posts/网站数据分析.md","raw":"---\ntitle: 网站数据分析\ncategories:\n  - Web\ntags:\n  - 数据收集\ndate: 2017-07-18 08:40:13\n---\n\n我们需要问自己几个问题： \n访问者来自哪里？ -- 页面布局合理吗？ \n访问者在寻找什么？ -- 网站导航清晰吗？ \n哪些页面最受欢迎？ -- 哪些功能存在问题？ \n访问者从哪里进入？ -- 网站内容有效吗？ \n访问者从哪里离开？ -- 转化路径靠谱吗？\n\n<!-- more -->\n\n对所有网站来说，页面都可以被划分为三个类别：导航页、功能页、内容页。 \n导航页：引导访问者找到信息 \n功能页：帮助访问者完成特定任务 \n内容页：向访问者展示信息并帮助进行决策\n\n有两种诡异行为： \n1、在导航页中途离开 \n2、从内容页重新返回导航页面\n\n没有规范的分析流程容易使最后的结果逻辑混乱或偏离原来的主题\n\n## 数据获取方式\n\n1、网站日志文件 \n有两个缺点。1、原始的日志文件记录了很多统计中用不到的内容，很难筛选内容；2、很多在页面的操作（点击，ajax）无法被记录。\n\n2、Web Beacons \n在需要统计的网站页面嵌入一个1*1的透明图片，用户完全察觉不到。当用户访问网页的同时会请求透明图片，并完成页面访问记录工作。 \nWeb Beacons实现了日志记录服务器与网站应用服务器的分离。一般的网站页面，传统日志记录6-10条，用可控的图片嵌入方式大幅降低日志记录数。\n\n3、JS页面标记 \n嵌入的不再是图片，而是代码。 \n当用户访问网页时同时执行JS代码，会将一些统计需要的信息以url参数的形式附带在图片请求地址的后面，然后再向日志服务器请求图片。这样，日志服务器就可以获得比较完整的访问数据。\n\ncookie+session相同，是同一个用户在同义词访问过程中进行的操作。将相同的session的点根据发生时间的先后，和页面浏览关系的前后关系连成线。这样，将原先只有页面浏览的日志记录规划到相应的访问层面。底层的表可以从单纯记录页面浏览拆分为记录页面浏览和网站访问的两个表。\n\n页面浏览表（PageView）： \n浏览时间、页面url、session、停留时长、第几步\n\n访问表（Visit）： \nsession、起始时间、结束时间、进入页面、离开页面、访问页面数、ip、cookie、referral\n","slug":"网站数据分析","published":1,"updated":"2018-02-27T07:38:38.104Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cje5fspgk002cn8vfjxdfaihc","content":"<p>我们需要问自己几个问题：<br>访问者来自哪里？ – 页面布局合理吗？<br>访问者在寻找什么？ – 网站导航清晰吗？<br>哪些页面最受欢迎？ – 哪些功能存在问题？<br>访问者从哪里进入？ – 网站内容有效吗？<br>访问者从哪里离开？ – 转化路径靠谱吗？</p>\n<a id=\"more\"></a>\n<p>对所有网站来说，页面都可以被划分为三个类别：导航页、功能页、内容页。<br>导航页：引导访问者找到信息<br>功能页：帮助访问者完成特定任务<br>内容页：向访问者展示信息并帮助进行决策</p>\n<p>有两种诡异行为：<br>1、在导航页中途离开<br>2、从内容页重新返回导航页面</p>\n<p>没有规范的分析流程容易使最后的结果逻辑混乱或偏离原来的主题</p>\n<h2 id=\"数据获取方式\"><a href=\"#数据获取方式\" class=\"headerlink\" title=\"数据获取方式\"></a>数据获取方式</h2><p>1、网站日志文件<br>有两个缺点。1、原始的日志文件记录了很多统计中用不到的内容，很难筛选内容；2、很多在页面的操作（点击，ajax）无法被记录。</p>\n<p>2、Web Beacons<br>在需要统计的网站页面嵌入一个1*1的透明图片，用户完全察觉不到。当用户访问网页的同时会请求透明图片，并完成页面访问记录工作。<br>Web Beacons实现了日志记录服务器与网站应用服务器的分离。一般的网站页面，传统日志记录6-10条，用可控的图片嵌入方式大幅降低日志记录数。</p>\n<p>3、JS页面标记<br>嵌入的不再是图片，而是代码。<br>当用户访问网页时同时执行JS代码，会将一些统计需要的信息以url参数的形式附带在图片请求地址的后面，然后再向日志服务器请求图片。这样，日志服务器就可以获得比较完整的访问数据。</p>\n<p>cookie+session相同，是同一个用户在同义词访问过程中进行的操作。将相同的session的点根据发生时间的先后，和页面浏览关系的前后关系连成线。这样，将原先只有页面浏览的日志记录规划到相应的访问层面。底层的表可以从单纯记录页面浏览拆分为记录页面浏览和网站访问的两个表。</p>\n<p>页面浏览表（PageView）：<br>浏览时间、页面url、session、停留时长、第几步</p>\n<p>访问表（Visit）：<br>session、起始时间、结束时间、进入页面、离开页面、访问页面数、ip、cookie、referral</p>\n","site":{"data":{}},"excerpt":"<p>我们需要问自己几个问题：<br>访问者来自哪里？ – 页面布局合理吗？<br>访问者在寻找什么？ – 网站导航清晰吗？<br>哪些页面最受欢迎？ – 哪些功能存在问题？<br>访问者从哪里进入？ – 网站内容有效吗？<br>访问者从哪里离开？ – 转化路径靠谱吗？</p>","more":"<p>对所有网站来说，页面都可以被划分为三个类别：导航页、功能页、内容页。<br>导航页：引导访问者找到信息<br>功能页：帮助访问者完成特定任务<br>内容页：向访问者展示信息并帮助进行决策</p>\n<p>有两种诡异行为：<br>1、在导航页中途离开<br>2、从内容页重新返回导航页面</p>\n<p>没有规范的分析流程容易使最后的结果逻辑混乱或偏离原来的主题</p>\n<h2 id=\"数据获取方式\"><a href=\"#数据获取方式\" class=\"headerlink\" title=\"数据获取方式\"></a>数据获取方式</h2><p>1、网站日志文件<br>有两个缺点。1、原始的日志文件记录了很多统计中用不到的内容，很难筛选内容；2、很多在页面的操作（点击，ajax）无法被记录。</p>\n<p>2、Web Beacons<br>在需要统计的网站页面嵌入一个1*1的透明图片，用户完全察觉不到。当用户访问网页的同时会请求透明图片，并完成页面访问记录工作。<br>Web Beacons实现了日志记录服务器与网站应用服务器的分离。一般的网站页面，传统日志记录6-10条，用可控的图片嵌入方式大幅降低日志记录数。</p>\n<p>3、JS页面标记<br>嵌入的不再是图片，而是代码。<br>当用户访问网页时同时执行JS代码，会将一些统计需要的信息以url参数的形式附带在图片请求地址的后面，然后再向日志服务器请求图片。这样，日志服务器就可以获得比较完整的访问数据。</p>\n<p>cookie+session相同，是同一个用户在同义词访问过程中进行的操作。将相同的session的点根据发生时间的先后，和页面浏览关系的前后关系连成线。这样，将原先只有页面浏览的日志记录规划到相应的访问层面。底层的表可以从单纯记录页面浏览拆分为记录页面浏览和网站访问的两个表。</p>\n<p>页面浏览表（PageView）：<br>浏览时间、页面url、session、停留时长、第几步</p>\n<p>访问表（Visit）：<br>session、起始时间、结束时间、进入页面、离开页面、访问页面数、ip、cookie、referral</p>"}],"PostAsset":[],"PostCategory":[{"post_id":"cje5fspda0000n8vftu1mhrpc","category_id":"cje5fspdv0004n8vf8pryrogy","_id":"cje5fspey000in8vf3ykyjbu6"},{"post_id":"cje5fspdp0002n8vfll6quvho","category_id":"cje5fspeg000bn8vfytsezwoa","_id":"cje5fspf5000qn8vfng9lgu72"},{"post_id":"cje5fspf0000mn8vfqd984uaj","category_id":"cje5fspez000kn8vf5ookdot6","_id":"cje5fspf9000vn8vfcmsvhs73"},{"post_id":"cje5fspe30006n8vfdnmxue6c","category_id":"cje5fspez000kn8vf5ookdot6","_id":"cje5fspfb000zn8vfv7xb17pb"},{"post_id":"cje5fspea0008n8vfe8670eed","category_id":"cje5fspf5000rn8vfc8qf7s6w","_id":"cje5fspfe0013n8vf8cv9kkf9"},{"post_id":"cje5fspee000an8vfvhbmu3qm","category_id":"cje5fspf9000wn8vf28aor2oz","_id":"cje5fspfk001an8vfmp0k0fzm"},{"post_id":"cje5fsper000fn8vfztfnsfwh","category_id":"cje5fspff0015n8vf3vjoket0","_id":"cje5fspft001in8vf8aegugwd"},{"post_id":"cje5fspew000hn8vfffcghu8k","category_id":"cje5fspff0015n8vf3vjoket0","_id":"cje5fspfx001nn8vfp91h0yeg"},{"post_id":"cje5fspfu001kn8vfkeib5ekl","category_id":"cje5fspf5000rn8vfc8qf7s6w","_id":"cje5fspg1001tn8vfczwavfnw"},{"post_id":"cje5fspf3000on8vf883m9wh0","category_id":"cje5fspfs001hn8vfo1jjey2x","_id":"cje5fspg7001wn8vfvkfqbysy"},{"post_id":"cje5fspfw001mn8vf6f84zrbb","category_id":"cje5fspeg000bn8vfytsezwoa","_id":"cje5fspg90020n8vfqwzvbeh1"},{"post_id":"cje5fspfy001qn8vfz79hujpb","category_id":"cje5fspf5000rn8vfc8qf7s6w","_id":"cje5fspgb0023n8vfmz2fsz8z"},{"post_id":"cje5fspf6000tn8vfgvijlktz","category_id":"cje5fspfs001hn8vfo1jjey2x","_id":"cje5fspge0026n8vf03i0yyul"},{"post_id":"cje5fspg0001sn8vfahsclh77","category_id":"cje5fspf5000rn8vfc8qf7s6w","_id":"cje5fspgh002an8vfdvyxnocx"},{"post_id":"cje5fspg3001vn8vfjn9u3uyz","category_id":"cje5fspf5000rn8vfc8qf7s6w","_id":"cje5fspgm002dn8vfgell5ajf"},{"post_id":"cje5fspf8000un8vf2fyefzkr","category_id":"cje5fspfs001hn8vfo1jjey2x","_id":"cje5fspgn002gn8vfaowfol37"},{"post_id":"cje5fspfa000yn8vfavh04259","category_id":"cje5fspga0021n8vfxgxxvonl","_id":"cje5fspgo002jn8vfjnc7a19r"},{"post_id":"cje5fspgd0025n8vfvzbtmpk5","category_id":"cje5fspeg000bn8vfytsezwoa","_id":"cje5fspgp002mn8vfowkeskv2"},{"post_id":"cje5fspgf0029n8vfgzzsi9c2","category_id":"cje5fspez000kn8vf5ookdot6","_id":"cje5fspgq002pn8vfl9c5s6dm"},{"post_id":"cje5fspfc0011n8vfzy4z4s4j","category_id":"cje5fspga0021n8vfxgxxvonl","_id":"cje5fspgr002rn8vf9aea24oy"},{"post_id":"cje5fspfe0014n8vfkuigdevn","category_id":"cje5fspga0021n8vfxgxxvonl","_id":"cje5fspgs002tn8vf5lef02hg"},{"post_id":"cje5fspfh0018n8vfkpt4kdp4","category_id":"cje5fspga0021n8vfxgxxvonl","_id":"cje5fspgt002vn8vfk6ceir7z"},{"post_id":"cje5fspfj0019n8vfnkrsnods","category_id":"cje5fspga0021n8vfxgxxvonl","_id":"cje5fspgu002yn8vf8zojv2i7"},{"post_id":"cje5fspfo001dn8vf23unqrcr","category_id":"cje5fspga0021n8vfxgxxvonl","_id":"cje5fspgw0032n8vfmmdkv7xg"},{"post_id":"cje5fspfq001fn8vf7v32zkcr","category_id":"cje5fspgu002xn8vfcv62r88e","_id":"cje5fspgx0036n8vf60qtfxmc"},{"post_id":"cje5fspg8001zn8vfmc55lrdv","category_id":"cje5fspgw0034n8vf5cbysm43","_id":"cje5fsph1003bn8vfpoq33tki"},{"post_id":"cje5fspga0022n8vfxtrntdmp","category_id":"cje5fspgw0034n8vf5cbysm43","_id":"cje5fsph3003fn8vf5p81af5j"},{"post_id":"cje5fspgk002cn8vfjxdfaihc","category_id":"cje5fspgw0034n8vf5cbysm43","_id":"cje5fsph4003hn8vf2v8yfpy3"}],"PostTag":[{"post_id":"cje5fspda0000n8vftu1mhrpc","tag_id":"cje5fspe20005n8vf8yb3xb3h","_id":"cje5fspeq000en8vfiskq0kly"},{"post_id":"cje5fspdp0002n8vfll6quvho","tag_id":"cje5fspeg000cn8vffgi2r61c","_id":"cje5fspfc0010n8vf7nwk7sye"},{"post_id":"cje5fspdp0002n8vfll6quvho","tag_id":"cje5fspf0000ln8vfi9fxcow6","_id":"cje5fspfe0012n8vfmqc8t0o7"},{"post_id":"cje5fspdp0002n8vfll6quvho","tag_id":"cje5fspf6000sn8vf1wp0yv66","_id":"cje5fspfg0017n8vff5cdeknf"},{"post_id":"cje5fspe30006n8vfdnmxue6c","tag_id":"cje5fspfa000xn8vfu4rqrgz3","_id":"cje5fspfp001en8vfxr4ekyxh"},{"post_id":"cje5fspe30006n8vfdnmxue6c","tag_id":"cje5fspfg0016n8vf8724nyf3","_id":"cje5fspfs001gn8vfbedx6ykq"},{"post_id":"cje5fspea0008n8vfe8670eed","tag_id":"cje5fspfl001cn8vf5qmk4ewx","_id":"cje5fspfv001ln8vf5rfuc3he"},{"post_id":"cje5fspee000an8vfvhbmu3qm","tag_id":"cje5fspft001jn8vfvj4wy9vf","_id":"cje5fspfz001rn8vflmtdi907"},{"post_id":"cje5fsper000fn8vfztfnsfwh","tag_id":"cje5fspfy001pn8vf0t8hky3n","_id":"cje5fspg8001yn8vfp42mlrd7"},{"post_id":"cje5fspew000hn8vfffcghu8k","tag_id":"cje5fspg7001xn8vf9zy00w7m","_id":"cje5fspge0027n8vff4ucw98p"},{"post_id":"cje5fspgf0029n8vfgzzsi9c2","tag_id":"cje5fspfg0016n8vf8724nyf3","_id":"cje5fspgn002en8vfui1jxrom"},{"post_id":"cje5fspgf0029n8vfgzzsi9c2","tag_id":"cje5fspfa000xn8vfu4rqrgz3","_id":"cje5fspgo002in8vfodpnkrfj"},{"post_id":"cje5fspf0000mn8vfqd984uaj","tag_id":"cje5fspfa000xn8vfu4rqrgz3","_id":"cje5fspgo002kn8vf6yccx8zf"},{"post_id":"cje5fspf0000mn8vfqd984uaj","tag_id":"cje5fspfg0016n8vf8724nyf3","_id":"cje5fspgp002on8vfgytlxmyp"},{"post_id":"cje5fspf3000on8vf883m9wh0","tag_id":"cje5fspgo002hn8vf536ry57z","_id":"cje5fspgu002zn8vfvi47fhed"},{"post_id":"cje5fspf3000on8vf883m9wh0","tag_id":"cje5fspgp002nn8vfpn9sigsv","_id":"cje5fspgv0030n8vfap4o4k6k"},{"post_id":"cje5fspf3000on8vf883m9wh0","tag_id":"cje5fspgs002sn8vf3didlqnv","_id":"cje5fspgw0033n8vf2hdttfc1"},{"post_id":"cje5fspf6000tn8vfgvijlktz","tag_id":"cje5fspgo002hn8vf536ry57z","_id":"cje5fspgz0039n8vfq7cnj93l"},{"post_id":"cje5fspf6000tn8vfgvijlktz","tag_id":"cje5fspgp002nn8vfpn9sigsv","_id":"cje5fsph2003cn8vfb5onf7e6"},{"post_id":"cje5fspf6000tn8vfgvijlktz","tag_id":"cje5fspgs002sn8vf3didlqnv","_id":"cje5fsph3003en8vfy5e303zt"},{"post_id":"cje5fspf8000un8vf2fyefzkr","tag_id":"cje5fspgo002hn8vf536ry57z","_id":"cje5fsph5003jn8vfct8b3zn3"},{"post_id":"cje5fspf8000un8vf2fyefzkr","tag_id":"cje5fspgp002nn8vfpn9sigsv","_id":"cje5fsph5003kn8vflajj21o5"},{"post_id":"cje5fspf8000un8vf2fyefzkr","tag_id":"cje5fspgs002sn8vf3didlqnv","_id":"cje5fsph6003mn8vfgt07ovcr"},{"post_id":"cje5fspfa000yn8vfavh04259","tag_id":"cje5fsph4003in8vfjrhb1kkw","_id":"cje5fsph7003nn8vfotr971ur"},{"post_id":"cje5fspfc0011n8vfzy4z4s4j","tag_id":"cje5fsph4003in8vfjrhb1kkw","_id":"cje5fsph8003pn8vfpswn0g2t"},{"post_id":"cje5fspfe0014n8vfkuigdevn","tag_id":"cje5fsph4003in8vfjrhb1kkw","_id":"cje5fsph9003rn8vffmi2mvqp"},{"post_id":"cje5fspfh0018n8vfkpt4kdp4","tag_id":"cje5fsph4003in8vfjrhb1kkw","_id":"cje5fspha003tn8vf85hl4pt1"},{"post_id":"cje5fspfj0019n8vfnkrsnods","tag_id":"cje5fsph4003in8vfjrhb1kkw","_id":"cje5fspha003vn8vfz9upoyf8"},{"post_id":"cje5fspfo001dn8vf23unqrcr","tag_id":"cje5fsph4003in8vfjrhb1kkw","_id":"cje5fsphb003xn8vfvg3ocdu2"},{"post_id":"cje5fspfq001fn8vf7v32zkcr","tag_id":"cje5fspha003wn8vfqi2h8ldw","_id":"cje5fsphc0041n8vf7u6mllbk"},{"post_id":"cje5fspfq001fn8vf7v32zkcr","tag_id":"cje5fsphb003yn8vfpxjxmn0r","_id":"cje5fsphc0042n8vfkjbrsqcl"},{"post_id":"cje5fspfq001fn8vf7v32zkcr","tag_id":"cje5fsphb003zn8vfa5vjwvp6","_id":"cje5fsphd0044n8vfiia0a87o"},{"post_id":"cje5fspfu001kn8vfkeib5ekl","tag_id":"cje5fsphb0040n8vfmv23yw0o","_id":"cje5fsphd0045n8vf59wc784x"},{"post_id":"cje5fspfw001mn8vf6f84zrbb","tag_id":"cje5fsphc0043n8vf5yswvawi","_id":"cje5fsphe0048n8vfzlemopu4"},{"post_id":"cje5fspfw001mn8vf6f84zrbb","tag_id":"cje5fsphd0046n8vfxppd29cc","_id":"cje5fsphe0049n8vftdfmb0vo"},{"post_id":"cje5fspfy001qn8vfz79hujpb","tag_id":"cje5fsphb0040n8vfmv23yw0o","_id":"cje5fsphg004cn8vfz361pl9e"},{"post_id":"cje5fspfy001qn8vfz79hujpb","tag_id":"cje5fsphe004an8vfrrapd1b1","_id":"cje5fsphg004dn8vflny5z9gb"},{"post_id":"cje5fspg0001sn8vfahsclh77","tag_id":"cje5fsphb0040n8vfmv23yw0o","_id":"cje5fsphi004fn8vf0w21rxsq"},{"post_id":"cje5fspg3001vn8vfjn9u3uyz","tag_id":"cje5fsphb0040n8vfmv23yw0o","_id":"cje5fsphi004in8vftewnwion"},{"post_id":"cje5fspg3001vn8vfjn9u3uyz","tag_id":"cje5fsphi004gn8vf7fim143m","_id":"cje5fsphj004jn8vfwqrxqgvf"},{"post_id":"cje5fspg8001zn8vfmc55lrdv","tag_id":"cje5fsphi004hn8vf5brhzfuu","_id":"cje5fsphj004ln8vftqgcyc2i"},{"post_id":"cje5fspga0022n8vfxtrntdmp","tag_id":"cje5fsphi004hn8vf5brhzfuu","_id":"cje5fsphk004nn8vfvxasi10r"},{"post_id":"cje5fspgd0025n8vfvzbtmpk5","tag_id":"cje5fspeg000cn8vffgi2r61c","_id":"cje5fsphk004pn8vfdtof7y64"},{"post_id":"cje5fspgd0025n8vfvzbtmpk5","tag_id":"cje5fsphc0043n8vf5yswvawi","_id":"cje5fsphk004qn8vftz12gq2w"},{"post_id":"cje5fspgk002cn8vfjxdfaihc","tag_id":"cje5fsphk004on8vf2p7kb88q","_id":"cje5fsphl004rn8vfyfjvasoh"}],"Tag":[{"name":"activiti","_id":"cje5fspe20005n8vf8yb3xb3h"},{"name":"MUI","_id":"cje5fspeg000cn8vffgi2r61c"},{"name":"Android Studio","_id":"cje5fspf0000ln8vfi9fxcow6"},{"name":"离线打包","_id":"cje5fspf6000sn8vf1wp0yv66"},{"name":"Java","_id":"cje5fspfa000xn8vfu4rqrgz3"},{"name":"多线程","_id":"cje5fspfg0016n8vf8724nyf3"},{"name":"properties","_id":"cje5fspfl001cn8vf5qmk4ewx"},{"name":"Mybatis","_id":"cje5fspft001jn8vfvj4wy9vf"},{"name":"Mysql 数据库","_id":"cje5fspfy001pn8vf0t8hky3n"},{"name":"Mysql","_id":"cje5fspg7001xn8vf9zy00w7m"},{"name":"snmp","_id":"cje5fspgo002hn8vf536ry57z"},{"name":"network","_id":"cje5fspgp002nn8vfpn9sigsv"},{"name":"snmp4j","_id":"cje5fspgs002sn8vf3didlqnv"},{"name":"Struts2","_id":"cje5fsph4003in8vfjrhb1kkw"},{"name":"github","_id":"cje5fspha003wn8vfqi2h8ldw"},{"name":"hexo","_id":"cje5fsphb003yn8vfpxjxmn0r"},{"name":"next","_id":"cje5fsphb003zn8vfa5vjwvp6"},{"name":"Spring","_id":"cje5fsphb0040n8vfmv23yw0o"},{"name":"html5+","_id":"cje5fsphc0043n8vf5yswvawi"},{"name":"native.js","_id":"cje5fsphd0046n8vfxppd29cc"},{"name":"IOC","_id":"cje5fsphe004an8vfrrapd1b1"},{"name":"AOP","_id":"cje5fsphi004gn8vf7fim143m"},{"name":"国际化","_id":"cje5fsphi004hn8vf5brhzfuu"},{"name":"数据收集","_id":"cje5fsphk004on8vf2p7kb88q"}]}}