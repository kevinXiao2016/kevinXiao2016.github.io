{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/Statifile","path":"Statifile","modified":1,"renderable":0},{"_id":"source/CNAME","path":"CNAME","modified":1,"renderable":0},{"_id":"source/robots.txt","path":"robots.txt","modified":1,"renderable":0},{"_id":"source/images/favicon.ico","path":"images/favicon.ico","modified":1,"renderable":0},{"_id":"source/images/alipay-reward-image.jpg","path":"images/alipay-reward-image.jpg","modified":1,"renderable":0},{"_id":"source/images/wechat-reward-image.jpg","path":"images/wechat-reward-image.jpg","modified":1,"renderable":0},{"_id":"source/images/blog/step2.png","path":"images/blog/step2.png","modified":1,"renderable":0},{"_id":"source/images/blog/newRepository.png","path":"images/blog/newRepository.png","modified":1,"renderable":0},{"_id":"source/images/blog/step3.png","path":"images/blog/step3.png","modified":1,"renderable":0},{"_id":"themes/next6.0.6/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/images/avatar.gif","path":"images/avatar.gif","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/images/loading.gif","path":"images/loading.gif","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/images/logo.svg","path":"images/logo.svg","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/images/placeholder.gif","path":"images/placeholder.gif","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/images/quote-l.svg","path":"images/quote-l.svg","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/images/cc-by.svg","path":"images/cc-by.svg","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/images/quote-r.svg","path":"images/quote-r.svg","modified":1,"renderable":1},{"_id":"source/images/avatar.png","path":"images/avatar.png","modified":1,"renderable":0},{"_id":"themes/next6.0.6/source/images/searchicon.png","path":"images/searchicon.png","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/canvas-nest/LICENSE","path":"lib/canvas-nest/LICENSE","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/canvas-nest/README.md","path":"lib/canvas-nest/README.md","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/canvas-nest/canvas-nest.min.js","path":"lib/canvas-nest/canvas-nest.min.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/js/src/affix.js","path":"js/src/affix.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/js/src/algolia-search.js","path":"js/src/algolia-search.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/js/src/exturl.js","path":"js/src/exturl.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/js/src/post-details.js","path":"js/src/post-details.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/js/src/scroll-cookie.js","path":"js/src/scroll-cookie.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/js/src/motion.js","path":"js/src/motion.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/js/src/utils.js","path":"js/src/utils.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/js/src/js.cookie.js","path":"js/src/js.cookie.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/three/LICENSE","path":"lib/three/LICENSE","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/three/README.md","path":"lib/three/README.md","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/three/canvas_lines.min.js","path":"lib/three/canvas_lines.min.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/three/canvas_sphere.min.js","path":"lib/three/canvas_sphere.min.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/three/three-waves.min.js","path":"lib/three/three-waves.min.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/ua-parser-js/dist/ua-parser.pack.js","path":"lib/ua-parser-js/dist/ua-parser.pack.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/ua-parser-js/dist/ua-parser.min.js","path":"lib/ua-parser-js/dist/ua-parser.min.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"themes/next6.0.6/source/lib/three/three.min.js","path":"lib/three/three.min.js","modified":1,"renderable":1}],"Cache":[{"_id":"source/Statifile","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1522160823822},{"_id":"source/CNAME","hash":"65ef1589074b69572647141a699ff2abf8dba5f9","modified":1522158865085},{"_id":"source/love.js","hash":"6fef036235795e2baba32997ea9b20d0b443e77b","modified":1522393189778},{"_id":"themes/next6.0.6/.bowerrc","hash":"334da94ca6f024d60d012cc26ea655681e724ad8","modified":1522404129460},{"_id":"themes/next6.0.6/.editorconfig","hash":"211d2c92bfdddb3e81ea946f4ca7a539f150f4da","modified":1522404129461},{"_id":"themes/next6.0.6/.gitattributes","hash":"8454b9313cb1a97b63fb87e2d29daee497ce6249","modified":1522404129463},{"_id":"themes/next6.0.6/.gitignore","hash":"0378adb9c2dc4855b3198184df4863cb30e4059c","modified":1522404129468},{"_id":"themes/next6.0.6/.hound.yml","hash":"289dcf5bfe92dbd680d54d6e0668f41c9c9c0c78","modified":1522404129469},{"_id":"themes/next6.0.6/.javascript_ignore","hash":"cd250ad74ca22bd2c054476456a73d9687f05f87","modified":1522404129470},{"_id":"themes/next6.0.6/.jshintrc","hash":"b7d23f2ce8d99fa073f22f9960605f318acd7710","modified":1522404129470},{"_id":"source/mouse.js","hash":"7046f0e6d46a1096949cf66c1ae37a2fb3922a41","modified":1520319988439},{"_id":"themes/next6.0.6/LICENSE.md","hash":"f0190c7d83a98464549a6b3a51bb206148d88e1b","modified":1522404129472},{"_id":"themes/next6.0.6/.travis.yml","hash":"6674fbdfe0d0c03b8a04527ffb8ab66a94253acd","modified":1522404129471},{"_id":"source/robots.txt","hash":"9c706d4bbe87232a9af3eaea392cae97eb320517","modified":1522397666471},{"_id":"themes/next6.0.6/.stylintrc","hash":"3b7f9785e9ad0dab764e1c535b40df02f4ff5fd6","modified":1522404129471},{"_id":"themes/next6.0.6/bower.json","hash":"1a6516123c947cfca8b21f562565800e8768eb26","modified":1522404129474},{"_id":"themes/next6.0.6/crowdin.yml","hash":"d8807bbc82be89d16bcaf08b1855008b3fe92cab","modified":1522404129474},{"_id":"themes/next6.0.6/_config.yml","hash":"543ceebb907de0dedab47d58e6912f70e0c99636","modified":1522404129473},{"_id":"themes/next6.0.6/README.md","hash":"6da098a5242d0fdf85166be38bd31d9a52ffca84","modified":1522404129472},{"_id":"themes/next6.0.6/gulpfile.coffee","hash":"67eaf2515100971f6195b60eeebbfe5e8de895ab","modified":1522404129491},{"_id":"themes/next6.0.6/package.json","hash":"de13bd178fe644c46ed1148fefaffb5f75811a06","modified":1522404129580},{"_id":"source/_data/next.yml","hash":"e49aa036af9489d1256214331b80609e2dd8f8cb","modified":1522405658696},{"_id":"source/_posts/Activiti5-流程框架.md","hash":"b8a5e58e26d23d98f9b8df372592a1a30a36db02","modified":1519717118082},{"_id":"source/_posts/DCloud-离线打包之Android-Studio.md","hash":"3befa3b03f213f4a3ea9b8afc684527a5dc0b39e","modified":1519717118084},{"_id":"source/_posts/Java虚拟机：内存模型.md","hash":"d13eed25ee79f79dcbc060d9ac3a524c8b0a9e4b","modified":1524474990995},{"_id":"source/_posts/Java虚拟机：类加载器.md","hash":"2dd77a885c6420e4660895d328bb12def4f66c03","modified":1524474776395},{"_id":"source/_posts/Callable及Future.md","hash":"ced5b4d99e27da68294181983c9d6df716bc0e93","modified":1519717118083},{"_id":"source/_posts/Java中读取properties.md","hash":"524e54fed85d7dd6bba1a358090f8f8718fe6f41","modified":1519717118084},{"_id":"source/_posts/Mybatis-2-——Dao层开发方法.md","hash":"e2a4cef504806d1c9687785238f3d1725d69ae2a","modified":1520324533195},{"_id":"source/_posts/Mybatis-3-——SqlMapConfig-xml文件详解.md","hash":"ca3d46a3f84da46b21cf33beb0d655b34f6b660e","modified":1520324660331},{"_id":"source/_posts/Mybatis-1-——入门.md","hash":"1b68102a9cd4ff351863bfdf026070246fcde1f4","modified":1519717118086},{"_id":"source/_posts/Mybatis-5-——与spring整合.md","hash":"ee3007a0ca6c8a05a35b1cc25d76a72bb1462489","modified":1520324855915},{"_id":"source/_posts/Mysql存储过程.md","hash":"3543d2395d1237396bd1cf6b6e7f7f9336f693c5","modified":1523417567138},{"_id":"source/_posts/Mysql索引的简单使用.md","hash":"b3fc89229f130846384370103fad5e592a419a52","modified":1523427483457},{"_id":"source/_posts/Mysql事务的隔离级别.md","hash":"f451729b3233f88918e130ccfdab0c436cac5102","modified":1523426806621},{"_id":"source/_posts/Java线程池的创建.md","hash":"d2065c35b0e5884e3f90f247ae018040d8ebd900","modified":1519717118085},{"_id":"source/_posts/NM3000告警框架简介.md","hash":"dda775a7487e8634be61aa3b963d0143f638beef","modified":1521192796157},{"_id":"source/_posts/NM3000消息推送框架简介.md","hash":"3c49d5e0651005b4a3fe608b43cb0d0adfc99c54","modified":1522054451093},{"_id":"source/_posts/Mybatis-4-——Mapper-xml映射文件.md","hash":"0c3ea46580ee8c9dca983ae758e21eb405379779","modified":1520325014651},{"_id":"source/_posts/Mysql触发器.md","hash":"d4ab91b5ba9a84739d841ee0f8f5ed1e6066caa6","modified":1523417574538},{"_id":"source/_posts/SNMP学习总结(2)——snmp安装和配置.md","hash":"072b2534a4ef46e692376709eb19bd30eebc55c3","modified":1519717118091},{"_id":"source/_posts/SNMP学习总结(1)——基本概念.md","hash":"0a35277cd3d90252d3aff2481e71e783497b9e9b","modified":1519717118090},{"_id":"source/_posts/NexT主题深度优化.md","hash":"9de6ac098ad42ea24c49c272728f46addad8579a","modified":1522834048091},{"_id":"source/_posts/SNMP学习笔记(3)——snmp4j.md","hash":"3cf27a9d0de859a9868d0f803ad29aa63dec7da2","modified":1519717118091},{"_id":"source/_posts/Spring-MVC-3-——参数绑定.md","hash":"a30be8538a060da132a86401d0929ebb2bd664a5","modified":1520324030083},{"_id":"source/_posts/Spring-MVC-2-——整合spring-mybatis.md","hash":"74b6a177c380998e09357b8405a586f187c580ec","modified":1520322709748},{"_id":"source/_posts/Mysql视图的简单使用.md","hash":"680dab416b02f0011da2118f7918470d4d308d27","modified":1523427475052},{"_id":"source/_posts/Struts2-1-——基本认识.md","hash":"df8eb55862ed6066610fc51348b1aaad0a0b4e86","modified":1519717118092},{"_id":"source/_posts/Struts2-3-——Action配置及访问方式.md","hash":"6d35e8d47c00822eeabf42cbaaf7197472eb0547","modified":1519717118093},{"_id":"source/_posts/Spring-MVC-1-——入门.md","hash":"c67678fb01309f8105294c18042f99be2f812ddf","modified":1520324452227},{"_id":"source/_posts/Struts2-5-——拦截器.md","hash":"eea445c038d60f4fe5ff11344f5a12ae88261c7e","modified":1519717118095},{"_id":"source/_posts/Struts2-6-——Struts标签、国际化、文件上传下载.md","hash":"fd64a7fa165536a2cdb3377014fd8cc671c76939","modified":1519717118096},{"_id":"source/_posts/Spring-MVC-4-——requestMapping及controller返回值.md","hash":"11ec5ca73a15268a823b2c429bb6b3f64898da0b","modified":1520324296715},{"_id":"source/_posts/hexo+github搭建个人博客.md","hash":"54f94b4cca20ff0424305cf1168b381ce82602c6","modified":1522834090451},{"_id":"source/_posts/Struts2-4-——数据封装和类型转换.md","hash":"f617b4fc83ef53f3fa97797bc2cbcfb66b672c49","modified":1519717118094},{"_id":"source/_posts/html5-常用功能.md","hash":"33cd56f3ef3760157568ddefc2fe9465cc971b03","modified":1519717118097},{"_id":"source/_posts/Struts2-2-——搭建struts及spring整合Demo.md","hash":"cd41ae398f52a822987dfdc15aa0474fccefdca1","modified":1519717118093},{"_id":"source/_posts/spring-1——框架简介.md","hash":"dc5ae2a4dc67e851c0aa778393b4f0986861b22f","modified":1519717118099},{"_id":"source/_posts/spring-3——AOP浅析.md","hash":"2574a177ae1021803a9a5988ef98b7ff0ddde750","modified":1519717118100},{"_id":"source/_posts/spring-2——IOC浅析.md","hash":"6d179ab94095d9b9829746e0f4601b85df4251fd","modified":1519717118100},{"_id":"source/_posts/spring-4-——持久层封装.md","hash":"a370906592d9376709c3b9e68ada02c0f0fd2de2","modified":1519717118101},{"_id":"source/_posts/web-xml不同版本之间的差异.md","hash":"117c4c0c1a01a6393a5f587fcd76d2d679acf87b","modified":1523611921509},{"_id":"source/_posts/使用jquery-i18n完成前端国际化.md","hash":"da16e5cac87915c2b9f8ec2b02c1eedc664d3ea9","modified":1519717118103},{"_id":"source/_posts/什么是设计模式.md","hash":"3ee6d9685f4e5bd7ba0f2417ca3c0207fa1806ec","modified":1522054991797},{"_id":"source/_posts/二分查找.md","hash":"1efd0c01be2a1872401b1b6352d8814a20686859","modified":1520495228816},{"_id":"source/_posts/多线程.md","hash":"5acee14c8f9a6d3cb78ed0196890404e97798388","modified":1519717118104},{"_id":"source/_posts/基于MUI及Html5-开发app.md","hash":"cf619bc1169ae58fd72747ff1c445e603f46b0a6","modified":1519717118103},{"_id":"source/_posts/网站数据分析.md","hash":"5cbacdd889c257d7a149c0b602152186e60e3fd3","modified":1519717118104},{"_id":"source/about/index.md","hash":"42a412bed136b558e16fe75c6113ecf13526e9a3","modified":1524546648485},{"_id":"source/_posts/观察者模式.md","hash":"57f3088e45a33a6e316abe1fe2b393786b4188c7","modified":1522402217276},{"_id":"source/_posts/常见排序算法.md","hash":"4d5fdbf53a9d4fa7dcaa10d35d4bd6557ff1a62a","modified":1520423378034},{"_id":"source/categories/index.md","hash":"b251fea7db08a1920dd1ee86edb85d12e2660d87","modified":1519717118108},{"_id":"source/_posts/使用i18next完成前端国际化.md","hash":"8a0dcc4d106a5d2b7b38a249033e81bfc362fb60","modified":1519717118102},{"_id":"source/images/favicon.ico","hash":"75b675529611ce5e08b868af7d616100da70dad8","modified":1519717118115},{"_id":"source/photos/data.json","hash":"dba16a3e248e670a0c08a0b1e8b210297b44a4cf","modified":1519717118116},{"_id":"source/images/alipay-reward-image.jpg","hash":"ae2001a613364643005e9798c5a7bf2a13bd2066","modified":1519717118109},{"_id":"source/photos/index.md","hash":"8a74707bb28e217a64ee8f065ec9bf19dc5e490b","modified":1519717118118},{"_id":"source/photos/index.ejs","hash":"93746d6bf15dd696b708ba7e8eac2fbd35308265","modified":1519717118117},{"_id":"source/photos/lazyload.min.js","hash":"47cf297e07df9cbf6c2ebced6ef88e8963a6a4ed","modified":1519717118121},{"_id":"source/tags/index.md","hash":"91f9c2e38215cf860e39af7fcf9ed8cb954ab163","modified":1519717118122},{"_id":"source/photos/ins.js","hash":"2890476636491238c95f168162b93bd83b27b0d2","modified":1519717118120},{"_id":"source/photos/ins.css","hash":"43a45811b364e206d2190228b9afe629f2c7d50b","modified":1519717118118},{"_id":"themes/next6.0.6/docs/AUTHORS.md","hash":"51a0a13da55ff3d596970b2f9ab4531c6b2211f2","modified":1522404129477},{"_id":"themes/next6.0.6/docs/ALGOLIA-SEARCH.md","hash":"1dada3c3404445a00367882b8f97cdf092b7943d","modified":1522404129476},{"_id":"themes/next6.0.6/docs/DATA-FILES.md","hash":"9a1895c0a0db705c4c48f512e86917f9af1ec3fb","modified":1522404129477},{"_id":"themes/next6.0.6/docs/INSTALLATION.md","hash":"b74ef6fedf76cdb156e2265759ee0a789ddd49cc","modified":1522404129478},{"_id":"themes/next6.0.6/docs/LICENSE","hash":"5b702310012d480b40529fd10cf1872f687277a0","modified":1522404129479},{"_id":"themes/next6.0.6/docs/AGPL3.md","hash":"f463f95b169d64983f59fa6f3e4b6760290a0e6b","modified":1522404129476},{"_id":"themes/next6.0.6/docs/LEANCLOUD-COUNTER-SECURITY.md","hash":"d0bc29c02b61e4433108987412685d991afd1a95","modified":1522404129479},{"_id":"themes/next6.0.6/docs/UPDATE-FROM-5.1.X.md","hash":"c9f2ed8e15c137b1885d9ca8b7197d9f457971e9","modified":1522404129481},{"_id":"themes/next6.0.6/layout/_layout.swig","hash":"354a81e1ad0257e15d1c2e90b3f1c7ed893cec3f","modified":1522404129522},{"_id":"themes/next6.0.6/layout/index.swig","hash":"555a357ecf17128db4e29346c92bb6298e66547a","modified":1522404129577},{"_id":"themes/next6.0.6/layout/category.swig","hash":"3cbb3f72429647411f9e85f2544bdf0e3ad2e6b2","modified":1522404129576},{"_id":"themes/next6.0.6/layout/post.swig","hash":"ceba7287574c429a235aa7a62bf7a3dc1efb265a","modified":1522404129578},{"_id":"themes/next6.0.6/layout/schedule.swig","hash":"87ad6055df01fa2e63e51887d34a2d8f0fbd2f5a","modified":1522404129578},{"_id":"themes/next6.0.6/layout/tag.swig","hash":"34e1c016cbdf94a31f9c5d494854ff46b2a182e9","modified":1522404129579},{"_id":"themes/next6.0.6/scripts/merge-configs.js","hash":"176952dfe3605c2ab57f3f7cdbac4f2487825c41","modified":1522404129581},{"_id":"themes/next6.0.6/scripts/merge.js","hash":"39b84b937b2a9608b94e5872349a47200e1800ff","modified":1522404129582},{"_id":"themes/next6.0.6/test/.jshintrc","hash":"c9fca43ae0d99718e45a6f5ce736a18ba5fc8fb6","modified":1522404129718},{"_id":"themes/next6.0.6/layout/archive.swig","hash":"678a6cab739b54da9dfb2d6634848cffdc7aab6a","modified":1522404129576},{"_id":"themes/next6.0.6/layout/page.swig","hash":"fbf2c3d14c3e5730fad75d7d106bf7f070ccd69c","modified":1522404129577},{"_id":"themes/next6.0.6/test/intern.js","hash":"db90b1063356727d72be0d77054fdc32fa882a66","modified":1522404129719},{"_id":"themes/next6.0.6/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1522404129429},{"_id":"themes/next6.0.6/.git/config","hash":"f1969a9b2e1128a528f7b846c2bc39a7f0984cdf","modified":1522404129443},{"_id":"themes/next6.0.6/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1522404055103},{"_id":"themes/next6.0.6/.git/packed-refs","hash":"9099753df4671639eb6c7f79eeaac80f8ce2c069","modified":1522404129416},{"_id":"source/images/wechat-reward-image.jpg","hash":"4532622ab5a752b82d00b96dca3bd3239f0ac30a","modified":1519717118116},{"_id":"themes/next6.0.6/test/helpers.js","hash":"f25e7f3265eb5a6e1ccbb5e5012fa9bebf134105","modified":1522404129719},{"_id":"themes/next6.0.6/.git/index","hash":"1a478886f8124247cd5ed93b211eba393fca3181","modified":1522404149055},{"_id":"themes/next6.0.6/languages/ar.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129492},{"_id":"themes/next6.0.6/languages/bn.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129494},{"_id":"themes/next6.0.6/languages/_en.yml","hash":"b63928657ff5fc2a6e71e4cc0dcde2d35b33e31d","modified":1522404129492},{"_id":"themes/next6.0.6/languages/da.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129495},{"_id":"themes/next6.0.6/languages/cs.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129494},{"_id":"themes/next6.0.6/languages/bg.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129493},{"_id":"themes/next6.0.6/languages/de.yml","hash":"bfd74445c7f17fdc859551d648b6a03e2eed2561","modified":1522404129496},{"_id":"themes/next6.0.6/languages/es.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129497},{"_id":"themes/next6.0.6/languages/fi.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129500},{"_id":"themes/next6.0.6/docs/MATH.md","hash":"bdbbcaf88f86de3d762fd1459fd5a0893cf4bce6","modified":1522404129480},{"_id":"themes/next6.0.6/languages/fr.yml","hash":"1bca7176ff846db5b063f4a90a653eed377b6909","modified":1522404129500},{"_id":"themes/next6.0.6/languages/et.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129498},{"_id":"themes/next6.0.6/languages/fa.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129499},{"_id":"themes/next6.0.6/languages/el.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129497},{"_id":"themes/next6.0.6/languages/he.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129501},{"_id":"themes/next6.0.6/languages/hr.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129502},{"_id":"themes/next6.0.6/languages/hu.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129503},{"_id":"themes/next6.0.6/languages/it.yml","hash":"6199268268f4b460b5d193c9a5a30622fc97fcdc","modified":1522404129504},{"_id":"themes/next6.0.6/languages/hi.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129501},{"_id":"themes/next6.0.6/languages/ja.yml","hash":"36732b432ac39cff022bca5700b6fef1330be0d3","modified":1522404129505},{"_id":"themes/next6.0.6/languages/id.yml","hash":"4cda8f32dacebda3479e3a0c9d688050388897f2","modified":1522404129503},{"_id":"themes/next6.0.6/languages/jv.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129505},{"_id":"themes/next6.0.6/languages/ko.yml","hash":"0753fbef09df65937586760996535bf00197c548","modified":1522404129506},{"_id":"themes/next6.0.6/languages/lv.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129507},{"_id":"themes/next6.0.6/languages/lt.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129507},{"_id":"themes/next6.0.6/languages/ms.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129508},{"_id":"themes/next6.0.6/languages/no.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129509},{"_id":"themes/next6.0.6/languages/nl.yml","hash":"2692731e1e9887b390bc6241f38a234bdb621947","modified":1522404129509},{"_id":"themes/next6.0.6/languages/pt-BR.yml","hash":"3542d4ecafb6f91427128df8b75b1824e0255405","modified":1522404129511},{"_id":"themes/next6.0.6/languages/pl.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129510},{"_id":"themes/next6.0.6/languages/pa.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129510},{"_id":"themes/next6.0.6/languages/pt.yml","hash":"681cde6ddbc998d6a36ffe857aaf6f0252ecfb29","modified":1522404129512},{"_id":"themes/next6.0.6/languages/ru.yml","hash":"fcc0d39145cad81ba640d4de9364330739a289b5","modified":1522404129513},{"_id":"themes/next6.0.6/languages/th.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129515},{"_id":"themes/next6.0.6/languages/sr.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129514},{"_id":"themes/next6.0.6/languages/sl.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129513},{"_id":"themes/next6.0.6/languages/sv.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129514},{"_id":"themes/next6.0.6/languages/ro.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129512},{"_id":"themes/next6.0.6/languages/vi.yml","hash":"4501ebf0ba7ac51c7cb19e11bd24711f49d6d8da","modified":1522404129517},{"_id":"themes/next6.0.6/languages/uk.yml","hash":"1409bf8d19c9d094f37add2435eca054a6e82b44","modified":1522404129516},{"_id":"themes/next6.0.6/languages/zh-CN.yml","hash":"0e9759ab9da2dbf5c14cf7995cf762ef7163cfcb","modified":1522404129517},{"_id":"themes/next6.0.6/languages/zh-TW.yml","hash":"68fdb53fed12075358d52d7e25ba037cc6540d02","modified":1522404129519},{"_id":"themes/next6.0.6/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1522404129673},{"_id":"themes/next6.0.6/languages/tr.yml","hash":"5de1bf8d1a4ee01d62d45683fe4d5571f8ff93a4","modified":1522404129515},{"_id":"themes/next6.0.6/languages/zh-HK.yml","hash":"6301bbc9e2cae953a49fce73936c31ba9c3b8000","modified":1522404129518},{"_id":"source/images/blog/step2.png","hash":"4797f5bd95528679a1cdd46593fb6e32309ca5b6","modified":1519717118113},{"_id":"themes/next6.0.6/.github/CODE_OF_CONDUCT.md","hash":"22f2ccc5522563b67c8663849fc1d6cbae93a8ff","modified":1522404129464},{"_id":"source/images/blog/newRepository.png","hash":"91e0c5fb0b354385812a50da67605398a3c056a7","modified":1519717118112},{"_id":"themes/next6.0.6/.github/CONTRIBUTING.md","hash":"2a1eef7678e6ad7ed6ded3e4d968c1983e4bd9a0","modified":1522404129465},{"_id":"themes/next6.0.6/.github/PULL_REQUEST_TEMPLATE.md","hash":"36201119490a04107c8179b10202548a9d0e5e60","modified":1522404129466},{"_id":"themes/next6.0.6/.github/stale.yml","hash":"dbd5e6bf89b76ad1f2b081578b239c7ae32755af","modified":1522404129467},{"_id":"themes/next6.0.6/.github/ISSUE_TEMPLATE.md","hash":"1e212fe229bd659726b4a3bcf4b5b14e0310ba3a","modified":1522404129465},{"_id":"themes/next6.0.6/.github/browserstack_logo.png","hash":"a6c43887f64a7f48a2814e3714eaa1215e542037","modified":1522404129467},{"_id":"source/images/blog/step3.png","hash":"b897b0e3f5a40af76c4e9f04fcb53ccee15b5daa","modified":1519717118114},{"_id":"themes/next6.0.6/docs/ru/INSTALLATION.md","hash":"7b2963daac19b0c14f98ebef375d5fbce8fc3f44","modified":1522404129482},{"_id":"themes/next6.0.6/docs/ru/UPDATE-FROM-5.1.X.md","hash":"1a4e41adcf5831057f3f7b3025ed4a5ef7c442b4","modified":1522404129484},{"_id":"themes/next6.0.6/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"e771c5b745608c6fb5ae2fa1c06c61b3699627ec","modified":1522404129484},{"_id":"themes/next6.0.6/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"9b512cb820627fcc45c9f77c7a122aa99e021bd5","modified":1522404129485},{"_id":"themes/next6.0.6/docs/zh-CN/CONTRIBUTING.md","hash":"edf2c5603e828fa8bfba91b1e3f2ff44ff46f17e","modified":1522404129486},{"_id":"themes/next6.0.6/docs/zh-CN/INSTALLATION.md","hash":"baca12cc24be082f1db28c7f283493569666321c","modified":1522404129487},{"_id":"themes/next6.0.6/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md","hash":"684dffabee3132055df10f66ff65c482a9b57a66","modified":1522404129488},{"_id":"themes/next6.0.6/docs/zh-CN/MATH.md","hash":"08c630dc7bd479e49d7d5aa813df628e7726bd7f","modified":1522404129489},{"_id":"themes/next6.0.6/docs/zh-CN/README.md","hash":"7966c04dbebf1e18a6eb6c19e7cc92b23c0e65bd","modified":1522404129489},{"_id":"themes/next6.0.6/docs/ru/README.md","hash":"137aa5ce71e9572389ffcbcb75d919a58d470dbd","modified":1522404129483},{"_id":"themes/next6.0.6/layout/_custom/head.swig","hash":"a223919d2e1bf17ca4d6abb2c86f2efca9883dc1","modified":1522404129520},{"_id":"themes/next6.0.6/layout/_custom/header.swig","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1522404129521},{"_id":"themes/next6.0.6/layout/_custom/sidebar.swig","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1522404129522},{"_id":"themes/next6.0.6/docs/zh-CN/DATA-FILES.md","hash":"67f4a987e7db0ab1ce1ea4c311f2961df07b6681","modified":1522404129486},{"_id":"themes/next6.0.6/layout/_macro/post-copyright.swig","hash":"949bf640c011689e518ad480299ab19785df4b80","modified":1522404129526},{"_id":"themes/next6.0.6/docs/ru/DATA-FILES.md","hash":"a51de08657f5946f4028b11373280ddc04639525","modified":1522404129482},{"_id":"themes/next6.0.6/layout/_macro/post-related.swig","hash":"e8dfb86eb62b9c2bc1435d6d1afa95d3b4c7b931","modified":1522404129526},{"_id":"themes/next6.0.6/layout/_macro/reward.swig","hash":"8dc3b6ba76c389aaa0810cbd0df206f7096d76a0","modified":1522404129528},{"_id":"themes/next6.0.6/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"1ec7a0e9ac64b2c84aa1fd7ba2c662be1dbcb407","modified":1522404129490},{"_id":"themes/next6.0.6/layout/_macro/wechat-subscriber.swig","hash":"616ffee93e84958e72ee0f996808f866c4ccdbf7","modified":1522404129530},{"_id":"themes/next6.0.6/layout/_scripts/commons.swig","hash":"931808ad9b8d8390c0dcf9bdeb0954eeb9185d68","modified":1522404129544},{"_id":"themes/next6.0.6/layout/_scripts/boostrap.swig","hash":"c0f5a0955f69ca4ed9ee64a2d5f8aa75064935ad","modified":1522404129543},{"_id":"themes/next6.0.6/layout/_scripts/noscript.swig","hash":"f8c7e729ad6e72b4c705a2c5d5041589c2b4cc52","modified":1522404129544},{"_id":"themes/next6.0.6/layout/_macro/post-collapse.swig","hash":"8c56dd26157cbc580ae41d97ac34b90ab48ced3f","modified":1522404129525},{"_id":"themes/next6.0.6/scripts/tags/button.js","hash":"496e3846f353d253dad944b2ed8fdc4e02dcc28a","modified":1522404129583},{"_id":"themes/next6.0.6/scripts/tags/center-quote.js","hash":"5c87817385986748617fa87dee9cba654566adcd","modified":1522404129583},{"_id":"themes/next6.0.6/scripts/tags/exturl.js","hash":"4f928ef9ad0ae8e3d766352b8861bc22f96de5d8","modified":1522404129584},{"_id":"themes/next6.0.6/scripts/tags/full-image.js","hash":"2118895d2d5e379240b27399a6c988a74f25a427","modified":1522404129585},{"_id":"themes/next6.0.6/scripts/tags/group-pictures.js","hash":"696157d4e4382fdbe29c674b0f4b433d47db449b","modified":1522404129585},{"_id":"themes/next6.0.6/scripts/tags/include-raw.js","hash":"1f7bafba9cf3c94f5735873bd52e93ddcf37f8a2","modified":1522404129586},{"_id":"themes/next6.0.6/scripts/tags/label.js","hash":"d8bfb2974c6afef2c085642857b70b6569b4a097","modified":1522404129587},{"_id":"themes/next6.0.6/scripts/tags/lazy-image.js","hash":"92c0ead5f503cfc4ee7c254ebfb00a2623fa1890","modified":1522404129587},{"_id":"themes/next6.0.6/scripts/tags/note.js","hash":"1cec218c9fcaa8fb4144bf9d0b39babcaafac8d4","modified":1522404129588},{"_id":"themes/next6.0.6/scripts/tags/tabs.js","hash":"aa7fc94a5ec27737458d9fe1a75c0db7593352fd","modified":1522404129588},{"_id":"themes/next6.0.6/layout/_scripts/vendors.swig","hash":"f134aeb8d5bee351e5277edb92ac694af314b75f","modified":1522404129549},{"_id":"themes/next6.0.6/source/css/main.styl","hash":"2a62e2a11e9cdcc69e538d856d6f9ce228a07c93","modified":1522404129672},{"_id":"themes/next6.0.6/layout/_third-party/bookmark.swig","hash":"ed62ea83d3f2c9db2ea57bf23a7d765ed82504c2","modified":1522404129558},{"_id":"themes/next6.0.6/layout/_third-party/exturl.swig","hash":"8301c9600bb3e47f7fb98b0e0332ef3c51bb1688","modified":1522404129565},{"_id":"themes/next6.0.6/layout/_macro/post.swig","hash":"13beda90ea472bc716e7ae594c8f4601e85ce258","modified":1522404129527},{"_id":"themes/next6.0.6/layout/_third-party/pangu.swig","hash":"ccf0035086e14dcefa24c2907301edf4c37d5448","modified":1522404129569},{"_id":"themes/next6.0.6/layout/_third-party/rating.swig","hash":"554ec568e9d2c71e4a624a8de3cb5929050811d6","modified":1522404129569},{"_id":"themes/next6.0.6/layout/_third-party/schedule.swig","hash":"db15d7e1552aa2d2386a6b8a33b3b3a40bf9e43d","modified":1522404129570},{"_id":"themes/next6.0.6/layout/_third-party/scroll-cookie.swig","hash":"9a188938d46931d5f3882a140aa1c48b3a893f0c","modified":1522404129570},{"_id":"themes/next6.0.6/layout/_third-party/github-banner.swig","hash":"736cb278fa09d3b4ed6f305b56353941ea918793","modified":1522404129565},{"_id":"themes/next6.0.6/layout/_third-party/needsharebutton.swig","hash":"debba9b7110f635204a15df148194d4c2fd2668b","modified":1522404129568},{"_id":"themes/next6.0.6/layout/_macro/sidebar.swig","hash":"2d8e3b4a211d55f4861eb2375b6fdd786484bf71","modified":1522404129529},{"_id":"themes/next6.0.6/source/images/algolia_logo.svg","hash":"45eeea0b5fba833e21e38ea10ed5ab385ceb4f01","modified":1522404129674},{"_id":"themes/next6.0.6/source/images/cc-by-nc-sa.svg","hash":"6f55543d1fb9cbc436c101d24f802dec7b41efc3","modified":1522404129677},{"_id":"themes/next6.0.6/source/images/cc-by-nc.svg","hash":"6f076713fb9bf934aa2c1046bdf2cf2e37bc1eab","modified":1522404129678},{"_id":"themes/next6.0.6/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1522404129675},{"_id":"themes/next6.0.6/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1522404129675},{"_id":"themes/next6.0.6/source/images/cc-by-nc-nd.svg","hash":"bc3588c9b2d7c68830524783120ff6cf957cf668","modified":1522404129676},{"_id":"themes/next6.0.6/source/images/cc-zero.svg","hash":"9bfb52b2f63527a7049247bf00d44e6dc1170e7d","modified":1522404129681},{"_id":"themes/next6.0.6/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1522404129682},{"_id":"themes/next6.0.6/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1522404129682},{"_id":"themes/next6.0.6/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1522404129683},{"_id":"themes/next6.0.6/source/images/logo.svg","hash":"169f56fd82941591dad3abd734a50ec7259be950","modified":1522404129684},{"_id":"themes/next6.0.6/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1522404129684},{"_id":"themes/next6.0.6/source/images/cc-by-nd.svg","hash":"42cd73da328077ccc92f859bb8f3cf621b3484f8","modified":1522404129679},{"_id":"themes/next6.0.6/source/images/cc-by-sa.svg","hash":"70c1535f43e54e5ff35ca81419e77e4c0c301398","modified":1522404129680},{"_id":"themes/next6.0.6/source/images/quote-l.svg","hash":"cd108d6f44351cadf8e6742565217f88818a0458","modified":1522404129685},{"_id":"themes/next6.0.6/layout/_partials/breadcrumb.swig","hash":"4b48fdbfe3bf41ddeda4ff74c1ff17ab9f15c14e","modified":1522404129531},{"_id":"themes/next6.0.6/source/images/cc-by.svg","hash":"e92a33c32d1dac8ed94849b2b4e6456e887efe70","modified":1522404129680},{"_id":"themes/next6.0.6/layout/_partials/comments.swig","hash":"2e8c3df265e9ae38003d1321fb80fb3b12cb6a97","modified":1522404129531},{"_id":"themes/next6.0.6/source/images/quote-r.svg","hash":"2a2a250b32a87c69dcc1b1976c74b747bedbfb41","modified":1522404129686},{"_id":"themes/next6.0.6/layout/_partials/page-header.swig","hash":"206cbd6ac9ca6a219a8516f59beae25b3c770199","modified":1522404129535},{"_id":"themes/next6.0.6/layout/_partials/pagination.swig","hash":"914155d5d758306cff405beefd4a07973fd8fc77","modified":1522404129536},{"_id":"themes/next6.0.6/layout/_partials/search.swig","hash":"b4ebe4a52a3b51efe549dd1cdee846103664f5eb","modified":1522404129536},{"_id":"themes/next6.0.6/layout/_partials/header.swig","hash":"8d5e1fa07626c42593b46cd44918d0380c47f54d","modified":1522404129535},{"_id":"themes/next6.0.6/.git/logs/HEAD","hash":"c1feab57ca3ef947278f37940da0770ada5d22c2","modified":1522404129434},{"_id":"themes/next6.0.6/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1522404055117},{"_id":"source/images/avatar.png","hash":"62c2087587b79b3929a4570195e7137c9962a446","modified":1520315084948},{"_id":"themes/next6.0.6/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1522404129687},{"_id":"themes/next6.0.6/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1522404055108},{"_id":"themes/next6.0.6/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1522404055108},{"_id":"themes/next6.0.6/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1522404055111},{"_id":"themes/next6.0.6/layout/_partials/sub-menu.swig","hash":"65d7158eac90867d0e4d8f6eeda7fb77e346b09c","modified":1522404129542},{"_id":"themes/next6.0.6/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1522404055110},{"_id":"themes/next6.0.6/.git/hooks/fsmonitor-watchman.sample","hash":"f7c0aa40cb0d620ff0bca3efe3521ec79e5d7156","modified":1522404055109},{"_id":"themes/next6.0.6/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1522404055113},{"_id":"themes/next6.0.6/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1522404055114},{"_id":"themes/next6.0.6/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1522404055112},{"_id":"themes/next6.0.6/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1522404055116},{"_id":"themes/next6.0.6/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1522404129547},{"_id":"themes/next6.0.6/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1522404129548},{"_id":"themes/next6.0.6/.git/hooks/prepare-commit-msg.sample","hash":"2584806ba147152ae005cb675aa4f01d5d068456","modified":1522404055115},{"_id":"themes/next6.0.6/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1522404129645},{"_id":"themes/next6.0.6/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1522404129645},{"_id":"themes/next6.0.6/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1522404129647},{"_id":"themes/next6.0.6/.git/hooks/pre-rebase.sample","hash":"288efdc0027db4cfd8b7c47c4aeddba09b6ded12","modified":1522404055114},{"_id":"themes/next6.0.6/layout/_partials/footer.swig","hash":"a86f302a65a5680bdbc8bbdb9e1017090b28385b","modified":1522404129532},{"_id":"themes/next6.0.6/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1522404129670},{"_id":"themes/next6.0.6/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1522404129671},{"_id":"themes/next6.0.6/layout/_macro/menu/menu-badge-1.swig","hash":"9508bf0d9adbc15fdeea415972a70e6216ea5235","modified":1522404129524},{"_id":"themes/next6.0.6/layout/_macro/menu/menu-item.swig","hash":"fcba6931b2424118fecc6dfe4527c10147c50235","modified":1522404129525},{"_id":"themes/next6.0.6/layout/_scripts/schemes/gemini.swig","hash":"a9a3995b9615adfb8d6b127c78c6771627bee19a","modified":1522404129546},{"_id":"themes/next6.0.6/layout/_scripts/schemes/pisces.swig","hash":"a9a3995b9615adfb8d6b127c78c6771627bee19a","modified":1522404129548},{"_id":"themes/next6.0.6/layout/_scripts/pages/post-details.swig","hash":"9b84ab576982b2c3bb0291da49143bc77fba3cc6","modified":1522404129545},{"_id":"themes/next6.0.6/source/css/_mixins/Gemini.styl","hash":"07f7da320689f828f6e36a6123807964a45157a0","modified":1522404129644},{"_id":"themes/next6.0.6/source/css/_mixins/Pisces.styl","hash":"8aa98ae349908736ba43196c42498fd5bdeb780a","modified":1522404129646},{"_id":"themes/next6.0.6/source/css/_custom/custom.styl","hash":"6388ab7512120957b8b1ca007fb70ee3438a0e5b","modified":1523322144092},{"_id":"themes/next6.0.6/source/css/_variables/Gemini.styl","hash":"8b5fc9e6621a5de04ae7d9ef117683c69965fb00","modified":1522404129668},{"_id":"themes/next6.0.6/source/css/_variables/Mist.styl","hash":"a25408534f8fe6e321db4bbf9dd03335d648fe17","modified":1522404129669},{"_id":"themes/next6.0.6/source/css/_variables/Pisces.styl","hash":"b89e68789e6dac24e00250528f4fc9ae8aa3599b","modified":1522404129670},{"_id":"themes/next6.0.6/source/css/_variables/base.styl","hash":"534b9dec93f3e235c217b97314d4bf513fa3e5ba","modified":1522404129671},{"_id":"themes/next6.0.6/layout/_macro/menu/menu-badge-2.swig","hash":"138cc7ad34d82ef59c526f83205defdae4274722","modified":1522404129524},{"_id":"themes/next6.0.6/source/lib/canvas-nest/LICENSE","hash":"336611e76f0638d3d8aeca6b1b97138d2a07523f","modified":1522404599811},{"_id":"themes/next6.0.6/source/lib/canvas-nest/README.md","hash":"f438a7daeb1845d95b333d34925899438a3abd6f","modified":1522404599812},{"_id":"themes/next6.0.6/source/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1522404599813},{"_id":"themes/next6.0.6/source/js/src/affix.js","hash":"1b509c3b5b290a6f4607f0f06461a0c33acb69b1","modified":1522404129688},{"_id":"themes/next6.0.6/source/js/src/algolia-search.js","hash":"cb431b54ba9c692165a1f5a12e4c564a560f8058","modified":1522404129689},{"_id":"themes/next6.0.6/source/js/src/bootstrap.js","hash":"6c30aab4822b189d1fe9b20ca5272fd8d3ebe998","modified":1522404129690},{"_id":"themes/next6.0.6/source/js/src/exturl.js","hash":"a2a0f0de07e46211f74942a468f42ee270aa555c","modified":1522404129690},{"_id":"themes/next6.0.6/source/css/_mixins/base.styl","hash":"4d6dd32dae6f0ea93d43c5cfa0106b6cb46c3b00","modified":1522404129647},{"_id":"themes/next6.0.6/source/js/src/post-details.js","hash":"02acfa1862d5e4345d6a7cee08841cc9e2fb0259","modified":1522404129693},{"_id":"themes/next6.0.6/source/js/src/scroll-cookie.js","hash":"02cf91514e41200bc9df5d8bdbeb58575ec06074","modified":1522404129695},{"_id":"themes/next6.0.6/source/js/src/motion.js","hash":"bea49fc6392bd38fb6f80d041d95d23051423aa2","modified":1522404129692},{"_id":"themes/next6.0.6/source/js/src/scrollspy.js","hash":"b7657be25fc52ec67c75ab5481bdcb483573338b","modified":1522404129695},{"_id":"themes/next6.0.6/source/js/src/utils.js","hash":"5f1eea03c8840c8931938f15ea0695dde6cb5cd9","modified":1522404129696},{"_id":"themes/next6.0.6/source/js/src/js.cookie.js","hash":"1512c751d219577d338ac0780fb2bbd9075d5298","modified":1522404129691},{"_id":"themes/next6.0.6/source/lib/velocity/velocity.min.js","hash":"bf172816a9c57f9040e3d19c24e181a142daf92b","modified":1522404129715},{"_id":"themes/next6.0.6/source/lib/font-awesome/.bower.json","hash":"b4aefc910578d76b267e86dfffdd5121c8db9aec","modified":1522404129697},{"_id":"themes/next6.0.6/source/lib/font-awesome/.gitignore","hash":"03ddbf76c1dd1afb93eed0b670d2eee747472ef1","modified":1522404129698},{"_id":"themes/next6.0.6/source/lib/font-awesome/.npmignore","hash":"c31ff06a740955e44edd4403902e653ccabfd4db","modified":1522404129699},{"_id":"themes/next6.0.6/source/lib/font-awesome/bower.json","hash":"71e7183634dc1b9449f590f15ebd7201add22ca7","modified":1522404129700},{"_id":"themes/next6.0.6/layout/_third-party/analytics/analytics-with-widget.swig","hash":"ff947f3561b229bc528cb1837d4ca19612219411","modified":1522404129550},{"_id":"themes/next6.0.6/layout/_third-party/analytics/application-insights.swig","hash":"71397a5823e8ec8aad3b68aace13150623b3e19d","modified":1522404129551},{"_id":"themes/next6.0.6/layout/_third-party/analytics/baidu-analytics.swig","hash":"753d262911c27baf663fcaf199267133528656af","modified":1522404129552},{"_id":"themes/next6.0.6/source/lib/velocity/velocity.ui.js","hash":"dbbfb50f6502f6b81dcc9fee7b31f1e812da3464","modified":1522404129716},{"_id":"themes/next6.0.6/layout/_third-party/analytics/cnzz-analytics.swig","hash":"a10b7f19d7b5725527514622899df413a34a89db","modified":1522404129553},{"_id":"themes/next6.0.6/source/lib/font-awesome/HELP-US-OUT.txt","hash":"ee33b2798b1e714b904d663436c6b3521011d1fa","modified":1522404129699},{"_id":"themes/next6.0.6/layout/_third-party/analytics/facebook-sdk.swig","hash":"7d94845f96197d9d84a405fa5d4ede75fb81b225","modified":1522404129554},{"_id":"themes/next6.0.6/source/lib/velocity/velocity.ui.min.js","hash":"dde584994ac13dc601836e86f4cf490e418d9723","modified":1522404129716},{"_id":"themes/next6.0.6/layout/_third-party/analytics/google-analytics.swig","hash":"cfc932c5db04fef64cc56d3ba0b8ddf3a15a63bd","modified":1522404129555},{"_id":"themes/next6.0.6/layout/_third-party/analytics/index.swig","hash":"45f3f629c2aacc381095750e1c8649041a71a84b","modified":1522404129555},{"_id":"themes/next6.0.6/layout/_third-party/analytics/tencent-analytics.swig","hash":"8a399df90dadba5ad4e781445b58f4765aeb701e","modified":1522404129557},{"_id":"themes/next6.0.6/layout/_third-party/analytics/tencent-mta.swig","hash":"5a8027328f060f965b3014060bebec1d7cf149c1","modified":1522404129557},{"_id":"themes/next6.0.6/layout/_third-party/analytics/busuanzi-counter.swig","hash":"c43f41b7f3c0743d1e673af2e787ea34a67fc9cb","modified":1522404129552},{"_id":"themes/next6.0.6/layout/_third-party/math/index.swig","hash":"30e9e55d9af2ced6e6b156a042026a8b480f0ab0","modified":1522404129566},{"_id":"themes/next6.0.6/layout/_third-party/math/katex.swig","hash":"860de4ce6fccc516d2f779a4b600a4214d8c18e2","modified":1522404129567},{"_id":"themes/next6.0.6/layout/_third-party/math/mathjax.swig","hash":"9a865d013b6d273bbbfc3999e8657844b0c48752","modified":1522404129567},{"_id":"themes/next6.0.6/layout/_third-party/search/index.swig","hash":"34599633658f3b0ffb487728b7766e1c7b551f5a","modified":1522404129573},{"_id":"themes/next6.0.6/layout/_third-party/analytics/firestore.swig","hash":"d67d9a176a276cdab6f2bcb7eb3650fbca5459c4","modified":1522404129554},{"_id":"themes/next6.0.6/layout/_third-party/search/tinysou.swig","hash":"fe95dd3d166634c466e19aa756e65ad6e8254d3e","modified":1522404129574},{"_id":"themes/next6.0.6/layout/_third-party/seo/baidu-push.swig","hash":"d8c98938719284fa06492c114d99a1904652a555","modified":1522404129575},{"_id":"themes/next6.0.6/layout/_third-party/search/localsearch.swig","hash":"71c897f9b107dd0de1b7f649633cf583c206a9db","modified":1522404129573},{"_id":"themes/next6.0.6/layout/_third-party/analytics/lean-analytics.swig","hash":"7973b4741863362cd9d023216de4a43eb23dc227","modified":1522404129556},{"_id":"themes/next6.0.6/layout/_partials/head/head-unique.swig","hash":"2048f9a47bfcc14b689d776028626f46d2865732","modified":1522404129533},{"_id":"themes/next6.0.6/layout/_partials/search/localsearch.swig","hash":"b2f0d247b213e4cf8de47af6a304d98070cc7256","modified":1522404129537},{"_id":"themes/next6.0.6/layout/_partials/search/swiftype.swig","hash":"a8c7f9ca7c605d039a1f3bf4e4d3183700a3dd62","modified":1522404129538},{"_id":"themes/next6.0.6/layout/_partials/search/tinysou.swig","hash":"b25002a83cbd2ca0c4a5df87ad5bff26477c0457","modified":1522404129539},{"_id":"themes/next6.0.6/layout/_partials/share/add-this.swig","hash":"9e3d133ac5bcc6cb51702c83b2611a49811abad1","modified":1522404129540},{"_id":"themes/next6.0.6/layout/_partials/share/baidushare.swig","hash":"d9e2d9282f9be6e04eae105964abb81e512bffed","modified":1522404129540},{"_id":"themes/next6.0.6/layout/_partials/head/head.swig","hash":"60555b19a3b4bf203baa9bc0ea6267674f95235c","modified":1522404129534},{"_id":"themes/next6.0.6/layout/_partials/head/external-fonts.swig","hash":"f5e487b0d213ca0bd94aa30bc23b240d65081627","modified":1522404129533},{"_id":"themes/next6.0.6/layout/_partials/share/duoshuo_share.swig","hash":"d4fbffd7fa8f2090eb32a871872665d90a885fac","modified":1522404129541},{"_id":"themes/next6.0.6/layout/_partials/share/jiathis.swig","hash":"0a9cdd6958395fcdffc80ab60f0c6301b63664a5","modified":1522404129541},{"_id":"themes/next6.0.6/layout/_third-party/comments/disqus.swig","hash":"a693a2c00497471d06113443f548b676ee2e527d","modified":1522404129560},{"_id":"themes/next6.0.6/layout/_third-party/analytics/vkontakte-api.swig","hash":"f9a1647a8f1866deeb94052d1f87a5df99cb1e70","modified":1522404129558},{"_id":"themes/next6.0.6/layout/_third-party/comments/index.swig","hash":"18a58db53f1eef50462ee0065d4445b7fbb04fb5","modified":1522404129562},{"_id":"themes/next6.0.6/layout/_third-party/comments/livere.swig","hash":"7cf0c589d95a2d1848266ffe2357e91c95d2e7f8","modified":1522404129563},{"_id":"themes/next6.0.6/layout/_third-party/comments/hypercomments.swig","hash":"787d482d797c38e77d69629ebb88d45f972216b7","modified":1522404129562},{"_id":"themes/next6.0.6/layout/_third-party/comments/youyan.swig","hash":"ab181c036cda9656f87bb1a749e3e7cbc437f012","modified":1522404129564},{"_id":"themes/next6.0.6/layout/_third-party/comments/gitment.swig","hash":"292cdd1059b76d3d10486b71c99d9afb3e59ea44","modified":1522404129561},{"_id":"themes/next6.0.6/layout/_third-party/comments/changyan.swig","hash":"4c501ea0b9c494181eb3c607c5526a5754e7fbd8","modified":1522404129559},{"_id":"themes/next6.0.6/source/lib/three/LICENSE","hash":"336611e76f0638d3d8aeca6b1b97138d2a07523f","modified":1522405009242},{"_id":"themes/next6.0.6/layout/_third-party/comments/valine.swig","hash":"de1fac9bb3f0cab88b1ed1950f76c7eb0037aeda","modified":1522404129563},{"_id":"themes/next6.0.6/source/lib/three/README.md","hash":"6dd1906f6928a2d2dd5bfa12a28474e8cc650a77","modified":1522405009243},{"_id":"themes/next6.0.6/source/lib/three/canvas_lines.min.js","hash":"2d9a9f38c493fdf7c0b833bb9184b6a1645c11b2","modified":1522405009244},{"_id":"themes/next6.0.6/source/lib/three/canvas_sphere.min.js","hash":"46a50b91c98b639c9a2b9265c5a1e66a5c656881","modified":1522405009245},{"_id":"themes/next6.0.6/source/lib/three/three-waves.min.js","hash":"8148492dd49aa876d32bb7d5b728d3f5bf6f5074","modified":1522405009247},{"_id":"themes/next6.0.6/.git/refs/heads/master","hash":"9e32a86ca12c881904d0eb1e09a8af41c09cad31","modified":1522404129433},{"_id":"themes/next6.0.6/source/lib/jquery/index.js","hash":"17a740d68a1c330876c198b6a4d9319f379f3af2","modified":1522404129710},{"_id":"themes/next6.0.6/source/css/_common/outline/outline.styl","hash":"12662536c7a07fff548abe94171f34b768dd610f","modified":1522404129638},{"_id":"themes/next6.0.6/source/css/_common/scaffolding/base.styl","hash":"97bb39756e85f5b27bba7f43270105ad01d736c9","modified":1522404129639},{"_id":"themes/next6.0.6/source/css/_common/scaffolding/scaffolding.styl","hash":"a17e2b871a335f290afb392a08f94fd35f59c715","modified":1522404129642},{"_id":"themes/next6.0.6/source/css/_common/scaffolding/helpers.styl","hash":"1da5c800d025345f212a3bf1be035060f4e5e6ed","modified":1522404129640},{"_id":"themes/next6.0.6/.git/objects/pack/pack-53a4cb8ca3e9cadcf85ed648ac1699da8fd526f8.idx","hash":"1795b47b6de29b3563decf68de6e7c40ced9628c","modified":1522404129243},{"_id":"themes/next6.0.6/source/css/_common/scaffolding/normalize.styl","hash":"3f40e8a9fe8e7bd5cfc4cf4cbbbcb9539462e973","modified":1522404129641},{"_id":"themes/next6.0.6/source/css/_common/scaffolding/tables.styl","hash":"52bc8ba71b91d954530b35dfc63b402a02b1321d","modified":1522404129642},{"_id":"themes/next6.0.6/source/css/_schemes/Muse/_layout.styl","hash":"31127dcbf4c7b4ada53ffbf1638b5fe325b7cbc0","modified":1522404129658},{"_id":"themes/next6.0.6/source/css/_schemes/Muse/_logo.styl","hash":"748dbfbf9c08e719ddc775958003c64b00d39dab","modified":1522404129659},{"_id":"themes/next6.0.6/source/css/_common/scaffolding/mobile.styl","hash":"91ca75492cd51f2553f4d294ed2f48239fcd55eb","modified":1522404129641},{"_id":"themes/next6.0.6/source/css/_schemes/Muse/_search.styl","hash":"09c965022c13b84ed8a661fee8ac2a6d550495ae","modified":1522404129660},{"_id":"themes/next6.0.6/source/css/_schemes/Muse/index.styl","hash":"b26f8a3394d8357a5bfd24d9f8bf62d7b4063ebb","modified":1522404129661},{"_id":"themes/next6.0.6/source/css/_schemes/Mist/_base.styl","hash":"d0e9065b0dbbc01811259f0597d1790268b4881b","modified":1522404129650},{"_id":"themes/next6.0.6/source/css/_schemes/Gemini/index.styl","hash":"c08eb379718fa5af267fd8c5fe9b926003c0c7c7","modified":1522404129649},{"_id":"themes/next6.0.6/source/css/_schemes/Mist/_logo.styl","hash":"b1025c421406d2c24cc92a02ae28c1915b01e240","modified":1522404129652},{"_id":"themes/next6.0.6/source/css/_schemes/Mist/_menu.styl","hash":"f3aa863adf972569b72f2df6bc6a914e7daace99","modified":1522404129652},{"_id":"themes/next6.0.6/source/css/_schemes/Mist/_search.styl","hash":"09c965022c13b84ed8a661fee8ac2a6d550495ae","modified":1522404129653},{"_id":"themes/next6.0.6/source/css/_schemes/Mist/_header.styl","hash":"d0bfd1bef988c76f7d7dd72d88af6f0908a8b0db","modified":1522404129651},{"_id":"themes/next6.0.6/source/css/_schemes/Muse/_menu.styl","hash":"3cc7646583218d16925ced7b70865e63a901d4a7","modified":1522404129659},{"_id":"themes/next6.0.6/source/css/_schemes/Mist/_posts-expanded.styl","hash":"9c99034f8e00d47e978b3959f51eb4a9ded0fcc8","modified":1522404129653},{"_id":"themes/next6.0.6/source/css/_schemes/Mist/index.styl","hash":"2ccb9bdc309b7c1ef183a3dbb0a4621bec54a328","modified":1522404129654},{"_id":"themes/next6.0.6/source/js/src/schemes/pisces.js","hash":"f1d0b5d7af32c423eaa8bb93ab6a0b45655645dc","modified":1522404129694},{"_id":"themes/next6.0.6/source/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"a817b6c158cbc5bab3582713de9fe18a18a80552","modified":1522404129712},{"_id":"themes/next6.0.6/source/lib/ua-parser-js/dist/ua-parser.min.js","hash":"41ea797c68dbcff2f6fb3aba1d1043a22e7cc0f6","modified":1522404129711},{"_id":"themes/next6.0.6/source/lib/font-awesome/css/font-awesome.css","hash":"3655f1fdf1e584c4d8e8d39026093ca306a5a341","modified":1522404129701},{"_id":"themes/next6.0.6/source/lib/font-awesome/css/font-awesome.css.map","hash":"1573904b82807abbb32c97a3632c6c6808eaac50","modified":1522404129702},{"_id":"themes/next6.0.6/source/lib/font-awesome/css/font-awesome.min.css","hash":"88af80502c44cd52ca81ffe7dc7276b7eccb06cf","modified":1522404129703},{"_id":"themes/next6.0.6/layout/_third-party/search/algolia-search/dom.swig","hash":"2530de0f3125a912756f6c0e9090cd012134a4c5","modified":1522404129572},{"_id":"themes/next6.0.6/source/css/_common/components/back-to-top-sidebar.styl","hash":"8f86f694c0749a18ab3ad6f6df75466ca137a4bc","modified":1522404129591},{"_id":"themes/next6.0.6/source/css/_common/components/back-to-top.styl","hash":"237d185ac62ec9877e300947fa0109c44fb8db19","modified":1522404129591},{"_id":"themes/next6.0.6/source/css/_common/components/comments.styl","hash":"ff4489cd582f518bba6909a301ac1292a38b4e96","modified":1522404129592},{"_id":"themes/next6.0.6/source/css/_common/components/components.styl","hash":"7ad4081466b397e2a6204141bb7768b7c01bd93c","modified":1522404129593},{"_id":"themes/next6.0.6/source/css/_common/components/tag-cloud.styl","hash":"6eb4bcc3056bd279d000607e8b4dad50d368ca69","modified":1522404129625},{"_id":"themes/next6.0.6/source/css/_common/components/buttons.styl","hash":"8b32928686c327151e13d3ab100157f9a03cd59f","modified":1522404129592},{"_id":"themes/next6.0.6/.git/logs/refs/heads/master","hash":"c1feab57ca3ef947278f37940da0770ada5d22c2","modified":1522404129436},{"_id":"themes/next6.0.6/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1522404129425},{"_id":"themes/next6.0.6/source/css/_common/components/pagination.styl","hash":"4f2801fc4cf3f31bf2069f41db8c6ce0e3da9e39","modified":1522404129606},{"_id":"themes/next6.0.6/layout/_third-party/search/algolia-search/assets.swig","hash":"218cc936ba3518a3591b2c9eda46bc701edf7710","modified":1522404129572},{"_id":"themes/next6.0.6/source/css/_schemes/Pisces/_brand.styl","hash":"bce344d3a665b4c55230d2a91eac2ad16d6f32fd","modified":1522404129663},{"_id":"themes/next6.0.6/source/css/_schemes/Pisces/_posts.styl","hash":"1f6e2ce674735269599acc6d77b3ea18d31967fc","modified":1522404129665},{"_id":"themes/next6.0.6/source/css/_schemes/Pisces/_sub-menu.styl","hash":"0518b982e73308ba3fba6d511cc6cc1a84930c21","modified":1522404129666},{"_id":"themes/next6.0.6/source/css/_schemes/Pisces/index.styl","hash":"a558803ca81cceae2bdc22c18ef638fcc023681b","modified":1522404129667},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1522404599778},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/config","hash":"78c4459d066ad795856608d603d780b53488073d","modified":1522404599793},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1522404596069},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/index","hash":"d784eaaef19463bcc4c711943fbe952df476b069","modified":1522404599814},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/packed-refs","hash":"60cebf9a6bcd88fd6b2132480cdef3ebf7a7dcf7","modified":1522404599762},{"_id":"themes/next6.0.6/source/lib/three/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1522405009206},{"_id":"themes/next6.0.6/source/lib/three/.git/config","hash":"c9c13087a3f33e6f46cd35a93c8b9bdf27618852","modified":1522405009223},{"_id":"themes/next6.0.6/source/lib/three/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1522404995945},{"_id":"themes/next6.0.6/source/lib/three/.git/index","hash":"8cf131ea4273b9d655e73f1fa17f457f7ab29644","modified":1522405009253},{"_id":"themes/next6.0.6/source/lib/three/.git/packed-refs","hash":"3e9cbba9f328f4378f17624962e553d1a6020e3f","modified":1522405009191},{"_id":"themes/next6.0.6/source/lib/velocity/velocity.js","hash":"4237c6e9d59da349639de20e559e87c2c0218cfd","modified":1522404129714},{"_id":"themes/next6.0.6/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1522404129707},{"_id":"themes/next6.0.6/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1522404129708},{"_id":"themes/next6.0.6/source/css/_schemes/Pisces/_menu.styl","hash":"cc961108b12ab97d9216606ceb1cd1cd31ab20f0","modified":1522404129664},{"_id":"themes/next6.0.6/source/css/_schemes/Pisces/_sidebar.styl","hash":"df16dc995eb9ad498df2edcfc3e20528fc9aa133","modified":1522404129666},{"_id":"themes/next6.0.6/source/css/_schemes/Pisces/_layout.styl","hash":"ab7eb1d66e300264a225feb6f8bed55683c96cdf","modified":1522404129664},{"_id":"themes/next6.0.6/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"1f09be9bb38411f0629b58c3b23873589a6dbcaa","modified":1522404129662},{"_id":"themes/next6.0.6/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"1f09be9bb38411f0629b58c3b23873589a6dbcaa","modified":1522404129657},{"_id":"themes/next6.0.6/source/css/_schemes/Mist/outline/outline.styl","hash":"a07aa12cc36ac5c819670c2a3c17d07ed7a08986","modified":1522404129655},{"_id":"themes/next6.0.6/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1522404129706},{"_id":"themes/next6.0.6/source/css/_common/components/header/header.styl","hash":"34f5ac3c1ed2dd31e9297cc4c0733e71bc2e252f","modified":1522404129596},{"_id":"themes/next6.0.6/source/css/_common/components/header/headerband.styl","hash":"d63e0cacc53dd375fcc113465a4328c59ff5f2c1","modified":1522404129597},{"_id":"themes/next6.0.6/source/css/_common/components/header/menu.styl","hash":"1a0d059799a298fe17c49a44298d32cebde93785","modified":1522404129597},{"_id":"themes/next6.0.6/source/css/_common/components/header/site-nav.styl","hash":"1727702eac5d326b5c81a667944a245016668231","modified":1522404129599},{"_id":"themes/next6.0.6/source/css/_common/components/highlight/diff.styl","hash":"167986d0f649516671ddf7193eebba7b421cd115","modified":1522404129600},{"_id":"themes/next6.0.6/source/css/_common/components/header/github-banner.styl","hash":"3f3d2a43d1a326bad25b633c8ec9ddd87867224c","modified":1522404129596},{"_id":"themes/next6.0.6/source/css/_common/components/highlight/highlight.styl","hash":"835c1340571bd6c4ec263c482cf13283fb047e49","modified":1522404129600},{"_id":"themes/next6.0.6/source/css/_common/components/pages/archive.styl","hash":"b6f3a06a94a6ee5470c956663164d58eda818a64","modified":1522404129602},{"_id":"themes/next6.0.6/source/css/_common/components/pages/breadcrumb.styl","hash":"630be616447a982413030e561bbd3a80ac14b120","modified":1522404129603},{"_id":"themes/next6.0.6/source/css/_common/components/pages/categories.styl","hash":"7fb593f90d74a99c21840679933b9ef6fdc16a61","modified":1522404129603},{"_id":"themes/next6.0.6/source/css/_common/components/pages/pages.styl","hash":"ad4cae23c8e383f4fabc9a2a95bca6055020d22e","modified":1522404129604},{"_id":"themes/next6.0.6/source/css/_common/components/pages/post-detail.styl","hash":"4e3838d7ac81d9ad133960f0f7ed58a44a015285","modified":1522404129604},{"_id":"themes/next6.0.6/source/css/_common/components/highlight/theme.styl","hash":"7fe4d4d656e86276c17cb4e48a560cb6a4def703","modified":1522404129601},{"_id":"themes/next6.0.6/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"fa57ec9a6f1943c0558856dfba2d6b8faca0cd4d","modified":1522404129618},{"_id":"themes/next6.0.6/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"8dd9a1c6f4f6baa00c2cf01837e7617120cf9660","modified":1522404129619},{"_id":"themes/next6.0.6/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"11c22f0fb3f6beb13e5a425ec064a4ff974c13b7","modified":1522404129620},{"_id":"themes/next6.0.6/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"61f8cea3c01acd600e90e1bc2a07def405503748","modified":1522404129620},{"_id":"themes/next6.0.6/source/css/_common/components/sidebar/sidebar-author.styl","hash":"761eba9811b050b25d548cc0854de4824b41eb08","modified":1522404129619},{"_id":"themes/next6.0.6/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"1153bb71edf253765145559674390e16dd67c633","modified":1522404129621},{"_id":"themes/next6.0.6/source/css/_common/components/header/site-meta.styl","hash":"0656e753f182c9f47fef7304c847b7587a85ef0d","modified":1522404129598},{"_id":"themes/next6.0.6/source/css/_common/components/pages/schedule.styl","hash":"8cf318644acc8b4978537c263290363e21c7f5af","modified":1522404129605},{"_id":"themes/next6.0.6/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"9e05a2232faabb41bcebb51d545d897a76f077da","modified":1522404129622},{"_id":"themes/next6.0.6/source/css/_common/components/sidebar/site-state.styl","hash":"e71652d3216e289c8548b1ea2357822c1476a425","modified":1522404129624},{"_id":"themes/next6.0.6/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"a1521d48bb06d8d703753f52a198baa197af7da2","modified":1522404129622},{"_id":"themes/next6.0.6/source/css/_common/components/post/post-button.styl","hash":"62fbbd32cf5a99ae550c45c763a2c4813a138d01","modified":1522404129607},{"_id":"themes/next6.0.6/source/css/_common/components/post/post-copyright.styl","hash":"caf263d1928496688c0e1419801eafd7e6919ce5","modified":1522404129608},{"_id":"themes/next6.0.6/source/css/_common/components/post/post-eof.styl","hash":"a200c0a1c5a895ac9dc41e0641a5dfcd766be99b","modified":1522404129609},{"_id":"themes/next6.0.6/source/css/_common/components/sidebar/sidebar.styl","hash":"94d76e6da600a36d80e2470326ebb6b3be447ccb","modified":1522404129623},{"_id":"themes/next6.0.6/source/css/_common/components/post/post-gallery.styl","hash":"cd9e214e502697f2f2db84eb721bac57a49b0fce","modified":1522404129610},{"_id":"themes/next6.0.6/source/css/_common/components/footer/footer.styl","hash":"7dd247c8869fdefb5a007045d00f3ef8ceecf300","modified":1522404129594},{"_id":"themes/next6.0.6/source/css/_common/components/post/post-nav.styl","hash":"27deb3d3a243d30022055dac7dad851024099a8b","modified":1522404129612},{"_id":"themes/next6.0.6/source/css/_common/components/post/post-reading_progress.styl","hash":"82bc7fa5d38d98e98cc25f9a73189024fda25e63","modified":1522404129612},{"_id":"themes/next6.0.6/source/css/_common/components/post/post-meta.styl","hash":"eed81f136f9e52032e2fa901df4fb82a0f7f5872","modified":1522404129611},{"_id":"themes/next6.0.6/source/css/_common/components/post/post-rtl.styl","hash":"b2495ae5e04dcca610aacadc47881d9e716cd440","modified":1522404129614},{"_id":"themes/next6.0.6/source/css/_common/components/post/post-tags.styl","hash":"5a982d8ef3b3623ea5f59e63728990f5623c1b57","modified":1522404129614},{"_id":"themes/next6.0.6/source/css/_common/components/post/post-title.styl","hash":"ccb34c52be8adba5996c6b94f9e723bd07d34c16","modified":1522404129615},{"_id":"themes/next6.0.6/source/css/_common/components/post/post-type.styl","hash":"01567edaea6978628aa5521a122a85434c418bfd","modified":1522404129615},{"_id":"themes/next6.0.6/source/css/_common/components/post/post-expand.styl","hash":"317c9ceda655e9dc373ce8e7b71d20b794fce9a4","modified":1522404129609},{"_id":"themes/next6.0.6/.git/logs/refs/remotes/origin/HEAD","hash":"c1feab57ca3ef947278f37940da0770ada5d22c2","modified":1522404129425},{"_id":"themes/next6.0.6/source/css/_common/components/post/post-widgets.styl","hash":"7968343e41f8b94b318c36289dff1196c3eb1791","modified":1522404129616},{"_id":"themes/next6.0.6/source/css/_common/components/post/post.styl","hash":"1faeb3fca899df9d033e4e6ad9a4867cdce7ef9d","modified":1522404129617},{"_id":"themes/next6.0.6/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"a6e7d698702c2e383dde3fde2abde27951679084","modified":1522404129633},{"_id":"themes/next6.0.6/source/css/_common/components/third-party/gitment.styl","hash":"874278147115601d2abf15987f5f7a84ada1ac6b","modified":1522404129633},{"_id":"themes/next6.0.6/source/css/_common/components/third-party/baidushare.styl","hash":"5dbeed535d63a50265d96b396a5440f9bb31e4ba","modified":1522404129632},{"_id":"themes/next6.0.6/source/css/_common/components/third-party/han.styl","hash":"10599e16414a8b7a76c4e79e6617b5fe3d4d1adf","modified":1522404129634},{"_id":"themes/next6.0.6/source/css/_common/components/third-party/jiathis.styl","hash":"15975ba7456b96916b1dbac448a1a0d2c38b8f3d","modified":1522404129635},{"_id":"themes/next6.0.6/source/css/_common/components/third-party/localsearch.styl","hash":"16087276945fa038f199692e3eabb1c52b8ea633","modified":1522404129636},{"_id":"themes/next6.0.6/source/css/_common/components/third-party/needsharebutton.styl","hash":"28825ae15fa20ae3942cdaa7bcc1f3523ce59acc","modified":1522404129636},{"_id":"themes/next6.0.6/source/css/_common/components/third-party/related-posts.styl","hash":"acfdd76b1c90d2e384affb3d0006a39b524609d2","modified":1522404129637},{"_id":"themes/next6.0.6/source/css/_common/components/third-party/third-party.styl","hash":"0b9c4140d7bc526553553552c3ed92da7c81e0b6","modified":1522404129637},{"_id":"themes/next6.0.6/source/css/_common/components/tags/exturl.styl","hash":"a3bdd71237afc112b2aa255f278cab6baeb25351","modified":1522404129626},{"_id":"themes/next6.0.6/source/css/_common/components/tags/blockquote-center.styl","hash":"2fe76476432b31993338cb45cdb3b29a518b6379","modified":1522404129626},{"_id":"themes/next6.0.6/source/css/_common/components/tags/full-image.styl","hash":"d79c051abb8ab7b5ee5da29a28587704fd5108f5","modified":1522404129627},{"_id":"themes/next6.0.6/source/css/_common/components/tags/group-pictures.styl","hash":"2ad1a2a9bbf6742d1b0762c4c623b68113d1e0fe","modified":1522404129628},{"_id":"themes/next6.0.6/source/css/_common/components/post/post-collapse.styl","hash":"875cbe88d5c7f6248990e2beb97c9828920e7e24","modified":1522404129608},{"_id":"themes/next6.0.6/source/css/_common/components/tags/label.styl","hash":"2ab1322fe52ab5aafd49e68f5bd890e8380ee927","modified":1522404129628},{"_id":"themes/next6.0.6/source/css/_common/components/tags/note-modern.styl","hash":"b7076e58d647265ee0ad2b461fe8ce72c9373bc5","modified":1522404129629},{"_id":"themes/next6.0.6/source/css/_common/components/tags/note.styl","hash":"9a409b798decdefdaf7a23f0b11004a8c27e82f3","modified":1522404129630},{"_id":"themes/next6.0.6/source/css/_common/components/tags/tags.styl","hash":"b80604868e4f5cf20fccafd7ee415c20c804f700","modified":1522404129631},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/logs/HEAD","hash":"5cd0d2bbd7705b7fa60b9f75293a7120b8ff39e0","modified":1522404599784},{"_id":"themes/next6.0.6/source/css/_common/components/third-party/algolia-search.styl","hash":"f4d8144c22544bdb89787c14ab9d39578dae4b7c","modified":1522404129632},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1522404596079},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1522404596070},{"_id":"themes/next6.0.6/source/css/_common/components/tags/tabs.styl","hash":"154a87a32d2fead480d5e909c37f6c476671c5e6","modified":1522404129630},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1522404596072},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1522404596073},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/hooks/fsmonitor-watchman.sample","hash":"f7c0aa40cb0d620ff0bca3efe3521ec79e5d7156","modified":1522404596072},{"_id":"themes/next6.0.6/source/css/_common/components/post/post-reward.styl","hash":"ca88ea6999a61fb905eb6e72eba5f92d4ee31e6e","modified":1522404129613},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1522404596071},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/hooks/prepare-commit-msg.sample","hash":"2584806ba147152ae005cb675aa4f01d5d068456","modified":1522404596077},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/hooks/pre-rebase.sample","hash":"288efdc0027db4cfd8b7c47c4aeddba09b6ded12","modified":1522404596075},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1522404596076},{"_id":"themes/next6.0.6/source/lib/three/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1522404995955},{"_id":"themes/next6.0.6/source/lib/three/.git/logs/HEAD","hash":"631d8a8826a02ea45f2ad0c421923dcc5a2a026a","modified":1522405009212},{"_id":"themes/next6.0.6/source/lib/three/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1522404995946},{"_id":"themes/next6.0.6/source/lib/three/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1522404995947},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1522404596075},{"_id":"themes/next6.0.6/source/lib/three/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1522404995949},{"_id":"themes/next6.0.6/source/lib/three/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1522404995949},{"_id":"themes/next6.0.6/source/lib/three/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1522404995952},{"_id":"themes/next6.0.6/source/lib/three/.git/hooks/fsmonitor-watchman.sample","hash":"f7c0aa40cb0d620ff0bca3efe3521ec79e5d7156","modified":1522404995948},{"_id":"themes/next6.0.6/source/lib/three/.git/hooks/pre-rebase.sample","hash":"288efdc0027db4cfd8b7c47c4aeddba09b6ded12","modified":1522404995952},{"_id":"themes/next6.0.6/source/lib/three/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1522404995953},{"_id":"themes/next6.0.6/source/lib/three/.git/hooks/prepare-commit-msg.sample","hash":"2584806ba147152ae005cb675aa4f01d5d068456","modified":1522404995954},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1522404596074},{"_id":"themes/next6.0.6/source/lib/three/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1522404995954},{"_id":"themes/next6.0.6/source/lib/three/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1522404995951},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1522404596077},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/refs/heads/master","hash":"5442226ab36d787824e89f50241336839b376133","modified":1522404599783},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/objects/45/9262fe92f0115707bf8d8764f1886bc5e7c9e0","hash":"36040483f8af76775b7e4b6d87cec53729625399","modified":1522404599233},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/objects/2a/f622a4d7df40a2708946e91d6d7a0df1dc468c","hash":"3da7207fb18d361b83c56f4e35f67e9e945abd82","modified":1522404599184},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/objects/5a/69ce9c2e4a1a34f6063ae9a121af1555669c69","hash":"dad25cc0f450e2827b5676975f4a70636e3fd2c8","modified":1522404599093},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/objects/69/a20d65d83035fdb01734a8eabe3340f740a4cb","hash":"9e95b02d8e43ec92e06bee3f60dffb74e8e7b9fa","modified":1522404599067},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/objects/75/de2b8fa62d52690de32c351c63ab6446104ed5","hash":"52d10122d633ce4895a0690c5955e1b356f5a391","modified":1522404599208},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/objects/86/1c9f4241fe0eb6af02ad770d5ce04c1f68972b","hash":"7005c3e36015a4af30d4b91bd5a849a7861a073e","modified":1522404599156},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/objects/69/39233ece53c9bdb9a1faf3271ed5768b034aad","hash":"5a770d418c1bb7b0f031f4d5416530002032fcf3","modified":1522404599134},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/objects/90/f6477118d05f5f96ce0a63c6f18b7b2baea200","hash":"385f58e92981f27fa54eb52bf60424e87c70a9d8","modified":1522404599017},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/objects/aa/da83ad9aa55faa2b34ede31b1d41e16966f80b","hash":"b304541ab95b7969a63ba2ec4f60f5391bd8bb44","modified":1522404598992},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/objects/d4/95d28a8fab74d23908f6ccef9e4db2625fbacb","hash":"59e6067b0a806deee7bda6460b36c0f63e2e1db5","modified":1522404599042},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/objects/98/67d1132e0e50bbb7df754a63358d70741df6d5","hash":"3cb710a1faee73c08036f5e2df7df3a7ce29e9dd","modified":1522404598965},{"_id":"themes/next6.0.6/source/lib/three/.git/refs/heads/master","hash":"f17437f700f7d1a2476f16b375d982f5cd36ddc2","modified":1522405009212},{"_id":"themes/next6.0.6/source/lib/three/.git/objects/09/3d290f60c3b467d503633531d7ce7cdd42dd75","hash":"ab09bc8bfc9079e408dc6facc1bfd9aa5d6bdef9","modified":1522405009046},{"_id":"themes/next6.0.6/source/lib/three/.git/objects/1b/3d1cd16f3e6ce99ea92c7e9c0b78ee30a8c346","hash":"16569e1c4912fd762f32b13de839d05b9c319e54","modified":1522405000925},{"_id":"themes/next6.0.6/source/lib/three/.git/objects/21/77c1416c8e91ed918b6d3cf7f333d99d659a24","hash":"7330016805a652c2153bfcfbdd4c3c50e5b5a642","modified":1522405009094},{"_id":"themes/next6.0.6/source/lib/three/.git/objects/69/a20d65d83035fdb01734a8eabe3340f740a4cb","hash":"9e95b02d8e43ec92e06bee3f60dffb74e8e7b9fa","modified":1522405001044},{"_id":"themes/next6.0.6/source/lib/three/.git/objects/79/ae5f64ea4be7e1a108b2f1fc8afbca7bfa1fba","hash":"4e28517d80599b1a6051b1d3f657654aca6333b9","modified":1522405001070},{"_id":"themes/next6.0.6/source/lib/three/.git/objects/7f/6a7ddb8a04644dc980d83c9878b4621acf82f5","hash":"c517caf5d47c9f1eba2ced6800dab03e2e29a130","modified":1522405000970},{"_id":"themes/next6.0.6/source/lib/three/.git/objects/89/b7ae569312ae577534d7b58647232fb48bfb08","hash":"a265c0a7e24267bd82d11a48f091d2241edc0080","modified":1522405001019},{"_id":"themes/next6.0.6/source/lib/three/.git/objects/d0/32ce3fe05be57b72cc925f86149497229cda13","hash":"59e5036e95b496852ad3b918eac2e4b28a5951f2","modified":1522405009061},{"_id":"themes/next6.0.6/source/lib/three/.git/objects/e5/6e96bd99ebe3f0dc8f02c979703c3666f6dd9e","hash":"b971fcaae8424ea1b507379afdcdff74359a1525","modified":1522405009078},{"_id":"themes/next6.0.6/source/lib/three/.git/objects/e0/52c7542703df4969a95779bd4dc58b568bcb5e","hash":"b1ccf1650011f74939f07233834bdff21baf4952","modified":1522405000994},{"_id":"themes/next6.0.6/source/lib/three/three.min.js","hash":"26273b1cb4914850a89529b48091dc584f2c57b8","modified":1522405009252},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/logs/refs/heads/master","hash":"5cd0d2bbd7705b7fa60b9f75293a7120b8ff39e0","modified":1522404599785},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1522404599774},{"_id":"themes/next6.0.6/source/lib/three/.git/logs/refs/heads/master","hash":"631d8a8826a02ea45f2ad0c421923dcc5a2a026a","modified":1522405009214},{"_id":"themes/next6.0.6/source/lib/three/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1522405009202},{"_id":"themes/next6.0.6/source/lib/three/.git/objects/76/310b5a7e93e66e7d98aaab2960d6354b2288c5","hash":"84de52193b47c83d01eb8800b063ccd83ad42cf9","modified":1522405008971},{"_id":"themes/next6.0.6/source/lib/three/.git/objects/67/6b9f6189356d0201fd72dd6f98db19628a2ff5","hash":"250795ea0af79524945e66b28f233eb8bd9ee7dd","modified":1522405001354},{"_id":"themes/next6.0.6/source/lib/three/.git/objects/3c/6fef4314903036253335d4550346f6b927c721","hash":"1ee4e7d110363dc5e2676b675c7f7030731cf3a5","modified":1522405001370},{"_id":"themes/next6.0.6/source/lib/canvas-nest/.git/logs/refs/remotes/origin/HEAD","hash":"5cd0d2bbd7705b7fa60b9f75293a7120b8ff39e0","modified":1522404599774},{"_id":"themes/next6.0.6/source/lib/three/.git/logs/refs/remotes/origin/HEAD","hash":"631d8a8826a02ea45f2ad0c421923dcc5a2a026a","modified":1522405009202},{"_id":"themes/next6.0.6/.git/objects/pack/pack-53a4cb8ca3e9cadcf85ed648ac1699da8fd526f8.pack","hash":"c070f8569370d2066741dd086b9b41409a8fb3c4","modified":1522404129297},{"_id":"themes/next6.0.6/source/lib/three/.git/objects/82/69b6fd29a514f9bd746497b298176228bd4061","hash":"cf527c08b5d88d72939a61446d128eba2fb94be2","modified":1522405001305},{"_id":"public/love.js","hash":"0635ad962e7d8c1f5cdf642eb258345e96ec0c1f","modified":1524546696443},{"_id":"public/photos/data.json","hash":"b7a0eb1bf07219c4b0e396441ba04303944234ed","modified":1524546696533},{"_id":"public/photos/lazyload.min.js","hash":"03df2519c36841cb63671939b7f7da5e19e09c4c","modified":1524546696533},{"_id":"public/mouse.js","hash":"2c9298bc87cb4ad8954b54a6199cdcef018b3e95","modified":1524546696533},{"_id":"public/photos/ins.js","hash":"e930ebef4425908b7fb9fdb67c654964c39bc28b","modified":1524546696533},{"_id":"public/photos/ins.css","hash":"7b9e679b2562efd3e9b47c8a566c2e7ac9ca3dd4","modified":1524546696533},{"_id":"public/baidusitemap.xml","hash":"305c9bd3bc46d160ab7990e8b57906dd6b0ac20a","modified":1524546696533},{"_id":"public/search.xml","hash":"1df354412e35bf89fd6034ea286467e34c9e8dff","modified":1524546696533},{"_id":"public/sitemap.xml","hash":"5cf0bdc9b48f57ad00e3fda12c3ab9f656576e0d","modified":1524546696533},{"_id":"public/about/index.html","hash":"ce5014e8b638dff1214648c39e046f9c5c6d825c","modified":1524546696596},{"_id":"public/categories/index.html","hash":"8c6ca7ec5563c91b19aa53445b0da8e481de89a8","modified":1524546696596},{"_id":"public/photos/index.html","hash":"654eb39404b57e22eae30ffebd6b0bed713c487c","modified":1524546696596},{"_id":"public/tags/index.html","hash":"f403f3575e8f0bde12ef3e2d493644f3a93449ff","modified":1524546696596},{"_id":"public/Java虚拟机：类加载器.html","hash":"5ebfd92370a942092fb49166446684d695ff5b40","modified":1524546696596},{"_id":"public/Java虚拟机：内存模型.html","hash":"4defc9f782da82354d41f0d5ddd8175d348fa471","modified":1524546696596},{"_id":"public/web-xml不同版本之间的差异.html","hash":"0c02b818cb3472ec565aaeaaeab94f60bbc00134","modified":1524546696596},{"_id":"public/Mysql事务的隔离级别.html","hash":"557a25f8d038c57b6f5d55322b70d055e50657e0","modified":1524546696596},{"_id":"public/Mysql索引的简单使用.html","hash":"c5e2f517fab6f13f3d225913252d9486a37e8f6b","modified":1524546696597},{"_id":"public/Mysql视图的简单使用.html","hash":"810d1411b2c7f24e09db423a3fc758904ed85d07","modified":1524546696597},{"_id":"public/NexT主题深度优化.html","hash":"f444e541bee76dd03f42a75b5c4e2c166d744748","modified":1524546696597},{"_id":"public/观察者模式.html","hash":"3eeb5fd42d97f0e4dbd01a63e8d0fe78d747c7ed","modified":1524546696597},{"_id":"public/什么是设计模式.html","hash":"f7464248eaa345c7a7b3c486230a6b06d4642f9d","modified":1524546696597},{"_id":"public/NM3000消息推送框架简介.html","hash":"296f149b14269fc736bad7194b6a81c6b5830e40","modified":1524546696597},{"_id":"public/NM3000告警框架简介.html","hash":"8241607af30cf90f2a000a6426f11f38870c310c","modified":1524546696597},{"_id":"public/二分查找.html","hash":"99684e1f39ab20d3a76217b0a926f9cc4ce1c7b0","modified":1524546696597},{"_id":"public/常见排序算法.html","hash":"db787ffaf055ee92337fdc4b4cd62609cc2a7f29","modified":1524546696597},{"_id":"public/Spring-MVC-4-——requestMapping及controller返回值.html","hash":"0c17000e3d8c1f5ac0ddaf4ded691693596a59a2","modified":1524546696597},{"_id":"public/Spring-MVC-3-——参数绑定.html","hash":"9e5261cb0e0d918bdebfd7b37aceda1602c4b17f","modified":1524546696597},{"_id":"public/Spring-MVC-2-——整合spring-mybatis.html","hash":"d513bb0b3ea1f4875f2745b586752f37cce0ca31","modified":1524546696597},{"_id":"public/Spring-MVC-1-——入门.html","hash":"b89829167f1afc1004d007a22ad120f4974fa078","modified":1524546696597},{"_id":"public/Mybatis-5-——与spring整合.html","hash":"f497b34cf3d2354c119e56a25d40ad487fc42951","modified":1524546696597},{"_id":"public/Mybatis-4-——Mapper-xml映射文件.html","hash":"0b07a0e24676b93b3a5e3382866cabcc85a5ef94","modified":1524546696598},{"_id":"public/Mybatis-3-——SqlMapConfig-xml文件详解.html","hash":"98cebe3af5f208b578935bf0383f7ab30efcee72","modified":1524546696598},{"_id":"public/Mybatis-2-——Dao层开发方法.html","hash":"0b9ff2a743bdbef906ad9252b562f4e0d39c6d5a","modified":1524546696598},{"_id":"public/Mysql触发器.html","hash":"f1fe1fca9b1ba8d596f193d587f884ae1fe83b39","modified":1524546696598},{"_id":"public/Mybatis-1-——入门.html","hash":"37b1381becd346fc1825c9b6f11fcb135aabae3f","modified":1524546696598},{"_id":"public/Struts2-6-——Struts标签、国际化、文件上传下载.html","hash":"835e1f632a073df7a2229064dc919f9e6278d1cf","modified":1524546696598},{"_id":"public/Struts2-5-——拦截器.html","hash":"0e667b86b90516512d6dd1c56f6e59e346fae2c1","modified":1524546696598},{"_id":"public/Struts2-3-——Action配置及访问方式.html","hash":"d5c1c9d4d860ef60dee42a177aa61e2e6ee1a449","modified":1524546696598},{"_id":"public/Struts2-4-——数据封装和类型转换.html","hash":"e1356681afc0bab847853f465e5d1ea852c72340","modified":1524546696598},{"_id":"public/Struts2-2-——搭建struts及spring整合Demo.html","hash":"3e9025c3eb53147f9aba9eaf21712d88fe5ade10","modified":1524546696598},{"_id":"public/Struts2-1-——基本认识.html","hash":"6d7896e21aa9c2ad593e06a9b7dc094e11e1cd19","modified":1524546696598},{"_id":"public/Java中读取properties.html","hash":"f6fc6e2600fd93099c583a585f99c85c7fe2a11f","modified":1524546696598},{"_id":"public/Activiti5-流程框架.html","hash":"99b9d0e1667e89c5d3af2b40cfc3de7044ce185d","modified":1524546696598},{"_id":"public/Callable及Future.html","hash":"7f96af235c03db7655b9648025d6029baad8b8a9","modified":1524546696598},{"_id":"public/Java线程池的创建.html","hash":"ee975e8192ab0e0a5be87a7a735e27d18641ff1c","modified":1524546696598},{"_id":"public/使用i18next完成前端国际化.html","hash":"021df2039cb9483f2a263b5ff05a892050a3dfcd","modified":1524546696599},{"_id":"public/多线程.html","hash":"48f4f3f19d44c5e053fef6d565122c30aa25b4c5","modified":1524546696599},{"_id":"public/使用jquery-i18n完成前端国际化.html","hash":"8c974c439cd0b0e6f5aee96ec054d119a7aa7295","modified":1524546696599},{"_id":"public/DCloud-离线打包之Android-Studio.html","hash":"67909f9250c87ab9c0519d880669588fb8d412bf","modified":1524546696599},{"_id":"public/Mysql存储过程.html","hash":"0b8e2862e55eca636fd2fe29cb490708dda857cd","modified":1524546696599},{"_id":"public/网站数据分析.html","hash":"1452ee13a2814f7d59701c6e54dddd78d51d8ea9","modified":1524546696599},{"_id":"public/spring-4-——持久层封装.html","hash":"1bfef03f7777034f526c32234f6c868a5d40c093","modified":1524546696599},{"_id":"public/spring-3——AOP浅析.html","hash":"cb0eb7109c56a57c47e84301b69996bbd9353c8a","modified":1524546696599},{"_id":"public/spring-2——IOC浅析.html","hash":"fda2b9f3a4b52add032c25c8d2356d0dec989263","modified":1524546696599},{"_id":"public/spring-1——框架简介.html","hash":"68b6ad06c6137f3d44749cb2ff2a5f21608fd6a6","modified":1524546696599},{"_id":"public/SNMP学习笔记(3)——snmp4j.html","hash":"a6fa3a0ed3d9f6d1b34cc946aaa85eb148d4d98c","modified":1524546696599},{"_id":"public/SNMP学习总结(2)——snmp安装和配置.html","hash":"fe249ecd17225418b73a46b999c9c82a788814af","modified":1524546696599},{"_id":"public/SNMP学习总结(1)——基本概念.html","hash":"faf11cafc9a4835e68fb2165f25fd723c09cf7b2","modified":1524546696599},{"_id":"public/html5-常用功能.html","hash":"4653c8c6dc4f0aaadde1c751140694c7ebcca210","modified":1524546696599},{"_id":"public/hexo+github搭建个人博客.html","hash":"3f14559d60275827166bcc86b5a7a2b682e5ff30","modified":1524546696600},{"_id":"public/基于MUI及Html5-开发app.html","hash":"154d1c05cc642ff3644ba75e247f8a0cfe198762","modified":1524546696600},{"_id":"public/archives/index.html","hash":"01d420ff3a91f1dea57dc3ae277a1339bd91ca83","modified":1524546696600},{"_id":"public/archives/page/2/index.html","hash":"d4295a2769b22e742b2625b6d40f41f866b13959","modified":1524546696600},{"_id":"public/archives/page/3/index.html","hash":"7f50ebbd43036e05697d365ba1e1c6c89ded8dcf","modified":1524546696600},{"_id":"public/archives/page/4/index.html","hash":"de6e189b390c24f3efe76d917eaa6d6499326101","modified":1524546696600},{"_id":"public/archives/page/5/index.html","hash":"4a36749f0faea16f2637890c10ebfe75f7329663","modified":1524546696600},{"_id":"public/archives/2017/index.html","hash":"2c27491cb875f58320491a90f18b6c20216050df","modified":1524546696600},{"_id":"public/archives/2017/page/2/index.html","hash":"1847ade427e233d73403589c63f469628595ecbc","modified":1524546696600},{"_id":"public/archives/2017/page/3/index.html","hash":"2384000a42f7305a0d8f18861368af94fd773104","modified":1524546696600},{"_id":"public/archives/2017/04/index.html","hash":"722336ddc0750e4e99030aad1705224878e4e55d","modified":1524546696600},{"_id":"public/archives/2017/05/index.html","hash":"34095319181cef6cf16177c7ae1bcabbd14900ac","modified":1524546696600},{"_id":"public/archives/2017/06/index.html","hash":"bd14725d72d2f95d63de444419425424b7c52d68","modified":1524546696600},{"_id":"public/archives/2017/07/index.html","hash":"ba35ad344d42facdbd504129f1be950da3ee3dfc","modified":1524546696600},{"_id":"public/archives/2017/08/index.html","hash":"ac0fe5ffa1dbdf1ada5b558e93eb3fc2c21db983","modified":1524546696601},{"_id":"public/archives/2017/09/index.html","hash":"271b3c2924d60d0868fe8fa0f63b5ef0cebead82","modified":1524546696601},{"_id":"public/archives/2017/10/index.html","hash":"ec0d459e85fb53f6a28b55cc1200cfcc72cd04d1","modified":1524546696601},{"_id":"public/archives/2017/11/index.html","hash":"f92a75f5f514bc33aeb220b3e0484990328ce0ad","modified":1524546696601},{"_id":"public/archives/2017/12/index.html","hash":"d10ca312e498920f781d960f274bb31e0b85a5a3","modified":1524546696601},{"_id":"public/archives/2018/index.html","hash":"bfdc256d956588fa1496ba1182fa1dd246620d39","modified":1524546696601},{"_id":"public/archives/2018/page/2/index.html","hash":"73bcd7dac65168fd5f33254453b3667c82ac0532","modified":1524546696601},{"_id":"public/archives/2018/page/3/index.html","hash":"7cccade1c0872d596b5f80c138ec4b5f55736910","modified":1524546696602},{"_id":"public/archives/2018/02/index.html","hash":"a086fcec7e85f4400735c5f71845336c549743c7","modified":1524546696602},{"_id":"public/archives/2018/03/index.html","hash":"177dad9084d746ccdff7be4093b6ba466d74b5ac","modified":1524546696603},{"_id":"public/archives/2018/03/page/2/index.html","hash":"c0c4f21c67f29640179c33bb6c089a6e4d57bda9","modified":1524546696603},{"_id":"public/archives/2018/04/index.html","hash":"df4646507b83dca64b6a55daaea55fb9b75f9913","modified":1524546696603},{"_id":"public/categories/JavaEE/index.html","hash":"4e01c96226c7fa462f261c571f37f4cf6b8f105a","modified":1524546696603},{"_id":"public/categories/DCloud/index.html","hash":"193d4b05ca5054abd1def1f997557a913dca866f","modified":1524546696603},{"_id":"public/categories/Java虚拟机/index.html","hash":"696187ec0db523e9416208d9ef4e19705a5d8adb","modified":1524546696603},{"_id":"public/categories/JavaSE/index.html","hash":"95eb74da75aa467bddf1b821fd70c4afbe6e143b","modified":1524546696603},{"_id":"public/categories/Spring/index.html","hash":"ec82a97d8142cee2f467a009da310a757ac15b50","modified":1524546696603},{"_id":"public/categories/Mybatis/index.html","hash":"5b8e203d89e08ec5516d137a81c328a66ad69729","modified":1524546696603},{"_id":"public/categories/Mysql/index.html","hash":"acffb52a98574a211802536c50477504e38bc8a7","modified":1524546696603},{"_id":"public/categories/NM3000/index.html","hash":"800907fbbd4c21d5248f571cd43fd370ef5296d9","modified":1524546696603},{"_id":"public/categories/Blog/index.html","hash":"818d206c9268321ca20c1589312ad01f6b2fb9a0","modified":1524546696603},{"_id":"public/categories/SNMP/index.html","hash":"fde762dd94d63b81328fe4c985c4346bfd29b1d3","modified":1524546696603},{"_id":"public/categories/Struts2/index.html","hash":"7872744ad225ffafc1949b9811e423eb913dd4b4","modified":1524546696604},{"_id":"public/categories/Web/index.html","hash":"00b04e8314bec1bc2e161d9ab1e2098061f5df5e","modified":1524546696604},{"_id":"public/categories/设计模式/index.html","hash":"61aeb9c50fc2fcfde12c7359a3d7a273b627799c","modified":1524546696604},{"_id":"public/categories/算法/index.html","hash":"2d0736ba7c13fbaae28aa4794f79b60f26fa44ad","modified":1524546696605},{"_id":"public/page/2/index.html","hash":"3614522d38f7c2ad286f711e24dd81f88856f89a","modified":1524546696605},{"_id":"public/index.html","hash":"a11505d8e6f04f0df808a3e52df56400b2c80523","modified":1524546696605},{"_id":"public/page/3/index.html","hash":"85c569032c69aa63383314b1b727b0be2032b71e","modified":1524546696605},{"_id":"public/page/4/index.html","hash":"3f2489c4e39cbb7c8b961b3ecaaf35dcaa2d2195","modified":1524546696605},{"_id":"public/page/5/index.html","hash":"7f3bc9b1148fe50282b91b128b0b6ea61302d5b0","modified":1524546696606},{"_id":"public/tags/activiti/index.html","hash":"573eff3b0761cf58fdc5d94633665bc85db3b365","modified":1524546696606},{"_id":"public/tags/MUI/index.html","hash":"bf037f2f27504aad19f5540c8fe6dac6341f6b18","modified":1524546696606},{"_id":"public/tags/Android-Studio/index.html","hash":"f537a6b9044866755de52d94903aa7d26b97df35","modified":1524546696606},{"_id":"public/tags/离线打包/index.html","hash":"de1c5691f81f71c2c0fd3a8d5fb2dafd55ba42a4","modified":1524546696606},{"_id":"public/tags/Java虚拟机/index.html","hash":"661ad1ea2f2191bb1e0b7ec1f40529e682a62a14","modified":1524546696607},{"_id":"public/tags/Java/index.html","hash":"46e1d8d6f1feb336f628f3efe0bf2ee45948d1dc","modified":1524546696607},{"_id":"public/tags/多线程/index.html","hash":"91fd5fdbc1401445e64c6dd08eefbec2c7b548a5","modified":1524546696607},{"_id":"public/tags/properties/index.html","hash":"a2a8e96a47314382fc09316f8916c0a8d5d7b866","modified":1524546696607},{"_id":"public/tags/Mybatis/index.html","hash":"bc4cf33bd1f01752bad56421e1c6d1511fa5c1eb","modified":1524546696607},{"_id":"public/tags/数据库/index.html","hash":"2f4f5a3e2287af8f09faceaf0caedb78c0f0118a","modified":1524546696607},{"_id":"public/tags/Mysql/index.html","hash":"046afb490f317913816d6d8d077ab430173dc7e8","modified":1524546696607},{"_id":"public/tags/NM3000/index.html","hash":"29b70016af4335f39d9bbf6f848264d43e1954a1","modified":1524546696608},{"_id":"public/tags/snmp/index.html","hash":"5e2d21b747f4c7e7deb614865f1eb840042bdab8","modified":1524546696608},{"_id":"public/tags/network/index.html","hash":"c5fac7bd007c9536af6adbc5f07afbb170235d17","modified":1524546696608},{"_id":"public/tags/SpringMVC/index.html","hash":"5e41c27a2271b9c4987d20404a4f44ad08399192","modified":1524546696608},{"_id":"public/tags/Blog/index.html","hash":"d2782a15a998c4a57f0256485cbf2f92147903d5","modified":1524546696608},{"_id":"public/tags/snmp4j/index.html","hash":"3ac3c0af594e1768c9707ee854b33f0cde2f39f6","modified":1524546696608},{"_id":"public/tags/Struts2/index.html","hash":"545655c46eb5ce7423543cc97e4b1325ea054669","modified":1524546696608},{"_id":"public/tags/html5/index.html","hash":"d07b9a4eb56a7eae5728f780a46c5506b42d4c3b","modified":1524546696608},{"_id":"public/tags/Spring/index.html","hash":"e92c87e95295d4374668366051db40488a7f8182","modified":1524546696608},{"_id":"public/tags/native-js/index.html","hash":"9f6e87f48cf7c874cc64031b70f8109403e1f08b","modified":1524546696608},{"_id":"public/tags/AOP/index.html","hash":"679d34a549b2c734d3e85df75d436cf86850c39e","modified":1524546696608},{"_id":"public/tags/IOC/index.html","hash":"9296474a2c38523d7e1cf5ee8da7c569e35e659d","modified":1524546696608},{"_id":"public/tags/Web/index.html","hash":"5f4fe42c0099bb14f452f267047e6cd8e2a1e5cc","modified":1524546696608},{"_id":"public/tags/国际化/index.html","hash":"a6d1ca5828eb1424dbade5b6d9e9852f7621a9c1","modified":1524546696608},{"_id":"public/tags/设计模式/index.html","hash":"8479b7ad12f2c22922cbed8dc89fb2532452a1a9","modified":1524546696608},{"_id":"public/tags/算法/index.html","hash":"4f42b03b887771c8df9e9a558b440399a2811f8b","modified":1524546696609},{"_id":"public/Statifile","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1524546696609},{"_id":"public/tags/数据收集/index.html","hash":"2d625e98fe092347aff640c19c7e16641cc6e924","modified":1524546696620},{"_id":"public/CNAME","hash":"65ef1589074b69572647141a699ff2abf8dba5f9","modified":1524546696620},{"_id":"public/robots.txt","hash":"9c706d4bbe87232a9af3eaea392cae97eb320517","modified":1524546696620},{"_id":"public/images/favicon.ico","hash":"75b675529611ce5e08b868af7d616100da70dad8","modified":1524546696620},{"_id":"public/images/alipay-reward-image.jpg","hash":"ae2001a613364643005e9798c5a7bf2a13bd2066","modified":1524546696620},{"_id":"public/images/blog/step2.png","hash":"4797f5bd95528679a1cdd46593fb6e32309ca5b6","modified":1524546696620},{"_id":"public/images/blog/newRepository.png","hash":"91e0c5fb0b354385812a50da67605398a3c056a7","modified":1524546696620},{"_id":"public/images/blog/step3.png","hash":"b897b0e3f5a40af76c4e9f04fcb53ccee15b5daa","modified":1524546696620},{"_id":"public/images/algolia_logo.svg","hash":"45eeea0b5fba833e21e38ea10ed5ab385ceb4f01","modified":1524546696620},{"_id":"public/images/cc-by-nc-sa.svg","hash":"6f55543d1fb9cbc436c101d24f802dec7b41efc3","modified":1524546696620},{"_id":"public/images/cc-by-nc.svg","hash":"6f076713fb9bf934aa2c1046bdf2cf2e37bc1eab","modified":1524546696620},{"_id":"public/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1524546696620},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1524546696620},{"_id":"public/images/cc-by-nc-nd.svg","hash":"bc3588c9b2d7c68830524783120ff6cf957cf668","modified":1524546696620},{"_id":"public/images/cc-zero.svg","hash":"9bfb52b2f63527a7049247bf00d44e6dc1170e7d","modified":1524546696620},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1524546696620},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1524546696620},{"_id":"public/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1524546696620},{"_id":"public/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1524546696620},{"_id":"public/images/logo.svg","hash":"169f56fd82941591dad3abd734a50ec7259be950","modified":1524546696620},{"_id":"public/images/cc-by-nd.svg","hash":"42cd73da328077ccc92f859bb8f3cf621b3484f8","modified":1524546696620},{"_id":"public/images/cc-by-sa.svg","hash":"70c1535f43e54e5ff35ca81419e77e4c0c301398","modified":1524546696621},{"_id":"public/images/cc-by.svg","hash":"e92a33c32d1dac8ed94849b2b4e6456e887efe70","modified":1524546696621},{"_id":"public/images/quote-l.svg","hash":"cd108d6f44351cadf8e6742565217f88818a0458","modified":1524546696621},{"_id":"public/images/quote-r.svg","hash":"2a2a250b32a87c69dcc1b1976c74b747bedbfb41","modified":1524546696621},{"_id":"public/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1524546696621},{"_id":"public/lib/canvas-nest/LICENSE","hash":"336611e76f0638d3d8aeca6b1b97138d2a07523f","modified":1524546696621},{"_id":"public/lib/font-awesome/HELP-US-OUT.txt","hash":"ee33b2798b1e714b904d663436c6b3521011d1fa","modified":1524546696621},{"_id":"public/lib/three/LICENSE","hash":"336611e76f0638d3d8aeca6b1b97138d2a07523f","modified":1524546696621},{"_id":"public/lib/font-awesome/css/font-awesome.css.map","hash":"1573904b82807abbb32c97a3632c6c6808eaac50","modified":1524546696621},{"_id":"public/images/wechat-reward-image.jpg","hash":"4532622ab5a752b82d00b96dca3bd3239f0ac30a","modified":1524546698016},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1524546698017},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1524546698023},{"_id":"public/lib/canvas-nest/README.html","hash":"9bb29b415d0859e097fdfcc6689b235c0e699224","modified":1524546698033},{"_id":"public/lib/canvas-nest/canvas-nest.min.js","hash":"0387e75e23b1db108a755073fe52a0d03eb391a7","modified":1524546698033},{"_id":"public/js/src/algolia-search.js","hash":"b172f697ed339a24b1e80261075232978d164c35","modified":1524546698033},{"_id":"public/js/src/affix.js","hash":"978e0422b5bf1b560236d8d10ebc1adcf66392e3","modified":1524546698033},{"_id":"public/js/src/post-details.js","hash":"d1333fb588d4521b4d1e9c69aef06e0ad1bf0b12","modified":1524546698033},{"_id":"public/js/src/exturl.js","hash":"e42e2aaab7bf4c19a0c8e779140e079c6aa5c0b1","modified":1524546698033},{"_id":"public/js/src/bootstrap.js","hash":"531cdedd7fbe8cb1dab2e4328774a9f6b15b59da","modified":1524546698033},{"_id":"public/js/src/scroll-cookie.js","hash":"09dc828cbf5f31158ff6250d2bf7c3cde6365c67","modified":1524546698033},{"_id":"public/js/src/motion.js","hash":"50e57f8acb6924c6999cdcc664ddd3f0730d2061","modified":1524546698033},{"_id":"public/js/src/utils.js","hash":"9543f124adba1f6e3c93d61f85e3e6f74ed5fff4","modified":1524546698033},{"_id":"public/js/src/scrollspy.js","hash":"fe4da1b9fe73518226446f5f27d2831e4426fc35","modified":1524546698034},{"_id":"public/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1524546698034},{"_id":"public/lib/font-awesome/bower.json","hash":"64394a2a9aa00f8e321d8daa5e51a420f0e96dad","modified":1524546698034},{"_id":"public/lib/three/README.html","hash":"b9ead5e5ec2847bc3ae33c34e5d1a2c39dd747e9","modified":1524546698034},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1524546698034},{"_id":"public/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1524546698034},{"_id":"public/js/src/schemes/pisces.js","hash":"8050a5b2683d1d77238c5762b6bd89c543daed6e","modified":1524546698034},{"_id":"public/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1524546698034},{"_id":"public/css/main.css","hash":"390a9476ddde53f24c8bcf5a8b14da8a3b351532","modified":1524546698034},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1524546698034},{"_id":"public/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1524546698034},{"_id":"public/lib/three/canvas_lines.min.js","hash":"dce4a3b65f8bf958f973690caa7ec4952f353b0c","modified":1524546698034},{"_id":"public/lib/three/canvas_sphere.min.js","hash":"d8ea241a53c135a650f7335d2b6982b899fd58a9","modified":1524546698034},{"_id":"public/lib/three/three-waves.min.js","hash":"d968cba6b3a50b3626a02d67b544f349d83b147c","modified":1524546698034},{"_id":"public/lib/font-awesome/css/font-awesome.css","hash":"0140952c64e3f2b74ef64e050f2fe86eab6624c8","modified":1524546698034},{"_id":"public/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1524546698034},{"_id":"public/lib/font-awesome/css/font-awesome.min.css","hash":"512c7d79033e3028a9be61b540cf1a6870c896f8","modified":1524546698034},{"_id":"public/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1524546698034},{"_id":"public/lib/three/three.min.js","hash":"73f4cdc17e51a72b9bf5b9291f65386d615c483b","modified":1524546698034},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1524546698034},{"_id":"public/images/avatar.png","hash":"62c2087587b79b3929a4570195e7137c9962a446","modified":1524546698036}],"Category":[{"name":"JavaEE","_id":"cjgd7qfib0003hwvf33e2tlso"},{"name":"DCloud","_id":"cjgd7qfkp0009hwvftp7d0jcd"},{"name":"Java虚拟机","_id":"cjgd7qfky000dhwvfh2vc4trr"},{"name":"JavaSE","_id":"cjgd7qfl2000ihwvfzj8j1oru"},{"name":"Spring","_id":"cjgd7qfso0011hwvfipahmc88"},{"name":"Mybatis","_id":"cjgd7qft10018hwvf16lfwma8"},{"name":"Mysql","_id":"cjgd7qftv0023hwvfcfz7c17q"},{"name":"NM3000","_id":"cjgd7qfue002mhwvfpwjbk0ol"},{"name":"SNMP","_id":"cjgd7qfux0039hwvfdnszvedu"},{"name":"Blog","_id":"cjgd7qfvc003phwvfr204thm6"},{"name":"Struts2","_id":"cjgd7qfvo0043hwvftmfehbwg"},{"name":"Web","_id":"cjgd7qfwo005ahwvfvt8xo6li"},{"name":"设计模式","_id":"cjgd7qfwq005jhwvflo3loc70"},{"name":"算法","_id":"cjgd7qfwt005nhwvfbjxedmn3"}],"Data":[{"_id":"next","data":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}],"Page":[{"_content":"! function(e, t, a) {\n    function n() {\n        c(\".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}\"), o(), r()\n    }\n\n    function r() {\n        for(var e = 0; e < d.length; e++) d[e].alpha <= 0 ? (t.body.removeChild(d[e].el), d.splice(e, 1)) : (d[e].y--, d[e].scale += .004, d[e].alpha -= .013, d[e].el.style.cssText = \"left:\" + d[e].x + \"px;top:\" + d[e].y + \"px;opacity:\" + d[e].alpha + \";transform:scale(\" + d[e].scale + \",\" + d[e].scale + \") rotate(45deg);background:\" + d[e].color + \";z-index:99999\");\n        requestAnimationFrame(r)\n    }\n\n    function o() {\n        var t = \"function\" == typeof e.onclick && e.onclick;\n        e.onclick = function(e) {\n            t && t(), i(e)\n        }\n    }\n\n    function i(e) {\n        var a = t.createElement(\"div\");\n        a.className = \"heart\", d.push({\n            el: a,\n            x: e.clientX - 5,\n            y: e.clientY - 5,\n            scale: 1,\n            alpha: 1,\n            color: s()\n        }), t.body.appendChild(a)\n    }\n\n    function c(e) {\n        var a = t.createElement(\"style\");\n        a.type = \"text/css\";\n        try {\n            a.appendChild(t.createTextNode(e))\n        } catch(t) {\n            a.styleSheet.cssText = e\n        }\n        t.getElementsByTagName(\"head\")[0].appendChild(a)\n    }\n\n    function s() {\n        return \"rgb(\" + ~~(255 * Math.random()) + \",\" + ~~(255 * Math.random()) + \",\" + ~~(255 * Math.random()) + \")\"\n    }\n    var d = [];\n    e.requestAnimationFrame = function() {\n        return e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function(e) {\n            setTimeout(e, 1e3 / 60)\n        }\n    }(), n()\n}(window, document);","source":"love.js","raw":"! function(e, t, a) {\n    function n() {\n        c(\".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}\"), o(), r()\n    }\n\n    function r() {\n        for(var e = 0; e < d.length; e++) d[e].alpha <= 0 ? (t.body.removeChild(d[e].el), d.splice(e, 1)) : (d[e].y--, d[e].scale += .004, d[e].alpha -= .013, d[e].el.style.cssText = \"left:\" + d[e].x + \"px;top:\" + d[e].y + \"px;opacity:\" + d[e].alpha + \";transform:scale(\" + d[e].scale + \",\" + d[e].scale + \") rotate(45deg);background:\" + d[e].color + \";z-index:99999\");\n        requestAnimationFrame(r)\n    }\n\n    function o() {\n        var t = \"function\" == typeof e.onclick && e.onclick;\n        e.onclick = function(e) {\n            t && t(), i(e)\n        }\n    }\n\n    function i(e) {\n        var a = t.createElement(\"div\");\n        a.className = \"heart\", d.push({\n            el: a,\n            x: e.clientX - 5,\n            y: e.clientY - 5,\n            scale: 1,\n            alpha: 1,\n            color: s()\n        }), t.body.appendChild(a)\n    }\n\n    function c(e) {\n        var a = t.createElement(\"style\");\n        a.type = \"text/css\";\n        try {\n            a.appendChild(t.createTextNode(e))\n        } catch(t) {\n            a.styleSheet.cssText = e\n        }\n        t.getElementsByTagName(\"head\")[0].appendChild(a)\n    }\n\n    function s() {\n        return \"rgb(\" + ~~(255 * Math.random()) + \",\" + ~~(255 * Math.random()) + \",\" + ~~(255 * Math.random()) + \")\"\n    }\n    var d = [];\n    e.requestAnimationFrame = function() {\n        return e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function(e) {\n            setTimeout(e, 1e3 / 60)\n        }\n    }(), n()\n}(window, document);","date":"2018-03-30T06:59:49.792Z","updated":"2018-03-30T06:59:49.778Z","path":"love.js","layout":"false","title":"","comments":1,"_id":"cjgd7qfdo0000hwvf7kvpe8cn","content":"! function(e, t, a) {\n    function n() {\n        c(\".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}\"), o(), r()\n    }\n\n    function r() {\n        for(var e = 0; e < d.length; e++) d[e].alpha ","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"","more":"! function(e, t, a) {\n    function n() {\n        c(\".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}\"), o(), r()\n    }\n\n    function r() {\n        for(var e = 0; e < d.length; e++) d[e].alpha "},{"_content":"/* 鼠标特效 */\nvar a_idx = 0;\njQuery(document).ready(function($) {\n   $(\"body\").click(function(e) {\n       var a = new Array(\"富强\", \"民主\", \"文明\", \"和谐\", \"自由\", \"平等\", \"公正\" ,\"法治\", \"爱国\", \"敬业\", \"诚信\", \"友善\");\n       var $i = $(\"<span/>\").text(a[a_idx]);\n       a_idx = (a_idx + 1) % a.length;\n       var x = e.pageX,\n       y = e.pageY;\n       $i.css({\n           \"z-index\": 999999999999999999999999999999999999999999999999999999999999999999999,\n           \"top\": y - 20,\n           \"left\": x,\n           \"position\": \"absolute\",\n           \"font-weight\": \"bold\",\n           \"color\": \"#ff6651\"\n       });\n       $(\"body\").append($i);\n       $i.animate({\n           \"top\": y - 180,\n           \"opacity\": 0\n       },\n       1500,\n       function() {\n           $i.remove();\n       });\n   });\n});","source":"mouse.js","raw":"/* 鼠标特效 */\nvar a_idx = 0;\njQuery(document).ready(function($) {\n   $(\"body\").click(function(e) {\n       var a = new Array(\"富强\", \"民主\", \"文明\", \"和谐\", \"自由\", \"平等\", \"公正\" ,\"法治\", \"爱国\", \"敬业\", \"诚信\", \"友善\");\n       var $i = $(\"<span/>\").text(a[a_idx]);\n       a_idx = (a_idx + 1) % a.length;\n       var x = e.pageX,\n       y = e.pageY;\n       $i.css({\n           \"z-index\": 999999999999999999999999999999999999999999999999999999999999999999999,\n           \"top\": y - 20,\n           \"left\": x,\n           \"position\": \"absolute\",\n           \"font-weight\": \"bold\",\n           \"color\": \"#ff6651\"\n       });\n       $(\"body\").append($i);\n       $i.animate({\n           \"top\": y - 180,\n           \"opacity\": 0\n       },\n       1500,\n       function() {\n           $i.remove();\n       });\n   });\n});","date":"2018-03-30T06:58:50.881Z","updated":"2018-03-06T07:06:28.439Z","path":"mouse.js","layout":"false","title":"","comments":1,"_id":"cjgd7qfdr0001hwvf9o1uu4lj","content":"/* 鼠标特效 */\nvar a_idx = 0;\njQuery(document).ready(function($) {\n   $(\"body\").click(function(e) {\n       var a = new Array(\"富强\", \"民主\", \"文明\", \"和谐\", \"自由\", \"平等\", \"公正\" ,\"法治\", \"爱国\", \"敬业\", \"诚信\", \"友善\");\n       var $i = $(\"<span>\").text(a[a_idx]);\n       a_idx = (a_idx + 1) % a.length;\n       var x = e.pageX,\n       y = e.pageY;\n       $i.css({\n           \"z-index\": 999999999999999999999999999999999999999999999999999999999999999999999,\n           \"top\": y - 20,\n           \"left\": x,\n           \"position\": \"absolute\",\n           \"font-weight\": \"bold\",\n           \"color\": \"#ff6651\"\n       });\n       $(\"body\").append($i);\n       $i.animate({\n           \"top\": y - 180,\n           \"opacity\": 0\n       },\n       1500,\n       function() {\n           $i.remove();\n       });\n   });\n});</span>","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"","more":"/* 鼠标特效 */\nvar a_idx = 0;\njQuery(document).ready(function($) {\n   $(\"body\").click(function(e) {\n       var a = new Array(\"富强\", \"民主\", \"文明\", \"和谐\", \"自由\", \"平等\", \"公正\" ,\"法治\", \"爱国\", \"敬业\", \"诚信\", \"友善\");\n       var $i = $(\"<span>\").text(a[a_idx]);\n       a_idx = (a_idx + 1) % a.length;\n       var x = e.pageX,\n       y = e.pageY;\n       $i.css({\n           \"z-index\": 999999999999999999999999999999999999999999999999999999999999999999999,\n           \"top\": y - 20,\n           \"left\": x,\n           \"position\": \"absolute\",\n           \"font-weight\": \"bold\",\n           \"color\": \"#ff6651\"\n       });\n       $(\"body\").append($i);\n       $i.animate({\n           \"top\": y - 180,\n           \"opacity\": 0\n       },\n       1500,\n       function() {\n           $i.remove();\n       });\n   });\n});</span>"},{"title":"简介","date":"2017-04-28T07:16:02.000Z","comments":0,"_content":"2016年毕业于武汉理工大学，现就职于武汉鼎点视讯科技有限公司\n\n喜欢旅游、冒险，追逐那为之悸动的一景、一情、一人\n\nQQ:785554043\nwechat：13638665425\n\n恩施大峡谷穿越\n库不齐沙漠穿越\n重庆、成都、西岭雪山\n长沙\n宜昌\n青岛、济南\n哈尔滨、雪乡、亚布力\n南宁、北海、涠洲岛\n深圳、香港、澳门、珠海\n厦门\n三亚\n泰国（曼谷、普及、清迈）\n马来西亚、仙本那、马步岛\n九江、庐山","source":"about/index.md","raw":"---\ntitle: 简介\ndate: 2017-04-28 15:16:02\ncomments: false\n---\n2016年毕业于武汉理工大学，现就职于武汉鼎点视讯科技有限公司\n\n喜欢旅游、冒险，追逐那为之悸动的一景、一情、一人\n\nQQ:785554043\nwechat：13638665425\n\n恩施大峡谷穿越\n库不齐沙漠穿越\n重庆、成都、西岭雪山\n长沙\n宜昌\n青岛、济南\n哈尔滨、雪乡、亚布力\n南宁、北海、涠洲岛\n深圳、香港、澳门、珠海\n厦门\n三亚\n泰国（曼谷、普及、清迈）\n马来西亚、仙本那、马步岛\n九江、庐山","updated":"2018-04-24T05:10:48.485Z","path":"about/index.html","layout":"page","_id":"cjgd7qfsj000yhwvfauw0vunf","content":"<p>2016年毕业于武汉理工大学，现就职于武汉鼎点视讯科技有限公司</p>\n<p>喜欢旅游、冒险，追逐那为之悸动的一景、一情、一人</p>\n<p>QQ:785554043<br>wechat：13638665425</p>\n<p>恩施大峡谷穿越<br>库不齐沙漠穿越<br>重庆、成都、西岭雪山<br>长沙<br>宜昌<br>青岛、济南<br>哈尔滨、雪乡、亚布力<br>南宁、北海、涠洲岛<br>深圳、香港、澳门、珠海<br>厦门<br>三亚<br>泰国（曼谷、普及、清迈）<br>马来西亚、仙本那、马步岛<br>九江、庐山</p>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"","more":"<p>2016年毕业于武汉理工大学，现就职于武汉鼎点视讯科技有限公司</p>\n<p>喜欢旅游、冒险，追逐那为之悸动的一景、一情、一人</p>\n<p>QQ:785554043<br>wechat：13638665425</p>\n<p>恩施大峡谷穿越<br>库不齐沙漠穿越<br>重庆、成都、西岭雪山<br>长沙<br>宜昌<br>青岛、济南<br>哈尔滨、雪乡、亚布力<br>南宁、北海、涠洲岛<br>深圳、香港、澳门、珠海<br>厦门<br>三亚<br>泰国（曼谷、普及、清迈）<br>马来西亚、仙本那、马步岛<br>九江、庐山</p>\n"},{"title":"分类","date":"2017-04-27T11:13:22.000Z","type":"categories","comments":0,"_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2017-04-27 19:13:22\ntype: \"categories\"\ncomments: false\n---\n","updated":"2018-02-27T07:38:38.108Z","path":"categories/index.html","layout":"page","_id":"cjgd7qfsn0010hwvf5uue5pac","content":"","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"","more":""},{"_content":"{\"list\": [{\"arr\": {\"link\": [\"2017-03-01_\\u4e09\\u5206\\u5f52\\u664b.jpg\", \"2017-03-01_\\u5c81\\u6708\\u795e\\u5077.jpg\"], \"text\": [\"\\u4e09\\u5206\\u5f52\\u664b\", \"\\u5c81\\u6708\\u795e\\u5077\"], \"month\": 3, \"type\": [\"image\", \"image\"], \"year\": 2017}, \"date\": \"2017-03\"}, {\"arr\": {\"link\": [\"2017-01-01_2017\\u65b0\\u5e74 (2).jpg\", \"2017-01-01_2017\\u65b0\\u5e74 (3).jpg\", \"2017-01-01_2017\\u65b0\\u5e74 (4).jpg\", \"2017-01-01_2017\\u65b0\\u5e74.jpg\", \"2017-01-01_\\u9ec4\\u660f.jpg\"], \"text\": [\"2017\\u65b0\\u5e74 (2)\", \"2017\\u65b0\\u5e74 (3)\", \"2017\\u65b0\\u5e74 (4)\", \"2017\\u65b0\\u5e74\", \"\\u9ec4\\u660f\"], \"month\": 1, \"type\": [\"image\", \"image\", \"image\", \"image\", \"image\"], \"year\": 2017}, \"date\": \"2017-01\"}, {\"arr\": {\"link\": [\"2016-11-03_\\u5915\\u9633\\u65e0\\u9650\\u597d\\uff0c\\u53ea\\u662f\\u8fd1\\u9ec4\\u660f.jpg\"], \"text\": [\"\\u5915\\u9633\\u65e0\\u9650\\u597d\\uff0c\\u53ea\\u662f\\u8fd1\\u9ec4\\u660f\"], \"month\": 11, \"type\": [\"image\"], \"year\": 2016}, \"date\": \"2016-11\"}, {\"arr\": {\"link\": [\"2016-05-01_\\u4e16\\u535a\\u9986.PNG\", \"2016-05-01_\\u5356\\u4e66\\u5566\\uff01.jpg\", \"2016-05-01_\\u6211\\u7684\\u75d5\\u8ff9.jpg\", \"2016-05-01_\\u6f02\\u4eae--\\u4e2d\\u56fd\\u9986.JPG\", \"2016-05-01_\\u6f02\\u4eae.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u805a\\u9910-1.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u805a\\u9910-\\u5b54\\u660e\\u706f-1.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u805a\\u9910-\\u5b54\\u660e\\u706f-2.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u9732\\u8425-1.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u9732\\u8425-2.JPG\", \"2016-05-01_\\u73ed\\u7ea7\\u9732\\u8425-\\u70e7\\u70e4-1.jpg\", \"2016-05-01_\\u770b\\uff0c\\u86c7\\uff01.jpg\", \"2016-05-01_\\u968f\\u540e\\u62cd2.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u805a\\u9910\\u770b\\u7535\\u5f71\\u56de\\u6765-2-24\\u665a.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u901a\\u5bb5--\\u8fd8\\u5728\\u6539\\u8bba\\u6587.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u901a\\u5bb5-ktv.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u901a\\u5bb5-\\u7f51\\u5427.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u95f2\\u901b.jpg\"], \"text\": [\"\\u4e16\\u535a\\u9986\", \"\\u5356\\u4e66\\u5566\\uff01\", \"\\u6211\\u7684\\u75d5\\u8ff9\", \"\\u6f02\\u4eae--\\u4e2d\\u56fd\\u9986\", \"\\u6f02\\u4eae\", \"\\u73ed\\u7ea7\\u805a\\u9910-1\", \"\\u73ed\\u7ea7\\u805a\\u9910-\\u5b54\\u660e\\u706f-1\", \"\\u73ed\\u7ea7\\u805a\\u9910-\\u5b54\\u660e\\u706f-2\", \"\\u73ed\\u7ea7\\u9732\\u8425-1\", \"\\u73ed\\u7ea7\\u9732\\u8425-2\", \"\\u73ed\\u7ea7\\u9732\\u8425-\\u70e7\\u70e4-1\", \"\\u770b\\uff0c\\u86c7\\uff01\", \"\\u968f\\u540e\\u62cd2\", \"\\u6700\\u540e\\u7684\\u805a\\u9910\\u770b\\u7535\\u5f71\\u56de\\u6765-2-24\\u665a\", \"\\u6700\\u540e\\u7684\\u901a\\u5bb5--\\u8fd8\\u5728\\u6539\\u8bba\\u6587\", \"\\u6700\\u540e\\u7684\\u901a\\u5bb5-ktv\", \"\\u6700\\u540e\\u7684\\u901a\\u5bb5-\\u7f51\\u5427\", \"\\u6700\\u540e\\u7684\\u95f2\\u901b\"], \"month\": 5, \"type\": [\"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\"], \"year\": 2016}, \"date\": \"2016-05\"}, {\"arr\": {\"link\": [\"2016-04-01_\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-1.jpg\", \"2016-04-01_\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-2.jpg\", \"2016-04-01_\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-3.jpg\", \"2016-04-03_\\u6700\\u540e\\u4e00\\u6b21\\u5347\\u65d7\\u4eea\\u5f0f.jpg\"], \"text\": [\"\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-1\", \"\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-2\", \"\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-3\", \"\\u6700\\u540e\\u4e00\\u6b21\\u5347\\u65d7\\u4eea\\u5f0f\"], \"month\": 4, \"type\": [\"image\", \"image\", \"image\", \"image\"], \"year\": 2016}, \"date\": \"2016-04\"}, {\"arr\": {\"link\": [\"2015-12-01_beautiful\\uff01\\uff01.JPG\"], \"text\": [\"beautiful\\uff01\\uff01\"], \"month\": 12, \"type\": [\"image\"], \"year\": 2015}, \"date\": \"2015-12\"}, {\"arr\": {\"link\": [\"2015-10-01_five floor.jpg\", \"2015-10-01_\\u4e2d\\u79cb--.jpg\", \"2015-10-01_\\u54c8\\u54c8.jpg\", \"2015-10-01_\\u54c8\\u54c82.jpg\", \"2015-10-01_\\u9633\\u5149\\u6b63\\u597d.jpg\", \"2015-10-01_\\u9752\\u6625\\u653e\\u6b4c.jpg\"], \"text\": [\"five floor\", \"\\u4e2d\\u79cb--\", \"\\u54c8\\u54c8\", \"\\u54c8\\u54c82\", \"\\u9633\\u5149\\u6b63\\u597d\", \"\\u9752\\u6625\\u653e\\u6b4c\"], \"month\": 10, \"type\": [\"image\", \"image\", \"image\", \"image\", \"image\", \"image\"], \"year\": 2015}, \"date\": \"2015-10\"}, {\"arr\": {\"link\": [\"2015-05-01_\\u4f53\\u80b2\\u9986\\u4e0a.JPG\", \"2015-05-01_\\u5145\\u5b9e\\u7684\\u4e00\\u5929--\\u4e03\\u591501.jpg\", \"2015-05-01_\\u518d\\u6765\\u4e00\\u6b21\\u56fe\\u4e66\\u9986-1.jpg\", \"2015-05-01_\\u518d\\u6765\\u4e00\\u6b21\\u56fe\\u4e66\\u9986-2.jpg\", \"2015-05-01_\\u53cd\\u6b63\\u4e0d\\u662f\\u6211\\u8d34\\u7684.jpg\", \"2015-05-01_\\u591a\\u56fe.JPG\", \"2015-05-01_\\u5929\\u6c14\\u4e0d\\u9519--\\u6691\\u5047\\u7559\\u6821\\u671f\\u95f4.JPG\", \"2015-05-01_\\u5b66\\u4f4d\\u6388\\u4e88-1.jpg\", \"2015-05-01_\\u5bbf\\u820d\\u805a\\u9910-1.jpg\", \"2015-05-01_\\u62bd\\u5956\\u4e2d\\u7684\\u2014\\u2014\\u4f4e\\u8c03.jpg\", \"2015-05-01_\\u6f02\\u917f.jpg\", \"2015-05-01_\\u7ae5\\u5e74.jpg\", \"2015-05-01_\\u968f\\u610f\\u62cd.jpg\", \"2015-05-01_\\u968f\\u624b\\u62cd3.jpg\"], \"text\": [\"\\u4f53\\u80b2\\u9986\\u4e0a\", \"\\u5145\\u5b9e\\u7684\\u4e00\\u5929--\\u4e03\\u591501\", \"\\u518d\\u6765\\u4e00\\u6b21\\u56fe\\u4e66\\u9986-1\", \"\\u518d\\u6765\\u4e00\\u6b21\\u56fe\\u4e66\\u9986-2\", \"\\u53cd\\u6b63\\u4e0d\\u662f\\u6211\\u8d34\\u7684\", \"\\u591a\\u56fe\", \"\\u5929\\u6c14\\u4e0d\\u9519--\\u6691\\u5047\\u7559\\u6821\\u671f\\u95f4\", \"\\u5b66\\u4f4d\\u6388\\u4e88-1\", \"\\u5bbf\\u820d\\u805a\\u9910-1\", \"\\u62bd\\u5956\\u4e2d\\u7684\\u2014\\u2014\\u4f4e\\u8c03\", \"\\u6f02\\u917f\", \"\\u7ae5\\u5e74\", \"\\u968f\\u610f\\u62cd\", \"\\u968f\\u624b\\u62cd3\"], \"month\": 5, \"type\": [\"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\"], \"year\": 2015}, \"date\": \"2015-05\"}]}","source":"photos/data.json","raw":"{\"list\": [{\"arr\": {\"link\": [\"2017-03-01_\\u4e09\\u5206\\u5f52\\u664b.jpg\", \"2017-03-01_\\u5c81\\u6708\\u795e\\u5077.jpg\"], \"text\": [\"\\u4e09\\u5206\\u5f52\\u664b\", \"\\u5c81\\u6708\\u795e\\u5077\"], \"month\": 3, \"type\": [\"image\", \"image\"], \"year\": 2017}, \"date\": \"2017-03\"}, {\"arr\": {\"link\": [\"2017-01-01_2017\\u65b0\\u5e74 (2).jpg\", \"2017-01-01_2017\\u65b0\\u5e74 (3).jpg\", \"2017-01-01_2017\\u65b0\\u5e74 (4).jpg\", \"2017-01-01_2017\\u65b0\\u5e74.jpg\", \"2017-01-01_\\u9ec4\\u660f.jpg\"], \"text\": [\"2017\\u65b0\\u5e74 (2)\", \"2017\\u65b0\\u5e74 (3)\", \"2017\\u65b0\\u5e74 (4)\", \"2017\\u65b0\\u5e74\", \"\\u9ec4\\u660f\"], \"month\": 1, \"type\": [\"image\", \"image\", \"image\", \"image\", \"image\"], \"year\": 2017}, \"date\": \"2017-01\"}, {\"arr\": {\"link\": [\"2016-11-03_\\u5915\\u9633\\u65e0\\u9650\\u597d\\uff0c\\u53ea\\u662f\\u8fd1\\u9ec4\\u660f.jpg\"], \"text\": [\"\\u5915\\u9633\\u65e0\\u9650\\u597d\\uff0c\\u53ea\\u662f\\u8fd1\\u9ec4\\u660f\"], \"month\": 11, \"type\": [\"image\"], \"year\": 2016}, \"date\": \"2016-11\"}, {\"arr\": {\"link\": [\"2016-05-01_\\u4e16\\u535a\\u9986.PNG\", \"2016-05-01_\\u5356\\u4e66\\u5566\\uff01.jpg\", \"2016-05-01_\\u6211\\u7684\\u75d5\\u8ff9.jpg\", \"2016-05-01_\\u6f02\\u4eae--\\u4e2d\\u56fd\\u9986.JPG\", \"2016-05-01_\\u6f02\\u4eae.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u805a\\u9910-1.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u805a\\u9910-\\u5b54\\u660e\\u706f-1.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u805a\\u9910-\\u5b54\\u660e\\u706f-2.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u9732\\u8425-1.jpg\", \"2016-05-01_\\u73ed\\u7ea7\\u9732\\u8425-2.JPG\", \"2016-05-01_\\u73ed\\u7ea7\\u9732\\u8425-\\u70e7\\u70e4-1.jpg\", \"2016-05-01_\\u770b\\uff0c\\u86c7\\uff01.jpg\", \"2016-05-01_\\u968f\\u540e\\u62cd2.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u805a\\u9910\\u770b\\u7535\\u5f71\\u56de\\u6765-2-24\\u665a.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u901a\\u5bb5--\\u8fd8\\u5728\\u6539\\u8bba\\u6587.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u901a\\u5bb5-ktv.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u901a\\u5bb5-\\u7f51\\u5427.jpg\", \"2016-05-10_\\u6700\\u540e\\u7684\\u95f2\\u901b.jpg\"], \"text\": [\"\\u4e16\\u535a\\u9986\", \"\\u5356\\u4e66\\u5566\\uff01\", \"\\u6211\\u7684\\u75d5\\u8ff9\", \"\\u6f02\\u4eae--\\u4e2d\\u56fd\\u9986\", \"\\u6f02\\u4eae\", \"\\u73ed\\u7ea7\\u805a\\u9910-1\", \"\\u73ed\\u7ea7\\u805a\\u9910-\\u5b54\\u660e\\u706f-1\", \"\\u73ed\\u7ea7\\u805a\\u9910-\\u5b54\\u660e\\u706f-2\", \"\\u73ed\\u7ea7\\u9732\\u8425-1\", \"\\u73ed\\u7ea7\\u9732\\u8425-2\", \"\\u73ed\\u7ea7\\u9732\\u8425-\\u70e7\\u70e4-1\", \"\\u770b\\uff0c\\u86c7\\uff01\", \"\\u968f\\u540e\\u62cd2\", \"\\u6700\\u540e\\u7684\\u805a\\u9910\\u770b\\u7535\\u5f71\\u56de\\u6765-2-24\\u665a\", \"\\u6700\\u540e\\u7684\\u901a\\u5bb5--\\u8fd8\\u5728\\u6539\\u8bba\\u6587\", \"\\u6700\\u540e\\u7684\\u901a\\u5bb5-ktv\", \"\\u6700\\u540e\\u7684\\u901a\\u5bb5-\\u7f51\\u5427\", \"\\u6700\\u540e\\u7684\\u95f2\\u901b\"], \"month\": 5, \"type\": [\"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\"], \"year\": 2016}, \"date\": \"2016-05\"}, {\"arr\": {\"link\": [\"2016-04-01_\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-1.jpg\", \"2016-04-01_\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-2.jpg\", \"2016-04-01_\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-3.jpg\", \"2016-04-03_\\u6700\\u540e\\u4e00\\u6b21\\u5347\\u65d7\\u4eea\\u5f0f.jpg\"], \"text\": [\"\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-1\", \"\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-2\", \"\\u6bd5\\u4e1a\\u751f\\u665a\\u4f1a-3\", \"\\u6700\\u540e\\u4e00\\u6b21\\u5347\\u65d7\\u4eea\\u5f0f\"], \"month\": 4, \"type\": [\"image\", \"image\", \"image\", \"image\"], \"year\": 2016}, \"date\": \"2016-04\"}, {\"arr\": {\"link\": [\"2015-12-01_beautiful\\uff01\\uff01.JPG\"], \"text\": [\"beautiful\\uff01\\uff01\"], \"month\": 12, \"type\": [\"image\"], \"year\": 2015}, \"date\": \"2015-12\"}, {\"arr\": {\"link\": [\"2015-10-01_five floor.jpg\", \"2015-10-01_\\u4e2d\\u79cb--.jpg\", \"2015-10-01_\\u54c8\\u54c8.jpg\", \"2015-10-01_\\u54c8\\u54c82.jpg\", \"2015-10-01_\\u9633\\u5149\\u6b63\\u597d.jpg\", \"2015-10-01_\\u9752\\u6625\\u653e\\u6b4c.jpg\"], \"text\": [\"five floor\", \"\\u4e2d\\u79cb--\", \"\\u54c8\\u54c8\", \"\\u54c8\\u54c82\", \"\\u9633\\u5149\\u6b63\\u597d\", \"\\u9752\\u6625\\u653e\\u6b4c\"], \"month\": 10, \"type\": [\"image\", \"image\", \"image\", \"image\", \"image\", \"image\"], \"year\": 2015}, \"date\": \"2015-10\"}, {\"arr\": {\"link\": [\"2015-05-01_\\u4f53\\u80b2\\u9986\\u4e0a.JPG\", \"2015-05-01_\\u5145\\u5b9e\\u7684\\u4e00\\u5929--\\u4e03\\u591501.jpg\", \"2015-05-01_\\u518d\\u6765\\u4e00\\u6b21\\u56fe\\u4e66\\u9986-1.jpg\", \"2015-05-01_\\u518d\\u6765\\u4e00\\u6b21\\u56fe\\u4e66\\u9986-2.jpg\", \"2015-05-01_\\u53cd\\u6b63\\u4e0d\\u662f\\u6211\\u8d34\\u7684.jpg\", \"2015-05-01_\\u591a\\u56fe.JPG\", \"2015-05-01_\\u5929\\u6c14\\u4e0d\\u9519--\\u6691\\u5047\\u7559\\u6821\\u671f\\u95f4.JPG\", \"2015-05-01_\\u5b66\\u4f4d\\u6388\\u4e88-1.jpg\", \"2015-05-01_\\u5bbf\\u820d\\u805a\\u9910-1.jpg\", \"2015-05-01_\\u62bd\\u5956\\u4e2d\\u7684\\u2014\\u2014\\u4f4e\\u8c03.jpg\", \"2015-05-01_\\u6f02\\u917f.jpg\", \"2015-05-01_\\u7ae5\\u5e74.jpg\", \"2015-05-01_\\u968f\\u610f\\u62cd.jpg\", \"2015-05-01_\\u968f\\u624b\\u62cd3.jpg\"], \"text\": [\"\\u4f53\\u80b2\\u9986\\u4e0a\", \"\\u5145\\u5b9e\\u7684\\u4e00\\u5929--\\u4e03\\u591501\", \"\\u518d\\u6765\\u4e00\\u6b21\\u56fe\\u4e66\\u9986-1\", \"\\u518d\\u6765\\u4e00\\u6b21\\u56fe\\u4e66\\u9986-2\", \"\\u53cd\\u6b63\\u4e0d\\u662f\\u6211\\u8d34\\u7684\", \"\\u591a\\u56fe\", \"\\u5929\\u6c14\\u4e0d\\u9519--\\u6691\\u5047\\u7559\\u6821\\u671f\\u95f4\", \"\\u5b66\\u4f4d\\u6388\\u4e88-1\", \"\\u5bbf\\u820d\\u805a\\u9910-1\", \"\\u62bd\\u5956\\u4e2d\\u7684\\u2014\\u2014\\u4f4e\\u8c03\", \"\\u6f02\\u917f\", \"\\u7ae5\\u5e74\", \"\\u968f\\u610f\\u62cd\", \"\\u968f\\u624b\\u62cd3\"], \"month\": 5, \"type\": [\"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\", \"image\"], \"year\": 2015}, \"date\": \"2015-05\"}]}","date":"2018-02-27T07:38:38.116Z","updated":"2018-02-27T07:38:38.116Z","path":"photos/data.json","layout":"false","title":"","comments":1,"_id":"cjgd7qfss0014hwvf62pep5wm","content":"{\"list\":[{\"arr\":{\"link\":[\"2017-03-01_三分归晋.jpg\",\"2017-03-01_岁月神偷.jpg\"],\"text\":[\"三分归晋\",\"岁月神偷\"],\"month\":3,\"type\":[\"image\",\"image\"],\"year\":2017},\"date\":\"2017-03\"},{\"arr\":{\"link\":[\"2017-01-01_2017新年 (2).jpg\",\"2017-01-01_2017新年 (3).jpg\",\"2017-01-01_2017新年 (4).jpg\",\"2017-01-01_2017新年.jpg\",\"2017-01-01_黄昏.jpg\"],\"text\":[\"2017新年 (2)\",\"2017新年 (3)\",\"2017新年 (4)\",\"2017新年\",\"黄昏\"],\"month\":1,\"type\":[\"image\",\"image\",\"image\",\"image\",\"image\"],\"year\":2017},\"date\":\"2017-01\"},{\"arr\":{\"link\":[\"2016-11-03_夕阳无限好，只是近黄昏.jpg\"],\"text\":[\"夕阳无限好，只是近黄昏\"],\"month\":11,\"type\":[\"image\"],\"year\":2016},\"date\":\"2016-11\"},{\"arr\":{\"link\":[\"2016-05-01_世博馆.PNG\",\"2016-05-01_卖书啦！.jpg\",\"2016-05-01_我的痕迹.jpg\",\"2016-05-01_漂亮--中国馆.JPG\",\"2016-05-01_漂亮.jpg\",\"2016-05-01_班级聚餐-1.jpg\",\"2016-05-01_班级聚餐-孔明灯-1.jpg\",\"2016-05-01_班级聚餐-孔明灯-2.jpg\",\"2016-05-01_班级露营-1.jpg\",\"2016-05-01_班级露营-2.JPG\",\"2016-05-01_班级露营-烧烤-1.jpg\",\"2016-05-01_看，蛇！.jpg\",\"2016-05-01_随后拍2.jpg\",\"2016-05-10_最后的聚餐看电影回来-2-24晚.jpg\",\"2016-05-10_最后的通宵--还在改论文.jpg\",\"2016-05-10_最后的通宵-ktv.jpg\",\"2016-05-10_最后的通宵-网吧.jpg\",\"2016-05-10_最后的闲逛.jpg\"],\"text\":[\"世博馆\",\"卖书啦！\",\"我的痕迹\",\"漂亮--中国馆\",\"漂亮\",\"班级聚餐-1\",\"班级聚餐-孔明灯-1\",\"班级聚餐-孔明灯-2\",\"班级露营-1\",\"班级露营-2\",\"班级露营-烧烤-1\",\"看，蛇！\",\"随后拍2\",\"最后的聚餐看电影回来-2-24晚\",\"最后的通宵--还在改论文\",\"最后的通宵-ktv\",\"最后的通宵-网吧\",\"最后的闲逛\"],\"month\":5,\"type\":[\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\"],\"year\":2016},\"date\":\"2016-05\"},{\"arr\":{\"link\":[\"2016-04-01_毕业生晚会-1.jpg\",\"2016-04-01_毕业生晚会-2.jpg\",\"2016-04-01_毕业生晚会-3.jpg\",\"2016-04-03_最后一次升旗仪式.jpg\"],\"text\":[\"毕业生晚会-1\",\"毕业生晚会-2\",\"毕业生晚会-3\",\"最后一次升旗仪式\"],\"month\":4,\"type\":[\"image\",\"image\",\"image\",\"image\"],\"year\":2016},\"date\":\"2016-04\"},{\"arr\":{\"link\":[\"2015-12-01_beautiful！！.JPG\"],\"text\":[\"beautiful！！\"],\"month\":12,\"type\":[\"image\"],\"year\":2015},\"date\":\"2015-12\"},{\"arr\":{\"link\":[\"2015-10-01_five floor.jpg\",\"2015-10-01_中秋--.jpg\",\"2015-10-01_哈哈.jpg\",\"2015-10-01_哈哈2.jpg\",\"2015-10-01_阳光正好.jpg\",\"2015-10-01_青春放歌.jpg\"],\"text\":[\"five floor\",\"中秋--\",\"哈哈\",\"哈哈2\",\"阳光正好\",\"青春放歌\"],\"month\":10,\"type\":[\"image\",\"image\",\"image\",\"image\",\"image\",\"image\"],\"year\":2015},\"date\":\"2015-10\"},{\"arr\":{\"link\":[\"2015-05-01_体育馆上.JPG\",\"2015-05-01_充实的一天--七夕01.jpg\",\"2015-05-01_再来一次图书馆-1.jpg\",\"2015-05-01_再来一次图书馆-2.jpg\",\"2015-05-01_反正不是我贴的.jpg\",\"2015-05-01_多图.JPG\",\"2015-05-01_天气不错--暑假留校期间.JPG\",\"2015-05-01_学位授予-1.jpg\",\"2015-05-01_宿舍聚餐-1.jpg\",\"2015-05-01_抽奖中的——低调.jpg\",\"2015-05-01_漂酿.jpg\",\"2015-05-01_童年.jpg\",\"2015-05-01_随意拍.jpg\",\"2015-05-01_随手拍3.jpg\"],\"text\":[\"体育馆上\",\"充实的一天--七夕01\",\"再来一次图书馆-1\",\"再来一次图书馆-2\",\"反正不是我贴的\",\"多图\",\"天气不错--暑假留校期间\",\"学位授予-1\",\"宿舍聚餐-1\",\"抽奖中的——低调\",\"漂酿\",\"童年\",\"随意拍\",\"随手拍3\"],\"month\":5,\"type\":[\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\"],\"year\":2015},\"date\":\"2015-05\"}]}","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"","more":"{\"list\":[{\"arr\":{\"link\":[\"2017-03-01_三分归晋.jpg\",\"2017-03-01_岁月神偷.jpg\"],\"text\":[\"三分归晋\",\"岁月神偷\"],\"month\":3,\"type\":[\"image\",\"image\"],\"year\":2017},\"date\":\"2017-03\"},{\"arr\":{\"link\":[\"2017-01-01_2017新年 (2).jpg\",\"2017-01-01_2017新年 (3).jpg\",\"2017-01-01_2017新年 (4).jpg\",\"2017-01-01_2017新年.jpg\",\"2017-01-01_黄昏.jpg\"],\"text\":[\"2017新年 (2)\",\"2017新年 (3)\",\"2017新年 (4)\",\"2017新年\",\"黄昏\"],\"month\":1,\"type\":[\"image\",\"image\",\"image\",\"image\",\"image\"],\"year\":2017},\"date\":\"2017-01\"},{\"arr\":{\"link\":[\"2016-11-03_夕阳无限好，只是近黄昏.jpg\"],\"text\":[\"夕阳无限好，只是近黄昏\"],\"month\":11,\"type\":[\"image\"],\"year\":2016},\"date\":\"2016-11\"},{\"arr\":{\"link\":[\"2016-05-01_世博馆.PNG\",\"2016-05-01_卖书啦！.jpg\",\"2016-05-01_我的痕迹.jpg\",\"2016-05-01_漂亮--中国馆.JPG\",\"2016-05-01_漂亮.jpg\",\"2016-05-01_班级聚餐-1.jpg\",\"2016-05-01_班级聚餐-孔明灯-1.jpg\",\"2016-05-01_班级聚餐-孔明灯-2.jpg\",\"2016-05-01_班级露营-1.jpg\",\"2016-05-01_班级露营-2.JPG\",\"2016-05-01_班级露营-烧烤-1.jpg\",\"2016-05-01_看，蛇！.jpg\",\"2016-05-01_随后拍2.jpg\",\"2016-05-10_最后的聚餐看电影回来-2-24晚.jpg\",\"2016-05-10_最后的通宵--还在改论文.jpg\",\"2016-05-10_最后的通宵-ktv.jpg\",\"2016-05-10_最后的通宵-网吧.jpg\",\"2016-05-10_最后的闲逛.jpg\"],\"text\":[\"世博馆\",\"卖书啦！\",\"我的痕迹\",\"漂亮--中国馆\",\"漂亮\",\"班级聚餐-1\",\"班级聚餐-孔明灯-1\",\"班级聚餐-孔明灯-2\",\"班级露营-1\",\"班级露营-2\",\"班级露营-烧烤-1\",\"看，蛇！\",\"随后拍2\",\"最后的聚餐看电影回来-2-24晚\",\"最后的通宵--还在改论文\",\"最后的通宵-ktv\",\"最后的通宵-网吧\",\"最后的闲逛\"],\"month\":5,\"type\":[\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\"],\"year\":2016},\"date\":\"2016-05\"},{\"arr\":{\"link\":[\"2016-04-01_毕业生晚会-1.jpg\",\"2016-04-01_毕业生晚会-2.jpg\",\"2016-04-01_毕业生晚会-3.jpg\",\"2016-04-03_最后一次升旗仪式.jpg\"],\"text\":[\"毕业生晚会-1\",\"毕业生晚会-2\",\"毕业生晚会-3\",\"最后一次升旗仪式\"],\"month\":4,\"type\":[\"image\",\"image\",\"image\",\"image\"],\"year\":2016},\"date\":\"2016-04\"},{\"arr\":{\"link\":[\"2015-12-01_beautiful！！.JPG\"],\"text\":[\"beautiful！！\"],\"month\":12,\"type\":[\"image\"],\"year\":2015},\"date\":\"2015-12\"},{\"arr\":{\"link\":[\"2015-10-01_five floor.jpg\",\"2015-10-01_中秋--.jpg\",\"2015-10-01_哈哈.jpg\",\"2015-10-01_哈哈2.jpg\",\"2015-10-01_阳光正好.jpg\",\"2015-10-01_青春放歌.jpg\"],\"text\":[\"five floor\",\"中秋--\",\"哈哈\",\"哈哈2\",\"阳光正好\",\"青春放歌\"],\"month\":10,\"type\":[\"image\",\"image\",\"image\",\"image\",\"image\",\"image\"],\"year\":2015},\"date\":\"2015-10\"},{\"arr\":{\"link\":[\"2015-05-01_体育馆上.JPG\",\"2015-05-01_充实的一天--七夕01.jpg\",\"2015-05-01_再来一次图书馆-1.jpg\",\"2015-05-01_再来一次图书馆-2.jpg\",\"2015-05-01_反正不是我贴的.jpg\",\"2015-05-01_多图.JPG\",\"2015-05-01_天气不错--暑假留校期间.JPG\",\"2015-05-01_学位授予-1.jpg\",\"2015-05-01_宿舍聚餐-1.jpg\",\"2015-05-01_抽奖中的——低调.jpg\",\"2015-05-01_漂酿.jpg\",\"2015-05-01_童年.jpg\",\"2015-05-01_随意拍.jpg\",\"2015-05-01_随手拍3.jpg\"],\"text\":[\"体育馆上\",\"充实的一天--七夕01\",\"再来一次图书馆-1\",\"再来一次图书馆-2\",\"反正不是我贴的\",\"多图\",\"天气不错--暑假留校期间\",\"学位授予-1\",\"宿舍聚餐-1\",\"抽奖中的——低调\",\"漂酿\",\"童年\",\"随意拍\",\"随手拍3\"],\"month\":5,\"type\":[\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\",\"image\"],\"year\":2015},\"date\":\"2015-05\"}]}"},{"title":"photos","date":"2017-05-19T11:22:20.000Z","type":"photos","_content":"","source":"photos/index.md","raw":"---\ntitle: photos\ndate: 2017-05-19 19:22:20\ntype: photos\n---\n","updated":"2018-02-27T07:38:38.118Z","path":"photos/index.html","comments":1,"layout":"page","_id":"cjgd7qfsw0016hwvfjq8vujkd","content":"","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"","more":""},{"layout":"post","slug":"photos","title":"����","noDate":"true","comments":0,"_content":"<link rel=\"stylesheet\" href=\"./ins.css\">\n<div class=\"photos-btn-wrap\">\n\t<a class=\"photos-btn active\" href=\"javascript:void(0)\">Photos</a>\n\t<a class=\"photos-btn\" href=\"#\">����</a>\n</div>\n<div class=\"instagram itemscope\">\n\t<a href=\"https://www.instagram.com/lawlitewang20/\" target=\"_blank\" class=\"open-ins\">ͼƬ���ڼ����С�</a>\n</div>\n<script>\n  (function() {\n    var loadScript = function(path) {\n      var $script = document.createElement('script')\n      document.getElementsByTagName('body')[0].appendChild($script)\n      $script.setAttribute('src', path)\n    }\n    setTimeout(function() {\n      loadScript('./ins.js')\n    }, 0)\n  })()\n</script>","source":"photos/index.ejs","raw":"---\nlayout: post\nslug: \"photos\"\ntitle: \"����\"\nnoDate: \"true\"\ncomments: \"false\"\n---\n<link rel=\"stylesheet\" href=\"./ins.css\">\n<div class=\"photos-btn-wrap\">\n\t<a class=\"photos-btn active\" href=\"javascript:void(0)\">Photos</a>\n\t<a class=\"photos-btn\" href=\"#\">����</a>\n</div>\n<div class=\"instagram itemscope\">\n\t<a href=\"https://www.instagram.com/lawlitewang20/\" target=\"_blank\" class=\"open-ins\">ͼƬ���ڼ����С�</a>\n</div>\n<script>\n  (function() {\n    var loadScript = function(path) {\n      var $script = document.createElement('script')\n      document.getElementsByTagName('body')[0].appendChild($script)\n      $script.setAttribute('src', path)\n    }\n    setTimeout(function() {\n      loadScript('./ins.js')\n    }, 0)\n  })()\n</script>","date":"2018-02-27T07:38:38.117Z","updated":"2018-02-27T07:38:38.117Z","path":"photos/index.html","_id":"cjgd7qft1001ahwvfiup4voec","content":"<link rel=\"stylesheet\" href=\"./ins.css\">\n<div class=\"photos-btn-wrap\">\n\t<a class=\"photos-btn active\" href=\"javascript:void(0)\" target=\"_blank\" rel=\"noopener\">Photos</a>\n\t<a class=\"photos-btn\" href=\"#\">����</a>\n</div>\n<div class=\"instagram itemscope\">\n\t<a href=\"https://www.instagram.com/lawlitewang20/\" target=\"_blank\" class=\"open-ins\">ͼƬ���ڼ����С�</a>\n</div>\n<script>\n  (function() {\n    var loadScript = function(path) {\n      var $script = document.createElement('script')\n      document.getElementsByTagName('body')[0].appendChild($script)\n      $script.setAttribute('src', path)\n    }\n    setTimeout(function() {\n      loadScript('./ins.js')\n    }, 0)\n  })()\n</script>","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"","more":"<link rel=\"stylesheet\" href=\"./ins.css\">\n<div class=\"photos-btn-wrap\">\n\t<a class=\"photos-btn active\" href=\"javascript:void(0)\" target=\"_blank\" rel=\"noopener\">Photos</a>\n\t<a class=\"photos-btn\" href=\"#\">����</a>\n</div>\n<div class=\"instagram itemscope\">\n\t<a href=\"https://www.instagram.com/lawlitewang20/\" target=\"_blank\" class=\"open-ins\">ͼƬ���ڼ����С�</a>\n</div>\n<script>\n  (function() {\n    var loadScript = function(path) {\n      var $script = document.createElement('script')\n      document.getElementsByTagName('body')[0].appendChild($script)\n      $script.setAttribute('src', path)\n    }\n    setTimeout(function() {\n      loadScript('./ins.js')\n    }, 0)\n  })()\n</script>"},{"_content":"/*!\n * An jQuery | zepto plugin for lazy loading images.\n * author -> jieyou\n * see https://github.com/jieyou/lazyload\n * use some tuupola's code https://github.com/tuupola/jquery_lazyload (BSD)\n * use component's throttle https://github.com/component/throttle (MIT)\n */\n!function(a){\"function\"==typeof define&&define.amd?define([\"jquery\"],a):a(window.jQuery||window.Zepto)}(function(a){function g(){}function h(a,b){var e;return e=b._$container==d?(\"innerHeight\"in c?c.innerHeight:d.height())+d.scrollTop():b._$container.offset().top+b._$container.height(),e<=a.offset().top-b.threshold}function i(b,e){var f;return f=e._$container==d?d.width()+(a.fn.scrollLeft?d.scrollLeft():c.pageXOffset):e._$container.offset().left+e._$container.width(),f<=b.offset().left-e.threshold}function j(a,b){var c;return c=b._$container==d?d.scrollTop():b._$container.offset().top,c>=a.offset().top+b.threshold+a.height()}function k(b,e){var f;return f=e._$container==d?a.fn.scrollLeft?d.scrollLeft():c.pageXOffset:e._$container.offset().left,f>=b.offset().left+e.threshold+b.width()}function l(a,b){var c=0;a.each(function(d){function g(){f.trigger(\"_lazyload_appear\"),c=0}var f=a.eq(d);if(!(f.width()<=0&&f.height()<=0||\"none\"===f.css(\"display\")))if(b.vertical_only)if(j(f,b));else if(h(f,b)){if(++c>b.failure_limit)return!1}else g();else if(j(f,b)||k(f,b));else if(h(f,b)||i(f,b)){if(++c>b.failure_limit)return!1}else g()})}function m(a){return a.filter(function(b){return!a.eq(b)._lazyload_loadStarted})}function n(a,b){function h(){f=0,g=+new Date,e=a.apply(c,d),c=null,d=null}var c,d,e,f,g=0;return function(){c=this,d=arguments;var a=new Date-g;return f||(a>=b?h():f=setTimeout(h,b-a)),e}}var f,c=window,d=a(c),e={threshold:0,failure_limit:0,event:\"scroll\",effect:\"show\",effect_params:null,container:c,data_attribute:\"original\",data_srcset_attribute:\"original-srcset\",skip_invisible:!0,appear:g,load:g,vertical_only:!1,check_appear_throttle_time:300,url_rewriter_fn:g,no_fake_img_loader:!1,placeholder_data_img:\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC\",placeholder_real_img:\"http://ditu.baidu.cn/yyfm/lazyload/0.0.1/img/placeholder.png\"};f=function(){var a=Object.prototype.toString;return function(b){return a.call(b).replace(\"[object \",\"\").replace(\"]\",\"\")}}(),a.fn.hasOwnProperty(\"lazyload\")||(a.fn.lazyload=function(b){var i,j,k,h=this;return a.isPlainObject(b)||(b={}),a.each(e,function(g,h){var i=f(b[g]);-1!=a.inArray(g,[\"threshold\",\"failure_limit\",\"check_appear_throttle_time\"])?\"String\"==i?b[g]=parseInt(b[g],10):\"Number\"!=i&&(b[g]=h):\"container\"==g?(b._$container=b.hasOwnProperty(g)?b[g]==c||b[g]==document?d:a(b[g]):d,delete b.container):!e.hasOwnProperty(g)||b.hasOwnProperty(g)&&i==f(e[g])||(b[g]=h)}),i=\"scroll\"==b.event,k=0==b.check_appear_throttle_time?l:n(l,b.check_appear_throttle_time),j=i||\"scrollstart\"==b.event||\"scrollstop\"==b.event,h.each(function(c){var e=this,f=h.eq(c),i=f.attr(\"src\"),k=f.attr(\"data-\"+b.data_attribute),l=b.url_rewriter_fn==g?k:b.url_rewriter_fn.call(e,f,k),n=f.attr(\"data-\"+b.data_srcset_attribute),o=f.is(\"img\");return 1==f._lazyload_loadStarted||i==l?(f._lazyload_loadStarted=!0,h=m(h),void 0):(f._lazyload_loadStarted=!1,o&&!i&&f.one(\"error\",function(){f.attr(\"src\",b.placeholder_real_img)}).attr(\"src\",b.placeholder_data_img),f.one(\"_lazyload_appear\",function(){function i(){d&&f.hide(),o?(n&&f.attr(\"srcset\",n),l&&f.attr(\"src\",l)):f.css(\"background-image\",'url(\"'+l+'\")'),d&&f[b.effect].apply(f,c?b.effect_params:[]),h=m(h)}var d,c=a.isArray(b.effect_params);f._lazyload_loadStarted||(d=\"show\"!=b.effect&&a.fn[b.effect]&&(!b.effect_params||c&&0==b.effect_params.length),b.appear!=g&&b.appear.call(e,f,h.length,b),f._lazyload_loadStarted=!0,b.no_fake_img_loader||n?(b.load!=g&&f.one(\"load\",function(){b.load.call(e,f,h.length,b)}),i()):a(\"<img />\").one(\"load\",function(){i(),b.load!=g&&b.load.call(e,f,h.length,b)}).attr(\"src\",l))}),j||f.on(b.event,function(){f._lazyload_loadStarted||f.trigger(\"_lazyload_appear\")}),void 0)}),j&&b._$container.on(b.event,function(){k(h,b)}),d.on(\"resize load\",function(){k(h,b)}),a(function(){k(h,b)}),this})});\n","source":"photos/lazyload.min.js","raw":"/*!\n * An jQuery | zepto plugin for lazy loading images.\n * author -> jieyou\n * see https://github.com/jieyou/lazyload\n * use some tuupola's code https://github.com/tuupola/jquery_lazyload (BSD)\n * use component's throttle https://github.com/component/throttle (MIT)\n */\n!function(a){\"function\"==typeof define&&define.amd?define([\"jquery\"],a):a(window.jQuery||window.Zepto)}(function(a){function g(){}function h(a,b){var e;return e=b._$container==d?(\"innerHeight\"in c?c.innerHeight:d.height())+d.scrollTop():b._$container.offset().top+b._$container.height(),e<=a.offset().top-b.threshold}function i(b,e){var f;return f=e._$container==d?d.width()+(a.fn.scrollLeft?d.scrollLeft():c.pageXOffset):e._$container.offset().left+e._$container.width(),f<=b.offset().left-e.threshold}function j(a,b){var c;return c=b._$container==d?d.scrollTop():b._$container.offset().top,c>=a.offset().top+b.threshold+a.height()}function k(b,e){var f;return f=e._$container==d?a.fn.scrollLeft?d.scrollLeft():c.pageXOffset:e._$container.offset().left,f>=b.offset().left+e.threshold+b.width()}function l(a,b){var c=0;a.each(function(d){function g(){f.trigger(\"_lazyload_appear\"),c=0}var f=a.eq(d);if(!(f.width()<=0&&f.height()<=0||\"none\"===f.css(\"display\")))if(b.vertical_only)if(j(f,b));else if(h(f,b)){if(++c>b.failure_limit)return!1}else g();else if(j(f,b)||k(f,b));else if(h(f,b)||i(f,b)){if(++c>b.failure_limit)return!1}else g()})}function m(a){return a.filter(function(b){return!a.eq(b)._lazyload_loadStarted})}function n(a,b){function h(){f=0,g=+new Date,e=a.apply(c,d),c=null,d=null}var c,d,e,f,g=0;return function(){c=this,d=arguments;var a=new Date-g;return f||(a>=b?h():f=setTimeout(h,b-a)),e}}var f,c=window,d=a(c),e={threshold:0,failure_limit:0,event:\"scroll\",effect:\"show\",effect_params:null,container:c,data_attribute:\"original\",data_srcset_attribute:\"original-srcset\",skip_invisible:!0,appear:g,load:g,vertical_only:!1,check_appear_throttle_time:300,url_rewriter_fn:g,no_fake_img_loader:!1,placeholder_data_img:\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC\",placeholder_real_img:\"http://ditu.baidu.cn/yyfm/lazyload/0.0.1/img/placeholder.png\"};f=function(){var a=Object.prototype.toString;return function(b){return a.call(b).replace(\"[object \",\"\").replace(\"]\",\"\")}}(),a.fn.hasOwnProperty(\"lazyload\")||(a.fn.lazyload=function(b){var i,j,k,h=this;return a.isPlainObject(b)||(b={}),a.each(e,function(g,h){var i=f(b[g]);-1!=a.inArray(g,[\"threshold\",\"failure_limit\",\"check_appear_throttle_time\"])?\"String\"==i?b[g]=parseInt(b[g],10):\"Number\"!=i&&(b[g]=h):\"container\"==g?(b._$container=b.hasOwnProperty(g)?b[g]==c||b[g]==document?d:a(b[g]):d,delete b.container):!e.hasOwnProperty(g)||b.hasOwnProperty(g)&&i==f(e[g])||(b[g]=h)}),i=\"scroll\"==b.event,k=0==b.check_appear_throttle_time?l:n(l,b.check_appear_throttle_time),j=i||\"scrollstart\"==b.event||\"scrollstop\"==b.event,h.each(function(c){var e=this,f=h.eq(c),i=f.attr(\"src\"),k=f.attr(\"data-\"+b.data_attribute),l=b.url_rewriter_fn==g?k:b.url_rewriter_fn.call(e,f,k),n=f.attr(\"data-\"+b.data_srcset_attribute),o=f.is(\"img\");return 1==f._lazyload_loadStarted||i==l?(f._lazyload_loadStarted=!0,h=m(h),void 0):(f._lazyload_loadStarted=!1,o&&!i&&f.one(\"error\",function(){f.attr(\"src\",b.placeholder_real_img)}).attr(\"src\",b.placeholder_data_img),f.one(\"_lazyload_appear\",function(){function i(){d&&f.hide(),o?(n&&f.attr(\"srcset\",n),l&&f.attr(\"src\",l)):f.css(\"background-image\",'url(\"'+l+'\")'),d&&f[b.effect].apply(f,c?b.effect_params:[]),h=m(h)}var d,c=a.isArray(b.effect_params);f._lazyload_loadStarted||(d=\"show\"!=b.effect&&a.fn[b.effect]&&(!b.effect_params||c&&0==b.effect_params.length),b.appear!=g&&b.appear.call(e,f,h.length,b),f._lazyload_loadStarted=!0,b.no_fake_img_loader||n?(b.load!=g&&f.one(\"load\",function(){b.load.call(e,f,h.length,b)}),i()):a(\"<img />\").one(\"load\",function(){i(),b.load!=g&&b.load.call(e,f,h.length,b)}).attr(\"src\",l))}),j||f.on(b.event,function(){f._lazyload_loadStarted||f.trigger(\"_lazyload_appear\")}),void 0)}),j&&b._$container.on(b.event,function(){k(h,b)}),d.on(\"resize load\",function(){k(h,b)}),a(function(){k(h,b)}),this})});\n","date":"2018-02-27T07:38:38.121Z","updated":"2018-02-27T07:38:38.121Z","path":"photos/lazyload.min.js","layout":"false","title":"","comments":1,"_id":"cjgd7qft4001dhwvf4gugsfub","content":"/*!\n * An jQuery | zepto plugin for lazy loading images.\n * author -> jieyou\n * see https://github.com/jieyou/lazyload\n * use some tuupola's code https://github.com/tuupola/jquery_lazyload (BSD)\n * use component's throttle https://github.com/component/throttle (MIT)\n */\n!function(a){\"function\"==typeof define&&define.amd?define([\"jquery\"],a):a(window.jQuery||window.Zepto)}(function(a){function g(){}function h(a,b){var e;return e=b._$container==d?(\"innerHeight\"in c?c.innerHeight:d.height())+d.scrollTop():b._$container.offset().top+b._$container.height(),e<=a.offset().top-b.threshold}function i(b,e){var=\"\" f;return=\"\" f=\"e._$container==d?d.width()+(a.fn.scrollLeft?d.scrollLeft():c.pageXOffset):e._$container.offset().left+e._$container.width(),f<=b.offset().left-e.threshold}function\" j(a,b){var=\"\" c;return=\"\" c=\"b._$container==d?d.scrollTop():b._$container.offset().top,c\">=a.offset().top+b.threshold+a.height()}function k(b,e){var f;return f=e._$container==d?a.fn.scrollLeft?d.scrollLeft():c.pageXOffset:e._$container.offset().left,f>=b.offset().left+e.threshold+b.width()}function l(a,b){var c=0;a.each(function(d){function g(){f.trigger(\"_lazyload_appear\"),c=0}var f=a.eq(d);if(!(f.width()<=0&&f.height()<=0||\"none\"===f.css(\"display\")))if(b.vertical_only)if(j(f,b));else if(h(f,b)){if(++c=\"\">b.failure_limit)return!1}else g();else if(j(f,b)||k(f,b));else if(h(f,b)||i(f,b)){if(++c>b.failure_limit)return!1}else g()})}function m(a){return a.filter(function(b){return!a.eq(b)._lazyload_loadStarted})}function n(a,b){function h(){f=0,g=+new Date,e=a.apply(c,d),c=null,d=null}var c,d,e,f,g=0;return function(){c=this,d=arguments;var a=new Date-g;return f||(a>=b?h():f=setTimeout(h,b-a)),e}}var f,c=window,d=a(c),e={threshold:0,failure_limit:0,event:\"scroll\",effect:\"show\",effect_params:null,container:c,data_attribute:\"original\",data_srcset_attribute:\"original-srcset\",skip_invisible:!0,appear:g,load:g,vertical_only:!1,check_appear_throttle_time:300,url_rewriter_fn:g,no_fake_img_loader:!1,placeholder_data_img:\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC\",placeholder_real_img:\"http://ditu.baidu.cn/yyfm/lazyload/0.0.1/img/placeholder.png\"};f=function(){var a=Object.prototype.toString;return function(b){return a.call(b).replace(\"[object \",\"\").replace(\"]\",\"\")}}(),a.fn.hasOwnProperty(\"lazyload\")||(a.fn.lazyload=function(b){var i,j,k,h=this;return a.isPlainObject(b)||(b={}),a.each(e,function(g,h){var i=f(b[g]);-1!=a.inArray(g,[\"threshold\",\"failure_limit\",\"check_appear_throttle_time\"])?\"String\"==i?b[g]=parseInt(b[g],10):\"Number\"!=i&&(b[g]=h):\"container\"==g?(b._$container=b.hasOwnProperty(g)?b[g]==c||b[g]==document?d:a(b[g]):d,delete b.container):!e.hasOwnProperty(g)||b.hasOwnProperty(g)&&i==f(e[g])||(b[g]=h)}),i=\"scroll\"==b.event,k=0==b.check_appear_throttle_time?l:n(l,b.check_appear_throttle_time),j=i||\"scrollstart\"==b.event||\"scrollstop\"==b.event,h.each(function(c){var e=this,f=h.eq(c),i=f.attr(\"src\"),k=f.attr(\"data-\"+b.data_attribute),l=b.url_rewriter_fn==g?k:b.url_rewriter_fn.call(e,f,k),n=f.attr(\"data-\"+b.data_srcset_attribute),o=f.is(\"img\");return 1==f._lazyload_loadStarted||i==l?(f._lazyload_loadStarted=!0,h=m(h),void 0):(f._lazyload_loadStarted=!1,o&&!i&&f.one(\"error\",function(){f.attr(\"src\",b.placeholder_real_img)}).attr(\"src\",b.placeholder_data_img),f.one(\"_lazyload_appear\",function(){function i(){d&&f.hide(),o?(n&&f.attr(\"srcset\",n),l&&f.attr(\"src\",l)):f.css(\"background-image\",'url(\"'+l+'\")'),d&&f[b.effect].apply(f,c?b.effect_params:[]),h=m(h)}var d,c=a.isArray(b.effect_params);f._lazyload_loadStarted||(d=\"show\"!=b.effect&&a.fn[b.effect]&&(!b.effect_params||c&&0==b.effect_params.length),b.appear!=g&&b.appear.call(e,f,h.length,b),f._lazyload_loadStarted=!0,b.no_fake_img_loader||n?(b.load!=g&&f.one(\"load\",function(){b.load.call(e,f,h.length,b)}),i()):a(\"<img>\").one(\"load\",function(){i(),b.load!=g&&b.load.call(e,f,h.length,b)}).attr(\"src\",l))}),j||f.on(b.event,function(){f._lazyload_loadStarted||f.trigger(\"_lazyload_appear\")}),void 0)}),j&&b._$container.on(b.event,function(){k(h,b)}),d.on(\"resize load\",function(){k(h,b)}),a(function(){k(h,b)}),this})});\n</=0&&f.height()<=0||\"none\"===f.css(\"display\")))if(b.vertical_only)if(j(f,b));else></=a.offset().top-b.threshold}function>","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"","more":"/*!\n * An jQuery | zepto plugin for lazy loading images.\n * author -> jieyou\n * see https://github.com/jieyou/lazyload\n * use some tuupola's code https://github.com/tuupola/jquery_lazyload (BSD)\n * use component's throttle https://github.com/component/throttle (MIT)\n */\n!function(a){\"function\"==typeof define&&define.amd?define([\"jquery\"],a):a(window.jQuery||window.Zepto)}(function(a){function g(){}function h(a,b){var e;return e=b._$container==d?(\"innerHeight\"in c?c.innerHeight:d.height())+d.scrollTop():b._$container.offset().top+b._$container.height(),e<=a.offset().top-b.threshold}function i(b,e){var=\"\" f;return=\"\" f=\"e._$container==d?d.width()+(a.fn.scrollLeft?d.scrollLeft():c.pageXOffset):e._$container.offset().left+e._$container.width(),f<=b.offset().left-e.threshold}function\" j(a,b){var=\"\" c;return=\"\" c=\"b._$container==d?d.scrollTop():b._$container.offset().top,c\">=a.offset().top+b.threshold+a.height()}function k(b,e){var f;return f=e._$container==d?a.fn.scrollLeft?d.scrollLeft():c.pageXOffset:e._$container.offset().left,f>=b.offset().left+e.threshold+b.width()}function l(a,b){var c=0;a.each(function(d){function g(){f.trigger(\"_lazyload_appear\"),c=0}var f=a.eq(d);if(!(f.width()<=0&&f.height()<=0||\"none\"===f.css(\"display\")))if(b.vertical_only)if(j(f,b));else if(h(f,b)){if(++c=\"\">b.failure_limit)return!1}else g();else if(j(f,b)||k(f,b));else if(h(f,b)||i(f,b)){if(++c>b.failure_limit)return!1}else g()})}function m(a){return a.filter(function(b){return!a.eq(b)._lazyload_loadStarted})}function n(a,b){function h(){f=0,g=+new Date,e=a.apply(c,d),c=null,d=null}var c,d,e,f,g=0;return function(){c=this,d=arguments;var a=new Date-g;return f||(a>=b?h():f=setTimeout(h,b-a)),e}}var f,c=window,d=a(c),e={threshold:0,failure_limit:0,event:\"scroll\",effect:\"show\",effect_params:null,container:c,data_attribute:\"original\",data_srcset_attribute:\"original-srcset\",skip_invisible:!0,appear:g,load:g,vertical_only:!1,check_appear_throttle_time:300,url_rewriter_fn:g,no_fake_img_loader:!1,placeholder_data_img:\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC\",placeholder_real_img:\"http://ditu.baidu.cn/yyfm/lazyload/0.0.1/img/placeholder.png\"};f=function(){var a=Object.prototype.toString;return function(b){return a.call(b).replace(\"[object \",\"\").replace(\"]\",\"\")}}(),a.fn.hasOwnProperty(\"lazyload\")||(a.fn.lazyload=function(b){var i,j,k,h=this;return a.isPlainObject(b)||(b={}),a.each(e,function(g,h){var i=f(b[g]);-1!=a.inArray(g,[\"threshold\",\"failure_limit\",\"check_appear_throttle_time\"])?\"String\"==i?b[g]=parseInt(b[g],10):\"Number\"!=i&&(b[g]=h):\"container\"==g?(b._$container=b.hasOwnProperty(g)?b[g]==c||b[g]==document?d:a(b[g]):d,delete b.container):!e.hasOwnProperty(g)||b.hasOwnProperty(g)&&i==f(e[g])||(b[g]=h)}),i=\"scroll\"==b.event,k=0==b.check_appear_throttle_time?l:n(l,b.check_appear_throttle_time),j=i||\"scrollstart\"==b.event||\"scrollstop\"==b.event,h.each(function(c){var e=this,f=h.eq(c),i=f.attr(\"src\"),k=f.attr(\"data-\"+b.data_attribute),l=b.url_rewriter_fn==g?k:b.url_rewriter_fn.call(e,f,k),n=f.attr(\"data-\"+b.data_srcset_attribute),o=f.is(\"img\");return 1==f._lazyload_loadStarted||i==l?(f._lazyload_loadStarted=!0,h=m(h),void 0):(f._lazyload_loadStarted=!1,o&&!i&&f.one(\"error\",function(){f.attr(\"src\",b.placeholder_real_img)}).attr(\"src\",b.placeholder_data_img),f.one(\"_lazyload_appear\",function(){function i(){d&&f.hide(),o?(n&&f.attr(\"srcset\",n),l&&f.attr(\"src\",l)):f.css(\"background-image\",'url(\"'+l+'\")'),d&&f[b.effect].apply(f,c?b.effect_params:[]),h=m(h)}var d,c=a.isArray(b.effect_params);f._lazyload_loadStarted||(d=\"show\"!=b.effect&&a.fn[b.effect]&&(!b.effect_params||c&&0==b.effect_params.length),b.appear!=g&&b.appear.call(e,f,h.length,b),f._lazyload_loadStarted=!0,b.no_fake_img_loader||n?(b.load!=g&&f.one(\"load\",function(){b.load.call(e,f,h.length,b)}),i()):a(\"<img>\").one(\"load\",function(){i(),b.load!=g&&b.load.call(e,f,h.length,b)}).attr(\"src\",l))}),j||f.on(b.event,function(){f._lazyload_loadStarted||f.trigger(\"_lazyload_appear\")}),void 0)}),j&&b._$container.on(b.event,function(){k(h,b)}),d.on(\"resize load\",function(){k(h,b)}),a(function(){k(h,b)}),this})});\n</=0&&f.height()<=0||\"none\"===f.css(\"display\")))if(b.vertical_only)if(j(f,b));else></=a.offset().top-b.threshold}function>"},{"title":"标签","date":"2017-04-27T11:11:27.000Z","type":"tags","comments":0,"_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2017-04-27 19:11:27\ntype: \"tags\"\ncomments: false\n---\n","updated":"2018-02-27T07:38:38.122Z","path":"tags/index.html","layout":"page","_id":"cjgd7qfta001ghwvflzyf0i1n","content":"","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"","more":""},{"_content":"/******/\n(function(modules) { // webpackBootstrap\n  /******/ // The module cache\n  /******/\n  var installedModules = {};\n  /******/\n  /******/ // The require function\n  /******/\n  function __webpack_require__(moduleId) {\n    /******/\n    /******/ // Check if module is in cache\n    /******/\n    if (installedModules[moduleId])\n    /******/\n      return installedModules[moduleId].exports;\n    /******/\n    /******/ // Create a new module (and put it into the cache)\n    /******/\n    var module = installedModules[moduleId] = {\n      /******/\n      exports: {},\n      /******/\n      id: moduleId,\n      /******/\n      loaded: false\n        /******/\n    };\n    /******/\n    /******/ // Execute the module function\n    /******/\n    modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n    /******/\n    /******/ // Flag the module as loaded\n    /******/\n    module.loaded = true;\n    /******/\n    /******/ // Return the exports of the module\n    /******/\n    return module.exports;\n    /******/\n  }\n  /******/\n  /******/\n  /******/ // expose the modules object (__webpack_modules__)\n  /******/\n  __webpack_require__.m = modules;\n  /******/\n  /******/ // expose the module cache\n  /******/\n  __webpack_require__.c = installedModules;\n  /******/\n  /******/ // __webpack_public_path__\n  /******/\n  __webpack_require__.p = \"/dist/\";\n  /******/\n  /******/ // Load entry module and return exports\n  /******/\n  return __webpack_require__(0);\n  /******/\n})\n/************************************************************************/\n/******/\n([\n  /* 0 */\n  /***/\n  function(module, exports, __webpack_require__) {\n\n    'use strict';\n\n    __webpack_require__(1);\n\n    var _view = __webpack_require__(2);\n\n    var _view2 = _interopRequireDefault(_view);\n\n    function _interopRequireDefault(obj) {\n      return obj && obj.__esModule ? obj : {\n        default: obj\n      };\n    }\n\n    /**\n     * @name impush-client \n     * @description ������Ŀ���ҷ����¸���\n     * @date 2016-12-1\n     */\n\n    var _collection = [];\n    var _count = 0;\n    var searchData;\n\n    function addMask(elem) {\n      var rect = elem.getBoundingClientRect();\n      var style = getComputedStyle(elem, null);\n\n      var mask = document.createElement('i');\n      mask.className = 'icon-film';\n      mask.style.color = '#fff';\n      mask.style.fontSize = '26px';\n      mask.style.position = 'absolute';\n      mask.style.right = '10px';\n      mask.style.bottom = '10px';\n      mask.style.zIndex = 1;\n      elem.parentNode.appendChild(mask);\n    }\n\n    var createVideoIncon = function createVideoIncon() {\n      var $videoImg = document.querySelectorAll('.thumb a[data-type=\"video\"]');\n      for (var i = 0, len = $videoImg.length; i < len; i++) {\n        addMask($videoImg[i]);\n      }\n    };\n    var render = function render(res) {\n      var ulTmpl = \"\";\n      for (var j = 0, len2 = res.list.length; j < len2; j++) {\n        var data = res.list[j].arr;\n        var liTmpl = \"\";\n        for (var i = 0, len = data.link.length; i < len; i++) {\n          var minSrc = 'https://raw.githubusercontent.com/lawlite19/blog-back-up/master/min_photos/' + data.link[i];\n          var src = 'https://raw.githubusercontent.com/lawlite19/blog-back-up/master/photos/' + data.link[i];\n          var type = data.type[i];\n          var target = src + (type === 'video' ? '.mp4' : '.jpg');\n          src += '';\n\n          liTmpl += '<figure class=\"thumb\" itemprop=\"associatedMedia\" itemscope=\"\" itemtype=\"http://schema.org/ImageObject\">\\\n                <a href=\"' + src + '\" itemprop=\"contentUrl\" data-size=\"1080x1080\" data-type=\"' + type + '\" data-target=\"' + src + '\">\\\n                  <img class=\"reward-img\" data-type=\"' + type + '\" data-src=\"' + minSrc + '\" src=\"/assets/img/empty.png\" itemprop=\"thumbnail\" onload=\"lzld(this)\">\\\n                </a>\\\n                <figcaption style=\"display:none\" itemprop=\"caption description\">' + data.text[i] + '</figcaption>\\\n            </figure>';\n        }\n        ulTmpl = ulTmpl + '<section class=\"archives album\"><h1 class=\"year\">' + data.year + '��<em>' + data.month + '��</em></h1>\\\n        <ul class=\"img-box-ul\">' + liTmpl + '</ul>\\\n        </section>';\n      }\n      document.querySelector('.instagram').innerHTML = '<div class=\"photos\" itemscope=\"\" itemtype=\"http://schema.org/ImageGallery\">' + ulTmpl + '</div>';\n      createVideoIncon();\n      _view2.default.init();\n    };\n\n    var replacer = function replacer(str) {\n      var arr = str.split(\"/\");\n      return \"/assets/ins/\" + arr[arr.length - 1];\n    };\n\n    var ctrler = function ctrler(data) {\n      var imgObj = {};\n      for (var i = 0, len = data.length; i < len; i++) {\n        var y = data[i].y;\n        var m = data[i].m;\n        var src = replacer(data[i].src);\n        var text = data[i].text;\n        var key = y + \"\" + ((m + \"\").length == 1 ? \"0\" + m : m);\n        if (imgObj[key]) {\n          imgObj[key].srclist.push(src);\n          imgObj[key].text.push(text);\n        } else {\n          imgObj[key] = {\n            year: y,\n            month: m,\n            srclist: [src],\n            text: [text]\n          };\n        }\n      }\n      render(imgObj);\n    };\n\n    function loadData(success) {\n      if (!searchData) {\n        var xhr = new XMLHttpRequest();\n        xhr.open('GET', './data.json?t=' + +new Date(), true);\n\n        xhr.onload = function() {\n          if (this.status >= 200 && this.status < 300) {\n            var res = JSON.parse(this.response);\n            searchData = res;\n            success(searchData);\n          } else {\n            console.error(this.statusText);\n          }\n        };\n\n        xhr.onerror = function() {\n          console.error(this.statusText);\n        };\n\n        xhr.send();\n      } else {\n        success(searchData);\n      }\n    }\n\n    var Ins = {\n      init: function init() {\n        loadData(function(data) {\n          render(data);\n        });\n      }\n    };\n\n    Ins.init();\n\n    // export default impush;\n\n    /***/\n  },\n  /* 1 */\n  /***/\n  function(module, exports, __webpack_require__) {\n\n    /* WEBPACK VAR INJECTION */\n    (function(global) {\n      'use strict';\n\n      var inViewport = __webpack_require__(3);\n      var lazyAttrs = ['data-src'];\n\n      global.lzld = lazyload();\n\n      // Provide libs using getAttribute early to get the good src\n      // and not the fake data-src\n      replaceGetAttribute('Image');\n      replaceGetAttribute('IFrame');\n\n      function registerLazyAttr(attr) {\n        if (indexOf.call(lazyAttrs, attr) === -1) {\n          lazyAttrs.push(attr);\n        }\n      }\n\n      function lazyload(opts) {\n        opts = merge({\n          'offset': 333,\n          'src': 'data-src',\n          'container': false\n        }, opts || {});\n\n        if (typeof opts.src === 'string') {\n          registerLazyAttr(opts.src);\n        }\n\n        var elts = [];\n\n        function show(elt) {\n          var src = findRealSrc(elt);\n\n          if (src) {\n            elt.src = src;\n          }\n\n          elt.setAttribute('data-lzled', true);\n          elts[indexOf.call(elts, elt)] = null;\n        }\n\n        function findRealSrc(elt) {\n          if (typeof opts.src === 'function') {\n            return opts.src(elt);\n          }\n\n          return elt.getAttribute(opts.src);\n        }\n\n        function register(elt) {\n          elt.onload = null;\n          elt.removeAttribute('onload');\n          elt.onerror = null;\n          elt.removeAttribute('onerror');\n\n          if (indexOf.call(elts, elt) === -1) {\n            inViewport(elt, opts, show);\n          }\n        }\n\n        return register;\n      }\n\n      function replaceGetAttribute(elementName) {\n        var fullname = 'HTML' + elementName + 'Element';\n        if (fullname in global === false) {\n          return;\n        }\n\n        var original = global[fullname].prototype.getAttribute;\n        global[fullname].prototype.getAttribute = function(name) {\n          if (name === 'src') {\n            var realSrc;\n            for (var i = 0, max = lazyAttrs.length; i < max; i++) {\n              realSrc = original.call(this, lazyAttrs[i]);\n              if (realSrc) {\n                break;\n              }\n            }\n\n            return realSrc || original.call(this, name);\n          }\n\n          // our own lazyloader will go through theses lines\n          // because we use getAttribute(opts.src)\n          return original.call(this, name);\n        };\n      }\n\n      function merge(defaults, opts) {\n        for (var name in defaults) {\n          if (opts[name] === undefined) {\n            opts[name] = defaults[name];\n          }\n        }\n\n        return opts;\n      }\n\n      // http://webreflection.blogspot.fr/2011/06/partial-polyfills.html\n      function indexOf(value) {\n        for (var i = this.length; i-- && this[i] !== value;) {}\n        return i;\n      }\n\n      module.exports = lazyload;\n\n      // export default impush;\n      /* WEBPACK VAR INJECTION */\n    }.call(exports, (function() {\n      return this;\n    }())))\n\n    /***/\n  },\n  /* 2 */\n  /***/\n  function(module, exports) {\n\n    'use strict';\n\n    var initPhotoSwipeFromDOM = function initPhotoSwipeFromDOM(gallerySelector) {\n\n      // parse slide data (url, title, size ...) from DOM elements \n      // (children of gallerySelector)\n      var parseThumbnailElements = function parseThumbnailElements(el) {\n        el = el.parentNode.parentNode;\n        var thumbElements = el.getElementsByClassName('thumb'),\n          numNodes = thumbElements.length,\n          items = [],\n          figureEl,\n          linkEl,\n          size,\n          type,\n          // video or not\n          target,\n          item;\n\n        for (var i = 0; i < numNodes; i++) {\n\n          figureEl = thumbElements[i]; // \n\n          // include only element nodes \n          if (figureEl.nodeType !== 1) {\n            continue;\n          }\n\n          linkEl = figureEl.children[0]; // \n\n          size = linkEl.getAttribute('data-size').split('x');\n          type = linkEl.getAttribute('data-type');\n          target = linkEl.getAttribute('data-target');\n          // create slide object\n          item = {\n            src: linkEl.getAttribute('href'),\n            w: parseInt(size[0], 10),\n            h: parseInt(size[1], 10)\n          };\n\n          if (figureEl.children.length > 1) {\n            item.title = figureEl.children[1].innerHTML;\n          }\n\n          if (linkEl.children.length > 0) {\n            item.msrc = linkEl.children[0].getAttribute('src');\n            item.type = type;\n            item.target = target;\n            item.html = '<video src=\"' + target + '\" controls=\"controls\" autoplay=\"autoplay\"></video>';\n            if (type === 'video') {\n              //item.src = null;\n            }\n          }\n\n          item.el = figureEl; // save link to element for getThumbBoundsFn\n          items.push(item);\n        }\n\n        return items;\n      };\n\n      // find nearest parent element\n      var closest = function closest(el, fn) {\n        return el && (fn(el) ? el : closest(el.parentNode, fn));\n      };\n\n      // triggers when user clicks on thumbnail\n      var onThumbnailsClick = function onThumbnailsClick(e) {\n        e = e || window.event;\n        e.preventDefault ? e.preventDefault() : e.returnValue = false;\n\n        var eTarget = e.target || e.srcElement;\n\n        // find root element of slide\n        var clickedListItem = closest(eTarget, function(el) {\n          return el.tagName && el.tagName.toUpperCase() === 'FIGURE';\n        });\n\n        if (!clickedListItem) {\n          return;\n        }\n\n        // find index of clicked item by looping through all child nodes\n        // alternatively, you may define index via data- attribute\n        var clickedGallery = clickedListItem.parentNode,\n\n          // childNodes = clickedListItem.parentNode.childNodes,\n          // numChildNodes = childNodes.length,\n          childNodes = document.getElementsByClassName('thumb'),\n          numChildNodes = childNodes.length,\n          nodeIndex = 0,\n          index;\n\n        for (var i = 0; i < numChildNodes; i++) {\n          if (childNodes[i].nodeType !== 1) {\n            continue;\n          }\n\n          if (childNodes[i] === clickedListItem) {\n            index = nodeIndex;\n            break;\n          }\n          nodeIndex++;\n        }\n\n        if (index >= 0) {\n          // open PhotoSwipe if valid index found\n          openPhotoSwipe(index, clickedGallery);\n        }\n        return false;\n      };\n\n      // parse picture index and gallery index from URL (#&pid=1&gid=2)\n      var photoswipeParseHash = function photoswipeParseHash() {\n        var hash = window.location.hash.substring(1),\n          params = {};\n\n        if (hash.length < 5) {\n          return params;\n        }\n\n        var vars = hash.split('&');\n        for (var i = 0; i < vars.length; i++) {\n          if (!vars[i]) {\n            continue;\n          }\n          var pair = vars[i].split('=');\n          if (pair.length < 2) {\n            continue;\n          }\n          params[pair[0]] = pair[1];\n        }\n\n        if (params.gid) {\n          params.gid = parseInt(params.gid, 10);\n        }\n\n        return params;\n      };\n\n      var openPhotoSwipe = function openPhotoSwipe(index, galleryElement, disableAnimation, fromURL) {\n        var pswpElement = document.querySelectorAll('.pswp')[0],\n          gallery,\n          options,\n          items;\n\n        items = parseThumbnailElements(galleryElement);\n        // define options (if needed)\n        options = {\n\n          // define gallery index (for URL)\n          galleryUID: galleryElement.getAttribute('data-pswp-uid'),\n\n          getThumbBoundsFn: function getThumbBoundsFn(index) {\n            // See Options -> getThumbBoundsFn section of documentation for more info\n            var thumbnail = items[index].el.getElementsByTagName('img')[0],\n              // find thumbnail\n              pageYScroll = window.pageYOffset || document.documentElement.scrollTop,\n              rect = thumbnail.getBoundingClientRect();\n\n            return {\n              x: rect.left,\n              y: rect.top + pageYScroll,\n              w: rect.width\n            };\n          }\n\n        };\n\n        // PhotoSwipe opened from URL\n        if (fromURL) {\n          if (options.galleryPIDs) {\n            // parse real index when custom PIDs are used \n            // http://photoswipe.com/documentation/faq.html#custom-pid-in-url\n            for (var j = 0; j < items.length; j++) {\n              if (items[j].pid == index) {\n                options.index = j;\n                break;\n              }\n            }\n          } else {\n            // in URL indexes start from 1\n            options.index = parseInt(index, 10) - 1;\n          }\n        } else {\n          options.index = parseInt(index, 10);\n        }\n\n        // exit if index not found\n        if (isNaN(options.index)) {\n          return;\n        }\n\n        if (disableAnimation) {\n          options.showAnimationDuration = 0;\n        }\n\n        // Pass data to PhotoSwipe and initialize it\n        gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);\n        gallery.init();\n\n        var $tempVideo;\n        var stopVideoHandle = function stopVideoHandle() {\n          if ($tempVideo) {\n            $tempVideo.remove();\n            $tempVideo = null;\n          }\n        };\n        var changeHandle = function changeHandle() {\n          var item = gallery.currItem;\n          stopVideoHandle();\n          if (item.type === 'video') {\n            var $ctn = item.container;\n            var style = $ctn.getElementsByClassName('pswp__img')[0].style;\n            var $video = document.createElement('video');\n            $video.setAttribute('autoplay', 'autoplay');\n            $video.setAttribute('controls', 'controls');\n            $video.setAttribute('src', item.target);\n            $video.style.width = style.width;\n            $video.style.height = style.height;\n            $video.style.position = 'absolute';\n            $video.style.zIndex = 2;\n            $tempVideo = $video;\n            $ctn.appendChild($video);\n          }\n        };\n        gallery.listen('initialZoomIn', changeHandle);\n        gallery.listen('afterChange', changeHandle);\n        gallery.listen('initialZoomOut', stopVideoHandle);\n      };\n\n      // loop through all gallery elements and bind events\n      var galleryElements = document.querySelectorAll(gallerySelector);\n      for (var i = 0, l = galleryElements.length; i < l; i++) {\n        galleryElements[i].setAttribute('data-pswp-uid', i + 1);\n        galleryElements[i].onclick = onThumbnailsClick;\n      }\n\n      // Parse URL and open gallery if it contains #&pid=3&gid=1\n      var hashData = photoswipeParseHash();\n      if (hashData.pid && hashData.gid) {\n        openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);\n      }\n    };\n\n    var Viewer = function() {\n      function init() {\n        initPhotoSwipeFromDOM('.photos');\n      }\n      return {\n        init: init\n      };\n    }();\n\n    module.exports = Viewer;\n\n    /***/\n  },\n  /* 3 */\n  /***/\n  function(module, exports) {\n\n    /* WEBPACK VAR INJECTION */\n    (function(global) {\n      module.exports = inViewport;\n\n      var instances = [];\n      var supportsMutationObserver = typeof global.MutationObserver === 'function';\n\n      function inViewport(elt, params, cb) {\n        var opts = {\n          container: global.document.body,\n          offset: 0\n        };\n\n        if (params === undefined || typeof params === 'function') {\n          cb = params;\n          params = {};\n        }\n\n        var container = opts.container = params.container || opts.container;\n        var offset = opts.offset = params.offset || opts.offset;\n\n        for (var i = 0; i < instances.length; i++) {\n          if (instances[i].container === container) {\n            return instances[i].isInViewport(elt, offset, cb);\n          }\n        }\n\n        return instances[\n          instances.push(createInViewport(container)) - 1\n        ].isInViewport(elt, offset, cb);\n      }\n\n      function addEvent(el, type, fn) {\n        if (el.attachEvent) {\n          el.attachEvent('on' + type, fn);\n        } else {\n          el.addEventListener(type, fn, false);\n        }\n      }\n\n      function debounce(func, wait, immediate) {\n        var timeout;\n        return function() {\n          var context = this,\n            args = arguments;\n          var callNow = immediate && !timeout;\n          clearTimeout(timeout);\n          timeout = setTimeout(later, wait);\n          if (callNow) func.apply(context, args);\n\n          function later() {\n            timeout = null;\n            if (!immediate) func.apply(context, args);\n          }\n        };\n      }\n\n      // https://github.com/jquery/sizzle/blob/3136f48b90e3edc84cbaaa6f6f7734ef03775a07/sizzle.js#L708\n      var contains = function() {\n        if (!global.document) {\n          return true;\n        }\n        return global.document.documentElement.compareDocumentPosition ?\n          function(a, b) {\n            return !!(a.compareDocumentPosition(b) & 16);\n          } :\n          global.document.documentElement.contains ?\n          function(a, b) {\n            return a !== b && (a.contains ? a.contains(b) : false);\n          } :\n          function(a, b) {\n            while (b = b.parentNode) {\n              if (b === a) {\n                return true;\n              }\n            }\n            return false;\n          };\n      }\n\n      function createInViewport(container) {\n        var watches = createWatches();\n\n        var scrollContainer = container === global.document.body ? global : container;\n        var debouncedCheck = debounce(watches.checkAll(watchInViewport), 15);\n\n        addEvent(scrollContainer, 'scroll', debouncedCheck);\n\n        if (scrollContainer === global) {\n          addEvent(global, 'resize', debouncedCheck);\n        }\n\n        if (supportsMutationObserver) {\n          observeDOM(watches, container, debouncedCheck);\n        }\n\n        // failsafe check, every 200ms we check for visible images\n        // usecase: a hidden parent containing eleements\n        // when the parent becomes visible, we have no event that the children\n        // became visible\n        setInterval(debouncedCheck, 150);\n\n        function isInViewport(elt, offset, cb) {\n          if (!cb) {\n            return isVisible(elt, offset);\n          }\n\n          var remote = createRemote(elt, offset, cb);\n          remote.watch();\n          return remote;\n        }\n\n        function createRemote(elt, offset, cb) {\n          function watch() {\n            watches.add(elt, offset, cb);\n          }\n\n          function dispose() {\n            watches.remove(elt);\n          }\n\n          return {\n            watch: watch,\n            dispose: dispose\n          };\n        }\n\n        function watchInViewport(elt, offset, cb) {\n          if (isVisible(elt, offset)) {\n            watches.remove(elt);\n            cb(elt);\n          }\n        }\n\n        function isVisible(elt, offset) {\n          if (!contains(global.document.documentElement, elt) || !contains(global.document.documentElement, container)) {\n            return false;\n          }\n\n          // Check if the element is visible\n          // https://github.com/jquery/jquery/blob/740e190223d19a114d5373758127285d14d6b71e/src/css/hiddenVisibleSelectors.js\n          if (!elt.offsetWidth || !elt.offsetHeight) {\n            return false;\n          }\n\n          var eltRect = elt.getBoundingClientRect();\n          var viewport = {};\n\n          if (container === global.document.body) {\n            viewport = {\n              top: -offset,\n              left: -offset,\n              right: global.document.documentElement.clientWidth + offset,\n              bottom: global.document.documentElement.clientHeight + offset\n            };\n          } else {\n            var containerRect = container.getBoundingClientRect();\n            viewport = {\n              top: containerRect.top - offset,\n              left: containerRect.left - offset,\n              right: containerRect.right + offset,\n              bottom: containerRect.bottom + offset\n            };\n          }\n\n          // The element must overlap with the visible part of the viewport\n          var visible =\n            (\n              (eltRect.right > viewport.left) &&\n              (eltRect.left < viewport.right) &&\n              (eltRect.bottom > viewport.top) &&\n              (eltRect.top < viewport.bottom)\n            );\n\n          return visible;\n        }\n\n        return {\n          container: container,\n          isInViewport: isInViewport\n        };\n      }\n\n      function createWatches() {\n        var watches = [];\n\n        function add(elt, offset, cb) {\n          if (!isWatched(elt)) {\n            watches.push([elt, offset, cb]);\n          }\n        }\n\n        function remove(elt) {\n          var pos = indexOf(elt);\n          if (pos !== -1) {\n            watches.splice(pos, 1);\n          }\n        }\n\n        function indexOf(elt) {\n          for (var i = watches.length - 1; i >= 0; i--) {\n            if (watches[i][0] === elt) {\n              return i;\n            }\n          }\n          return -1;\n        }\n\n        function isWatched(elt) {\n          return indexOf(elt) !== -1;\n        }\n\n        function checkAll(cb) {\n          return function() {\n            for (var i = watches.length - 1; i >= 0; i--) {\n              cb.apply(this, watches[i]);\n            }\n          };\n        }\n\n        return {\n          add: add,\n          remove: remove,\n          isWatched: isWatched,\n          checkAll: checkAll\n        };\n      }\n\n      function observeDOM(watches, container, cb) {\n        var observer = new MutationObserver(watch);\n        var filter = Array.prototype.filter;\n        var concat = Array.prototype.concat;\n\n        observer.observe(container, {\n          childList: true,\n          subtree: true,\n          // changes like style/width/height/display will be catched\n          attributes: true\n        });\n\n        function watch(mutations) {\n          // some new DOM nodes where previously watched\n          // we should check their positions\n          if (mutations.some(knownNodes) === true) {\n            setTimeout(cb, 0);\n          }\n        }\n\n        function knownNodes(mutation) {\n          var nodes = concat.call([],\n            Array.prototype.slice.call(mutation.addedNodes),\n            mutation.target\n          );\n          return filter.call(nodes, watches.isWatched).length > 0;\n        }\n      }\n\n      /* WEBPACK VAR INJECTION */\n    }.call(exports, (function() {\n      return this;\n    }())))\n\n    /***/\n  }\n  /******/\n]);","source":"photos/ins.js","raw":"/******/\n(function(modules) { // webpackBootstrap\n  /******/ // The module cache\n  /******/\n  var installedModules = {};\n  /******/\n  /******/ // The require function\n  /******/\n  function __webpack_require__(moduleId) {\n    /******/\n    /******/ // Check if module is in cache\n    /******/\n    if (installedModules[moduleId])\n    /******/\n      return installedModules[moduleId].exports;\n    /******/\n    /******/ // Create a new module (and put it into the cache)\n    /******/\n    var module = installedModules[moduleId] = {\n      /******/\n      exports: {},\n      /******/\n      id: moduleId,\n      /******/\n      loaded: false\n        /******/\n    };\n    /******/\n    /******/ // Execute the module function\n    /******/\n    modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n    /******/\n    /******/ // Flag the module as loaded\n    /******/\n    module.loaded = true;\n    /******/\n    /******/ // Return the exports of the module\n    /******/\n    return module.exports;\n    /******/\n  }\n  /******/\n  /******/\n  /******/ // expose the modules object (__webpack_modules__)\n  /******/\n  __webpack_require__.m = modules;\n  /******/\n  /******/ // expose the module cache\n  /******/\n  __webpack_require__.c = installedModules;\n  /******/\n  /******/ // __webpack_public_path__\n  /******/\n  __webpack_require__.p = \"/dist/\";\n  /******/\n  /******/ // Load entry module and return exports\n  /******/\n  return __webpack_require__(0);\n  /******/\n})\n/************************************************************************/\n/******/\n([\n  /* 0 */\n  /***/\n  function(module, exports, __webpack_require__) {\n\n    'use strict';\n\n    __webpack_require__(1);\n\n    var _view = __webpack_require__(2);\n\n    var _view2 = _interopRequireDefault(_view);\n\n    function _interopRequireDefault(obj) {\n      return obj && obj.__esModule ? obj : {\n        default: obj\n      };\n    }\n\n    /**\n     * @name impush-client \n     * @description ������Ŀ���ҷ����¸���\n     * @date 2016-12-1\n     */\n\n    var _collection = [];\n    var _count = 0;\n    var searchData;\n\n    function addMask(elem) {\n      var rect = elem.getBoundingClientRect();\n      var style = getComputedStyle(elem, null);\n\n      var mask = document.createElement('i');\n      mask.className = 'icon-film';\n      mask.style.color = '#fff';\n      mask.style.fontSize = '26px';\n      mask.style.position = 'absolute';\n      mask.style.right = '10px';\n      mask.style.bottom = '10px';\n      mask.style.zIndex = 1;\n      elem.parentNode.appendChild(mask);\n    }\n\n    var createVideoIncon = function createVideoIncon() {\n      var $videoImg = document.querySelectorAll('.thumb a[data-type=\"video\"]');\n      for (var i = 0, len = $videoImg.length; i < len; i++) {\n        addMask($videoImg[i]);\n      }\n    };\n    var render = function render(res) {\n      var ulTmpl = \"\";\n      for (var j = 0, len2 = res.list.length; j < len2; j++) {\n        var data = res.list[j].arr;\n        var liTmpl = \"\";\n        for (var i = 0, len = data.link.length; i < len; i++) {\n          var minSrc = 'https://raw.githubusercontent.com/lawlite19/blog-back-up/master/min_photos/' + data.link[i];\n          var src = 'https://raw.githubusercontent.com/lawlite19/blog-back-up/master/photos/' + data.link[i];\n          var type = data.type[i];\n          var target = src + (type === 'video' ? '.mp4' : '.jpg');\n          src += '';\n\n          liTmpl += '<figure class=\"thumb\" itemprop=\"associatedMedia\" itemscope=\"\" itemtype=\"http://schema.org/ImageObject\">\\\n                <a href=\"' + src + '\" itemprop=\"contentUrl\" data-size=\"1080x1080\" data-type=\"' + type + '\" data-target=\"' + src + '\">\\\n                  <img class=\"reward-img\" data-type=\"' + type + '\" data-src=\"' + minSrc + '\" src=\"/assets/img/empty.png\" itemprop=\"thumbnail\" onload=\"lzld(this)\">\\\n                </a>\\\n                <figcaption style=\"display:none\" itemprop=\"caption description\">' + data.text[i] + '</figcaption>\\\n            </figure>';\n        }\n        ulTmpl = ulTmpl + '<section class=\"archives album\"><h1 class=\"year\">' + data.year + '��<em>' + data.month + '��</em></h1>\\\n        <ul class=\"img-box-ul\">' + liTmpl + '</ul>\\\n        </section>';\n      }\n      document.querySelector('.instagram').innerHTML = '<div class=\"photos\" itemscope=\"\" itemtype=\"http://schema.org/ImageGallery\">' + ulTmpl + '</div>';\n      createVideoIncon();\n      _view2.default.init();\n    };\n\n    var replacer = function replacer(str) {\n      var arr = str.split(\"/\");\n      return \"/assets/ins/\" + arr[arr.length - 1];\n    };\n\n    var ctrler = function ctrler(data) {\n      var imgObj = {};\n      for (var i = 0, len = data.length; i < len; i++) {\n        var y = data[i].y;\n        var m = data[i].m;\n        var src = replacer(data[i].src);\n        var text = data[i].text;\n        var key = y + \"\" + ((m + \"\").length == 1 ? \"0\" + m : m);\n        if (imgObj[key]) {\n          imgObj[key].srclist.push(src);\n          imgObj[key].text.push(text);\n        } else {\n          imgObj[key] = {\n            year: y,\n            month: m,\n            srclist: [src],\n            text: [text]\n          };\n        }\n      }\n      render(imgObj);\n    };\n\n    function loadData(success) {\n      if (!searchData) {\n        var xhr = new XMLHttpRequest();\n        xhr.open('GET', './data.json?t=' + +new Date(), true);\n\n        xhr.onload = function() {\n          if (this.status >= 200 && this.status < 300) {\n            var res = JSON.parse(this.response);\n            searchData = res;\n            success(searchData);\n          } else {\n            console.error(this.statusText);\n          }\n        };\n\n        xhr.onerror = function() {\n          console.error(this.statusText);\n        };\n\n        xhr.send();\n      } else {\n        success(searchData);\n      }\n    }\n\n    var Ins = {\n      init: function init() {\n        loadData(function(data) {\n          render(data);\n        });\n      }\n    };\n\n    Ins.init();\n\n    // export default impush;\n\n    /***/\n  },\n  /* 1 */\n  /***/\n  function(module, exports, __webpack_require__) {\n\n    /* WEBPACK VAR INJECTION */\n    (function(global) {\n      'use strict';\n\n      var inViewport = __webpack_require__(3);\n      var lazyAttrs = ['data-src'];\n\n      global.lzld = lazyload();\n\n      // Provide libs using getAttribute early to get the good src\n      // and not the fake data-src\n      replaceGetAttribute('Image');\n      replaceGetAttribute('IFrame');\n\n      function registerLazyAttr(attr) {\n        if (indexOf.call(lazyAttrs, attr) === -1) {\n          lazyAttrs.push(attr);\n        }\n      }\n\n      function lazyload(opts) {\n        opts = merge({\n          'offset': 333,\n          'src': 'data-src',\n          'container': false\n        }, opts || {});\n\n        if (typeof opts.src === 'string') {\n          registerLazyAttr(opts.src);\n        }\n\n        var elts = [];\n\n        function show(elt) {\n          var src = findRealSrc(elt);\n\n          if (src) {\n            elt.src = src;\n          }\n\n          elt.setAttribute('data-lzled', true);\n          elts[indexOf.call(elts, elt)] = null;\n        }\n\n        function findRealSrc(elt) {\n          if (typeof opts.src === 'function') {\n            return opts.src(elt);\n          }\n\n          return elt.getAttribute(opts.src);\n        }\n\n        function register(elt) {\n          elt.onload = null;\n          elt.removeAttribute('onload');\n          elt.onerror = null;\n          elt.removeAttribute('onerror');\n\n          if (indexOf.call(elts, elt) === -1) {\n            inViewport(elt, opts, show);\n          }\n        }\n\n        return register;\n      }\n\n      function replaceGetAttribute(elementName) {\n        var fullname = 'HTML' + elementName + 'Element';\n        if (fullname in global === false) {\n          return;\n        }\n\n        var original = global[fullname].prototype.getAttribute;\n        global[fullname].prototype.getAttribute = function(name) {\n          if (name === 'src') {\n            var realSrc;\n            for (var i = 0, max = lazyAttrs.length; i < max; i++) {\n              realSrc = original.call(this, lazyAttrs[i]);\n              if (realSrc) {\n                break;\n              }\n            }\n\n            return realSrc || original.call(this, name);\n          }\n\n          // our own lazyloader will go through theses lines\n          // because we use getAttribute(opts.src)\n          return original.call(this, name);\n        };\n      }\n\n      function merge(defaults, opts) {\n        for (var name in defaults) {\n          if (opts[name] === undefined) {\n            opts[name] = defaults[name];\n          }\n        }\n\n        return opts;\n      }\n\n      // http://webreflection.blogspot.fr/2011/06/partial-polyfills.html\n      function indexOf(value) {\n        for (var i = this.length; i-- && this[i] !== value;) {}\n        return i;\n      }\n\n      module.exports = lazyload;\n\n      // export default impush;\n      /* WEBPACK VAR INJECTION */\n    }.call(exports, (function() {\n      return this;\n    }())))\n\n    /***/\n  },\n  /* 2 */\n  /***/\n  function(module, exports) {\n\n    'use strict';\n\n    var initPhotoSwipeFromDOM = function initPhotoSwipeFromDOM(gallerySelector) {\n\n      // parse slide data (url, title, size ...) from DOM elements \n      // (children of gallerySelector)\n      var parseThumbnailElements = function parseThumbnailElements(el) {\n        el = el.parentNode.parentNode;\n        var thumbElements = el.getElementsByClassName('thumb'),\n          numNodes = thumbElements.length,\n          items = [],\n          figureEl,\n          linkEl,\n          size,\n          type,\n          // video or not\n          target,\n          item;\n\n        for (var i = 0; i < numNodes; i++) {\n\n          figureEl = thumbElements[i]; // \n\n          // include only element nodes \n          if (figureEl.nodeType !== 1) {\n            continue;\n          }\n\n          linkEl = figureEl.children[0]; // \n\n          size = linkEl.getAttribute('data-size').split('x');\n          type = linkEl.getAttribute('data-type');\n          target = linkEl.getAttribute('data-target');\n          // create slide object\n          item = {\n            src: linkEl.getAttribute('href'),\n            w: parseInt(size[0], 10),\n            h: parseInt(size[1], 10)\n          };\n\n          if (figureEl.children.length > 1) {\n            item.title = figureEl.children[1].innerHTML;\n          }\n\n          if (linkEl.children.length > 0) {\n            item.msrc = linkEl.children[0].getAttribute('src');\n            item.type = type;\n            item.target = target;\n            item.html = '<video src=\"' + target + '\" controls=\"controls\" autoplay=\"autoplay\"></video>';\n            if (type === 'video') {\n              //item.src = null;\n            }\n          }\n\n          item.el = figureEl; // save link to element for getThumbBoundsFn\n          items.push(item);\n        }\n\n        return items;\n      };\n\n      // find nearest parent element\n      var closest = function closest(el, fn) {\n        return el && (fn(el) ? el : closest(el.parentNode, fn));\n      };\n\n      // triggers when user clicks on thumbnail\n      var onThumbnailsClick = function onThumbnailsClick(e) {\n        e = e || window.event;\n        e.preventDefault ? e.preventDefault() : e.returnValue = false;\n\n        var eTarget = e.target || e.srcElement;\n\n        // find root element of slide\n        var clickedListItem = closest(eTarget, function(el) {\n          return el.tagName && el.tagName.toUpperCase() === 'FIGURE';\n        });\n\n        if (!clickedListItem) {\n          return;\n        }\n\n        // find index of clicked item by looping through all child nodes\n        // alternatively, you may define index via data- attribute\n        var clickedGallery = clickedListItem.parentNode,\n\n          // childNodes = clickedListItem.parentNode.childNodes,\n          // numChildNodes = childNodes.length,\n          childNodes = document.getElementsByClassName('thumb'),\n          numChildNodes = childNodes.length,\n          nodeIndex = 0,\n          index;\n\n        for (var i = 0; i < numChildNodes; i++) {\n          if (childNodes[i].nodeType !== 1) {\n            continue;\n          }\n\n          if (childNodes[i] === clickedListItem) {\n            index = nodeIndex;\n            break;\n          }\n          nodeIndex++;\n        }\n\n        if (index >= 0) {\n          // open PhotoSwipe if valid index found\n          openPhotoSwipe(index, clickedGallery);\n        }\n        return false;\n      };\n\n      // parse picture index and gallery index from URL (#&pid=1&gid=2)\n      var photoswipeParseHash = function photoswipeParseHash() {\n        var hash = window.location.hash.substring(1),\n          params = {};\n\n        if (hash.length < 5) {\n          return params;\n        }\n\n        var vars = hash.split('&');\n        for (var i = 0; i < vars.length; i++) {\n          if (!vars[i]) {\n            continue;\n          }\n          var pair = vars[i].split('=');\n          if (pair.length < 2) {\n            continue;\n          }\n          params[pair[0]] = pair[1];\n        }\n\n        if (params.gid) {\n          params.gid = parseInt(params.gid, 10);\n        }\n\n        return params;\n      };\n\n      var openPhotoSwipe = function openPhotoSwipe(index, galleryElement, disableAnimation, fromURL) {\n        var pswpElement = document.querySelectorAll('.pswp')[0],\n          gallery,\n          options,\n          items;\n\n        items = parseThumbnailElements(galleryElement);\n        // define options (if needed)\n        options = {\n\n          // define gallery index (for URL)\n          galleryUID: galleryElement.getAttribute('data-pswp-uid'),\n\n          getThumbBoundsFn: function getThumbBoundsFn(index) {\n            // See Options -> getThumbBoundsFn section of documentation for more info\n            var thumbnail = items[index].el.getElementsByTagName('img')[0],\n              // find thumbnail\n              pageYScroll = window.pageYOffset || document.documentElement.scrollTop,\n              rect = thumbnail.getBoundingClientRect();\n\n            return {\n              x: rect.left,\n              y: rect.top + pageYScroll,\n              w: rect.width\n            };\n          }\n\n        };\n\n        // PhotoSwipe opened from URL\n        if (fromURL) {\n          if (options.galleryPIDs) {\n            // parse real index when custom PIDs are used \n            // http://photoswipe.com/documentation/faq.html#custom-pid-in-url\n            for (var j = 0; j < items.length; j++) {\n              if (items[j].pid == index) {\n                options.index = j;\n                break;\n              }\n            }\n          } else {\n            // in URL indexes start from 1\n            options.index = parseInt(index, 10) - 1;\n          }\n        } else {\n          options.index = parseInt(index, 10);\n        }\n\n        // exit if index not found\n        if (isNaN(options.index)) {\n          return;\n        }\n\n        if (disableAnimation) {\n          options.showAnimationDuration = 0;\n        }\n\n        // Pass data to PhotoSwipe and initialize it\n        gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);\n        gallery.init();\n\n        var $tempVideo;\n        var stopVideoHandle = function stopVideoHandle() {\n          if ($tempVideo) {\n            $tempVideo.remove();\n            $tempVideo = null;\n          }\n        };\n        var changeHandle = function changeHandle() {\n          var item = gallery.currItem;\n          stopVideoHandle();\n          if (item.type === 'video') {\n            var $ctn = item.container;\n            var style = $ctn.getElementsByClassName('pswp__img')[0].style;\n            var $video = document.createElement('video');\n            $video.setAttribute('autoplay', 'autoplay');\n            $video.setAttribute('controls', 'controls');\n            $video.setAttribute('src', item.target);\n            $video.style.width = style.width;\n            $video.style.height = style.height;\n            $video.style.position = 'absolute';\n            $video.style.zIndex = 2;\n            $tempVideo = $video;\n            $ctn.appendChild($video);\n          }\n        };\n        gallery.listen('initialZoomIn', changeHandle);\n        gallery.listen('afterChange', changeHandle);\n        gallery.listen('initialZoomOut', stopVideoHandle);\n      };\n\n      // loop through all gallery elements and bind events\n      var galleryElements = document.querySelectorAll(gallerySelector);\n      for (var i = 0, l = galleryElements.length; i < l; i++) {\n        galleryElements[i].setAttribute('data-pswp-uid', i + 1);\n        galleryElements[i].onclick = onThumbnailsClick;\n      }\n\n      // Parse URL and open gallery if it contains #&pid=3&gid=1\n      var hashData = photoswipeParseHash();\n      if (hashData.pid && hashData.gid) {\n        openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);\n      }\n    };\n\n    var Viewer = function() {\n      function init() {\n        initPhotoSwipeFromDOM('.photos');\n      }\n      return {\n        init: init\n      };\n    }();\n\n    module.exports = Viewer;\n\n    /***/\n  },\n  /* 3 */\n  /***/\n  function(module, exports) {\n\n    /* WEBPACK VAR INJECTION */\n    (function(global) {\n      module.exports = inViewport;\n\n      var instances = [];\n      var supportsMutationObserver = typeof global.MutationObserver === 'function';\n\n      function inViewport(elt, params, cb) {\n        var opts = {\n          container: global.document.body,\n          offset: 0\n        };\n\n        if (params === undefined || typeof params === 'function') {\n          cb = params;\n          params = {};\n        }\n\n        var container = opts.container = params.container || opts.container;\n        var offset = opts.offset = params.offset || opts.offset;\n\n        for (var i = 0; i < instances.length; i++) {\n          if (instances[i].container === container) {\n            return instances[i].isInViewport(elt, offset, cb);\n          }\n        }\n\n        return instances[\n          instances.push(createInViewport(container)) - 1\n        ].isInViewport(elt, offset, cb);\n      }\n\n      function addEvent(el, type, fn) {\n        if (el.attachEvent) {\n          el.attachEvent('on' + type, fn);\n        } else {\n          el.addEventListener(type, fn, false);\n        }\n      }\n\n      function debounce(func, wait, immediate) {\n        var timeout;\n        return function() {\n          var context = this,\n            args = arguments;\n          var callNow = immediate && !timeout;\n          clearTimeout(timeout);\n          timeout = setTimeout(later, wait);\n          if (callNow) func.apply(context, args);\n\n          function later() {\n            timeout = null;\n            if (!immediate) func.apply(context, args);\n          }\n        };\n      }\n\n      // https://github.com/jquery/sizzle/blob/3136f48b90e3edc84cbaaa6f6f7734ef03775a07/sizzle.js#L708\n      var contains = function() {\n        if (!global.document) {\n          return true;\n        }\n        return global.document.documentElement.compareDocumentPosition ?\n          function(a, b) {\n            return !!(a.compareDocumentPosition(b) & 16);\n          } :\n          global.document.documentElement.contains ?\n          function(a, b) {\n            return a !== b && (a.contains ? a.contains(b) : false);\n          } :\n          function(a, b) {\n            while (b = b.parentNode) {\n              if (b === a) {\n                return true;\n              }\n            }\n            return false;\n          };\n      }\n\n      function createInViewport(container) {\n        var watches = createWatches();\n\n        var scrollContainer = container === global.document.body ? global : container;\n        var debouncedCheck = debounce(watches.checkAll(watchInViewport), 15);\n\n        addEvent(scrollContainer, 'scroll', debouncedCheck);\n\n        if (scrollContainer === global) {\n          addEvent(global, 'resize', debouncedCheck);\n        }\n\n        if (supportsMutationObserver) {\n          observeDOM(watches, container, debouncedCheck);\n        }\n\n        // failsafe check, every 200ms we check for visible images\n        // usecase: a hidden parent containing eleements\n        // when the parent becomes visible, we have no event that the children\n        // became visible\n        setInterval(debouncedCheck, 150);\n\n        function isInViewport(elt, offset, cb) {\n          if (!cb) {\n            return isVisible(elt, offset);\n          }\n\n          var remote = createRemote(elt, offset, cb);\n          remote.watch();\n          return remote;\n        }\n\n        function createRemote(elt, offset, cb) {\n          function watch() {\n            watches.add(elt, offset, cb);\n          }\n\n          function dispose() {\n            watches.remove(elt);\n          }\n\n          return {\n            watch: watch,\n            dispose: dispose\n          };\n        }\n\n        function watchInViewport(elt, offset, cb) {\n          if (isVisible(elt, offset)) {\n            watches.remove(elt);\n            cb(elt);\n          }\n        }\n\n        function isVisible(elt, offset) {\n          if (!contains(global.document.documentElement, elt) || !contains(global.document.documentElement, container)) {\n            return false;\n          }\n\n          // Check if the element is visible\n          // https://github.com/jquery/jquery/blob/740e190223d19a114d5373758127285d14d6b71e/src/css/hiddenVisibleSelectors.js\n          if (!elt.offsetWidth || !elt.offsetHeight) {\n            return false;\n          }\n\n          var eltRect = elt.getBoundingClientRect();\n          var viewport = {};\n\n          if (container === global.document.body) {\n            viewport = {\n              top: -offset,\n              left: -offset,\n              right: global.document.documentElement.clientWidth + offset,\n              bottom: global.document.documentElement.clientHeight + offset\n            };\n          } else {\n            var containerRect = container.getBoundingClientRect();\n            viewport = {\n              top: containerRect.top - offset,\n              left: containerRect.left - offset,\n              right: containerRect.right + offset,\n              bottom: containerRect.bottom + offset\n            };\n          }\n\n          // The element must overlap with the visible part of the viewport\n          var visible =\n            (\n              (eltRect.right > viewport.left) &&\n              (eltRect.left < viewport.right) &&\n              (eltRect.bottom > viewport.top) &&\n              (eltRect.top < viewport.bottom)\n            );\n\n          return visible;\n        }\n\n        return {\n          container: container,\n          isInViewport: isInViewport\n        };\n      }\n\n      function createWatches() {\n        var watches = [];\n\n        function add(elt, offset, cb) {\n          if (!isWatched(elt)) {\n            watches.push([elt, offset, cb]);\n          }\n        }\n\n        function remove(elt) {\n          var pos = indexOf(elt);\n          if (pos !== -1) {\n            watches.splice(pos, 1);\n          }\n        }\n\n        function indexOf(elt) {\n          for (var i = watches.length - 1; i >= 0; i--) {\n            if (watches[i][0] === elt) {\n              return i;\n            }\n          }\n          return -1;\n        }\n\n        function isWatched(elt) {\n          return indexOf(elt) !== -1;\n        }\n\n        function checkAll(cb) {\n          return function() {\n            for (var i = watches.length - 1; i >= 0; i--) {\n              cb.apply(this, watches[i]);\n            }\n          };\n        }\n\n        return {\n          add: add,\n          remove: remove,\n          isWatched: isWatched,\n          checkAll: checkAll\n        };\n      }\n\n      function observeDOM(watches, container, cb) {\n        var observer = new MutationObserver(watch);\n        var filter = Array.prototype.filter;\n        var concat = Array.prototype.concat;\n\n        observer.observe(container, {\n          childList: true,\n          subtree: true,\n          // changes like style/width/height/display will be catched\n          attributes: true\n        });\n\n        function watch(mutations) {\n          // some new DOM nodes where previously watched\n          // we should check their positions\n          if (mutations.some(knownNodes) === true) {\n            setTimeout(cb, 0);\n          }\n        }\n\n        function knownNodes(mutation) {\n          var nodes = concat.call([],\n            Array.prototype.slice.call(mutation.addedNodes),\n            mutation.target\n          );\n          return filter.call(nodes, watches.isWatched).length > 0;\n        }\n      }\n\n      /* WEBPACK VAR INJECTION */\n    }.call(exports, (function() {\n      return this;\n    }())))\n\n    /***/\n  }\n  /******/\n]);","date":"2018-02-27T07:38:38.120Z","updated":"2018-02-27T07:38:38.120Z","path":"photos/ins.js","layout":"false","title":"","comments":1,"_id":"cjgd7qftg001lhwvfnrot5f3b","content":"/******/\n(function(modules) { // webpackBootstrap\n  /******/ // The module cache\n  /******/\n  var installedModules = {};\n  /******/\n  /******/ // The require function\n  /******/\n  function __webpack_require__(moduleId) {\n    /******/\n    /******/ // Check if module is in cache\n    /******/\n    if (installedModules[moduleId])\n    /******/\n      return installedModules[moduleId].exports;\n    /******/\n    /******/ // Create a new module (and put it into the cache)\n    /******/\n    var module = installedModules[moduleId] = {\n      /******/\n      exports: {},\n      /******/\n      id: moduleId,\n      /******/\n      loaded: false\n        /******/\n    };\n    /******/\n    /******/ // Execute the module function\n    /******/\n    modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n    /******/\n    /******/ // Flag the module as loaded\n    /******/\n    module.loaded = true;\n    /******/\n    /******/ // Return the exports of the module\n    /******/\n    return module.exports;\n    /******/\n  }\n  /******/\n  /******/\n  /******/ // expose the modules object (__webpack_modules__)\n  /******/\n  __webpack_require__.m = modules;\n  /******/\n  /******/ // expose the module cache\n  /******/\n  __webpack_require__.c = installedModules;\n  /******/\n  /******/ // __webpack_public_path__\n  /******/\n  __webpack_require__.p = \"/dist/\";\n  /******/\n  /******/ // Load entry module and return exports\n  /******/\n  return __webpack_require__(0);\n  /******/\n})\n/************************************************************************/\n/******/\n([\n  /* 0 */\n  /***/\n  function(module, exports, __webpack_require__) {\n\n    'use strict';\n\n    __webpack_require__(1);\n\n    var _view = __webpack_require__(2);\n\n    var _view2 = _interopRequireDefault(_view);\n\n    function _interopRequireDefault(obj) {\n      return obj && obj.__esModule ? obj : {\n        default: obj\n      };\n    }\n\n    /**\n     * @name impush-client \n     * @description ������Ŀ���ҷ����¸���\n     * @date 2016-12-1\n     */\n\n    var _collection = [];\n    var _count = 0;\n    var searchData;\n\n    function addMask(elem) {\n      var rect = elem.getBoundingClientRect();\n      var style = getComputedStyle(elem, null);\n\n      var mask = document.createElement('i');\n      mask.className = 'icon-film';\n      mask.style.color = '#fff';\n      mask.style.fontSize = '26px';\n      mask.style.position = 'absolute';\n      mask.style.right = '10px';\n      mask.style.bottom = '10px';\n      mask.style.zIndex = 1;\n      elem.parentNode.appendChild(mask);\n    }\n\n    var createVideoIncon = function createVideoIncon() {\n      var $videoImg = document.querySelectorAll('.thumb a[data-type=\"video\"]');\n      for (var i = 0, len = $videoImg.length; i < len; i++) {\n        addMask($videoImg[i]);\n      }\n    };\n    var render = function render(res) {\n      var ulTmpl = \"\";\n      for (var j = 0, len2 = res.list.length; j < len2; j++) {\n        var data = res.list[j].arr;\n        var liTmpl = \"\";\n        for (var i = 0, len = data.link.length; i < len; i++) {\n          var minSrc = 'https://raw.githubusercontent.com/lawlite19/blog-back-up/master/min_photos/' + data.link[i];\n          var src = 'https://raw.githubusercontent.com/lawlite19/blog-back-up/master/photos/' + data.link[i];\n          var type = data.type[i];\n          var target = src + (type === 'video' ? '.mp4' : '.jpg');\n          src += '';\n\n          liTmpl += '<figure class=\"thumb\" itemprop=\"associatedMedia\" itemscope=\"\" itemtype=\"http://schema.org/ImageObject\">\\\n                <a href=\"' + src + '\" itemprop=\"contentUrl\" data-size=\"1080x1080\" data-type=\"' + type + '\" data-target=\"' + src + '\">\\\n                  <img class=\"reward-img\" data-type=\"' + type + '\" data-src=\"' + minSrc + '\" src=\"/assets/img/empty.png\" itemprop=\"thumbnail\" onload=\"lzld(this)\">\\\n                </a>\\\n                <figcaption style=\"display:none\" itemprop=\"caption description\">' + data.text[i] + '</figcaption>\\\n            </figure>';\n        }\n        ulTmpl = ulTmpl + '<section class=\"archives album\"><h1 class=\"year\">' + data.year + '��<em>' + data.month + '��</em></h1>\\\n        <ul class=\"img-box-ul\">' + liTmpl + '</ul>\\\n        </section>';\n      }\n      document.querySelector('.instagram').innerHTML = '<div class=\"photos\" itemscope=\"\" itemtype=\"http://schema.org/ImageGallery\">' + ulTmpl + '</div>';\n      createVideoIncon();\n      _view2.default.init();\n    };\n\n    var replacer = function replacer(str) {\n      var arr = str.split(\"/\");\n      return \"/assets/ins/\" + arr[arr.length - 1];\n    };\n\n    var ctrler = function ctrler(data) {\n      var imgObj = {};\n      for (var i = 0, len = data.length; i < len; i++) {\n        var y = data[i].y;\n        var m = data[i].m;\n        var src = replacer(data[i].src);\n        var text = data[i].text;\n        var key = y + \"\" + ((m + \"\").length == 1 ? \"0\" + m : m);\n        if (imgObj[key]) {\n          imgObj[key].srclist.push(src);\n          imgObj[key].text.push(text);\n        } else {\n          imgObj[key] = {\n            year: y,\n            month: m,\n            srclist: [src],\n            text: [text]\n          };\n        }\n      }\n      render(imgObj);\n    };\n\n    function loadData(success) {\n      if (!searchData) {\n        var xhr = new XMLHttpRequest();\n        xhr.open('GET', './data.json?t=' + +new Date(), true);\n\n        xhr.onload = function() {\n          if (this.status >= 200 && this.status < 300) {\n            var res = JSON.parse(this.response);\n            searchData = res;\n            success(searchData);\n          } else {\n            console.error(this.statusText);\n          }\n        };\n\n        xhr.onerror = function() {\n          console.error(this.statusText);\n        };\n\n        xhr.send();\n      } else {\n        success(searchData);\n      }\n    }\n\n    var Ins = {\n      init: function init() {\n        loadData(function(data) {\n          render(data);\n        });\n      }\n    };\n\n    Ins.init();\n\n    // export default impush;\n\n    /***/\n  },\n  /* 1 */\n  /***/\n  function(module, exports, __webpack_require__) {\n\n    /* WEBPACK VAR INJECTION */\n    (function(global) {\n      'use strict';\n\n      var inViewport = __webpack_require__(3);\n      var lazyAttrs = ['data-src'];\n\n      global.lzld = lazyload();\n\n      // Provide libs using getAttribute early to get the good src\n      // and not the fake data-src\n      replaceGetAttribute('Image');\n      replaceGetAttribute('IFrame');\n\n      function registerLazyAttr(attr) {\n        if (indexOf.call(lazyAttrs, attr) === -1) {\n          lazyAttrs.push(attr);\n        }\n      }\n\n      function lazyload(opts) {\n        opts = merge({\n          'offset': 333,\n          'src': 'data-src',\n          'container': false\n        }, opts || {});\n\n        if (typeof opts.src === 'string') {\n          registerLazyAttr(opts.src);\n        }\n\n        var elts = [];\n\n        function show(elt) {\n          var src = findRealSrc(elt);\n\n          if (src) {\n            elt.src = src;\n          }\n\n          elt.setAttribute('data-lzled', true);\n          elts[indexOf.call(elts, elt)] = null;\n        }\n\n        function findRealSrc(elt) {\n          if (typeof opts.src === 'function') {\n            return opts.src(elt);\n          }\n\n          return elt.getAttribute(opts.src);\n        }\n\n        function register(elt) {\n          elt.onload = null;\n          elt.removeAttribute('onload');\n          elt.onerror = null;\n          elt.removeAttribute('onerror');\n\n          if (indexOf.call(elts, elt) === -1) {\n            inViewport(elt, opts, show);\n          }\n        }\n\n        return register;\n      }\n\n      function replaceGetAttribute(elementName) {\n        var fullname = 'HTML' + elementName + 'Element';\n        if (fullname in global === false) {\n          return;\n        }\n\n        var original = global[fullname].prototype.getAttribute;\n        global[fullname].prototype.getAttribute = function(name) {\n          if (name === 'src') {\n            var realSrc;\n            for (var i = 0, max = lazyAttrs.length; i < max; i++) {\n              realSrc = original.call(this, lazyAttrs[i]);\n              if (realSrc) {\n                break;\n              }\n            }\n\n            return realSrc || original.call(this, name);\n          }\n\n          // our own lazyloader will go through theses lines\n          // because we use getAttribute(opts.src)\n          return original.call(this, name);\n        };\n      }\n\n      function merge(defaults, opts) {\n        for (var name in defaults) {\n          if (opts[name] === undefined) {\n            opts[name] = defaults[name];\n          }\n        }\n\n        return opts;\n      }\n\n      // http://webreflection.blogspot.fr/2011/06/partial-polyfills.html\n      function indexOf(value) {\n        for (var i = this.length; i-- && this[i] !== value;) {}\n        return i;\n      }\n\n      module.exports = lazyload;\n\n      // export default impush;\n      /* WEBPACK VAR INJECTION */\n    }.call(exports, (function() {\n      return this;\n    }())))\n\n    /***/\n  },\n  /* 2 */\n  /***/\n  function(module, exports) {\n\n    'use strict';\n\n    var initPhotoSwipeFromDOM = function initPhotoSwipeFromDOM(gallerySelector) {\n\n      // parse slide data (url, title, size ...) from DOM elements \n      // (children of gallerySelector)\n      var parseThumbnailElements = function parseThumbnailElements(el) {\n        el = el.parentNode.parentNode;\n        var thumbElements = el.getElementsByClassName('thumb'),\n          numNodes = thumbElements.length,\n          items = [],\n          figureEl,\n          linkEl,\n          size,\n          type,\n          // video or not\n          target,\n          item;\n\n        for (var i = 0; i < numNodes; i++) {\n\n          figureEl = thumbElements[i]; // \n\n          // include only element nodes \n          if (figureEl.nodeType !== 1) {\n            continue;\n          }\n\n          linkEl = figureEl.children[0]; // \n\n          size = linkEl.getAttribute('data-size').split('x');\n          type = linkEl.getAttribute('data-type');\n          target = linkEl.getAttribute('data-target');\n          // create slide object\n          item = {\n            src: linkEl.getAttribute('href'),\n            w: parseInt(size[0], 10),\n            h: parseInt(size[1], 10)\n          };\n\n          if (figureEl.children.length > 1) {\n            item.title = figureEl.children[1].innerHTML;\n          }\n\n          if (linkEl.children.length > 0) {\n            item.msrc = linkEl.children[0].getAttribute('src');\n            item.type = type;\n            item.target = target;\n            item.html = '<video src=\"' + target + '\" controls=\"controls\" autoplay=\"autoplay\"></video>';\n            if (type === 'video') {\n              //item.src = null;\n            }\n          }\n\n          item.el = figureEl; // save link to element for getThumbBoundsFn\n          items.push(item);\n        }\n\n        return items;\n      };\n\n      // find nearest parent element\n      var closest = function closest(el, fn) {\n        return el && (fn(el) ? el : closest(el.parentNode, fn));\n      };\n\n      // triggers when user clicks on thumbnail\n      var onThumbnailsClick = function onThumbnailsClick(e) {\n        e = e || window.event;\n        e.preventDefault ? e.preventDefault() : e.returnValue = false;\n\n        var eTarget = e.target || e.srcElement;\n\n        // find root element of slide\n        var clickedListItem = closest(eTarget, function(el) {\n          return el.tagName && el.tagName.toUpperCase() === 'FIGURE';\n        });\n\n        if (!clickedListItem) {\n          return;\n        }\n\n        // find index of clicked item by looping through all child nodes\n        // alternatively, you may define index via data- attribute\n        var clickedGallery = clickedListItem.parentNode,\n\n          // childNodes = clickedListItem.parentNode.childNodes,\n          // numChildNodes = childNodes.length,\n          childNodes = document.getElementsByClassName('thumb'),\n          numChildNodes = childNodes.length,\n          nodeIndex = 0,\n          index;\n\n        for (var i = 0; i < numChildNodes; i++) {\n          if (childNodes[i].nodeType !== 1) {\n            continue;\n          }\n\n          if (childNodes[i] === clickedListItem) {\n            index = nodeIndex;\n            break;\n          }\n          nodeIndex++;\n        }\n\n        if (index >= 0) {\n          // open PhotoSwipe if valid index found\n          openPhotoSwipe(index, clickedGallery);\n        }\n        return false;\n      };\n\n      // parse picture index and gallery index from URL (#&pid=1&gid=2)\n      var photoswipeParseHash = function photoswipeParseHash() {\n        var hash = window.location.hash.substring(1),\n          params = {};\n\n        if (hash.length < 5) {\n          return params;\n        }\n\n        var vars = hash.split('&');\n        for (var i = 0; i < vars.length; i++) {\n          if (!vars[i]) {\n            continue;\n          }\n          var pair = vars[i].split('=');\n          if (pair.length < 2) {\n            continue;\n          }\n          params[pair[0]] = pair[1];\n        }\n\n        if (params.gid) {\n          params.gid = parseInt(params.gid, 10);\n        }\n\n        return params;\n      };\n\n      var openPhotoSwipe = function openPhotoSwipe(index, galleryElement, disableAnimation, fromURL) {\n        var pswpElement = document.querySelectorAll('.pswp')[0],\n          gallery,\n          options,\n          items;\n\n        items = parseThumbnailElements(galleryElement);\n        // define options (if needed)\n        options = {\n\n          // define gallery index (for URL)\n          galleryUID: galleryElement.getAttribute('data-pswp-uid'),\n\n          getThumbBoundsFn: function getThumbBoundsFn(index) {\n            // See Options -> getThumbBoundsFn section of documentation for more info\n            var thumbnail = items[index].el.getElementsByTagName('img')[0],\n              // find thumbnail\n              pageYScroll = window.pageYOffset || document.documentElement.scrollTop,\n              rect = thumbnail.getBoundingClientRect();\n\n            return {\n              x: rect.left,\n              y: rect.top + pageYScroll,\n              w: rect.width\n            };\n          }\n\n        };\n\n        // PhotoSwipe opened from URL\n        if (fromURL) {\n          if (options.galleryPIDs) {\n            // parse real index when custom PIDs are used \n            // http://photoswipe.com/documentation/faq.html#custom-pid-in-url\n            for (var j = 0; j < items.length; j++) {\n              if (items[j].pid == index) {\n                options.index = j;\n                break;\n              }\n            }\n          } else {\n            // in URL indexes start from 1\n            options.index = parseInt(index, 10) - 1;\n          }\n        } else {\n          options.index = parseInt(index, 10);\n        }\n\n        // exit if index not found\n        if (isNaN(options.index)) {\n          return;\n        }\n\n        if (disableAnimation) {\n          options.showAnimationDuration = 0;\n        }\n\n        // Pass data to PhotoSwipe and initialize it\n        gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);\n        gallery.init();\n\n        var $tempVideo;\n        var stopVideoHandle = function stopVideoHandle() {\n          if ($tempVideo) {\n            $tempVideo.remove();\n            $tempVideo = null;\n          }\n        };\n        var changeHandle = function changeHandle() {\n          var item = gallery.currItem;\n          stopVideoHandle();\n          if (item.type === 'video') {\n            var $ctn = item.container;\n            var style = $ctn.getElementsByClassName('pswp__img')[0].style;\n            var $video = document.createElement('video');\n            $video.setAttribute('autoplay', 'autoplay');\n            $video.setAttribute('controls', 'controls');\n            $video.setAttribute('src', item.target);\n            $video.style.width = style.width;\n            $video.style.height = style.height;\n            $video.style.position = 'absolute';\n            $video.style.zIndex = 2;\n            $tempVideo = $video;\n            $ctn.appendChild($video);\n          }\n        };\n        gallery.listen('initialZoomIn', changeHandle);\n        gallery.listen('afterChange', changeHandle);\n        gallery.listen('initialZoomOut', stopVideoHandle);\n      };\n\n      // loop through all gallery elements and bind events\n      var galleryElements = document.querySelectorAll(gallerySelector);\n      for (var i = 0, l = galleryElements.length; i < l; i++) {\n        galleryElements[i].setAttribute('data-pswp-uid', i + 1);\n        galleryElements[i].onclick = onThumbnailsClick;\n      }\n\n      // Parse URL and open gallery if it contains #&pid=3&gid=1\n      var hashData = photoswipeParseHash();\n      if (hashData.pid && hashData.gid) {\n        openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);\n      }\n    };\n\n    var Viewer = function() {\n      function init() {\n        initPhotoSwipeFromDOM('.photos');\n      }\n      return {\n        init: init\n      };\n    }();\n\n    module.exports = Viewer;\n\n    /***/\n  },\n  /* 3 */\n  /***/\n  function(module, exports) {\n\n    /* WEBPACK VAR INJECTION */\n    (function(global) {\n      module.exports = inViewport;\n\n      var instances = [];\n      var supportsMutationObserver = typeof global.MutationObserver === 'function';\n\n      function inViewport(elt, params, cb) {\n        var opts = {\n          container: global.document.body,\n          offset: 0\n        };\n\n        if (params === undefined || typeof params === 'function') {\n          cb = params;\n          params = {};\n        }\n\n        var container = opts.container = params.container || opts.container;\n        var offset = opts.offset = params.offset || opts.offset;\n\n        for (var i = 0; i < instances.length; i++) {\n          if (instances[i].container === container) {\n            return instances[i].isInViewport(elt, offset, cb);\n          }\n        }\n\n        return instances[\n          instances.push(createInViewport(container)) - 1\n        ].isInViewport(elt, offset, cb);\n      }\n\n      function addEvent(el, type, fn) {\n        if (el.attachEvent) {\n          el.attachEvent('on' + type, fn);\n        } else {\n          el.addEventListener(type, fn, false);\n        }\n      }\n\n      function debounce(func, wait, immediate) {\n        var timeout;\n        return function() {\n          var context = this,\n            args = arguments;\n          var callNow = immediate && !timeout;\n          clearTimeout(timeout);\n          timeout = setTimeout(later, wait);\n          if (callNow) func.apply(context, args);\n\n          function later() {\n            timeout = null;\n            if (!immediate) func.apply(context, args);\n          }\n        };\n      }\n\n      // https://github.com/jquery/sizzle/blob/3136f48b90e3edc84cbaaa6f6f7734ef03775a07/sizzle.js#L708\n      var contains = function() {\n        if (!global.document) {\n          return true;\n        }\n        return global.document.documentElement.compareDocumentPosition ?\n          function(a, b) {\n            return !!(a.compareDocumentPosition(b) & 16);\n          } :\n          global.document.documentElement.contains ?\n          function(a, b) {\n            return a !== b && (a.contains ? a.contains(b) : false);\n          } :\n          function(a, b) {\n            while (b = b.parentNode) {\n              if (b === a) {\n                return true;\n              }\n            }\n            return false;\n          };\n      }\n\n      function createInViewport(container) {\n        var watches = createWatches();\n\n        var scrollContainer = container === global.document.body ? global : container;\n        var debouncedCheck = debounce(watches.checkAll(watchInViewport), 15);\n\n        addEvent(scrollContainer, 'scroll', debouncedCheck);\n\n        if (scrollContainer === global) {\n          addEvent(global, 'resize', debouncedCheck);\n        }\n\n        if (supportsMutationObserver) {\n          observeDOM(watches, container, debouncedCheck);\n        }\n\n        // failsafe check, every 200ms we check for visible images\n        // usecase: a hidden parent containing eleements\n        // when the parent becomes visible, we have no event that the children\n        // became visible\n        setInterval(debouncedCheck, 150);\n\n        function isInViewport(elt, offset, cb) {\n          if (!cb) {\n            return isVisible(elt, offset);\n          }\n\n          var remote = createRemote(elt, offset, cb);\n          remote.watch();\n          return remote;\n        }\n\n        function createRemote(elt, offset, cb) {\n          function watch() {\n            watches.add(elt, offset, cb);\n          }\n\n          function dispose() {\n            watches.remove(elt);\n          }\n\n          return {\n            watch: watch,\n            dispose: dispose\n          };\n        }\n\n        function watchInViewport(elt, offset, cb) {\n          if (isVisible(elt, offset)) {\n            watches.remove(elt);\n            cb(elt);\n          }\n        }\n\n        function isVisible(elt, offset) {\n          if (!contains(global.document.documentElement, elt) || !contains(global.document.documentElement, container)) {\n            return false;\n          }\n\n          // Check if the element is visible\n          // https://github.com/jquery/jquery/blob/740e190223d19a114d5373758127285d14d6b71e/src/css/hiddenVisibleSelectors.js\n          if (!elt.offsetWidth || !elt.offsetHeight) {\n            return false;\n          }\n\n          var eltRect = elt.getBoundingClientRect();\n          var viewport = {};\n\n          if (container === global.document.body) {\n            viewport = {\n              top: -offset,\n              left: -offset,\n              right: global.document.documentElement.clientWidth + offset,\n              bottom: global.document.documentElement.clientHeight + offset\n            };\n          } else {\n            var containerRect = container.getBoundingClientRect();\n            viewport = {\n              top: containerRect.top - offset,\n              left: containerRect.left - offset,\n              right: containerRect.right + offset,\n              bottom: containerRect.bottom + offset\n            };\n          }\n\n          // The element must overlap with the visible part of the viewport\n          var visible =\n            (\n              (eltRect.right > viewport.left) &&\n              (eltRect.left < viewport.right) &&\n              (eltRect.bottom > viewport.top) &&\n              (eltRect.top < viewport.bottom)\n            );\n\n          return visible;\n        }\n\n        return {\n          container: container,\n          isInViewport: isInViewport\n        };\n      }\n\n      function createWatches() {\n        var watches = [];\n\n        function add(elt, offset, cb) {\n          if (!isWatched(elt)) {\n            watches.push([elt, offset, cb]);\n          }\n        }\n\n        function remove(elt) {\n          var pos = indexOf(elt);\n          if (pos !== -1) {\n            watches.splice(pos, 1);\n          }\n        }\n\n        function indexOf(elt) {\n          for (var i = watches.length - 1; i >= 0; i--) {\n            if (watches[i][0] === elt) {\n              return i;\n            }\n          }\n          return -1;\n        }\n\n        function isWatched(elt) {\n          return indexOf(elt) !== -1;\n        }\n\n        function checkAll(cb) {\n          return function() {\n            for (var i = watches.length - 1; i >= 0; i--) {\n              cb.apply(this, watches[i]);\n            }\n          };\n        }\n\n        return {\n          add: add,\n          remove: remove,\n          isWatched: isWatched,\n          checkAll: checkAll\n        };\n      }\n\n      function observeDOM(watches, container, cb) {\n        var observer = new MutationObserver(watch);\n        var filter = Array.prototype.filter;\n        var concat = Array.prototype.concat;\n\n        observer.observe(container, {\n          childList: true,\n          subtree: true,\n          // changes like style/width/height/display will be catched\n          attributes: true\n        });\n\n        function watch(mutations) {\n          // some new DOM nodes where previously watched\n          // we should check their positions\n          if (mutations.some(knownNodes) === true) {\n            setTimeout(cb, 0);\n          }\n        }\n\n        function knownNodes(mutation) {\n          var nodes = concat.call([],\n            Array.prototype.slice.call(mutation.addedNodes),\n            mutation.target\n          );\n          return filter.call(nodes, watches.isWatched).length > 0;\n        }\n      }\n\n      /* WEBPACK VAR INJECTION */\n    }.call(exports, (function() {\n      return this;\n    }())))\n\n    /***/\n  }\n  /******/\n]);","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"","more":"/******/\n(function(modules) { // webpackBootstrap\n  /******/ // The module cache\n  /******/\n  var installedModules = {};\n  /******/\n  /******/ // The require function\n  /******/\n  function __webpack_require__(moduleId) {\n    /******/\n    /******/ // Check if module is in cache\n    /******/\n    if (installedModules[moduleId])\n    /******/\n      return installedModules[moduleId].exports;\n    /******/\n    /******/ // Create a new module (and put it into the cache)\n    /******/\n    var module = installedModules[moduleId] = {\n      /******/\n      exports: {},\n      /******/\n      id: moduleId,\n      /******/\n      loaded: false\n        /******/\n    };\n    /******/\n    /******/ // Execute the module function\n    /******/\n    modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n    /******/\n    /******/ // Flag the module as loaded\n    /******/\n    module.loaded = true;\n    /******/\n    /******/ // Return the exports of the module\n    /******/\n    return module.exports;\n    /******/\n  }\n  /******/\n  /******/\n  /******/ // expose the modules object (__webpack_modules__)\n  /******/\n  __webpack_require__.m = modules;\n  /******/\n  /******/ // expose the module cache\n  /******/\n  __webpack_require__.c = installedModules;\n  /******/\n  /******/ // __webpack_public_path__\n  /******/\n  __webpack_require__.p = \"/dist/\";\n  /******/\n  /******/ // Load entry module and return exports\n  /******/\n  return __webpack_require__(0);\n  /******/\n})\n/************************************************************************/\n/******/\n([\n  /* 0 */\n  /***/\n  function(module, exports, __webpack_require__) {\n\n    'use strict';\n\n    __webpack_require__(1);\n\n    var _view = __webpack_require__(2);\n\n    var _view2 = _interopRequireDefault(_view);\n\n    function _interopRequireDefault(obj) {\n      return obj && obj.__esModule ? obj : {\n        default: obj\n      };\n    }\n\n    /**\n     * @name impush-client \n     * @description ������Ŀ���ҷ����¸���\n     * @date 2016-12-1\n     */\n\n    var _collection = [];\n    var _count = 0;\n    var searchData;\n\n    function addMask(elem) {\n      var rect = elem.getBoundingClientRect();\n      var style = getComputedStyle(elem, null);\n\n      var mask = document.createElement('i');\n      mask.className = 'icon-film';\n      mask.style.color = '#fff';\n      mask.style.fontSize = '26px';\n      mask.style.position = 'absolute';\n      mask.style.right = '10px';\n      mask.style.bottom = '10px';\n      mask.style.zIndex = 1;\n      elem.parentNode.appendChild(mask);\n    }\n\n    var createVideoIncon = function createVideoIncon() {\n      var $videoImg = document.querySelectorAll('.thumb a[data-type=\"video\"]');\n      for (var i = 0, len = $videoImg.length; i < len; i++) {\n        addMask($videoImg[i]);\n      }\n    };\n    var render = function render(res) {\n      var ulTmpl = \"\";\n      for (var j = 0, len2 = res.list.length; j < len2; j++) {\n        var data = res.list[j].arr;\n        var liTmpl = \"\";\n        for (var i = 0, len = data.link.length; i < len; i++) {\n          var minSrc = 'https://raw.githubusercontent.com/lawlite19/blog-back-up/master/min_photos/' + data.link[i];\n          var src = 'https://raw.githubusercontent.com/lawlite19/blog-back-up/master/photos/' + data.link[i];\n          var type = data.type[i];\n          var target = src + (type === 'video' ? '.mp4' : '.jpg');\n          src += '';\n\n          liTmpl += '<figure class=\"thumb\" itemprop=\"associatedMedia\" itemscope=\"\" itemtype=\"http://schema.org/ImageObject\">\\\n                <a href=\"' + src + '\" itemprop=\"contentUrl\" data-size=\"1080x1080\" data-type=\"' + type + '\" data-target=\"' + src + '\">\\\n                  <img class=\"reward-img\" data-type=\"' + type + '\" data-src=\"' + minSrc + '\" src=\"/assets/img/empty.png\" itemprop=\"thumbnail\" onload=\"lzld(this)\">\\\n                </a>\\\n                <figcaption style=\"display:none\" itemprop=\"caption description\">' + data.text[i] + '</figcaption>\\\n            </figure>';\n        }\n        ulTmpl = ulTmpl + '<section class=\"archives album\"><h1 class=\"year\">' + data.year + '��<em>' + data.month + '��</em></h1>\\\n        <ul class=\"img-box-ul\">' + liTmpl + '</ul>\\\n        </section>';\n      }\n      document.querySelector('.instagram').innerHTML = '<div class=\"photos\" itemscope=\"\" itemtype=\"http://schema.org/ImageGallery\">' + ulTmpl + '</div>';\n      createVideoIncon();\n      _view2.default.init();\n    };\n\n    var replacer = function replacer(str) {\n      var arr = str.split(\"/\");\n      return \"/assets/ins/\" + arr[arr.length - 1];\n    };\n\n    var ctrler = function ctrler(data) {\n      var imgObj = {};\n      for (var i = 0, len = data.length; i < len; i++) {\n        var y = data[i].y;\n        var m = data[i].m;\n        var src = replacer(data[i].src);\n        var text = data[i].text;\n        var key = y + \"\" + ((m + \"\").length == 1 ? \"0\" + m : m);\n        if (imgObj[key]) {\n          imgObj[key].srclist.push(src);\n          imgObj[key].text.push(text);\n        } else {\n          imgObj[key] = {\n            year: y,\n            month: m,\n            srclist: [src],\n            text: [text]\n          };\n        }\n      }\n      render(imgObj);\n    };\n\n    function loadData(success) {\n      if (!searchData) {\n        var xhr = new XMLHttpRequest();\n        xhr.open('GET', './data.json?t=' + +new Date(), true);\n\n        xhr.onload = function() {\n          if (this.status >= 200 && this.status < 300) {\n            var res = JSON.parse(this.response);\n            searchData = res;\n            success(searchData);\n          } else {\n            console.error(this.statusText);\n          }\n        };\n\n        xhr.onerror = function() {\n          console.error(this.statusText);\n        };\n\n        xhr.send();\n      } else {\n        success(searchData);\n      }\n    }\n\n    var Ins = {\n      init: function init() {\n        loadData(function(data) {\n          render(data);\n        });\n      }\n    };\n\n    Ins.init();\n\n    // export default impush;\n\n    /***/\n  },\n  /* 1 */\n  /***/\n  function(module, exports, __webpack_require__) {\n\n    /* WEBPACK VAR INJECTION */\n    (function(global) {\n      'use strict';\n\n      var inViewport = __webpack_require__(3);\n      var lazyAttrs = ['data-src'];\n\n      global.lzld = lazyload();\n\n      // Provide libs using getAttribute early to get the good src\n      // and not the fake data-src\n      replaceGetAttribute('Image');\n      replaceGetAttribute('IFrame');\n\n      function registerLazyAttr(attr) {\n        if (indexOf.call(lazyAttrs, attr) === -1) {\n          lazyAttrs.push(attr);\n        }\n      }\n\n      function lazyload(opts) {\n        opts = merge({\n          'offset': 333,\n          'src': 'data-src',\n          'container': false\n        }, opts || {});\n\n        if (typeof opts.src === 'string') {\n          registerLazyAttr(opts.src);\n        }\n\n        var elts = [];\n\n        function show(elt) {\n          var src = findRealSrc(elt);\n\n          if (src) {\n            elt.src = src;\n          }\n\n          elt.setAttribute('data-lzled', true);\n          elts[indexOf.call(elts, elt)] = null;\n        }\n\n        function findRealSrc(elt) {\n          if (typeof opts.src === 'function') {\n            return opts.src(elt);\n          }\n\n          return elt.getAttribute(opts.src);\n        }\n\n        function register(elt) {\n          elt.onload = null;\n          elt.removeAttribute('onload');\n          elt.onerror = null;\n          elt.removeAttribute('onerror');\n\n          if (indexOf.call(elts, elt) === -1) {\n            inViewport(elt, opts, show);\n          }\n        }\n\n        return register;\n      }\n\n      function replaceGetAttribute(elementName) {\n        var fullname = 'HTML' + elementName + 'Element';\n        if (fullname in global === false) {\n          return;\n        }\n\n        var original = global[fullname].prototype.getAttribute;\n        global[fullname].prototype.getAttribute = function(name) {\n          if (name === 'src') {\n            var realSrc;\n            for (var i = 0, max = lazyAttrs.length; i < max; i++) {\n              realSrc = original.call(this, lazyAttrs[i]);\n              if (realSrc) {\n                break;\n              }\n            }\n\n            return realSrc || original.call(this, name);\n          }\n\n          // our own lazyloader will go through theses lines\n          // because we use getAttribute(opts.src)\n          return original.call(this, name);\n        };\n      }\n\n      function merge(defaults, opts) {\n        for (var name in defaults) {\n          if (opts[name] === undefined) {\n            opts[name] = defaults[name];\n          }\n        }\n\n        return opts;\n      }\n\n      // http://webreflection.blogspot.fr/2011/06/partial-polyfills.html\n      function indexOf(value) {\n        for (var i = this.length; i-- && this[i] !== value;) {}\n        return i;\n      }\n\n      module.exports = lazyload;\n\n      // export default impush;\n      /* WEBPACK VAR INJECTION */\n    }.call(exports, (function() {\n      return this;\n    }())))\n\n    /***/\n  },\n  /* 2 */\n  /***/\n  function(module, exports) {\n\n    'use strict';\n\n    var initPhotoSwipeFromDOM = function initPhotoSwipeFromDOM(gallerySelector) {\n\n      // parse slide data (url, title, size ...) from DOM elements \n      // (children of gallerySelector)\n      var parseThumbnailElements = function parseThumbnailElements(el) {\n        el = el.parentNode.parentNode;\n        var thumbElements = el.getElementsByClassName('thumb'),\n          numNodes = thumbElements.length,\n          items = [],\n          figureEl,\n          linkEl,\n          size,\n          type,\n          // video or not\n          target,\n          item;\n\n        for (var i = 0; i < numNodes; i++) {\n\n          figureEl = thumbElements[i]; // \n\n          // include only element nodes \n          if (figureEl.nodeType !== 1) {\n            continue;\n          }\n\n          linkEl = figureEl.children[0]; // \n\n          size = linkEl.getAttribute('data-size').split('x');\n          type = linkEl.getAttribute('data-type');\n          target = linkEl.getAttribute('data-target');\n          // create slide object\n          item = {\n            src: linkEl.getAttribute('href'),\n            w: parseInt(size[0], 10),\n            h: parseInt(size[1], 10)\n          };\n\n          if (figureEl.children.length > 1) {\n            item.title = figureEl.children[1].innerHTML;\n          }\n\n          if (linkEl.children.length > 0) {\n            item.msrc = linkEl.children[0].getAttribute('src');\n            item.type = type;\n            item.target = target;\n            item.html = '<video src=\"' + target + '\" controls=\"controls\" autoplay=\"autoplay\"></video>';\n            if (type === 'video') {\n              //item.src = null;\n            }\n          }\n\n          item.el = figureEl; // save link to element for getThumbBoundsFn\n          items.push(item);\n        }\n\n        return items;\n      };\n\n      // find nearest parent element\n      var closest = function closest(el, fn) {\n        return el && (fn(el) ? el : closest(el.parentNode, fn));\n      };\n\n      // triggers when user clicks on thumbnail\n      var onThumbnailsClick = function onThumbnailsClick(e) {\n        e = e || window.event;\n        e.preventDefault ? e.preventDefault() : e.returnValue = false;\n\n        var eTarget = e.target || e.srcElement;\n\n        // find root element of slide\n        var clickedListItem = closest(eTarget, function(el) {\n          return el.tagName && el.tagName.toUpperCase() === 'FIGURE';\n        });\n\n        if (!clickedListItem) {\n          return;\n        }\n\n        // find index of clicked item by looping through all child nodes\n        // alternatively, you may define index via data- attribute\n        var clickedGallery = clickedListItem.parentNode,\n\n          // childNodes = clickedListItem.parentNode.childNodes,\n          // numChildNodes = childNodes.length,\n          childNodes = document.getElementsByClassName('thumb'),\n          numChildNodes = childNodes.length,\n          nodeIndex = 0,\n          index;\n\n        for (var i = 0; i < numChildNodes; i++) {\n          if (childNodes[i].nodeType !== 1) {\n            continue;\n          }\n\n          if (childNodes[i] === clickedListItem) {\n            index = nodeIndex;\n            break;\n          }\n          nodeIndex++;\n        }\n\n        if (index >= 0) {\n          // open PhotoSwipe if valid index found\n          openPhotoSwipe(index, clickedGallery);\n        }\n        return false;\n      };\n\n      // parse picture index and gallery index from URL (#&pid=1&gid=2)\n      var photoswipeParseHash = function photoswipeParseHash() {\n        var hash = window.location.hash.substring(1),\n          params = {};\n\n        if (hash.length < 5) {\n          return params;\n        }\n\n        var vars = hash.split('&');\n        for (var i = 0; i < vars.length; i++) {\n          if (!vars[i]) {\n            continue;\n          }\n          var pair = vars[i].split('=');\n          if (pair.length < 2) {\n            continue;\n          }\n          params[pair[0]] = pair[1];\n        }\n\n        if (params.gid) {\n          params.gid = parseInt(params.gid, 10);\n        }\n\n        return params;\n      };\n\n      var openPhotoSwipe = function openPhotoSwipe(index, galleryElement, disableAnimation, fromURL) {\n        var pswpElement = document.querySelectorAll('.pswp')[0],\n          gallery,\n          options,\n          items;\n\n        items = parseThumbnailElements(galleryElement);\n        // define options (if needed)\n        options = {\n\n          // define gallery index (for URL)\n          galleryUID: galleryElement.getAttribute('data-pswp-uid'),\n\n          getThumbBoundsFn: function getThumbBoundsFn(index) {\n            // See Options -> getThumbBoundsFn section of documentation for more info\n            var thumbnail = items[index].el.getElementsByTagName('img')[0],\n              // find thumbnail\n              pageYScroll = window.pageYOffset || document.documentElement.scrollTop,\n              rect = thumbnail.getBoundingClientRect();\n\n            return {\n              x: rect.left,\n              y: rect.top + pageYScroll,\n              w: rect.width\n            };\n          }\n\n        };\n\n        // PhotoSwipe opened from URL\n        if (fromURL) {\n          if (options.galleryPIDs) {\n            // parse real index when custom PIDs are used \n            // http://photoswipe.com/documentation/faq.html#custom-pid-in-url\n            for (var j = 0; j < items.length; j++) {\n              if (items[j].pid == index) {\n                options.index = j;\n                break;\n              }\n            }\n          } else {\n            // in URL indexes start from 1\n            options.index = parseInt(index, 10) - 1;\n          }\n        } else {\n          options.index = parseInt(index, 10);\n        }\n\n        // exit if index not found\n        if (isNaN(options.index)) {\n          return;\n        }\n\n        if (disableAnimation) {\n          options.showAnimationDuration = 0;\n        }\n\n        // Pass data to PhotoSwipe and initialize it\n        gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);\n        gallery.init();\n\n        var $tempVideo;\n        var stopVideoHandle = function stopVideoHandle() {\n          if ($tempVideo) {\n            $tempVideo.remove();\n            $tempVideo = null;\n          }\n        };\n        var changeHandle = function changeHandle() {\n          var item = gallery.currItem;\n          stopVideoHandle();\n          if (item.type === 'video') {\n            var $ctn = item.container;\n            var style = $ctn.getElementsByClassName('pswp__img')[0].style;\n            var $video = document.createElement('video');\n            $video.setAttribute('autoplay', 'autoplay');\n            $video.setAttribute('controls', 'controls');\n            $video.setAttribute('src', item.target);\n            $video.style.width = style.width;\n            $video.style.height = style.height;\n            $video.style.position = 'absolute';\n            $video.style.zIndex = 2;\n            $tempVideo = $video;\n            $ctn.appendChild($video);\n          }\n        };\n        gallery.listen('initialZoomIn', changeHandle);\n        gallery.listen('afterChange', changeHandle);\n        gallery.listen('initialZoomOut', stopVideoHandle);\n      };\n\n      // loop through all gallery elements and bind events\n      var galleryElements = document.querySelectorAll(gallerySelector);\n      for (var i = 0, l = galleryElements.length; i < l; i++) {\n        galleryElements[i].setAttribute('data-pswp-uid', i + 1);\n        galleryElements[i].onclick = onThumbnailsClick;\n      }\n\n      // Parse URL and open gallery if it contains #&pid=3&gid=1\n      var hashData = photoswipeParseHash();\n      if (hashData.pid && hashData.gid) {\n        openPhotoSwipe(hashData.pid, galleryElements[hashData.gid - 1], true, true);\n      }\n    };\n\n    var Viewer = function() {\n      function init() {\n        initPhotoSwipeFromDOM('.photos');\n      }\n      return {\n        init: init\n      };\n    }();\n\n    module.exports = Viewer;\n\n    /***/\n  },\n  /* 3 */\n  /***/\n  function(module, exports) {\n\n    /* WEBPACK VAR INJECTION */\n    (function(global) {\n      module.exports = inViewport;\n\n      var instances = [];\n      var supportsMutationObserver = typeof global.MutationObserver === 'function';\n\n      function inViewport(elt, params, cb) {\n        var opts = {\n          container: global.document.body,\n          offset: 0\n        };\n\n        if (params === undefined || typeof params === 'function') {\n          cb = params;\n          params = {};\n        }\n\n        var container = opts.container = params.container || opts.container;\n        var offset = opts.offset = params.offset || opts.offset;\n\n        for (var i = 0; i < instances.length; i++) {\n          if (instances[i].container === container) {\n            return instances[i].isInViewport(elt, offset, cb);\n          }\n        }\n\n        return instances[\n          instances.push(createInViewport(container)) - 1\n        ].isInViewport(elt, offset, cb);\n      }\n\n      function addEvent(el, type, fn) {\n        if (el.attachEvent) {\n          el.attachEvent('on' + type, fn);\n        } else {\n          el.addEventListener(type, fn, false);\n        }\n      }\n\n      function debounce(func, wait, immediate) {\n        var timeout;\n        return function() {\n          var context = this,\n            args = arguments;\n          var callNow = immediate && !timeout;\n          clearTimeout(timeout);\n          timeout = setTimeout(later, wait);\n          if (callNow) func.apply(context, args);\n\n          function later() {\n            timeout = null;\n            if (!immediate) func.apply(context, args);\n          }\n        };\n      }\n\n      // https://github.com/jquery/sizzle/blob/3136f48b90e3edc84cbaaa6f6f7734ef03775a07/sizzle.js#L708\n      var contains = function() {\n        if (!global.document) {\n          return true;\n        }\n        return global.document.documentElement.compareDocumentPosition ?\n          function(a, b) {\n            return !!(a.compareDocumentPosition(b) & 16);\n          } :\n          global.document.documentElement.contains ?\n          function(a, b) {\n            return a !== b && (a.contains ? a.contains(b) : false);\n          } :\n          function(a, b) {\n            while (b = b.parentNode) {\n              if (b === a) {\n                return true;\n              }\n            }\n            return false;\n          };\n      }\n\n      function createInViewport(container) {\n        var watches = createWatches();\n\n        var scrollContainer = container === global.document.body ? global : container;\n        var debouncedCheck = debounce(watches.checkAll(watchInViewport), 15);\n\n        addEvent(scrollContainer, 'scroll', debouncedCheck);\n\n        if (scrollContainer === global) {\n          addEvent(global, 'resize', debouncedCheck);\n        }\n\n        if (supportsMutationObserver) {\n          observeDOM(watches, container, debouncedCheck);\n        }\n\n        // failsafe check, every 200ms we check for visible images\n        // usecase: a hidden parent containing eleements\n        // when the parent becomes visible, we have no event that the children\n        // became visible\n        setInterval(debouncedCheck, 150);\n\n        function isInViewport(elt, offset, cb) {\n          if (!cb) {\n            return isVisible(elt, offset);\n          }\n\n          var remote = createRemote(elt, offset, cb);\n          remote.watch();\n          return remote;\n        }\n\n        function createRemote(elt, offset, cb) {\n          function watch() {\n            watches.add(elt, offset, cb);\n          }\n\n          function dispose() {\n            watches.remove(elt);\n          }\n\n          return {\n            watch: watch,\n            dispose: dispose\n          };\n        }\n\n        function watchInViewport(elt, offset, cb) {\n          if (isVisible(elt, offset)) {\n            watches.remove(elt);\n            cb(elt);\n          }\n        }\n\n        function isVisible(elt, offset) {\n          if (!contains(global.document.documentElement, elt) || !contains(global.document.documentElement, container)) {\n            return false;\n          }\n\n          // Check if the element is visible\n          // https://github.com/jquery/jquery/blob/740e190223d19a114d5373758127285d14d6b71e/src/css/hiddenVisibleSelectors.js\n          if (!elt.offsetWidth || !elt.offsetHeight) {\n            return false;\n          }\n\n          var eltRect = elt.getBoundingClientRect();\n          var viewport = {};\n\n          if (container === global.document.body) {\n            viewport = {\n              top: -offset,\n              left: -offset,\n              right: global.document.documentElement.clientWidth + offset,\n              bottom: global.document.documentElement.clientHeight + offset\n            };\n          } else {\n            var containerRect = container.getBoundingClientRect();\n            viewport = {\n              top: containerRect.top - offset,\n              left: containerRect.left - offset,\n              right: containerRect.right + offset,\n              bottom: containerRect.bottom + offset\n            };\n          }\n\n          // The element must overlap with the visible part of the viewport\n          var visible =\n            (\n              (eltRect.right > viewport.left) &&\n              (eltRect.left < viewport.right) &&\n              (eltRect.bottom > viewport.top) &&\n              (eltRect.top < viewport.bottom)\n            );\n\n          return visible;\n        }\n\n        return {\n          container: container,\n          isInViewport: isInViewport\n        };\n      }\n\n      function createWatches() {\n        var watches = [];\n\n        function add(elt, offset, cb) {\n          if (!isWatched(elt)) {\n            watches.push([elt, offset, cb]);\n          }\n        }\n\n        function remove(elt) {\n          var pos = indexOf(elt);\n          if (pos !== -1) {\n            watches.splice(pos, 1);\n          }\n        }\n\n        function indexOf(elt) {\n          for (var i = watches.length - 1; i >= 0; i--) {\n            if (watches[i][0] === elt) {\n              return i;\n            }\n          }\n          return -1;\n        }\n\n        function isWatched(elt) {\n          return indexOf(elt) !== -1;\n        }\n\n        function checkAll(cb) {\n          return function() {\n            for (var i = watches.length - 1; i >= 0; i--) {\n              cb.apply(this, watches[i]);\n            }\n          };\n        }\n\n        return {\n          add: add,\n          remove: remove,\n          isWatched: isWatched,\n          checkAll: checkAll\n        };\n      }\n\n      function observeDOM(watches, container, cb) {\n        var observer = new MutationObserver(watch);\n        var filter = Array.prototype.filter;\n        var concat = Array.prototype.concat;\n\n        observer.observe(container, {\n          childList: true,\n          subtree: true,\n          // changes like style/width/height/display will be catched\n          attributes: true\n        });\n\n        function watch(mutations) {\n          // some new DOM nodes where previously watched\n          // we should check their positions\n          if (mutations.some(knownNodes) === true) {\n            setTimeout(cb, 0);\n          }\n        }\n\n        function knownNodes(mutation) {\n          var nodes = concat.call([],\n            Array.prototype.slice.call(mutation.addedNodes),\n            mutation.target\n          );\n          return filter.call(nodes, watches.isWatched).length > 0;\n        }\n      }\n\n      /* WEBPACK VAR INJECTION */\n    }.call(exports, (function() {\n      return this;\n    }())))\n\n    /***/\n  }\n  /******/\n]);"},{"_content":"#post-instagram{\n\tpadding: 30px;\n}\n#post-instagram .article-entry{\n\tpadding-right: 0;\n}\n.instagram{\n\tposition: relative;\n\tmin-height: 500px;\n}\n.instagram img {\n\twidth: 100%;\n}\n.instagram .year {\n\tfont-size: 16px;\n}\n.instagram .open-ins{\n\tpadding: 10px 0;\n\tcolor: #cdcdcd;\n}\n.instagram .open-ins:hover{\n\tcolor: #657b83;\n}\n.instagram .year{\n\tdisplay: inline;\n}\n.instagram .thumb {\n\twidth: 25%;\n\theight: 0; \n\tpadding-bottom: 25%;\n\tposition: relative;\n\tdisplay: inline-block;\n\ttext-align: center;\n\tbackground: #ededed;\n\toutline: 1px solid #ddd;\n}\n.instagram .thumb a {\n\tposition: relative;\n}\n.instagram .album h1 em{\n\tfont-style: normal;\n\tfont-size: 14px;\n\tmargin-left: 10px;\n}\n.instagram .album ul{\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tclear: both;\n\twidth: 100%;\n\ttext-align: left;\n}\n.instagram .album li{\n\tlist-style: none;\n\tdisplay: inline-block;\n\tbox-sizing: border-box;\n\tpadding: 0 5px;\n\tmargin-bottom: -10px;\n\theight: 0;\n\twidth: 25%;\n\tposition: relative;\n\tpadding-bottom: 25%;\n}\n.instagram .album li:before{\n\tdisplay: none;\n}\n.instagram .album div.img-box{\n\tposition: absolute;\n\twidth: 90%;\n\theight: 90%;\n\t-webkit-box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n\t-moz-box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n\tbox-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n}\n.instagram .album div.img-box img{\n\twidth: 100%;\n\theight: 100%;\n    position: absolute;\n    z-index: 2;\n}\n.instagram .album div.img-box .img-bg{\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tbottom: 0px;\n\twidth: 100%;\n\tmargin: -5px;\n\tpadding: 5px;\n\t-webkit-box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\t-moz-box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\tbox-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\t-webkit-transition: all 0.15s ease-out 0.1s;\n\t-moz-transition: all 0.15s ease-out 0.1s;\n\t-o-transition: all 0.15s ease-out 0.1s;\n\ttransition: all 0.15s ease-out 0.1s;\n\topacity: 0.2;\n\tcursor: pointer;\n\tdisplay: block;\n\tz-index: 3;\n}\n.instagram .album div.img-box .icon {\n    font-size: 14px;\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    margin-left: -7px;\n    margin-top: -7px;\n    color: #999;\n    z-index: 1;\n}\n.instagram .album div.img-box .img-bg:hover{\n\topacity: 0;\n}\n.photos-btn-wrap {\n\tborder-bottom: 1px solid #e5e5e5;\n\tmargin-bottom: 20px;\n}\n.photos-btn {\n\tfont-size: 16px;\n\tcolor: #333;\n\tmargin-bottom: -4px;\n\tpadding: 5px 8px 3px;\n}\n.photos-btn.active {\n\tcolor: #08c;\n\tborder: 1px solid #e5e5e5;\n\tborder-bottom: 5px solid #fff;\n}\n\n@media screen and (max-width:600px) {\n\t.instagram .thumb {\n\t\twidth: 50%;\n\t\tpadding-bottom: 50%;\n\t}\n\t.instagram .album li {\n\t\twidth: 100%;\n\t\tposition: relative;\n\t\tpadding-bottom: 100%;\n\t\ttext-align: center;\n\t}\n\t.instagram .album div.img-box{\n\t\tmargin: 0;\n\t\twidth: 90%;\n\t\theight: 90%;\n\t}\n}","source":"photos/ins.css","raw":"#post-instagram{\n\tpadding: 30px;\n}\n#post-instagram .article-entry{\n\tpadding-right: 0;\n}\n.instagram{\n\tposition: relative;\n\tmin-height: 500px;\n}\n.instagram img {\n\twidth: 100%;\n}\n.instagram .year {\n\tfont-size: 16px;\n}\n.instagram .open-ins{\n\tpadding: 10px 0;\n\tcolor: #cdcdcd;\n}\n.instagram .open-ins:hover{\n\tcolor: #657b83;\n}\n.instagram .year{\n\tdisplay: inline;\n}\n.instagram .thumb {\n\twidth: 25%;\n\theight: 0; \n\tpadding-bottom: 25%;\n\tposition: relative;\n\tdisplay: inline-block;\n\ttext-align: center;\n\tbackground: #ededed;\n\toutline: 1px solid #ddd;\n}\n.instagram .thumb a {\n\tposition: relative;\n}\n.instagram .album h1 em{\n\tfont-style: normal;\n\tfont-size: 14px;\n\tmargin-left: 10px;\n}\n.instagram .album ul{\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tclear: both;\n\twidth: 100%;\n\ttext-align: left;\n}\n.instagram .album li{\n\tlist-style: none;\n\tdisplay: inline-block;\n\tbox-sizing: border-box;\n\tpadding: 0 5px;\n\tmargin-bottom: -10px;\n\theight: 0;\n\twidth: 25%;\n\tposition: relative;\n\tpadding-bottom: 25%;\n}\n.instagram .album li:before{\n\tdisplay: none;\n}\n.instagram .album div.img-box{\n\tposition: absolute;\n\twidth: 90%;\n\theight: 90%;\n\t-webkit-box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n\t-moz-box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n\tbox-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n}\n.instagram .album div.img-box img{\n\twidth: 100%;\n\theight: 100%;\n    position: absolute;\n    z-index: 2;\n}\n.instagram .album div.img-box .img-bg{\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tbottom: 0px;\n\twidth: 100%;\n\tmargin: -5px;\n\tpadding: 5px;\n\t-webkit-box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\t-moz-box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\tbox-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\t-webkit-transition: all 0.15s ease-out 0.1s;\n\t-moz-transition: all 0.15s ease-out 0.1s;\n\t-o-transition: all 0.15s ease-out 0.1s;\n\ttransition: all 0.15s ease-out 0.1s;\n\topacity: 0.2;\n\tcursor: pointer;\n\tdisplay: block;\n\tz-index: 3;\n}\n.instagram .album div.img-box .icon {\n    font-size: 14px;\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    margin-left: -7px;\n    margin-top: -7px;\n    color: #999;\n    z-index: 1;\n}\n.instagram .album div.img-box .img-bg:hover{\n\topacity: 0;\n}\n.photos-btn-wrap {\n\tborder-bottom: 1px solid #e5e5e5;\n\tmargin-bottom: 20px;\n}\n.photos-btn {\n\tfont-size: 16px;\n\tcolor: #333;\n\tmargin-bottom: -4px;\n\tpadding: 5px 8px 3px;\n}\n.photos-btn.active {\n\tcolor: #08c;\n\tborder: 1px solid #e5e5e5;\n\tborder-bottom: 5px solid #fff;\n}\n\n@media screen and (max-width:600px) {\n\t.instagram .thumb {\n\t\twidth: 50%;\n\t\tpadding-bottom: 50%;\n\t}\n\t.instagram .album li {\n\t\twidth: 100%;\n\t\tposition: relative;\n\t\tpadding-bottom: 100%;\n\t\ttext-align: center;\n\t}\n\t.instagram .album div.img-box{\n\t\tmargin: 0;\n\t\twidth: 90%;\n\t\theight: 90%;\n\t}\n}","date":"2018-02-27T07:38:38.118Z","updated":"2018-02-27T07:38:38.118Z","path":"photos/ins.css","layout":"false","title":"","comments":1,"_id":"cjgd7qfti001nhwvf8hugjzxf","content":"#post-instagram{\n\tpadding: 30px;\n}\n#post-instagram .article-entry{\n\tpadding-right: 0;\n}\n.instagram{\n\tposition: relative;\n\tmin-height: 500px;\n}\n.instagram img {\n\twidth: 100%;\n}\n.instagram .year {\n\tfont-size: 16px;\n}\n.instagram .open-ins{\n\tpadding: 10px 0;\n\tcolor: #cdcdcd;\n}\n.instagram .open-ins:hover{\n\tcolor: #657b83;\n}\n.instagram .year{\n\tdisplay: inline;\n}\n.instagram .thumb {\n\twidth: 25%;\n\theight: 0; \n\tpadding-bottom: 25%;\n\tposition: relative;\n\tdisplay: inline-block;\n\ttext-align: center;\n\tbackground: #ededed;\n\toutline: 1px solid #ddd;\n}\n.instagram .thumb a {\n\tposition: relative;\n}\n.instagram .album h1 em{\n\tfont-style: normal;\n\tfont-size: 14px;\n\tmargin-left: 10px;\n}\n.instagram .album ul{\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tclear: both;\n\twidth: 100%;\n\ttext-align: left;\n}\n.instagram .album li{\n\tlist-style: none;\n\tdisplay: inline-block;\n\tbox-sizing: border-box;\n\tpadding: 0 5px;\n\tmargin-bottom: -10px;\n\theight: 0;\n\twidth: 25%;\n\tposition: relative;\n\tpadding-bottom: 25%;\n}\n.instagram .album li:before{\n\tdisplay: none;\n}\n.instagram .album div.img-box{\n\tposition: absolute;\n\twidth: 90%;\n\theight: 90%;\n\t-webkit-box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n\t-moz-box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n\tbox-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n}\n.instagram .album div.img-box img{\n\twidth: 100%;\n\theight: 100%;\n    position: absolute;\n    z-index: 2;\n}\n.instagram .album div.img-box .img-bg{\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tbottom: 0px;\n\twidth: 100%;\n\tmargin: -5px;\n\tpadding: 5px;\n\t-webkit-box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\t-moz-box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\tbox-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\t-webkit-transition: all 0.15s ease-out 0.1s;\n\t-moz-transition: all 0.15s ease-out 0.1s;\n\t-o-transition: all 0.15s ease-out 0.1s;\n\ttransition: all 0.15s ease-out 0.1s;\n\topacity: 0.2;\n\tcursor: pointer;\n\tdisplay: block;\n\tz-index: 3;\n}\n.instagram .album div.img-box .icon {\n    font-size: 14px;\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    margin-left: -7px;\n    margin-top: -7px;\n    color: #999;\n    z-index: 1;\n}\n.instagram .album div.img-box .img-bg:hover{\n\topacity: 0;\n}\n.photos-btn-wrap {\n\tborder-bottom: 1px solid #e5e5e5;\n\tmargin-bottom: 20px;\n}\n.photos-btn {\n\tfont-size: 16px;\n\tcolor: #333;\n\tmargin-bottom: -4px;\n\tpadding: 5px 8px 3px;\n}\n.photos-btn.active {\n\tcolor: #08c;\n\tborder: 1px solid #e5e5e5;\n\tborder-bottom: 5px solid #fff;\n}\n\n@media screen and (max-width:600px) {\n\t.instagram .thumb {\n\t\twidth: 50%;\n\t\tpadding-bottom: 50%;\n\t}\n\t.instagram .album li {\n\t\twidth: 100%;\n\t\tposition: relative;\n\t\tpadding-bottom: 100%;\n\t\ttext-align: center;\n\t}\n\t.instagram .album div.img-box{\n\t\tmargin: 0;\n\t\twidth: 90%;\n\t\theight: 90%;\n\t}\n}","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"","more":"#post-instagram{\n\tpadding: 30px;\n}\n#post-instagram .article-entry{\n\tpadding-right: 0;\n}\n.instagram{\n\tposition: relative;\n\tmin-height: 500px;\n}\n.instagram img {\n\twidth: 100%;\n}\n.instagram .year {\n\tfont-size: 16px;\n}\n.instagram .open-ins{\n\tpadding: 10px 0;\n\tcolor: #cdcdcd;\n}\n.instagram .open-ins:hover{\n\tcolor: #657b83;\n}\n.instagram .year{\n\tdisplay: inline;\n}\n.instagram .thumb {\n\twidth: 25%;\n\theight: 0; \n\tpadding-bottom: 25%;\n\tposition: relative;\n\tdisplay: inline-block;\n\ttext-align: center;\n\tbackground: #ededed;\n\toutline: 1px solid #ddd;\n}\n.instagram .thumb a {\n\tposition: relative;\n}\n.instagram .album h1 em{\n\tfont-style: normal;\n\tfont-size: 14px;\n\tmargin-left: 10px;\n}\n.instagram .album ul{\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tclear: both;\n\twidth: 100%;\n\ttext-align: left;\n}\n.instagram .album li{\n\tlist-style: none;\n\tdisplay: inline-block;\n\tbox-sizing: border-box;\n\tpadding: 0 5px;\n\tmargin-bottom: -10px;\n\theight: 0;\n\twidth: 25%;\n\tposition: relative;\n\tpadding-bottom: 25%;\n}\n.instagram .album li:before{\n\tdisplay: none;\n}\n.instagram .album div.img-box{\n\tposition: absolute;\n\twidth: 90%;\n\theight: 90%;\n\t-webkit-box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n\t-moz-box-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n\tbox-shadow: 0 1px 0 rgba(255,255,255,0.4), 0 1px 0 1px rgba(255,255,255,0.1);\n}\n.instagram .album div.img-box img{\n\twidth: 100%;\n\theight: 100%;\n    position: absolute;\n    z-index: 2;\n}\n.instagram .album div.img-box .img-bg{\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tbottom: 0px;\n\twidth: 100%;\n\tmargin: -5px;\n\tpadding: 5px;\n\t-webkit-box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\t-moz-box-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\tbox-shadow: 0 0 0 1px rgba(0,0,0,.04), 0 1px 5px rgba(0,0,0,0.1);\n\t-webkit-transition: all 0.15s ease-out 0.1s;\n\t-moz-transition: all 0.15s ease-out 0.1s;\n\t-o-transition: all 0.15s ease-out 0.1s;\n\ttransition: all 0.15s ease-out 0.1s;\n\topacity: 0.2;\n\tcursor: pointer;\n\tdisplay: block;\n\tz-index: 3;\n}\n.instagram .album div.img-box .icon {\n    font-size: 14px;\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    margin-left: -7px;\n    margin-top: -7px;\n    color: #999;\n    z-index: 1;\n}\n.instagram .album div.img-box .img-bg:hover{\n\topacity: 0;\n}\n.photos-btn-wrap {\n\tborder-bottom: 1px solid #e5e5e5;\n\tmargin-bottom: 20px;\n}\n.photos-btn {\n\tfont-size: 16px;\n\tcolor: #333;\n\tmargin-bottom: -4px;\n\tpadding: 5px 8px 3px;\n}\n.photos-btn.active {\n\tcolor: #08c;\n\tborder: 1px solid #e5e5e5;\n\tborder-bottom: 5px solid #fff;\n}\n\n@media screen and (max-width:600px) {\n\t.instagram .thumb {\n\t\twidth: 50%;\n\t\tpadding-bottom: 50%;\n\t}\n\t.instagram .album li {\n\t\twidth: 100%;\n\t\tposition: relative;\n\t\tpadding-bottom: 100%;\n\t\ttext-align: center;\n\t}\n\t.instagram .album div.img-box{\n\t\tmargin: 0;\n\t\twidth: 90%;\n\t\theight: 90%;\n\t}\n}"}],"Post":[{"title":"Activiti5 流程框架","date":"2017-11-23T09:00:30.000Z","_content":"工作流(Workflow)，就是“业务过程的部分或整体在计算机应用环境下的自动化”，它主要解决的是“使在多个参与者之间按照某种预定义的规则传递文档、信息或任务的过程自动进行，从而实现某个预期的业务目标，或者促使此目标的实现”。\n<!--more-->\n\n# 1 Activiti简介\n\nActiviti5是由Alfresco软件在2010年5月17日发布的业务流程管理（BPM）框架，它是覆盖了业务流程管理、工作流、服务协作等领域的一个开源的、灵活的、易扩展的可执行流程语言框架。Activiti基于Apache许可的开源BPM平台，创始人Tom Baeyens是JBoss jBPM的项目架构师，它特色是提供了eclipse插件，开发人员可以通过插件直接绘画出业务流程图。\n\n## 1.1 工作流引擎\n\n这是Activiti的核心，负责生成流程运行时的各种实例及数据、监控和管理流程的运行。\n  \n## 1.2 BPMN2.0\n\n业务流程建模与标注（Business Process Model and Notation，BPMN) ，描述流程的基本符号，包括这些图元如何组合成一个业务流程图（Business Process Diagram）\n\n## 1.3 数据库\n\nActiviti的后台是有数据库的支持，所有的表都以ACT_开头。第二部分是表示表的用途的两个字母标识。 用途也和服务的API对应。\n\n 1. **ACT_RE_***: 'RE'表示repository。 这个前缀的表包含了流程定义和流程静态资源 （图片，规则，等等）。\n 2. **ACT_RU_***: 'RU'表示runtime。 这些运行时的表，包含流程实例，任务，变量，异步任务，等运行中的数据。 Activiti只在流程实例执行过程中保存这些数据， 在流程结束时就会删除这些记录。 这样运行时表可以一直很小速度很快。\n 3. **ACT_ID_***: 'ID'表示identity。 这些表包含身份信息，比如用户，组等等。\n 4. **ACT_HI_***: 'HI'表示history。 这些表包含历史数据，比如历史流程实例， 变量，任务等等。\n 5. **ACT_GE_***: 通用数据， 用于不同场景下。\n\n### 1.3.1 资源库流程规则表\n\n 1. act_re_deployment  部署信息表\n 2. act_re_mode        流程设计模型部署表\n 3. act_re_procdef     流程定义表\n\n### 1.3.2 运行时数据库\n\n 1. act_ru_execution    运行时流程执行实例表\n 2. act_ru_identitylink 运行时流程人员表，主要存储任务节点与参与者的相关信息\n 3. act_ru_task\t\t    运行时任务节点表\n 4. act_ru_variable\t    运行时流程变量数据表\n\n### 1.3.3 历史数据库表\n\n 1. act_hi_actinst \t\t    历史节点表\n 2. act_hi_attachment\t\t历史附件表\n 3. act_hi_comment\t\t    历史意见表\n 4. act_hi_identitylink\t\t历史流程人员表\n 5. act_hi_detail\t\t\t历史详情表，提供历史变量的查询\n 6. act_hi_procinst\t\t    历史流程实例表\n 7. act_hi_taskinst\t\t    历史任务实例表\n 8. act_hi_varinst\t\t    历史变量表\n\n### 1.3.4 组织机构表\n\n 1. act_id_group\t\t用户组信息表\n 2. act_id_info\t\t用户扩展信息表\n 3. act_id_membership\t用户与用户组对应信息表\n 4. act_id_user\t\t用户信息表\n\n这四张表很常见，基本的组织机构管理，关于用户认证方面建议还是自己开发一套，组件自带的功能太简单，使用中有很多需求难以满足 。可以使shiro完成用户认证。\n\n### 1.3.5 统用数据表\n\n 1. act_ge_bytearray\t\t二进制数据表\n 2. act_ge_property\t\t属性数据表存储整个流程引擎级别的数据,初始化表结构时，会默认插入三条记录\n\n## 1.4 activiti.cfg.xml\n\nActiviti核心配置文件，配置流程引擎创建工具的基本参数和数据库连接池参数。\n\n定义数据库配置参数：\n\n - jdbcUrl: 数据库的JDBC URL。\n - jdbcDriver: 对应不同数据库类型的驱动。\n - jdbcUsername: 连接数据库的用户名。\n - jdbcPassword: 连接数据库的密码。\n\n基于JDBC参数配置的数据库连接 会使用默认的MyBatis连接池。 下面的参数可以用来配置连接池（来自MyBatis参数）：\n\n - jdbcMaxActiveConnections: 连接池中处于被使用状态的连接的最大值。默认为10。\n - jdbcMaxIdleConnections: 连接池中处于空闲状态的连接的最大值。\n - jdbcMaxCheckoutTime: 连接被取出使用的最长时间，超过时间会被强制回收。 默认为20000（20秒）。\n - jdbcMaxWaitTime: 这是一个底层配置，让连接池可以在长时间无法获得连接时， 打印一条日志，并重新尝试获取一个连接。（避免因为错误配置导致沉默的操作失败）。 默认为20000（20秒）。\n\n\n示例如下：\n\n```xml\n  \t<bean name=\"processEngineConfiguration\" class=\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\">\n  \t\t<property name=\"JdbcDriver\" value=\"com.mysql.jdbc.Driver\" />\n  \t\t<property name=\"JdbcUrl\" value=\"jdbc:mysql://localhost:3306/activititest\"/>\n\t\t<property name=\"JdbcUsername\" value=\"root\" />\n\t\t<property name=\"JdbcPassword\" value=\"123\" />\n\t\t<!-- \n\t\t\tdatabaseSchemaUpdate：设置流程引擎启动和关闭时如何处理数据库表\n\t\t\tfalse（默认）:检查数据库表的版本和依赖库的版本，如果不一致就抛出异常\n\t\t\ttrue:构建流程引擎是执行检查，如果需要就更新，如果表不存在就创建\n\t\t\tcreate-drop：构建流程引擎是创建表，关闭时删除表  \n\t\t-->\n\t\t<property name=\"databaseSchemaUpdate\" value=\"true\" />\n  \t</bean>\n```\n\n关于c3p0、dbcp等数据库连接池配置请参看[spring(4)——持久层封装][1]\n\n## 1.5 logging.properties\n\n```xml\nlog4j.rootLogger=WARN, stdout\nlog4j.appender.stdout=org.apache.log4j.ConsoleAppender\nlog4j.appender.stdout.layout=org.apache.log4j.PatternLayout\nlog4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - %m%n\n```\n\n更详细log4j说明请参看[log4j.properties配置详解与实例][2]\n \n# 2 环境搭建\n\n## 2.1 需求java环境\n\n 1. JDK1.6或更高\n 2. 支持的数据库有：h2, mysql, oracle, postgres, mssql, db2等。\n 3. 支持activiti5运行的jar包\n 4. 开发环境为Eclipse3.7或者以上版本,myeclipse为8.6版本\n\n## 2.2 资源下载\n\nactiviti可以到[Activiti官方网站][3]下载得到。\n\n百度网盘下载地址，5.22.0和6.0.0两个版本，还有eclipse插件。[百度网盘下载][4]\n\n注意：安装插件后，在Windows->Preferences->Activiti->Save菜单下勾选保存时自动生成图片。\n\n## 2.3 配置开发环境\n\n### 2.3.1 添加jar包\n\n在activiti-5.22.0→wars目录下是一些示例项目，解压activiti-rest项目，导入activiti-rest目录中WEB-INF\\lib下所有jar包到classpath中。\n注意还需要数据库连接驱动包，如Mysql还需要添加**mysql-connector-java.jar**。\n\n### 2.3.2 初始化数据库\n\n```java\n@Test\npublic void createTable() {\n    //1、创建流程引擎配置对象\n\tProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration.createStandaloneProcessEngineConfiguration();\n\t//2、配置数据库\n\tprocessEngineConfiguration.setJdbcDriver(\"com.mysql.jdbc.Driver\");\n\tprocessEngineConfiguration.setJdbcUrl(\"jdbc:mysql://localhost:3306/activititest\");\n\tprocessEngineConfiguration.setJdbcUsername(\"root\");\n\tprocessEngineConfiguration.setJdbcPassword(\"123\");\n\t//3、设置建表策略\n\tprocessEngineConfiguration.setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE);\n\t//4、创建流程引擎对象\n\tProcessEngine processEngine = processEngineConfiguration.buildProcessEngine();\n\tSystem.out.println(\"processEngine\"+processEngine);\n}\n```\n在Activiti中，在创建核心的流程引擎对象时会自动建表。如果程序正常执行，mysql会自动建库，然后创建23张表。\n\n### 2.3.3 配置文件\n\n在Actiiti5中定制流程必定会操作到数据库，如果都像上面那样写一大段代码会非常麻烦，所以我们可以把数据库连接配置写入配置文件。\n  \n在Activiti5的官方示例中并没有现成的配置文件，所以先得找到activiti-rest\\WEB-INF\\classes下有：**activiti-context.xml**：一个类似spring结构的配置文件，清空内容后改名为activiti.cfg.xml，用来做流程引擎的相关配置。\n\n```xml\n  \t<bean name=\"processEngineConfiguration\" class=\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\">\n  \t\t<property name=\"JdbcDriver\" value=\"com.mysql.jdbc.Driver\" />\n  \t\t<property name=\"JdbcUrl\" value=\"jdbc:mysql://localhost:3306/activititest\"/>\n\t\t<property name=\"JdbcUsername\" value=\"root\" />\n\t\t<property name=\"JdbcPassword\" value=\"123\" />\n\t\t<!-- \n\t\t\tdatabaseSchemaUpdate：设置流程引擎启动和关闭时如何处理数据库表\n\t\t\tfalse（默认）:检查数据库表的版本和依赖库的版本，如果不一致就抛出异常\n\t\t\ttrue:构建流程引擎是执行检查，如果需要就更新，如果表不存在就创建\n\t\t\tcreate-drop：构建流程引擎是创建表，关闭时删除表  \n\t\t-->\n\t\t<property name=\"databaseSchemaUpdate\" value=\"true\" />\n  \t</bean>\n```\n\nJava代码如下：\n\n```java\n@Test\npublic void createTable2() {\n\tProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(\"activiti.cfg.xml\");\n\tProcessEngine processEngine = processEngineConfiguration.buildProcessEngine();\n}\n```\n\n# 3 核心API\n\n## 3.1 ProcessEngine\n\n 1. 在Activiti中最核心的类，其他的类都是由它而来。\n 2. 产生方式\n    2.1 方式一：最基础版本，见2.3.2小节\n    2.2 方式二：配置文件+java代码，见2.3.3小节\n    \n    ```java\n    @Test\n    public void createTable3() {\n    \tProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    }\n    ```\n    这种方式更加简单，会自动加载classpath下名为activiti.cfg.xml的文件。\n 3. 产生各种service\n \n    ```java\n    //流程仓库业务类，管理流程定义、部署\n    RepositoryService repositoryService = processEngine.getRepositoryService();\n    //流程运行业务类，管理流程启动、推进、删除等操作\n    RuntimeService runtimeService = processEngine.getRuntimeService();\n    //流程任务类，管理具体的任务\n    TaskService taskService = processEngine.getTaskService();\n    //流程历史数据类\n    HistoryService historyService = processEngine.getHistoryService();\n    //流程用户业务类\n    IdentityService identityService = processEngine.getIdentityService();\n    ```\n## 3.2 ReposityService\n\n流程仓库业务类，仓库简单理解即流程定义文档的两个文件：bpmn文件和流程图片\n\n 1. 产生流程部署配置对象，用来定义流程部署的相关参数\n\n    ```\n    @Test\n    public void Demo1() {\n    \tDeploymentBuilder deploymentBuilder = processEngine.getRepositoryService().createDeployment().name(\"test\");\n    \tdeploymentBuilder.addClasspathResource(\"diagrams/HelloWord.bpmn\");\n    \tdeploymentBuilder.addClasspathResource(\"diagrams/HelloWord.png\");\n    \t\n    \tDeployment deployment = deploymentBuilder.deploy();\n    \tSystem.out.println(deployment.getId() + \"。。。。\"+ deployment.getName());\n    }\n    ```\n 2. 删除流程定义\n\n    ```\n    repositoryService.deleteDeployment(deploymentId);\n    ```\n \n## 3.3 RuntimeService\n\n流程执行服务类。可以从这个类中获取很多关于流程执行相关的信息。\n\n 1. 启动流程\n \n    ```java\n    //常用的启动流程实例的两种方法\n    ProcessInstance processInstance = runtimeService.startProcessInstanceById(processInstanceId);\n    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(processInstanceKey);\n    ```\n\n## 3.4 TaskService\n\nactiviti的任务服务类。可以从这个类中获取任务的信息。\n\n## 3.5 ProcessDefinition\n\n流程定义类。可以从这里获得资源文件等。\n每个流程文件唯一对应一个相同key的流程定义，只是流程定义的version不同\n\n## 3.6 ProcessInstance\n\n流程实例。根据流程定义实例化的具体流程，我们可以利用这个对象来了解当前流程实例的进度等信息。\n如：\n    公司有一个所有人通用的请假流程，这个叫做流程定义。\n    小明今天请假，填写请假单，就是创建了一个流程实例。\n\n```java\n/** Represents one execution of a  {@link ProcessDefinition}.\n 1. \n 2. @author Tom Baeyens\n 3. @author Joram Barrez\n 4. @author Daniel Meyer\n 5. @author Tijs Rademakers\n */\npublic interface ProcessInstance extends Execution {\n```\n\n从上面可以看出ProcessInstance就是Execution，但实际有点区别\n\n 1. 单线流程中，ProcessInstance与Execution是一致的，ID都一样\n 2. 多线 流程中，总线路代表ProcessInstance，而分线路中每个活动代表Execution。\n\n## 3.7 Execution\n\nActiviti用这个对象去描述流程执行的每一个节点。在没有并发的情况下，同ProcessInstance。\n\n# 4 流程定义\n\n## 4.1 创建流程文件\n\n在classpath下创建流程文件\n![创建][5]\n编辑流程文件\n![编辑][6]\n\n## 4.2 部署流程定义\n\n部署流程定义可以看成是添加流程定义\n```java\n@Test\npublic void deploy() {\n    //创建流程引擎\n    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    //创建流程部署对象\n    DeploymentBuilder deploymentBuilder = processEngine.getRepositoryService().createDeployment();\n    //读取文件部署流程\n    Deployment deploy = deploymentBuilder.name(\"测试\")\n                            .addClasspathResource(\"diagrams/HelloWord.bpmn\")\n                            .addClasspathResource(\"diagrams/HelloWord.png\")\n                            .deploy();\n    \n    System.out.println(deploy.getId() + \"。。。\" + deploy.getName());\n}\n```\n\n**部署流程会改变3张表**\n\n - act_re_deployment\n\t存放流程定义的显示名和部署时间，每部署一次增加一条记录\n - act_re_procdef\n\t存放流程定义的属性信息，部署每个新的流程定义都会在这张表中增加一条记录。\n - act_ge_bytearray\n\t存储流程定义相关的部署信息。即流程定义文档的存放地。每部署一次就会增加两条记录，一条是关于bpmn规则文件的，一条是图片的（如果部署时只指定了bpmn一个文件，activiti会在部署时解析bpmn文件内容自动生成流程图）。两个文件不是很大，都是以二进制形式存储在数据库中。\n\n## 4.3 查看流程定义\n\n```java\n@Test\npublic void view() {\n    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();\n    List<ProcessDefinition> list = repositoryService.createProcessDefinitionQuery()\n                                        //过滤条件\n                                        .processDefinitionKey(\"HelloWorld\")\n                                        //.processDefinitionId(processDefinitionId)\n                                        //分页\n                                        //.listPage(firstResult, maxResults)\n                                        //排序\n                                        //.orderByProcessDefinitionVersion()\n                                        //执行查询\n                                        .list();\n    for (ProcessDefinition processDefinition : list) {\n        System.out.print(\"id:\" + processDefinition.getId() + \",\");//流程Id\n        System.out.print(\"key:\" + processDefinition.getKey() + \",\");//流程Key\n        System.out.print(\"name:\" + processDefinition.getName() + \",\");//流程名字\n        System.out.print(\"version:\" + processDefinition.getVersion() + \",\");//流程版本\n        System.out.println(\"deploymentId():\" + processDefinition.getDeploymentId());//流程部署对象Id\n    }\n}\n```\n查询结果\n\n    id:HelloWorld:1:35004,key:HelloWorld,name:请假审批流程,version:1,deploymentId():35001\n再部署一次，再查询\n\n    id:HelloWorld:1:35004,key:HelloWorld,name:请假审批流程,version:1,deploymentId():35001\n    id:HelloWorld:2:37504,key:HelloWorld,name:请假审批流程,version:2,deploymentId():37501\n    \n说明：\n    \n\n 1. 因为流程定义的信息在仓库中，实际在act_re_*表中，所以创建RepositoryService\n 2. 创建查询对象**ProcessDefinitionQuery**，设置查询参数，调用list()执行查询\n 3. 由查询结果可知：\n    3.1 流程定义的key和name与流程文件的id和name一致\n\n    ```xml\n    <process id=\"HelloWorld\" name=\"请假审批流程\" isExecutable=\"true\">\n    ```\n    3.2 key属性被用来区别不同的流程定义。\n    3.3 带有特定key的流程定义第一次部署时，version为1。之后每次部署都会在当前最高版本号上加1\n    3.4 Id的生成规则为：**{processDefinitionKey}:{processDefinitionVersion}:{generated-id}**，这里的generated-id是一个自动生成的唯一的数字\n    3.5 重复部署一次，deploymentId的值以一定的形式变化\n    \n## 4.4 删除流程定义\n\n删除部署到activiti中的流程定义。如:删除请假流程定义，则大家再也不能请假了。\n\n```java\n@Test\npublic void delete() {\n    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();\n    String deploymentId = \"7501\";\n    //如果有关联信息，会报错\n    //repositoryService.deleteDeployment(deploymentId);\n    //如果有关联信息，会级联删除\n    repositoryService.deleteDeployment(deploymentId, true);\n}\n```\n\n## 4.5 获取流程定义文档资源\n\n```java\n@Test\npublic void getResource() throws IOException {\n    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();\n   \n    String deploymentId = \"35001\";\n    String resourceName = null;\n    //资源文件名,即act_re_bytearray表中的name\n    List<String> names = repositoryService.getDeploymentResourceNames(deploymentId);\n    for (String str : names) {\n        //过滤出特定的图片文件\n        if (str.indexOf(\"HelloWorld.png\") != -1) {\n            resourceName = str;\n        }\n    }\n    System.out.println(resourceName);\n    if (resourceName != null) {\n        //通过部署ID和文件名获得输入流\n        InputStream inputStream = repositoryService.getResourceAsStream(deploymentId, resourceName);\n        File file = new File(\"D:/\"+ resourceName);\n        FileUtils.copyInputStreamToFile(inputStream, file);\n    }\n}\n```\n    \n# 5 流程实例\n\n## 5.1 启动流程实例\n\n```java\n@Test\npublic void startProcess() {\n    RuntimeService runtimeService = ProcessEngines.getDefaultProcessEngine().getRuntimeService();\n    //根据流程Id启动流程\n    //ProcessInstance processInstance = runtimeService.startProcessInstanceById(processDefinitionId);\n    //根据流程key启动流程，会自动找到版本最高的流程定义来创建\n    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(\"HelloWorld\");\n    System.out.println(processInstance.getId());//流程实例Id\n    System.out.println(processInstance.getActivityId());//流程当前节点Id\n}\n```\n    启动流程实例有很多重载方法，根据实际需要选用。\n\n## 5.2 查询任务\n\n在Activiti中，任务主要分为两类：\n\n 1. 确切指定了办理者的任务，之歌任务称为制定者的私人任务\n 2. 2.无法指定具体的某一个人来办理的任务，可以把任务分配给几个人或者一到\t多个小组，让这个范围内的用户可以选择性（如有空余时间时）来办理这类任务。\n\n```java\n@Test\npublic void taskQuery() {\n    TaskService taskService = ProcessEngines.getDefaultProcessEngine().getTaskService();\n    List<Task> list = taskService.createTaskQuery()\n            //查询指定用户的私人任务\n            //.taskAssignee(\"指定用户\")\n            //查询某人可接的共有任务\n            //.taskCandidateUser(\"候选用户\")\n            //排序\n            .orderByTaskCreateTime().desc()\n            //执行查询\n            .list();\n    for (Task task : list) {\n        System.out.println(\"id:\" + task.getId());\n        System.out.println(\"name:\" + task.getName());\n        System.out.println(\"assignee:\" + task.getAssignee());\n        System.out.println(\"createTime:\" + task.getCreateTime());\n        System.out.println(\"ProcessInstanceId:\" + task.getProcessInstanceId());\n        System.out.println(\"ProcessDefinitionId:\" + task.getProcessDefinitionId());\n    }\n}\n```\n\n## 5.3 认领任务\n\n```java\ntaskService.claim(taskId, userId);\n```\n将任务变为用户的私人任务\n\n## 5.4 办理任务\n\n```java\n//根据任务Id办理任务\ntaskService.complete(taskId);\n//根据任务Id办理任务,并设置任务变量\ntaskService.complete(taskId, variables);\n```\n\nvariables是Map，当设置变量时，会在act_ru_variables表中添加相应条数的数据，变量可以用来执行gateway的判断，后面会讲到gateway。\n\n## 5.5 判断流程是否结束\n\n在流程执行过程中，创建的流程实例ID在整个过程都不会变，当流程结束后，流程实例将被删除。\n\n 1. 从运行库中查询该流程是否还存在\n 2. 从历史库中查询该流程是否存在\n\n```java\n@Test\npublic String checkStatus() {\n    String processInstanceId = \"1213\";\n    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    RuntimeService runtimeService = processEngine.getRuntimeService();\n    //从运行库查询该流程实例是否存在\n    ProcessInstance instance = runtimeService.createProcessInstanceQuery()\n                                    .processInstanceId(processInstanceId)\n                                    .singleResult();\n    //实例不存在，可能未开始或者已结束\n    if (instance == null) {\n        //从历史库查\n        HistoryService historyService = processEngine.getHistoryService();\n        HistoricProcessInstance singleResult = historyService.createHistoricProcessInstanceQuery()\n                                                .processInstanceId(processInstanceId)\n                                                .singleResult();\n        if (singleResult != null && singleResult.getEndTime() != null) {\n            //流程已结束\n            return \"COMPLETE\";\n        } else {\n            //流程未开始\n            return \"NOT_START\";\n        }\n    }\n    return instance.getActivityId();//当前任务节点\n}\n```\n \n# 6 流程历史\n\n在前一个的例子中，大家可能会流程执行完毕后，究竟去了哪里有些疑问。虽然已完成的任务在act_ru_task和act_ru_execution表中都已被删除，但是这些数据还存在activiti的数据库中，作为历史改由HistoryService来管理。\n\n历史是一个组件，它可以捕获发生在进程执行中的信息并永久的保存，与运行时数据不同的是，当流程实例运行完成之后它还会存在于数据库中。\n\n在流程引擎配置对象中可以设置历史记录规则：\n\n```xml\n<bean name=\"processEngineConfiguration\" \n  \t  class=\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\">\n\t<property name=\"databaseSchemaUpdate\" value=\"true\" />\n\t<!--\n\t\tActiviti提供了四种历史级别：\n\t\tnone:不保存任何历史，可以提高性能\n\t\tactiviti:保存所有流程实例、任务、活动信息\n\t\taudit:默认级别,保存所有流程实例、任务、活动、表单\n\t\tfull:保存所有信息,如流程变量\n\t  -->\n\t<property name=\"history\" value=\"activiti\"/>\n```\n由于数据库中保存着历史信息以及正在运行的流程实例信息，在实际项目中对已完成任务的查看频率远不及对代办和可接任务的查看，所以在activiti采用分开管理，把正在运行的交给runtimeService管理，而历史数据交给HistoryService来管理。\n\n对已成为历史的数据主要进行查询操作，我们主要关心两种类型的历史数据：\n\n - **HistoricProcessInstance** 包含当前和已经结束的流程实例信息。\n - **HistoricActivityInstance** 包含一个活动(流程上的节点)的执行信息。\n\n## 6.1 查看历史流程实例\n\n```java\n@Test\npublic void queryHisInstance() {\n    //流程引擎\n    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    //流程定义ID\n    String processDefinitionId = \"HelloWorld:2:37504\";\n    //查询历史流程实例\n    List<HistoricProcessInstance> list = processEngine.getHistoryService().createHistoricProcessInstanceQuery()\n                                        .processDefinitionId(processDefinitionId)\n                                        .finished()\n                                        .orderByProcessInstanceStartTime().desc()\n                                        .list();\n    for (HistoricProcessInstance hp : list) {\n        System.out.println(\"ID：\"+hp.getId());\n        System.out.println(\"startTime：\"+hp.getStartTime());\n        System.out.println(\"endTime：\"+hp.getEndTime());\n    }\n}\n```\n\n1.通常查询历史流程实例都需要指定一个过滤条件，指定\tprocessDefinitionId查看具体某一次部署所开启的流程或者指定\tprocessDefinitionKey查看某个规则下不限版本的所有流程\n\n2.可以选择性添加finished方法控制是否查询未完成的流程实例。在流\t程开启时，activiti同时在act_ru_execution表和act_hi_procinst表中\t创建了一条记录，在流程完成之前act_hi_procinst表中实例的结束时间为空\n\n\n## 6.2 查看历史流程活动（节点）\n\n```java\n@Test\npublic void queryHisActiviti() {\n    //流程引擎\n    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    //流程实例ID\n    String processInstanceId = \"HelloWorld:2:37504\";\n    //查询历史流程活动\n    List<HistoricActivityInstance> list = processEngine.getHistoryService()\n                                        //创建历史流程活动实例查询对象\n                                        .createHistoricActivityInstanceQuery()\n                                        //过滤条件\n                                        .processInstanceId(processInstanceId)\n                                        //排序\n                                        .orderByHistoricActivityInstanceStartTime().desc()\n                                        //执行查询\n                                        .list();\n    for (HistoricActivityInstance ha : list) {\n        System.out.println(\"ID：\"+ha.getActivityId());\n        System.out.println(\"name:\"+ha.getActivityName());\n        System.out.println(\"startTime：\"+ha.getStartTime());\n        System.out.println(\"endTime：\"+ha.getEndTime());\n    }\n}\n```\n\n通常查询历史流程活动都需要指定一个过滤条件，指定processInstanceId查看具体某一次流程执行过程中所经历的步奏\n\n# 7 流程变量\n\n流程变量在整个工作流中扮演很重要的作用。例如：请假流程中有请假天数、请假原因等一些参数都为流程变量的范围。\n流程变量的作用域范围是流程实例。也就是说各个流程实例的流程变量是不相互影响的。\n流程实例结束完成以后流程变量是否保存在数据库中取决于存储策略，见第六章。\n![流程变量][7]\n\n## 7.1 添加流程变量\n\n 1. 启动流程实例时添加\n    ```java\n    @Test\n    public void addVariables() {\n        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n        RuntimeService runtimeService = processEngine.getRuntimeService();\n        \n        String processDefinitionKey = \"HelloWorld\";\n        Map<String,Object> variables = new HashMap<>();\n        variables.put(\"请假天数\", 3);\n        variables.put(\"请假原因\", \"约会\");\n        ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(processDefinitionKey, variables);\n    }\n    ```\n    说明：\n        1)\t在启动流程实例时，通过重载startProcessInstanceByKey的方法可以加载流程变量。\n        2)\t第二个参数要求是Map<String ,Object>类型，意味着可以添加多个流程变量。\n        3)\t当这段代码执行完以后，会在数据库表act_ru_variable中添加两行记录。\n        \n\n 2. 完成任务时添加\n    ```java\n    //办理过程中\n    taskService.setVariables(taskId, variables);\n    //提交时\n    taskService.complete(taskId, variables);\n    ```\n    \n 3. 执行流程实例时添加\n    ```java\n    //执行流程实例时\n    runtimeService.setVariables(executionId, variables);\n    //流程实例提交时\n    runtimeService.signal(executionId, processVariables);//signal用于接受任务\n    ```\n    \n## 7.2 获取流程变量\n\n```java\n//某个流程的变量\nruntimeService.getVariables(executionId);\n//某个任务的变量\ntaskService.getVariables(taskId);\n```\n\n说明：这些流程变量是从act_ru_variable这个表中读出来的。\n\n## 7.3 流程变量范围\n\n![此处输入图片的描述][8]\n\n从图中可以看出包括了大部分封装类型和Date、String和实现了Serializable接口的类的类型。\n\n## 7.4 Javabean类型变量\n\n 1. 定义一个javabean，这个javabean实现了Serializable接口\n 2. 实例化javaBean，放到map中，然后正常设置流程变量\n 3. 正常取出变量\n\n# 8 流程定义语言\n\n## 8.1 流程（Process）\n\nbpmn文件一个流程的根元素。一个流程就代表一个工作流。\n\n## 8.2 顺序流（sequenceFlow）\n\n顺序流是连接两个流程节点的连线，代表一个节点的出口。流程执行完一个节点后，会沿着节点的所有外出顺序流继续执行。 就是说，BPMN 2.0默认的行为就是并发的： 两个外出顺序流会创造两个单独的，并发流程分支。\n\n顺序流主要由4个属性组成：\n\n - Id: 唯一标示，用来区分不同的顺序流\n - sourceRef：连线的源头节点ID\n - targetRef：连线的目标节点ID\n - name（可选）：连线的名称，不涉及业务，主要用于显示\n\n## 8.3 节点\n\n### 8.3.1 开始事件节点(startEvent)\n开始事件用来指明流程在哪里开始。开始事件的类型（流程在接收事件时启动， 还是在指定时间启动，等等），定义了流程如何启动， 这通过事件中不同的小图表来展示。 在XML中，这些类型是通过声明不同的子元素来区分的。\n![此处输入图片的描述][9]\n\n 1. 空开始事件\n    空开始事件技术上意味着没有指定启动流程实例的触发条件。最常用的一种开始，意味着流程的启动需要手动触发，通过调用api的startProcessInstanceByXXX方法。\n    ```java\n    ProcessInstance processInstance = runtimeService.startProcessInstanceByXXX()\n    ```\n    图形标记：空开始事件显示成一个圆圈，没有内部图表（没有触发类型）\n    XML结构如下：\n    ```xml\n    <startEvent id=\"startevent\" name=\"Start\"></startEvent>\n    ```\n\n 2. 定时开始事件\n\n    定时开始事件用来在指定的时间创建流程实例。 它可以同时用于只启动一次的流程 和应该在特定时间间隔启动多次的流程。\n\n        注意：\n        1.子流程不能使用定时开始事件。\n        2.定时开始事件在流程发布后就会开始计算时间。不需要调用startProcessInstanceByXXX，虽然也而已调用启动流程的方法，但是那会导致调用startProcessInstanceByXXX时启动过多的流程。\n        3.当包含定时开始事件的新版本流程部署时，对应的上一个定时器就会被删除。这是因为通常不希望自动启动旧版本流程的流程实例。\n    \n    图形标记：定时开始事件显示为一个圆圈，内部是一个表。\n    XML内容：定时开始事件的XML内容是普通开始事件的声明，包含一个定时定义子元素。 \n    示例：流程会启动4次，每次间隔5分钟，从2013年9月18日，12:10开始计时。\n    ```xml\n    <startEvent id=\"theStart\">\n        <timerEventDefinition>                \n\t\t    <timeCycle>R4/2017-11-22T11:04/PT5M</timeCycle>            \t\t \n\t    </timerEventDefinition>\n    </startEvent> \n    ```\n    示例：流程会根据选中的时间启动一次。\n    ```xml\n    <startEvent id=\"theStart\">\n        <timerEventDefinition>                \n\t\t    <timeDate>2017-12-31T23:59:59</timeDate>               \t\t \n\t    </timerEventDefinition>\n    </startEvent> \n    ```\n \n### 8.3.2 结束事件节点(endEvent)\n\n结束事件表示（子）流程（分支）的结束。结束事件都是触发事件。这是说当流程达结束事件，会触发一个结果。 结果的类型是通过事件的内部黑色图标表示的。\n![结束事件][10]\n\n 1. 空结束事件\n \n    空结束事件意味着到达事件时不会指定抛出的结果。这样，引擎会直接结束当前执行的分支，不会做其他事情。\n    图形标记:空结束事件是一个粗边圆圈，内部没有小图表（无结果类型）\n    XML内容:空结束事件的XML内容是普通结束事件定义，不包含子元素（其他结束事件类型都会包含声明类型的子元素）。\n    ```xml\n    <endEvent id=\"end\" name=\"my end event\"/>\n    ```\n\n### 8.3.3 任务节点(Task)\n\n![任务节点][11]\n\n 1. 用户任务节点\n    用户任务用来设置必须由人员完成的工作。当流程执行到用户任务，会创建一个新任务，并把这个新任务加入到分配人或群组的任务列表中。\n    图形标记：用户任务显示成一个普通任务（圆角矩形），左上角有一个小用户图标。\n    XML内容：XML中的用户任务定义如下。id属性是必须的。 name属性是可选的。\n    ```xml\n    <userTask id=\"theTask\" name=\"Important task\"/>  \n    ```\n    用户任务也可以设置描述(实际上所有BPMN 2.0元素都可以设置描述)。 添加documentation元素可以定义描述。\n    ```xml\n    <userTask id=\"theTask\" name=\"Schedule meeting\">  \n    <documentation>\n        Schedule an engineering meeting for next week with the new hire.  \n    </documentation>\n    ```\n    在实际应用中，用户接到任务后可以参照任务描述来办理任务，描述文本可以通过标准的java方法来获得：\n    ```java\n    task.getDescription() \n    ```\n**私人任务**\n    私有任务即有直接分配给指定用户的任务。只有一个用户可以成为任务的执行者。 在activiti中，用户叫做执行者。 拥有执行者的用户任务（即私有任务）对其他用户是不可见的。只能出现执行者的个人任务列表中.\n    直接把用户任务分配给指定用户使用assignee属性，XML代码如下：\n    ```xml\n    <userTask id=\"theTask\" name=\"my task\" activiti:assignee=\"username\"/>\n    ```\n    Assignee属性对应的值为一个用户的ID。\n    直接分配给用户的任务可以通过TaskService像下面这样办理：\n    ```java\n    List<Task>tasks =taskService.createTaskQuery().taskAssignee(\"sirius\").list();\nTask task = tasks.get(0);// 假设任务集合的第一条是要办理的任务\ntaskService.complete(task.getId());\n\n    ```\n **公有任务**\n    有的用户任务在指派时无法确定具体的办理者，这时任务也可以加入到\t人员的候选任务列表中，然后让这些人员选择性认领和办理任务。\n    \n    公有任务的分配可以分为指定候选用户和候选组两种。\n\n    -  把任务添加到一批用户的候选任务列表中，使用candidateUsers\t属\t性，XML内容如下:\n    ```xml\n    <userTaskid=\"theTask\"name=\"my task\"activiti:candidateUsers=\"sirius,kermit\"/>\n    ```\n    candidateUsers属性内为用户的ID，多个用户ID之间使用（半角）逗号间隔。\n    \n     - 把任务添加到一个或多个候选组下，这时任务对组下的所有用户可见，首先得保证每个组下面有用户，通过IdentityService对象创建用户和组，然后把用户添加到对应的组下。然后配置组任务，使用candidateGroups属性，XML内容如下：\n    ```xml\n    <userTask id=\"theTask\" name=\"my task\" activiti:candidateGroups=\"testGroup，developGroup\"/>\n    ```\n    间接分配给用户的任务，可以通过TaskService像下面这样操作：\n    ```java\n    List<Task>tasks =taskService.createTaskQuery()\n\t\t\t\t.taskCandidateUser(\"sirius\").list();\n    Task task = tasks.get(0);// 假设任务集合的第一条是要办理的任务\n    String taskId = task.getId();\n    taskService.claim(taskId ,“sirius”); //认领任务，让用户成为任务的执行者\n    taskService.complete(taskId );\n    ```\n\n    说明：\n    \n     1. 要维护用户和组得使用用户管理服务对象，使用\t\tprocessEngine\t得到IdentityService。\n     2. 要分配组任务必须先创建组，而且组下得有用户，用户和组的\t最关键属性是ID。\n     3. 使用newUser（userId）和newGroup（groupId）创建用户和组。\n     4. 使用createMembership（userId，groupId）把用户挂到组下。\n     5. 办理候选任务，首先得认领任务，让用户成为任务的执行者\n    \n    如果上面的方式还不够灵活，那么我们也可以自定义一个任务分配处理器，通过代码的方式来动态设置任务的属性。XML代码如下：\n    ```xml\n    <userTask id=\"task1\" name=\"My task\"> \n        <extensionElements>    \n            <activiti:taskListener event=\"create\" class=\"org.activiti.MyAssignmentHandler\"/>  \n        </extensionElements>\n    </userTask>\n    ```\n    DelegateTask会传递给TaskListener的实现，通过它可以设置执行人，候选人和候选组：\n    ```java\n    Public class MyAssignmentHandler implements TaskListener {\n      \n        Public void notify(DelegateTask delegateTask){ \n    \t// 执行用户搜索相关代码    \n    \t...\n    \t// 然后把获取到的用户通过下面方法，设置给当前触发事件的任务\n        \tdelegateTask.setAssignee(\"sirius\");\n        \t//delegateTask.addCandidateUser(\"kermit\");\n       \t//delegateTask.addCandidateGroup(\"testGroup\"); \n       \t...  \n        }\n    }\n    ```\n\n 2. 接收任务节点（receiveTask）\n\n    接收任务是一个简单任务，它会等待对应消息的到达。当前，官方只实现了这个任务的java语义。 当流程达到接收任务，流程状态会保存到数据库中。在任务创建后，意味着流程会进入等待状态，直到引擎接收了一个特定的消息，这会触发流程穿过接收任务继续执行。\n    \n    图形标记：接收任务显示为一个任务（圆角矩形），右上角有一个消息小标记。 消息是白色的（黑色图标表示发送语义）。\n    \n    XML内容：\n    ```xml\n    <receiveTask id=\"waitState\" name=\"wait\"/> \n    ```\n    \n    当前任务（一般指机器自动完成，但需要耗费一定时间的工作）完成后，向后推移流程，可以调用runtimeService.signal(executionId)，传递接收任务上流程的id。\n    ```java\n    ProcessInstance pi = runtimeService.startProcessInstanceByKey(\"receiveTask\");\n    Execution execution = runtimeService.createExecutionQuery()\n                            .processInstanceId(pi.getId())\n                            .activityId(\"waitState\")\n                            .singleResult();\n    runtimeService.signal(execution.getId());  \n    ```\n    \n----------\n\n述两个虽然都可以统称为任务节点，但是还是有本质区别：\n\n 1. receiveTask主要代表机器自动执行的，userTask代表人工干预的。\n 2. eiveTask任务产生后会在act_ru_execution表中新增一条记录，\t而userTask产生后会在act_ru_execution和act_ru_task（主要记录任\t务的发布时间，办理人等信息）中各产生一条记录。\n 3. receiveTask任务提交方式使用RuntimeService的signal方法提交，\tuserTask任务提交方式使用TaskService的complete方法提交。\n\n \n### 8.3.4 网关（gateWay）\n![网关][12]\n\n 1. 排他网关\n    排他网关（也叫异或（XOR）网关，或更技术性的叫法基于数据的排他网关），用来在流程中实现决策。\n    \n    **图形标记**:排他网关显示成一个普通网关（比如，菱形图形）,内部是一个“X”图标,表示异或（XOR）语义。注意，没有内部图标的网关，默认为排他网关。BPMN2.0规范不允许在同一个流程定义中同时使用没有X和有X的菱形图形。\n    \n    **XML内容**:排他网关的XML内容是很直接的：用一行定义了网关,条件表达式定义在外出顺序流中。参考条件顺序流 获得这些表达式的可用配置。\n    ![排他网关][13]\n    ```xml\n    <exclusiveGatewayid=\"exclusiveGw\"name=\"Exclusive Gateway\"/>\n    <sequenceFlow id=\"flow2\" sourceRef=\"exclusiveGw\" targetRef=\"theTask1\">  \n        <conditionExpressionxsi:type=\"tFormalExpression\">${input == 1}</conditionExpression> \n    </sequenceFlow>\t\n    <sequenceFlow id=\"flow3\" sourceRef=\"exclusiveGw\" targetRef=\"theTask2\">   \n        <conditionExpressionxsi:type=\"tFormalExpression\">${input == 2}</conditionExpression> \n    </sequenceFlow>\n    <sequenceFlow id=\"flow4\" sourceRef=\"exclusiveGw\" targetRef=\"theTask3\">  \n        <conditionExpressionxsi:type=\"tFormalExpression\">${input == 3}</conditionExpression> \n    </sequenceFlow>\n    ```\n    \n    说明：\n    1.一个排他网关对应一个以上的顺序流\n    2.由排他网关流出的顺序流都有个conditionExpression元素，在内部维护返回boolean类型的决策结果。\n    3.决策网关只会返回一条结果。当流程执行到排他网关时，流程引擎会自动检索网关出口，从上到下检索如果发现第一条决策结果为true或者没有设置条件的(默认为成立)，则流出。\n    4.如果没有任何一个出口符合条件则抛出异常。\n\n 2. 并行网关\n \n    网关也可以表示流程中的并行情况。最简单的并行网关是parallelGateWay，它允许将流程分成多条分支，也可以把多条分支汇聚到一起。\n\n    **图形标记**：并行网关显示成一个普通网关（菱形）内部是一个“加号”图标，表示“与（AND）”语义。\n    ![并行网关][14]\n    \n    **XML内容**：定义并行网关只需要一行\n    ```xml\n    <parallelGateway id=\"myParallelGateway\"/>\n    ```\n    实际发生的行为（分支，聚合，同时分支聚合），要根据并行网关的顺序流来决定。\n    ```xml\n    <startEvent id=\"theStart\"/>\n\n    <sequenceFlow id=\"flow1\" sourceRef=\"theStart\" targetRef=\"fork\"/>\n    <parallelGateway id=\"fork\"/> \n     \n    <sequenceFlow sourceRef=\"fork\" targetRef=\"receivePayment\"/>\n    <sequenceFlow sourceRef=\"fork\" targetRef=\"shipOrder\"/>\n        \n    <userTaskid=\"receivePayment\"name=\"Receive Payment\"/>\n    <sequenceFlow sourceRef=\"receivePayment\" targetRef=\"join\"/>\n       \n    <userTaskid=\"shipOrder\"name=\"Ship Order\"/>\n    <sequenceFlow sourceRef=\"shipOrder\" targetRef=\"join\"/>\n    \n    <parallelGateway id=\"join\"/>\n    <sequenceFlow sourceRef=\"join\" targetRef=\"archiveOrder\"/>\n     \n    <userTask id=\"archiveOrder\"name=\"Archive Order\"/>\n    <sequenceFlow sourceRef=\"archiveOrder\" targetRef=\"theEnd\"/>\n             \n    <endEventid=\"theEnd\"/>\n    ```\n    上面例子中，流程启动之后，会创建两个任务：\n    ```java\n    ProcessInstancepi =runtimeService.startProcessInstanceByKey(\"forkJoin\");\n    \n    List<Task> tasks = taskService.createTaskQuery().list();\n    Task task1 =tasks.get(0);\n    System.out.println(\"Receive Payment\"+task1.getName());\n    Task task2 =tasks.get(1);\n    System.out.println(\"Ship Order\"+task2.getName());\n    ```\n    当两个任务都完成时，第二个并行网关会汇聚两个分支，因为它只有一条外出连线，不会创建并行分支，只会创建归档订单任务。\n    \n    说明：\n    1.并行网关的功能是基于进入和外出的顺序流的：\n        分支(fork)：并行后的所有外出顺序流，为每个顺序流都创建一个并发分支。\n        汇聚(join)：所有到达并行网关，在此等待的进入分支，直到所有进入顺序流的分支都到达以后， 流程就会通过汇聚网关。\n    2.并行网关的进入和外出都是使用相同节点标示\n    3.如果同一个并行网关有多个进入和多个外出顺序流，它就同时具有分支和汇聚功能。这时，网关会先汇聚所有进入的顺序流，然后再切分成多个并行分支。\n    4.并行网关不会解析条件。 即使顺序流中定义了条件，也会被忽略。\n    5.并行网关不需要是“平衡的”（比如，对应并行网关的进入和外出节点数目相等）。如图中标示是合法的：\n    ![并行网关不需要是“平衡的”][15]\n \n## 8.4 监听器（Listener）\n\n在流程中我们有时会对整个流程或者一个节点的某种状态做出相应的处理。这时就会用到监听器。\n\n在Activiti中流程的监听主要分为两大类，执行监听器和任务监听器。\n\n### 8.4.1 执行监听器（ExecutionListener）\n\n执行监听器可以执行外部java代码或执行表达式，当流程定义中发生了某个事件。 可以捕获的事件有:\n\n - 流程实例的启动和结束。\n - 选中一条连线。\n - 节点的开始和结束。\n - 网关的开始和结束。\n - 中间事件的开始和结束。\n - 开始事件结束或结束事件开始。\n\n现在有这样一个简单流程，只包含开始、结束、接收任务和用户任务4个节点：\n![监听器流程示例][16]\n配置监听器,XML代码如下\n```xml\n<extensionElements>\n      <activiti:executionListener event=\"start\" class=\"test.ProcessStartListener\"></activiti:executionListener>\n</extensionElements>\n```\n说明：\n\n - 任务监听器支持以下属性：\n    \n    - event（必选）：任务监听器会被调用的任务类型\n        - start：流程节点创建后触发\n        - end：当任务完成，并尚未从运行数据中删除时触发\n        - take：任务完成后，流程流出时触发\n    - class(必选)：代理类，实现org.activiti.engine.delegate.ExecutionListener接口。\n    示例：\n    ```java\n    public class ProcessStartListener implements ExecutionListener {\n\n    private static final long serialVersionUID = 1L;\n\n    @Override\n    public void notify(DelegateExecution execution) throws Exception {\n            System.out.println(\"ID:\"+execution.getId()+\", Name:\"+execution.getCurrentActivityName());\n        }\n    \n    }\n    ```\n\n - 执行监听器配置可以放在以下三个地方，如图\n![此处输入图片的描述][17]\n\n    a)\t监听整个流程的启动和结束状态，配置为process节点的子元素，如①\n    b)\t监听一个节点的启动和结束状态，配置为一个节点的子元素，如②和③\n    c)\t监听一条连线的执行，配置在sequenceFlow节点的内部，只有task一种事件，如④\n    \n启动流程测试代码如下：\n```java\n@Test\npublic void Demo1() {\n    //部署流程\n    Deployment deployment = repositoryService.createDeployment()\n                .addClasspathResource(\"diagrams/Listener.bpmn\")\n                .addClasspathResource(\"diagrams/Listener.png\")\n                .deploy();\n    //启动\n    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(\"ListenerTest\");\n    //推动\n    String processInstanceId = processInstance.getId();\n    runtimeService.signal(processInstanceId);\n    \n    String id = taskService.createTaskQuery().processInstanceId(processInstanceId).singleResult().getId();\n    taskService.complete(id);\n}\n```\n\n测试结果如下：\n\n        ID:60005, Name:开始\n        ID:60005, Name:接收任务\n        ID:60005, Name:用户任务\n\n### 8.4.2 任务监听器（TaskListener）\n\n任务监听器可以在发生对应的任务相关事件时执行自定义java逻辑 或表达式。\n任务监听器只能添加到流程定义中的用户任务中。在之前任务节点上添加任务监听:\n![此处输入图片的描述][18]\n\n任务监听器支持以下属性\n\n- event（必选）：任务监听器会被调用的任务类型。 可能的类型为：\n    - create：任务创建并设置所有属性后触发。\n    - assignment：任务分配给一些人时触发。当流程到达userTask，assignment事件 会在create事件之前发生。这样的顺序似乎不自然，但是原因很简单：当获得create时间时， 我们想获得任务的所有属性，包括执行人。\n    - complete：当任务完成，并尚未从运行数据中删除时触发。\n- class：必须调用的代理类。 这个类必须实现org.activiti.engine.delegate.TaskListener\t接口。\n\n\n----------\n\n新添加的任务监听包裹在executionListener监听的内部，顺序为：execution Start--> task Assignment-->task Create-->task Complete-->execution End-->execution take。\n\n\n# 9 Spring集成\n\n虽然前面的例子中我们可以自己手动来创建相应的API实例，但是在一个项目中这些API都应该以**单例形式**存在的。和Spring的集成主要就是把Activiti的主要对象交给Spring容器管理。\n\n```xml\n<!-- 流程引擎 -->\n<bean id=\"processEngine\" class=\"org.activiti.spring.ProcessEngineFactoryBean\"> \n\t<property name=\"processEngineConfiguration\" ref=\"processEngineConfiguration\"></property>\n</bean>\n\n<!-- 流程引擎配置对象 -->\n<bean id=\"processEngineConfiguration\" class=\"org.activiti.spring.SpringProcessEngineConfiguration\">\n\t<property name=\"dataSource\" ref=\"dataSource\" />\n\t<property name=\"transactionManager\" ref=\"transactionManager\" />\n\t<!-- activiti表数据更新策略 false true（默认） create-drop-->\n\t<property name=\"databaseSchemaUpdate\" value=\"true\" />\n\t<!-- activiti历史数据保存策略 none activity audit(默认) full-->\n\t<property name=\"history\" value=\"audit\" />\n\t<!-- 管理线程计时器和异步消息,默认开启，但有ManagementService替代，避免冲突所以关闭 -->\n\t<property name=\"jobExecutorActivate\" value=\"false\" />\n\t<!-- 加载资源文件 -->\n\t<property name=\"deploymentResources\" value=\"classpath:/activiti-process/*.bpmn\" />\n</bean>\n\n<!-- 核心业务类 -->\n<bean id=\"repositoryService\" factory-bean=\"processEngine\" factory-method=\"getRepositoryService\" />\n<bean id=\"runtimeService\" factory-bean=\"processEngine\" factory-method=\"getRuntimeService\" />\n<bean id=\"taskService\" factory-bean=\"processEngine\" factory-method=\"getTaskService\" />\n<bean id=\"historyService\" factory-bean=\"processEngine\" factory-method=\"getHistoryService\" />\n<bean id=\"managementService\" factory-bean=\"processEngine\" factory-method=\"getManagementService\" />\n```\n\n**注意：**\n 1. ProcessEngineConfiguration\n    单独使用和整合Spring时不是同一个class\n    独立使用：org.activiti.engine.ProcessEngineConfiguration\n    整合Spring：org.activiti.spring.SpringProcessEngineConfiguration\n 2. 项目部署后会自动在数据库中创建相关流程定义\n\n \n\n \n \n \n  \n\n\n  \n\n\n  [1]: https://www.zybuluo.com/mdeditor#785927\n  [2]: http://blog.csdn.net/dr_guo/article/details/50718063\n  [3]: http://activiti.org/download.htmlt/dr_guo/article/details/50718063\n  [4]: http://pan.baidu.com/s/1qYmgdlE\n  [5]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/create.png\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/example.png\n  [7]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/variable.png\n  [8]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/baseVar.png\n  [9]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/startEvent.png\n  [10]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/endEvent.png\n  [11]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/task.png\n  [12]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/gateWay.png\n  [13]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/xor.png\n  [14]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/parallelGateWay.png\n  [15]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/binxing.png\n  [16]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/listenerExample.png\n  [17]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/taskListener.png\n  [18]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/taskListener2.png","source":"_posts/Activiti5-流程框架.md","raw":"---\ntitle: Activiti5 流程框架\ncategories:\n  - JavaEE\ntags:\n  - activiti\ndate: 2017-11-23 17:00:30\n---\n工作流(Workflow)，就是“业务过程的部分或整体在计算机应用环境下的自动化”，它主要解决的是“使在多个参与者之间按照某种预定义的规则传递文档、信息或任务的过程自动进行，从而实现某个预期的业务目标，或者促使此目标的实现”。\n<!--more-->\n\n# 1 Activiti简介\n\nActiviti5是由Alfresco软件在2010年5月17日发布的业务流程管理（BPM）框架，它是覆盖了业务流程管理、工作流、服务协作等领域的一个开源的、灵活的、易扩展的可执行流程语言框架。Activiti基于Apache许可的开源BPM平台，创始人Tom Baeyens是JBoss jBPM的项目架构师，它特色是提供了eclipse插件，开发人员可以通过插件直接绘画出业务流程图。\n\n## 1.1 工作流引擎\n\n这是Activiti的核心，负责生成流程运行时的各种实例及数据、监控和管理流程的运行。\n  \n## 1.2 BPMN2.0\n\n业务流程建模与标注（Business Process Model and Notation，BPMN) ，描述流程的基本符号，包括这些图元如何组合成一个业务流程图（Business Process Diagram）\n\n## 1.3 数据库\n\nActiviti的后台是有数据库的支持，所有的表都以ACT_开头。第二部分是表示表的用途的两个字母标识。 用途也和服务的API对应。\n\n 1. **ACT_RE_***: 'RE'表示repository。 这个前缀的表包含了流程定义和流程静态资源 （图片，规则，等等）。\n 2. **ACT_RU_***: 'RU'表示runtime。 这些运行时的表，包含流程实例，任务，变量，异步任务，等运行中的数据。 Activiti只在流程实例执行过程中保存这些数据， 在流程结束时就会删除这些记录。 这样运行时表可以一直很小速度很快。\n 3. **ACT_ID_***: 'ID'表示identity。 这些表包含身份信息，比如用户，组等等。\n 4. **ACT_HI_***: 'HI'表示history。 这些表包含历史数据，比如历史流程实例， 变量，任务等等。\n 5. **ACT_GE_***: 通用数据， 用于不同场景下。\n\n### 1.3.1 资源库流程规则表\n\n 1. act_re_deployment  部署信息表\n 2. act_re_mode        流程设计模型部署表\n 3. act_re_procdef     流程定义表\n\n### 1.3.2 运行时数据库\n\n 1. act_ru_execution    运行时流程执行实例表\n 2. act_ru_identitylink 运行时流程人员表，主要存储任务节点与参与者的相关信息\n 3. act_ru_task\t\t    运行时任务节点表\n 4. act_ru_variable\t    运行时流程变量数据表\n\n### 1.3.3 历史数据库表\n\n 1. act_hi_actinst \t\t    历史节点表\n 2. act_hi_attachment\t\t历史附件表\n 3. act_hi_comment\t\t    历史意见表\n 4. act_hi_identitylink\t\t历史流程人员表\n 5. act_hi_detail\t\t\t历史详情表，提供历史变量的查询\n 6. act_hi_procinst\t\t    历史流程实例表\n 7. act_hi_taskinst\t\t    历史任务实例表\n 8. act_hi_varinst\t\t    历史变量表\n\n### 1.3.4 组织机构表\n\n 1. act_id_group\t\t用户组信息表\n 2. act_id_info\t\t用户扩展信息表\n 3. act_id_membership\t用户与用户组对应信息表\n 4. act_id_user\t\t用户信息表\n\n这四张表很常见，基本的组织机构管理，关于用户认证方面建议还是自己开发一套，组件自带的功能太简单，使用中有很多需求难以满足 。可以使shiro完成用户认证。\n\n### 1.3.5 统用数据表\n\n 1. act_ge_bytearray\t\t二进制数据表\n 2. act_ge_property\t\t属性数据表存储整个流程引擎级别的数据,初始化表结构时，会默认插入三条记录\n\n## 1.4 activiti.cfg.xml\n\nActiviti核心配置文件，配置流程引擎创建工具的基本参数和数据库连接池参数。\n\n定义数据库配置参数：\n\n - jdbcUrl: 数据库的JDBC URL。\n - jdbcDriver: 对应不同数据库类型的驱动。\n - jdbcUsername: 连接数据库的用户名。\n - jdbcPassword: 连接数据库的密码。\n\n基于JDBC参数配置的数据库连接 会使用默认的MyBatis连接池。 下面的参数可以用来配置连接池（来自MyBatis参数）：\n\n - jdbcMaxActiveConnections: 连接池中处于被使用状态的连接的最大值。默认为10。\n - jdbcMaxIdleConnections: 连接池中处于空闲状态的连接的最大值。\n - jdbcMaxCheckoutTime: 连接被取出使用的最长时间，超过时间会被强制回收。 默认为20000（20秒）。\n - jdbcMaxWaitTime: 这是一个底层配置，让连接池可以在长时间无法获得连接时， 打印一条日志，并重新尝试获取一个连接。（避免因为错误配置导致沉默的操作失败）。 默认为20000（20秒）。\n\n\n示例如下：\n\n```xml\n  \t<bean name=\"processEngineConfiguration\" class=\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\">\n  \t\t<property name=\"JdbcDriver\" value=\"com.mysql.jdbc.Driver\" />\n  \t\t<property name=\"JdbcUrl\" value=\"jdbc:mysql://localhost:3306/activititest\"/>\n\t\t<property name=\"JdbcUsername\" value=\"root\" />\n\t\t<property name=\"JdbcPassword\" value=\"123\" />\n\t\t<!-- \n\t\t\tdatabaseSchemaUpdate：设置流程引擎启动和关闭时如何处理数据库表\n\t\t\tfalse（默认）:检查数据库表的版本和依赖库的版本，如果不一致就抛出异常\n\t\t\ttrue:构建流程引擎是执行检查，如果需要就更新，如果表不存在就创建\n\t\t\tcreate-drop：构建流程引擎是创建表，关闭时删除表  \n\t\t-->\n\t\t<property name=\"databaseSchemaUpdate\" value=\"true\" />\n  \t</bean>\n```\n\n关于c3p0、dbcp等数据库连接池配置请参看[spring(4)——持久层封装][1]\n\n## 1.5 logging.properties\n\n```xml\nlog4j.rootLogger=WARN, stdout\nlog4j.appender.stdout=org.apache.log4j.ConsoleAppender\nlog4j.appender.stdout.layout=org.apache.log4j.PatternLayout\nlog4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - %m%n\n```\n\n更详细log4j说明请参看[log4j.properties配置详解与实例][2]\n \n# 2 环境搭建\n\n## 2.1 需求java环境\n\n 1. JDK1.6或更高\n 2. 支持的数据库有：h2, mysql, oracle, postgres, mssql, db2等。\n 3. 支持activiti5运行的jar包\n 4. 开发环境为Eclipse3.7或者以上版本,myeclipse为8.6版本\n\n## 2.2 资源下载\n\nactiviti可以到[Activiti官方网站][3]下载得到。\n\n百度网盘下载地址，5.22.0和6.0.0两个版本，还有eclipse插件。[百度网盘下载][4]\n\n注意：安装插件后，在Windows->Preferences->Activiti->Save菜单下勾选保存时自动生成图片。\n\n## 2.3 配置开发环境\n\n### 2.3.1 添加jar包\n\n在activiti-5.22.0→wars目录下是一些示例项目，解压activiti-rest项目，导入activiti-rest目录中WEB-INF\\lib下所有jar包到classpath中。\n注意还需要数据库连接驱动包，如Mysql还需要添加**mysql-connector-java.jar**。\n\n### 2.3.2 初始化数据库\n\n```java\n@Test\npublic void createTable() {\n    //1、创建流程引擎配置对象\n\tProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration.createStandaloneProcessEngineConfiguration();\n\t//2、配置数据库\n\tprocessEngineConfiguration.setJdbcDriver(\"com.mysql.jdbc.Driver\");\n\tprocessEngineConfiguration.setJdbcUrl(\"jdbc:mysql://localhost:3306/activititest\");\n\tprocessEngineConfiguration.setJdbcUsername(\"root\");\n\tprocessEngineConfiguration.setJdbcPassword(\"123\");\n\t//3、设置建表策略\n\tprocessEngineConfiguration.setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE);\n\t//4、创建流程引擎对象\n\tProcessEngine processEngine = processEngineConfiguration.buildProcessEngine();\n\tSystem.out.println(\"processEngine\"+processEngine);\n}\n```\n在Activiti中，在创建核心的流程引擎对象时会自动建表。如果程序正常执行，mysql会自动建库，然后创建23张表。\n\n### 2.3.3 配置文件\n\n在Actiiti5中定制流程必定会操作到数据库，如果都像上面那样写一大段代码会非常麻烦，所以我们可以把数据库连接配置写入配置文件。\n  \n在Activiti5的官方示例中并没有现成的配置文件，所以先得找到activiti-rest\\WEB-INF\\classes下有：**activiti-context.xml**：一个类似spring结构的配置文件，清空内容后改名为activiti.cfg.xml，用来做流程引擎的相关配置。\n\n```xml\n  \t<bean name=\"processEngineConfiguration\" class=\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\">\n  \t\t<property name=\"JdbcDriver\" value=\"com.mysql.jdbc.Driver\" />\n  \t\t<property name=\"JdbcUrl\" value=\"jdbc:mysql://localhost:3306/activititest\"/>\n\t\t<property name=\"JdbcUsername\" value=\"root\" />\n\t\t<property name=\"JdbcPassword\" value=\"123\" />\n\t\t<!-- \n\t\t\tdatabaseSchemaUpdate：设置流程引擎启动和关闭时如何处理数据库表\n\t\t\tfalse（默认）:检查数据库表的版本和依赖库的版本，如果不一致就抛出异常\n\t\t\ttrue:构建流程引擎是执行检查，如果需要就更新，如果表不存在就创建\n\t\t\tcreate-drop：构建流程引擎是创建表，关闭时删除表  \n\t\t-->\n\t\t<property name=\"databaseSchemaUpdate\" value=\"true\" />\n  \t</bean>\n```\n\nJava代码如下：\n\n```java\n@Test\npublic void createTable2() {\n\tProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(\"activiti.cfg.xml\");\n\tProcessEngine processEngine = processEngineConfiguration.buildProcessEngine();\n}\n```\n\n# 3 核心API\n\n## 3.1 ProcessEngine\n\n 1. 在Activiti中最核心的类，其他的类都是由它而来。\n 2. 产生方式\n    2.1 方式一：最基础版本，见2.3.2小节\n    2.2 方式二：配置文件+java代码，见2.3.3小节\n    \n    ```java\n    @Test\n    public void createTable3() {\n    \tProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    }\n    ```\n    这种方式更加简单，会自动加载classpath下名为activiti.cfg.xml的文件。\n 3. 产生各种service\n \n    ```java\n    //流程仓库业务类，管理流程定义、部署\n    RepositoryService repositoryService = processEngine.getRepositoryService();\n    //流程运行业务类，管理流程启动、推进、删除等操作\n    RuntimeService runtimeService = processEngine.getRuntimeService();\n    //流程任务类，管理具体的任务\n    TaskService taskService = processEngine.getTaskService();\n    //流程历史数据类\n    HistoryService historyService = processEngine.getHistoryService();\n    //流程用户业务类\n    IdentityService identityService = processEngine.getIdentityService();\n    ```\n## 3.2 ReposityService\n\n流程仓库业务类，仓库简单理解即流程定义文档的两个文件：bpmn文件和流程图片\n\n 1. 产生流程部署配置对象，用来定义流程部署的相关参数\n\n    ```\n    @Test\n    public void Demo1() {\n    \tDeploymentBuilder deploymentBuilder = processEngine.getRepositoryService().createDeployment().name(\"test\");\n    \tdeploymentBuilder.addClasspathResource(\"diagrams/HelloWord.bpmn\");\n    \tdeploymentBuilder.addClasspathResource(\"diagrams/HelloWord.png\");\n    \t\n    \tDeployment deployment = deploymentBuilder.deploy();\n    \tSystem.out.println(deployment.getId() + \"。。。。\"+ deployment.getName());\n    }\n    ```\n 2. 删除流程定义\n\n    ```\n    repositoryService.deleteDeployment(deploymentId);\n    ```\n \n## 3.3 RuntimeService\n\n流程执行服务类。可以从这个类中获取很多关于流程执行相关的信息。\n\n 1. 启动流程\n \n    ```java\n    //常用的启动流程实例的两种方法\n    ProcessInstance processInstance = runtimeService.startProcessInstanceById(processInstanceId);\n    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(processInstanceKey);\n    ```\n\n## 3.4 TaskService\n\nactiviti的任务服务类。可以从这个类中获取任务的信息。\n\n## 3.5 ProcessDefinition\n\n流程定义类。可以从这里获得资源文件等。\n每个流程文件唯一对应一个相同key的流程定义，只是流程定义的version不同\n\n## 3.6 ProcessInstance\n\n流程实例。根据流程定义实例化的具体流程，我们可以利用这个对象来了解当前流程实例的进度等信息。\n如：\n    公司有一个所有人通用的请假流程，这个叫做流程定义。\n    小明今天请假，填写请假单，就是创建了一个流程实例。\n\n```java\n/** Represents one execution of a  {@link ProcessDefinition}.\n 1. \n 2. @author Tom Baeyens\n 3. @author Joram Barrez\n 4. @author Daniel Meyer\n 5. @author Tijs Rademakers\n */\npublic interface ProcessInstance extends Execution {\n```\n\n从上面可以看出ProcessInstance就是Execution，但实际有点区别\n\n 1. 单线流程中，ProcessInstance与Execution是一致的，ID都一样\n 2. 多线 流程中，总线路代表ProcessInstance，而分线路中每个活动代表Execution。\n\n## 3.7 Execution\n\nActiviti用这个对象去描述流程执行的每一个节点。在没有并发的情况下，同ProcessInstance。\n\n# 4 流程定义\n\n## 4.1 创建流程文件\n\n在classpath下创建流程文件\n![创建][5]\n编辑流程文件\n![编辑][6]\n\n## 4.2 部署流程定义\n\n部署流程定义可以看成是添加流程定义\n```java\n@Test\npublic void deploy() {\n    //创建流程引擎\n    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    //创建流程部署对象\n    DeploymentBuilder deploymentBuilder = processEngine.getRepositoryService().createDeployment();\n    //读取文件部署流程\n    Deployment deploy = deploymentBuilder.name(\"测试\")\n                            .addClasspathResource(\"diagrams/HelloWord.bpmn\")\n                            .addClasspathResource(\"diagrams/HelloWord.png\")\n                            .deploy();\n    \n    System.out.println(deploy.getId() + \"。。。\" + deploy.getName());\n}\n```\n\n**部署流程会改变3张表**\n\n - act_re_deployment\n\t存放流程定义的显示名和部署时间，每部署一次增加一条记录\n - act_re_procdef\n\t存放流程定义的属性信息，部署每个新的流程定义都会在这张表中增加一条记录。\n - act_ge_bytearray\n\t存储流程定义相关的部署信息。即流程定义文档的存放地。每部署一次就会增加两条记录，一条是关于bpmn规则文件的，一条是图片的（如果部署时只指定了bpmn一个文件，activiti会在部署时解析bpmn文件内容自动生成流程图）。两个文件不是很大，都是以二进制形式存储在数据库中。\n\n## 4.3 查看流程定义\n\n```java\n@Test\npublic void view() {\n    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();\n    List<ProcessDefinition> list = repositoryService.createProcessDefinitionQuery()\n                                        //过滤条件\n                                        .processDefinitionKey(\"HelloWorld\")\n                                        //.processDefinitionId(processDefinitionId)\n                                        //分页\n                                        //.listPage(firstResult, maxResults)\n                                        //排序\n                                        //.orderByProcessDefinitionVersion()\n                                        //执行查询\n                                        .list();\n    for (ProcessDefinition processDefinition : list) {\n        System.out.print(\"id:\" + processDefinition.getId() + \",\");//流程Id\n        System.out.print(\"key:\" + processDefinition.getKey() + \",\");//流程Key\n        System.out.print(\"name:\" + processDefinition.getName() + \",\");//流程名字\n        System.out.print(\"version:\" + processDefinition.getVersion() + \",\");//流程版本\n        System.out.println(\"deploymentId():\" + processDefinition.getDeploymentId());//流程部署对象Id\n    }\n}\n```\n查询结果\n\n    id:HelloWorld:1:35004,key:HelloWorld,name:请假审批流程,version:1,deploymentId():35001\n再部署一次，再查询\n\n    id:HelloWorld:1:35004,key:HelloWorld,name:请假审批流程,version:1,deploymentId():35001\n    id:HelloWorld:2:37504,key:HelloWorld,name:请假审批流程,version:2,deploymentId():37501\n    \n说明：\n    \n\n 1. 因为流程定义的信息在仓库中，实际在act_re_*表中，所以创建RepositoryService\n 2. 创建查询对象**ProcessDefinitionQuery**，设置查询参数，调用list()执行查询\n 3. 由查询结果可知：\n    3.1 流程定义的key和name与流程文件的id和name一致\n\n    ```xml\n    <process id=\"HelloWorld\" name=\"请假审批流程\" isExecutable=\"true\">\n    ```\n    3.2 key属性被用来区别不同的流程定义。\n    3.3 带有特定key的流程定义第一次部署时，version为1。之后每次部署都会在当前最高版本号上加1\n    3.4 Id的生成规则为：**{processDefinitionKey}:{processDefinitionVersion}:{generated-id}**，这里的generated-id是一个自动生成的唯一的数字\n    3.5 重复部署一次，deploymentId的值以一定的形式变化\n    \n## 4.4 删除流程定义\n\n删除部署到activiti中的流程定义。如:删除请假流程定义，则大家再也不能请假了。\n\n```java\n@Test\npublic void delete() {\n    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();\n    String deploymentId = \"7501\";\n    //如果有关联信息，会报错\n    //repositoryService.deleteDeployment(deploymentId);\n    //如果有关联信息，会级联删除\n    repositoryService.deleteDeployment(deploymentId, true);\n}\n```\n\n## 4.5 获取流程定义文档资源\n\n```java\n@Test\npublic void getResource() throws IOException {\n    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();\n   \n    String deploymentId = \"35001\";\n    String resourceName = null;\n    //资源文件名,即act_re_bytearray表中的name\n    List<String> names = repositoryService.getDeploymentResourceNames(deploymentId);\n    for (String str : names) {\n        //过滤出特定的图片文件\n        if (str.indexOf(\"HelloWorld.png\") != -1) {\n            resourceName = str;\n        }\n    }\n    System.out.println(resourceName);\n    if (resourceName != null) {\n        //通过部署ID和文件名获得输入流\n        InputStream inputStream = repositoryService.getResourceAsStream(deploymentId, resourceName);\n        File file = new File(\"D:/\"+ resourceName);\n        FileUtils.copyInputStreamToFile(inputStream, file);\n    }\n}\n```\n    \n# 5 流程实例\n\n## 5.1 启动流程实例\n\n```java\n@Test\npublic void startProcess() {\n    RuntimeService runtimeService = ProcessEngines.getDefaultProcessEngine().getRuntimeService();\n    //根据流程Id启动流程\n    //ProcessInstance processInstance = runtimeService.startProcessInstanceById(processDefinitionId);\n    //根据流程key启动流程，会自动找到版本最高的流程定义来创建\n    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(\"HelloWorld\");\n    System.out.println(processInstance.getId());//流程实例Id\n    System.out.println(processInstance.getActivityId());//流程当前节点Id\n}\n```\n    启动流程实例有很多重载方法，根据实际需要选用。\n\n## 5.2 查询任务\n\n在Activiti中，任务主要分为两类：\n\n 1. 确切指定了办理者的任务，之歌任务称为制定者的私人任务\n 2. 2.无法指定具体的某一个人来办理的任务，可以把任务分配给几个人或者一到\t多个小组，让这个范围内的用户可以选择性（如有空余时间时）来办理这类任务。\n\n```java\n@Test\npublic void taskQuery() {\n    TaskService taskService = ProcessEngines.getDefaultProcessEngine().getTaskService();\n    List<Task> list = taskService.createTaskQuery()\n            //查询指定用户的私人任务\n            //.taskAssignee(\"指定用户\")\n            //查询某人可接的共有任务\n            //.taskCandidateUser(\"候选用户\")\n            //排序\n            .orderByTaskCreateTime().desc()\n            //执行查询\n            .list();\n    for (Task task : list) {\n        System.out.println(\"id:\" + task.getId());\n        System.out.println(\"name:\" + task.getName());\n        System.out.println(\"assignee:\" + task.getAssignee());\n        System.out.println(\"createTime:\" + task.getCreateTime());\n        System.out.println(\"ProcessInstanceId:\" + task.getProcessInstanceId());\n        System.out.println(\"ProcessDefinitionId:\" + task.getProcessDefinitionId());\n    }\n}\n```\n\n## 5.3 认领任务\n\n```java\ntaskService.claim(taskId, userId);\n```\n将任务变为用户的私人任务\n\n## 5.4 办理任务\n\n```java\n//根据任务Id办理任务\ntaskService.complete(taskId);\n//根据任务Id办理任务,并设置任务变量\ntaskService.complete(taskId, variables);\n```\n\nvariables是Map，当设置变量时，会在act_ru_variables表中添加相应条数的数据，变量可以用来执行gateway的判断，后面会讲到gateway。\n\n## 5.5 判断流程是否结束\n\n在流程执行过程中，创建的流程实例ID在整个过程都不会变，当流程结束后，流程实例将被删除。\n\n 1. 从运行库中查询该流程是否还存在\n 2. 从历史库中查询该流程是否存在\n\n```java\n@Test\npublic String checkStatus() {\n    String processInstanceId = \"1213\";\n    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    RuntimeService runtimeService = processEngine.getRuntimeService();\n    //从运行库查询该流程实例是否存在\n    ProcessInstance instance = runtimeService.createProcessInstanceQuery()\n                                    .processInstanceId(processInstanceId)\n                                    .singleResult();\n    //实例不存在，可能未开始或者已结束\n    if (instance == null) {\n        //从历史库查\n        HistoryService historyService = processEngine.getHistoryService();\n        HistoricProcessInstance singleResult = historyService.createHistoricProcessInstanceQuery()\n                                                .processInstanceId(processInstanceId)\n                                                .singleResult();\n        if (singleResult != null && singleResult.getEndTime() != null) {\n            //流程已结束\n            return \"COMPLETE\";\n        } else {\n            //流程未开始\n            return \"NOT_START\";\n        }\n    }\n    return instance.getActivityId();//当前任务节点\n}\n```\n \n# 6 流程历史\n\n在前一个的例子中，大家可能会流程执行完毕后，究竟去了哪里有些疑问。虽然已完成的任务在act_ru_task和act_ru_execution表中都已被删除，但是这些数据还存在activiti的数据库中，作为历史改由HistoryService来管理。\n\n历史是一个组件，它可以捕获发生在进程执行中的信息并永久的保存，与运行时数据不同的是，当流程实例运行完成之后它还会存在于数据库中。\n\n在流程引擎配置对象中可以设置历史记录规则：\n\n```xml\n<bean name=\"processEngineConfiguration\" \n  \t  class=\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\">\n\t<property name=\"databaseSchemaUpdate\" value=\"true\" />\n\t<!--\n\t\tActiviti提供了四种历史级别：\n\t\tnone:不保存任何历史，可以提高性能\n\t\tactiviti:保存所有流程实例、任务、活动信息\n\t\taudit:默认级别,保存所有流程实例、任务、活动、表单\n\t\tfull:保存所有信息,如流程变量\n\t  -->\n\t<property name=\"history\" value=\"activiti\"/>\n```\n由于数据库中保存着历史信息以及正在运行的流程实例信息，在实际项目中对已完成任务的查看频率远不及对代办和可接任务的查看，所以在activiti采用分开管理，把正在运行的交给runtimeService管理，而历史数据交给HistoryService来管理。\n\n对已成为历史的数据主要进行查询操作，我们主要关心两种类型的历史数据：\n\n - **HistoricProcessInstance** 包含当前和已经结束的流程实例信息。\n - **HistoricActivityInstance** 包含一个活动(流程上的节点)的执行信息。\n\n## 6.1 查看历史流程实例\n\n```java\n@Test\npublic void queryHisInstance() {\n    //流程引擎\n    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    //流程定义ID\n    String processDefinitionId = \"HelloWorld:2:37504\";\n    //查询历史流程实例\n    List<HistoricProcessInstance> list = processEngine.getHistoryService().createHistoricProcessInstanceQuery()\n                                        .processDefinitionId(processDefinitionId)\n                                        .finished()\n                                        .orderByProcessInstanceStartTime().desc()\n                                        .list();\n    for (HistoricProcessInstance hp : list) {\n        System.out.println(\"ID：\"+hp.getId());\n        System.out.println(\"startTime：\"+hp.getStartTime());\n        System.out.println(\"endTime：\"+hp.getEndTime());\n    }\n}\n```\n\n1.通常查询历史流程实例都需要指定一个过滤条件，指定\tprocessDefinitionId查看具体某一次部署所开启的流程或者指定\tprocessDefinitionKey查看某个规则下不限版本的所有流程\n\n2.可以选择性添加finished方法控制是否查询未完成的流程实例。在流\t程开启时，activiti同时在act_ru_execution表和act_hi_procinst表中\t创建了一条记录，在流程完成之前act_hi_procinst表中实例的结束时间为空\n\n\n## 6.2 查看历史流程活动（节点）\n\n```java\n@Test\npublic void queryHisActiviti() {\n    //流程引擎\n    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n    //流程实例ID\n    String processInstanceId = \"HelloWorld:2:37504\";\n    //查询历史流程活动\n    List<HistoricActivityInstance> list = processEngine.getHistoryService()\n                                        //创建历史流程活动实例查询对象\n                                        .createHistoricActivityInstanceQuery()\n                                        //过滤条件\n                                        .processInstanceId(processInstanceId)\n                                        //排序\n                                        .orderByHistoricActivityInstanceStartTime().desc()\n                                        //执行查询\n                                        .list();\n    for (HistoricActivityInstance ha : list) {\n        System.out.println(\"ID：\"+ha.getActivityId());\n        System.out.println(\"name:\"+ha.getActivityName());\n        System.out.println(\"startTime：\"+ha.getStartTime());\n        System.out.println(\"endTime：\"+ha.getEndTime());\n    }\n}\n```\n\n通常查询历史流程活动都需要指定一个过滤条件，指定processInstanceId查看具体某一次流程执行过程中所经历的步奏\n\n# 7 流程变量\n\n流程变量在整个工作流中扮演很重要的作用。例如：请假流程中有请假天数、请假原因等一些参数都为流程变量的范围。\n流程变量的作用域范围是流程实例。也就是说各个流程实例的流程变量是不相互影响的。\n流程实例结束完成以后流程变量是否保存在数据库中取决于存储策略，见第六章。\n![流程变量][7]\n\n## 7.1 添加流程变量\n\n 1. 启动流程实例时添加\n    ```java\n    @Test\n    public void addVariables() {\n        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();\n        RuntimeService runtimeService = processEngine.getRuntimeService();\n        \n        String processDefinitionKey = \"HelloWorld\";\n        Map<String,Object> variables = new HashMap<>();\n        variables.put(\"请假天数\", 3);\n        variables.put(\"请假原因\", \"约会\");\n        ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(processDefinitionKey, variables);\n    }\n    ```\n    说明：\n        1)\t在启动流程实例时，通过重载startProcessInstanceByKey的方法可以加载流程变量。\n        2)\t第二个参数要求是Map<String ,Object>类型，意味着可以添加多个流程变量。\n        3)\t当这段代码执行完以后，会在数据库表act_ru_variable中添加两行记录。\n        \n\n 2. 完成任务时添加\n    ```java\n    //办理过程中\n    taskService.setVariables(taskId, variables);\n    //提交时\n    taskService.complete(taskId, variables);\n    ```\n    \n 3. 执行流程实例时添加\n    ```java\n    //执行流程实例时\n    runtimeService.setVariables(executionId, variables);\n    //流程实例提交时\n    runtimeService.signal(executionId, processVariables);//signal用于接受任务\n    ```\n    \n## 7.2 获取流程变量\n\n```java\n//某个流程的变量\nruntimeService.getVariables(executionId);\n//某个任务的变量\ntaskService.getVariables(taskId);\n```\n\n说明：这些流程变量是从act_ru_variable这个表中读出来的。\n\n## 7.3 流程变量范围\n\n![此处输入图片的描述][8]\n\n从图中可以看出包括了大部分封装类型和Date、String和实现了Serializable接口的类的类型。\n\n## 7.4 Javabean类型变量\n\n 1. 定义一个javabean，这个javabean实现了Serializable接口\n 2. 实例化javaBean，放到map中，然后正常设置流程变量\n 3. 正常取出变量\n\n# 8 流程定义语言\n\n## 8.1 流程（Process）\n\nbpmn文件一个流程的根元素。一个流程就代表一个工作流。\n\n## 8.2 顺序流（sequenceFlow）\n\n顺序流是连接两个流程节点的连线，代表一个节点的出口。流程执行完一个节点后，会沿着节点的所有外出顺序流继续执行。 就是说，BPMN 2.0默认的行为就是并发的： 两个外出顺序流会创造两个单独的，并发流程分支。\n\n顺序流主要由4个属性组成：\n\n - Id: 唯一标示，用来区分不同的顺序流\n - sourceRef：连线的源头节点ID\n - targetRef：连线的目标节点ID\n - name（可选）：连线的名称，不涉及业务，主要用于显示\n\n## 8.3 节点\n\n### 8.3.1 开始事件节点(startEvent)\n开始事件用来指明流程在哪里开始。开始事件的类型（流程在接收事件时启动， 还是在指定时间启动，等等），定义了流程如何启动， 这通过事件中不同的小图表来展示。 在XML中，这些类型是通过声明不同的子元素来区分的。\n![此处输入图片的描述][9]\n\n 1. 空开始事件\n    空开始事件技术上意味着没有指定启动流程实例的触发条件。最常用的一种开始，意味着流程的启动需要手动触发，通过调用api的startProcessInstanceByXXX方法。\n    ```java\n    ProcessInstance processInstance = runtimeService.startProcessInstanceByXXX()\n    ```\n    图形标记：空开始事件显示成一个圆圈，没有内部图表（没有触发类型）\n    XML结构如下：\n    ```xml\n    <startEvent id=\"startevent\" name=\"Start\"></startEvent>\n    ```\n\n 2. 定时开始事件\n\n    定时开始事件用来在指定的时间创建流程实例。 它可以同时用于只启动一次的流程 和应该在特定时间间隔启动多次的流程。\n\n        注意：\n        1.子流程不能使用定时开始事件。\n        2.定时开始事件在流程发布后就会开始计算时间。不需要调用startProcessInstanceByXXX，虽然也而已调用启动流程的方法，但是那会导致调用startProcessInstanceByXXX时启动过多的流程。\n        3.当包含定时开始事件的新版本流程部署时，对应的上一个定时器就会被删除。这是因为通常不希望自动启动旧版本流程的流程实例。\n    \n    图形标记：定时开始事件显示为一个圆圈，内部是一个表。\n    XML内容：定时开始事件的XML内容是普通开始事件的声明，包含一个定时定义子元素。 \n    示例：流程会启动4次，每次间隔5分钟，从2013年9月18日，12:10开始计时。\n    ```xml\n    <startEvent id=\"theStart\">\n        <timerEventDefinition>                \n\t\t    <timeCycle>R4/2017-11-22T11:04/PT5M</timeCycle>            \t\t \n\t    </timerEventDefinition>\n    </startEvent> \n    ```\n    示例：流程会根据选中的时间启动一次。\n    ```xml\n    <startEvent id=\"theStart\">\n        <timerEventDefinition>                \n\t\t    <timeDate>2017-12-31T23:59:59</timeDate>               \t\t \n\t    </timerEventDefinition>\n    </startEvent> \n    ```\n \n### 8.3.2 结束事件节点(endEvent)\n\n结束事件表示（子）流程（分支）的结束。结束事件都是触发事件。这是说当流程达结束事件，会触发一个结果。 结果的类型是通过事件的内部黑色图标表示的。\n![结束事件][10]\n\n 1. 空结束事件\n \n    空结束事件意味着到达事件时不会指定抛出的结果。这样，引擎会直接结束当前执行的分支，不会做其他事情。\n    图形标记:空结束事件是一个粗边圆圈，内部没有小图表（无结果类型）\n    XML内容:空结束事件的XML内容是普通结束事件定义，不包含子元素（其他结束事件类型都会包含声明类型的子元素）。\n    ```xml\n    <endEvent id=\"end\" name=\"my end event\"/>\n    ```\n\n### 8.3.3 任务节点(Task)\n\n![任务节点][11]\n\n 1. 用户任务节点\n    用户任务用来设置必须由人员完成的工作。当流程执行到用户任务，会创建一个新任务，并把这个新任务加入到分配人或群组的任务列表中。\n    图形标记：用户任务显示成一个普通任务（圆角矩形），左上角有一个小用户图标。\n    XML内容：XML中的用户任务定义如下。id属性是必须的。 name属性是可选的。\n    ```xml\n    <userTask id=\"theTask\" name=\"Important task\"/>  \n    ```\n    用户任务也可以设置描述(实际上所有BPMN 2.0元素都可以设置描述)。 添加documentation元素可以定义描述。\n    ```xml\n    <userTask id=\"theTask\" name=\"Schedule meeting\">  \n    <documentation>\n        Schedule an engineering meeting for next week with the new hire.  \n    </documentation>\n    ```\n    在实际应用中，用户接到任务后可以参照任务描述来办理任务，描述文本可以通过标准的java方法来获得：\n    ```java\n    task.getDescription() \n    ```\n**私人任务**\n    私有任务即有直接分配给指定用户的任务。只有一个用户可以成为任务的执行者。 在activiti中，用户叫做执行者。 拥有执行者的用户任务（即私有任务）对其他用户是不可见的。只能出现执行者的个人任务列表中.\n    直接把用户任务分配给指定用户使用assignee属性，XML代码如下：\n    ```xml\n    <userTask id=\"theTask\" name=\"my task\" activiti:assignee=\"username\"/>\n    ```\n    Assignee属性对应的值为一个用户的ID。\n    直接分配给用户的任务可以通过TaskService像下面这样办理：\n    ```java\n    List<Task>tasks =taskService.createTaskQuery().taskAssignee(\"sirius\").list();\nTask task = tasks.get(0);// 假设任务集合的第一条是要办理的任务\ntaskService.complete(task.getId());\n\n    ```\n **公有任务**\n    有的用户任务在指派时无法确定具体的办理者，这时任务也可以加入到\t人员的候选任务列表中，然后让这些人员选择性认领和办理任务。\n    \n    公有任务的分配可以分为指定候选用户和候选组两种。\n\n    -  把任务添加到一批用户的候选任务列表中，使用candidateUsers\t属\t性，XML内容如下:\n    ```xml\n    <userTaskid=\"theTask\"name=\"my task\"activiti:candidateUsers=\"sirius,kermit\"/>\n    ```\n    candidateUsers属性内为用户的ID，多个用户ID之间使用（半角）逗号间隔。\n    \n     - 把任务添加到一个或多个候选组下，这时任务对组下的所有用户可见，首先得保证每个组下面有用户，通过IdentityService对象创建用户和组，然后把用户添加到对应的组下。然后配置组任务，使用candidateGroups属性，XML内容如下：\n    ```xml\n    <userTask id=\"theTask\" name=\"my task\" activiti:candidateGroups=\"testGroup，developGroup\"/>\n    ```\n    间接分配给用户的任务，可以通过TaskService像下面这样操作：\n    ```java\n    List<Task>tasks =taskService.createTaskQuery()\n\t\t\t\t.taskCandidateUser(\"sirius\").list();\n    Task task = tasks.get(0);// 假设任务集合的第一条是要办理的任务\n    String taskId = task.getId();\n    taskService.claim(taskId ,“sirius”); //认领任务，让用户成为任务的执行者\n    taskService.complete(taskId );\n    ```\n\n    说明：\n    \n     1. 要维护用户和组得使用用户管理服务对象，使用\t\tprocessEngine\t得到IdentityService。\n     2. 要分配组任务必须先创建组，而且组下得有用户，用户和组的\t最关键属性是ID。\n     3. 使用newUser（userId）和newGroup（groupId）创建用户和组。\n     4. 使用createMembership（userId，groupId）把用户挂到组下。\n     5. 办理候选任务，首先得认领任务，让用户成为任务的执行者\n    \n    如果上面的方式还不够灵活，那么我们也可以自定义一个任务分配处理器，通过代码的方式来动态设置任务的属性。XML代码如下：\n    ```xml\n    <userTask id=\"task1\" name=\"My task\"> \n        <extensionElements>    \n            <activiti:taskListener event=\"create\" class=\"org.activiti.MyAssignmentHandler\"/>  \n        </extensionElements>\n    </userTask>\n    ```\n    DelegateTask会传递给TaskListener的实现，通过它可以设置执行人，候选人和候选组：\n    ```java\n    Public class MyAssignmentHandler implements TaskListener {\n      \n        Public void notify(DelegateTask delegateTask){ \n    \t// 执行用户搜索相关代码    \n    \t...\n    \t// 然后把获取到的用户通过下面方法，设置给当前触发事件的任务\n        \tdelegateTask.setAssignee(\"sirius\");\n        \t//delegateTask.addCandidateUser(\"kermit\");\n       \t//delegateTask.addCandidateGroup(\"testGroup\"); \n       \t...  \n        }\n    }\n    ```\n\n 2. 接收任务节点（receiveTask）\n\n    接收任务是一个简单任务，它会等待对应消息的到达。当前，官方只实现了这个任务的java语义。 当流程达到接收任务，流程状态会保存到数据库中。在任务创建后，意味着流程会进入等待状态，直到引擎接收了一个特定的消息，这会触发流程穿过接收任务继续执行。\n    \n    图形标记：接收任务显示为一个任务（圆角矩形），右上角有一个消息小标记。 消息是白色的（黑色图标表示发送语义）。\n    \n    XML内容：\n    ```xml\n    <receiveTask id=\"waitState\" name=\"wait\"/> \n    ```\n    \n    当前任务（一般指机器自动完成，但需要耗费一定时间的工作）完成后，向后推移流程，可以调用runtimeService.signal(executionId)，传递接收任务上流程的id。\n    ```java\n    ProcessInstance pi = runtimeService.startProcessInstanceByKey(\"receiveTask\");\n    Execution execution = runtimeService.createExecutionQuery()\n                            .processInstanceId(pi.getId())\n                            .activityId(\"waitState\")\n                            .singleResult();\n    runtimeService.signal(execution.getId());  \n    ```\n    \n----------\n\n述两个虽然都可以统称为任务节点，但是还是有本质区别：\n\n 1. receiveTask主要代表机器自动执行的，userTask代表人工干预的。\n 2. eiveTask任务产生后会在act_ru_execution表中新增一条记录，\t而userTask产生后会在act_ru_execution和act_ru_task（主要记录任\t务的发布时间，办理人等信息）中各产生一条记录。\n 3. receiveTask任务提交方式使用RuntimeService的signal方法提交，\tuserTask任务提交方式使用TaskService的complete方法提交。\n\n \n### 8.3.4 网关（gateWay）\n![网关][12]\n\n 1. 排他网关\n    排他网关（也叫异或（XOR）网关，或更技术性的叫法基于数据的排他网关），用来在流程中实现决策。\n    \n    **图形标记**:排他网关显示成一个普通网关（比如，菱形图形）,内部是一个“X”图标,表示异或（XOR）语义。注意，没有内部图标的网关，默认为排他网关。BPMN2.0规范不允许在同一个流程定义中同时使用没有X和有X的菱形图形。\n    \n    **XML内容**:排他网关的XML内容是很直接的：用一行定义了网关,条件表达式定义在外出顺序流中。参考条件顺序流 获得这些表达式的可用配置。\n    ![排他网关][13]\n    ```xml\n    <exclusiveGatewayid=\"exclusiveGw\"name=\"Exclusive Gateway\"/>\n    <sequenceFlow id=\"flow2\" sourceRef=\"exclusiveGw\" targetRef=\"theTask1\">  \n        <conditionExpressionxsi:type=\"tFormalExpression\">${input == 1}</conditionExpression> \n    </sequenceFlow>\t\n    <sequenceFlow id=\"flow3\" sourceRef=\"exclusiveGw\" targetRef=\"theTask2\">   \n        <conditionExpressionxsi:type=\"tFormalExpression\">${input == 2}</conditionExpression> \n    </sequenceFlow>\n    <sequenceFlow id=\"flow4\" sourceRef=\"exclusiveGw\" targetRef=\"theTask3\">  \n        <conditionExpressionxsi:type=\"tFormalExpression\">${input == 3}</conditionExpression> \n    </sequenceFlow>\n    ```\n    \n    说明：\n    1.一个排他网关对应一个以上的顺序流\n    2.由排他网关流出的顺序流都有个conditionExpression元素，在内部维护返回boolean类型的决策结果。\n    3.决策网关只会返回一条结果。当流程执行到排他网关时，流程引擎会自动检索网关出口，从上到下检索如果发现第一条决策结果为true或者没有设置条件的(默认为成立)，则流出。\n    4.如果没有任何一个出口符合条件则抛出异常。\n\n 2. 并行网关\n \n    网关也可以表示流程中的并行情况。最简单的并行网关是parallelGateWay，它允许将流程分成多条分支，也可以把多条分支汇聚到一起。\n\n    **图形标记**：并行网关显示成一个普通网关（菱形）内部是一个“加号”图标，表示“与（AND）”语义。\n    ![并行网关][14]\n    \n    **XML内容**：定义并行网关只需要一行\n    ```xml\n    <parallelGateway id=\"myParallelGateway\"/>\n    ```\n    实际发生的行为（分支，聚合，同时分支聚合），要根据并行网关的顺序流来决定。\n    ```xml\n    <startEvent id=\"theStart\"/>\n\n    <sequenceFlow id=\"flow1\" sourceRef=\"theStart\" targetRef=\"fork\"/>\n    <parallelGateway id=\"fork\"/> \n     \n    <sequenceFlow sourceRef=\"fork\" targetRef=\"receivePayment\"/>\n    <sequenceFlow sourceRef=\"fork\" targetRef=\"shipOrder\"/>\n        \n    <userTaskid=\"receivePayment\"name=\"Receive Payment\"/>\n    <sequenceFlow sourceRef=\"receivePayment\" targetRef=\"join\"/>\n       \n    <userTaskid=\"shipOrder\"name=\"Ship Order\"/>\n    <sequenceFlow sourceRef=\"shipOrder\" targetRef=\"join\"/>\n    \n    <parallelGateway id=\"join\"/>\n    <sequenceFlow sourceRef=\"join\" targetRef=\"archiveOrder\"/>\n     \n    <userTask id=\"archiveOrder\"name=\"Archive Order\"/>\n    <sequenceFlow sourceRef=\"archiveOrder\" targetRef=\"theEnd\"/>\n             \n    <endEventid=\"theEnd\"/>\n    ```\n    上面例子中，流程启动之后，会创建两个任务：\n    ```java\n    ProcessInstancepi =runtimeService.startProcessInstanceByKey(\"forkJoin\");\n    \n    List<Task> tasks = taskService.createTaskQuery().list();\n    Task task1 =tasks.get(0);\n    System.out.println(\"Receive Payment\"+task1.getName());\n    Task task2 =tasks.get(1);\n    System.out.println(\"Ship Order\"+task2.getName());\n    ```\n    当两个任务都完成时，第二个并行网关会汇聚两个分支，因为它只有一条外出连线，不会创建并行分支，只会创建归档订单任务。\n    \n    说明：\n    1.并行网关的功能是基于进入和外出的顺序流的：\n        分支(fork)：并行后的所有外出顺序流，为每个顺序流都创建一个并发分支。\n        汇聚(join)：所有到达并行网关，在此等待的进入分支，直到所有进入顺序流的分支都到达以后， 流程就会通过汇聚网关。\n    2.并行网关的进入和外出都是使用相同节点标示\n    3.如果同一个并行网关有多个进入和多个外出顺序流，它就同时具有分支和汇聚功能。这时，网关会先汇聚所有进入的顺序流，然后再切分成多个并行分支。\n    4.并行网关不会解析条件。 即使顺序流中定义了条件，也会被忽略。\n    5.并行网关不需要是“平衡的”（比如，对应并行网关的进入和外出节点数目相等）。如图中标示是合法的：\n    ![并行网关不需要是“平衡的”][15]\n \n## 8.4 监听器（Listener）\n\n在流程中我们有时会对整个流程或者一个节点的某种状态做出相应的处理。这时就会用到监听器。\n\n在Activiti中流程的监听主要分为两大类，执行监听器和任务监听器。\n\n### 8.4.1 执行监听器（ExecutionListener）\n\n执行监听器可以执行外部java代码或执行表达式，当流程定义中发生了某个事件。 可以捕获的事件有:\n\n - 流程实例的启动和结束。\n - 选中一条连线。\n - 节点的开始和结束。\n - 网关的开始和结束。\n - 中间事件的开始和结束。\n - 开始事件结束或结束事件开始。\n\n现在有这样一个简单流程，只包含开始、结束、接收任务和用户任务4个节点：\n![监听器流程示例][16]\n配置监听器,XML代码如下\n```xml\n<extensionElements>\n      <activiti:executionListener event=\"start\" class=\"test.ProcessStartListener\"></activiti:executionListener>\n</extensionElements>\n```\n说明：\n\n - 任务监听器支持以下属性：\n    \n    - event（必选）：任务监听器会被调用的任务类型\n        - start：流程节点创建后触发\n        - end：当任务完成，并尚未从运行数据中删除时触发\n        - take：任务完成后，流程流出时触发\n    - class(必选)：代理类，实现org.activiti.engine.delegate.ExecutionListener接口。\n    示例：\n    ```java\n    public class ProcessStartListener implements ExecutionListener {\n\n    private static final long serialVersionUID = 1L;\n\n    @Override\n    public void notify(DelegateExecution execution) throws Exception {\n            System.out.println(\"ID:\"+execution.getId()+\", Name:\"+execution.getCurrentActivityName());\n        }\n    \n    }\n    ```\n\n - 执行监听器配置可以放在以下三个地方，如图\n![此处输入图片的描述][17]\n\n    a)\t监听整个流程的启动和结束状态，配置为process节点的子元素，如①\n    b)\t监听一个节点的启动和结束状态，配置为一个节点的子元素，如②和③\n    c)\t监听一条连线的执行，配置在sequenceFlow节点的内部，只有task一种事件，如④\n    \n启动流程测试代码如下：\n```java\n@Test\npublic void Demo1() {\n    //部署流程\n    Deployment deployment = repositoryService.createDeployment()\n                .addClasspathResource(\"diagrams/Listener.bpmn\")\n                .addClasspathResource(\"diagrams/Listener.png\")\n                .deploy();\n    //启动\n    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(\"ListenerTest\");\n    //推动\n    String processInstanceId = processInstance.getId();\n    runtimeService.signal(processInstanceId);\n    \n    String id = taskService.createTaskQuery().processInstanceId(processInstanceId).singleResult().getId();\n    taskService.complete(id);\n}\n```\n\n测试结果如下：\n\n        ID:60005, Name:开始\n        ID:60005, Name:接收任务\n        ID:60005, Name:用户任务\n\n### 8.4.2 任务监听器（TaskListener）\n\n任务监听器可以在发生对应的任务相关事件时执行自定义java逻辑 或表达式。\n任务监听器只能添加到流程定义中的用户任务中。在之前任务节点上添加任务监听:\n![此处输入图片的描述][18]\n\n任务监听器支持以下属性\n\n- event（必选）：任务监听器会被调用的任务类型。 可能的类型为：\n    - create：任务创建并设置所有属性后触发。\n    - assignment：任务分配给一些人时触发。当流程到达userTask，assignment事件 会在create事件之前发生。这样的顺序似乎不自然，但是原因很简单：当获得create时间时， 我们想获得任务的所有属性，包括执行人。\n    - complete：当任务完成，并尚未从运行数据中删除时触发。\n- class：必须调用的代理类。 这个类必须实现org.activiti.engine.delegate.TaskListener\t接口。\n\n\n----------\n\n新添加的任务监听包裹在executionListener监听的内部，顺序为：execution Start--> task Assignment-->task Create-->task Complete-->execution End-->execution take。\n\n\n# 9 Spring集成\n\n虽然前面的例子中我们可以自己手动来创建相应的API实例，但是在一个项目中这些API都应该以**单例形式**存在的。和Spring的集成主要就是把Activiti的主要对象交给Spring容器管理。\n\n```xml\n<!-- 流程引擎 -->\n<bean id=\"processEngine\" class=\"org.activiti.spring.ProcessEngineFactoryBean\"> \n\t<property name=\"processEngineConfiguration\" ref=\"processEngineConfiguration\"></property>\n</bean>\n\n<!-- 流程引擎配置对象 -->\n<bean id=\"processEngineConfiguration\" class=\"org.activiti.spring.SpringProcessEngineConfiguration\">\n\t<property name=\"dataSource\" ref=\"dataSource\" />\n\t<property name=\"transactionManager\" ref=\"transactionManager\" />\n\t<!-- activiti表数据更新策略 false true（默认） create-drop-->\n\t<property name=\"databaseSchemaUpdate\" value=\"true\" />\n\t<!-- activiti历史数据保存策略 none activity audit(默认) full-->\n\t<property name=\"history\" value=\"audit\" />\n\t<!-- 管理线程计时器和异步消息,默认开启，但有ManagementService替代，避免冲突所以关闭 -->\n\t<property name=\"jobExecutorActivate\" value=\"false\" />\n\t<!-- 加载资源文件 -->\n\t<property name=\"deploymentResources\" value=\"classpath:/activiti-process/*.bpmn\" />\n</bean>\n\n<!-- 核心业务类 -->\n<bean id=\"repositoryService\" factory-bean=\"processEngine\" factory-method=\"getRepositoryService\" />\n<bean id=\"runtimeService\" factory-bean=\"processEngine\" factory-method=\"getRuntimeService\" />\n<bean id=\"taskService\" factory-bean=\"processEngine\" factory-method=\"getTaskService\" />\n<bean id=\"historyService\" factory-bean=\"processEngine\" factory-method=\"getHistoryService\" />\n<bean id=\"managementService\" factory-bean=\"processEngine\" factory-method=\"getManagementService\" />\n```\n\n**注意：**\n 1. ProcessEngineConfiguration\n    单独使用和整合Spring时不是同一个class\n    独立使用：org.activiti.engine.ProcessEngineConfiguration\n    整合Spring：org.activiti.spring.SpringProcessEngineConfiguration\n 2. 项目部署后会自动在数据库中创建相关流程定义\n\n \n\n \n \n \n  \n\n\n  \n\n\n  [1]: https://www.zybuluo.com/mdeditor#785927\n  [2]: http://blog.csdn.net/dr_guo/article/details/50718063\n  [3]: http://activiti.org/download.htmlt/dr_guo/article/details/50718063\n  [4]: http://pan.baidu.com/s/1qYmgdlE\n  [5]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/create.png\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/example.png\n  [7]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/variable.png\n  [8]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/baseVar.png\n  [9]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/startEvent.png\n  [10]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/endEvent.png\n  [11]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/task.png\n  [12]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/gateWay.png\n  [13]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/xor.png\n  [14]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/parallelGateWay.png\n  [15]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/binxing.png\n  [16]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/listenerExample.png\n  [17]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/taskListener.png\n  [18]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/taskListener2.png","slug":"Activiti5-流程框架","published":1,"updated":"2018-02-27T07:38:38.082Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfhw0002hwvfbbdjm4ow","content":"<p>工作流(Workflow)，就是“业务过程的部分或整体在计算机应用环境下的自动化”，它主要解决的是“使在多个参与者之间按照某种预定义的规则传递文档、信息或任务的过程自动进行，从而实现某个预期的业务目标，或者促使此目标的实现”。<br><a id=\"more\"></a></p>\n<h1 id=\"1-Activiti简介\"><a href=\"#1-Activiti简介\" class=\"headerlink\" title=\"1 Activiti简介\"></a>1 Activiti简介</h1><p>Activiti5是由Alfresco软件在2010年5月17日发布的业务流程管理（BPM）框架，它是覆盖了业务流程管理、工作流、服务协作等领域的一个开源的、灵活的、易扩展的可执行流程语言框架。Activiti基于Apache许可的开源BPM平台，创始人Tom Baeyens是JBoss jBPM的项目架构师，它特色是提供了eclipse插件，开发人员可以通过插件直接绘画出业务流程图。</p>\n<h2 id=\"1-1-工作流引擎\"><a href=\"#1-1-工作流引擎\" class=\"headerlink\" title=\"1.1 工作流引擎\"></a>1.1 工作流引擎</h2><p>这是Activiti的核心，负责生成流程运行时的各种实例及数据、监控和管理流程的运行。</p>\n<h2 id=\"1-2-BPMN2-0\"><a href=\"#1-2-BPMN2-0\" class=\"headerlink\" title=\"1.2 BPMN2.0\"></a>1.2 BPMN2.0</h2><p>业务流程建模与标注（Business Process Model and Notation，BPMN) ，描述流程的基本符号，包括这些图元如何组合成一个业务流程图（Business Process Diagram）</p>\n<h2 id=\"1-3-数据库\"><a href=\"#1-3-数据库\" class=\"headerlink\" title=\"1.3 数据库\"></a>1.3 数据库</h2><p>Activiti的后台是有数据库的支持，所有的表都以ACT_开头。第二部分是表示表的用途的两个字母标识。 用途也和服务的API对应。</p>\n<ol>\n<li><strong>ACT<em>RE</em>*</strong>: ‘RE’表示repository。 这个前缀的表包含了流程定义和流程静态资源 （图片，规则，等等）。</li>\n<li><strong>ACT<em>RU</em>*</strong>: ‘RU’表示runtime。 这些运行时的表，包含流程实例，任务，变量，异步任务，等运行中的数据。 Activiti只在流程实例执行过程中保存这些数据， 在流程结束时就会删除这些记录。 这样运行时表可以一直很小速度很快。</li>\n<li><strong>ACT<em>ID</em>*</strong>: ‘ID’表示identity。 这些表包含身份信息，比如用户，组等等。</li>\n<li><strong>ACT<em>HI</em>*</strong>: ‘HI’表示history。 这些表包含历史数据，比如历史流程实例， 变量，任务等等。</li>\n<li><strong>ACT<em>GE</em>*</strong>: 通用数据， 用于不同场景下。</li>\n</ol>\n<h3 id=\"1-3-1-资源库流程规则表\"><a href=\"#1-3-1-资源库流程规则表\" class=\"headerlink\" title=\"1.3.1 资源库流程规则表\"></a>1.3.1 资源库流程规则表</h3><ol>\n<li>act_re_deployment  部署信息表</li>\n<li>act_re_mode        流程设计模型部署表</li>\n<li>act_re_procdef     流程定义表</li>\n</ol>\n<h3 id=\"1-3-2-运行时数据库\"><a href=\"#1-3-2-运行时数据库\" class=\"headerlink\" title=\"1.3.2 运行时数据库\"></a>1.3.2 运行时数据库</h3><ol>\n<li>act_ru_execution    运行时流程执行实例表</li>\n<li>act_ru_identitylink 运行时流程人员表，主要存储任务节点与参与者的相关信息</li>\n<li>act_ru_task            运行时任务节点表</li>\n<li>act_ru_variable        运行时流程变量数据表</li>\n</ol>\n<h3 id=\"1-3-3-历史数据库表\"><a href=\"#1-3-3-历史数据库表\" class=\"headerlink\" title=\"1.3.3 历史数据库表\"></a>1.3.3 历史数据库表</h3><ol>\n<li>act_hi_actinst             历史节点表</li>\n<li>act_hi_attachment        历史附件表</li>\n<li>act_hi_comment            历史意见表</li>\n<li>act_hi_identitylink        历史流程人员表</li>\n<li>act_hi_detail            历史详情表，提供历史变量的查询</li>\n<li>act_hi_procinst            历史流程实例表</li>\n<li>act_hi_taskinst            历史任务实例表</li>\n<li>act_hi_varinst            历史变量表</li>\n</ol>\n<h3 id=\"1-3-4-组织机构表\"><a href=\"#1-3-4-组织机构表\" class=\"headerlink\" title=\"1.3.4 组织机构表\"></a>1.3.4 组织机构表</h3><ol>\n<li>act_id_group        用户组信息表</li>\n<li>act_id_info        用户扩展信息表</li>\n<li>act_id_membership    用户与用户组对应信息表</li>\n<li>act_id_user        用户信息表</li>\n</ol>\n<p>这四张表很常见，基本的组织机构管理，关于用户认证方面建议还是自己开发一套，组件自带的功能太简单，使用中有很多需求难以满足 。可以使shiro完成用户认证。</p>\n<h3 id=\"1-3-5-统用数据表\"><a href=\"#1-3-5-统用数据表\" class=\"headerlink\" title=\"1.3.5 统用数据表\"></a>1.3.5 统用数据表</h3><ol>\n<li>act_ge_bytearray        二进制数据表</li>\n<li>act_ge_property        属性数据表存储整个流程引擎级别的数据,初始化表结构时，会默认插入三条记录</li>\n</ol>\n<h2 id=\"1-4-activiti-cfg-xml\"><a href=\"#1-4-activiti-cfg-xml\" class=\"headerlink\" title=\"1.4 activiti.cfg.xml\"></a>1.4 activiti.cfg.xml</h2><p>Activiti核心配置文件，配置流程引擎创建工具的基本参数和数据库连接池参数。</p>\n<p>定义数据库配置参数：</p>\n<ul>\n<li>jdbcUrl: 数据库的JDBC URL。</li>\n<li>jdbcDriver: 对应不同数据库类型的驱动。</li>\n<li>jdbcUsername: 连接数据库的用户名。</li>\n<li>jdbcPassword: 连接数据库的密码。</li>\n</ul>\n<p>基于JDBC参数配置的数据库连接 会使用默认的MyBatis连接池。 下面的参数可以用来配置连接池（来自MyBatis参数）：</p>\n<ul>\n<li>jdbcMaxActiveConnections: 连接池中处于被使用状态的连接的最大值。默认为10。</li>\n<li>jdbcMaxIdleConnections: 连接池中处于空闲状态的连接的最大值。</li>\n<li>jdbcMaxCheckoutTime: 连接被取出使用的最长时间，超过时间会被强制回收。 默认为20000（20秒）。</li>\n<li>jdbcMaxWaitTime: 这是一个底层配置，让连接池可以在长时间无法获得连接时， 打印一条日志，并重新尝试获取一个连接。（避免因为错误配置导致沉默的操作失败）。 默认为20000（20秒）。</li>\n</ul>\n<p>示例如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">name</span>=<span class=\"string\">\"processEngineConfiguration\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcDriver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/activititest\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcUsername\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcPassword\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"123\"</span> /&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- </span></div><div class=\"line\">\tdatabaseSchemaUpdate：设置流程引擎启动和关闭时如何处理数据库表</div><div class=\"line\">\tfalse（默认）:检查数据库表的版本和依赖库的版本，如果不一致就抛出异常</div><div class=\"line\">\ttrue:构建流程引擎是执行检查，如果需要就更新，如果表不存在就创建</div><div class=\"line\">\tcreate-drop：构建流程引擎是创建表，关闭时删除表  </div><div class=\"line\">--&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"databaseSchemaUpdate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>关于c3p0、dbcp等数据库连接池配置请参看<a href=\"https://www.zybuluo.com/mdeditor#785927\" target=\"_blank\" rel=\"noopener\">spring(4)——持久层封装</a></p>\n<h2 id=\"1-5-logging-properties\"><a href=\"#1-5-logging-properties\" class=\"headerlink\" title=\"1.5 logging.properties\"></a>1.5 logging.properties</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">log4j.rootLogger=WARN, stdout</div><div class=\"line\">log4j.appender.stdout=org.apache.log4j.ConsoleAppender</div><div class=\"line\">log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</div><div class=\"line\">log4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - %m%n</div></pre></td></tr></table></figure>\n<p>更详细log4j说明请参看<a href=\"http://blog.csdn.net/dr_guo/article/details/50718063\" target=\"_blank\" rel=\"noopener\">log4j.properties配置详解与实例</a></p>\n<h1 id=\"2-环境搭建\"><a href=\"#2-环境搭建\" class=\"headerlink\" title=\"2 环境搭建\"></a>2 环境搭建</h1><h2 id=\"2-1-需求java环境\"><a href=\"#2-1-需求java环境\" class=\"headerlink\" title=\"2.1 需求java环境\"></a>2.1 需求java环境</h2><ol>\n<li>JDK1.6或更高</li>\n<li>支持的数据库有：h2, mysql, oracle, postgres, mssql, db2等。</li>\n<li>支持activiti5运行的jar包</li>\n<li>开发环境为Eclipse3.7或者以上版本,myeclipse为8.6版本</li>\n</ol>\n<h2 id=\"2-2-资源下载\"><a href=\"#2-2-资源下载\" class=\"headerlink\" title=\"2.2 资源下载\"></a>2.2 资源下载</h2><p>activiti可以到<a href=\"http://activiti.org/download.htmlt/dr_guo/article/details/50718063\" target=\"_blank\" rel=\"noopener\">Activiti官方网站</a>下载得到。</p>\n<p>百度网盘下载地址，5.22.0和6.0.0两个版本，还有eclipse插件。<a href=\"http://pan.baidu.com/s/1qYmgdlE\" target=\"_blank\" rel=\"noopener\">百度网盘下载</a></p>\n<p>注意：安装插件后，在Windows-&gt;Preferences-&gt;Activiti-&gt;Save菜单下勾选保存时自动生成图片。</p>\n<h2 id=\"2-3-配置开发环境\"><a href=\"#2-3-配置开发环境\" class=\"headerlink\" title=\"2.3 配置开发环境\"></a>2.3 配置开发环境</h2><h3 id=\"2-3-1-添加jar包\"><a href=\"#2-3-1-添加jar包\" class=\"headerlink\" title=\"2.3.1 添加jar包\"></a>2.3.1 添加jar包</h3><p>在activiti-5.22.0→wars目录下是一些示例项目，解压activiti-rest项目，导入activiti-rest目录中WEB-INF\\lib下所有jar包到classpath中。<br>注意还需要数据库连接驱动包，如Mysql还需要添加<strong>mysql-connector-java.jar</strong>。</p>\n<h3 id=\"2-3-2-初始化数据库\"><a href=\"#2-3-2-初始化数据库\" class=\"headerlink\" title=\"2.3.2 初始化数据库\"></a>2.3.2 初始化数据库</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createTable</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//1、创建流程引擎配置对象</span></div><div class=\"line\">\tProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration.createStandaloneProcessEngineConfiguration();</div><div class=\"line\">\t<span class=\"comment\">//2、配置数据库</span></div><div class=\"line\">\tprocessEngineConfiguration.setJdbcDriver(<span class=\"string\">\"com.mysql.jdbc.Driver\"</span>);</div><div class=\"line\">\tprocessEngineConfiguration.setJdbcUrl(<span class=\"string\">\"jdbc:mysql://localhost:3306/activititest\"</span>);</div><div class=\"line\">\tprocessEngineConfiguration.setJdbcUsername(<span class=\"string\">\"root\"</span>);</div><div class=\"line\">\tprocessEngineConfiguration.setJdbcPassword(<span class=\"string\">\"123\"</span>);</div><div class=\"line\">\t<span class=\"comment\">//3、设置建表策略</span></div><div class=\"line\">\tprocessEngineConfiguration.setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE);</div><div class=\"line\">\t<span class=\"comment\">//4、创建流程引擎对象</span></div><div class=\"line\">\tProcessEngine processEngine = processEngineConfiguration.buildProcessEngine();</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"processEngine\"</span>+processEngine);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>在Activiti中，在创建核心的流程引擎对象时会自动建表。如果程序正常执行，mysql会自动建库，然后创建23张表。</p>\n<h3 id=\"2-3-3-配置文件\"><a href=\"#2-3-3-配置文件\" class=\"headerlink\" title=\"2.3.3 配置文件\"></a>2.3.3 配置文件</h3><p>在Actiiti5中定制流程必定会操作到数据库，如果都像上面那样写一大段代码会非常麻烦，所以我们可以把数据库连接配置写入配置文件。</p>\n<p>在Activiti5的官方示例中并没有现成的配置文件，所以先得找到activiti-rest\\WEB-INF\\classes下有：<strong>activiti-context.xml</strong>：一个类似spring结构的配置文件，清空内容后改名为activiti.cfg.xml，用来做流程引擎的相关配置。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">name</span>=<span class=\"string\">\"processEngineConfiguration\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcDriver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/activititest\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcUsername\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcPassword\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"123\"</span> /&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- </span></div><div class=\"line\">\tdatabaseSchemaUpdate：设置流程引擎启动和关闭时如何处理数据库表</div><div class=\"line\">\tfalse（默认）:检查数据库表的版本和依赖库的版本，如果不一致就抛出异常</div><div class=\"line\">\ttrue:构建流程引擎是执行检查，如果需要就更新，如果表不存在就创建</div><div class=\"line\">\tcreate-drop：构建流程引擎是创建表，关闭时删除表  </div><div class=\"line\">--&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"databaseSchemaUpdate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>Java代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createTable2</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class=\"string\">\"activiti.cfg.xml\"</span>);</div><div class=\"line\">\tProcessEngine processEngine = processEngineConfiguration.buildProcessEngine();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h1 id=\"3-核心API\"><a href=\"#3-核心API\" class=\"headerlink\" title=\"3 核心API\"></a>3 核心API</h1><h2 id=\"3-1-ProcessEngine\"><a href=\"#3-1-ProcessEngine\" class=\"headerlink\" title=\"3.1 ProcessEngine\"></a>3.1 ProcessEngine</h2><ol>\n<li>在Activiti中最核心的类，其他的类都是由它而来。</li>\n<li><p>产生方式<br>2.1 方式一：最基础版本，见2.3.2小节<br>2.2 方式二：配置文件+java代码，见2.3.3小节</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createTable3</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>这种方式更加简单，会自动加载classpath下名为activiti.cfg.xml的文件。</p>\n</li>\n<li><p>产生各种service</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//流程仓库业务类，管理流程定义、部署</span></div><div class=\"line\">RepositoryService repositoryService = processEngine.getRepositoryService();</div><div class=\"line\"><span class=\"comment\">//流程运行业务类，管理流程启动、推进、删除等操作</span></div><div class=\"line\">RuntimeService runtimeService = processEngine.getRuntimeService();</div><div class=\"line\"><span class=\"comment\">//流程任务类，管理具体的任务</span></div><div class=\"line\">TaskService taskService = processEngine.getTaskService();</div><div class=\"line\"><span class=\"comment\">//流程历史数据类</span></div><div class=\"line\">HistoryService historyService = processEngine.getHistoryService();</div><div class=\"line\"><span class=\"comment\">//流程用户业务类</span></div><div class=\"line\">IdentityService identityService = processEngine.getIdentityService();</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"3-2-ReposityService\"><a href=\"#3-2-ReposityService\" class=\"headerlink\" title=\"3.2 ReposityService\"></a>3.2 ReposityService</h2><p>流程仓库业务类，仓库简单理解即流程定义文档的两个文件：bpmn文件和流程图片</p>\n<ol>\n<li><p>产生流程部署配置对象，用来定义流程部署的相关参数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">@Test</div><div class=\"line\">public void Demo1() &#123;</div><div class=\"line\">\tDeploymentBuilder deploymentBuilder = processEngine.getRepositoryService().createDeployment().name(&quot;test&quot;);</div><div class=\"line\">\tdeploymentBuilder.addClasspathResource(&quot;diagrams/HelloWord.bpmn&quot;);</div><div class=\"line\">\tdeploymentBuilder.addClasspathResource(&quot;diagrams/HelloWord.png&quot;);</div><div class=\"line\">\t</div><div class=\"line\">\tDeployment deployment = deploymentBuilder.deploy();</div><div class=\"line\">\tSystem.out.println(deployment.getId() + &quot;。。。。&quot;+ deployment.getName());</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>删除流程定义</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">repositoryService.deleteDeployment(deploymentId);</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"3-3-RuntimeService\"><a href=\"#3-3-RuntimeService\" class=\"headerlink\" title=\"3.3 RuntimeService\"></a>3.3 RuntimeService</h2><p>流程执行服务类。可以从这个类中获取很多关于流程执行相关的信息。</p>\n<ol>\n<li><p>启动流程</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//常用的启动流程实例的两种方法</span></div><div class=\"line\">ProcessInstance processInstance = runtimeService.startProcessInstanceById(processInstanceId);</div><div class=\"line\">ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(processInstanceKey);</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"3-4-TaskService\"><a href=\"#3-4-TaskService\" class=\"headerlink\" title=\"3.4 TaskService\"></a>3.4 TaskService</h2><p>activiti的任务服务类。可以从这个类中获取任务的信息。</p>\n<h2 id=\"3-5-ProcessDefinition\"><a href=\"#3-5-ProcessDefinition\" class=\"headerlink\" title=\"3.5 ProcessDefinition\"></a>3.5 ProcessDefinition</h2><p>流程定义类。可以从这里获得资源文件等。<br>每个流程文件唯一对应一个相同key的流程定义，只是流程定义的version不同</p>\n<h2 id=\"3-6-ProcessInstance\"><a href=\"#3-6-ProcessInstance\" class=\"headerlink\" title=\"3.6 ProcessInstance\"></a>3.6 ProcessInstance</h2><p>流程实例。根据流程定义实例化的具体流程，我们可以利用这个对象来了解当前流程实例的进度等信息。<br>如：<br>    公司有一个所有人通用的请假流程，这个叫做流程定义。<br>    小明今天请假，填写请假单，就是创建了一个流程实例。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/** Represents one execution of a  &#123;<span class=\"doctag\">@link</span> ProcessDefinition&#125;.</span></div><div class=\"line\"> 1. </div><div class=\"line\"> 2. <span class=\"doctag\">@author</span> Tom Baeyens</div><div class=\"line\"> 3. <span class=\"doctag\">@author</span> Joram Barrez</div><div class=\"line\"> 4. <span class=\"doctag\">@author</span> Daniel Meyer</div><div class=\"line\"> 5. <span class=\"doctag\">@author</span> Tijs Rademakers</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ProcessInstance</span> <span class=\"keyword\">extends</span> <span class=\"title\">Execution</span> </span>&#123;</div></pre></td></tr></table></figure>\n<p>从上面可以看出ProcessInstance就是Execution，但实际有点区别</p>\n<ol>\n<li>单线流程中，ProcessInstance与Execution是一致的，ID都一样</li>\n<li>多线 流程中，总线路代表ProcessInstance，而分线路中每个活动代表Execution。</li>\n</ol>\n<h2 id=\"3-7-Execution\"><a href=\"#3-7-Execution\" class=\"headerlink\" title=\"3.7 Execution\"></a>3.7 Execution</h2><p>Activiti用这个对象去描述流程执行的每一个节点。在没有并发的情况下，同ProcessInstance。</p>\n<h1 id=\"4-流程定义\"><a href=\"#4-流程定义\" class=\"headerlink\" title=\"4 流程定义\"></a>4 流程定义</h1><h2 id=\"4-1-创建流程文件\"><a href=\"#4-1-创建流程文件\" class=\"headerlink\" title=\"4.1 创建流程文件\"></a>4.1 创建流程文件</h2><p>在classpath下创建流程文件<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/create.png\" alt=\"创建\"><br>编辑流程文件<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/example.png\" alt=\"编辑\"></p>\n<h2 id=\"4-2-部署流程定义\"><a href=\"#4-2-部署流程定义\" class=\"headerlink\" title=\"4.2 部署流程定义\"></a>4.2 部署流程定义</h2><p>部署流程定义可以看成是添加流程定义<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">deploy</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//创建流程引擎</span></div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    <span class=\"comment\">//创建流程部署对象</span></div><div class=\"line\">    DeploymentBuilder deploymentBuilder = processEngine.getRepositoryService().createDeployment();</div><div class=\"line\">    <span class=\"comment\">//读取文件部署流程</span></div><div class=\"line\">    Deployment deploy = deploymentBuilder.name(<span class=\"string\">\"测试\"</span>)</div><div class=\"line\">                            .addClasspathResource(<span class=\"string\">\"diagrams/HelloWord.bpmn\"</span>)</div><div class=\"line\">                            .addClasspathResource(<span class=\"string\">\"diagrams/HelloWord.png\"</span>)</div><div class=\"line\">                            .deploy();</div><div class=\"line\">    </div><div class=\"line\">    System.out.println(deploy.getId() + <span class=\"string\">\"。。。\"</span> + deploy.getName());</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p><strong>部署流程会改变3张表</strong></p>\n<ul>\n<li>act_re_deployment<br> 存放流程定义的显示名和部署时间，每部署一次增加一条记录</li>\n<li>act_re_procdef<br> 存放流程定义的属性信息，部署每个新的流程定义都会在这张表中增加一条记录。</li>\n<li>act_ge_bytearray<br> 存储流程定义相关的部署信息。即流程定义文档的存放地。每部署一次就会增加两条记录，一条是关于bpmn规则文件的，一条是图片的（如果部署时只指定了bpmn一个文件，activiti会在部署时解析bpmn文件内容自动生成流程图）。两个文件不是很大，都是以二进制形式存储在数据库中。</li>\n</ul>\n<h2 id=\"4-3-查看流程定义\"><a href=\"#4-3-查看流程定义\" class=\"headerlink\" title=\"4.3 查看流程定义\"></a>4.3 查看流程定义</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">view</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();</div><div class=\"line\">    List&lt;ProcessDefinition&gt; list = repositoryService.createProcessDefinitionQuery()</div><div class=\"line\">                                        <span class=\"comment\">//过滤条件</span></div><div class=\"line\">                                        .processDefinitionKey(<span class=\"string\">\"HelloWorld\"</span>)</div><div class=\"line\">                                        <span class=\"comment\">//.processDefinitionId(processDefinitionId)</span></div><div class=\"line\">                                        <span class=\"comment\">//分页</span></div><div class=\"line\">                                        <span class=\"comment\">//.listPage(firstResult, maxResults)</span></div><div class=\"line\">                                        <span class=\"comment\">//排序</span></div><div class=\"line\">                                        <span class=\"comment\">//.orderByProcessDefinitionVersion()</span></div><div class=\"line\">                                        <span class=\"comment\">//执行查询</span></div><div class=\"line\">                                        .list();</div><div class=\"line\">    <span class=\"keyword\">for</span> (ProcessDefinition processDefinition : list) &#123;</div><div class=\"line\">        System.out.print(<span class=\"string\">\"id:\"</span> + processDefinition.getId() + <span class=\"string\">\",\"</span>);<span class=\"comment\">//流程Id</span></div><div class=\"line\">        System.out.print(<span class=\"string\">\"key:\"</span> + processDefinition.getKey() + <span class=\"string\">\",\"</span>);<span class=\"comment\">//流程Key</span></div><div class=\"line\">        System.out.print(<span class=\"string\">\"name:\"</span> + processDefinition.getName() + <span class=\"string\">\",\"</span>);<span class=\"comment\">//流程名字</span></div><div class=\"line\">        System.out.print(<span class=\"string\">\"version:\"</span> + processDefinition.getVersion() + <span class=\"string\">\",\"</span>);<span class=\"comment\">//流程版本</span></div><div class=\"line\">        System.out.println(<span class=\"string\">\"deploymentId():\"</span> + processDefinition.getDeploymentId());<span class=\"comment\">//流程部署对象Id</span></div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>查询结果</p>\n<pre><code>id:HelloWorld:1:35004,key:HelloWorld,name:请假审批流程,version:1,deploymentId():35001\n</code></pre><p>再部署一次，再查询</p>\n<pre><code>id:HelloWorld:1:35004,key:HelloWorld,name:请假审批流程,version:1,deploymentId():35001\nid:HelloWorld:2:37504,key:HelloWorld,name:请假审批流程,version:2,deploymentId():37501\n</code></pre><p>说明：</p>\n<ol>\n<li>因为流程定义的信息在仓库中，实际在act<em>re</em>*表中，所以创建RepositoryService</li>\n<li>创建查询对象<strong>ProcessDefinitionQuery</strong>，设置查询参数，调用list()执行查询</li>\n<li><p>由查询结果可知：<br>3.1 流程定义的key和name与流程文件的id和name一致</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">process</span> <span class=\"attr\">id</span>=<span class=\"string\">\"HelloWorld\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"请假审批流程\"</span> <span class=\"attr\">isExecutable</span>=<span class=\"string\">\"true\"</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>3.2 key属性被用来区别不同的流程定义。<br>3.3 带有特定key的流程定义第一次部署时，version为1。之后每次部署都会在当前最高版本号上加1<br>3.4 Id的生成规则为：<strong>{processDefinitionKey}:{processDefinitionVersion}:{generated-id}</strong>，这里的generated-id是一个自动生成的唯一的数字<br>3.5 重复部署一次，deploymentId的值以一定的形式变化</p>\n</li>\n</ol>\n<h2 id=\"4-4-删除流程定义\"><a href=\"#4-4-删除流程定义\" class=\"headerlink\" title=\"4.4 删除流程定义\"></a>4.4 删除流程定义</h2><p>删除部署到activiti中的流程定义。如:删除请假流程定义，则大家再也不能请假了。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">delete</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();</div><div class=\"line\">    String deploymentId = <span class=\"string\">\"7501\"</span>;</div><div class=\"line\">    <span class=\"comment\">//如果有关联信息，会报错</span></div><div class=\"line\">    <span class=\"comment\">//repositoryService.deleteDeployment(deploymentId);</span></div><div class=\"line\">    <span class=\"comment\">//如果有关联信息，会级联删除</span></div><div class=\"line\">    repositoryService.deleteDeployment(deploymentId, <span class=\"keyword\">true</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"4-5-获取流程定义文档资源\"><a href=\"#4-5-获取流程定义文档资源\" class=\"headerlink\" title=\"4.5 获取流程定义文档资源\"></a>4.5 获取流程定义文档资源</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getResource</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</div><div class=\"line\">    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();</div><div class=\"line\">   </div><div class=\"line\">    String deploymentId = <span class=\"string\">\"35001\"</span>;</div><div class=\"line\">    String resourceName = <span class=\"keyword\">null</span>;</div><div class=\"line\">    <span class=\"comment\">//资源文件名,即act_re_bytearray表中的name</span></div><div class=\"line\">    List&lt;String&gt; names = repositoryService.getDeploymentResourceNames(deploymentId);</div><div class=\"line\">    <span class=\"keyword\">for</span> (String str : names) &#123;</div><div class=\"line\">        <span class=\"comment\">//过滤出特定的图片文件</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (str.indexOf(<span class=\"string\">\"HelloWorld.png\"</span>) != -<span class=\"number\">1</span>) &#123;</div><div class=\"line\">            resourceName = str;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    System.out.println(resourceName);</div><div class=\"line\">    <span class=\"keyword\">if</span> (resourceName != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">        <span class=\"comment\">//通过部署ID和文件名获得输入流</span></div><div class=\"line\">        InputStream inputStream = repositoryService.getResourceAsStream(deploymentId, resourceName);</div><div class=\"line\">        File file = <span class=\"keyword\">new</span> File(<span class=\"string\">\"D:/\"</span>+ resourceName);</div><div class=\"line\">        FileUtils.copyInputStreamToFile(inputStream, file);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h1 id=\"5-流程实例\"><a href=\"#5-流程实例\" class=\"headerlink\" title=\"5 流程实例\"></a>5 流程实例</h1><h2 id=\"5-1-启动流程实例\"><a href=\"#5-1-启动流程实例\" class=\"headerlink\" title=\"5.1 启动流程实例\"></a>5.1 启动流程实例</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">startProcess</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    RuntimeService runtimeService = ProcessEngines.getDefaultProcessEngine().getRuntimeService();</div><div class=\"line\">    <span class=\"comment\">//根据流程Id启动流程</span></div><div class=\"line\">    <span class=\"comment\">//ProcessInstance processInstance = runtimeService.startProcessInstanceById(processDefinitionId);</span></div><div class=\"line\">    <span class=\"comment\">//根据流程key启动流程，会自动找到版本最高的流程定义来创建</span></div><div class=\"line\">    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(<span class=\"string\">\"HelloWorld\"</span>);</div><div class=\"line\">    System.out.println(processInstance.getId());<span class=\"comment\">//流程实例Id</span></div><div class=\"line\">    System.out.println(processInstance.getActivityId());<span class=\"comment\">//流程当前节点Id</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<pre><code>启动流程实例有很多重载方法，根据实际需要选用。\n</code></pre><h2 id=\"5-2-查询任务\"><a href=\"#5-2-查询任务\" class=\"headerlink\" title=\"5.2 查询任务\"></a>5.2 查询任务</h2><p>在Activiti中，任务主要分为两类：</p>\n<ol>\n<li>确切指定了办理者的任务，之歌任务称为制定者的私人任务</li>\n<li>2.无法指定具体的某一个人来办理的任务，可以把任务分配给几个人或者一到    多个小组，让这个范围内的用户可以选择性（如有空余时间时）来办理这类任务。</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">taskQuery</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    TaskService taskService = ProcessEngines.getDefaultProcessEngine().getTaskService();</div><div class=\"line\">    List&lt;Task&gt; list = taskService.createTaskQuery()</div><div class=\"line\">            <span class=\"comment\">//查询指定用户的私人任务</span></div><div class=\"line\">            <span class=\"comment\">//.taskAssignee(\"指定用户\")</span></div><div class=\"line\">            <span class=\"comment\">//查询某人可接的共有任务</span></div><div class=\"line\">            <span class=\"comment\">//.taskCandidateUser(\"候选用户\")</span></div><div class=\"line\">            <span class=\"comment\">//排序</span></div><div class=\"line\">            .orderByTaskCreateTime().desc()</div><div class=\"line\">            <span class=\"comment\">//执行查询</span></div><div class=\"line\">            .list();</div><div class=\"line\">    <span class=\"keyword\">for</span> (Task task : list) &#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"id:\"</span> + task.getId());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"name:\"</span> + task.getName());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"assignee:\"</span> + task.getAssignee());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"createTime:\"</span> + task.getCreateTime());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ProcessInstanceId:\"</span> + task.getProcessInstanceId());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ProcessDefinitionId:\"</span> + task.getProcessDefinitionId());</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"5-3-认领任务\"><a href=\"#5-3-认领任务\" class=\"headerlink\" title=\"5.3 认领任务\"></a>5.3 认领任务</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">taskService.claim(taskId, userId);</div></pre></td></tr></table></figure>\n<p>将任务变为用户的私人任务</p>\n<h2 id=\"5-4-办理任务\"><a href=\"#5-4-办理任务\" class=\"headerlink\" title=\"5.4 办理任务\"></a>5.4 办理任务</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//根据任务Id办理任务</span></div><div class=\"line\">taskService.complete(taskId);</div><div class=\"line\"><span class=\"comment\">//根据任务Id办理任务,并设置任务变量</span></div><div class=\"line\">taskService.complete(taskId, variables);</div></pre></td></tr></table></figure>\n<p>variables是Map，当设置变量时，会在act_ru_variables表中添加相应条数的数据，变量可以用来执行gateway的判断，后面会讲到gateway。</p>\n<h2 id=\"5-5-判断流程是否结束\"><a href=\"#5-5-判断流程是否结束\" class=\"headerlink\" title=\"5.5 判断流程是否结束\"></a>5.5 判断流程是否结束</h2><p>在流程执行过程中，创建的流程实例ID在整个过程都不会变，当流程结束后，流程实例将被删除。</p>\n<ol>\n<li>从运行库中查询该流程是否还存在</li>\n<li>从历史库中查询该流程是否存在</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">checkStatus</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    String processInstanceId = <span class=\"string\">\"1213\"</span>;</div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    RuntimeService runtimeService = processEngine.getRuntimeService();</div><div class=\"line\">    <span class=\"comment\">//从运行库查询该流程实例是否存在</span></div><div class=\"line\">    ProcessInstance instance = runtimeService.createProcessInstanceQuery()</div><div class=\"line\">                                    .processInstanceId(processInstanceId)</div><div class=\"line\">                                    .singleResult();</div><div class=\"line\">    <span class=\"comment\">//实例不存在，可能未开始或者已结束</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (instance == <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">        <span class=\"comment\">//从历史库查</span></div><div class=\"line\">        HistoryService historyService = processEngine.getHistoryService();</div><div class=\"line\">        HistoricProcessInstance singleResult = historyService.createHistoricProcessInstanceQuery()</div><div class=\"line\">                                                .processInstanceId(processInstanceId)</div><div class=\"line\">                                                .singleResult();</div><div class=\"line\">        <span class=\"keyword\">if</span> (singleResult != <span class=\"keyword\">null</span> &amp;&amp; singleResult.getEndTime() != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">            <span class=\"comment\">//流程已结束</span></div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">\"COMPLETE\"</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            <span class=\"comment\">//流程未开始</span></div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">\"NOT_START\"</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> instance.getActivityId();<span class=\"comment\">//当前任务节点</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h1 id=\"6-流程历史\"><a href=\"#6-流程历史\" class=\"headerlink\" title=\"6 流程历史\"></a>6 流程历史</h1><p>在前一个的例子中，大家可能会流程执行完毕后，究竟去了哪里有些疑问。虽然已完成的任务在act_ru_task和act_ru_execution表中都已被删除，但是这些数据还存在activiti的数据库中，作为历史改由HistoryService来管理。</p>\n<p>历史是一个组件，它可以捕获发生在进程执行中的信息并永久的保存，与运行时数据不同的是，当流程实例运行完成之后它还会存在于数据库中。</p>\n<p>在流程引擎配置对象中可以设置历史记录规则：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">name</span>=<span class=\"string\">\"processEngineConfiguration\"</span> </span></div><div class=\"line\">  \t  <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"databaseSchemaUpdate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!--</span></div><div class=\"line\">\t\tActiviti提供了四种历史级别：</div><div class=\"line\">\t\tnone:不保存任何历史，可以提高性能</div><div class=\"line\">\t\tactiviti:保存所有流程实例、任务、活动信息</div><div class=\"line\">\t\taudit:默认级别,保存所有流程实例、任务、活动、表单</div><div class=\"line\">\t\tfull:保存所有信息,如流程变量</div><div class=\"line\">\t  --&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"history\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"activiti\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>由于数据库中保存着历史信息以及正在运行的流程实例信息，在实际项目中对已完成任务的查看频率远不及对代办和可接任务的查看，所以在activiti采用分开管理，把正在运行的交给runtimeService管理，而历史数据交给HistoryService来管理。</p>\n<p>对已成为历史的数据主要进行查询操作，我们主要关心两种类型的历史数据：</p>\n<ul>\n<li><strong>HistoricProcessInstance</strong> 包含当前和已经结束的流程实例信息。</li>\n<li><strong>HistoricActivityInstance</strong> 包含一个活动(流程上的节点)的执行信息。</li>\n</ul>\n<h2 id=\"6-1-查看历史流程实例\"><a href=\"#6-1-查看历史流程实例\" class=\"headerlink\" title=\"6.1 查看历史流程实例\"></a>6.1 查看历史流程实例</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">queryHisInstance</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//流程引擎</span></div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    <span class=\"comment\">//流程定义ID</span></div><div class=\"line\">    String processDefinitionId = <span class=\"string\">\"HelloWorld:2:37504\"</span>;</div><div class=\"line\">    <span class=\"comment\">//查询历史流程实例</span></div><div class=\"line\">    List&lt;HistoricProcessInstance&gt; list = processEngine.getHistoryService().createHistoricProcessInstanceQuery()</div><div class=\"line\">                                        .processDefinitionId(processDefinitionId)</div><div class=\"line\">                                        .finished()</div><div class=\"line\">                                        .orderByProcessInstanceStartTime().desc()</div><div class=\"line\">                                        .list();</div><div class=\"line\">    <span class=\"keyword\">for</span> (HistoricProcessInstance hp : list) &#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ID：\"</span>+hp.getId());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"startTime：\"</span>+hp.getStartTime());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"endTime：\"</span>+hp.getEndTime());</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>1.通常查询历史流程实例都需要指定一个过滤条件，指定    processDefinitionId查看具体某一次部署所开启的流程或者指定    processDefinitionKey查看某个规则下不限版本的所有流程</p>\n<p>2.可以选择性添加finished方法控制是否查询未完成的流程实例。在流    程开启时，activiti同时在act_ru_execution表和act_hi_procinst表中    创建了一条记录，在流程完成之前act_hi_procinst表中实例的结束时间为空</p>\n<h2 id=\"6-2-查看历史流程活动（节点）\"><a href=\"#6-2-查看历史流程活动（节点）\" class=\"headerlink\" title=\"6.2 查看历史流程活动（节点）\"></a>6.2 查看历史流程活动（节点）</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">queryHisActiviti</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//流程引擎</span></div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    <span class=\"comment\">//流程实例ID</span></div><div class=\"line\">    String processInstanceId = <span class=\"string\">\"HelloWorld:2:37504\"</span>;</div><div class=\"line\">    <span class=\"comment\">//查询历史流程活动</span></div><div class=\"line\">    List&lt;HistoricActivityInstance&gt; list = processEngine.getHistoryService()</div><div class=\"line\">                                        <span class=\"comment\">//创建历史流程活动实例查询对象</span></div><div class=\"line\">                                        .createHistoricActivityInstanceQuery()</div><div class=\"line\">                                        <span class=\"comment\">//过滤条件</span></div><div class=\"line\">                                        .processInstanceId(processInstanceId)</div><div class=\"line\">                                        <span class=\"comment\">//排序</span></div><div class=\"line\">                                        .orderByHistoricActivityInstanceStartTime().desc()</div><div class=\"line\">                                        <span class=\"comment\">//执行查询</span></div><div class=\"line\">                                        .list();</div><div class=\"line\">    <span class=\"keyword\">for</span> (HistoricActivityInstance ha : list) &#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ID：\"</span>+ha.getActivityId());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"name:\"</span>+ha.getActivityName());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"startTime：\"</span>+ha.getStartTime());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"endTime：\"</span>+ha.getEndTime());</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>通常查询历史流程活动都需要指定一个过滤条件，指定processInstanceId查看具体某一次流程执行过程中所经历的步奏</p>\n<h1 id=\"7-流程变量\"><a href=\"#7-流程变量\" class=\"headerlink\" title=\"7 流程变量\"></a>7 流程变量</h1><p>流程变量在整个工作流中扮演很重要的作用。例如：请假流程中有请假天数、请假原因等一些参数都为流程变量的范围。<br>流程变量的作用域范围是流程实例。也就是说各个流程实例的流程变量是不相互影响的。<br>流程实例结束完成以后流程变量是否保存在数据库中取决于存储策略，见第六章。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/variable.png\" alt=\"流程变量\"></p>\n<h2 id=\"7-1-添加流程变量\"><a href=\"#7-1-添加流程变量\" class=\"headerlink\" title=\"7.1 添加流程变量\"></a>7.1 添加流程变量</h2><ol>\n<li><p>启动流程实例时添加</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addVariables</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    RuntimeService runtimeService = processEngine.getRuntimeService();</div><div class=\"line\">    </div><div class=\"line\">    String processDefinitionKey = <span class=\"string\">\"HelloWorld\"</span>;</div><div class=\"line\">    Map&lt;String,Object&gt; variables = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</div><div class=\"line\">    variables.put(<span class=\"string\">\"请假天数\"</span>, <span class=\"number\">3</span>);</div><div class=\"line\">    variables.put(<span class=\"string\">\"请假原因\"</span>, <span class=\"string\">\"约会\"</span>);</div><div class=\"line\">    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(processDefinitionKey, variables);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>说明：</p>\n<pre><code>1)    在启动流程实例时，通过重载startProcessInstanceByKey的方法可以加载流程变量。\n2)    第二个参数要求是Map&lt;String ,Object&gt;类型，意味着可以添加多个流程变量。\n3)    当这段代码执行完以后，会在数据库表act_ru_variable中添加两行记录。\n</code></pre></li>\n</ol>\n<ol>\n<li>完成任务时添加<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//办理过程中</span></div><div class=\"line\">taskService.setVariables(taskId, variables);</div><div class=\"line\"><span class=\"comment\">//提交时</span></div><div class=\"line\">taskService.complete(taskId, variables);</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li>执行流程实例时添加<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//执行流程实例时</span></div><div class=\"line\">runtimeService.setVariables(executionId, variables);</div><div class=\"line\"><span class=\"comment\">//流程实例提交时</span></div><div class=\"line\">runtimeService.signal(executionId, processVariables);<span class=\"comment\">//signal用于接受任务</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"7-2-获取流程变量\"><a href=\"#7-2-获取流程变量\" class=\"headerlink\" title=\"7.2 获取流程变量\"></a>7.2 获取流程变量</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//某个流程的变量</span></div><div class=\"line\">runtimeService.getVariables(executionId);</div><div class=\"line\"><span class=\"comment\">//某个任务的变量</span></div><div class=\"line\">taskService.getVariables(taskId);</div></pre></td></tr></table></figure>\n<p>说明：这些流程变量是从act_ru_variable这个表中读出来的。</p>\n<h2 id=\"7-3-流程变量范围\"><a href=\"#7-3-流程变量范围\" class=\"headerlink\" title=\"7.3 流程变量范围\"></a>7.3 流程变量范围</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/baseVar.png\" alt=\"此处输入图片的描述\"></p>\n<p>从图中可以看出包括了大部分封装类型和Date、String和实现了Serializable接口的类的类型。</p>\n<h2 id=\"7-4-Javabean类型变量\"><a href=\"#7-4-Javabean类型变量\" class=\"headerlink\" title=\"7.4 Javabean类型变量\"></a>7.4 Javabean类型变量</h2><ol>\n<li>定义一个javabean，这个javabean实现了Serializable接口</li>\n<li>实例化javaBean，放到map中，然后正常设置流程变量</li>\n<li>正常取出变量</li>\n</ol>\n<h1 id=\"8-流程定义语言\"><a href=\"#8-流程定义语言\" class=\"headerlink\" title=\"8 流程定义语言\"></a>8 流程定义语言</h1><h2 id=\"8-1-流程（Process）\"><a href=\"#8-1-流程（Process）\" class=\"headerlink\" title=\"8.1 流程（Process）\"></a>8.1 流程（Process）</h2><p>bpmn文件一个流程的根元素。一个流程就代表一个工作流。</p>\n<h2 id=\"8-2-顺序流（sequenceFlow）\"><a href=\"#8-2-顺序流（sequenceFlow）\" class=\"headerlink\" title=\"8.2 顺序流（sequenceFlow）\"></a>8.2 顺序流（sequenceFlow）</h2><p>顺序流是连接两个流程节点的连线，代表一个节点的出口。流程执行完一个节点后，会沿着节点的所有外出顺序流继续执行。 就是说，BPMN 2.0默认的行为就是并发的： 两个外出顺序流会创造两个单独的，并发流程分支。</p>\n<p>顺序流主要由4个属性组成：</p>\n<ul>\n<li>Id: 唯一标示，用来区分不同的顺序流</li>\n<li>sourceRef：连线的源头节点ID</li>\n<li>targetRef：连线的目标节点ID</li>\n<li>name（可选）：连线的名称，不涉及业务，主要用于显示</li>\n</ul>\n<h2 id=\"8-3-节点\"><a href=\"#8-3-节点\" class=\"headerlink\" title=\"8.3 节点\"></a>8.3 节点</h2><h3 id=\"8-3-1-开始事件节点-startEvent\"><a href=\"#8-3-1-开始事件节点-startEvent\" class=\"headerlink\" title=\"8.3.1 开始事件节点(startEvent)\"></a>8.3.1 开始事件节点(startEvent)</h3><p>开始事件用来指明流程在哪里开始。开始事件的类型（流程在接收事件时启动， 还是在指定时间启动，等等），定义了流程如何启动， 这通过事件中不同的小图表来展示。 在XML中，这些类型是通过声明不同的子元素来区分的。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/startEvent.png\" alt=\"此处输入图片的描述\"></p>\n<ol>\n<li><p>空开始事件<br>空开始事件技术上意味着没有指定启动流程实例的触发条件。最常用的一种开始，意味着流程的启动需要手动触发，通过调用api的startProcessInstanceByXXX方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">ProcessInstance processInstance = runtimeService.startProcessInstanceByXXX()</div></pre></td></tr></table></figure>\n<p>图形标记：空开始事件显示成一个圆圈，没有内部图表（没有触发类型）<br>XML结构如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">startEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"startevent\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Start\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">startEvent</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>定时开始事件</p>\n<p>定时开始事件用来在指定的时间创建流程实例。 它可以同时用于只启动一次的流程 和应该在特定时间间隔启动多次的流程。</p>\n<pre><code>注意：\n1.子流程不能使用定时开始事件。\n2.定时开始事件在流程发布后就会开始计算时间。不需要调用startProcessInstanceByXXX，虽然也而已调用启动流程的方法，但是那会导致调用startProcessInstanceByXXX时启动过多的流程。\n3.当包含定时开始事件的新版本流程部署时，对应的上一个定时器就会被删除。这是因为通常不希望自动启动旧版本流程的流程实例。\n</code></pre><p>图形标记：定时开始事件显示为一个圆圈，内部是一个表。<br>XML内容：定时开始事件的XML内容是普通开始事件的声明，包含一个定时定义子元素。<br>示例：流程会启动4次，每次间隔5分钟，从2013年9月18日，12:10开始计时。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">startEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theStart\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">timerEventDefinition</span>&gt;</span>                </div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">timeCycle</span>&gt;</span>R4/2017-11-22T11:04/PT5M<span class=\"tag\">&lt;/<span class=\"name\">timeCycle</span>&gt;</span>            \t\t </div><div class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">timerEventDefinition</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">startEvent</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>示例：流程会根据选中的时间启动一次。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">startEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theStart\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">timerEventDefinition</span>&gt;</span>                </div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">timeDate</span>&gt;</span>2017-12-31T23:59:59<span class=\"tag\">&lt;/<span class=\"name\">timeDate</span>&gt;</span>               \t\t </div><div class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">timerEventDefinition</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">startEvent</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"8-3-2-结束事件节点-endEvent\"><a href=\"#8-3-2-结束事件节点-endEvent\" class=\"headerlink\" title=\"8.3.2 结束事件节点(endEvent)\"></a>8.3.2 结束事件节点(endEvent)</h3><p>结束事件表示（子）流程（分支）的结束。结束事件都是触发事件。这是说当流程达结束事件，会触发一个结果。 结果的类型是通过事件的内部黑色图标表示的。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/endEvent.png\" alt=\"结束事件\"></p>\n<ol>\n<li><p>空结束事件</p>\n<p>空结束事件意味着到达事件时不会指定抛出的结果。这样，引擎会直接结束当前执行的分支，不会做其他事情。<br>图形标记:空结束事件是一个粗边圆圈，内部没有小图表（无结果类型）<br>XML内容:空结束事件的XML内容是普通结束事件定义，不包含子元素（其他结束事件类型都会包含声明类型的子元素）。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">endEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"end\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"my end event\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"8-3-3-任务节点-Task\"><a href=\"#8-3-3-任务节点-Task\" class=\"headerlink\" title=\"8.3.3 任务节点(Task)\"></a>8.3.3 任务节点(Task)</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/task.png\" alt=\"任务节点\"></p>\n<ol>\n<li><p>用户任务节点<br>用户任务用来设置必须由人员完成的工作。当流程执行到用户任务，会创建一个新任务，并把这个新任务加入到分配人或群组的任务列表中。<br>图形标记：用户任务显示成一个普通任务（圆角矩形），左上角有一个小用户图标。<br>XML内容：XML中的用户任务定义如下。id属性是必须的。 name属性是可选的。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theTask\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Important task\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>用户任务也可以设置描述(实际上所有BPMN 2.0元素都可以设置描述)。 添加documentation元素可以定义描述。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theTask\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Schedule meeting\"</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">documentation</span>&gt;</span></div><div class=\"line\">    Schedule an engineering meeting for next week with the new hire.  </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">documentation</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>在实际应用中，用户接到任务后可以参照任务描述来办理任务，描述文本可以通过标准的java方法来获得：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">task.getDescription()</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p><strong>私人任务</strong><br>    私有任务即有直接分配给指定用户的任务。只有一个用户可以成为任务的执行者。 在activiti中，用户叫做执行者。 拥有执行者的用户任务（即私有任务）对其他用户是不可见的。只能出现执行者的个人任务列表中.<br>    直接把用户任务分配给指定用户使用assignee属性，XML代码如下：<br>    <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theTask\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"my task\"</span> <span class=\"attr\">activiti:assignee</span>=<span class=\"string\">\"username\"</span>/&gt;</span></div></pre></td></tr></table></figure></p>\n<pre><code>Assignee属性对应的值为一个用户的ID。\n直接分配给用户的任务可以通过TaskService像下面这样办理：\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">    List&lt;Task&gt;tasks =taskService.createTaskQuery().taskAssignee(<span class=\"string\">\"sirius\"</span>).list();</div><div class=\"line\">Task task = tasks.get(<span class=\"number\">0</span>);<span class=\"comment\">// 假设任务集合的第一条是要办理的任务</span></div><div class=\"line\">taskService.complete(task.getId());</div></pre></td></tr></table></figure>\n</code></pre><p> <strong>公有任务</strong><br>    有的用户任务在指派时无法确定具体的办理者，这时任务也可以加入到    人员的候选任务列表中，然后让这些人员选择性认领和办理任务。</p>\n<pre><code>公有任务的分配可以分为指定候选用户和候选组两种。\n\n-  把任务添加到一批用户的候选任务列表中，使用candidateUsers    属    性，XML内容如下:\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTaskid=\"theTask\"name=\"my</span> <span class=\"attr\">task</span>\"<span class=\"attr\">activiti:candidateUsers</span>=<span class=\"string\">\"sirius,kermit\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n\ncandidateUsers属性内为用户的ID，多个用户ID之间使用（半角）逗号间隔。\n\n - 把任务添加到一个或多个候选组下，这时任务对组下的所有用户可见，首先得保证每个组下面有用户，通过IdentityService对象创建用户和组，然后把用户添加到对应的组下。然后配置组任务，使用candidateGroups属性，XML内容如下：\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theTask\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"my task\"</span> <span class=\"attr\">activiti:candidateGroups</span>=<span class=\"string\">\"testGroup，developGroup\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n\n间接分配给用户的任务，可以通过TaskService像下面这样操作：\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">List&lt;Task&gt;tasks =taskService.createTaskQuery()</div><div class=\"line\">.taskCandidateUser(<span class=\"string\">\"sirius\"</span>).list();</div><div class=\"line\">Task task = tasks.get(<span class=\"number\">0</span>);<span class=\"comment\">// 假设任务集合的第一条是要办理的任务</span></div><div class=\"line\">String taskId = task.getId();</div><div class=\"line\">taskService.claim(taskId ,“sirius”); <span class=\"comment\">//认领任务，让用户成为任务的执行者</span></div><div class=\"line\">taskService.complete(taskId );</div></pre></td></tr></table></figure>\n\n说明：\n\n 1. 要维护用户和组得使用用户管理服务对象，使用        processEngine    得到IdentityService。\n 2. 要分配组任务必须先创建组，而且组下得有用户，用户和组的    最关键属性是ID。\n 3. 使用newUser（userId）和newGroup（groupId）创建用户和组。\n 4. 使用createMembership（userId，groupId）把用户挂到组下。\n 5. 办理候选任务，首先得认领任务，让用户成为任务的执行者\n\n如果上面的方式还不够灵活，那么我们也可以自定义一个任务分配处理器，通过代码的方式来动态设置任务的属性。XML代码如下：\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"task1\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"My task\"</span>&gt;</span> </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">extensionElements</span>&gt;</span>    </div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">activiti:taskListener</span> <span class=\"attr\">event</span>=<span class=\"string\">\"create\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.MyAssignmentHandler\"</span>/&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">extensionElements</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">userTask</span>&gt;</span></div></pre></td></tr></table></figure>\n\nDelegateTask会传递给TaskListener的实现，通过它可以设置执行人，候选人和候选组：\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">Public <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyAssignmentHandler</span> <span class=\"keyword\">implements</span> <span class=\"title\">TaskListener</span> </span>&#123;</div><div class=\"line\">  </div><div class=\"line\">    <span class=\"function\">Public <span class=\"keyword\">void</span> <span class=\"title\">notify</span><span class=\"params\">(DelegateTask delegateTask)</span></span>&#123; </div><div class=\"line\">\t<span class=\"comment\">// 执行用户搜索相关代码    </span></div><div class=\"line\">\t...</div><div class=\"line\">\t<span class=\"comment\">// 然后把获取到的用户通过下面方法，设置给当前触发事件的任务</span></div><div class=\"line\">    \tdelegateTask.setAssignee(<span class=\"string\">\"sirius\"</span>);</div><div class=\"line\">    \t<span class=\"comment\">//delegateTask.addCandidateUser(\"kermit\");</span></div><div class=\"line\">   \t<span class=\"comment\">//delegateTask.addCandidateGroup(\"testGroup\"); </span></div><div class=\"line\">   \t...  </div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</code></pre><ol>\n<li><p>接收任务节点（receiveTask）</p>\n<p>接收任务是一个简单任务，它会等待对应消息的到达。当前，官方只实现了这个任务的java语义。 当流程达到接收任务，流程状态会保存到数据库中。在任务创建后，意味着流程会进入等待状态，直到引擎接收了一个特定的消息，这会触发流程穿过接收任务继续执行。</p>\n<p>图形标记：接收任务显示为一个任务（圆角矩形），右上角有一个消息小标记。 消息是白色的（黑色图标表示发送语义）。</p>\n<p>XML内容：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">receiveTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"waitState\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"wait\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>当前任务（一般指机器自动完成，但需要耗费一定时间的工作）完成后，向后推移流程，可以调用runtimeService.signal(executionId)，传递接收任务上流程的id。\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">ProcessInstance pi = runtimeService.startProcessInstanceByKey(<span class=\"string\">\"receiveTask\"</span>);</div><div class=\"line\">Execution execution = runtimeService.createExecutionQuery()</div><div class=\"line\">                        .processInstanceId(pi.getId())</div><div class=\"line\">                        .activityId(<span class=\"string\">\"waitState\"</span>)</div><div class=\"line\">                        .singleResult();</div><div class=\"line\">runtimeService.signal(execution.getId());</div></pre></td></tr></table></figure>\n</code></pre><hr>\n<p>述两个虽然都可以统称为任务节点，但是还是有本质区别：</p>\n<ol>\n<li>receiveTask主要代表机器自动执行的，userTask代表人工干预的。</li>\n<li>eiveTask任务产生后会在act_ru_execution表中新增一条记录，    而userTask产生后会在act_ru_execution和act_ru_task（主要记录任    务的发布时间，办理人等信息）中各产生一条记录。</li>\n<li>receiveTask任务提交方式使用RuntimeService的signal方法提交，    userTask任务提交方式使用TaskService的complete方法提交。</li>\n</ol>\n<h3 id=\"8-3-4-网关（gateWay）\"><a href=\"#8-3-4-网关（gateWay）\" class=\"headerlink\" title=\"8.3.4 网关（gateWay）\"></a>8.3.4 网关（gateWay）</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/gateWay.png\" alt=\"网关\"></p>\n<ol>\n<li><p>排他网关<br>排他网关（也叫异或（XOR）网关，或更技术性的叫法基于数据的排他网关），用来在流程中实现决策。</p>\n<p><strong>图形标记</strong>:排他网关显示成一个普通网关（比如，菱形图形）,内部是一个“X”图标,表示异或（XOR）语义。注意，没有内部图标的网关，默认为排他网关。BPMN2.0规范不允许在同一个流程定义中同时使用没有X和有X的菱形图形。</p>\n<p><strong>XML内容</strong>:排他网关的XML内容是很直接的：用一行定义了网关,条件表达式定义在外出顺序流中。参考条件顺序流 获得这些表达式的可用配置。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/xor.png\" alt=\"排他网关\"></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">exclusiveGatewayid=\"exclusiveGw\"name=\"Exclusive</span> <span class=\"attr\">Gateway</span>\"/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">id</span>=<span class=\"string\">\"flow2\"</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"exclusiveGw\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"theTask1\"</span>&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">conditionExpressionxsi:type=\"tFormalExpression\"</span>&gt;</span>$&#123;input == 1&#125;<span class=\"tag\">&lt;/<span class=\"name\">conditionExpression</span>&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">sequenceFlow</span>&gt;</span>\t</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">id</span>=<span class=\"string\">\"flow3\"</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"exclusiveGw\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"theTask2\"</span>&gt;</span>   </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">conditionExpressionxsi:type=\"tFormalExpression\"</span>&gt;</span>$&#123;input == 2&#125;<span class=\"tag\">&lt;/<span class=\"name\">conditionExpression</span>&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">sequenceFlow</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">id</span>=<span class=\"string\">\"flow4\"</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"exclusiveGw\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"theTask3\"</span>&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">conditionExpressionxsi:type=\"tFormalExpression\"</span>&gt;</span>$&#123;input == 3&#125;<span class=\"tag\">&lt;/<span class=\"name\">conditionExpression</span>&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">sequenceFlow</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>说明：\n1.一个排他网关对应一个以上的顺序流\n2.由排他网关流出的顺序流都有个conditionExpression元素，在内部维护返回boolean类型的决策结果。\n3.决策网关只会返回一条结果。当流程执行到排他网关时，流程引擎会自动检索网关出口，从上到下检索如果发现第一条决策结果为true或者没有设置条件的(默认为成立)，则流出。\n4.如果没有任何一个出口符合条件则抛出异常。\n</code></pre><ol>\n<li><p>并行网关</p>\n<p>网关也可以表示流程中的并行情况。最简单的并行网关是parallelGateWay，它允许将流程分成多条分支，也可以把多条分支汇聚到一起。</p>\n<p><strong>图形标记</strong>：并行网关显示成一个普通网关（菱形）内部是一个“加号”图标，表示“与（AND）”语义。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/parallelGateWay.png\" alt=\"并行网关\"></p>\n<p><strong>XML内容</strong>：定义并行网关只需要一行</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parallelGateway</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myParallelGateway\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>实际发生的行为（分支，聚合，同时分支聚合），要根据并行网关的顺序流来决定。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">startEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theStart\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">id</span>=<span class=\"string\">\"flow1\"</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"theStart\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"fork\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parallelGateway</span> <span class=\"attr\">id</span>=<span class=\"string\">\"fork\"</span>/&gt;</span> </div><div class=\"line\"> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"fork\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"receivePayment\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"fork\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"shipOrder\"</span>/&gt;</span></div><div class=\"line\">    </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTaskid=\"receivePayment\"name=\"Receive</span> <span class=\"attr\">Payment</span>\"/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"receivePayment\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"join\"</span>/&gt;</span></div><div class=\"line\">   </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTaskid=\"shipOrder\"name=\"Ship</span> <span class=\"attr\">Order</span>\"/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"shipOrder\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"join\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parallelGateway</span> <span class=\"attr\">id</span>=<span class=\"string\">\"join\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"join\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"archiveOrder\"</span>/&gt;</span></div><div class=\"line\"> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"archiveOrder\"</span><span class=\"attr\">name</span>=<span class=\"string\">\"Archive Order\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"archiveOrder\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"theEnd\"</span>/&gt;</span></div><div class=\"line\">         </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">endEventid=\"theEnd\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>上面例子中，流程启动之后，会创建两个任务：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">ProcessInstancepi =runtimeService.startProcessInstanceByKey(<span class=\"string\">\"forkJoin\"</span>);</div><div class=\"line\"></div><div class=\"line\">List&lt;Task&gt; tasks = taskService.createTaskQuery().list();</div><div class=\"line\">Task task1 =tasks.get(<span class=\"number\">0</span>);</div><div class=\"line\">System.out.println(<span class=\"string\">\"Receive Payment\"</span>+task1.getName());</div><div class=\"line\">Task task2 =tasks.get(<span class=\"number\">1</span>);</div><div class=\"line\">System.out.println(<span class=\"string\">\"Ship Order\"</span>+task2.getName());</div></pre></td></tr></table></figure>\n<p>当两个任务都完成时，第二个并行网关会汇聚两个分支，因为它只有一条外出连线，不会创建并行分支，只会创建归档订单任务。</p>\n<p>说明：<br>1.并行网关的功能是基于进入和外出的顺序流的：</p>\n<pre><code>分支(fork)：并行后的所有外出顺序流，为每个顺序流都创建一个并发分支。\n汇聚(join)：所有到达并行网关，在此等待的进入分支，直到所有进入顺序流的分支都到达以后， 流程就会通过汇聚网关。\n</code></pre><p>2.并行网关的进入和外出都是使用相同节点标示<br>3.如果同一个并行网关有多个进入和多个外出顺序流，它就同时具有分支和汇聚功能。这时，网关会先汇聚所有进入的顺序流，然后再切分成多个并行分支。<br>4.并行网关不会解析条件。 即使顺序流中定义了条件，也会被忽略。<br>5.并行网关不需要是“平衡的”（比如，对应并行网关的进入和外出节点数目相等）。如图中标示是合法的：<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/binxing.png\" alt=\"并行网关不需要是“平衡的”\"></p>\n</li>\n</ol>\n<h2 id=\"8-4-监听器（Listener）\"><a href=\"#8-4-监听器（Listener）\" class=\"headerlink\" title=\"8.4 监听器（Listener）\"></a>8.4 监听器（Listener）</h2><p>在流程中我们有时会对整个流程或者一个节点的某种状态做出相应的处理。这时就会用到监听器。</p>\n<p>在Activiti中流程的监听主要分为两大类，执行监听器和任务监听器。</p>\n<h3 id=\"8-4-1-执行监听器（ExecutionListener）\"><a href=\"#8-4-1-执行监听器（ExecutionListener）\" class=\"headerlink\" title=\"8.4.1 执行监听器（ExecutionListener）\"></a>8.4.1 执行监听器（ExecutionListener）</h3><p>执行监听器可以执行外部java代码或执行表达式，当流程定义中发生了某个事件。 可以捕获的事件有:</p>\n<ul>\n<li>流程实例的启动和结束。</li>\n<li>选中一条连线。</li>\n<li>节点的开始和结束。</li>\n<li>网关的开始和结束。</li>\n<li>中间事件的开始和结束。</li>\n<li>开始事件结束或结束事件开始。</li>\n</ul>\n<p>现在有这样一个简单流程，只包含开始、结束、接收任务和用户任务4个节点：<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/listenerExample.png\" alt=\"监听器流程示例\"><br>配置监听器,XML代码如下<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">extensionElements</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">activiti:executionListener</span> <span class=\"attr\">event</span>=<span class=\"string\">\"start\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"test.ProcessStartListener\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">activiti:executionListener</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">extensionElements</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>说明：</p>\n<ul>\n<li><p>任务监听器支持以下属性：</p>\n<ul>\n<li>event（必选）：任务监听器会被调用的任务类型<ul>\n<li>start：流程节点创建后触发</li>\n<li>end：当任务完成，并尚未从运行数据中删除时触发</li>\n<li>take：任务完成后，流程流出时触发</li>\n</ul>\n</li>\n<li>class(必选)：代理类，实现org.activiti.engine.delegate.ExecutionListener接口。<br>示例：<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProcessStartListener</span> <span class=\"keyword\">implements</span> <span class=\"title\">ExecutionListener</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">1L</span>;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">notify</span><span class=\"params\">(DelegateExecution execution)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ID:\"</span>+execution.getId()+<span class=\"string\">\", Name:\"</span>+execution.getCurrentActivityName());</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li><p>执行监听器配置可以放在以下三个地方，如图<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/taskListener.png\" alt=\"此处输入图片的描述\"></p>\n<p> a)    监听整个流程的启动和结束状态，配置为process节点的子元素，如①<br> b)    监听一个节点的启动和结束状态，配置为一个节点的子元素，如②和③<br> c)    监听一条连线的执行，配置在sequenceFlow节点的内部，只有task一种事件，如④</p>\n</li>\n</ul>\n<p>启动流程测试代码如下：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//部署流程</span></div><div class=\"line\">    Deployment deployment = repositoryService.createDeployment()</div><div class=\"line\">                .addClasspathResource(<span class=\"string\">\"diagrams/Listener.bpmn\"</span>)</div><div class=\"line\">                .addClasspathResource(<span class=\"string\">\"diagrams/Listener.png\"</span>)</div><div class=\"line\">                .deploy();</div><div class=\"line\">    <span class=\"comment\">//启动</span></div><div class=\"line\">    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(<span class=\"string\">\"ListenerTest\"</span>);</div><div class=\"line\">    <span class=\"comment\">//推动</span></div><div class=\"line\">    String processInstanceId = processInstance.getId();</div><div class=\"line\">    runtimeService.signal(processInstanceId);</div><div class=\"line\">    </div><div class=\"line\">    String id = taskService.createTaskQuery().processInstanceId(processInstanceId).singleResult().getId();</div><div class=\"line\">    taskService.complete(id);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>测试结果如下：</p>\n<pre><code>ID:60005, Name:开始\nID:60005, Name:接收任务\nID:60005, Name:用户任务\n</code></pre><h3 id=\"8-4-2-任务监听器（TaskListener）\"><a href=\"#8-4-2-任务监听器（TaskListener）\" class=\"headerlink\" title=\"8.4.2 任务监听器（TaskListener）\"></a>8.4.2 任务监听器（TaskListener）</h3><p>任务监听器可以在发生对应的任务相关事件时执行自定义java逻辑 或表达式。<br>任务监听器只能添加到流程定义中的用户任务中。在之前任务节点上添加任务监听:<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/taskListener2.png\" alt=\"此处输入图片的描述\"></p>\n<p>任务监听器支持以下属性</p>\n<ul>\n<li>event（必选）：任务监听器会被调用的任务类型。 可能的类型为：<ul>\n<li>create：任务创建并设置所有属性后触发。</li>\n<li>assignment：任务分配给一些人时触发。当流程到达userTask，assignment事件 会在create事件之前发生。这样的顺序似乎不自然，但是原因很简单：当获得create时间时， 我们想获得任务的所有属性，包括执行人。</li>\n<li>complete：当任务完成，并尚未从运行数据中删除时触发。</li>\n</ul>\n</li>\n<li>class：必须调用的代理类。 这个类必须实现org.activiti.engine.delegate.TaskListener    接口。</li>\n</ul>\n<hr>\n<p>新添加的任务监听包裹在executionListener监听的内部，顺序为：execution Start–&gt; task Assignment–&gt;task Create–&gt;task Complete–&gt;execution End–&gt;execution take。</p>\n<h1 id=\"9-Spring集成\"><a href=\"#9-Spring集成\" class=\"headerlink\" title=\"9 Spring集成\"></a>9 Spring集成</h1><p>虽然前面的例子中我们可以自己手动来创建相应的API实例，但是在一个项目中这些API都应该以<strong>单例形式</strong>存在的。和Spring的集成主要就是把Activiti的主要对象交给Spring容器管理。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 流程引擎 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.spring.ProcessEngineFactoryBean\"</span>&gt;</span> </div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"processEngineConfiguration\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"processEngineConfiguration\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">&lt;!-- 流程引擎配置对象 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"processEngineConfiguration\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.spring.SpringProcessEngineConfiguration\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"transactionManager\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"transactionManager\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- activiti表数据更新策略 false true（默认） create-drop--&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"databaseSchemaUpdate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- activiti历史数据保存策略 none activity audit(默认) full--&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"history\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"audit\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 管理线程计时器和异步消息,默认开启，但有ManagementService替代，避免冲突所以关闭 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jobExecutorActivate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"false\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 加载资源文件 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"deploymentResources\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"classpath:/activiti-process/*.bpmn\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">&lt;!-- 核心业务类 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"repositoryService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getRepositoryService\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"runtimeService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getRuntimeService\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"taskService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getTaskService\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"historyService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getHistoryService\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"managementService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getManagementService\"</span> /&gt;</span></div></pre></td></tr></table></figure>\n<p><strong>注意：</strong></p>\n<ol>\n<li>ProcessEngineConfiguration<br>单独使用和整合Spring时不是同一个class<br>独立使用：org.activiti.engine.ProcessEngineConfiguration<br>整合Spring：org.activiti.spring.SpringProcessEngineConfiguration</li>\n<li>项目部署后会自动在数据库中创建相关流程定义</li>\n</ol>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>工作流(Workflow)，就是“业务过程的部分或整体在计算机应用环境下的自动化”，它主要解决的是“使在多个参与者之间按照某种预定义的规则传递文档、信息或任务的过程自动进行，从而实现某个预期的业务目标，或者促使此目标的实现”。<br>","more":"</p>\n<h1 id=\"1-Activiti简介\"><a href=\"#1-Activiti简介\" class=\"headerlink\" title=\"1 Activiti简介\"></a>1 Activiti简介</h1><p>Activiti5是由Alfresco软件在2010年5月17日发布的业务流程管理（BPM）框架，它是覆盖了业务流程管理、工作流、服务协作等领域的一个开源的、灵活的、易扩展的可执行流程语言框架。Activiti基于Apache许可的开源BPM平台，创始人Tom Baeyens是JBoss jBPM的项目架构师，它特色是提供了eclipse插件，开发人员可以通过插件直接绘画出业务流程图。</p>\n<h2 id=\"1-1-工作流引擎\"><a href=\"#1-1-工作流引擎\" class=\"headerlink\" title=\"1.1 工作流引擎\"></a>1.1 工作流引擎</h2><p>这是Activiti的核心，负责生成流程运行时的各种实例及数据、监控和管理流程的运行。</p>\n<h2 id=\"1-2-BPMN2-0\"><a href=\"#1-2-BPMN2-0\" class=\"headerlink\" title=\"1.2 BPMN2.0\"></a>1.2 BPMN2.0</h2><p>业务流程建模与标注（Business Process Model and Notation，BPMN) ，描述流程的基本符号，包括这些图元如何组合成一个业务流程图（Business Process Diagram）</p>\n<h2 id=\"1-3-数据库\"><a href=\"#1-3-数据库\" class=\"headerlink\" title=\"1.3 数据库\"></a>1.3 数据库</h2><p>Activiti的后台是有数据库的支持，所有的表都以ACT_开头。第二部分是表示表的用途的两个字母标识。 用途也和服务的API对应。</p>\n<ol>\n<li><strong>ACT<em>RE</em>*</strong>: ‘RE’表示repository。 这个前缀的表包含了流程定义和流程静态资源 （图片，规则，等等）。</li>\n<li><strong>ACT<em>RU</em>*</strong>: ‘RU’表示runtime。 这些运行时的表，包含流程实例，任务，变量，异步任务，等运行中的数据。 Activiti只在流程实例执行过程中保存这些数据， 在流程结束时就会删除这些记录。 这样运行时表可以一直很小速度很快。</li>\n<li><strong>ACT<em>ID</em>*</strong>: ‘ID’表示identity。 这些表包含身份信息，比如用户，组等等。</li>\n<li><strong>ACT<em>HI</em>*</strong>: ‘HI’表示history。 这些表包含历史数据，比如历史流程实例， 变量，任务等等。</li>\n<li><strong>ACT<em>GE</em>*</strong>: 通用数据， 用于不同场景下。</li>\n</ol>\n<h3 id=\"1-3-1-资源库流程规则表\"><a href=\"#1-3-1-资源库流程规则表\" class=\"headerlink\" title=\"1.3.1 资源库流程规则表\"></a>1.3.1 资源库流程规则表</h3><ol>\n<li>act_re_deployment  部署信息表</li>\n<li>act_re_mode        流程设计模型部署表</li>\n<li>act_re_procdef     流程定义表</li>\n</ol>\n<h3 id=\"1-3-2-运行时数据库\"><a href=\"#1-3-2-运行时数据库\" class=\"headerlink\" title=\"1.3.2 运行时数据库\"></a>1.3.2 运行时数据库</h3><ol>\n<li>act_ru_execution    运行时流程执行实例表</li>\n<li>act_ru_identitylink 运行时流程人员表，主要存储任务节点与参与者的相关信息</li>\n<li>act_ru_task            运行时任务节点表</li>\n<li>act_ru_variable        运行时流程变量数据表</li>\n</ol>\n<h3 id=\"1-3-3-历史数据库表\"><a href=\"#1-3-3-历史数据库表\" class=\"headerlink\" title=\"1.3.3 历史数据库表\"></a>1.3.3 历史数据库表</h3><ol>\n<li>act_hi_actinst             历史节点表</li>\n<li>act_hi_attachment        历史附件表</li>\n<li>act_hi_comment            历史意见表</li>\n<li>act_hi_identitylink        历史流程人员表</li>\n<li>act_hi_detail            历史详情表，提供历史变量的查询</li>\n<li>act_hi_procinst            历史流程实例表</li>\n<li>act_hi_taskinst            历史任务实例表</li>\n<li>act_hi_varinst            历史变量表</li>\n</ol>\n<h3 id=\"1-3-4-组织机构表\"><a href=\"#1-3-4-组织机构表\" class=\"headerlink\" title=\"1.3.4 组织机构表\"></a>1.3.4 组织机构表</h3><ol>\n<li>act_id_group        用户组信息表</li>\n<li>act_id_info        用户扩展信息表</li>\n<li>act_id_membership    用户与用户组对应信息表</li>\n<li>act_id_user        用户信息表</li>\n</ol>\n<p>这四张表很常见，基本的组织机构管理，关于用户认证方面建议还是自己开发一套，组件自带的功能太简单，使用中有很多需求难以满足 。可以使shiro完成用户认证。</p>\n<h3 id=\"1-3-5-统用数据表\"><a href=\"#1-3-5-统用数据表\" class=\"headerlink\" title=\"1.3.5 统用数据表\"></a>1.3.5 统用数据表</h3><ol>\n<li>act_ge_bytearray        二进制数据表</li>\n<li>act_ge_property        属性数据表存储整个流程引擎级别的数据,初始化表结构时，会默认插入三条记录</li>\n</ol>\n<h2 id=\"1-4-activiti-cfg-xml\"><a href=\"#1-4-activiti-cfg-xml\" class=\"headerlink\" title=\"1.4 activiti.cfg.xml\"></a>1.4 activiti.cfg.xml</h2><p>Activiti核心配置文件，配置流程引擎创建工具的基本参数和数据库连接池参数。</p>\n<p>定义数据库配置参数：</p>\n<ul>\n<li>jdbcUrl: 数据库的JDBC URL。</li>\n<li>jdbcDriver: 对应不同数据库类型的驱动。</li>\n<li>jdbcUsername: 连接数据库的用户名。</li>\n<li>jdbcPassword: 连接数据库的密码。</li>\n</ul>\n<p>基于JDBC参数配置的数据库连接 会使用默认的MyBatis连接池。 下面的参数可以用来配置连接池（来自MyBatis参数）：</p>\n<ul>\n<li>jdbcMaxActiveConnections: 连接池中处于被使用状态的连接的最大值。默认为10。</li>\n<li>jdbcMaxIdleConnections: 连接池中处于空闲状态的连接的最大值。</li>\n<li>jdbcMaxCheckoutTime: 连接被取出使用的最长时间，超过时间会被强制回收。 默认为20000（20秒）。</li>\n<li>jdbcMaxWaitTime: 这是一个底层配置，让连接池可以在长时间无法获得连接时， 打印一条日志，并重新尝试获取一个连接。（避免因为错误配置导致沉默的操作失败）。 默认为20000（20秒）。</li>\n</ul>\n<p>示例如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">name</span>=<span class=\"string\">\"processEngineConfiguration\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcDriver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/activititest\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcUsername\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcPassword\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"123\"</span> /&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- </span></div><div class=\"line\">\tdatabaseSchemaUpdate：设置流程引擎启动和关闭时如何处理数据库表</div><div class=\"line\">\tfalse（默认）:检查数据库表的版本和依赖库的版本，如果不一致就抛出异常</div><div class=\"line\">\ttrue:构建流程引擎是执行检查，如果需要就更新，如果表不存在就创建</div><div class=\"line\">\tcreate-drop：构建流程引擎是创建表，关闭时删除表  </div><div class=\"line\">--&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"databaseSchemaUpdate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>关于c3p0、dbcp等数据库连接池配置请参看<a href=\"https://www.zybuluo.com/mdeditor#785927\" target=\"_blank\" rel=\"noopener\">spring(4)——持久层封装</a></p>\n<h2 id=\"1-5-logging-properties\"><a href=\"#1-5-logging-properties\" class=\"headerlink\" title=\"1.5 logging.properties\"></a>1.5 logging.properties</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">log4j.rootLogger=WARN, stdout</div><div class=\"line\">log4j.appender.stdout=org.apache.log4j.ConsoleAppender</div><div class=\"line\">log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</div><div class=\"line\">log4j.appender.stdout.layout.ConversionPattern=%d %p [%c] - %m%n</div></pre></td></tr></table></figure>\n<p>更详细log4j说明请参看<a href=\"http://blog.csdn.net/dr_guo/article/details/50718063\" target=\"_blank\" rel=\"noopener\">log4j.properties配置详解与实例</a></p>\n<h1 id=\"2-环境搭建\"><a href=\"#2-环境搭建\" class=\"headerlink\" title=\"2 环境搭建\"></a>2 环境搭建</h1><h2 id=\"2-1-需求java环境\"><a href=\"#2-1-需求java环境\" class=\"headerlink\" title=\"2.1 需求java环境\"></a>2.1 需求java环境</h2><ol>\n<li>JDK1.6或更高</li>\n<li>支持的数据库有：h2, mysql, oracle, postgres, mssql, db2等。</li>\n<li>支持activiti5运行的jar包</li>\n<li>开发环境为Eclipse3.7或者以上版本,myeclipse为8.6版本</li>\n</ol>\n<h2 id=\"2-2-资源下载\"><a href=\"#2-2-资源下载\" class=\"headerlink\" title=\"2.2 资源下载\"></a>2.2 资源下载</h2><p>activiti可以到<a href=\"http://activiti.org/download.htmlt/dr_guo/article/details/50718063\" target=\"_blank\" rel=\"noopener\">Activiti官方网站</a>下载得到。</p>\n<p>百度网盘下载地址，5.22.0和6.0.0两个版本，还有eclipse插件。<a href=\"http://pan.baidu.com/s/1qYmgdlE\" target=\"_blank\" rel=\"noopener\">百度网盘下载</a></p>\n<p>注意：安装插件后，在Windows-&gt;Preferences-&gt;Activiti-&gt;Save菜单下勾选保存时自动生成图片。</p>\n<h2 id=\"2-3-配置开发环境\"><a href=\"#2-3-配置开发环境\" class=\"headerlink\" title=\"2.3 配置开发环境\"></a>2.3 配置开发环境</h2><h3 id=\"2-3-1-添加jar包\"><a href=\"#2-3-1-添加jar包\" class=\"headerlink\" title=\"2.3.1 添加jar包\"></a>2.3.1 添加jar包</h3><p>在activiti-5.22.0→wars目录下是一些示例项目，解压activiti-rest项目，导入activiti-rest目录中WEB-INF\\lib下所有jar包到classpath中。<br>注意还需要数据库连接驱动包，如Mysql还需要添加<strong>mysql-connector-java.jar</strong>。</p>\n<h3 id=\"2-3-2-初始化数据库\"><a href=\"#2-3-2-初始化数据库\" class=\"headerlink\" title=\"2.3.2 初始化数据库\"></a>2.3.2 初始化数据库</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createTable</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//1、创建流程引擎配置对象</span></div><div class=\"line\">\tProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration.createStandaloneProcessEngineConfiguration();</div><div class=\"line\">\t<span class=\"comment\">//2、配置数据库</span></div><div class=\"line\">\tprocessEngineConfiguration.setJdbcDriver(<span class=\"string\">\"com.mysql.jdbc.Driver\"</span>);</div><div class=\"line\">\tprocessEngineConfiguration.setJdbcUrl(<span class=\"string\">\"jdbc:mysql://localhost:3306/activititest\"</span>);</div><div class=\"line\">\tprocessEngineConfiguration.setJdbcUsername(<span class=\"string\">\"root\"</span>);</div><div class=\"line\">\tprocessEngineConfiguration.setJdbcPassword(<span class=\"string\">\"123\"</span>);</div><div class=\"line\">\t<span class=\"comment\">//3、设置建表策略</span></div><div class=\"line\">\tprocessEngineConfiguration.setDatabaseSchemaUpdate(ProcessEngineConfiguration.DB_SCHEMA_UPDATE_TRUE);</div><div class=\"line\">\t<span class=\"comment\">//4、创建流程引擎对象</span></div><div class=\"line\">\tProcessEngine processEngine = processEngineConfiguration.buildProcessEngine();</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"processEngine\"</span>+processEngine);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>在Activiti中，在创建核心的流程引擎对象时会自动建表。如果程序正常执行，mysql会自动建库，然后创建23张表。</p>\n<h3 id=\"2-3-3-配置文件\"><a href=\"#2-3-3-配置文件\" class=\"headerlink\" title=\"2.3.3 配置文件\"></a>2.3.3 配置文件</h3><p>在Actiiti5中定制流程必定会操作到数据库，如果都像上面那样写一大段代码会非常麻烦，所以我们可以把数据库连接配置写入配置文件。</p>\n<p>在Activiti5的官方示例中并没有现成的配置文件，所以先得找到activiti-rest\\WEB-INF\\classes下有：<strong>activiti-context.xml</strong>：一个类似spring结构的配置文件，清空内容后改名为activiti.cfg.xml，用来做流程引擎的相关配置。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">name</span>=<span class=\"string\">\"processEngineConfiguration\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcDriver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/activititest\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcUsername\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"JdbcPassword\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"123\"</span> /&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- </span></div><div class=\"line\">\tdatabaseSchemaUpdate：设置流程引擎启动和关闭时如何处理数据库表</div><div class=\"line\">\tfalse（默认）:检查数据库表的版本和依赖库的版本，如果不一致就抛出异常</div><div class=\"line\">\ttrue:构建流程引擎是执行检查，如果需要就更新，如果表不存在就创建</div><div class=\"line\">\tcreate-drop：构建流程引擎是创建表，关闭时删除表  </div><div class=\"line\">--&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"databaseSchemaUpdate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>Java代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createTable2</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tProcessEngineConfiguration processEngineConfiguration = ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class=\"string\">\"activiti.cfg.xml\"</span>);</div><div class=\"line\">\tProcessEngine processEngine = processEngineConfiguration.buildProcessEngine();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h1 id=\"3-核心API\"><a href=\"#3-核心API\" class=\"headerlink\" title=\"3 核心API\"></a>3 核心API</h1><h2 id=\"3-1-ProcessEngine\"><a href=\"#3-1-ProcessEngine\" class=\"headerlink\" title=\"3.1 ProcessEngine\"></a>3.1 ProcessEngine</h2><ol>\n<li>在Activiti中最核心的类，其他的类都是由它而来。</li>\n<li><p>产生方式<br>2.1 方式一：最基础版本，见2.3.2小节<br>2.2 方式二：配置文件+java代码，见2.3.3小节</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createTable3</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>这种方式更加简单，会自动加载classpath下名为activiti.cfg.xml的文件。</p>\n</li>\n<li><p>产生各种service</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//流程仓库业务类，管理流程定义、部署</span></div><div class=\"line\">RepositoryService repositoryService = processEngine.getRepositoryService();</div><div class=\"line\"><span class=\"comment\">//流程运行业务类，管理流程启动、推进、删除等操作</span></div><div class=\"line\">RuntimeService runtimeService = processEngine.getRuntimeService();</div><div class=\"line\"><span class=\"comment\">//流程任务类，管理具体的任务</span></div><div class=\"line\">TaskService taskService = processEngine.getTaskService();</div><div class=\"line\"><span class=\"comment\">//流程历史数据类</span></div><div class=\"line\">HistoryService historyService = processEngine.getHistoryService();</div><div class=\"line\"><span class=\"comment\">//流程用户业务类</span></div><div class=\"line\">IdentityService identityService = processEngine.getIdentityService();</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"3-2-ReposityService\"><a href=\"#3-2-ReposityService\" class=\"headerlink\" title=\"3.2 ReposityService\"></a>3.2 ReposityService</h2><p>流程仓库业务类，仓库简单理解即流程定义文档的两个文件：bpmn文件和流程图片</p>\n<ol>\n<li><p>产生流程部署配置对象，用来定义流程部署的相关参数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">@Test</div><div class=\"line\">public void Demo1() &#123;</div><div class=\"line\">\tDeploymentBuilder deploymentBuilder = processEngine.getRepositoryService().createDeployment().name(&quot;test&quot;);</div><div class=\"line\">\tdeploymentBuilder.addClasspathResource(&quot;diagrams/HelloWord.bpmn&quot;);</div><div class=\"line\">\tdeploymentBuilder.addClasspathResource(&quot;diagrams/HelloWord.png&quot;);</div><div class=\"line\">\t</div><div class=\"line\">\tDeployment deployment = deploymentBuilder.deploy();</div><div class=\"line\">\tSystem.out.println(deployment.getId() + &quot;。。。。&quot;+ deployment.getName());</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>删除流程定义</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">repositoryService.deleteDeployment(deploymentId);</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"3-3-RuntimeService\"><a href=\"#3-3-RuntimeService\" class=\"headerlink\" title=\"3.3 RuntimeService\"></a>3.3 RuntimeService</h2><p>流程执行服务类。可以从这个类中获取很多关于流程执行相关的信息。</p>\n<ol>\n<li><p>启动流程</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//常用的启动流程实例的两种方法</span></div><div class=\"line\">ProcessInstance processInstance = runtimeService.startProcessInstanceById(processInstanceId);</div><div class=\"line\">ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(processInstanceKey);</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"3-4-TaskService\"><a href=\"#3-4-TaskService\" class=\"headerlink\" title=\"3.4 TaskService\"></a>3.4 TaskService</h2><p>activiti的任务服务类。可以从这个类中获取任务的信息。</p>\n<h2 id=\"3-5-ProcessDefinition\"><a href=\"#3-5-ProcessDefinition\" class=\"headerlink\" title=\"3.5 ProcessDefinition\"></a>3.5 ProcessDefinition</h2><p>流程定义类。可以从这里获得资源文件等。<br>每个流程文件唯一对应一个相同key的流程定义，只是流程定义的version不同</p>\n<h2 id=\"3-6-ProcessInstance\"><a href=\"#3-6-ProcessInstance\" class=\"headerlink\" title=\"3.6 ProcessInstance\"></a>3.6 ProcessInstance</h2><p>流程实例。根据流程定义实例化的具体流程，我们可以利用这个对象来了解当前流程实例的进度等信息。<br>如：<br>    公司有一个所有人通用的请假流程，这个叫做流程定义。<br>    小明今天请假，填写请假单，就是创建了一个流程实例。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/** Represents one execution of a  &#123;<span class=\"doctag\">@link</span> ProcessDefinition&#125;.</span></div><div class=\"line\"> 1. </div><div class=\"line\"> 2. <span class=\"doctag\">@author</span> Tom Baeyens</div><div class=\"line\"> 3. <span class=\"doctag\">@author</span> Joram Barrez</div><div class=\"line\"> 4. <span class=\"doctag\">@author</span> Daniel Meyer</div><div class=\"line\"> 5. <span class=\"doctag\">@author</span> Tijs Rademakers</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ProcessInstance</span> <span class=\"keyword\">extends</span> <span class=\"title\">Execution</span> </span>&#123;</div></pre></td></tr></table></figure>\n<p>从上面可以看出ProcessInstance就是Execution，但实际有点区别</p>\n<ol>\n<li>单线流程中，ProcessInstance与Execution是一致的，ID都一样</li>\n<li>多线 流程中，总线路代表ProcessInstance，而分线路中每个活动代表Execution。</li>\n</ol>\n<h2 id=\"3-7-Execution\"><a href=\"#3-7-Execution\" class=\"headerlink\" title=\"3.7 Execution\"></a>3.7 Execution</h2><p>Activiti用这个对象去描述流程执行的每一个节点。在没有并发的情况下，同ProcessInstance。</p>\n<h1 id=\"4-流程定义\"><a href=\"#4-流程定义\" class=\"headerlink\" title=\"4 流程定义\"></a>4 流程定义</h1><h2 id=\"4-1-创建流程文件\"><a href=\"#4-1-创建流程文件\" class=\"headerlink\" title=\"4.1 创建流程文件\"></a>4.1 创建流程文件</h2><p>在classpath下创建流程文件<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/create.png\" alt=\"创建\"><br>编辑流程文件<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/example.png\" alt=\"编辑\"></p>\n<h2 id=\"4-2-部署流程定义\"><a href=\"#4-2-部署流程定义\" class=\"headerlink\" title=\"4.2 部署流程定义\"></a>4.2 部署流程定义</h2><p>部署流程定义可以看成是添加流程定义<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">deploy</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//创建流程引擎</span></div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    <span class=\"comment\">//创建流程部署对象</span></div><div class=\"line\">    DeploymentBuilder deploymentBuilder = processEngine.getRepositoryService().createDeployment();</div><div class=\"line\">    <span class=\"comment\">//读取文件部署流程</span></div><div class=\"line\">    Deployment deploy = deploymentBuilder.name(<span class=\"string\">\"测试\"</span>)</div><div class=\"line\">                            .addClasspathResource(<span class=\"string\">\"diagrams/HelloWord.bpmn\"</span>)</div><div class=\"line\">                            .addClasspathResource(<span class=\"string\">\"diagrams/HelloWord.png\"</span>)</div><div class=\"line\">                            .deploy();</div><div class=\"line\">    </div><div class=\"line\">    System.out.println(deploy.getId() + <span class=\"string\">\"。。。\"</span> + deploy.getName());</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p><strong>部署流程会改变3张表</strong></p>\n<ul>\n<li>act_re_deployment<br> 存放流程定义的显示名和部署时间，每部署一次增加一条记录</li>\n<li>act_re_procdef<br> 存放流程定义的属性信息，部署每个新的流程定义都会在这张表中增加一条记录。</li>\n<li>act_ge_bytearray<br> 存储流程定义相关的部署信息。即流程定义文档的存放地。每部署一次就会增加两条记录，一条是关于bpmn规则文件的，一条是图片的（如果部署时只指定了bpmn一个文件，activiti会在部署时解析bpmn文件内容自动生成流程图）。两个文件不是很大，都是以二进制形式存储在数据库中。</li>\n</ul>\n<h2 id=\"4-3-查看流程定义\"><a href=\"#4-3-查看流程定义\" class=\"headerlink\" title=\"4.3 查看流程定义\"></a>4.3 查看流程定义</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">view</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();</div><div class=\"line\">    List&lt;ProcessDefinition&gt; list = repositoryService.createProcessDefinitionQuery()</div><div class=\"line\">                                        <span class=\"comment\">//过滤条件</span></div><div class=\"line\">                                        .processDefinitionKey(<span class=\"string\">\"HelloWorld\"</span>)</div><div class=\"line\">                                        <span class=\"comment\">//.processDefinitionId(processDefinitionId)</span></div><div class=\"line\">                                        <span class=\"comment\">//分页</span></div><div class=\"line\">                                        <span class=\"comment\">//.listPage(firstResult, maxResults)</span></div><div class=\"line\">                                        <span class=\"comment\">//排序</span></div><div class=\"line\">                                        <span class=\"comment\">//.orderByProcessDefinitionVersion()</span></div><div class=\"line\">                                        <span class=\"comment\">//执行查询</span></div><div class=\"line\">                                        .list();</div><div class=\"line\">    <span class=\"keyword\">for</span> (ProcessDefinition processDefinition : list) &#123;</div><div class=\"line\">        System.out.print(<span class=\"string\">\"id:\"</span> + processDefinition.getId() + <span class=\"string\">\",\"</span>);<span class=\"comment\">//流程Id</span></div><div class=\"line\">        System.out.print(<span class=\"string\">\"key:\"</span> + processDefinition.getKey() + <span class=\"string\">\",\"</span>);<span class=\"comment\">//流程Key</span></div><div class=\"line\">        System.out.print(<span class=\"string\">\"name:\"</span> + processDefinition.getName() + <span class=\"string\">\",\"</span>);<span class=\"comment\">//流程名字</span></div><div class=\"line\">        System.out.print(<span class=\"string\">\"version:\"</span> + processDefinition.getVersion() + <span class=\"string\">\",\"</span>);<span class=\"comment\">//流程版本</span></div><div class=\"line\">        System.out.println(<span class=\"string\">\"deploymentId():\"</span> + processDefinition.getDeploymentId());<span class=\"comment\">//流程部署对象Id</span></div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>查询结果</p>\n<pre><code>id:HelloWorld:1:35004,key:HelloWorld,name:请假审批流程,version:1,deploymentId():35001\n</code></pre><p>再部署一次，再查询</p>\n<pre><code>id:HelloWorld:1:35004,key:HelloWorld,name:请假审批流程,version:1,deploymentId():35001\nid:HelloWorld:2:37504,key:HelloWorld,name:请假审批流程,version:2,deploymentId():37501\n</code></pre><p>说明：</p>\n<ol>\n<li>因为流程定义的信息在仓库中，实际在act<em>re</em>*表中，所以创建RepositoryService</li>\n<li>创建查询对象<strong>ProcessDefinitionQuery</strong>，设置查询参数，调用list()执行查询</li>\n<li><p>由查询结果可知：<br>3.1 流程定义的key和name与流程文件的id和name一致</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">process</span> <span class=\"attr\">id</span>=<span class=\"string\">\"HelloWorld\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"请假审批流程\"</span> <span class=\"attr\">isExecutable</span>=<span class=\"string\">\"true\"</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>3.2 key属性被用来区别不同的流程定义。<br>3.3 带有特定key的流程定义第一次部署时，version为1。之后每次部署都会在当前最高版本号上加1<br>3.4 Id的生成规则为：<strong>{processDefinitionKey}:{processDefinitionVersion}:{generated-id}</strong>，这里的generated-id是一个自动生成的唯一的数字<br>3.5 重复部署一次，deploymentId的值以一定的形式变化</p>\n</li>\n</ol>\n<h2 id=\"4-4-删除流程定义\"><a href=\"#4-4-删除流程定义\" class=\"headerlink\" title=\"4.4 删除流程定义\"></a>4.4 删除流程定义</h2><p>删除部署到activiti中的流程定义。如:删除请假流程定义，则大家再也不能请假了。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">delete</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();</div><div class=\"line\">    String deploymentId = <span class=\"string\">\"7501\"</span>;</div><div class=\"line\">    <span class=\"comment\">//如果有关联信息，会报错</span></div><div class=\"line\">    <span class=\"comment\">//repositoryService.deleteDeployment(deploymentId);</span></div><div class=\"line\">    <span class=\"comment\">//如果有关联信息，会级联删除</span></div><div class=\"line\">    repositoryService.deleteDeployment(deploymentId, <span class=\"keyword\">true</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"4-5-获取流程定义文档资源\"><a href=\"#4-5-获取流程定义文档资源\" class=\"headerlink\" title=\"4.5 获取流程定义文档资源\"></a>4.5 获取流程定义文档资源</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getResource</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</div><div class=\"line\">    RepositoryService repositoryService = ProcessEngines.getDefaultProcessEngine().getRepositoryService();</div><div class=\"line\">   </div><div class=\"line\">    String deploymentId = <span class=\"string\">\"35001\"</span>;</div><div class=\"line\">    String resourceName = <span class=\"keyword\">null</span>;</div><div class=\"line\">    <span class=\"comment\">//资源文件名,即act_re_bytearray表中的name</span></div><div class=\"line\">    List&lt;String&gt; names = repositoryService.getDeploymentResourceNames(deploymentId);</div><div class=\"line\">    <span class=\"keyword\">for</span> (String str : names) &#123;</div><div class=\"line\">        <span class=\"comment\">//过滤出特定的图片文件</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (str.indexOf(<span class=\"string\">\"HelloWorld.png\"</span>) != -<span class=\"number\">1</span>) &#123;</div><div class=\"line\">            resourceName = str;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    System.out.println(resourceName);</div><div class=\"line\">    <span class=\"keyword\">if</span> (resourceName != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">        <span class=\"comment\">//通过部署ID和文件名获得输入流</span></div><div class=\"line\">        InputStream inputStream = repositoryService.getResourceAsStream(deploymentId, resourceName);</div><div class=\"line\">        File file = <span class=\"keyword\">new</span> File(<span class=\"string\">\"D:/\"</span>+ resourceName);</div><div class=\"line\">        FileUtils.copyInputStreamToFile(inputStream, file);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h1 id=\"5-流程实例\"><a href=\"#5-流程实例\" class=\"headerlink\" title=\"5 流程实例\"></a>5 流程实例</h1><h2 id=\"5-1-启动流程实例\"><a href=\"#5-1-启动流程实例\" class=\"headerlink\" title=\"5.1 启动流程实例\"></a>5.1 启动流程实例</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">startProcess</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    RuntimeService runtimeService = ProcessEngines.getDefaultProcessEngine().getRuntimeService();</div><div class=\"line\">    <span class=\"comment\">//根据流程Id启动流程</span></div><div class=\"line\">    <span class=\"comment\">//ProcessInstance processInstance = runtimeService.startProcessInstanceById(processDefinitionId);</span></div><div class=\"line\">    <span class=\"comment\">//根据流程key启动流程，会自动找到版本最高的流程定义来创建</span></div><div class=\"line\">    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(<span class=\"string\">\"HelloWorld\"</span>);</div><div class=\"line\">    System.out.println(processInstance.getId());<span class=\"comment\">//流程实例Id</span></div><div class=\"line\">    System.out.println(processInstance.getActivityId());<span class=\"comment\">//流程当前节点Id</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<pre><code>启动流程实例有很多重载方法，根据实际需要选用。\n</code></pre><h2 id=\"5-2-查询任务\"><a href=\"#5-2-查询任务\" class=\"headerlink\" title=\"5.2 查询任务\"></a>5.2 查询任务</h2><p>在Activiti中，任务主要分为两类：</p>\n<ol>\n<li>确切指定了办理者的任务，之歌任务称为制定者的私人任务</li>\n<li>2.无法指定具体的某一个人来办理的任务，可以把任务分配给几个人或者一到    多个小组，让这个范围内的用户可以选择性（如有空余时间时）来办理这类任务。</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">taskQuery</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    TaskService taskService = ProcessEngines.getDefaultProcessEngine().getTaskService();</div><div class=\"line\">    List&lt;Task&gt; list = taskService.createTaskQuery()</div><div class=\"line\">            <span class=\"comment\">//查询指定用户的私人任务</span></div><div class=\"line\">            <span class=\"comment\">//.taskAssignee(\"指定用户\")</span></div><div class=\"line\">            <span class=\"comment\">//查询某人可接的共有任务</span></div><div class=\"line\">            <span class=\"comment\">//.taskCandidateUser(\"候选用户\")</span></div><div class=\"line\">            <span class=\"comment\">//排序</span></div><div class=\"line\">            .orderByTaskCreateTime().desc()</div><div class=\"line\">            <span class=\"comment\">//执行查询</span></div><div class=\"line\">            .list();</div><div class=\"line\">    <span class=\"keyword\">for</span> (Task task : list) &#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"id:\"</span> + task.getId());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"name:\"</span> + task.getName());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"assignee:\"</span> + task.getAssignee());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"createTime:\"</span> + task.getCreateTime());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ProcessInstanceId:\"</span> + task.getProcessInstanceId());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ProcessDefinitionId:\"</span> + task.getProcessDefinitionId());</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"5-3-认领任务\"><a href=\"#5-3-认领任务\" class=\"headerlink\" title=\"5.3 认领任务\"></a>5.3 认领任务</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">taskService.claim(taskId, userId);</div></pre></td></tr></table></figure>\n<p>将任务变为用户的私人任务</p>\n<h2 id=\"5-4-办理任务\"><a href=\"#5-4-办理任务\" class=\"headerlink\" title=\"5.4 办理任务\"></a>5.4 办理任务</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//根据任务Id办理任务</span></div><div class=\"line\">taskService.complete(taskId);</div><div class=\"line\"><span class=\"comment\">//根据任务Id办理任务,并设置任务变量</span></div><div class=\"line\">taskService.complete(taskId, variables);</div></pre></td></tr></table></figure>\n<p>variables是Map，当设置变量时，会在act_ru_variables表中添加相应条数的数据，变量可以用来执行gateway的判断，后面会讲到gateway。</p>\n<h2 id=\"5-5-判断流程是否结束\"><a href=\"#5-5-判断流程是否结束\" class=\"headerlink\" title=\"5.5 判断流程是否结束\"></a>5.5 判断流程是否结束</h2><p>在流程执行过程中，创建的流程实例ID在整个过程都不会变，当流程结束后，流程实例将被删除。</p>\n<ol>\n<li>从运行库中查询该流程是否还存在</li>\n<li>从历史库中查询该流程是否存在</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">checkStatus</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    String processInstanceId = <span class=\"string\">\"1213\"</span>;</div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    RuntimeService runtimeService = processEngine.getRuntimeService();</div><div class=\"line\">    <span class=\"comment\">//从运行库查询该流程实例是否存在</span></div><div class=\"line\">    ProcessInstance instance = runtimeService.createProcessInstanceQuery()</div><div class=\"line\">                                    .processInstanceId(processInstanceId)</div><div class=\"line\">                                    .singleResult();</div><div class=\"line\">    <span class=\"comment\">//实例不存在，可能未开始或者已结束</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (instance == <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">        <span class=\"comment\">//从历史库查</span></div><div class=\"line\">        HistoryService historyService = processEngine.getHistoryService();</div><div class=\"line\">        HistoricProcessInstance singleResult = historyService.createHistoricProcessInstanceQuery()</div><div class=\"line\">                                                .processInstanceId(processInstanceId)</div><div class=\"line\">                                                .singleResult();</div><div class=\"line\">        <span class=\"keyword\">if</span> (singleResult != <span class=\"keyword\">null</span> &amp;&amp; singleResult.getEndTime() != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">            <span class=\"comment\">//流程已结束</span></div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">\"COMPLETE\"</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            <span class=\"comment\">//流程未开始</span></div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">\"NOT_START\"</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> instance.getActivityId();<span class=\"comment\">//当前任务节点</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h1 id=\"6-流程历史\"><a href=\"#6-流程历史\" class=\"headerlink\" title=\"6 流程历史\"></a>6 流程历史</h1><p>在前一个的例子中，大家可能会流程执行完毕后，究竟去了哪里有些疑问。虽然已完成的任务在act_ru_task和act_ru_execution表中都已被删除，但是这些数据还存在activiti的数据库中，作为历史改由HistoryService来管理。</p>\n<p>历史是一个组件，它可以捕获发生在进程执行中的信息并永久的保存，与运行时数据不同的是，当流程实例运行完成之后它还会存在于数据库中。</p>\n<p>在流程引擎配置对象中可以设置历史记录规则：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">name</span>=<span class=\"string\">\"processEngineConfiguration\"</span> </span></div><div class=\"line\">  \t  <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"databaseSchemaUpdate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!--</span></div><div class=\"line\">\t\tActiviti提供了四种历史级别：</div><div class=\"line\">\t\tnone:不保存任何历史，可以提高性能</div><div class=\"line\">\t\tactiviti:保存所有流程实例、任务、活动信息</div><div class=\"line\">\t\taudit:默认级别,保存所有流程实例、任务、活动、表单</div><div class=\"line\">\t\tfull:保存所有信息,如流程变量</div><div class=\"line\">\t  --&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"history\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"activiti\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>由于数据库中保存着历史信息以及正在运行的流程实例信息，在实际项目中对已完成任务的查看频率远不及对代办和可接任务的查看，所以在activiti采用分开管理，把正在运行的交给runtimeService管理，而历史数据交给HistoryService来管理。</p>\n<p>对已成为历史的数据主要进行查询操作，我们主要关心两种类型的历史数据：</p>\n<ul>\n<li><strong>HistoricProcessInstance</strong> 包含当前和已经结束的流程实例信息。</li>\n<li><strong>HistoricActivityInstance</strong> 包含一个活动(流程上的节点)的执行信息。</li>\n</ul>\n<h2 id=\"6-1-查看历史流程实例\"><a href=\"#6-1-查看历史流程实例\" class=\"headerlink\" title=\"6.1 查看历史流程实例\"></a>6.1 查看历史流程实例</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">queryHisInstance</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//流程引擎</span></div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    <span class=\"comment\">//流程定义ID</span></div><div class=\"line\">    String processDefinitionId = <span class=\"string\">\"HelloWorld:2:37504\"</span>;</div><div class=\"line\">    <span class=\"comment\">//查询历史流程实例</span></div><div class=\"line\">    List&lt;HistoricProcessInstance&gt; list = processEngine.getHistoryService().createHistoricProcessInstanceQuery()</div><div class=\"line\">                                        .processDefinitionId(processDefinitionId)</div><div class=\"line\">                                        .finished()</div><div class=\"line\">                                        .orderByProcessInstanceStartTime().desc()</div><div class=\"line\">                                        .list();</div><div class=\"line\">    <span class=\"keyword\">for</span> (HistoricProcessInstance hp : list) &#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ID：\"</span>+hp.getId());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"startTime：\"</span>+hp.getStartTime());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"endTime：\"</span>+hp.getEndTime());</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>1.通常查询历史流程实例都需要指定一个过滤条件，指定    processDefinitionId查看具体某一次部署所开启的流程或者指定    processDefinitionKey查看某个规则下不限版本的所有流程</p>\n<p>2.可以选择性添加finished方法控制是否查询未完成的流程实例。在流    程开启时，activiti同时在act_ru_execution表和act_hi_procinst表中    创建了一条记录，在流程完成之前act_hi_procinst表中实例的结束时间为空</p>\n<h2 id=\"6-2-查看历史流程活动（节点）\"><a href=\"#6-2-查看历史流程活动（节点）\" class=\"headerlink\" title=\"6.2 查看历史流程活动（节点）\"></a>6.2 查看历史流程活动（节点）</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">queryHisActiviti</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//流程引擎</span></div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    <span class=\"comment\">//流程实例ID</span></div><div class=\"line\">    String processInstanceId = <span class=\"string\">\"HelloWorld:2:37504\"</span>;</div><div class=\"line\">    <span class=\"comment\">//查询历史流程活动</span></div><div class=\"line\">    List&lt;HistoricActivityInstance&gt; list = processEngine.getHistoryService()</div><div class=\"line\">                                        <span class=\"comment\">//创建历史流程活动实例查询对象</span></div><div class=\"line\">                                        .createHistoricActivityInstanceQuery()</div><div class=\"line\">                                        <span class=\"comment\">//过滤条件</span></div><div class=\"line\">                                        .processInstanceId(processInstanceId)</div><div class=\"line\">                                        <span class=\"comment\">//排序</span></div><div class=\"line\">                                        .orderByHistoricActivityInstanceStartTime().desc()</div><div class=\"line\">                                        <span class=\"comment\">//执行查询</span></div><div class=\"line\">                                        .list();</div><div class=\"line\">    <span class=\"keyword\">for</span> (HistoricActivityInstance ha : list) &#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ID：\"</span>+ha.getActivityId());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"name:\"</span>+ha.getActivityName());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"startTime：\"</span>+ha.getStartTime());</div><div class=\"line\">        System.out.println(<span class=\"string\">\"endTime：\"</span>+ha.getEndTime());</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>通常查询历史流程活动都需要指定一个过滤条件，指定processInstanceId查看具体某一次流程执行过程中所经历的步奏</p>\n<h1 id=\"7-流程变量\"><a href=\"#7-流程变量\" class=\"headerlink\" title=\"7 流程变量\"></a>7 流程变量</h1><p>流程变量在整个工作流中扮演很重要的作用。例如：请假流程中有请假天数、请假原因等一些参数都为流程变量的范围。<br>流程变量的作用域范围是流程实例。也就是说各个流程实例的流程变量是不相互影响的。<br>流程实例结束完成以后流程变量是否保存在数据库中取决于存储策略，见第六章。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/variable.png\" alt=\"流程变量\"></p>\n<h2 id=\"7-1-添加流程变量\"><a href=\"#7-1-添加流程变量\" class=\"headerlink\" title=\"7.1 添加流程变量\"></a>7.1 添加流程变量</h2><ol>\n<li><p>启动流程实例时添加</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addVariables</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</div><div class=\"line\">    RuntimeService runtimeService = processEngine.getRuntimeService();</div><div class=\"line\">    </div><div class=\"line\">    String processDefinitionKey = <span class=\"string\">\"HelloWorld\"</span>;</div><div class=\"line\">    Map&lt;String,Object&gt; variables = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</div><div class=\"line\">    variables.put(<span class=\"string\">\"请假天数\"</span>, <span class=\"number\">3</span>);</div><div class=\"line\">    variables.put(<span class=\"string\">\"请假原因\"</span>, <span class=\"string\">\"约会\"</span>);</div><div class=\"line\">    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(processDefinitionKey, variables);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>说明：</p>\n<pre><code>1)    在启动流程实例时，通过重载startProcessInstanceByKey的方法可以加载流程变量。\n2)    第二个参数要求是Map&lt;String ,Object&gt;类型，意味着可以添加多个流程变量。\n3)    当这段代码执行完以后，会在数据库表act_ru_variable中添加两行记录。\n</code></pre></li>\n</ol>\n<ol>\n<li>完成任务时添加<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//办理过程中</span></div><div class=\"line\">taskService.setVariables(taskId, variables);</div><div class=\"line\"><span class=\"comment\">//提交时</span></div><div class=\"line\">taskService.complete(taskId, variables);</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li>执行流程实例时添加<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//执行流程实例时</span></div><div class=\"line\">runtimeService.setVariables(executionId, variables);</div><div class=\"line\"><span class=\"comment\">//流程实例提交时</span></div><div class=\"line\">runtimeService.signal(executionId, processVariables);<span class=\"comment\">//signal用于接受任务</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"7-2-获取流程变量\"><a href=\"#7-2-获取流程变量\" class=\"headerlink\" title=\"7.2 获取流程变量\"></a>7.2 获取流程变量</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//某个流程的变量</span></div><div class=\"line\">runtimeService.getVariables(executionId);</div><div class=\"line\"><span class=\"comment\">//某个任务的变量</span></div><div class=\"line\">taskService.getVariables(taskId);</div></pre></td></tr></table></figure>\n<p>说明：这些流程变量是从act_ru_variable这个表中读出来的。</p>\n<h2 id=\"7-3-流程变量范围\"><a href=\"#7-3-流程变量范围\" class=\"headerlink\" title=\"7.3 流程变量范围\"></a>7.3 流程变量范围</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/baseVar.png\" alt=\"此处输入图片的描述\"></p>\n<p>从图中可以看出包括了大部分封装类型和Date、String和实现了Serializable接口的类的类型。</p>\n<h2 id=\"7-4-Javabean类型变量\"><a href=\"#7-4-Javabean类型变量\" class=\"headerlink\" title=\"7.4 Javabean类型变量\"></a>7.4 Javabean类型变量</h2><ol>\n<li>定义一个javabean，这个javabean实现了Serializable接口</li>\n<li>实例化javaBean，放到map中，然后正常设置流程变量</li>\n<li>正常取出变量</li>\n</ol>\n<h1 id=\"8-流程定义语言\"><a href=\"#8-流程定义语言\" class=\"headerlink\" title=\"8 流程定义语言\"></a>8 流程定义语言</h1><h2 id=\"8-1-流程（Process）\"><a href=\"#8-1-流程（Process）\" class=\"headerlink\" title=\"8.1 流程（Process）\"></a>8.1 流程（Process）</h2><p>bpmn文件一个流程的根元素。一个流程就代表一个工作流。</p>\n<h2 id=\"8-2-顺序流（sequenceFlow）\"><a href=\"#8-2-顺序流（sequenceFlow）\" class=\"headerlink\" title=\"8.2 顺序流（sequenceFlow）\"></a>8.2 顺序流（sequenceFlow）</h2><p>顺序流是连接两个流程节点的连线，代表一个节点的出口。流程执行完一个节点后，会沿着节点的所有外出顺序流继续执行。 就是说，BPMN 2.0默认的行为就是并发的： 两个外出顺序流会创造两个单独的，并发流程分支。</p>\n<p>顺序流主要由4个属性组成：</p>\n<ul>\n<li>Id: 唯一标示，用来区分不同的顺序流</li>\n<li>sourceRef：连线的源头节点ID</li>\n<li>targetRef：连线的目标节点ID</li>\n<li>name（可选）：连线的名称，不涉及业务，主要用于显示</li>\n</ul>\n<h2 id=\"8-3-节点\"><a href=\"#8-3-节点\" class=\"headerlink\" title=\"8.3 节点\"></a>8.3 节点</h2><h3 id=\"8-3-1-开始事件节点-startEvent\"><a href=\"#8-3-1-开始事件节点-startEvent\" class=\"headerlink\" title=\"8.3.1 开始事件节点(startEvent)\"></a>8.3.1 开始事件节点(startEvent)</h3><p>开始事件用来指明流程在哪里开始。开始事件的类型（流程在接收事件时启动， 还是在指定时间启动，等等），定义了流程如何启动， 这通过事件中不同的小图表来展示。 在XML中，这些类型是通过声明不同的子元素来区分的。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/startEvent.png\" alt=\"此处输入图片的描述\"></p>\n<ol>\n<li><p>空开始事件<br>空开始事件技术上意味着没有指定启动流程实例的触发条件。最常用的一种开始，意味着流程的启动需要手动触发，通过调用api的startProcessInstanceByXXX方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">ProcessInstance processInstance = runtimeService.startProcessInstanceByXXX()</div></pre></td></tr></table></figure>\n<p>图形标记：空开始事件显示成一个圆圈，没有内部图表（没有触发类型）<br>XML结构如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">startEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"startevent\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Start\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">startEvent</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>定时开始事件</p>\n<p>定时开始事件用来在指定的时间创建流程实例。 它可以同时用于只启动一次的流程 和应该在特定时间间隔启动多次的流程。</p>\n<pre><code>注意：\n1.子流程不能使用定时开始事件。\n2.定时开始事件在流程发布后就会开始计算时间。不需要调用startProcessInstanceByXXX，虽然也而已调用启动流程的方法，但是那会导致调用startProcessInstanceByXXX时启动过多的流程。\n3.当包含定时开始事件的新版本流程部署时，对应的上一个定时器就会被删除。这是因为通常不希望自动启动旧版本流程的流程实例。\n</code></pre><p>图形标记：定时开始事件显示为一个圆圈，内部是一个表。<br>XML内容：定时开始事件的XML内容是普通开始事件的声明，包含一个定时定义子元素。<br>示例：流程会启动4次，每次间隔5分钟，从2013年9月18日，12:10开始计时。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">startEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theStart\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">timerEventDefinition</span>&gt;</span>                </div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">timeCycle</span>&gt;</span>R4/2017-11-22T11:04/PT5M<span class=\"tag\">&lt;/<span class=\"name\">timeCycle</span>&gt;</span>            \t\t </div><div class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">timerEventDefinition</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">startEvent</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>示例：流程会根据选中的时间启动一次。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">startEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theStart\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">timerEventDefinition</span>&gt;</span>                </div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">timeDate</span>&gt;</span>2017-12-31T23:59:59<span class=\"tag\">&lt;/<span class=\"name\">timeDate</span>&gt;</span>               \t\t </div><div class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">timerEventDefinition</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">startEvent</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"8-3-2-结束事件节点-endEvent\"><a href=\"#8-3-2-结束事件节点-endEvent\" class=\"headerlink\" title=\"8.3.2 结束事件节点(endEvent)\"></a>8.3.2 结束事件节点(endEvent)</h3><p>结束事件表示（子）流程（分支）的结束。结束事件都是触发事件。这是说当流程达结束事件，会触发一个结果。 结果的类型是通过事件的内部黑色图标表示的。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/endEvent.png\" alt=\"结束事件\"></p>\n<ol>\n<li><p>空结束事件</p>\n<p>空结束事件意味着到达事件时不会指定抛出的结果。这样，引擎会直接结束当前执行的分支，不会做其他事情。<br>图形标记:空结束事件是一个粗边圆圈，内部没有小图表（无结果类型）<br>XML内容:空结束事件的XML内容是普通结束事件定义，不包含子元素（其他结束事件类型都会包含声明类型的子元素）。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">endEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"end\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"my end event\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"8-3-3-任务节点-Task\"><a href=\"#8-3-3-任务节点-Task\" class=\"headerlink\" title=\"8.3.3 任务节点(Task)\"></a>8.3.3 任务节点(Task)</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/task.png\" alt=\"任务节点\"></p>\n<ol>\n<li><p>用户任务节点<br>用户任务用来设置必须由人员完成的工作。当流程执行到用户任务，会创建一个新任务，并把这个新任务加入到分配人或群组的任务列表中。<br>图形标记：用户任务显示成一个普通任务（圆角矩形），左上角有一个小用户图标。<br>XML内容：XML中的用户任务定义如下。id属性是必须的。 name属性是可选的。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theTask\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Important task\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>用户任务也可以设置描述(实际上所有BPMN 2.0元素都可以设置描述)。 添加documentation元素可以定义描述。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theTask\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Schedule meeting\"</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">documentation</span>&gt;</span></div><div class=\"line\">    Schedule an engineering meeting for next week with the new hire.  </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">documentation</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>在实际应用中，用户接到任务后可以参照任务描述来办理任务，描述文本可以通过标准的java方法来获得：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">task.getDescription()</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p><strong>私人任务</strong><br>    私有任务即有直接分配给指定用户的任务。只有一个用户可以成为任务的执行者。 在activiti中，用户叫做执行者。 拥有执行者的用户任务（即私有任务）对其他用户是不可见的。只能出现执行者的个人任务列表中.<br>    直接把用户任务分配给指定用户使用assignee属性，XML代码如下：<br>    <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theTask\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"my task\"</span> <span class=\"attr\">activiti:assignee</span>=<span class=\"string\">\"username\"</span>/&gt;</span></div></pre></td></tr></table></figure></p>\n<pre><code>Assignee属性对应的值为一个用户的ID。\n直接分配给用户的任务可以通过TaskService像下面这样办理：\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">    List&lt;Task&gt;tasks =taskService.createTaskQuery().taskAssignee(<span class=\"string\">\"sirius\"</span>).list();</div><div class=\"line\">Task task = tasks.get(<span class=\"number\">0</span>);<span class=\"comment\">// 假设任务集合的第一条是要办理的任务</span></div><div class=\"line\">taskService.complete(task.getId());</div></pre></td></tr></table></figure>\n</code></pre><p> <strong>公有任务</strong><br>    有的用户任务在指派时无法确定具体的办理者，这时任务也可以加入到    人员的候选任务列表中，然后让这些人员选择性认领和办理任务。</p>\n<pre><code>公有任务的分配可以分为指定候选用户和候选组两种。\n\n-  把任务添加到一批用户的候选任务列表中，使用candidateUsers    属    性，XML内容如下:\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTaskid=\"theTask\"name=\"my</span> <span class=\"attr\">task</span>\"<span class=\"attr\">activiti:candidateUsers</span>=<span class=\"string\">\"sirius,kermit\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n\ncandidateUsers属性内为用户的ID，多个用户ID之间使用（半角）逗号间隔。\n\n - 把任务添加到一个或多个候选组下，这时任务对组下的所有用户可见，首先得保证每个组下面有用户，通过IdentityService对象创建用户和组，然后把用户添加到对应的组下。然后配置组任务，使用candidateGroups属性，XML内容如下：\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theTask\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"my task\"</span> <span class=\"attr\">activiti:candidateGroups</span>=<span class=\"string\">\"testGroup，developGroup\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n\n间接分配给用户的任务，可以通过TaskService像下面这样操作：\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">List&lt;Task&gt;tasks =taskService.createTaskQuery()</div><div class=\"line\">.taskCandidateUser(<span class=\"string\">\"sirius\"</span>).list();</div><div class=\"line\">Task task = tasks.get(<span class=\"number\">0</span>);<span class=\"comment\">// 假设任务集合的第一条是要办理的任务</span></div><div class=\"line\">String taskId = task.getId();</div><div class=\"line\">taskService.claim(taskId ,“sirius”); <span class=\"comment\">//认领任务，让用户成为任务的执行者</span></div><div class=\"line\">taskService.complete(taskId );</div></pre></td></tr></table></figure>\n\n说明：\n\n 1. 要维护用户和组得使用用户管理服务对象，使用        processEngine    得到IdentityService。\n 2. 要分配组任务必须先创建组，而且组下得有用户，用户和组的    最关键属性是ID。\n 3. 使用newUser（userId）和newGroup（groupId）创建用户和组。\n 4. 使用createMembership（userId，groupId）把用户挂到组下。\n 5. 办理候选任务，首先得认领任务，让用户成为任务的执行者\n\n如果上面的方式还不够灵活，那么我们也可以自定义一个任务分配处理器，通过代码的方式来动态设置任务的属性。XML代码如下：\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"task1\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"My task\"</span>&gt;</span> </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">extensionElements</span>&gt;</span>    </div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">activiti:taskListener</span> <span class=\"attr\">event</span>=<span class=\"string\">\"create\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.MyAssignmentHandler\"</span>/&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">extensionElements</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">userTask</span>&gt;</span></div></pre></td></tr></table></figure>\n\nDelegateTask会传递给TaskListener的实现，通过它可以设置执行人，候选人和候选组：\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">Public <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyAssignmentHandler</span> <span class=\"keyword\">implements</span> <span class=\"title\">TaskListener</span> </span>&#123;</div><div class=\"line\">  </div><div class=\"line\">    <span class=\"function\">Public <span class=\"keyword\">void</span> <span class=\"title\">notify</span><span class=\"params\">(DelegateTask delegateTask)</span></span>&#123; </div><div class=\"line\">\t<span class=\"comment\">// 执行用户搜索相关代码    </span></div><div class=\"line\">\t...</div><div class=\"line\">\t<span class=\"comment\">// 然后把获取到的用户通过下面方法，设置给当前触发事件的任务</span></div><div class=\"line\">    \tdelegateTask.setAssignee(<span class=\"string\">\"sirius\"</span>);</div><div class=\"line\">    \t<span class=\"comment\">//delegateTask.addCandidateUser(\"kermit\");</span></div><div class=\"line\">   \t<span class=\"comment\">//delegateTask.addCandidateGroup(\"testGroup\"); </span></div><div class=\"line\">   \t...  </div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</code></pre><ol>\n<li><p>接收任务节点（receiveTask）</p>\n<p>接收任务是一个简单任务，它会等待对应消息的到达。当前，官方只实现了这个任务的java语义。 当流程达到接收任务，流程状态会保存到数据库中。在任务创建后，意味着流程会进入等待状态，直到引擎接收了一个特定的消息，这会触发流程穿过接收任务继续执行。</p>\n<p>图形标记：接收任务显示为一个任务（圆角矩形），右上角有一个消息小标记。 消息是白色的（黑色图标表示发送语义）。</p>\n<p>XML内容：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">receiveTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"waitState\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"wait\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>当前任务（一般指机器自动完成，但需要耗费一定时间的工作）完成后，向后推移流程，可以调用runtimeService.signal(executionId)，传递接收任务上流程的id。\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">ProcessInstance pi = runtimeService.startProcessInstanceByKey(<span class=\"string\">\"receiveTask\"</span>);</div><div class=\"line\">Execution execution = runtimeService.createExecutionQuery()</div><div class=\"line\">                        .processInstanceId(pi.getId())</div><div class=\"line\">                        .activityId(<span class=\"string\">\"waitState\"</span>)</div><div class=\"line\">                        .singleResult();</div><div class=\"line\">runtimeService.signal(execution.getId());</div></pre></td></tr></table></figure>\n</code></pre><hr>\n<p>述两个虽然都可以统称为任务节点，但是还是有本质区别：</p>\n<ol>\n<li>receiveTask主要代表机器自动执行的，userTask代表人工干预的。</li>\n<li>eiveTask任务产生后会在act_ru_execution表中新增一条记录，    而userTask产生后会在act_ru_execution和act_ru_task（主要记录任    务的发布时间，办理人等信息）中各产生一条记录。</li>\n<li>receiveTask任务提交方式使用RuntimeService的signal方法提交，    userTask任务提交方式使用TaskService的complete方法提交。</li>\n</ol>\n<h3 id=\"8-3-4-网关（gateWay）\"><a href=\"#8-3-4-网关（gateWay）\" class=\"headerlink\" title=\"8.3.4 网关（gateWay）\"></a>8.3.4 网关（gateWay）</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/gateWay.png\" alt=\"网关\"></p>\n<ol>\n<li><p>排他网关<br>排他网关（也叫异或（XOR）网关，或更技术性的叫法基于数据的排他网关），用来在流程中实现决策。</p>\n<p><strong>图形标记</strong>:排他网关显示成一个普通网关（比如，菱形图形）,内部是一个“X”图标,表示异或（XOR）语义。注意，没有内部图标的网关，默认为排他网关。BPMN2.0规范不允许在同一个流程定义中同时使用没有X和有X的菱形图形。</p>\n<p><strong>XML内容</strong>:排他网关的XML内容是很直接的：用一行定义了网关,条件表达式定义在外出顺序流中。参考条件顺序流 获得这些表达式的可用配置。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/xor.png\" alt=\"排他网关\"></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">exclusiveGatewayid=\"exclusiveGw\"name=\"Exclusive</span> <span class=\"attr\">Gateway</span>\"/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">id</span>=<span class=\"string\">\"flow2\"</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"exclusiveGw\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"theTask1\"</span>&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">conditionExpressionxsi:type=\"tFormalExpression\"</span>&gt;</span>$&#123;input == 1&#125;<span class=\"tag\">&lt;/<span class=\"name\">conditionExpression</span>&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">sequenceFlow</span>&gt;</span>\t</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">id</span>=<span class=\"string\">\"flow3\"</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"exclusiveGw\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"theTask2\"</span>&gt;</span>   </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">conditionExpressionxsi:type=\"tFormalExpression\"</span>&gt;</span>$&#123;input == 2&#125;<span class=\"tag\">&lt;/<span class=\"name\">conditionExpression</span>&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">sequenceFlow</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">id</span>=<span class=\"string\">\"flow4\"</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"exclusiveGw\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"theTask3\"</span>&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">conditionExpressionxsi:type=\"tFormalExpression\"</span>&gt;</span>$&#123;input == 3&#125;<span class=\"tag\">&lt;/<span class=\"name\">conditionExpression</span>&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">sequenceFlow</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>说明：\n1.一个排他网关对应一个以上的顺序流\n2.由排他网关流出的顺序流都有个conditionExpression元素，在内部维护返回boolean类型的决策结果。\n3.决策网关只会返回一条结果。当流程执行到排他网关时，流程引擎会自动检索网关出口，从上到下检索如果发现第一条决策结果为true或者没有设置条件的(默认为成立)，则流出。\n4.如果没有任何一个出口符合条件则抛出异常。\n</code></pre><ol>\n<li><p>并行网关</p>\n<p>网关也可以表示流程中的并行情况。最简单的并行网关是parallelGateWay，它允许将流程分成多条分支，也可以把多条分支汇聚到一起。</p>\n<p><strong>图形标记</strong>：并行网关显示成一个普通网关（菱形）内部是一个“加号”图标，表示“与（AND）”语义。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/parallelGateWay.png\" alt=\"并行网关\"></p>\n<p><strong>XML内容</strong>：定义并行网关只需要一行</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parallelGateway</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myParallelGateway\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>实际发生的行为（分支，聚合，同时分支聚合），要根据并行网关的顺序流来决定。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">startEvent</span> <span class=\"attr\">id</span>=<span class=\"string\">\"theStart\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">id</span>=<span class=\"string\">\"flow1\"</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"theStart\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"fork\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parallelGateway</span> <span class=\"attr\">id</span>=<span class=\"string\">\"fork\"</span>/&gt;</span> </div><div class=\"line\"> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"fork\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"receivePayment\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"fork\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"shipOrder\"</span>/&gt;</span></div><div class=\"line\">    </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTaskid=\"receivePayment\"name=\"Receive</span> <span class=\"attr\">Payment</span>\"/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"receivePayment\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"join\"</span>/&gt;</span></div><div class=\"line\">   </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTaskid=\"shipOrder\"name=\"Ship</span> <span class=\"attr\">Order</span>\"/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"shipOrder\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"join\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parallelGateway</span> <span class=\"attr\">id</span>=<span class=\"string\">\"join\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"join\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"archiveOrder\"</span>/&gt;</span></div><div class=\"line\"> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">userTask</span> <span class=\"attr\">id</span>=<span class=\"string\">\"archiveOrder\"</span><span class=\"attr\">name</span>=<span class=\"string\">\"Archive Order\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">sequenceFlow</span> <span class=\"attr\">sourceRef</span>=<span class=\"string\">\"archiveOrder\"</span> <span class=\"attr\">targetRef</span>=<span class=\"string\">\"theEnd\"</span>/&gt;</span></div><div class=\"line\">         </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">endEventid=\"theEnd\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>上面例子中，流程启动之后，会创建两个任务：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">ProcessInstancepi =runtimeService.startProcessInstanceByKey(<span class=\"string\">\"forkJoin\"</span>);</div><div class=\"line\"></div><div class=\"line\">List&lt;Task&gt; tasks = taskService.createTaskQuery().list();</div><div class=\"line\">Task task1 =tasks.get(<span class=\"number\">0</span>);</div><div class=\"line\">System.out.println(<span class=\"string\">\"Receive Payment\"</span>+task1.getName());</div><div class=\"line\">Task task2 =tasks.get(<span class=\"number\">1</span>);</div><div class=\"line\">System.out.println(<span class=\"string\">\"Ship Order\"</span>+task2.getName());</div></pre></td></tr></table></figure>\n<p>当两个任务都完成时，第二个并行网关会汇聚两个分支，因为它只有一条外出连线，不会创建并行分支，只会创建归档订单任务。</p>\n<p>说明：<br>1.并行网关的功能是基于进入和外出的顺序流的：</p>\n<pre><code>分支(fork)：并行后的所有外出顺序流，为每个顺序流都创建一个并发分支。\n汇聚(join)：所有到达并行网关，在此等待的进入分支，直到所有进入顺序流的分支都到达以后， 流程就会通过汇聚网关。\n</code></pre><p>2.并行网关的进入和外出都是使用相同节点标示<br>3.如果同一个并行网关有多个进入和多个外出顺序流，它就同时具有分支和汇聚功能。这时，网关会先汇聚所有进入的顺序流，然后再切分成多个并行分支。<br>4.并行网关不会解析条件。 即使顺序流中定义了条件，也会被忽略。<br>5.并行网关不需要是“平衡的”（比如，对应并行网关的进入和外出节点数目相等）。如图中标示是合法的：<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/binxing.png\" alt=\"并行网关不需要是“平衡的”\"></p>\n</li>\n</ol>\n<h2 id=\"8-4-监听器（Listener）\"><a href=\"#8-4-监听器（Listener）\" class=\"headerlink\" title=\"8.4 监听器（Listener）\"></a>8.4 监听器（Listener）</h2><p>在流程中我们有时会对整个流程或者一个节点的某种状态做出相应的处理。这时就会用到监听器。</p>\n<p>在Activiti中流程的监听主要分为两大类，执行监听器和任务监听器。</p>\n<h3 id=\"8-4-1-执行监听器（ExecutionListener）\"><a href=\"#8-4-1-执行监听器（ExecutionListener）\" class=\"headerlink\" title=\"8.4.1 执行监听器（ExecutionListener）\"></a>8.4.1 执行监听器（ExecutionListener）</h3><p>执行监听器可以执行外部java代码或执行表达式，当流程定义中发生了某个事件。 可以捕获的事件有:</p>\n<ul>\n<li>流程实例的启动和结束。</li>\n<li>选中一条连线。</li>\n<li>节点的开始和结束。</li>\n<li>网关的开始和结束。</li>\n<li>中间事件的开始和结束。</li>\n<li>开始事件结束或结束事件开始。</li>\n</ul>\n<p>现在有这样一个简单流程，只包含开始、结束、接收任务和用户任务4个节点：<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/listenerExample.png\" alt=\"监听器流程示例\"><br>配置监听器,XML代码如下<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">extensionElements</span>&gt;</span></div><div class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">activiti:executionListener</span> <span class=\"attr\">event</span>=<span class=\"string\">\"start\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"test.ProcessStartListener\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">activiti:executionListener</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">extensionElements</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>说明：</p>\n<ul>\n<li><p>任务监听器支持以下属性：</p>\n<ul>\n<li>event（必选）：任务监听器会被调用的任务类型<ul>\n<li>start：流程节点创建后触发</li>\n<li>end：当任务完成，并尚未从运行数据中删除时触发</li>\n<li>take：任务完成后，流程流出时触发</li>\n</ul>\n</li>\n<li>class(必选)：代理类，实现org.activiti.engine.delegate.ExecutionListener接口。<br>示例：<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProcessStartListener</span> <span class=\"keyword\">implements</span> <span class=\"title\">ExecutionListener</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">1L</span>;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">notify</span><span class=\"params\">(DelegateExecution execution)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"ID:\"</span>+execution.getId()+<span class=\"string\">\", Name:\"</span>+execution.getCurrentActivityName());</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n</li>\n<li><p>执行监听器配置可以放在以下三个地方，如图<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/taskListener.png\" alt=\"此处输入图片的描述\"></p>\n<p> a)    监听整个流程的启动和结束状态，配置为process节点的子元素，如①<br> b)    监听一个节点的启动和结束状态，配置为一个节点的子元素，如②和③<br> c)    监听一条连线的执行，配置在sequenceFlow节点的内部，只有task一种事件，如④</p>\n</li>\n</ul>\n<p>启动流程测试代码如下：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//部署流程</span></div><div class=\"line\">    Deployment deployment = repositoryService.createDeployment()</div><div class=\"line\">                .addClasspathResource(<span class=\"string\">\"diagrams/Listener.bpmn\"</span>)</div><div class=\"line\">                .addClasspathResource(<span class=\"string\">\"diagrams/Listener.png\"</span>)</div><div class=\"line\">                .deploy();</div><div class=\"line\">    <span class=\"comment\">//启动</span></div><div class=\"line\">    ProcessInstance processInstance = runtimeService.startProcessInstanceByKey(<span class=\"string\">\"ListenerTest\"</span>);</div><div class=\"line\">    <span class=\"comment\">//推动</span></div><div class=\"line\">    String processInstanceId = processInstance.getId();</div><div class=\"line\">    runtimeService.signal(processInstanceId);</div><div class=\"line\">    </div><div class=\"line\">    String id = taskService.createTaskQuery().processInstanceId(processInstanceId).singleResult().getId();</div><div class=\"line\">    taskService.complete(id);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>测试结果如下：</p>\n<pre><code>ID:60005, Name:开始\nID:60005, Name:接收任务\nID:60005, Name:用户任务\n</code></pre><h3 id=\"8-4-2-任务监听器（TaskListener）\"><a href=\"#8-4-2-任务监听器（TaskListener）\" class=\"headerlink\" title=\"8.4.2 任务监听器（TaskListener）\"></a>8.4.2 任务监听器（TaskListener）</h3><p>任务监听器可以在发生对应的任务相关事件时执行自定义java逻辑 或表达式。<br>任务监听器只能添加到流程定义中的用户任务中。在之前任务节点上添加任务监听:<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/activiti/taskListener2.png\" alt=\"此处输入图片的描述\"></p>\n<p>任务监听器支持以下属性</p>\n<ul>\n<li>event（必选）：任务监听器会被调用的任务类型。 可能的类型为：<ul>\n<li>create：任务创建并设置所有属性后触发。</li>\n<li>assignment：任务分配给一些人时触发。当流程到达userTask，assignment事件 会在create事件之前发生。这样的顺序似乎不自然，但是原因很简单：当获得create时间时， 我们想获得任务的所有属性，包括执行人。</li>\n<li>complete：当任务完成，并尚未从运行数据中删除时触发。</li>\n</ul>\n</li>\n<li>class：必须调用的代理类。 这个类必须实现org.activiti.engine.delegate.TaskListener    接口。</li>\n</ul>\n<hr>\n<p>新添加的任务监听包裹在executionListener监听的内部，顺序为：execution Start–&gt; task Assignment–&gt;task Create–&gt;task Complete–&gt;execution End–&gt;execution take。</p>\n<h1 id=\"9-Spring集成\"><a href=\"#9-Spring集成\" class=\"headerlink\" title=\"9 Spring集成\"></a>9 Spring集成</h1><p>虽然前面的例子中我们可以自己手动来创建相应的API实例，但是在一个项目中这些API都应该以<strong>单例形式</strong>存在的。和Spring的集成主要就是把Activiti的主要对象交给Spring容器管理。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 流程引擎 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.spring.ProcessEngineFactoryBean\"</span>&gt;</span> </div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"processEngineConfiguration\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"processEngineConfiguration\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">&lt;!-- 流程引擎配置对象 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"processEngineConfiguration\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.activiti.spring.SpringProcessEngineConfiguration\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"transactionManager\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"transactionManager\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- activiti表数据更新策略 false true（默认） create-drop--&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"databaseSchemaUpdate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- activiti历史数据保存策略 none activity audit(默认) full--&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"history\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"audit\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 管理线程计时器和异步消息,默认开启，但有ManagementService替代，避免冲突所以关闭 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jobExecutorActivate\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"false\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 加载资源文件 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"deploymentResources\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"classpath:/activiti-process/*.bpmn\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">&lt;!-- 核心业务类 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"repositoryService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getRepositoryService\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"runtimeService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getRuntimeService\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"taskService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getTaskService\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"historyService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getHistoryService\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"managementService\"</span> <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"processEngine\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getManagementService\"</span> /&gt;</span></div></pre></td></tr></table></figure>\n<p><strong>注意：</strong></p>\n<ol>\n<li>ProcessEngineConfiguration<br>单独使用和整合Spring时不是同一个class<br>独立使用：org.activiti.engine.ProcessEngineConfiguration<br>整合Spring：org.activiti.spring.SpringProcessEngineConfiguration</li>\n<li>项目部署后会自动在数据库中创建相关流程定义</li>\n</ol>"},{"title":"DCloud 离线打包之Android Studio","date":"2017-08-08T08:35:55.000Z","_content":"\nDCloud 官方文档对于一个没有接触过Android开发的人来说相当的坑爹，以下是根据本人开发过程整理的Android Studio离线打包完整记录，对每一个步骤讲解非常详细，没有接触过AS也没有任何影响。\n<!--more-->\n\n## 1. 预备环境\n\n 1. AndroidStudio开发环境,要求安装Android4.0或以上（API 14）SDK。安装方法自行百度。\n 2. 下载HBuilder离线打包Android版SDK（[5+ SDK下载][1]）。\n\n## 2. 5+ SDK目录说明\n\n - **HBuilder-Hello**：离线打包演示应用；\n - **HBuilder-Integrate**: 5+ SDK 集成和插件开发示例；\n - **libs**：SDK库文件目录；\n - **Feature列表.xls**：Android平台各扩展Feature API对应的permission；\n\n## 3. 搭建AS工程结构\n\n### 3.1 打开AS，创建一个空项目。\n![新建工程][2]\n![不添加Activity][3]\n\n### 3.2 导入5+ SDK中的示例工程\n![导入Module][4]<br/>\n![选择5+ SDK示例工程][5]\n下面是AS工程的结构\n![目录结构][6]\n\n### 3.3 将示例工程的main目录替换到app目录下的main\n![替换目录][7]\n\n删除导入的module，即HBuilder-Hello。\n删除步骤：\n\n 1. 点击AS左上角  File → Project Structure\n 2. 弹出框中左下角选中要删除的Module,然后点击弹出框左上角的“-”删除，随后点击右下角OK键\n 3. 在工程中选中要删除的Module,点击键盘Delete\n\n## 4. 文件配置\n\n**根据Feature-Android.xml添加项目包依赖**\n\n### 4.1 删除多余文件\n\n 1. 删除app/src/main/assets 下的所有图片\n 2. 清空app/src/mami/res    下所有目录，不要删除目录\n 3. 清空app/src/main/jniLibs下所有目录，不要删除目录\n 4. 删除app/src/main/java   下的目录，保留RInformation\n 5. 删除app/src/main/iflytek 目录，若使用讯飞语音可保留\n 6. 编辑apps.HelloH5.www目录为apps.XXX.www,XXX为自己的项目名,固定写法。删除www下所有文件。\n\n\n### 4.2 添加基础jar包\n\n从Android-SDK@1.9.9.30983_20170414\\Android-SDK\\SDK\\libs下拷贝jar包到工程libs包下。\n\n - **android-support-v4.jar**(运行环境包含了这个包，若运行时报错则将这个包删除)\n - **json_simple-1.1.jar** 没有找到，但好像已经包含在其他几个包中\n - **nineoldandroids-2.4.0.jar** 在SDK中的名字叫my-nineoldandroids-2.4.0.jar\n - **pdr.jar**\n - **my-imageloader.jar**\n - **ui.jar**\n - **nativeui.jar**\n\n在在Modules Dependencies中加入这些包，操作方法：选中包，点击鼠标右键。\n\n![此处输入图片的描述][8]\n\n### 4.3 修改AndroidManifest.xml\n\n删除现有文件中的**application**节点和所有的**uses-permission** \n根据**Feature-Android.xml**文档添加相应的activity和uses-permission,并修改文件头部的package为自己的包名,versionCode和versionName自定义修改。\n\n### 4.4 添加资源文件\n\n严格对照**Feature-Android.xml**添加相关资源文件\n\n### 4.5 将HBuilder中开发的项目全部复制到apps.XXX.www目录下\n\n## 5. 参数修改\n\n有4个文件需要注意：\n\n - apps.XXX.www包下：manifest.json文件                 ***MJ***\n - src/main包下：AndroidManifest.xml文件               ***AM***\n - src/main/assets/data包下：dcloud_control.xml文件    ***DC***\n - src/main/res/values包下：String.xml文件             ***STR***\n\n**项目名**\n\n ***MJ*** id = apps.XXX.www中的XXX = ***DC*** appid\n \n**版本名称**\n\n***MJ*** version.name = ***AM*** android:versionName = ***DC*** appver\n\n**版本Code**\n\n***MJ*** version.code = ***AM*** android:versionCode\n\n**APP对外显示名称**\n\n***MJ*** name = ***STR*** app_name\n\n**基座号码**\n\n***DC*** version = 下载的5+ SDK目录上的一长串数字编号，如*1.9.9.30983*\n\n## 6. APP图标和启动背景\n\n**图标**\n\nAndroidManifest.xml文件的application节点下的***android:icon=\"@drawable/icon\"***设置了图标的名字为icon，可自行更改。将切好的图放置到src/main/res包下对应的drawable目录即可。\n\n**背景图**\n\n默认名为splash.png，切好图放置到对应的drawable目录中即可。\n\n## 7. 签名文件 ##\nAndroid Studio生成\n\n 1. 打开Android Studio的build目录，进入Generate Signed APK子菜单!\n ![sdf][9]\n 2. 点击新建，进入创建页，按提示填写!\n ![新建签名文件][10]\n\n ![输入说明][11]\n 3. 填写完成自动返回上一菜单并自动填充相关参数\n 4. 点击next即可生成\n\n## 8. 查看签名文件SHA-1、MD5 ##\n\n 1. 打开cmd,进入签名文件目录\n 2. 在控制台输入命令\n    debug.keystore：命令为：keytool -list -v -keystore debug.keystore\n    自定义的 keystore：命令为：keytool -list -v -keystore apk的keystore\n    自定义的 jks：命令为：keytool -list -v -keystore apk的jks\n    ![keystore命令][12]\n \n\n\n  [1]: http://ask.dcloud.net.cn/article/103\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_StartNewProject.png\n  [3]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_NoActivity.png\n  [4]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_importModule.png\n  [5]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_selectExample.png\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_catalog.png\n  [7]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_replace.png\n  [8]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_dependencies.png\n  [9]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step1.png\n  [10]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step2.png\n  [11]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step3.png\n  [12]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/keytool.png\n","source":"_posts/DCloud-离线打包之Android-Studio.md","raw":"---\ntitle: DCloud 离线打包之Android Studio\ncategories:\n  - DCloud\ntags:\n  - MUI\n  - Android Studio\n  - 离线打包\ndate: 2017-08-08 16:35:55\n---\n\nDCloud 官方文档对于一个没有接触过Android开发的人来说相当的坑爹，以下是根据本人开发过程整理的Android Studio离线打包完整记录，对每一个步骤讲解非常详细，没有接触过AS也没有任何影响。\n<!--more-->\n\n## 1. 预备环境\n\n 1. AndroidStudio开发环境,要求安装Android4.0或以上（API 14）SDK。安装方法自行百度。\n 2. 下载HBuilder离线打包Android版SDK（[5+ SDK下载][1]）。\n\n## 2. 5+ SDK目录说明\n\n - **HBuilder-Hello**：离线打包演示应用；\n - **HBuilder-Integrate**: 5+ SDK 集成和插件开发示例；\n - **libs**：SDK库文件目录；\n - **Feature列表.xls**：Android平台各扩展Feature API对应的permission；\n\n## 3. 搭建AS工程结构\n\n### 3.1 打开AS，创建一个空项目。\n![新建工程][2]\n![不添加Activity][3]\n\n### 3.2 导入5+ SDK中的示例工程\n![导入Module][4]<br/>\n![选择5+ SDK示例工程][5]\n下面是AS工程的结构\n![目录结构][6]\n\n### 3.3 将示例工程的main目录替换到app目录下的main\n![替换目录][7]\n\n删除导入的module，即HBuilder-Hello。\n删除步骤：\n\n 1. 点击AS左上角  File → Project Structure\n 2. 弹出框中左下角选中要删除的Module,然后点击弹出框左上角的“-”删除，随后点击右下角OK键\n 3. 在工程中选中要删除的Module,点击键盘Delete\n\n## 4. 文件配置\n\n**根据Feature-Android.xml添加项目包依赖**\n\n### 4.1 删除多余文件\n\n 1. 删除app/src/main/assets 下的所有图片\n 2. 清空app/src/mami/res    下所有目录，不要删除目录\n 3. 清空app/src/main/jniLibs下所有目录，不要删除目录\n 4. 删除app/src/main/java   下的目录，保留RInformation\n 5. 删除app/src/main/iflytek 目录，若使用讯飞语音可保留\n 6. 编辑apps.HelloH5.www目录为apps.XXX.www,XXX为自己的项目名,固定写法。删除www下所有文件。\n\n\n### 4.2 添加基础jar包\n\n从Android-SDK@1.9.9.30983_20170414\\Android-SDK\\SDK\\libs下拷贝jar包到工程libs包下。\n\n - **android-support-v4.jar**(运行环境包含了这个包，若运行时报错则将这个包删除)\n - **json_simple-1.1.jar** 没有找到，但好像已经包含在其他几个包中\n - **nineoldandroids-2.4.0.jar** 在SDK中的名字叫my-nineoldandroids-2.4.0.jar\n - **pdr.jar**\n - **my-imageloader.jar**\n - **ui.jar**\n - **nativeui.jar**\n\n在在Modules Dependencies中加入这些包，操作方法：选中包，点击鼠标右键。\n\n![此处输入图片的描述][8]\n\n### 4.3 修改AndroidManifest.xml\n\n删除现有文件中的**application**节点和所有的**uses-permission** \n根据**Feature-Android.xml**文档添加相应的activity和uses-permission,并修改文件头部的package为自己的包名,versionCode和versionName自定义修改。\n\n### 4.4 添加资源文件\n\n严格对照**Feature-Android.xml**添加相关资源文件\n\n### 4.5 将HBuilder中开发的项目全部复制到apps.XXX.www目录下\n\n## 5. 参数修改\n\n有4个文件需要注意：\n\n - apps.XXX.www包下：manifest.json文件                 ***MJ***\n - src/main包下：AndroidManifest.xml文件               ***AM***\n - src/main/assets/data包下：dcloud_control.xml文件    ***DC***\n - src/main/res/values包下：String.xml文件             ***STR***\n\n**项目名**\n\n ***MJ*** id = apps.XXX.www中的XXX = ***DC*** appid\n \n**版本名称**\n\n***MJ*** version.name = ***AM*** android:versionName = ***DC*** appver\n\n**版本Code**\n\n***MJ*** version.code = ***AM*** android:versionCode\n\n**APP对外显示名称**\n\n***MJ*** name = ***STR*** app_name\n\n**基座号码**\n\n***DC*** version = 下载的5+ SDK目录上的一长串数字编号，如*1.9.9.30983*\n\n## 6. APP图标和启动背景\n\n**图标**\n\nAndroidManifest.xml文件的application节点下的***android:icon=\"@drawable/icon\"***设置了图标的名字为icon，可自行更改。将切好的图放置到src/main/res包下对应的drawable目录即可。\n\n**背景图**\n\n默认名为splash.png，切好图放置到对应的drawable目录中即可。\n\n## 7. 签名文件 ##\nAndroid Studio生成\n\n 1. 打开Android Studio的build目录，进入Generate Signed APK子菜单!\n ![sdf][9]\n 2. 点击新建，进入创建页，按提示填写!\n ![新建签名文件][10]\n\n ![输入说明][11]\n 3. 填写完成自动返回上一菜单并自动填充相关参数\n 4. 点击next即可生成\n\n## 8. 查看签名文件SHA-1、MD5 ##\n\n 1. 打开cmd,进入签名文件目录\n 2. 在控制台输入命令\n    debug.keystore：命令为：keytool -list -v -keystore debug.keystore\n    自定义的 keystore：命令为：keytool -list -v -keystore apk的keystore\n    自定义的 jks：命令为：keytool -list -v -keystore apk的jks\n    ![keystore命令][12]\n \n\n\n  [1]: http://ask.dcloud.net.cn/article/103\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_StartNewProject.png\n  [3]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_NoActivity.png\n  [4]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_importModule.png\n  [5]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_selectExample.png\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_catalog.png\n  [7]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_replace.png\n  [8]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_dependencies.png\n  [9]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step1.png\n  [10]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step2.png\n  [11]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step3.png\n  [12]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/keytool.png\n","slug":"DCloud-离线打包之Android-Studio","published":1,"updated":"2018-02-27T07:38:38.084Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfkg0007hwvfvctmi5kt","content":"<p>DCloud 官方文档对于一个没有接触过Android开发的人来说相当的坑爹，以下是根据本人开发过程整理的Android Studio离线打包完整记录，对每一个步骤讲解非常详细，没有接触过AS也没有任何影响。<br><a id=\"more\"></a></p>\n<h2 id=\"1-预备环境\"><a href=\"#1-预备环境\" class=\"headerlink\" title=\"1. 预备环境\"></a>1. 预备环境</h2><ol>\n<li>AndroidStudio开发环境,要求安装Android4.0或以上（API 14）SDK。安装方法自行百度。</li>\n<li>下载HBuilder离线打包Android版SDK（<a href=\"http://ask.dcloud.net.cn/article/103\" target=\"_blank\" rel=\"noopener\">5+ SDK下载</a>）。</li>\n</ol>\n<h2 id=\"2-5-SDK目录说明\"><a href=\"#2-5-SDK目录说明\" class=\"headerlink\" title=\"2. 5+ SDK目录说明\"></a>2. 5+ SDK目录说明</h2><ul>\n<li><strong>HBuilder-Hello</strong>：离线打包演示应用；</li>\n<li><strong>HBuilder-Integrate</strong>: 5+ SDK 集成和插件开发示例；</li>\n<li><strong>libs</strong>：SDK库文件目录；</li>\n<li><strong>Feature列表.xls</strong>：Android平台各扩展Feature API对应的permission；</li>\n</ul>\n<h2 id=\"3-搭建AS工程结构\"><a href=\"#3-搭建AS工程结构\" class=\"headerlink\" title=\"3. 搭建AS工程结构\"></a>3. 搭建AS工程结构</h2><h3 id=\"3-1-打开AS，创建一个空项目。\"><a href=\"#3-1-打开AS，创建一个空项目。\" class=\"headerlink\" title=\"3.1 打开AS，创建一个空项目。\"></a>3.1 打开AS，创建一个空项目。</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_StartNewProject.png\" alt=\"新建工程\"><br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_NoActivity.png\" alt=\"不添加Activity\"></p>\n<h3 id=\"3-2-导入5-SDK中的示例工程\"><a href=\"#3-2-导入5-SDK中的示例工程\" class=\"headerlink\" title=\"3.2 导入5+ SDK中的示例工程\"></a>3.2 导入5+ SDK中的示例工程</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_importModule.png\" alt=\"导入Module\"><br><br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_selectExample.png\" alt=\"选择5+ SDK示例工程\"><br>下面是AS工程的结构<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_catalog.png\" alt=\"目录结构\"></p>\n<h3 id=\"3-3-将示例工程的main目录替换到app目录下的main\"><a href=\"#3-3-将示例工程的main目录替换到app目录下的main\" class=\"headerlink\" title=\"3.3 将示例工程的main目录替换到app目录下的main\"></a>3.3 将示例工程的main目录替换到app目录下的main</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_replace.png\" alt=\"替换目录\"></p>\n<p>删除导入的module，即HBuilder-Hello。<br>删除步骤：</p>\n<ol>\n<li>点击AS左上角  File → Project Structure</li>\n<li>弹出框中左下角选中要删除的Module,然后点击弹出框左上角的“-”删除，随后点击右下角OK键</li>\n<li>在工程中选中要删除的Module,点击键盘Delete</li>\n</ol>\n<h2 id=\"4-文件配置\"><a href=\"#4-文件配置\" class=\"headerlink\" title=\"4. 文件配置\"></a>4. 文件配置</h2><p><strong>根据Feature-Android.xml添加项目包依赖</strong></p>\n<h3 id=\"4-1-删除多余文件\"><a href=\"#4-1-删除多余文件\" class=\"headerlink\" title=\"4.1 删除多余文件\"></a>4.1 删除多余文件</h3><ol>\n<li>删除app/src/main/assets 下的所有图片</li>\n<li>清空app/src/mami/res    下所有目录，不要删除目录</li>\n<li>清空app/src/main/jniLibs下所有目录，不要删除目录</li>\n<li>删除app/src/main/java   下的目录，保留RInformation</li>\n<li>删除app/src/main/iflytek 目录，若使用讯飞语音可保留</li>\n<li>编辑apps.HelloH5.www目录为apps.XXX.www,XXX为自己的项目名,固定写法。删除www下所有文件。</li>\n</ol>\n<h3 id=\"4-2-添加基础jar包\"><a href=\"#4-2-添加基础jar包\" class=\"headerlink\" title=\"4.2 添加基础jar包\"></a>4.2 添加基础jar包</h3><p>从Android-SDK@1.9.9.30983_20170414\\Android-SDK\\SDK\\libs下拷贝jar包到工程libs包下。</p>\n<ul>\n<li><strong>android-support-v4.jar</strong>(运行环境包含了这个包，若运行时报错则将这个包删除)</li>\n<li><strong>json_simple-1.1.jar</strong> 没有找到，但好像已经包含在其他几个包中</li>\n<li><strong>nineoldandroids-2.4.0.jar</strong> 在SDK中的名字叫my-nineoldandroids-2.4.0.jar</li>\n<li><strong>pdr.jar</strong></li>\n<li><strong>my-imageloader.jar</strong></li>\n<li><strong>ui.jar</strong></li>\n<li><strong>nativeui.jar</strong></li>\n</ul>\n<p>在在Modules Dependencies中加入这些包，操作方法：选中包，点击鼠标右键。</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_dependencies.png\" alt=\"此处输入图片的描述\"></p>\n<h3 id=\"4-3-修改AndroidManifest-xml\"><a href=\"#4-3-修改AndroidManifest-xml\" class=\"headerlink\" title=\"4.3 修改AndroidManifest.xml\"></a>4.3 修改AndroidManifest.xml</h3><p>删除现有文件中的<strong>application</strong>节点和所有的<strong>uses-permission</strong><br>根据<strong>Feature-Android.xml</strong>文档添加相应的activity和uses-permission,并修改文件头部的package为自己的包名,versionCode和versionName自定义修改。</p>\n<h3 id=\"4-4-添加资源文件\"><a href=\"#4-4-添加资源文件\" class=\"headerlink\" title=\"4.4 添加资源文件\"></a>4.4 添加资源文件</h3><p>严格对照<strong>Feature-Android.xml</strong>添加相关资源文件</p>\n<h3 id=\"4-5-将HBuilder中开发的项目全部复制到apps-XXX-www目录下\"><a href=\"#4-5-将HBuilder中开发的项目全部复制到apps-XXX-www目录下\" class=\"headerlink\" title=\"4.5 将HBuilder中开发的项目全部复制到apps.XXX.www目录下\"></a>4.5 将HBuilder中开发的项目全部复制到apps.XXX.www目录下</h3><h2 id=\"5-参数修改\"><a href=\"#5-参数修改\" class=\"headerlink\" title=\"5. 参数修改\"></a>5. 参数修改</h2><p>有4个文件需要注意：</p>\n<ul>\n<li>apps.XXX.www包下：manifest.json文件                 <strong><em>MJ</em></strong></li>\n<li>src/main包下：AndroidManifest.xml文件               <strong><em>AM</em></strong></li>\n<li>src/main/assets/data包下：dcloud_control.xml文件    <strong><em>DC</em></strong></li>\n<li>src/main/res/values包下：String.xml文件             <strong><em>STR</em></strong></li>\n</ul>\n<p><strong>项目名</strong></p>\n<p> <strong><em>MJ</em></strong> id = apps.XXX.www中的XXX = <strong><em>DC</em></strong> appid</p>\n<p><strong>版本名称</strong></p>\n<p><strong><em>MJ</em></strong> version.name = <strong><em>AM</em></strong> android:versionName = <strong><em>DC</em></strong> appver</p>\n<p><strong>版本Code</strong></p>\n<p><strong><em>MJ</em></strong> version.code = <strong><em>AM</em></strong> android:versionCode</p>\n<p><strong>APP对外显示名称</strong></p>\n<p><strong><em>MJ</em></strong> name = <strong><em>STR</em></strong> app_name</p>\n<p><strong>基座号码</strong></p>\n<p><strong><em>DC</em></strong> version = 下载的5+ SDK目录上的一长串数字编号，如<em>1.9.9.30983</em></p>\n<h2 id=\"6-APP图标和启动背景\"><a href=\"#6-APP图标和启动背景\" class=\"headerlink\" title=\"6. APP图标和启动背景\"></a>6. APP图标和启动背景</h2><p><strong>图标</strong></p>\n<p>AndroidManifest.xml文件的application节点下的<strong><em>android:icon=”@drawable/icon”</em></strong>设置了图标的名字为icon，可自行更改。将切好的图放置到src/main/res包下对应的drawable目录即可。</p>\n<p><strong>背景图</strong></p>\n<p>默认名为splash.png，切好图放置到对应的drawable目录中即可。</p>\n<h2 id=\"7-签名文件\"><a href=\"#7-签名文件\" class=\"headerlink\" title=\"7. 签名文件\"></a>7. 签名文件</h2><p>Android Studio生成</p>\n<ol>\n<li>打开Android Studio的build目录，进入Generate Signed APK子菜单!<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step1.png\" alt=\"sdf\"></li>\n<li><p>点击新建，进入创建页，按提示填写!<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step2.png\" alt=\"新建签名文件\"></p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step3.png\" alt=\"输入说明\"></p>\n</li>\n<li>填写完成自动返回上一菜单并自动填充相关参数</li>\n<li>点击next即可生成</li>\n</ol>\n<h2 id=\"8-查看签名文件SHA-1、MD5\"><a href=\"#8-查看签名文件SHA-1、MD5\" class=\"headerlink\" title=\"8. 查看签名文件SHA-1、MD5\"></a>8. 查看签名文件SHA-1、MD5</h2><ol>\n<li>打开cmd,进入签名文件目录</li>\n<li>在控制台输入命令<br>debug.keystore：命令为：keytool -list -v -keystore debug.keystore<br>自定义的 keystore：命令为：keytool -list -v -keystore apk的keystore<br>自定义的 jks：命令为：keytool -list -v -keystore apk的jks<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/keytool.png\" alt=\"keystore命令\"></li>\n</ol>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>DCloud 官方文档对于一个没有接触过Android开发的人来说相当的坑爹，以下是根据本人开发过程整理的Android Studio离线打包完整记录，对每一个步骤讲解非常详细，没有接触过AS也没有任何影响。<br>","more":"</p>\n<h2 id=\"1-预备环境\"><a href=\"#1-预备环境\" class=\"headerlink\" title=\"1. 预备环境\"></a>1. 预备环境</h2><ol>\n<li>AndroidStudio开发环境,要求安装Android4.0或以上（API 14）SDK。安装方法自行百度。</li>\n<li>下载HBuilder离线打包Android版SDK（<a href=\"http://ask.dcloud.net.cn/article/103\" target=\"_blank\" rel=\"noopener\">5+ SDK下载</a>）。</li>\n</ol>\n<h2 id=\"2-5-SDK目录说明\"><a href=\"#2-5-SDK目录说明\" class=\"headerlink\" title=\"2. 5+ SDK目录说明\"></a>2. 5+ SDK目录说明</h2><ul>\n<li><strong>HBuilder-Hello</strong>：离线打包演示应用；</li>\n<li><strong>HBuilder-Integrate</strong>: 5+ SDK 集成和插件开发示例；</li>\n<li><strong>libs</strong>：SDK库文件目录；</li>\n<li><strong>Feature列表.xls</strong>：Android平台各扩展Feature API对应的permission；</li>\n</ul>\n<h2 id=\"3-搭建AS工程结构\"><a href=\"#3-搭建AS工程结构\" class=\"headerlink\" title=\"3. 搭建AS工程结构\"></a>3. 搭建AS工程结构</h2><h3 id=\"3-1-打开AS，创建一个空项目。\"><a href=\"#3-1-打开AS，创建一个空项目。\" class=\"headerlink\" title=\"3.1 打开AS，创建一个空项目。\"></a>3.1 打开AS，创建一个空项目。</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_StartNewProject.png\" alt=\"新建工程\"><br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_NoActivity.png\" alt=\"不添加Activity\"></p>\n<h3 id=\"3-2-导入5-SDK中的示例工程\"><a href=\"#3-2-导入5-SDK中的示例工程\" class=\"headerlink\" title=\"3.2 导入5+ SDK中的示例工程\"></a>3.2 导入5+ SDK中的示例工程</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_importModule.png\" alt=\"导入Module\"><br><br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_selectExample.png\" alt=\"选择5+ SDK示例工程\"><br>下面是AS工程的结构<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_catalog.png\" alt=\"目录结构\"></p>\n<h3 id=\"3-3-将示例工程的main目录替换到app目录下的main\"><a href=\"#3-3-将示例工程的main目录替换到app目录下的main\" class=\"headerlink\" title=\"3.3 将示例工程的main目录替换到app目录下的main\"></a>3.3 将示例工程的main目录替换到app目录下的main</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_replace.png\" alt=\"替换目录\"></p>\n<p>删除导入的module，即HBuilder-Hello。<br>删除步骤：</p>\n<ol>\n<li>点击AS左上角  File → Project Structure</li>\n<li>弹出框中左下角选中要删除的Module,然后点击弹出框左上角的“-”删除，随后点击右下角OK键</li>\n<li>在工程中选中要删除的Module,点击键盘Delete</li>\n</ol>\n<h2 id=\"4-文件配置\"><a href=\"#4-文件配置\" class=\"headerlink\" title=\"4. 文件配置\"></a>4. 文件配置</h2><p><strong>根据Feature-Android.xml添加项目包依赖</strong></p>\n<h3 id=\"4-1-删除多余文件\"><a href=\"#4-1-删除多余文件\" class=\"headerlink\" title=\"4.1 删除多余文件\"></a>4.1 删除多余文件</h3><ol>\n<li>删除app/src/main/assets 下的所有图片</li>\n<li>清空app/src/mami/res    下所有目录，不要删除目录</li>\n<li>清空app/src/main/jniLibs下所有目录，不要删除目录</li>\n<li>删除app/src/main/java   下的目录，保留RInformation</li>\n<li>删除app/src/main/iflytek 目录，若使用讯飞语音可保留</li>\n<li>编辑apps.HelloH5.www目录为apps.XXX.www,XXX为自己的项目名,固定写法。删除www下所有文件。</li>\n</ol>\n<h3 id=\"4-2-添加基础jar包\"><a href=\"#4-2-添加基础jar包\" class=\"headerlink\" title=\"4.2 添加基础jar包\"></a>4.2 添加基础jar包</h3><p>从Android-SDK@1.9.9.30983_20170414\\Android-SDK\\SDK\\libs下拷贝jar包到工程libs包下。</p>\n<ul>\n<li><strong>android-support-v4.jar</strong>(运行环境包含了这个包，若运行时报错则将这个包删除)</li>\n<li><strong>json_simple-1.1.jar</strong> 没有找到，但好像已经包含在其他几个包中</li>\n<li><strong>nineoldandroids-2.4.0.jar</strong> 在SDK中的名字叫my-nineoldandroids-2.4.0.jar</li>\n<li><strong>pdr.jar</strong></li>\n<li><strong>my-imageloader.jar</strong></li>\n<li><strong>ui.jar</strong></li>\n<li><strong>nativeui.jar</strong></li>\n</ul>\n<p>在在Modules Dependencies中加入这些包，操作方法：选中包，点击鼠标右键。</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/DCloud/AS_dependencies.png\" alt=\"此处输入图片的描述\"></p>\n<h3 id=\"4-3-修改AndroidManifest-xml\"><a href=\"#4-3-修改AndroidManifest-xml\" class=\"headerlink\" title=\"4.3 修改AndroidManifest.xml\"></a>4.3 修改AndroidManifest.xml</h3><p>删除现有文件中的<strong>application</strong>节点和所有的<strong>uses-permission</strong><br>根据<strong>Feature-Android.xml</strong>文档添加相应的activity和uses-permission,并修改文件头部的package为自己的包名,versionCode和versionName自定义修改。</p>\n<h3 id=\"4-4-添加资源文件\"><a href=\"#4-4-添加资源文件\" class=\"headerlink\" title=\"4.4 添加资源文件\"></a>4.4 添加资源文件</h3><p>严格对照<strong>Feature-Android.xml</strong>添加相关资源文件</p>\n<h3 id=\"4-5-将HBuilder中开发的项目全部复制到apps-XXX-www目录下\"><a href=\"#4-5-将HBuilder中开发的项目全部复制到apps-XXX-www目录下\" class=\"headerlink\" title=\"4.5 将HBuilder中开发的项目全部复制到apps.XXX.www目录下\"></a>4.5 将HBuilder中开发的项目全部复制到apps.XXX.www目录下</h3><h2 id=\"5-参数修改\"><a href=\"#5-参数修改\" class=\"headerlink\" title=\"5. 参数修改\"></a>5. 参数修改</h2><p>有4个文件需要注意：</p>\n<ul>\n<li>apps.XXX.www包下：manifest.json文件                 <strong><em>MJ</em></strong></li>\n<li>src/main包下：AndroidManifest.xml文件               <strong><em>AM</em></strong></li>\n<li>src/main/assets/data包下：dcloud_control.xml文件    <strong><em>DC</em></strong></li>\n<li>src/main/res/values包下：String.xml文件             <strong><em>STR</em></strong></li>\n</ul>\n<p><strong>项目名</strong></p>\n<p> <strong><em>MJ</em></strong> id = apps.XXX.www中的XXX = <strong><em>DC</em></strong> appid</p>\n<p><strong>版本名称</strong></p>\n<p><strong><em>MJ</em></strong> version.name = <strong><em>AM</em></strong> android:versionName = <strong><em>DC</em></strong> appver</p>\n<p><strong>版本Code</strong></p>\n<p><strong><em>MJ</em></strong> version.code = <strong><em>AM</em></strong> android:versionCode</p>\n<p><strong>APP对外显示名称</strong></p>\n<p><strong><em>MJ</em></strong> name = <strong><em>STR</em></strong> app_name</p>\n<p><strong>基座号码</strong></p>\n<p><strong><em>DC</em></strong> version = 下载的5+ SDK目录上的一长串数字编号，如<em>1.9.9.30983</em></p>\n<h2 id=\"6-APP图标和启动背景\"><a href=\"#6-APP图标和启动背景\" class=\"headerlink\" title=\"6. APP图标和启动背景\"></a>6. APP图标和启动背景</h2><p><strong>图标</strong></p>\n<p>AndroidManifest.xml文件的application节点下的<strong><em>android:icon=”@drawable/icon”</em></strong>设置了图标的名字为icon，可自行更改。将切好的图放置到src/main/res包下对应的drawable目录即可。</p>\n<p><strong>背景图</strong></p>\n<p>默认名为splash.png，切好图放置到对应的drawable目录中即可。</p>\n<h2 id=\"7-签名文件\"><a href=\"#7-签名文件\" class=\"headerlink\" title=\"7. 签名文件\"></a>7. 签名文件</h2><p>Android Studio生成</p>\n<ol>\n<li>打开Android Studio的build目录，进入Generate Signed APK子菜单!<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step1.png\" alt=\"sdf\"></li>\n<li><p>点击新建，进入创建页，按提示填写!<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step2.png\" alt=\"新建签名文件\"></p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/generateKey_step3.png\" alt=\"输入说明\"></p>\n</li>\n<li>填写完成自动返回上一菜单并自动填充相关参数</li>\n<li>点击next即可生成</li>\n</ol>\n<h2 id=\"8-查看签名文件SHA-1、MD5\"><a href=\"#8-查看签名文件SHA-1、MD5\" class=\"headerlink\" title=\"8. 查看签名文件SHA-1、MD5\"></a>8. 查看签名文件SHA-1、MD5</h2><ol>\n<li>打开cmd,进入签名文件目录</li>\n<li>在控制台输入命令<br>debug.keystore：命令为：keytool -list -v -keystore debug.keystore<br>自定义的 keystore：命令为：keytool -list -v -keystore apk的keystore<br>自定义的 jks：命令为：keytool -list -v -keystore apk的jks<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/keytool.png\" alt=\"keystore命令\"></li>\n</ol>"},{"title":"Java虚拟机：内存模型","keyword":["Java虚拟机","内存模型","运行时数据区"],"date":"2018-04-20T10:34:03.000Z","_content":"\nJava虚拟机是Java程序运行的真实环境，要深入理解Java是如何运行的，理解Java虚拟机是必不可少的。典型的例子：内存溢出。当我们理解java虚拟机之后，我们就会明白为何会出现这个问题，我们又当如何去定位并解决这个问题。\n\n<!--more-->\n\n![Java执行过程][1]\n\n## 1、JVM内存分布\n\n通常我们说的JVM内存分布即指**运行时数据区**。下图为分布概念图：\n\n![运行时数据区][2]\n\n### 1.1 堆(Heap)\n\n - 被所有线程共享的一块内存区域，在虚拟机启动时创建\n - 用来存贮对象实例\n - 可以通过-Xmx和-Xms控制堆的大小\n - OutOfMemoryError异常：当在堆中没有内存完成实例分配，且堆也无法再扩展时\n\n    Java堆是垃圾回收器的主要工作区域。由于现在垃圾收集器采用的基本都是**分代收集算法**，所以堆还可以细分为**新生代(New/Young)**和**老年代(Old/Tenured)**，再细致一点还有**Eden**区、**From Survivior**区、**To Survivor**区。\n    \n    **新生代：**新建的对象都由新生代分配内存。常常又被划分为Eden区和Survivor区，Eden空间不足时会把存活的对象转移到Survivor。新生代的大小可有-Xmn控制，也可用-XX:SurvivorRatio控制Eden和Survivor的比例。\n    **老年代：**存放经过多次垃圾回收仍然存活的对象。\n\n### 1.2 方法区(Method Area)\n\n - 线程间共享\n - 用来存储已被虚拟机加载的类信息、常量、静态变量、即时编译器变异后的代码等数据\n - OutOfMemoryError异常：当方法区无法满足内存的分配需求时\n\n**运行时常量池**：\n\n - 方法区的一部分\n - 用于存放编译期生成的各种字面量和符号引用，如String类型常量就存放在常量池\n - OutOfMemoryError异常：当常量池无法再申请到内存时\n\n### 1.3 程序计数器(Program Counter Register)\n\n - 当前线程所执行的字节码的行号指示器\n - 当前线程私有\n - 不会出现OutOfMemoryError\n - 如果线程执行是一个Java方法的时候，计数器记录的是虚拟机字节码指令的地址；当执行的是Native的方法的时候，计数器指令为空\n\n### 1.4 虚拟机栈(VM Stack)\n\n - 线程私有，生命周期与线程相同\n - 存储方法的局部变量表(局部变量、对象引用和返回地址等)、操作数栈、动态链接、方法出口等信息\n - Java方法执行的呢内存模型，每个方法执行的同时都会创建一个栈帧，每一个方法被调用直至完成的过程，就对应着一个栈帧在虚拟机栈中从入栈到出栈的过程。\n - StackOverflowError异常:当线程请求的栈深度大于虚拟机所允许的深度\n - OutOfMemoryError异常：如果栈的扩展时无法申请到足够的内存\n\n    JVM栈是线程私有的，每个线程创建的同时都会创建JVM栈。\n    \n    这里解释一下局部变量表，局部变量表存储方法相关的局部变量，包括基本数据，对象引用和返回地址等。在局部变量表中，只有long和double类型会占用2个局部变量空间（Slot，对于32位机器，一个Slot就是32个bit），其它都是1个Slot。需要注意的是，局部变量表是在编译时就已经确定好的，方法运行所需要分配的空间在栈帧中是完全确定的，在方法的生命周期内都不会改变。\n    \n### 1.5 本地方法栈(Native Method Stack)\n\n与虚拟机栈类似，唯一的区别就是虚拟机栈是执行Java方法的，本地方法栈是执行native方法的。\n\n<font color=\"red\">**在HotSpot虚拟机中直接把本地方法栈与虚拟机栈二合一**</font>\n\n### 1.6 直接内存(Direct Memory)\n\n - 直接内存并不是虚拟机运行的一部分，也不是Java虚拟机规范中定义的内存区域，但是这部分内存也被频繁使用.\n - NIO可以使用Native函数库直接分配堆外内存，堆中的DirectByteBuffer对象作为这块内存的引用进行操作\n - 大小不受Java堆大小的限制，受本机(服务器)内存限制\n - OutOfMemoryError异常：系统内存不足时\n\n### 1.7 永久代(PermGen)的发展\n\n方法区是JVM的规范，是一个逻辑存储区域。永久代是JVM规范的一种实现，并且永久代是HotSpot特有的。\n\n - JDK 1.6\n    永久代即方法区，存储着类信息、常量、静态变量、JIT编译的代码等\n - JDK 1.7\n    符号引用(Symbols)转移到了native heap；字面量(interned strings)转移到了java heap；类的静态变量(class statics)转移到了java heap\n - JDK 1.8\n    不存在永久代，取而代之的是元空间(MetaSpace)。不过元空间与永久代之间最大的区别在于：元空间并不在虚拟机中，而是使用本地内存。因此，默认情况下，元空间的大小仅受本地内存限制。\n\n那么，为什么要做出这些转变呢？有以下几点原因：\n\n 1. 字符串存在永久代中，容易出现性能问题和内存溢出。\n 2. 类及方法的信息等比较难确定其大小，因此对于永久代的大小指定比较困难，太小容易出现永久代溢出，太大则容易导致老年代溢出。\n 3. 永久代会为 GC 带来不必要的复杂度，并且回收效率偏低。\n 4. Oracle 可能会将HotSpot 与 JRockit 合二为一。\n\n关于PermGen和Metaspace，可以看下[liuxiaopeng的博客][3]。\n \n### 1.8 小结\n\nJava对象实例存放在堆中；常量存放在方法区的常量池；虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据放在方法区；以上区域是所有线程共享的。栈是线程私有的，存放该方法的局部变量表(基本类型、对象引用)、操作数栈、动态链接、方法出口等信息。\n\n一个Java程序对应一个JVM，一个方法（线程）对应一个Java栈。\n\n\n## 2、对象访问方式\n\nJava对象这里指的是引用类型的对象，这里用Student stu=new Student()为例子访问，Student stu作为引用对象，存在与Java虚拟机栈上，new Student()保存在Java堆中，堆中记录Student类型的信息包括方法，接口，对象类型等地址，这些类型的执行的数据存储在方法区中。\n\n### 2.1 句柄访问\n\nJava堆中分配一块句柄池，虚拟机栈中存放句柄池中的地址，句柄池中包括对象示例数据和对象类型数据的地址。\n![句柄访问][4]\n\n### 2.2 直接指针访问\n\n对象中存贮着对象实例数据和类数据的地址，Java栈的引用指向堆中的对象。\n\n![直接指针访问][5]\n\n\n### 2.3 小结\n\n这两种访问方式各有优势。\n\n**句柄访问：** reference中存储的是稳定的句柄地址，在对象被移动（垃圾收集时移动对象是非常普遍的行为）时只会改变句柄中的实例数据指针，而reference本身是不需要修改的。\n\n**直接指针访问：**最大的好处是速度快，节省了一次指针定位的时间开销。由于对象的访问在Java中非常的频繁，因此这类开销积少成多也是非常可观的执行成本。\n\n\n就HotSpot虚拟机来说，它采用的是直接指针访问。但从整个软件开发的范围来看，各种语言和框架使用句柄来访问的情况也是十分常见的。\n\n## 3、哪些对象需要回收？\n\nJava运行时数据区的几大板块中，程序计数器、虚拟机栈、本地方法栈3个区域随着线程而生，随着线程而灭，因此这几个区域的内存分配和回收都具备确定性，在这3个区域不需要过多的考虑GC问题。而堆和方法区则不一样，我们只有在程序运行期间才能知道会创建哪些对象、占用多少内存，这部分内存的分配和回收都是动态的，垃圾收集器关注的也正是这部分内存。\n\n堆中存放着几乎所有的对象实例，在垃圾收集之前，需要判断哪些对象需要被除了，即哪些对象“存活”着，哪些对象已经“死去”。\n\n### 3.1 引用计数算法\n\n给对象中添加一个引用计数器，每当有一个地方引用该对象，计数器值就加1，当引用失效时,引用就减1。任何时刻计数器为0的对象就是不可能再被使用的。\n\n缺陷：很难解决象之间互相循环引用的问题。\n\n### 3.2 可达性算法\n\n主流语言(Java、C#)的主流实现，都是通过可达性算法判断对象是否存活。\n\n基本思路：通过一系列成为\"GC Roots\"的对象作为起始点，当一个对象到GC Roots没有任何引用链相连时，则证明此对象不可达，所以它们就会被判定为可回收对象。\n![可达性算法][6]\n\n在Java中，可作为GC Roots的对象包括下面几种：\n\n - 虚拟机栈（栈帧中的本地变量表）中引用的对象\n - 方法区中类静态属性引用的对象\n - 方法区中常量引用的对象\n - 本地方法栈JNI（即一般说的Native方法）引用的对象\n\n### 3.3 再谈引用\n\n在JDK1.2以前，Java中的引用定义很传统：如果reference类型的数据中存储的数值代表着另一块内存的起始地址，就称这块内存代表着一个引用。这种定义很纯粹，但很狭隘，在这种定义下，对象只存在被引用和没有被引用两种状态。我们希望描述这样一类对象：当空间内存足够时，则保留在内存中；如果内存在GC后还非常紧张，则可以抛弃这些对象。很多系统的缓存都符合这种引用场景。\n\n在JDK1.之后，Java对引用概念进行了扩充，分为强引用(Strong Reference)、软引用(Soft Reference)、弱引用(Weak Reference)、虚引用(Phantom Reference)，强度依次递减。\n\n - 强引用：类似Object obj = new Object()，只要强引用还在，则不会被GC\n - 软引用：描述一些还有用但非必须的对象。在系统将要发生内存溢出异常前，将会把这些软引用对象列进回收范围之中进行第二次回收，如果这次回收还没有足够的内存，才会抛出内存溢出异常。\n - 弱引用：也是描述一些非必须对象，但强度比软引用更弱一些。这些对象只能存活到下一次GC之前。当开始GC时，无论内存是否足够，这些对象都会被回收。\n - 虚引用：不影响GC，唯一目的是被虚引用关联的对象被GC时能收到一个系统通知。\n\n### 3.4 生存还是死亡\n\n即使在可达性分析算法中不可达的对象，也并不是“非死不可”，这时候他们处于缓刑状态，要真正宣布一个对象死亡，至少需要经过两次标记过程：\n    \n\n 1. 可达性分析后没有与GC Roots相连的引用链，它会被第一次标记并且进行一次筛选。\n\n    筛选条件是是否有必要执行finalize()方法。如果没有覆盖finalize()方法，或者finalize()已经被虚拟机调用过，这两种情况都被视为“没有必要执行”。\n    如果判定为有必要执行finalize()方法，该对象被放置在一个F-Queue的队列中，并稍后由虚拟机建立的低优先级Finalizer线程去执行他，也就是触发对象的finalize()方法。finalize()是对象逃脱死亡的最后一次机会。\n 2. 稍后GC将对F-Queue中的对象进行第二次小规模标记\n \n    如果对象在finalize()中成功拯救自己——只要重新与引用链上的任何一个对象建立关联即可，那么第二次标记时它将被移出“即将回收”的集合；如果第二次标记时还没有逃脱，那它基本上就真的会被回收了。\n\n \n### 3.5 回收方法区\n\n方法区（或者HotSpot中的永久代）主要回收两部分：废弃常量和无用的类。\n\n 1. 废弃常量\n\n    如果没有任何一个地方引用常量，在GC时如果有必要的话，该常量会被清理出常量池。常量池中的类（接口）、方法、字段的符号引用也是类似的。\n    \n 2. 无用的类\n\n    卸载类就很麻烦了，必须同时满足3个条件：\n    - 该类所有实例都已被回收\n    - 加载该类的ClassLoader已经被会后\n    - 该类对应的Class对象没有在任何地方呗引用，无法通过反射访问该类的方法\n    \n    满足以上条件也只是可以被回收，是否被回收，HotSpot还有其他方法来控制。\n\n## 4、何时回收？\n\nGC经常发生的区域是堆区，堆区还可以细分为新生代、老年代，新生代还分为一个Eden区和两个Survivor区。\n\n 1. 对象优先在Eden中分配，当Eden中没有足够空间时，虚拟机将发生一次Minor GC，Minor GC非常频繁，而且速度也很快；\n 2. Full GC，发生在老年代的GC，当老年代没有足够的空间时即发生Full GC，发生Full GC一般都会有一次Minor GC。\n 3. JDK 6 Update 24之后,HandlePromotionFailure无效。只要老年代剩余连续空间大于新生代对象总和或者历次晋升的平均大小就会进行Minor GC，否则Full GC。\n~~发生Minor GC时，虚拟机会检测之前每次晋升到老年代的平均大小是否大于老年代的剩余空间大小，如果大于，则进行一次Full GC，如果小于，则查看是否允许担保失败(HandlePromotionFailure=true/false)，如果允许，那只会进行一次Minor GC，如果不允许，则改为进行一次Full GC。~~\n\n\n## 5、如何回收？\n\n简单描述几种算法的思路及演变过程\n\n### 5.1 标记——清除算法\n\n分为“标记”和“清除”两个阶段：\n    \n - 标记：即前面提到过的，GC时两次标记的过程。\n - 清除：统一回收被标记的对象\n\n缺点：\n\n - 效率不高：标记和清除的过程效率都不高\n - 产生大量内存碎片：导致以后分配较大内存对象时，由于没有足够大的连续内存从而提前触发一次GC动作。\n\n![标记——清除算法][7]\n    \n### 5.2 复制算法\n\n为了解决效率问题，出现了复制算法。将可用内存分为大小相等的两块，每次只是用其中一块。当这一块用完，将还存活的复制到另一块，然后再把使用过的内存空间一次清理掉，循环往复。\n\n - 优点：不用考虑内存碎片，实现简单，运行高效\n - 缺点：\n    - 内存缩小为原来的一半，代价太大；\n    - 需要额外的老年代空间进行分配担保\n            \n \n![复制算法][8]\n\n### 5.3 标记——整理算法\n\n分为“标记”和“整理”两个阶段：\n\n - 标记：即前面提到过的，GC时两次标记的过程。\n - 整理：让所有存活的对象都向一端移动，然后清理掉端边界以外的内存。\n \n![此处输入图片的描述][9]\n\n### 5.4 分代收集算法\n\n当前商业虚拟机的垃圾收集都采用“分代收集算法”。\n\n对于HotSpot虚拟机，堆内存分布如下图所示：\n\n![分代收集算法下的堆内存分布][10]  \n\n新生代中使用 **复制算法**，老年代使用 **标记——整理算法**\n\n默认情况下，eden与survivor的大小比例是8:1,可由 -XX：SurvivorRatio=8 设置。所以可用新生代大小为新生代的90%。\n\n以下是算法的基本思路：\n\n 1. 对象新建时，首先会在Eden区创建，年龄为0，直到GC时，若没有消亡，则放入servivor区，年龄为1\n 2. 进入survivor区也不是安全的，当下一次Minor GC来的时候，会检查Eden区和使用的Survivor区，若有对象存活，则放入另一个Survivor区，年龄加1\n 3. 当两个Survivor区切换几次后，对象年龄增长到15(默认，-XX:MaxTenuringThreshold=15)，则进入老年代。\n 4. 进入老年代也不是安全的，当老年代空间不足时，触发Major GC，已经消亡的对象还是会被干掉。\n\n推荐一个这个写的很逗可以看下：http://blog.csdn.net/sd4015700/article/details/50109939\n \n \n \n    \n \n  \n    \n \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/JavaProcess.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/RunningArea.png\n  [3]: http://www.cnblogs.com/paddix/p/5309550.html\n  [4]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/HandleAccess.png\n  [5]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/DirectPointerAccess.png\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/ReachabilityAnalysis.png\n  [7]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/mark-sweep.png\n  [8]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/copy.png\n  [9]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/mark-compact.png\n  [10]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/generationalCollection.png","source":"_posts/Java虚拟机：内存模型.md","raw":"---\ntitle: Java虚拟机：内存模型\ncategories:\n  - Java虚拟机\ntags:\n  - Java虚拟机\nkeyword:\n  - Java虚拟机\n  - 内存模型\n  - 运行时数据区\ndate: 2018-04-20 18:34:03\n---\n\nJava虚拟机是Java程序运行的真实环境，要深入理解Java是如何运行的，理解Java虚拟机是必不可少的。典型的例子：内存溢出。当我们理解java虚拟机之后，我们就会明白为何会出现这个问题，我们又当如何去定位并解决这个问题。\n\n<!--more-->\n\n![Java执行过程][1]\n\n## 1、JVM内存分布\n\n通常我们说的JVM内存分布即指**运行时数据区**。下图为分布概念图：\n\n![运行时数据区][2]\n\n### 1.1 堆(Heap)\n\n - 被所有线程共享的一块内存区域，在虚拟机启动时创建\n - 用来存贮对象实例\n - 可以通过-Xmx和-Xms控制堆的大小\n - OutOfMemoryError异常：当在堆中没有内存完成实例分配，且堆也无法再扩展时\n\n    Java堆是垃圾回收器的主要工作区域。由于现在垃圾收集器采用的基本都是**分代收集算法**，所以堆还可以细分为**新生代(New/Young)**和**老年代(Old/Tenured)**，再细致一点还有**Eden**区、**From Survivior**区、**To Survivor**区。\n    \n    **新生代：**新建的对象都由新生代分配内存。常常又被划分为Eden区和Survivor区，Eden空间不足时会把存活的对象转移到Survivor。新生代的大小可有-Xmn控制，也可用-XX:SurvivorRatio控制Eden和Survivor的比例。\n    **老年代：**存放经过多次垃圾回收仍然存活的对象。\n\n### 1.2 方法区(Method Area)\n\n - 线程间共享\n - 用来存储已被虚拟机加载的类信息、常量、静态变量、即时编译器变异后的代码等数据\n - OutOfMemoryError异常：当方法区无法满足内存的分配需求时\n\n**运行时常量池**：\n\n - 方法区的一部分\n - 用于存放编译期生成的各种字面量和符号引用，如String类型常量就存放在常量池\n - OutOfMemoryError异常：当常量池无法再申请到内存时\n\n### 1.3 程序计数器(Program Counter Register)\n\n - 当前线程所执行的字节码的行号指示器\n - 当前线程私有\n - 不会出现OutOfMemoryError\n - 如果线程执行是一个Java方法的时候，计数器记录的是虚拟机字节码指令的地址；当执行的是Native的方法的时候，计数器指令为空\n\n### 1.4 虚拟机栈(VM Stack)\n\n - 线程私有，生命周期与线程相同\n - 存储方法的局部变量表(局部变量、对象引用和返回地址等)、操作数栈、动态链接、方法出口等信息\n - Java方法执行的呢内存模型，每个方法执行的同时都会创建一个栈帧，每一个方法被调用直至完成的过程，就对应着一个栈帧在虚拟机栈中从入栈到出栈的过程。\n - StackOverflowError异常:当线程请求的栈深度大于虚拟机所允许的深度\n - OutOfMemoryError异常：如果栈的扩展时无法申请到足够的内存\n\n    JVM栈是线程私有的，每个线程创建的同时都会创建JVM栈。\n    \n    这里解释一下局部变量表，局部变量表存储方法相关的局部变量，包括基本数据，对象引用和返回地址等。在局部变量表中，只有long和double类型会占用2个局部变量空间（Slot，对于32位机器，一个Slot就是32个bit），其它都是1个Slot。需要注意的是，局部变量表是在编译时就已经确定好的，方法运行所需要分配的空间在栈帧中是完全确定的，在方法的生命周期内都不会改变。\n    \n### 1.5 本地方法栈(Native Method Stack)\n\n与虚拟机栈类似，唯一的区别就是虚拟机栈是执行Java方法的，本地方法栈是执行native方法的。\n\n<font color=\"red\">**在HotSpot虚拟机中直接把本地方法栈与虚拟机栈二合一**</font>\n\n### 1.6 直接内存(Direct Memory)\n\n - 直接内存并不是虚拟机运行的一部分，也不是Java虚拟机规范中定义的内存区域，但是这部分内存也被频繁使用.\n - NIO可以使用Native函数库直接分配堆外内存，堆中的DirectByteBuffer对象作为这块内存的引用进行操作\n - 大小不受Java堆大小的限制，受本机(服务器)内存限制\n - OutOfMemoryError异常：系统内存不足时\n\n### 1.7 永久代(PermGen)的发展\n\n方法区是JVM的规范，是一个逻辑存储区域。永久代是JVM规范的一种实现，并且永久代是HotSpot特有的。\n\n - JDK 1.6\n    永久代即方法区，存储着类信息、常量、静态变量、JIT编译的代码等\n - JDK 1.7\n    符号引用(Symbols)转移到了native heap；字面量(interned strings)转移到了java heap；类的静态变量(class statics)转移到了java heap\n - JDK 1.8\n    不存在永久代，取而代之的是元空间(MetaSpace)。不过元空间与永久代之间最大的区别在于：元空间并不在虚拟机中，而是使用本地内存。因此，默认情况下，元空间的大小仅受本地内存限制。\n\n那么，为什么要做出这些转变呢？有以下几点原因：\n\n 1. 字符串存在永久代中，容易出现性能问题和内存溢出。\n 2. 类及方法的信息等比较难确定其大小，因此对于永久代的大小指定比较困难，太小容易出现永久代溢出，太大则容易导致老年代溢出。\n 3. 永久代会为 GC 带来不必要的复杂度，并且回收效率偏低。\n 4. Oracle 可能会将HotSpot 与 JRockit 合二为一。\n\n关于PermGen和Metaspace，可以看下[liuxiaopeng的博客][3]。\n \n### 1.8 小结\n\nJava对象实例存放在堆中；常量存放在方法区的常量池；虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据放在方法区；以上区域是所有线程共享的。栈是线程私有的，存放该方法的局部变量表(基本类型、对象引用)、操作数栈、动态链接、方法出口等信息。\n\n一个Java程序对应一个JVM，一个方法（线程）对应一个Java栈。\n\n\n## 2、对象访问方式\n\nJava对象这里指的是引用类型的对象，这里用Student stu=new Student()为例子访问，Student stu作为引用对象，存在与Java虚拟机栈上，new Student()保存在Java堆中，堆中记录Student类型的信息包括方法，接口，对象类型等地址，这些类型的执行的数据存储在方法区中。\n\n### 2.1 句柄访问\n\nJava堆中分配一块句柄池，虚拟机栈中存放句柄池中的地址，句柄池中包括对象示例数据和对象类型数据的地址。\n![句柄访问][4]\n\n### 2.2 直接指针访问\n\n对象中存贮着对象实例数据和类数据的地址，Java栈的引用指向堆中的对象。\n\n![直接指针访问][5]\n\n\n### 2.3 小结\n\n这两种访问方式各有优势。\n\n**句柄访问：** reference中存储的是稳定的句柄地址，在对象被移动（垃圾收集时移动对象是非常普遍的行为）时只会改变句柄中的实例数据指针，而reference本身是不需要修改的。\n\n**直接指针访问：**最大的好处是速度快，节省了一次指针定位的时间开销。由于对象的访问在Java中非常的频繁，因此这类开销积少成多也是非常可观的执行成本。\n\n\n就HotSpot虚拟机来说，它采用的是直接指针访问。但从整个软件开发的范围来看，各种语言和框架使用句柄来访问的情况也是十分常见的。\n\n## 3、哪些对象需要回收？\n\nJava运行时数据区的几大板块中，程序计数器、虚拟机栈、本地方法栈3个区域随着线程而生，随着线程而灭，因此这几个区域的内存分配和回收都具备确定性，在这3个区域不需要过多的考虑GC问题。而堆和方法区则不一样，我们只有在程序运行期间才能知道会创建哪些对象、占用多少内存，这部分内存的分配和回收都是动态的，垃圾收集器关注的也正是这部分内存。\n\n堆中存放着几乎所有的对象实例，在垃圾收集之前，需要判断哪些对象需要被除了，即哪些对象“存活”着，哪些对象已经“死去”。\n\n### 3.1 引用计数算法\n\n给对象中添加一个引用计数器，每当有一个地方引用该对象，计数器值就加1，当引用失效时,引用就减1。任何时刻计数器为0的对象就是不可能再被使用的。\n\n缺陷：很难解决象之间互相循环引用的问题。\n\n### 3.2 可达性算法\n\n主流语言(Java、C#)的主流实现，都是通过可达性算法判断对象是否存活。\n\n基本思路：通过一系列成为\"GC Roots\"的对象作为起始点，当一个对象到GC Roots没有任何引用链相连时，则证明此对象不可达，所以它们就会被判定为可回收对象。\n![可达性算法][6]\n\n在Java中，可作为GC Roots的对象包括下面几种：\n\n - 虚拟机栈（栈帧中的本地变量表）中引用的对象\n - 方法区中类静态属性引用的对象\n - 方法区中常量引用的对象\n - 本地方法栈JNI（即一般说的Native方法）引用的对象\n\n### 3.3 再谈引用\n\n在JDK1.2以前，Java中的引用定义很传统：如果reference类型的数据中存储的数值代表着另一块内存的起始地址，就称这块内存代表着一个引用。这种定义很纯粹，但很狭隘，在这种定义下，对象只存在被引用和没有被引用两种状态。我们希望描述这样一类对象：当空间内存足够时，则保留在内存中；如果内存在GC后还非常紧张，则可以抛弃这些对象。很多系统的缓存都符合这种引用场景。\n\n在JDK1.之后，Java对引用概念进行了扩充，分为强引用(Strong Reference)、软引用(Soft Reference)、弱引用(Weak Reference)、虚引用(Phantom Reference)，强度依次递减。\n\n - 强引用：类似Object obj = new Object()，只要强引用还在，则不会被GC\n - 软引用：描述一些还有用但非必须的对象。在系统将要发生内存溢出异常前，将会把这些软引用对象列进回收范围之中进行第二次回收，如果这次回收还没有足够的内存，才会抛出内存溢出异常。\n - 弱引用：也是描述一些非必须对象，但强度比软引用更弱一些。这些对象只能存活到下一次GC之前。当开始GC时，无论内存是否足够，这些对象都会被回收。\n - 虚引用：不影响GC，唯一目的是被虚引用关联的对象被GC时能收到一个系统通知。\n\n### 3.4 生存还是死亡\n\n即使在可达性分析算法中不可达的对象，也并不是“非死不可”，这时候他们处于缓刑状态，要真正宣布一个对象死亡，至少需要经过两次标记过程：\n    \n\n 1. 可达性分析后没有与GC Roots相连的引用链，它会被第一次标记并且进行一次筛选。\n\n    筛选条件是是否有必要执行finalize()方法。如果没有覆盖finalize()方法，或者finalize()已经被虚拟机调用过，这两种情况都被视为“没有必要执行”。\n    如果判定为有必要执行finalize()方法，该对象被放置在一个F-Queue的队列中，并稍后由虚拟机建立的低优先级Finalizer线程去执行他，也就是触发对象的finalize()方法。finalize()是对象逃脱死亡的最后一次机会。\n 2. 稍后GC将对F-Queue中的对象进行第二次小规模标记\n \n    如果对象在finalize()中成功拯救自己——只要重新与引用链上的任何一个对象建立关联即可，那么第二次标记时它将被移出“即将回收”的集合；如果第二次标记时还没有逃脱，那它基本上就真的会被回收了。\n\n \n### 3.5 回收方法区\n\n方法区（或者HotSpot中的永久代）主要回收两部分：废弃常量和无用的类。\n\n 1. 废弃常量\n\n    如果没有任何一个地方引用常量，在GC时如果有必要的话，该常量会被清理出常量池。常量池中的类（接口）、方法、字段的符号引用也是类似的。\n    \n 2. 无用的类\n\n    卸载类就很麻烦了，必须同时满足3个条件：\n    - 该类所有实例都已被回收\n    - 加载该类的ClassLoader已经被会后\n    - 该类对应的Class对象没有在任何地方呗引用，无法通过反射访问该类的方法\n    \n    满足以上条件也只是可以被回收，是否被回收，HotSpot还有其他方法来控制。\n\n## 4、何时回收？\n\nGC经常发生的区域是堆区，堆区还可以细分为新生代、老年代，新生代还分为一个Eden区和两个Survivor区。\n\n 1. 对象优先在Eden中分配，当Eden中没有足够空间时，虚拟机将发生一次Minor GC，Minor GC非常频繁，而且速度也很快；\n 2. Full GC，发生在老年代的GC，当老年代没有足够的空间时即发生Full GC，发生Full GC一般都会有一次Minor GC。\n 3. JDK 6 Update 24之后,HandlePromotionFailure无效。只要老年代剩余连续空间大于新生代对象总和或者历次晋升的平均大小就会进行Minor GC，否则Full GC。\n~~发生Minor GC时，虚拟机会检测之前每次晋升到老年代的平均大小是否大于老年代的剩余空间大小，如果大于，则进行一次Full GC，如果小于，则查看是否允许担保失败(HandlePromotionFailure=true/false)，如果允许，那只会进行一次Minor GC，如果不允许，则改为进行一次Full GC。~~\n\n\n## 5、如何回收？\n\n简单描述几种算法的思路及演变过程\n\n### 5.1 标记——清除算法\n\n分为“标记”和“清除”两个阶段：\n    \n - 标记：即前面提到过的，GC时两次标记的过程。\n - 清除：统一回收被标记的对象\n\n缺点：\n\n - 效率不高：标记和清除的过程效率都不高\n - 产生大量内存碎片：导致以后分配较大内存对象时，由于没有足够大的连续内存从而提前触发一次GC动作。\n\n![标记——清除算法][7]\n    \n### 5.2 复制算法\n\n为了解决效率问题，出现了复制算法。将可用内存分为大小相等的两块，每次只是用其中一块。当这一块用完，将还存活的复制到另一块，然后再把使用过的内存空间一次清理掉，循环往复。\n\n - 优点：不用考虑内存碎片，实现简单，运行高效\n - 缺点：\n    - 内存缩小为原来的一半，代价太大；\n    - 需要额外的老年代空间进行分配担保\n            \n \n![复制算法][8]\n\n### 5.3 标记——整理算法\n\n分为“标记”和“整理”两个阶段：\n\n - 标记：即前面提到过的，GC时两次标记的过程。\n - 整理：让所有存活的对象都向一端移动，然后清理掉端边界以外的内存。\n \n![此处输入图片的描述][9]\n\n### 5.4 分代收集算法\n\n当前商业虚拟机的垃圾收集都采用“分代收集算法”。\n\n对于HotSpot虚拟机，堆内存分布如下图所示：\n\n![分代收集算法下的堆内存分布][10]  \n\n新生代中使用 **复制算法**，老年代使用 **标记——整理算法**\n\n默认情况下，eden与survivor的大小比例是8:1,可由 -XX：SurvivorRatio=8 设置。所以可用新生代大小为新生代的90%。\n\n以下是算法的基本思路：\n\n 1. 对象新建时，首先会在Eden区创建，年龄为0，直到GC时，若没有消亡，则放入servivor区，年龄为1\n 2. 进入survivor区也不是安全的，当下一次Minor GC来的时候，会检查Eden区和使用的Survivor区，若有对象存活，则放入另一个Survivor区，年龄加1\n 3. 当两个Survivor区切换几次后，对象年龄增长到15(默认，-XX:MaxTenuringThreshold=15)，则进入老年代。\n 4. 进入老年代也不是安全的，当老年代空间不足时，触发Major GC，已经消亡的对象还是会被干掉。\n\n推荐一个这个写的很逗可以看下：http://blog.csdn.net/sd4015700/article/details/50109939\n \n \n \n    \n \n  \n    \n \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/JavaProcess.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/RunningArea.png\n  [3]: http://www.cnblogs.com/paddix/p/5309550.html\n  [4]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/HandleAccess.png\n  [5]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/DirectPointerAccess.png\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/ReachabilityAnalysis.png\n  [7]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/mark-sweep.png\n  [8]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/copy.png\n  [9]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/mark-compact.png\n  [10]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/generationalCollection.png","slug":"Java虚拟机：内存模型","published":1,"updated":"2018-04-23T09:16:30.995Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfkl0008hwvfy7z1qvzl","content":"<p>Java虚拟机是Java程序运行的真实环境，要深入理解Java是如何运行的，理解Java虚拟机是必不可少的。典型的例子：内存溢出。当我们理解java虚拟机之后，我们就会明白为何会出现这个问题，我们又当如何去定位并解决这个问题。</p>\n<a id=\"more\"></a>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/JavaProcess.png\" alt=\"Java执行过程\"></p>\n<h2 id=\"1、JVM内存分布\"><a href=\"#1、JVM内存分布\" class=\"headerlink\" title=\"1、JVM内存分布\"></a>1、JVM内存分布</h2><p>通常我们说的JVM内存分布即指<strong>运行时数据区</strong>。下图为分布概念图：</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/RunningArea.png\" alt=\"运行时数据区\"></p>\n<h3 id=\"1-1-堆-Heap\"><a href=\"#1-1-堆-Heap\" class=\"headerlink\" title=\"1.1 堆(Heap)\"></a>1.1 堆(Heap)</h3><ul>\n<li>被所有线程共享的一块内存区域，在虚拟机启动时创建</li>\n<li>用来存贮对象实例</li>\n<li>可以通过-Xmx和-Xms控制堆的大小</li>\n<li><p>OutOfMemoryError异常：当在堆中没有内存完成实例分配，且堆也无法再扩展时</p>\n<p> Java堆是垃圾回收器的主要工作区域。由于现在垃圾收集器采用的基本都是<strong>分代收集算法</strong>，所以堆还可以细分为<strong>新生代(New/Young)</strong>和<strong>老年代(Old/Tenured)</strong>，再细致一点还有<strong>Eden</strong>区、<strong>From Survivior</strong>区、<strong>To Survivor</strong>区。</p>\n<p> <strong>新生代：</strong>新建的对象都由新生代分配内存。常常又被划分为Eden区和Survivor区，Eden空间不足时会把存活的对象转移到Survivor。新生代的大小可有-Xmn控制，也可用-XX:SurvivorRatio控制Eden和Survivor的比例。<br> <strong>老年代：</strong>存放经过多次垃圾回收仍然存活的对象。</p>\n</li>\n</ul>\n<h3 id=\"1-2-方法区-Method-Area\"><a href=\"#1-2-方法区-Method-Area\" class=\"headerlink\" title=\"1.2 方法区(Method Area)\"></a>1.2 方法区(Method Area)</h3><ul>\n<li>线程间共享</li>\n<li>用来存储已被虚拟机加载的类信息、常量、静态变量、即时编译器变异后的代码等数据</li>\n<li>OutOfMemoryError异常：当方法区无法满足内存的分配需求时</li>\n</ul>\n<p><strong>运行时常量池</strong>：</p>\n<ul>\n<li>方法区的一部分</li>\n<li>用于存放编译期生成的各种字面量和符号引用，如String类型常量就存放在常量池</li>\n<li>OutOfMemoryError异常：当常量池无法再申请到内存时</li>\n</ul>\n<h3 id=\"1-3-程序计数器-Program-Counter-Register\"><a href=\"#1-3-程序计数器-Program-Counter-Register\" class=\"headerlink\" title=\"1.3 程序计数器(Program Counter Register)\"></a>1.3 程序计数器(Program Counter Register)</h3><ul>\n<li>当前线程所执行的字节码的行号指示器</li>\n<li>当前线程私有</li>\n<li>不会出现OutOfMemoryError</li>\n<li>如果线程执行是一个Java方法的时候，计数器记录的是虚拟机字节码指令的地址；当执行的是Native的方法的时候，计数器指令为空</li>\n</ul>\n<h3 id=\"1-4-虚拟机栈-VM-Stack\"><a href=\"#1-4-虚拟机栈-VM-Stack\" class=\"headerlink\" title=\"1.4 虚拟机栈(VM Stack)\"></a>1.4 虚拟机栈(VM Stack)</h3><ul>\n<li>线程私有，生命周期与线程相同</li>\n<li>存储方法的局部变量表(局部变量、对象引用和返回地址等)、操作数栈、动态链接、方法出口等信息</li>\n<li>Java方法执行的呢内存模型，每个方法执行的同时都会创建一个栈帧，每一个方法被调用直至完成的过程，就对应着一个栈帧在虚拟机栈中从入栈到出栈的过程。</li>\n<li>StackOverflowError异常:当线程请求的栈深度大于虚拟机所允许的深度</li>\n<li><p>OutOfMemoryError异常：如果栈的扩展时无法申请到足够的内存</p>\n<p> JVM栈是线程私有的，每个线程创建的同时都会创建JVM栈。</p>\n<p> 这里解释一下局部变量表，局部变量表存储方法相关的局部变量，包括基本数据，对象引用和返回地址等。在局部变量表中，只有long和double类型会占用2个局部变量空间（Slot，对于32位机器，一个Slot就是32个bit），其它都是1个Slot。需要注意的是，局部变量表是在编译时就已经确定好的，方法运行所需要分配的空间在栈帧中是完全确定的，在方法的生命周期内都不会改变。</p>\n</li>\n</ul>\n<h3 id=\"1-5-本地方法栈-Native-Method-Stack\"><a href=\"#1-5-本地方法栈-Native-Method-Stack\" class=\"headerlink\" title=\"1.5 本地方法栈(Native Method Stack)\"></a>1.5 本地方法栈(Native Method Stack)</h3><p>与虚拟机栈类似，唯一的区别就是虚拟机栈是执行Java方法的，本地方法栈是执行native方法的。</p>\n<font color=\"red\"><strong>在HotSpot虚拟机中直接把本地方法栈与虚拟机栈二合一</strong></font>\n\n<h3 id=\"1-6-直接内存-Direct-Memory\"><a href=\"#1-6-直接内存-Direct-Memory\" class=\"headerlink\" title=\"1.6 直接内存(Direct Memory)\"></a>1.6 直接内存(Direct Memory)</h3><ul>\n<li>直接内存并不是虚拟机运行的一部分，也不是Java虚拟机规范中定义的内存区域，但是这部分内存也被频繁使用.</li>\n<li>NIO可以使用Native函数库直接分配堆外内存，堆中的DirectByteBuffer对象作为这块内存的引用进行操作</li>\n<li>大小不受Java堆大小的限制，受本机(服务器)内存限制</li>\n<li>OutOfMemoryError异常：系统内存不足时</li>\n</ul>\n<h3 id=\"1-7-永久代-PermGen-的发展\"><a href=\"#1-7-永久代-PermGen-的发展\" class=\"headerlink\" title=\"1.7 永久代(PermGen)的发展\"></a>1.7 永久代(PermGen)的发展</h3><p>方法区是JVM的规范，是一个逻辑存储区域。永久代是JVM规范的一种实现，并且永久代是HotSpot特有的。</p>\n<ul>\n<li>JDK 1.6<br> 永久代即方法区，存储着类信息、常量、静态变量、JIT编译的代码等</li>\n<li>JDK 1.7<br> 符号引用(Symbols)转移到了native heap；字面量(interned strings)转移到了java heap；类的静态变量(class statics)转移到了java heap</li>\n<li>JDK 1.8<br> 不存在永久代，取而代之的是元空间(MetaSpace)。不过元空间与永久代之间最大的区别在于：元空间并不在虚拟机中，而是使用本地内存。因此，默认情况下，元空间的大小仅受本地内存限制。</li>\n</ul>\n<p>那么，为什么要做出这些转变呢？有以下几点原因：</p>\n<ol>\n<li>字符串存在永久代中，容易出现性能问题和内存溢出。</li>\n<li>类及方法的信息等比较难确定其大小，因此对于永久代的大小指定比较困难，太小容易出现永久代溢出，太大则容易导致老年代溢出。</li>\n<li>永久代会为 GC 带来不必要的复杂度，并且回收效率偏低。</li>\n<li>Oracle 可能会将HotSpot 与 JRockit 合二为一。</li>\n</ol>\n<p>关于PermGen和Metaspace，可以看下<a href=\"http://www.cnblogs.com/paddix/p/5309550.html\" target=\"_blank\" rel=\"noopener\">liuxiaopeng的博客</a>。</p>\n<h3 id=\"1-8-小结\"><a href=\"#1-8-小结\" class=\"headerlink\" title=\"1.8 小结\"></a>1.8 小结</h3><p>Java对象实例存放在堆中；常量存放在方法区的常量池；虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据放在方法区；以上区域是所有线程共享的。栈是线程私有的，存放该方法的局部变量表(基本类型、对象引用)、操作数栈、动态链接、方法出口等信息。</p>\n<p>一个Java程序对应一个JVM，一个方法（线程）对应一个Java栈。</p>\n<h2 id=\"2、对象访问方式\"><a href=\"#2、对象访问方式\" class=\"headerlink\" title=\"2、对象访问方式\"></a>2、对象访问方式</h2><p>Java对象这里指的是引用类型的对象，这里用Student stu=new Student()为例子访问，Student stu作为引用对象，存在与Java虚拟机栈上，new Student()保存在Java堆中，堆中记录Student类型的信息包括方法，接口，对象类型等地址，这些类型的执行的数据存储在方法区中。</p>\n<h3 id=\"2-1-句柄访问\"><a href=\"#2-1-句柄访问\" class=\"headerlink\" title=\"2.1 句柄访问\"></a>2.1 句柄访问</h3><p>Java堆中分配一块句柄池，虚拟机栈中存放句柄池中的地址，句柄池中包括对象示例数据和对象类型数据的地址。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/HandleAccess.png\" alt=\"句柄访问\"></p>\n<h3 id=\"2-2-直接指针访问\"><a href=\"#2-2-直接指针访问\" class=\"headerlink\" title=\"2.2 直接指针访问\"></a>2.2 直接指针访问</h3><p>对象中存贮着对象实例数据和类数据的地址，Java栈的引用指向堆中的对象。</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/DirectPointerAccess.png\" alt=\"直接指针访问\"></p>\n<h3 id=\"2-3-小结\"><a href=\"#2-3-小结\" class=\"headerlink\" title=\"2.3 小结\"></a>2.3 小结</h3><p>这两种访问方式各有优势。</p>\n<p><strong>句柄访问：</strong> reference中存储的是稳定的句柄地址，在对象被移动（垃圾收集时移动对象是非常普遍的行为）时只会改变句柄中的实例数据指针，而reference本身是不需要修改的。</p>\n<p><strong>直接指针访问：</strong>最大的好处是速度快，节省了一次指针定位的时间开销。由于对象的访问在Java中非常的频繁，因此这类开销积少成多也是非常可观的执行成本。</p>\n<p>就HotSpot虚拟机来说，它采用的是直接指针访问。但从整个软件开发的范围来看，各种语言和框架使用句柄来访问的情况也是十分常见的。</p>\n<h2 id=\"3、哪些对象需要回收？\"><a href=\"#3、哪些对象需要回收？\" class=\"headerlink\" title=\"3、哪些对象需要回收？\"></a>3、哪些对象需要回收？</h2><p>Java运行时数据区的几大板块中，程序计数器、虚拟机栈、本地方法栈3个区域随着线程而生，随着线程而灭，因此这几个区域的内存分配和回收都具备确定性，在这3个区域不需要过多的考虑GC问题。而堆和方法区则不一样，我们只有在程序运行期间才能知道会创建哪些对象、占用多少内存，这部分内存的分配和回收都是动态的，垃圾收集器关注的也正是这部分内存。</p>\n<p>堆中存放着几乎所有的对象实例，在垃圾收集之前，需要判断哪些对象需要被除了，即哪些对象“存活”着，哪些对象已经“死去”。</p>\n<h3 id=\"3-1-引用计数算法\"><a href=\"#3-1-引用计数算法\" class=\"headerlink\" title=\"3.1 引用计数算法\"></a>3.1 引用计数算法</h3><p>给对象中添加一个引用计数器，每当有一个地方引用该对象，计数器值就加1，当引用失效时,引用就减1。任何时刻计数器为0的对象就是不可能再被使用的。</p>\n<p>缺陷：很难解决象之间互相循环引用的问题。</p>\n<h3 id=\"3-2-可达性算法\"><a href=\"#3-2-可达性算法\" class=\"headerlink\" title=\"3.2 可达性算法\"></a>3.2 可达性算法</h3><p>主流语言(Java、C#)的主流实现，都是通过可达性算法判断对象是否存活。</p>\n<p>基本思路：通过一系列成为”GC Roots”的对象作为起始点，当一个对象到GC Roots没有任何引用链相连时，则证明此对象不可达，所以它们就会被判定为可回收对象。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/ReachabilityAnalysis.png\" alt=\"可达性算法\"></p>\n<p>在Java中，可作为GC Roots的对象包括下面几种：</p>\n<ul>\n<li>虚拟机栈（栈帧中的本地变量表）中引用的对象</li>\n<li>方法区中类静态属性引用的对象</li>\n<li>方法区中常量引用的对象</li>\n<li>本地方法栈JNI（即一般说的Native方法）引用的对象</li>\n</ul>\n<h3 id=\"3-3-再谈引用\"><a href=\"#3-3-再谈引用\" class=\"headerlink\" title=\"3.3 再谈引用\"></a>3.3 再谈引用</h3><p>在JDK1.2以前，Java中的引用定义很传统：如果reference类型的数据中存储的数值代表着另一块内存的起始地址，就称这块内存代表着一个引用。这种定义很纯粹，但很狭隘，在这种定义下，对象只存在被引用和没有被引用两种状态。我们希望描述这样一类对象：当空间内存足够时，则保留在内存中；如果内存在GC后还非常紧张，则可以抛弃这些对象。很多系统的缓存都符合这种引用场景。</p>\n<p>在JDK1.之后，Java对引用概念进行了扩充，分为强引用(Strong Reference)、软引用(Soft Reference)、弱引用(Weak Reference)、虚引用(Phantom Reference)，强度依次递减。</p>\n<ul>\n<li>强引用：类似Object obj = new Object()，只要强引用还在，则不会被GC</li>\n<li>软引用：描述一些还有用但非必须的对象。在系统将要发生内存溢出异常前，将会把这些软引用对象列进回收范围之中进行第二次回收，如果这次回收还没有足够的内存，才会抛出内存溢出异常。</li>\n<li>弱引用：也是描述一些非必须对象，但强度比软引用更弱一些。这些对象只能存活到下一次GC之前。当开始GC时，无论内存是否足够，这些对象都会被回收。</li>\n<li>虚引用：不影响GC，唯一目的是被虚引用关联的对象被GC时能收到一个系统通知。</li>\n</ul>\n<h3 id=\"3-4-生存还是死亡\"><a href=\"#3-4-生存还是死亡\" class=\"headerlink\" title=\"3.4 生存还是死亡\"></a>3.4 生存还是死亡</h3><p>即使在可达性分析算法中不可达的对象，也并不是“非死不可”，这时候他们处于缓刑状态，要真正宣布一个对象死亡，至少需要经过两次标记过程：</p>\n<ol>\n<li><p>可达性分析后没有与GC Roots相连的引用链，它会被第一次标记并且进行一次筛选。</p>\n<p>筛选条件是是否有必要执行finalize()方法。如果没有覆盖finalize()方法，或者finalize()已经被虚拟机调用过，这两种情况都被视为“没有必要执行”。<br>如果判定为有必要执行finalize()方法，该对象被放置在一个F-Queue的队列中，并稍后由虚拟机建立的低优先级Finalizer线程去执行他，也就是触发对象的finalize()方法。finalize()是对象逃脱死亡的最后一次机会。</p>\n</li>\n<li><p>稍后GC将对F-Queue中的对象进行第二次小规模标记</p>\n<p>如果对象在finalize()中成功拯救自己——只要重新与引用链上的任何一个对象建立关联即可，那么第二次标记时它将被移出“即将回收”的集合；如果第二次标记时还没有逃脱，那它基本上就真的会被回收了。</p>\n</li>\n</ol>\n<h3 id=\"3-5-回收方法区\"><a href=\"#3-5-回收方法区\" class=\"headerlink\" title=\"3.5 回收方法区\"></a>3.5 回收方法区</h3><p>方法区（或者HotSpot中的永久代）主要回收两部分：废弃常量和无用的类。</p>\n<ol>\n<li><p>废弃常量</p>\n<p>如果没有任何一个地方引用常量，在GC时如果有必要的话，该常量会被清理出常量池。常量池中的类（接口）、方法、字段的符号引用也是类似的。</p>\n</li>\n<li><p>无用的类</p>\n<p>卸载类就很麻烦了，必须同时满足3个条件：</p>\n<ul>\n<li>该类所有实例都已被回收</li>\n<li>加载该类的ClassLoader已经被会后</li>\n<li>该类对应的Class对象没有在任何地方呗引用，无法通过反射访问该类的方法</li>\n</ul>\n<p>满足以上条件也只是可以被回收，是否被回收，HotSpot还有其他方法来控制。</p>\n</li>\n</ol>\n<h2 id=\"4、何时回收？\"><a href=\"#4、何时回收？\" class=\"headerlink\" title=\"4、何时回收？\"></a>4、何时回收？</h2><p>GC经常发生的区域是堆区，堆区还可以细分为新生代、老年代，新生代还分为一个Eden区和两个Survivor区。</p>\n<ol>\n<li>对象优先在Eden中分配，当Eden中没有足够空间时，虚拟机将发生一次Minor GC，Minor GC非常频繁，而且速度也很快；</li>\n<li>Full GC，发生在老年代的GC，当老年代没有足够的空间时即发生Full GC，发生Full GC一般都会有一次Minor GC。</li>\n<li>JDK 6 Update 24之后,HandlePromotionFailure无效。只要老年代剩余连续空间大于新生代对象总和或者历次晋升的平均大小就会进行Minor GC，否则Full GC。<br><del>发生Minor GC时，虚拟机会检测之前每次晋升到老年代的平均大小是否大于老年代的剩余空间大小，如果大于，则进行一次Full GC，如果小于，则查看是否允许担保失败(HandlePromotionFailure=true/false)，如果允许，那只会进行一次Minor GC，如果不允许，则改为进行一次Full GC。</del></li>\n</ol>\n<h2 id=\"5、如何回收？\"><a href=\"#5、如何回收？\" class=\"headerlink\" title=\"5、如何回收？\"></a>5、如何回收？</h2><p>简单描述几种算法的思路及演变过程</p>\n<h3 id=\"5-1-标记——清除算法\"><a href=\"#5-1-标记——清除算法\" class=\"headerlink\" title=\"5.1 标记——清除算法\"></a>5.1 标记——清除算法</h3><p>分为“标记”和“清除”两个阶段：</p>\n<ul>\n<li>标记：即前面提到过的，GC时两次标记的过程。</li>\n<li>清除：统一回收被标记的对象</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>效率不高：标记和清除的过程效率都不高</li>\n<li>产生大量内存碎片：导致以后分配较大内存对象时，由于没有足够大的连续内存从而提前触发一次GC动作。</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/mark-sweep.png\" alt=\"标记——清除算法\"></p>\n<h3 id=\"5-2-复制算法\"><a href=\"#5-2-复制算法\" class=\"headerlink\" title=\"5.2 复制算法\"></a>5.2 复制算法</h3><p>为了解决效率问题，出现了复制算法。将可用内存分为大小相等的两块，每次只是用其中一块。当这一块用完，将还存活的复制到另一块，然后再把使用过的内存空间一次清理掉，循环往复。</p>\n<ul>\n<li>优点：不用考虑内存碎片，实现简单，运行高效</li>\n<li>缺点：<ul>\n<li>内存缩小为原来的一半，代价太大；</li>\n<li>需要额外的老年代空间进行分配担保</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/copy.png\" alt=\"复制算法\"></p>\n<h3 id=\"5-3-标记——整理算法\"><a href=\"#5-3-标记——整理算法\" class=\"headerlink\" title=\"5.3 标记——整理算法\"></a>5.3 标记——整理算法</h3><p>分为“标记”和“整理”两个阶段：</p>\n<ul>\n<li>标记：即前面提到过的，GC时两次标记的过程。</li>\n<li>整理：让所有存活的对象都向一端移动，然后清理掉端边界以外的内存。</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/mark-compact.png\" alt=\"此处输入图片的描述\"></p>\n<h3 id=\"5-4-分代收集算法\"><a href=\"#5-4-分代收集算法\" class=\"headerlink\" title=\"5.4 分代收集算法\"></a>5.4 分代收集算法</h3><p>当前商业虚拟机的垃圾收集都采用“分代收集算法”。</p>\n<p>对于HotSpot虚拟机，堆内存分布如下图所示：</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/generationalCollection.png\" alt=\"分代收集算法下的堆内存分布\">  </p>\n<p>新生代中使用 <strong>复制算法</strong>，老年代使用 <strong>标记——整理算法</strong></p>\n<p>默认情况下，eden与survivor的大小比例是8:1,可由 -XX：SurvivorRatio=8 设置。所以可用新生代大小为新生代的90%。</p>\n<p>以下是算法的基本思路：</p>\n<ol>\n<li>对象新建时，首先会在Eden区创建，年龄为0，直到GC时，若没有消亡，则放入servivor区，年龄为1</li>\n<li>进入survivor区也不是安全的，当下一次Minor GC来的时候，会检查Eden区和使用的Survivor区，若有对象存活，则放入另一个Survivor区，年龄加1</li>\n<li>当两个Survivor区切换几次后，对象年龄增长到15(默认，-XX:MaxTenuringThreshold=15)，则进入老年代。</li>\n<li>进入老年代也不是安全的，当老年代空间不足时，触发Major GC，已经消亡的对象还是会被干掉。</li>\n</ol>\n<p>推荐一个这个写的很逗可以看下：<a href=\"http://blog.csdn.net/sd4015700/article/details/50109939\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/sd4015700/article/details/50109939</a></p>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>Java虚拟机是Java程序运行的真实环境，要深入理解Java是如何运行的，理解Java虚拟机是必不可少的。典型的例子：内存溢出。当我们理解java虚拟机之后，我们就会明白为何会出现这个问题，我们又当如何去定位并解决这个问题。</p>","more":"<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/JavaProcess.png\" alt=\"Java执行过程\"></p>\n<h2 id=\"1、JVM内存分布\"><a href=\"#1、JVM内存分布\" class=\"headerlink\" title=\"1、JVM内存分布\"></a>1、JVM内存分布</h2><p>通常我们说的JVM内存分布即指<strong>运行时数据区</strong>。下图为分布概念图：</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/RunningArea.png\" alt=\"运行时数据区\"></p>\n<h3 id=\"1-1-堆-Heap\"><a href=\"#1-1-堆-Heap\" class=\"headerlink\" title=\"1.1 堆(Heap)\"></a>1.1 堆(Heap)</h3><ul>\n<li>被所有线程共享的一块内存区域，在虚拟机启动时创建</li>\n<li>用来存贮对象实例</li>\n<li>可以通过-Xmx和-Xms控制堆的大小</li>\n<li><p>OutOfMemoryError异常：当在堆中没有内存完成实例分配，且堆也无法再扩展时</p>\n<p> Java堆是垃圾回收器的主要工作区域。由于现在垃圾收集器采用的基本都是<strong>分代收集算法</strong>，所以堆还可以细分为<strong>新生代(New/Young)</strong>和<strong>老年代(Old/Tenured)</strong>，再细致一点还有<strong>Eden</strong>区、<strong>From Survivior</strong>区、<strong>To Survivor</strong>区。</p>\n<p> <strong>新生代：</strong>新建的对象都由新生代分配内存。常常又被划分为Eden区和Survivor区，Eden空间不足时会把存活的对象转移到Survivor。新生代的大小可有-Xmn控制，也可用-XX:SurvivorRatio控制Eden和Survivor的比例。<br> <strong>老年代：</strong>存放经过多次垃圾回收仍然存活的对象。</p>\n</li>\n</ul>\n<h3 id=\"1-2-方法区-Method-Area\"><a href=\"#1-2-方法区-Method-Area\" class=\"headerlink\" title=\"1.2 方法区(Method Area)\"></a>1.2 方法区(Method Area)</h3><ul>\n<li>线程间共享</li>\n<li>用来存储已被虚拟机加载的类信息、常量、静态变量、即时编译器变异后的代码等数据</li>\n<li>OutOfMemoryError异常：当方法区无法满足内存的分配需求时</li>\n</ul>\n<p><strong>运行时常量池</strong>：</p>\n<ul>\n<li>方法区的一部分</li>\n<li>用于存放编译期生成的各种字面量和符号引用，如String类型常量就存放在常量池</li>\n<li>OutOfMemoryError异常：当常量池无法再申请到内存时</li>\n</ul>\n<h3 id=\"1-3-程序计数器-Program-Counter-Register\"><a href=\"#1-3-程序计数器-Program-Counter-Register\" class=\"headerlink\" title=\"1.3 程序计数器(Program Counter Register)\"></a>1.3 程序计数器(Program Counter Register)</h3><ul>\n<li>当前线程所执行的字节码的行号指示器</li>\n<li>当前线程私有</li>\n<li>不会出现OutOfMemoryError</li>\n<li>如果线程执行是一个Java方法的时候，计数器记录的是虚拟机字节码指令的地址；当执行的是Native的方法的时候，计数器指令为空</li>\n</ul>\n<h3 id=\"1-4-虚拟机栈-VM-Stack\"><a href=\"#1-4-虚拟机栈-VM-Stack\" class=\"headerlink\" title=\"1.4 虚拟机栈(VM Stack)\"></a>1.4 虚拟机栈(VM Stack)</h3><ul>\n<li>线程私有，生命周期与线程相同</li>\n<li>存储方法的局部变量表(局部变量、对象引用和返回地址等)、操作数栈、动态链接、方法出口等信息</li>\n<li>Java方法执行的呢内存模型，每个方法执行的同时都会创建一个栈帧，每一个方法被调用直至完成的过程，就对应着一个栈帧在虚拟机栈中从入栈到出栈的过程。</li>\n<li>StackOverflowError异常:当线程请求的栈深度大于虚拟机所允许的深度</li>\n<li><p>OutOfMemoryError异常：如果栈的扩展时无法申请到足够的内存</p>\n<p> JVM栈是线程私有的，每个线程创建的同时都会创建JVM栈。</p>\n<p> 这里解释一下局部变量表，局部变量表存储方法相关的局部变量，包括基本数据，对象引用和返回地址等。在局部变量表中，只有long和double类型会占用2个局部变量空间（Slot，对于32位机器，一个Slot就是32个bit），其它都是1个Slot。需要注意的是，局部变量表是在编译时就已经确定好的，方法运行所需要分配的空间在栈帧中是完全确定的，在方法的生命周期内都不会改变。</p>\n</li>\n</ul>\n<h3 id=\"1-5-本地方法栈-Native-Method-Stack\"><a href=\"#1-5-本地方法栈-Native-Method-Stack\" class=\"headerlink\" title=\"1.5 本地方法栈(Native Method Stack)\"></a>1.5 本地方法栈(Native Method Stack)</h3><p>与虚拟机栈类似，唯一的区别就是虚拟机栈是执行Java方法的，本地方法栈是执行native方法的。</p>\n<font color=\"red\"><strong>在HotSpot虚拟机中直接把本地方法栈与虚拟机栈二合一</strong></font>\n\n<h3 id=\"1-6-直接内存-Direct-Memory\"><a href=\"#1-6-直接内存-Direct-Memory\" class=\"headerlink\" title=\"1.6 直接内存(Direct Memory)\"></a>1.6 直接内存(Direct Memory)</h3><ul>\n<li>直接内存并不是虚拟机运行的一部分，也不是Java虚拟机规范中定义的内存区域，但是这部分内存也被频繁使用.</li>\n<li>NIO可以使用Native函数库直接分配堆外内存，堆中的DirectByteBuffer对象作为这块内存的引用进行操作</li>\n<li>大小不受Java堆大小的限制，受本机(服务器)内存限制</li>\n<li>OutOfMemoryError异常：系统内存不足时</li>\n</ul>\n<h3 id=\"1-7-永久代-PermGen-的发展\"><a href=\"#1-7-永久代-PermGen-的发展\" class=\"headerlink\" title=\"1.7 永久代(PermGen)的发展\"></a>1.7 永久代(PermGen)的发展</h3><p>方法区是JVM的规范，是一个逻辑存储区域。永久代是JVM规范的一种实现，并且永久代是HotSpot特有的。</p>\n<ul>\n<li>JDK 1.6<br> 永久代即方法区，存储着类信息、常量、静态变量、JIT编译的代码等</li>\n<li>JDK 1.7<br> 符号引用(Symbols)转移到了native heap；字面量(interned strings)转移到了java heap；类的静态变量(class statics)转移到了java heap</li>\n<li>JDK 1.8<br> 不存在永久代，取而代之的是元空间(MetaSpace)。不过元空间与永久代之间最大的区别在于：元空间并不在虚拟机中，而是使用本地内存。因此，默认情况下，元空间的大小仅受本地内存限制。</li>\n</ul>\n<p>那么，为什么要做出这些转变呢？有以下几点原因：</p>\n<ol>\n<li>字符串存在永久代中，容易出现性能问题和内存溢出。</li>\n<li>类及方法的信息等比较难确定其大小，因此对于永久代的大小指定比较困难，太小容易出现永久代溢出，太大则容易导致老年代溢出。</li>\n<li>永久代会为 GC 带来不必要的复杂度，并且回收效率偏低。</li>\n<li>Oracle 可能会将HotSpot 与 JRockit 合二为一。</li>\n</ol>\n<p>关于PermGen和Metaspace，可以看下<a href=\"http://www.cnblogs.com/paddix/p/5309550.html\" target=\"_blank\" rel=\"noopener\">liuxiaopeng的博客</a>。</p>\n<h3 id=\"1-8-小结\"><a href=\"#1-8-小结\" class=\"headerlink\" title=\"1.8 小结\"></a>1.8 小结</h3><p>Java对象实例存放在堆中；常量存放在方法区的常量池；虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据放在方法区；以上区域是所有线程共享的。栈是线程私有的，存放该方法的局部变量表(基本类型、对象引用)、操作数栈、动态链接、方法出口等信息。</p>\n<p>一个Java程序对应一个JVM，一个方法（线程）对应一个Java栈。</p>\n<h2 id=\"2、对象访问方式\"><a href=\"#2、对象访问方式\" class=\"headerlink\" title=\"2、对象访问方式\"></a>2、对象访问方式</h2><p>Java对象这里指的是引用类型的对象，这里用Student stu=new Student()为例子访问，Student stu作为引用对象，存在与Java虚拟机栈上，new Student()保存在Java堆中，堆中记录Student类型的信息包括方法，接口，对象类型等地址，这些类型的执行的数据存储在方法区中。</p>\n<h3 id=\"2-1-句柄访问\"><a href=\"#2-1-句柄访问\" class=\"headerlink\" title=\"2.1 句柄访问\"></a>2.1 句柄访问</h3><p>Java堆中分配一块句柄池，虚拟机栈中存放句柄池中的地址，句柄池中包括对象示例数据和对象类型数据的地址。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/HandleAccess.png\" alt=\"句柄访问\"></p>\n<h3 id=\"2-2-直接指针访问\"><a href=\"#2-2-直接指针访问\" class=\"headerlink\" title=\"2.2 直接指针访问\"></a>2.2 直接指针访问</h3><p>对象中存贮着对象实例数据和类数据的地址，Java栈的引用指向堆中的对象。</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/DirectPointerAccess.png\" alt=\"直接指针访问\"></p>\n<h3 id=\"2-3-小结\"><a href=\"#2-3-小结\" class=\"headerlink\" title=\"2.3 小结\"></a>2.3 小结</h3><p>这两种访问方式各有优势。</p>\n<p><strong>句柄访问：</strong> reference中存储的是稳定的句柄地址，在对象被移动（垃圾收集时移动对象是非常普遍的行为）时只会改变句柄中的实例数据指针，而reference本身是不需要修改的。</p>\n<p><strong>直接指针访问：</strong>最大的好处是速度快，节省了一次指针定位的时间开销。由于对象的访问在Java中非常的频繁，因此这类开销积少成多也是非常可观的执行成本。</p>\n<p>就HotSpot虚拟机来说，它采用的是直接指针访问。但从整个软件开发的范围来看，各种语言和框架使用句柄来访问的情况也是十分常见的。</p>\n<h2 id=\"3、哪些对象需要回收？\"><a href=\"#3、哪些对象需要回收？\" class=\"headerlink\" title=\"3、哪些对象需要回收？\"></a>3、哪些对象需要回收？</h2><p>Java运行时数据区的几大板块中，程序计数器、虚拟机栈、本地方法栈3个区域随着线程而生，随着线程而灭，因此这几个区域的内存分配和回收都具备确定性，在这3个区域不需要过多的考虑GC问题。而堆和方法区则不一样，我们只有在程序运行期间才能知道会创建哪些对象、占用多少内存，这部分内存的分配和回收都是动态的，垃圾收集器关注的也正是这部分内存。</p>\n<p>堆中存放着几乎所有的对象实例，在垃圾收集之前，需要判断哪些对象需要被除了，即哪些对象“存活”着，哪些对象已经“死去”。</p>\n<h3 id=\"3-1-引用计数算法\"><a href=\"#3-1-引用计数算法\" class=\"headerlink\" title=\"3.1 引用计数算法\"></a>3.1 引用计数算法</h3><p>给对象中添加一个引用计数器，每当有一个地方引用该对象，计数器值就加1，当引用失效时,引用就减1。任何时刻计数器为0的对象就是不可能再被使用的。</p>\n<p>缺陷：很难解决象之间互相循环引用的问题。</p>\n<h3 id=\"3-2-可达性算法\"><a href=\"#3-2-可达性算法\" class=\"headerlink\" title=\"3.2 可达性算法\"></a>3.2 可达性算法</h3><p>主流语言(Java、C#)的主流实现，都是通过可达性算法判断对象是否存活。</p>\n<p>基本思路：通过一系列成为”GC Roots”的对象作为起始点，当一个对象到GC Roots没有任何引用链相连时，则证明此对象不可达，所以它们就会被判定为可回收对象。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/ReachabilityAnalysis.png\" alt=\"可达性算法\"></p>\n<p>在Java中，可作为GC Roots的对象包括下面几种：</p>\n<ul>\n<li>虚拟机栈（栈帧中的本地变量表）中引用的对象</li>\n<li>方法区中类静态属性引用的对象</li>\n<li>方法区中常量引用的对象</li>\n<li>本地方法栈JNI（即一般说的Native方法）引用的对象</li>\n</ul>\n<h3 id=\"3-3-再谈引用\"><a href=\"#3-3-再谈引用\" class=\"headerlink\" title=\"3.3 再谈引用\"></a>3.3 再谈引用</h3><p>在JDK1.2以前，Java中的引用定义很传统：如果reference类型的数据中存储的数值代表着另一块内存的起始地址，就称这块内存代表着一个引用。这种定义很纯粹，但很狭隘，在这种定义下，对象只存在被引用和没有被引用两种状态。我们希望描述这样一类对象：当空间内存足够时，则保留在内存中；如果内存在GC后还非常紧张，则可以抛弃这些对象。很多系统的缓存都符合这种引用场景。</p>\n<p>在JDK1.之后，Java对引用概念进行了扩充，分为强引用(Strong Reference)、软引用(Soft Reference)、弱引用(Weak Reference)、虚引用(Phantom Reference)，强度依次递减。</p>\n<ul>\n<li>强引用：类似Object obj = new Object()，只要强引用还在，则不会被GC</li>\n<li>软引用：描述一些还有用但非必须的对象。在系统将要发生内存溢出异常前，将会把这些软引用对象列进回收范围之中进行第二次回收，如果这次回收还没有足够的内存，才会抛出内存溢出异常。</li>\n<li>弱引用：也是描述一些非必须对象，但强度比软引用更弱一些。这些对象只能存活到下一次GC之前。当开始GC时，无论内存是否足够，这些对象都会被回收。</li>\n<li>虚引用：不影响GC，唯一目的是被虚引用关联的对象被GC时能收到一个系统通知。</li>\n</ul>\n<h3 id=\"3-4-生存还是死亡\"><a href=\"#3-4-生存还是死亡\" class=\"headerlink\" title=\"3.4 生存还是死亡\"></a>3.4 生存还是死亡</h3><p>即使在可达性分析算法中不可达的对象，也并不是“非死不可”，这时候他们处于缓刑状态，要真正宣布一个对象死亡，至少需要经过两次标记过程：</p>\n<ol>\n<li><p>可达性分析后没有与GC Roots相连的引用链，它会被第一次标记并且进行一次筛选。</p>\n<p>筛选条件是是否有必要执行finalize()方法。如果没有覆盖finalize()方法，或者finalize()已经被虚拟机调用过，这两种情况都被视为“没有必要执行”。<br>如果判定为有必要执行finalize()方法，该对象被放置在一个F-Queue的队列中，并稍后由虚拟机建立的低优先级Finalizer线程去执行他，也就是触发对象的finalize()方法。finalize()是对象逃脱死亡的最后一次机会。</p>\n</li>\n<li><p>稍后GC将对F-Queue中的对象进行第二次小规模标记</p>\n<p>如果对象在finalize()中成功拯救自己——只要重新与引用链上的任何一个对象建立关联即可，那么第二次标记时它将被移出“即将回收”的集合；如果第二次标记时还没有逃脱，那它基本上就真的会被回收了。</p>\n</li>\n</ol>\n<h3 id=\"3-5-回收方法区\"><a href=\"#3-5-回收方法区\" class=\"headerlink\" title=\"3.5 回收方法区\"></a>3.5 回收方法区</h3><p>方法区（或者HotSpot中的永久代）主要回收两部分：废弃常量和无用的类。</p>\n<ol>\n<li><p>废弃常量</p>\n<p>如果没有任何一个地方引用常量，在GC时如果有必要的话，该常量会被清理出常量池。常量池中的类（接口）、方法、字段的符号引用也是类似的。</p>\n</li>\n<li><p>无用的类</p>\n<p>卸载类就很麻烦了，必须同时满足3个条件：</p>\n<ul>\n<li>该类所有实例都已被回收</li>\n<li>加载该类的ClassLoader已经被会后</li>\n<li>该类对应的Class对象没有在任何地方呗引用，无法通过反射访问该类的方法</li>\n</ul>\n<p>满足以上条件也只是可以被回收，是否被回收，HotSpot还有其他方法来控制。</p>\n</li>\n</ol>\n<h2 id=\"4、何时回收？\"><a href=\"#4、何时回收？\" class=\"headerlink\" title=\"4、何时回收？\"></a>4、何时回收？</h2><p>GC经常发生的区域是堆区，堆区还可以细分为新生代、老年代，新生代还分为一个Eden区和两个Survivor区。</p>\n<ol>\n<li>对象优先在Eden中分配，当Eden中没有足够空间时，虚拟机将发生一次Minor GC，Minor GC非常频繁，而且速度也很快；</li>\n<li>Full GC，发生在老年代的GC，当老年代没有足够的空间时即发生Full GC，发生Full GC一般都会有一次Minor GC。</li>\n<li>JDK 6 Update 24之后,HandlePromotionFailure无效。只要老年代剩余连续空间大于新生代对象总和或者历次晋升的平均大小就会进行Minor GC，否则Full GC。<br><del>发生Minor GC时，虚拟机会检测之前每次晋升到老年代的平均大小是否大于老年代的剩余空间大小，如果大于，则进行一次Full GC，如果小于，则查看是否允许担保失败(HandlePromotionFailure=true/false)，如果允许，那只会进行一次Minor GC，如果不允许，则改为进行一次Full GC。</del></li>\n</ol>\n<h2 id=\"5、如何回收？\"><a href=\"#5、如何回收？\" class=\"headerlink\" title=\"5、如何回收？\"></a>5、如何回收？</h2><p>简单描述几种算法的思路及演变过程</p>\n<h3 id=\"5-1-标记——清除算法\"><a href=\"#5-1-标记——清除算法\" class=\"headerlink\" title=\"5.1 标记——清除算法\"></a>5.1 标记——清除算法</h3><p>分为“标记”和“清除”两个阶段：</p>\n<ul>\n<li>标记：即前面提到过的，GC时两次标记的过程。</li>\n<li>清除：统一回收被标记的对象</li>\n</ul>\n<p>缺点：</p>\n<ul>\n<li>效率不高：标记和清除的过程效率都不高</li>\n<li>产生大量内存碎片：导致以后分配较大内存对象时，由于没有足够大的连续内存从而提前触发一次GC动作。</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/mark-sweep.png\" alt=\"标记——清除算法\"></p>\n<h3 id=\"5-2-复制算法\"><a href=\"#5-2-复制算法\" class=\"headerlink\" title=\"5.2 复制算法\"></a>5.2 复制算法</h3><p>为了解决效率问题，出现了复制算法。将可用内存分为大小相等的两块，每次只是用其中一块。当这一块用完，将还存活的复制到另一块，然后再把使用过的内存空间一次清理掉，循环往复。</p>\n<ul>\n<li>优点：不用考虑内存碎片，实现简单，运行高效</li>\n<li>缺点：<ul>\n<li>内存缩小为原来的一半，代价太大；</li>\n<li>需要额外的老年代空间进行分配担保</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/copy.png\" alt=\"复制算法\"></p>\n<h3 id=\"5-3-标记——整理算法\"><a href=\"#5-3-标记——整理算法\" class=\"headerlink\" title=\"5.3 标记——整理算法\"></a>5.3 标记——整理算法</h3><p>分为“标记”和“整理”两个阶段：</p>\n<ul>\n<li>标记：即前面提到过的，GC时两次标记的过程。</li>\n<li>整理：让所有存活的对象都向一端移动，然后清理掉端边界以外的内存。</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/mark-compact.png\" alt=\"此处输入图片的描述\"></p>\n<h3 id=\"5-4-分代收集算法\"><a href=\"#5-4-分代收集算法\" class=\"headerlink\" title=\"5.4 分代收集算法\"></a>5.4 分代收集算法</h3><p>当前商业虚拟机的垃圾收集都采用“分代收集算法”。</p>\n<p>对于HotSpot虚拟机，堆内存分布如下图所示：</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/generationalCollection.png\" alt=\"分代收集算法下的堆内存分布\">  </p>\n<p>新生代中使用 <strong>复制算法</strong>，老年代使用 <strong>标记——整理算法</strong></p>\n<p>默认情况下，eden与survivor的大小比例是8:1,可由 -XX：SurvivorRatio=8 设置。所以可用新生代大小为新生代的90%。</p>\n<p>以下是算法的基本思路：</p>\n<ol>\n<li>对象新建时，首先会在Eden区创建，年龄为0，直到GC时，若没有消亡，则放入servivor区，年龄为1</li>\n<li>进入survivor区也不是安全的，当下一次Minor GC来的时候，会检查Eden区和使用的Survivor区，若有对象存活，则放入另一个Survivor区，年龄加1</li>\n<li>当两个Survivor区切换几次后，对象年龄增长到15(默认，-XX:MaxTenuringThreshold=15)，则进入老年代。</li>\n<li>进入老年代也不是安全的，当老年代空间不足时，触发Major GC，已经消亡的对象还是会被干掉。</li>\n</ol>\n<p>推荐一个这个写的很逗可以看下：<a href=\"http://blog.csdn.net/sd4015700/article/details/50109939\" target=\"_blank\" rel=\"noopener\">http://blog.csdn.net/sd4015700/article/details/50109939</a></p>"},{"title":"Java虚拟机：类加载器","keyword":["Java虚拟机","类加载器","双亲委派"],"date":"2018-04-23T09:11:37.000Z","_content":"\n虚拟机把描述类的数据从Class字节码文件加载到内存，并对数据进行校验、转换解析和初始化，最终形成可以被虚拟机直接使用的Java类型，这就是虚拟机的类加载机制。\n\n<!--more-->\n\n## 1、类加载的时机\n\n类从被加载到虚拟机内存中开始，到卸载出内存为止，它的整个生命周期包括：加载(Loading)、验证、准备、解析、初始化、使用、卸载7个阶段，其中验证、准备、解析3个部分统称为连接，发生顺序如下图所示：\n![类的生命周期][1]\n\n加载、验证、准备、初始化、卸载这5个阶段的顺序是固定的，而解析则不一定：它在某些情况下可以在初始化之后再开始，这是为了支持Java的运行时绑定(也成动态绑定或晚期绑定)。\n\n那么何时开始第一阶段加载呢？虚拟机规范没有强制约束，由虚拟机具体实现自由把握。\n但初始化阶段，有且仅有5种情况必须立即初始化：\n\n 1. 遇到new、getstatic、putstatic、invokestatic这4条字节码指令时，如果类没有进行过初始化，则需要先触发其初始化。生成这四条指令的最常见的Java代码场景:使用new关键字实例化对象的时候、读取或设置一个类的静态字段（被final修饰、已在编译期放入常量池的静态字段除外）的时候，以及调用一个类的静态方法的时候。\n 2. 使用java.lang.reflect包的方法对类进行反射调用时，如果类没有初始化，则需先触发其初始化。\n 3. 当初始化一个类时，若其父类还没有进行初始化，则需要先触发其父类初始化。\n 4. 当虚拟机启动时，用户需要指定一个要执行的主类，虚拟机会先初始化这个主类。\n 5. 当使用JDK1.7的动态语言支持时，如果一个java.lang.invoke.MethodHandle实例最后的解析结果是REF_getStatic、REF_putStatic、REF_invokeStatic的方法句柄，并且这个方法句柄对应的类没有初始化，则需要先触发其初始化。\n\n## 2、类加载器\n\n虚拟机团队吧类加载阶段中的“通过一个类的全限定名来获取描述此类的二进制字节流”这个动作放到Java虚拟机外部去实现，以便让应用程序自己决定如何去获取所需要的类。实现这个动作的代码模块称为“类加载器”。\n\n类加载器虽然只用于实现类的加载动作，但它的作用却远远不限于类加载阶段。对于任意一个类，都需要由加载它的类加载器和这个类本身一同确立其在Java虚拟机中的唯一性，每一个类加载器，都有一个独立的命名空间。也就是说：比较两个类是否“相等”，只有在这两个类由同一个类加载器加载的前提下才有意义，否则，即使是来源于同一个Class文件，被同一个JVM加载，只要加载它们的类加载器不同，那么这两个类就必不相等。\n\n\n**类加载器的分类：**\n\n 1. 启动类加载器(Bootstrap ClassLoader):负责加载<JAVA_HOME>\\lib目录中的，或者被-Xbootclasspath参数所指定的路径中的能被识别的类库。\n 2. 扩展类加载器(Extension ClassLoader):负责加载<JAVA_HOME>\\lib\\ext目录中的，或者被java.ext.dirs系统变量所指定的路径中的所有类库，开发者可以直接使用该加载器。\n 3. 应用程序加载器(Application ClassLoader):由ClassLoader中的getSystemClassLoader()方法获得，负责加载用户路径(classpath)上的类库。若果没有自定义加载器，一般情况下这就是程序的默认类加载器。\n\n\n**双亲委派机制：**\n\n ![此处输入图片的描述][2]\n  \n除启动类加载器外，器与类加载器都应有自己的父类。\n\n若果一个类收到类加载的请求，它首先不会自己去加载，而是委派给父类加载器去完成，依次往上，因此所有的加载请求最终都会传递到顶层的启动类加载器。只有当父类反馈自己无法加载，子类才会尝试去加载。\n\n这样做的好处：\n    使类加载器具备了优先级的层次关系，保证了同一个类始终是由同一个类加载器完成加载。\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/ClassLife.jpg\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/ParentsDelegationModel.jpg","source":"_posts/Java虚拟机：类加载器.md","raw":"---\ntitle: Java虚拟机：类加载器\ncategories:\n  - Java虚拟机\ntags:\n  - Java虚拟机\nkeyword:\n  - Java虚拟机\n  - 类加载器\n  - 双亲委派\ndate: 2018-04-23 17:11:37\n---\n\n虚拟机把描述类的数据从Class字节码文件加载到内存，并对数据进行校验、转换解析和初始化，最终形成可以被虚拟机直接使用的Java类型，这就是虚拟机的类加载机制。\n\n<!--more-->\n\n## 1、类加载的时机\n\n类从被加载到虚拟机内存中开始，到卸载出内存为止，它的整个生命周期包括：加载(Loading)、验证、准备、解析、初始化、使用、卸载7个阶段，其中验证、准备、解析3个部分统称为连接，发生顺序如下图所示：\n![类的生命周期][1]\n\n加载、验证、准备、初始化、卸载这5个阶段的顺序是固定的，而解析则不一定：它在某些情况下可以在初始化之后再开始，这是为了支持Java的运行时绑定(也成动态绑定或晚期绑定)。\n\n那么何时开始第一阶段加载呢？虚拟机规范没有强制约束，由虚拟机具体实现自由把握。\n但初始化阶段，有且仅有5种情况必须立即初始化：\n\n 1. 遇到new、getstatic、putstatic、invokestatic这4条字节码指令时，如果类没有进行过初始化，则需要先触发其初始化。生成这四条指令的最常见的Java代码场景:使用new关键字实例化对象的时候、读取或设置一个类的静态字段（被final修饰、已在编译期放入常量池的静态字段除外）的时候，以及调用一个类的静态方法的时候。\n 2. 使用java.lang.reflect包的方法对类进行反射调用时，如果类没有初始化，则需先触发其初始化。\n 3. 当初始化一个类时，若其父类还没有进行初始化，则需要先触发其父类初始化。\n 4. 当虚拟机启动时，用户需要指定一个要执行的主类，虚拟机会先初始化这个主类。\n 5. 当使用JDK1.7的动态语言支持时，如果一个java.lang.invoke.MethodHandle实例最后的解析结果是REF_getStatic、REF_putStatic、REF_invokeStatic的方法句柄，并且这个方法句柄对应的类没有初始化，则需要先触发其初始化。\n\n## 2、类加载器\n\n虚拟机团队吧类加载阶段中的“通过一个类的全限定名来获取描述此类的二进制字节流”这个动作放到Java虚拟机外部去实现，以便让应用程序自己决定如何去获取所需要的类。实现这个动作的代码模块称为“类加载器”。\n\n类加载器虽然只用于实现类的加载动作，但它的作用却远远不限于类加载阶段。对于任意一个类，都需要由加载它的类加载器和这个类本身一同确立其在Java虚拟机中的唯一性，每一个类加载器，都有一个独立的命名空间。也就是说：比较两个类是否“相等”，只有在这两个类由同一个类加载器加载的前提下才有意义，否则，即使是来源于同一个Class文件，被同一个JVM加载，只要加载它们的类加载器不同，那么这两个类就必不相等。\n\n\n**类加载器的分类：**\n\n 1. 启动类加载器(Bootstrap ClassLoader):负责加载<JAVA_HOME>\\lib目录中的，或者被-Xbootclasspath参数所指定的路径中的能被识别的类库。\n 2. 扩展类加载器(Extension ClassLoader):负责加载<JAVA_HOME>\\lib\\ext目录中的，或者被java.ext.dirs系统变量所指定的路径中的所有类库，开发者可以直接使用该加载器。\n 3. 应用程序加载器(Application ClassLoader):由ClassLoader中的getSystemClassLoader()方法获得，负责加载用户路径(classpath)上的类库。若果没有自定义加载器，一般情况下这就是程序的默认类加载器。\n\n\n**双亲委派机制：**\n\n ![此处输入图片的描述][2]\n  \n除启动类加载器外，器与类加载器都应有自己的父类。\n\n若果一个类收到类加载的请求，它首先不会自己去加载，而是委派给父类加载器去完成，依次往上，因此所有的加载请求最终都会传递到顶层的启动类加载器。只有当父类反馈自己无法加载，子类才会尝试去加载。\n\n这样做的好处：\n    使类加载器具备了优先级的层次关系，保证了同一个类始终是由同一个类加载器完成加载。\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/ClassLife.jpg\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/ParentsDelegationModel.jpg","slug":"Java虚拟机：类加载器","published":1,"updated":"2018-04-23T09:12:56.395Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfkq000bhwvfocloccxp","content":"<p>虚拟机把描述类的数据从Class字节码文件加载到内存，并对数据进行校验、转换解析和初始化，最终形成可以被虚拟机直接使用的Java类型，这就是虚拟机的类加载机制。</p>\n<a id=\"more\"></a>\n<h2 id=\"1、类加载的时机\"><a href=\"#1、类加载的时机\" class=\"headerlink\" title=\"1、类加载的时机\"></a>1、类加载的时机</h2><p>类从被加载到虚拟机内存中开始，到卸载出内存为止，它的整个生命周期包括：加载(Loading)、验证、准备、解析、初始化、使用、卸载7个阶段，其中验证、准备、解析3个部分统称为连接，发生顺序如下图所示：<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/ClassLife.jpg\" alt=\"类的生命周期\"></p>\n<p>加载、验证、准备、初始化、卸载这5个阶段的顺序是固定的，而解析则不一定：它在某些情况下可以在初始化之后再开始，这是为了支持Java的运行时绑定(也成动态绑定或晚期绑定)。</p>\n<p>那么何时开始第一阶段加载呢？虚拟机规范没有强制约束，由虚拟机具体实现自由把握。<br>但初始化阶段，有且仅有5种情况必须立即初始化：</p>\n<ol>\n<li>遇到new、getstatic、putstatic、invokestatic这4条字节码指令时，如果类没有进行过初始化，则需要先触发其初始化。生成这四条指令的最常见的Java代码场景:使用new关键字实例化对象的时候、读取或设置一个类的静态字段（被final修饰、已在编译期放入常量池的静态字段除外）的时候，以及调用一个类的静态方法的时候。</li>\n<li>使用java.lang.reflect包的方法对类进行反射调用时，如果类没有初始化，则需先触发其初始化。</li>\n<li>当初始化一个类时，若其父类还没有进行初始化，则需要先触发其父类初始化。</li>\n<li>当虚拟机启动时，用户需要指定一个要执行的主类，虚拟机会先初始化这个主类。</li>\n<li>当使用JDK1.7的动态语言支持时，如果一个java.lang.invoke.MethodHandle实例最后的解析结果是REF_getStatic、REF_putStatic、REF_invokeStatic的方法句柄，并且这个方法句柄对应的类没有初始化，则需要先触发其初始化。</li>\n</ol>\n<h2 id=\"2、类加载器\"><a href=\"#2、类加载器\" class=\"headerlink\" title=\"2、类加载器\"></a>2、类加载器</h2><p>虚拟机团队吧类加载阶段中的“通过一个类的全限定名来获取描述此类的二进制字节流”这个动作放到Java虚拟机外部去实现，以便让应用程序自己决定如何去获取所需要的类。实现这个动作的代码模块称为“类加载器”。</p>\n<p>类加载器虽然只用于实现类的加载动作，但它的作用却远远不限于类加载阶段。对于任意一个类，都需要由加载它的类加载器和这个类本身一同确立其在Java虚拟机中的唯一性，每一个类加载器，都有一个独立的命名空间。也就是说：比较两个类是否“相等”，只有在这两个类由同一个类加载器加载的前提下才有意义，否则，即使是来源于同一个Class文件，被同一个JVM加载，只要加载它们的类加载器不同，那么这两个类就必不相等。</p>\n<p><strong>类加载器的分类：</strong></p>\n<ol>\n<li>启动类加载器(Bootstrap ClassLoader):负责加载<java_home>\\lib目录中的，或者被-Xbootclasspath参数所指定的路径中的能被识别的类库。</java_home></li>\n<li>扩展类加载器(Extension ClassLoader):负责加载<java_home>\\lib\\ext目录中的，或者被java.ext.dirs系统变量所指定的路径中的所有类库，开发者可以直接使用该加载器。</java_home></li>\n<li>应用程序加载器(Application ClassLoader):由ClassLoader中的getSystemClassLoader()方法获得，负责加载用户路径(classpath)上的类库。若果没有自定义加载器，一般情况下这就是程序的默认类加载器。</li>\n</ol>\n<p><strong>双亲委派机制：</strong></p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/ParentsDelegationModel.jpg\" alt=\"此处输入图片的描述\"></p>\n<p>除启动类加载器外，器与类加载器都应有自己的父类。</p>\n<p>若果一个类收到类加载的请求，它首先不会自己去加载，而是委派给父类加载器去完成，依次往上，因此所有的加载请求最终都会传递到顶层的启动类加载器。只有当父类反馈自己无法加载，子类才会尝试去加载。</p>\n<p>这样做的好处：<br>    使类加载器具备了优先级的层次关系，保证了同一个类始终是由同一个类加载器完成加载。</p>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>虚拟机把描述类的数据从Class字节码文件加载到内存，并对数据进行校验、转换解析和初始化，最终形成可以被虚拟机直接使用的Java类型，这就是虚拟机的类加载机制。</p>","more":"<h2 id=\"1、类加载的时机\"><a href=\"#1、类加载的时机\" class=\"headerlink\" title=\"1、类加载的时机\"></a>1、类加载的时机</h2><p>类从被加载到虚拟机内存中开始，到卸载出内存为止，它的整个生命周期包括：加载(Loading)、验证、准备、解析、初始化、使用、卸载7个阶段，其中验证、准备、解析3个部分统称为连接，发生顺序如下图所示：<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/ClassLife.jpg\" alt=\"类的生命周期\"></p>\n<p>加载、验证、准备、初始化、卸载这5个阶段的顺序是固定的，而解析则不一定：它在某些情况下可以在初始化之后再开始，这是为了支持Java的运行时绑定(也成动态绑定或晚期绑定)。</p>\n<p>那么何时开始第一阶段加载呢？虚拟机规范没有强制约束，由虚拟机具体实现自由把握。<br>但初始化阶段，有且仅有5种情况必须立即初始化：</p>\n<ol>\n<li>遇到new、getstatic、putstatic、invokestatic这4条字节码指令时，如果类没有进行过初始化，则需要先触发其初始化。生成这四条指令的最常见的Java代码场景:使用new关键字实例化对象的时候、读取或设置一个类的静态字段（被final修饰、已在编译期放入常量池的静态字段除外）的时候，以及调用一个类的静态方法的时候。</li>\n<li>使用java.lang.reflect包的方法对类进行反射调用时，如果类没有初始化，则需先触发其初始化。</li>\n<li>当初始化一个类时，若其父类还没有进行初始化，则需要先触发其父类初始化。</li>\n<li>当虚拟机启动时，用户需要指定一个要执行的主类，虚拟机会先初始化这个主类。</li>\n<li>当使用JDK1.7的动态语言支持时，如果一个java.lang.invoke.MethodHandle实例最后的解析结果是REF_getStatic、REF_putStatic、REF_invokeStatic的方法句柄，并且这个方法句柄对应的类没有初始化，则需要先触发其初始化。</li>\n</ol>\n<h2 id=\"2、类加载器\"><a href=\"#2、类加载器\" class=\"headerlink\" title=\"2、类加载器\"></a>2、类加载器</h2><p>虚拟机团队吧类加载阶段中的“通过一个类的全限定名来获取描述此类的二进制字节流”这个动作放到Java虚拟机外部去实现，以便让应用程序自己决定如何去获取所需要的类。实现这个动作的代码模块称为“类加载器”。</p>\n<p>类加载器虽然只用于实现类的加载动作，但它的作用却远远不限于类加载阶段。对于任意一个类，都需要由加载它的类加载器和这个类本身一同确立其在Java虚拟机中的唯一性，每一个类加载器，都有一个独立的命名空间。也就是说：比较两个类是否“相等”，只有在这两个类由同一个类加载器加载的前提下才有意义，否则，即使是来源于同一个Class文件，被同一个JVM加载，只要加载它们的类加载器不同，那么这两个类就必不相等。</p>\n<p><strong>类加载器的分类：</strong></p>\n<ol>\n<li>启动类加载器(Bootstrap ClassLoader):负责加载<java_home>\\lib目录中的，或者被-Xbootclasspath参数所指定的路径中的能被识别的类库。</java_home></li>\n<li>扩展类加载器(Extension ClassLoader):负责加载<java_home>\\lib\\ext目录中的，或者被java.ext.dirs系统变量所指定的路径中的所有类库，开发者可以直接使用该加载器。</java_home></li>\n<li>应用程序加载器(Application ClassLoader):由ClassLoader中的getSystemClassLoader()方法获得，负责加载用户路径(classpath)上的类库。若果没有自定义加载器，一般情况下这就是程序的默认类加载器。</li>\n</ol>\n<p><strong>双亲委派机制：</strong></p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/JVM/ParentsDelegationModel.jpg\" alt=\"此处输入图片的描述\"></p>\n<p>除启动类加载器外，器与类加载器都应有自己的父类。</p>\n<p>若果一个类收到类加载的请求，它首先不会自己去加载，而是委派给父类加载器去完成，依次往上，因此所有的加载请求最终都会传递到顶层的启动类加载器。只有当父类反馈自己无法加载，子类才会尝试去加载。</p>\n<p>这样做的好处：<br>    使类加载器具备了优先级的层次关系，保证了同一个类始终是由同一个类加载器完成加载。</p>"},{"title":"Callable及Future","date":"2017-10-12T03:13:54.000Z","_content":"## 1. 概述\n在线程池中执行任务，使用execute()方法，执行的是Runnable任务，它不返回任何值。如果希望任务完成后返回结果，那么需要使用Callable接口，这也是本文要研究的主题。\n\n<!--more-->\n\n```java\npublic class CallableTest {\n\tpublic static void main(String[] args) {\n\t\tCallable<Integer> callable = new Callable<Integer>() {\n\t\t\t@Override\n\t\t\tpublic Integer call() throws Exception {\n\t\t\t\tSystem.out.println(\"callable线程执行\");\n\t\t\t\treturn new Random().nextInt(100);\n\t\t\t}\n\t\t};\n\n\t\tExecutorService executorService = Executors.newSingleThreadExecutor();\n\t\tFuture<Integer> future = executorService.submit(callable);\n\n\t\ttry {\n\t\t\t// 限定时间获取结果\n\t\t\tSystem.out.println(future.get(5, TimeUnit.SECONDS));\n\t\t} catch (TimeoutException e) {\n\t\t\t// 超时触发线程中止\n\t\t\te.printStackTrace();\n\t\t} catch (InterruptedException e) {\n\t\t\te.printStackTrace();\n\t\t} catch (ExecutionException e) {\n\t\t\t// 抛出执行异常\n\t\t\te.printStackTrace();\n\t\t} finally {\n\t\t\t// 如果任务还在运行，执行中断\n\t\t\tboolean mayInterruptIfRunning = true;\n\t\t\tfuture.cancel(mayInterruptIfRunning);\n\t\t}\n\t}\n}\n```\n\n上面是callable和future的简单应用，执行时要求在限定时间内获取结果，超时执行会抛出TimeoutException，执行异常会抛出ExecutionException。最后在finally里，如果任务还在执行，就进行取消；如果任务已经执行完，取消操作也没有影响。\n\n## 2. Callable接口\n\n我们先回顾一下java.lang.Runnable接口，就声明了run(),其返回值为void，当然就无法获取结果了。\n```java\npublic interface Runnable {  \n    public abstract void run();  \n} \n```\n而callable的接口定义如下：\n```java\npublic interface Callable<V> {   \n      V   call()   throws Exception;   \n} \n```\ncallable接口声明call()方法，有返回值，也可抛出异常，对该接口我们先了解这么多就行，下面我们来说明如何使用。\n\n无论是Runnable接口的实现类还是Callable接口的实现类，都可以被ThreadPoolExecutor或ScheduledThreadPoolExecutor执行，ThreadPoolExecutor或ScheduledThreadPoolExecutor都实现了ExcutorService接口，而因此Callable需要和Executor框架中的ExcutorService结合使用，我们先看看ExecutorService提供的方法：\n```java\n<T> Future<T> submit(Callable<T> task);  \nFuture<?> submit(Runnable task);  \n<T> Future<T> submit(Runnable task, T result);  \n```\n\n - 第一个方法：submit提交一个实现Callable接口的任务，并且返回封装了异步计算结果的Future。\n - 第二个方法：submit提交一个实现Runnable接口的任务，并且返回封装了异步计算结果的Future。\n - 第三个方法：submit提交一个实现Runnable接口的任务，并且指定了在调用Future的get方法时返回的result对象。这个用的很少，因为是自己给定的返回结果，意义不大。\n\n因此我们只要创建好我们的线程对象（实现Callable接口或者Runnable接口），然后通过上面3个方法提交给线程池去执行即可。\n还有点要注意的是，除了我们自己实现Callable对象外，我们还可以使用工厂类Executors来把一个Runnable对象包装成Callable对象。Executors工厂类提供的方法如下：\n```java\npublic static Callable<Object> callable(Runnable task)  \npublic static <T> Callable<T> callable(Runnable task, T result)  \n```\n \n## 3. Future接口\nFuture<V>接口是用来获取异步计算结果的，说白了就是对具体的Runnable或者Callable对象任务执行的结果进行获取(get()),取消(cancel()),判断是否完成等操作。我们看看Future接口的源码：\n```java\npublic interface Future<V> {  \n    boolean cancel(boolean mayInterruptIfRunning);  \n    boolean isCancelled();  \n    boolean isDone();  \n    V get() throws InterruptedException, ExecutionException;  \n    V get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException;  \n}  \n```\n\n方法解析：\n\n - get(): 获取异步执行的结果，如果没有结果可用，此方法会阻塞直到异步计算完成。\n - get(long timeout, TimeUnit unit):获取异步执行结果，如果没有结果可用，此方法会阻塞，但是会有时间限制，如果阻塞时间超过设定的timeout时间，该方法将抛出异常。\n - isDone():如果任务执行结束，无论是正常结束或是中途取消还是发生异常，都返回true。\n - isCancelled():如果任务完成前被取消，则返回true。\n - cancel():\n    - 如果任务还没开始，执行cancel(...)方法将返回false\n    - 如果任务已经启动，执行cancel(true)方法将以中断执行此任务线程的方式来试图停止任务，如果停止成功，返回true；当任务已经启动，执行cancel(false)方法将不会对正在执行的任务线程产生影响(让线程正常执行到完成)，此时返回false\n    - 当任务已经完成，执行cancel(...)方法将返回false\n\n通过方法分析我们也知道实际上Future提供了3种功能：\n 1. 能够中断执行中的任务\n 2. 判断任务是否执行完成\n 3. 获取任务执行完成后额结果。\n\n但是我们必须明白Future只是一个接口，我们无法直接创建对象，因此就需要其实现类FutureTask登场啦\n     \n## 4. FutureTask\n            \n-------------------------![此处输入图片的描述][1]--------------------------\nFutureTask除了实现了Future接口外还实现了Runnable接口，因此FutureTask也可以直接提交给Executor执行。 当然也可以调用线程直接执行（FutureTask.run()）.\n\n\n### 4.1 FutureTask的状态\n```java\nprivate volatile int state;\nprivate static final int NEW          = 0;\nprivate static final int COMPLETING   = 1;\nprivate static final int NORMAL       = 2;\nprivate static final int EXCEPTIONAL  = 3;\nprivate static final int CANCELLED    = 4;\nprivate static final int INTERRUPTING = 5;\nprivate static final int INTERRUPTED  = 6;\n```\n\nFutureTask有7种状态，初始状态从NEW开始，状态转换路径可以归纳为图2所示。在后文的代码，会使用int的大小比较判断状态处于哪个范围，需要留意上面状态的排列顺序\n![FutureTask的状态][2]\nFutureTask的状态路径，取决于run和cancel的调用顺序，在后文分析时，对号入座这几条路径。\n\n 1. NEW -> COMPLETING -> NORMAL 正常的流程\n 2. NEW -> COMPLETING -> EXCEPTIONAL 异常的流程\n 3. NEW -> CANCELLED 被取消流程\n 4. NEW -> INTERRUPTING -> INTERRUPTED 被中断流程\n\n### 4.2 FutureTask的变量\n```java\nprivate volatile int state;\n/** The underlying callable; nulled out after running */\nprivate Callable<V> callable;\n/** The result to return or exception to throw from get() */\nprivate Object outcome; // non-volatile, protected by state reads/writes\n/** The thread running the callable; CASed during run() */\nprivate volatile Thread runner;\n/** Treiber stack of waiting threads */\nprivate volatile WaitNode waiters;\n```\nstate、runner、waiters三个变量没有使用原子类，而是使用Unsafe对象进行原子操作。代码中会见到很多形如compareAndSwap的方法，入门原理可以看[认识非阻塞的同步机制CAS][3]。\n\ncallable是要执行的任务，runner是执行任务的线程，outcome是返回的结果（正常结果或Exception结果）\n\n```java\nstatic final class WaitNode {\n    volatile Thread thread;\n    volatile WaitNode next;\n    WaitNode() { thread = Thread.currentThread(); }\n}\n```\n\nwaiters的数据结构是WaitNode，保存了Thread和下个WaitNode的引用。waiters保存了等待结果的线程，每次操作只会增减头，所以是一个栈结构，详细见后文对get方法的分析。\n\n### 4.3 FutureTask的创建\n下面是FutureTask的两种创建方式：\n```java\npublic FutureTask(Callable<V> callable) {\n    if (callable == null)\n        throw new NullPointerException();\n    this.callable = callable;\n    this.state = NEW;       // ensure visibility of callable\n}\n\npublic FutureTask(Runnable runnable, V result) {\n    this.callable = Executors.callable(runnable, result);\n    this.state = NEW;       // ensure visibility of callable\n} \n```\n\n提交FutureTask到线程池的submit定义在AbstractExecutorService，根据入参的不同，有三个submit方法。下面以提交Callable为例：\n\n```java\npublic <T> Future<T> submit(Callable<T> task) {\n   if (task == null) throw new NullPointerException();\n   RunnableFuture<T> ftask = newTaskFor(task);\n   execute(ftask);\n   return ftask;\n}\n\nprotected <T> RunnableFuture<T> newTaskFor(Callable<T> callable) {    \n   return new FutureTask<T>(callable);\n}\n```\n\nFutureTask在newTaskFor创建，然后调用线程池的execute执行，最后返回Future。获取Future后，就可以调用get获取结果，或者调用cancel取消任务。\n\n### 4.4 FutureTask的运行\n\nFutureTask实现了Runnable，在线程池里执行时调用的方法是run。\n\n```java\npublic void run() {\n    //1\n    if (state != NEW ||\n        !UNSAFE.compareAndSwapObject(this, runnerOffset,null, Thread.currentThread()))\n        return;\n    //2\n    try {\n        Callable<V> c = callable;\n        if (c != null && state == NEW) {\n            V result;\n            boolean ran;\n            try {\n                result = c.call();\n                ran = true;\n            } catch (Throwable ex) {\n                result = null;\n                ran = false;\n                setException(ex);\n            }\n            if (ran)\n                set(result);\n        }\n    } finally {\n       //3\n        runner = null;\n        int s = state;\n        if (s >= INTERRUPTING)\n            handlePossibleCancellationInterrupt(s);\n    }\n}\n```\n标记1处检查FutureTask的状态，如果不是处于NEW，说明状态已经进入四条路径之一，也就没有必要继续了。如果状态是NEW，则将执行任务的线程交给runner。\n\n标记2处开始正式执行任务，调用call方法获取结果，没有异常就算成功，最后执行set方法；出现异常就调用setException方法。\n\n标记3处，无论任务执行是否成功，都需要将runner重新置为空。\n\n```java\nprotected void set(V v) {\n    if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) {\n        outcome = v;\n        UNSAFE.putOrderedInt(this, stateOffset, NORMAL); // final state\n        finishCompletion();\n    }\n}\n\nprotected void setException(Throwable t) {\n    if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) {\n        outcome = t;\n        UNSAFE.putOrderedInt(this, stateOffset, EXCEPTIONAL); // final state\n        finishCompletion();\n    }\n}\n```\n\n任务执行成功与失败，分别对应NEW -> COMPLETING -> NORMAL和NEW -> COMPLETING -> EXCEPTIONAL两条路径。这里先将状态修改为中间状态，再对结果赋值，最后再修改为最终状态。\n\n```java\nprivate void finishCompletion() {\n    // assert state > COMPLETING;\n    for (WaitNode q; (q = waiters) != null;) {\n        if (UNSAFE.compareAndSwapObject(this, waitersOffset, q, null)) {\n            for (;;) {\n                Thread t = q.thread;\n                if (t != null) {\n                    q.thread = null;\n                    LockSupport.unpark(t);\n                }\n                WaitNode next = q.next;\n                if (next == null)\n                    break;\n                q.next = null; // unlink to help gc\n                q = next;\n            }\n            break;\n        }\n    }\n    done();\n    callable = null;        // to reduce footprint\n}\n```\n\n最后调用finishCompletion执行任务完成，唤醒并删除所有在waiters中等待的线程。done方法是空的，供子类实现，最后callable也设置为空。\n\nFutureTask还有个runAndReset，逻辑和run类似，但没有调用set方法来设置结果，执行完成后将任务重新初始化。\n\n```java\nprotected boolean runAndReset() {\n    if (state != NEW ||\n        !UNSAFE.compareAndSwapObject(this, runnerOffset,\n                                     null, Thread.currentThread()))\n        return false;\n    boolean ran = false;\n    int s = state;\n    try {\n        Callable<V> c = callable;\n        if (c != null && s == NEW) {\n            try {\n                c.call(); // don't set result\n                ran = true;\n            } catch (Throwable ex) {\n                setException(ex);\n            }\n        }\n    } finally {\n        // runner must be non-null until state is settled to\n        // prevent concurrent calls to run()\n        runner = null;\n        // state must be re-read after nulling runner to prevent\n        // leaked interrupts\n        s = state;\n        if (s >= INTERRUPTING)\n            handlePossibleCancellationInterrupt(s);\n    }\n    return ran && s == NEW;\n}\n```\n\n\n### 4.5 FutureTask的取消\n\n对于已经提交执行的任务，可以调用cancel执行取消。\n\n```java\npublic boolean cancel(boolean mayInterruptIfRunning) {\n   //1\n    if (!(state == NEW &&\n          UNSAFE.compareAndSwapInt(this, stateOffset, NEW,\n              mayInterruptIfRunning ? INTERRUPTING : CANCELLED)))\n        return false;\n    try {    // in case call to interrupt throws exception\n       //2\n        if (mayInterruptIfRunning) {\n            try {\n                Thread t = runner;\n                if (t != null)\n                    t.interrupt();\n            } finally { // final state\n                UNSAFE.putOrderedInt(this, stateOffset, INTERRUPTED);\n            }\n        }\n    } finally {\n        finishCompletion();\n    }\n    return true;\n}\n```\n\n标记1处判断任务状态，为NEW才能被取消。如果mayInterruptIfRunning是true，代表任务需要被中断，走NEW -> INTERRUPTING -> INTERRUPTED流程。否则代表任务被取消，走NEW -> CANCELLED流程。\n\n标记2处理任务被中断的情况，这里仅仅是对线程发出中断请求，不确保任务能检测并处理中断，详细原理去看Java的中断机制。\n\n最后调用finishCompletion完成收尾工作。\n\n```java\npublic boolean isCancelled() {\n    return state >= CANCELLED;\n}\n```\n判断任务是否被取消，具体逻辑是判断state >= CANCELLED，包括了被中断一共两条路径的结果。\n\n### 4.5 FutureTask获取结果\n调用FutureTask的get方法获取任务的执行结果，可以阻塞直到获取结果，也可以限制范围时间内获取结果，否则抛出TimeoutException。\n```java\npublic V get() throws InterruptedException, ExecutionException {\n    int s = state;\n    if (s <= COMPLETING)\n        s = awaitDone(false, 0L);\n    return report(s);\n}\n\npublic V get(long timeout, TimeUnit unit)\n    throws InterruptedException, ExecutionException, TimeoutException {\n    if (unit == null)\n        throw new NullPointerException();\n    int s = state;\n    if (s <= COMPLETING &&\n        (s = awaitDone(true, unit.toNanos(timeout))) <= COMPLETING)\n        throw new TimeoutException();\n    return report(s);\n}\n```\nget的核心实现调用了awaitDone，入参为是否开启时间限制和最大的等待时间。\n\n```java\nprivate int awaitDone(boolean timed, long nanos)\n    throws InterruptedException {\n    final long deadline = timed ? System.nanoTime() + nanos : 0L;\n    WaitNode q = null;\n    boolean queued = false;\n    for (;;) {\n        if (Thread.interrupted()) {\n            removeWaiter(q);\n            throw new InterruptedException();\n        }\n\n        int s = state;\n        if (s > COMPLETING) {    //1\n            if (q != null)\n                q.thread = null;\n            return s;\n        }\n        else if (s == COMPLETING) // cannot time out yet    //2\n            Thread.yield();\n        else if (q == null)     //3\n            q = new WaitNode();\n        else if (!queued)    //4\n            queued = UNSAFE.compareAndSwapObject(this, waitersOffset,\n                                                 q.next = waiters, q);\n        else if (timed) {    //5\n            nanos = deadline - System.nanoTime();\n            if (nanos <= 0L) {\n                removeWaiter(q);\n                return state;\n            }\n            LockSupport.parkNanos(this, nanos);\n        }\n        else     //6\n            LockSupport.park(this);\n    }\n}\n```\nawaitDone主要逻辑是一个无限循环，首先判断线程是否被中断，是的话移除waiter并抛出中断异常。接下来是一串if-else，一共六种情况。\n\n 1. 判断任务状态是否已经完成，是就直接返回；\n 2. 任务状态是COMPLETING，代表在set结果时被阻塞了，这里先让出资源；\n 3. 如果WaitNode为空，就为当前线程初始化一个WaitNode；\n 4. 如果当前的WaitNode还没有加入waiters，就加入；\n 5. 如果是限定时间执行，判断有无超时，超时就将waiter移出，并返回结果，否则阻塞一定时间；\n 6. 如果没有限定时间，就一直阻塞到下次被唤醒。\n \nLockSupport是用来创建锁和其他同步类的基本线程阻塞原语。park和unpark的作用分别是阻塞线程和解除阻塞线程。\n\n```java\nprivate V report(int s) throws ExecutionException {\n   Object x = outcome;\n   if (s == NORMAL)\n       return (V)x;\n   if (s >= CANCELLED)\n       throw new CancellationException();\n   throw new ExecutionException((Throwable)x);\n}\n```\n\n最后get调用report，使用outcome返回结果。\n\n![此处输入图片的描述][4]\n\n如果多个线程向同一个FutureTask实例get结果，但FutureTask又没有执行完毕，线程将会阻塞并保存在waiters中。待FutureTask获取结果后，唤醒waiters等待的线程，并返回同一个结果。\n\n\n  [1]: http://upload-images.jianshu.io/upload_images/3294095-237f514c17eb5e4a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\n  [2]: http://upload-images.jianshu.io/upload_images/3294095-66574ae94d956415.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\n  [3]: http://www.jianshu.com/p/e2179c74a2e4\n  [4]: http://upload-images.jianshu.io/upload_images/3294095-123399195bd337cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240","source":"_posts/Callable及Future.md","raw":"---\ntitle: Callable及Future\ncategories:\n  - JavaSE\ntags:\n  - Java\n  - 多线程\ndate: 2017-10-12 11:13:54\n---\n## 1. 概述\n在线程池中执行任务，使用execute()方法，执行的是Runnable任务，它不返回任何值。如果希望任务完成后返回结果，那么需要使用Callable接口，这也是本文要研究的主题。\n\n<!--more-->\n\n```java\npublic class CallableTest {\n\tpublic static void main(String[] args) {\n\t\tCallable<Integer> callable = new Callable<Integer>() {\n\t\t\t@Override\n\t\t\tpublic Integer call() throws Exception {\n\t\t\t\tSystem.out.println(\"callable线程执行\");\n\t\t\t\treturn new Random().nextInt(100);\n\t\t\t}\n\t\t};\n\n\t\tExecutorService executorService = Executors.newSingleThreadExecutor();\n\t\tFuture<Integer> future = executorService.submit(callable);\n\n\t\ttry {\n\t\t\t// 限定时间获取结果\n\t\t\tSystem.out.println(future.get(5, TimeUnit.SECONDS));\n\t\t} catch (TimeoutException e) {\n\t\t\t// 超时触发线程中止\n\t\t\te.printStackTrace();\n\t\t} catch (InterruptedException e) {\n\t\t\te.printStackTrace();\n\t\t} catch (ExecutionException e) {\n\t\t\t// 抛出执行异常\n\t\t\te.printStackTrace();\n\t\t} finally {\n\t\t\t// 如果任务还在运行，执行中断\n\t\t\tboolean mayInterruptIfRunning = true;\n\t\t\tfuture.cancel(mayInterruptIfRunning);\n\t\t}\n\t}\n}\n```\n\n上面是callable和future的简单应用，执行时要求在限定时间内获取结果，超时执行会抛出TimeoutException，执行异常会抛出ExecutionException。最后在finally里，如果任务还在执行，就进行取消；如果任务已经执行完，取消操作也没有影响。\n\n## 2. Callable接口\n\n我们先回顾一下java.lang.Runnable接口，就声明了run(),其返回值为void，当然就无法获取结果了。\n```java\npublic interface Runnable {  \n    public abstract void run();  \n} \n```\n而callable的接口定义如下：\n```java\npublic interface Callable<V> {   \n      V   call()   throws Exception;   \n} \n```\ncallable接口声明call()方法，有返回值，也可抛出异常，对该接口我们先了解这么多就行，下面我们来说明如何使用。\n\n无论是Runnable接口的实现类还是Callable接口的实现类，都可以被ThreadPoolExecutor或ScheduledThreadPoolExecutor执行，ThreadPoolExecutor或ScheduledThreadPoolExecutor都实现了ExcutorService接口，而因此Callable需要和Executor框架中的ExcutorService结合使用，我们先看看ExecutorService提供的方法：\n```java\n<T> Future<T> submit(Callable<T> task);  \nFuture<?> submit(Runnable task);  \n<T> Future<T> submit(Runnable task, T result);  \n```\n\n - 第一个方法：submit提交一个实现Callable接口的任务，并且返回封装了异步计算结果的Future。\n - 第二个方法：submit提交一个实现Runnable接口的任务，并且返回封装了异步计算结果的Future。\n - 第三个方法：submit提交一个实现Runnable接口的任务，并且指定了在调用Future的get方法时返回的result对象。这个用的很少，因为是自己给定的返回结果，意义不大。\n\n因此我们只要创建好我们的线程对象（实现Callable接口或者Runnable接口），然后通过上面3个方法提交给线程池去执行即可。\n还有点要注意的是，除了我们自己实现Callable对象外，我们还可以使用工厂类Executors来把一个Runnable对象包装成Callable对象。Executors工厂类提供的方法如下：\n```java\npublic static Callable<Object> callable(Runnable task)  \npublic static <T> Callable<T> callable(Runnable task, T result)  \n```\n \n## 3. Future接口\nFuture<V>接口是用来获取异步计算结果的，说白了就是对具体的Runnable或者Callable对象任务执行的结果进行获取(get()),取消(cancel()),判断是否完成等操作。我们看看Future接口的源码：\n```java\npublic interface Future<V> {  \n    boolean cancel(boolean mayInterruptIfRunning);  \n    boolean isCancelled();  \n    boolean isDone();  \n    V get() throws InterruptedException, ExecutionException;  \n    V get(long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException;  \n}  \n```\n\n方法解析：\n\n - get(): 获取异步执行的结果，如果没有结果可用，此方法会阻塞直到异步计算完成。\n - get(long timeout, TimeUnit unit):获取异步执行结果，如果没有结果可用，此方法会阻塞，但是会有时间限制，如果阻塞时间超过设定的timeout时间，该方法将抛出异常。\n - isDone():如果任务执行结束，无论是正常结束或是中途取消还是发生异常，都返回true。\n - isCancelled():如果任务完成前被取消，则返回true。\n - cancel():\n    - 如果任务还没开始，执行cancel(...)方法将返回false\n    - 如果任务已经启动，执行cancel(true)方法将以中断执行此任务线程的方式来试图停止任务，如果停止成功，返回true；当任务已经启动，执行cancel(false)方法将不会对正在执行的任务线程产生影响(让线程正常执行到完成)，此时返回false\n    - 当任务已经完成，执行cancel(...)方法将返回false\n\n通过方法分析我们也知道实际上Future提供了3种功能：\n 1. 能够中断执行中的任务\n 2. 判断任务是否执行完成\n 3. 获取任务执行完成后额结果。\n\n但是我们必须明白Future只是一个接口，我们无法直接创建对象，因此就需要其实现类FutureTask登场啦\n     \n## 4. FutureTask\n            \n-------------------------![此处输入图片的描述][1]--------------------------\nFutureTask除了实现了Future接口外还实现了Runnable接口，因此FutureTask也可以直接提交给Executor执行。 当然也可以调用线程直接执行（FutureTask.run()）.\n\n\n### 4.1 FutureTask的状态\n```java\nprivate volatile int state;\nprivate static final int NEW          = 0;\nprivate static final int COMPLETING   = 1;\nprivate static final int NORMAL       = 2;\nprivate static final int EXCEPTIONAL  = 3;\nprivate static final int CANCELLED    = 4;\nprivate static final int INTERRUPTING = 5;\nprivate static final int INTERRUPTED  = 6;\n```\n\nFutureTask有7种状态，初始状态从NEW开始，状态转换路径可以归纳为图2所示。在后文的代码，会使用int的大小比较判断状态处于哪个范围，需要留意上面状态的排列顺序\n![FutureTask的状态][2]\nFutureTask的状态路径，取决于run和cancel的调用顺序，在后文分析时，对号入座这几条路径。\n\n 1. NEW -> COMPLETING -> NORMAL 正常的流程\n 2. NEW -> COMPLETING -> EXCEPTIONAL 异常的流程\n 3. NEW -> CANCELLED 被取消流程\n 4. NEW -> INTERRUPTING -> INTERRUPTED 被中断流程\n\n### 4.2 FutureTask的变量\n```java\nprivate volatile int state;\n/** The underlying callable; nulled out after running */\nprivate Callable<V> callable;\n/** The result to return or exception to throw from get() */\nprivate Object outcome; // non-volatile, protected by state reads/writes\n/** The thread running the callable; CASed during run() */\nprivate volatile Thread runner;\n/** Treiber stack of waiting threads */\nprivate volatile WaitNode waiters;\n```\nstate、runner、waiters三个变量没有使用原子类，而是使用Unsafe对象进行原子操作。代码中会见到很多形如compareAndSwap的方法，入门原理可以看[认识非阻塞的同步机制CAS][3]。\n\ncallable是要执行的任务，runner是执行任务的线程，outcome是返回的结果（正常结果或Exception结果）\n\n```java\nstatic final class WaitNode {\n    volatile Thread thread;\n    volatile WaitNode next;\n    WaitNode() { thread = Thread.currentThread(); }\n}\n```\n\nwaiters的数据结构是WaitNode，保存了Thread和下个WaitNode的引用。waiters保存了等待结果的线程，每次操作只会增减头，所以是一个栈结构，详细见后文对get方法的分析。\n\n### 4.3 FutureTask的创建\n下面是FutureTask的两种创建方式：\n```java\npublic FutureTask(Callable<V> callable) {\n    if (callable == null)\n        throw new NullPointerException();\n    this.callable = callable;\n    this.state = NEW;       // ensure visibility of callable\n}\n\npublic FutureTask(Runnable runnable, V result) {\n    this.callable = Executors.callable(runnable, result);\n    this.state = NEW;       // ensure visibility of callable\n} \n```\n\n提交FutureTask到线程池的submit定义在AbstractExecutorService，根据入参的不同，有三个submit方法。下面以提交Callable为例：\n\n```java\npublic <T> Future<T> submit(Callable<T> task) {\n   if (task == null) throw new NullPointerException();\n   RunnableFuture<T> ftask = newTaskFor(task);\n   execute(ftask);\n   return ftask;\n}\n\nprotected <T> RunnableFuture<T> newTaskFor(Callable<T> callable) {    \n   return new FutureTask<T>(callable);\n}\n```\n\nFutureTask在newTaskFor创建，然后调用线程池的execute执行，最后返回Future。获取Future后，就可以调用get获取结果，或者调用cancel取消任务。\n\n### 4.4 FutureTask的运行\n\nFutureTask实现了Runnable，在线程池里执行时调用的方法是run。\n\n```java\npublic void run() {\n    //1\n    if (state != NEW ||\n        !UNSAFE.compareAndSwapObject(this, runnerOffset,null, Thread.currentThread()))\n        return;\n    //2\n    try {\n        Callable<V> c = callable;\n        if (c != null && state == NEW) {\n            V result;\n            boolean ran;\n            try {\n                result = c.call();\n                ran = true;\n            } catch (Throwable ex) {\n                result = null;\n                ran = false;\n                setException(ex);\n            }\n            if (ran)\n                set(result);\n        }\n    } finally {\n       //3\n        runner = null;\n        int s = state;\n        if (s >= INTERRUPTING)\n            handlePossibleCancellationInterrupt(s);\n    }\n}\n```\n标记1处检查FutureTask的状态，如果不是处于NEW，说明状态已经进入四条路径之一，也就没有必要继续了。如果状态是NEW，则将执行任务的线程交给runner。\n\n标记2处开始正式执行任务，调用call方法获取结果，没有异常就算成功，最后执行set方法；出现异常就调用setException方法。\n\n标记3处，无论任务执行是否成功，都需要将runner重新置为空。\n\n```java\nprotected void set(V v) {\n    if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) {\n        outcome = v;\n        UNSAFE.putOrderedInt(this, stateOffset, NORMAL); // final state\n        finishCompletion();\n    }\n}\n\nprotected void setException(Throwable t) {\n    if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) {\n        outcome = t;\n        UNSAFE.putOrderedInt(this, stateOffset, EXCEPTIONAL); // final state\n        finishCompletion();\n    }\n}\n```\n\n任务执行成功与失败，分别对应NEW -> COMPLETING -> NORMAL和NEW -> COMPLETING -> EXCEPTIONAL两条路径。这里先将状态修改为中间状态，再对结果赋值，最后再修改为最终状态。\n\n```java\nprivate void finishCompletion() {\n    // assert state > COMPLETING;\n    for (WaitNode q; (q = waiters) != null;) {\n        if (UNSAFE.compareAndSwapObject(this, waitersOffset, q, null)) {\n            for (;;) {\n                Thread t = q.thread;\n                if (t != null) {\n                    q.thread = null;\n                    LockSupport.unpark(t);\n                }\n                WaitNode next = q.next;\n                if (next == null)\n                    break;\n                q.next = null; // unlink to help gc\n                q = next;\n            }\n            break;\n        }\n    }\n    done();\n    callable = null;        // to reduce footprint\n}\n```\n\n最后调用finishCompletion执行任务完成，唤醒并删除所有在waiters中等待的线程。done方法是空的，供子类实现，最后callable也设置为空。\n\nFutureTask还有个runAndReset，逻辑和run类似，但没有调用set方法来设置结果，执行完成后将任务重新初始化。\n\n```java\nprotected boolean runAndReset() {\n    if (state != NEW ||\n        !UNSAFE.compareAndSwapObject(this, runnerOffset,\n                                     null, Thread.currentThread()))\n        return false;\n    boolean ran = false;\n    int s = state;\n    try {\n        Callable<V> c = callable;\n        if (c != null && s == NEW) {\n            try {\n                c.call(); // don't set result\n                ran = true;\n            } catch (Throwable ex) {\n                setException(ex);\n            }\n        }\n    } finally {\n        // runner must be non-null until state is settled to\n        // prevent concurrent calls to run()\n        runner = null;\n        // state must be re-read after nulling runner to prevent\n        // leaked interrupts\n        s = state;\n        if (s >= INTERRUPTING)\n            handlePossibleCancellationInterrupt(s);\n    }\n    return ran && s == NEW;\n}\n```\n\n\n### 4.5 FutureTask的取消\n\n对于已经提交执行的任务，可以调用cancel执行取消。\n\n```java\npublic boolean cancel(boolean mayInterruptIfRunning) {\n   //1\n    if (!(state == NEW &&\n          UNSAFE.compareAndSwapInt(this, stateOffset, NEW,\n              mayInterruptIfRunning ? INTERRUPTING : CANCELLED)))\n        return false;\n    try {    // in case call to interrupt throws exception\n       //2\n        if (mayInterruptIfRunning) {\n            try {\n                Thread t = runner;\n                if (t != null)\n                    t.interrupt();\n            } finally { // final state\n                UNSAFE.putOrderedInt(this, stateOffset, INTERRUPTED);\n            }\n        }\n    } finally {\n        finishCompletion();\n    }\n    return true;\n}\n```\n\n标记1处判断任务状态，为NEW才能被取消。如果mayInterruptIfRunning是true，代表任务需要被中断，走NEW -> INTERRUPTING -> INTERRUPTED流程。否则代表任务被取消，走NEW -> CANCELLED流程。\n\n标记2处理任务被中断的情况，这里仅仅是对线程发出中断请求，不确保任务能检测并处理中断，详细原理去看Java的中断机制。\n\n最后调用finishCompletion完成收尾工作。\n\n```java\npublic boolean isCancelled() {\n    return state >= CANCELLED;\n}\n```\n判断任务是否被取消，具体逻辑是判断state >= CANCELLED，包括了被中断一共两条路径的结果。\n\n### 4.5 FutureTask获取结果\n调用FutureTask的get方法获取任务的执行结果，可以阻塞直到获取结果，也可以限制范围时间内获取结果，否则抛出TimeoutException。\n```java\npublic V get() throws InterruptedException, ExecutionException {\n    int s = state;\n    if (s <= COMPLETING)\n        s = awaitDone(false, 0L);\n    return report(s);\n}\n\npublic V get(long timeout, TimeUnit unit)\n    throws InterruptedException, ExecutionException, TimeoutException {\n    if (unit == null)\n        throw new NullPointerException();\n    int s = state;\n    if (s <= COMPLETING &&\n        (s = awaitDone(true, unit.toNanos(timeout))) <= COMPLETING)\n        throw new TimeoutException();\n    return report(s);\n}\n```\nget的核心实现调用了awaitDone，入参为是否开启时间限制和最大的等待时间。\n\n```java\nprivate int awaitDone(boolean timed, long nanos)\n    throws InterruptedException {\n    final long deadline = timed ? System.nanoTime() + nanos : 0L;\n    WaitNode q = null;\n    boolean queued = false;\n    for (;;) {\n        if (Thread.interrupted()) {\n            removeWaiter(q);\n            throw new InterruptedException();\n        }\n\n        int s = state;\n        if (s > COMPLETING) {    //1\n            if (q != null)\n                q.thread = null;\n            return s;\n        }\n        else if (s == COMPLETING) // cannot time out yet    //2\n            Thread.yield();\n        else if (q == null)     //3\n            q = new WaitNode();\n        else if (!queued)    //4\n            queued = UNSAFE.compareAndSwapObject(this, waitersOffset,\n                                                 q.next = waiters, q);\n        else if (timed) {    //5\n            nanos = deadline - System.nanoTime();\n            if (nanos <= 0L) {\n                removeWaiter(q);\n                return state;\n            }\n            LockSupport.parkNanos(this, nanos);\n        }\n        else     //6\n            LockSupport.park(this);\n    }\n}\n```\nawaitDone主要逻辑是一个无限循环，首先判断线程是否被中断，是的话移除waiter并抛出中断异常。接下来是一串if-else，一共六种情况。\n\n 1. 判断任务状态是否已经完成，是就直接返回；\n 2. 任务状态是COMPLETING，代表在set结果时被阻塞了，这里先让出资源；\n 3. 如果WaitNode为空，就为当前线程初始化一个WaitNode；\n 4. 如果当前的WaitNode还没有加入waiters，就加入；\n 5. 如果是限定时间执行，判断有无超时，超时就将waiter移出，并返回结果，否则阻塞一定时间；\n 6. 如果没有限定时间，就一直阻塞到下次被唤醒。\n \nLockSupport是用来创建锁和其他同步类的基本线程阻塞原语。park和unpark的作用分别是阻塞线程和解除阻塞线程。\n\n```java\nprivate V report(int s) throws ExecutionException {\n   Object x = outcome;\n   if (s == NORMAL)\n       return (V)x;\n   if (s >= CANCELLED)\n       throw new CancellationException();\n   throw new ExecutionException((Throwable)x);\n}\n```\n\n最后get调用report，使用outcome返回结果。\n\n![此处输入图片的描述][4]\n\n如果多个线程向同一个FutureTask实例get结果，但FutureTask又没有执行完毕，线程将会阻塞并保存在waiters中。待FutureTask获取结果后，唤醒waiters等待的线程，并返回同一个结果。\n\n\n  [1]: http://upload-images.jianshu.io/upload_images/3294095-237f514c17eb5e4a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\n  [2]: http://upload-images.jianshu.io/upload_images/3294095-66574ae94d956415.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\n  [3]: http://www.jianshu.com/p/e2179c74a2e4\n  [4]: http://upload-images.jianshu.io/upload_images/3294095-123399195bd337cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240","slug":"Callable及Future","published":1,"updated":"2018-02-27T07:38:38.083Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfkt000chwvfr9drspvb","content":"<h2 id=\"1-概述\"><a href=\"#1-概述\" class=\"headerlink\" title=\"1. 概述\"></a>1. 概述</h2><p>在线程池中执行任务，使用execute()方法，执行的是Runnable任务，它不返回任何值。如果希望任务完成后返回结果，那么需要使用Callable接口，这也是本文要研究的主题。</p>\n<a id=\"more\"></a>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CallableTest</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tCallable&lt;Integer&gt; callable = <span class=\"keyword\">new</span> Callable&lt;Integer&gt;() &#123;</div><div class=\"line\">\t\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t\t\tSystem.out.println(<span class=\"string\">\"callable线程执行\"</span>);</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Random().nextInt(<span class=\"number\">100</span>);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;;</div><div class=\"line\"></div><div class=\"line\">\t\tExecutorService executorService = Executors.newSingleThreadExecutor();</div><div class=\"line\">\t\tFuture&lt;Integer&gt; future = executorService.submit(callable);</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">// 限定时间获取结果</span></div><div class=\"line\">\t\t\tSystem.out.println(future.get(<span class=\"number\">5</span>, TimeUnit.SECONDS));</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (TimeoutException e) &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">// 超时触发线程中止</span></div><div class=\"line\">\t\t\te.printStackTrace();</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\te.printStackTrace();</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (ExecutionException e) &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">// 抛出执行异常</span></div><div class=\"line\">\t\t\te.printStackTrace();</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">// 如果任务还在运行，执行中断</span></div><div class=\"line\">\t\t\t<span class=\"keyword\">boolean</span> mayInterruptIfRunning = <span class=\"keyword\">true</span>;</div><div class=\"line\">\t\t\tfuture.cancel(mayInterruptIfRunning);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>上面是callable和future的简单应用，执行时要求在限定时间内获取结果，超时执行会抛出TimeoutException，执行异常会抛出ExecutionException。最后在finally里，如果任务还在执行，就进行取消；如果任务已经执行完，取消操作也没有影响。</p>\n<h2 id=\"2-Callable接口\"><a href=\"#2-Callable接口\" class=\"headerlink\" title=\"2. Callable接口\"></a>2. Callable接口</h2><p>我们先回顾一下java.lang.Runnable接口，就声明了run(),其返回值为void，当然就无法获取结果了。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Runnable</span> </span>&#123;  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>;  </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>而callable的接口定义如下：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Callable</span>&lt;<span class=\"title\">V</span>&gt; </span>&#123;   </div><div class=\"line\">      <span class=\"function\">V   <span class=\"title\">call</span><span class=\"params\">()</span>   <span class=\"keyword\">throws</span> Exception</span>;   </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>callable接口声明call()方法，有返回值，也可抛出异常，对该接口我们先了解这么多就行，下面我们来说明如何使用。</p>\n<p>无论是Runnable接口的实现类还是Callable接口的实现类，都可以被ThreadPoolExecutor或ScheduledThreadPoolExecutor执行，ThreadPoolExecutor或ScheduledThreadPoolExecutor都实现了ExcutorService接口，而因此Callable需要和Executor框架中的ExcutorService结合使用，我们先看看ExecutorService提供的方法：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;T&gt; <span class=\"function\">Future&lt;T&gt; <span class=\"title\">submit</span><span class=\"params\">(Callable&lt;T&gt; task)</span></span>;  </div><div class=\"line\">Future&lt;?&gt; submit(Runnable task);  </div><div class=\"line\">&lt;T&gt; <span class=\"function\">Future&lt;T&gt; <span class=\"title\">submit</span><span class=\"params\">(Runnable task, T result)</span></span>;</div></pre></td></tr></table></figure></p>\n<ul>\n<li>第一个方法：submit提交一个实现Callable接口的任务，并且返回封装了异步计算结果的Future。</li>\n<li>第二个方法：submit提交一个实现Runnable接口的任务，并且返回封装了异步计算结果的Future。</li>\n<li>第三个方法：submit提交一个实现Runnable接口的任务，并且指定了在调用Future的get方法时返回的result对象。这个用的很少，因为是自己给定的返回结果，意义不大。</li>\n</ul>\n<p>因此我们只要创建好我们的线程对象（实现Callable接口或者Runnable接口），然后通过上面3个方法提交给线程池去执行即可。<br>还有点要注意的是，除了我们自己实现Callable对象外，我们还可以使用工厂类Executors来把一个Runnable对象包装成Callable对象。Executors工厂类提供的方法如下：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Callable&lt;Object&gt; <span class=\"title\">callable</span><span class=\"params\">(Runnable task)</span>  </span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> &lt;T&gt; Callable&lt;T&gt; <span class=\"title\">callable</span><span class=\"params\">(Runnable task, T result)</span></div></pre></td></tr></table></figure></p>\n<h2 id=\"3-Future接口\"><a href=\"#3-Future接口\" class=\"headerlink\" title=\"3. Future接口\"></a>3. Future接口</h2><p>Future<v>接口是用来获取异步计算结果的，说白了就是对具体的Runnable或者Callable对象任务执行的结果进行获取(get()),取消(cancel()),判断是否完成等操作。我们看看Future接口的源码：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Future</span>&lt;<span class=\"title\">V</span>&gt; </span>&#123;  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">cancel</span><span class=\"params\">(<span class=\"keyword\">boolean</span> mayInterruptIfRunning)</span></span>;  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">isCancelled</span><span class=\"params\">()</span></span>;  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">isDone</span><span class=\"params\">()</span></span>;  </div><div class=\"line\">    <span class=\"function\">V <span class=\"title\">get</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException</span>;  </div><div class=\"line\">    <span class=\"function\">V <span class=\"title\">get</span><span class=\"params\">(<span class=\"keyword\">long</span> timeout, TimeUnit unit)</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException, TimeoutException</span>;  </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></v></p>\n<p>方法解析：</p>\n<ul>\n<li>get(): 获取异步执行的结果，如果没有结果可用，此方法会阻塞直到异步计算完成。</li>\n<li>get(long timeout, TimeUnit unit):获取异步执行结果，如果没有结果可用，此方法会阻塞，但是会有时间限制，如果阻塞时间超过设定的timeout时间，该方法将抛出异常。</li>\n<li>isDone():如果任务执行结束，无论是正常结束或是中途取消还是发生异常，都返回true。</li>\n<li>isCancelled():如果任务完成前被取消，则返回true。</li>\n<li>cancel():<ul>\n<li>如果任务还没开始，执行cancel(…)方法将返回false</li>\n<li>如果任务已经启动，执行cancel(true)方法将以中断执行此任务线程的方式来试图停止任务，如果停止成功，返回true；当任务已经启动，执行cancel(false)方法将不会对正在执行的任务线程产生影响(让线程正常执行到完成)，此时返回false</li>\n<li>当任务已经完成，执行cancel(…)方法将返回false</li>\n</ul>\n</li>\n</ul>\n<p>通过方法分析我们也知道实际上Future提供了3种功能：</p>\n<ol>\n<li>能够中断执行中的任务</li>\n<li>判断任务是否执行完成</li>\n<li>获取任务执行完成后额结果。</li>\n</ol>\n<p>但是我们必须明白Future只是一个接口，我们无法直接创建对象，因此就需要其实现类FutureTask登场啦</p>\n<h2 id=\"4-FutureTask\"><a href=\"#4-FutureTask\" class=\"headerlink\" title=\"4. FutureTask\"></a>4. FutureTask</h2><p>————————-<img src=\"http://upload-images.jianshu.io/upload_images/3294095-237f514c17eb5e4a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"此处输入图片的描述\">————————–<br>FutureTask除了实现了Future接口外还实现了Runnable接口，因此FutureTask也可以直接提交给Executor执行。 当然也可以调用线程直接执行（FutureTask.run()）.</p>\n<h3 id=\"4-1-FutureTask的状态\"><a href=\"#4-1-FutureTask的状态\" class=\"headerlink\" title=\"4.1 FutureTask的状态\"></a>4.1 FutureTask的状态</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">int</span> state;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> NEW          = <span class=\"number\">0</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> COMPLETING   = <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> NORMAL       = <span class=\"number\">2</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> EXCEPTIONAL  = <span class=\"number\">3</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> CANCELLED    = <span class=\"number\">4</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> INTERRUPTING = <span class=\"number\">5</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> INTERRUPTED  = <span class=\"number\">6</span>;</div></pre></td></tr></table></figure>\n<p>FutureTask有7种状态，初始状态从NEW开始，状态转换路径可以归纳为图2所示。在后文的代码，会使用int的大小比较判断状态处于哪个范围，需要留意上面状态的排列顺序<br><img src=\"http://upload-images.jianshu.io/upload_images/3294095-66574ae94d956415.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"FutureTask的状态\"><br>FutureTask的状态路径，取决于run和cancel的调用顺序，在后文分析时，对号入座这几条路径。</p>\n<ol>\n<li>NEW -&gt; COMPLETING -&gt; NORMAL 正常的流程</li>\n<li>NEW -&gt; COMPLETING -&gt; EXCEPTIONAL 异常的流程</li>\n<li>NEW -&gt; CANCELLED 被取消流程</li>\n<li>NEW -&gt; INTERRUPTING -&gt; INTERRUPTED 被中断流程</li>\n</ol>\n<h3 id=\"4-2-FutureTask的变量\"><a href=\"#4-2-FutureTask的变量\" class=\"headerlink\" title=\"4.2 FutureTask的变量\"></a>4.2 FutureTask的变量</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">int</span> state;</div><div class=\"line\"><span class=\"comment\">/** The underlying callable; nulled out after running */</span></div><div class=\"line\"><span class=\"keyword\">private</span> Callable&lt;V&gt; callable;</div><div class=\"line\"><span class=\"comment\">/** The result to return or exception to throw from get() */</span></div><div class=\"line\"><span class=\"keyword\">private</span> Object outcome; <span class=\"comment\">// non-volatile, protected by state reads/writes</span></div><div class=\"line\"><span class=\"comment\">/** The thread running the callable; CASed during run() */</span></div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> Thread runner;</div><div class=\"line\"><span class=\"comment\">/** Treiber stack of waiting threads */</span></div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> WaitNode waiters;</div></pre></td></tr></table></figure>\n<p>state、runner、waiters三个变量没有使用原子类，而是使用Unsafe对象进行原子操作。代码中会见到很多形如compareAndSwap的方法，入门原理可以看<a href=\"http://www.jianshu.com/p/e2179c74a2e4\" target=\"_blank\" rel=\"noopener\">认识非阻塞的同步机制CAS</a>。</p>\n<p>callable是要执行的任务，runner是执行任务的线程，outcome是返回的结果（正常结果或Exception结果）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WaitNode</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">volatile</span> Thread thread;</div><div class=\"line\">    <span class=\"keyword\">volatile</span> WaitNode next;</div><div class=\"line\">    WaitNode() &#123; thread = Thread.currentThread(); &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>waiters的数据结构是WaitNode，保存了Thread和下个WaitNode的引用。waiters保存了等待结果的线程，每次操作只会增减头，所以是一个栈结构，详细见后文对get方法的分析。</p>\n<h3 id=\"4-3-FutureTask的创建\"><a href=\"#4-3-FutureTask的创建\" class=\"headerlink\" title=\"4.3 FutureTask的创建\"></a>4.3 FutureTask的创建</h3><p>下面是FutureTask的两种创建方式：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">FutureTask</span><span class=\"params\">(Callable&lt;V&gt; callable)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (callable == <span class=\"keyword\">null</span>)</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</div><div class=\"line\">    <span class=\"keyword\">this</span>.callable = callable;</div><div class=\"line\">    <span class=\"keyword\">this</span>.state = NEW;       <span class=\"comment\">// ensure visibility of callable</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">FutureTask</span><span class=\"params\">(Runnable runnable, V result)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.callable = Executors.callable(runnable, result);</div><div class=\"line\">    <span class=\"keyword\">this</span>.state = NEW;       <span class=\"comment\">// ensure visibility of callable</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>提交FutureTask到线程池的submit定义在AbstractExecutorService，根据入参的不同，有三个submit方法。下面以提交Callable为例：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> &lt;T&gt; <span class=\"function\">Future&lt;T&gt; <span class=\"title\">submit</span><span class=\"params\">(Callable&lt;T&gt; task)</span> </span>&#123;</div><div class=\"line\">   <span class=\"keyword\">if</span> (task == <span class=\"keyword\">null</span>) <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</div><div class=\"line\">   RunnableFuture&lt;T&gt; ftask = newTaskFor(task);</div><div class=\"line\">   execute(ftask);</div><div class=\"line\">   <span class=\"keyword\">return</span> ftask;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">protected</span> &lt;T&gt; <span class=\"function\">RunnableFuture&lt;T&gt; <span class=\"title\">newTaskFor</span><span class=\"params\">(Callable&lt;T&gt; callable)</span> </span>&#123;    </div><div class=\"line\">   <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> FutureTask&lt;T&gt;(callable);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>FutureTask在newTaskFor创建，然后调用线程池的execute执行，最后返回Future。获取Future后，就可以调用get获取结果，或者调用cancel取消任务。</p>\n<h3 id=\"4-4-FutureTask的运行\"><a href=\"#4-4-FutureTask的运行\" class=\"headerlink\" title=\"4.4 FutureTask的运行\"></a>4.4 FutureTask的运行</h3><p>FutureTask实现了Runnable，在线程池里执行时调用的方法是run。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//1</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (state != NEW ||</div><div class=\"line\">        !UNSAFE.compareAndSwapObject(<span class=\"keyword\">this</span>, runnerOffset,<span class=\"keyword\">null</span>, Thread.currentThread()))</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">    <span class=\"comment\">//2</span></div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        Callable&lt;V&gt; c = callable;</div><div class=\"line\">        <span class=\"keyword\">if</span> (c != <span class=\"keyword\">null</span> &amp;&amp; state == NEW) &#123;</div><div class=\"line\">            V result;</div><div class=\"line\">            <span class=\"keyword\">boolean</span> ran;</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                result = c.call();</div><div class=\"line\">                ran = <span class=\"keyword\">true</span>;</div><div class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Throwable ex) &#123;</div><div class=\"line\">                result = <span class=\"keyword\">null</span>;</div><div class=\"line\">                ran = <span class=\"keyword\">false</span>;</div><div class=\"line\">                setException(ex);</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">if</span> (ran)</div><div class=\"line\">                set(result);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">       <span class=\"comment\">//3</span></div><div class=\"line\">        runner = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">        <span class=\"keyword\">if</span> (s &gt;= INTERRUPTING)</div><div class=\"line\">            handlePossibleCancellationInterrupt(s);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>标记1处检查FutureTask的状态，如果不是处于NEW，说明状态已经进入四条路径之一，也就没有必要继续了。如果状态是NEW，则将执行任务的线程交给runner。</p>\n<p>标记2处开始正式执行任务，调用call方法获取结果，没有异常就算成功，最后执行set方法；出现异常就调用setException方法。</p>\n<p>标记3处，无论任务执行是否成功，都需要将runner重新置为空。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">set</span><span class=\"params\">(V v)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (UNSAFE.compareAndSwapInt(<span class=\"keyword\">this</span>, stateOffset, NEW, COMPLETING)) &#123;</div><div class=\"line\">        outcome = v;</div><div class=\"line\">        UNSAFE.putOrderedInt(<span class=\"keyword\">this</span>, stateOffset, NORMAL); <span class=\"comment\">// final state</span></div><div class=\"line\">        finishCompletion();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">setException</span><span class=\"params\">(Throwable t)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (UNSAFE.compareAndSwapInt(<span class=\"keyword\">this</span>, stateOffset, NEW, COMPLETING)) &#123;</div><div class=\"line\">        outcome = t;</div><div class=\"line\">        UNSAFE.putOrderedInt(<span class=\"keyword\">this</span>, stateOffset, EXCEPTIONAL); <span class=\"comment\">// final state</span></div><div class=\"line\">        finishCompletion();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>任务执行成功与失败，分别对应NEW -&gt; COMPLETING -&gt; NORMAL和NEW -&gt; COMPLETING -&gt; EXCEPTIONAL两条路径。这里先将状态修改为中间状态，再对结果赋值，最后再修改为最终状态。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">finishCompletion</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">// assert state &gt; COMPLETING;</span></div><div class=\"line\">    <span class=\"keyword\">for</span> (WaitNode q; (q = waiters) != <span class=\"keyword\">null</span>;) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (UNSAFE.compareAndSwapObject(<span class=\"keyword\">this</span>, waitersOffset, q, <span class=\"keyword\">null</span>)) &#123;</div><div class=\"line\">            <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">                Thread t = q.thread;</div><div class=\"line\">                <span class=\"keyword\">if</span> (t != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">                    q.thread = <span class=\"keyword\">null</span>;</div><div class=\"line\">                    LockSupport.unpark(t);</div><div class=\"line\">                &#125;</div><div class=\"line\">                WaitNode next = q.next;</div><div class=\"line\">                <span class=\"keyword\">if</span> (next == <span class=\"keyword\">null</span>)</div><div class=\"line\">                    <span class=\"keyword\">break</span>;</div><div class=\"line\">                q.next = <span class=\"keyword\">null</span>; <span class=\"comment\">// unlink to help gc</span></div><div class=\"line\">                q = next;</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    done();</div><div class=\"line\">    callable = <span class=\"keyword\">null</span>;        <span class=\"comment\">// to reduce footprint</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>最后调用finishCompletion执行任务完成，唤醒并删除所有在waiters中等待的线程。done方法是空的，供子类实现，最后callable也设置为空。</p>\n<p>FutureTask还有个runAndReset，逻辑和run类似，但没有调用set方法来设置结果，执行完成后将任务重新初始化。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">boolean</span> <span class=\"title\">runAndReset</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (state != NEW ||</div><div class=\"line\">        !UNSAFE.compareAndSwapObject(<span class=\"keyword\">this</span>, runnerOffset,</div><div class=\"line\">                                     <span class=\"keyword\">null</span>, Thread.currentThread()))</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">boolean</span> ran = <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        Callable&lt;V&gt; c = callable;</div><div class=\"line\">        <span class=\"keyword\">if</span> (c != <span class=\"keyword\">null</span> &amp;&amp; s == NEW) &#123;</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                c.call(); <span class=\"comment\">// don't set result</span></div><div class=\"line\">                ran = <span class=\"keyword\">true</span>;</div><div class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Throwable ex) &#123;</div><div class=\"line\">                setException(ex);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">        <span class=\"comment\">// runner must be non-null until state is settled to</span></div><div class=\"line\">        <span class=\"comment\">// prevent concurrent calls to run()</span></div><div class=\"line\">        runner = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"comment\">// state must be re-read after nulling runner to prevent</span></div><div class=\"line\">        <span class=\"comment\">// leaked interrupts</span></div><div class=\"line\">        s = state;</div><div class=\"line\">        <span class=\"keyword\">if</span> (s &gt;= INTERRUPTING)</div><div class=\"line\">            handlePossibleCancellationInterrupt(s);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> ran &amp;&amp; s == NEW;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"4-5-FutureTask的取消\"><a href=\"#4-5-FutureTask的取消\" class=\"headerlink\" title=\"4.5 FutureTask的取消\"></a>4.5 FutureTask的取消</h3><p>对于已经提交执行的任务，可以调用cancel执行取消。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">cancel</span><span class=\"params\">(<span class=\"keyword\">boolean</span> mayInterruptIfRunning)</span> </span>&#123;</div><div class=\"line\">   <span class=\"comment\">//1</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (!(state == NEW &amp;&amp;</div><div class=\"line\">          UNSAFE.compareAndSwapInt(<span class=\"keyword\">this</span>, stateOffset, NEW,</div><div class=\"line\">              mayInterruptIfRunning ? INTERRUPTING : CANCELLED)))</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;    <span class=\"comment\">// in case call to interrupt throws exception</span></div><div class=\"line\">       <span class=\"comment\">//2</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (mayInterruptIfRunning) &#123;</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                Thread t = runner;</div><div class=\"line\">                <span class=\"keyword\">if</span> (t != <span class=\"keyword\">null</span>)</div><div class=\"line\">                    t.interrupt();</div><div class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123; <span class=\"comment\">// final state</span></div><div class=\"line\">                UNSAFE.putOrderedInt(<span class=\"keyword\">this</span>, stateOffset, INTERRUPTED);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">        finishCompletion();</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>标记1处判断任务状态，为NEW才能被取消。如果mayInterruptIfRunning是true，代表任务需要被中断，走NEW -&gt; INTERRUPTING -&gt; INTERRUPTED流程。否则代表任务被取消，走NEW -&gt; CANCELLED流程。</p>\n<p>标记2处理任务被中断的情况，这里仅仅是对线程发出中断请求，不确保任务能检测并处理中断，详细原理去看Java的中断机制。</p>\n<p>最后调用finishCompletion完成收尾工作。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isCancelled</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> state &gt;= CANCELLED;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>判断任务是否被取消，具体逻辑是判断state &gt;= CANCELLED，包括了被中断一共两条路径的结果。</p>\n<h3 id=\"4-5-FutureTask获取结果\"><a href=\"#4-5-FutureTask获取结果\" class=\"headerlink\" title=\"4.5 FutureTask获取结果\"></a>4.5 FutureTask获取结果</h3><p>调用FutureTask的get方法获取任务的执行结果，可以阻塞直到获取结果，也可以限制范围时间内获取结果，否则抛出TimeoutException。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">get</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">    <span class=\"keyword\">if</span> (s &lt;= COMPLETING)</div><div class=\"line\">        s = awaitDone(<span class=\"keyword\">false</span>, <span class=\"number\">0L</span>);</div><div class=\"line\">    <span class=\"keyword\">return</span> report(s);</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">get</span><span class=\"params\">(<span class=\"keyword\">long</span> timeout, TimeUnit unit)</span></span></div><div class=\"line\">    <span class=\"keyword\">throws</span> InterruptedException, ExecutionException, TimeoutException &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (unit == <span class=\"keyword\">null</span>)</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</div><div class=\"line\">    <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">    <span class=\"keyword\">if</span> (s &lt;= COMPLETING &amp;&amp;</div><div class=\"line\">        (s = awaitDone(<span class=\"keyword\">true</span>, unit.toNanos(timeout))) &lt;= COMPLETING)</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> TimeoutException();</div><div class=\"line\">    <span class=\"keyword\">return</span> report(s);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>get的核心实现调用了awaitDone，入参为是否开启时间限制和最大的等待时间。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> <span class=\"title\">awaitDone</span><span class=\"params\">(<span class=\"keyword\">boolean</span> timed, <span class=\"keyword\">long</span> nanos)</span></span></div><div class=\"line\">    <span class=\"keyword\">throws</span> InterruptedException &#123;</div><div class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> deadline = timed ? System.nanoTime() + nanos : <span class=\"number\">0L</span>;</div><div class=\"line\">    WaitNode q = <span class=\"keyword\">null</span>;</div><div class=\"line\">    <span class=\"keyword\">boolean</span> queued = <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (Thread.interrupted()) &#123;</div><div class=\"line\">            removeWaiter(q);</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> InterruptedException();</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">        <span class=\"keyword\">if</span> (s &gt; COMPLETING) &#123;    <span class=\"comment\">//1</span></div><div class=\"line\">            <span class=\"keyword\">if</span> (q != <span class=\"keyword\">null</span>)</div><div class=\"line\">                q.thread = <span class=\"keyword\">null</span>;</div><div class=\"line\">            <span class=\"keyword\">return</span> s;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (s == COMPLETING) <span class=\"comment\">// cannot time out yet    //2</span></div><div class=\"line\">            Thread.yield();</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (q == <span class=\"keyword\">null</span>)     <span class=\"comment\">//3</span></div><div class=\"line\">            q = <span class=\"keyword\">new</span> WaitNode();</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!queued)    <span class=\"comment\">//4</span></div><div class=\"line\">            queued = UNSAFE.compareAndSwapObject(<span class=\"keyword\">this</span>, waitersOffset,</div><div class=\"line\">                                                 q.next = waiters, q);</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (timed) &#123;    <span class=\"comment\">//5</span></div><div class=\"line\">            nanos = deadline - System.nanoTime();</div><div class=\"line\">            <span class=\"keyword\">if</span> (nanos &lt;= <span class=\"number\">0L</span>) &#123;</div><div class=\"line\">                removeWaiter(q);</div><div class=\"line\">                <span class=\"keyword\">return</span> state;</div><div class=\"line\">            &#125;</div><div class=\"line\">            LockSupport.parkNanos(<span class=\"keyword\">this</span>, nanos);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span>     <span class=\"comment\">//6</span></div><div class=\"line\">            LockSupport.park(<span class=\"keyword\">this</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>awaitDone主要逻辑是一个无限循环，首先判断线程是否被中断，是的话移除waiter并抛出中断异常。接下来是一串if-else，一共六种情况。</p>\n<ol>\n<li>判断任务状态是否已经完成，是就直接返回；</li>\n<li>任务状态是COMPLETING，代表在set结果时被阻塞了，这里先让出资源；</li>\n<li>如果WaitNode为空，就为当前线程初始化一个WaitNode；</li>\n<li>如果当前的WaitNode还没有加入waiters，就加入；</li>\n<li>如果是限定时间执行，判断有无超时，超时就将waiter移出，并返回结果，否则阻塞一定时间；</li>\n<li>如果没有限定时间，就一直阻塞到下次被唤醒。</li>\n</ol>\n<p>LockSupport是用来创建锁和其他同步类的基本线程阻塞原语。park和unpark的作用分别是阻塞线程和解除阻塞线程。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> V <span class=\"title\">report</span><span class=\"params\">(<span class=\"keyword\">int</span> s)</span> <span class=\"keyword\">throws</span> ExecutionException </span>&#123;</div><div class=\"line\">   Object x = outcome;</div><div class=\"line\">   <span class=\"keyword\">if</span> (s == NORMAL)</div><div class=\"line\">       <span class=\"keyword\">return</span> (V)x;</div><div class=\"line\">   <span class=\"keyword\">if</span> (s &gt;= CANCELLED)</div><div class=\"line\">       <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> CancellationException();</div><div class=\"line\">   <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> ExecutionException((Throwable)x);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>最后get调用report，使用outcome返回结果。</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/3294095-123399195bd337cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"此处输入图片的描述\"></p>\n<p>如果多个线程向同一个FutureTask实例get结果，但FutureTask又没有执行完毕，线程将会阻塞并保存在waiters中。待FutureTask获取结果后，唤醒waiters等待的线程，并返回同一个结果。</p>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<h2 id=\"1-概述\"><a href=\"#1-概述\" class=\"headerlink\" title=\"1. 概述\"></a>1. 概述</h2><p>在线程池中执行任务，使用execute()方法，执行的是Runnable任务，它不返回任何值。如果希望任务完成后返回结果，那么需要使用Callable接口，这也是本文要研究的主题。</p>","more":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CallableTest</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tCallable&lt;Integer&gt; callable = <span class=\"keyword\">new</span> Callable&lt;Integer&gt;() &#123;</div><div class=\"line\">\t\t\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> Integer <span class=\"title\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">\t\t\t\tSystem.out.println(<span class=\"string\">\"callable线程执行\"</span>);</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Random().nextInt(<span class=\"number\">100</span>);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;;</div><div class=\"line\"></div><div class=\"line\">\t\tExecutorService executorService = Executors.newSingleThreadExecutor();</div><div class=\"line\">\t\tFuture&lt;Integer&gt; future = executorService.submit(callable);</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">// 限定时间获取结果</span></div><div class=\"line\">\t\t\tSystem.out.println(future.get(<span class=\"number\">5</span>, TimeUnit.SECONDS));</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (TimeoutException e) &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">// 超时触发线程中止</span></div><div class=\"line\">\t\t\te.printStackTrace();</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\te.printStackTrace();</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (ExecutionException e) &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">// 抛出执行异常</span></div><div class=\"line\">\t\t\te.printStackTrace();</div><div class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">\t\t\t<span class=\"comment\">// 如果任务还在运行，执行中断</span></div><div class=\"line\">\t\t\t<span class=\"keyword\">boolean</span> mayInterruptIfRunning = <span class=\"keyword\">true</span>;</div><div class=\"line\">\t\t\tfuture.cancel(mayInterruptIfRunning);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>上面是callable和future的简单应用，执行时要求在限定时间内获取结果，超时执行会抛出TimeoutException，执行异常会抛出ExecutionException。最后在finally里，如果任务还在执行，就进行取消；如果任务已经执行完，取消操作也没有影响。</p>\n<h2 id=\"2-Callable接口\"><a href=\"#2-Callable接口\" class=\"headerlink\" title=\"2. Callable接口\"></a>2. Callable接口</h2><p>我们先回顾一下java.lang.Runnable接口，就声明了run(),其返回值为void，当然就无法获取结果了。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Runnable</span> </span>&#123;  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>;  </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>而callable的接口定义如下：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Callable</span>&lt;<span class=\"title\">V</span>&gt; </span>&#123;   </div><div class=\"line\">      <span class=\"function\">V   <span class=\"title\">call</span><span class=\"params\">()</span>   <span class=\"keyword\">throws</span> Exception</span>;   </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>callable接口声明call()方法，有返回值，也可抛出异常，对该接口我们先了解这么多就行，下面我们来说明如何使用。</p>\n<p>无论是Runnable接口的实现类还是Callable接口的实现类，都可以被ThreadPoolExecutor或ScheduledThreadPoolExecutor执行，ThreadPoolExecutor或ScheduledThreadPoolExecutor都实现了ExcutorService接口，而因此Callable需要和Executor框架中的ExcutorService结合使用，我们先看看ExecutorService提供的方法：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;T&gt; <span class=\"function\">Future&lt;T&gt; <span class=\"title\">submit</span><span class=\"params\">(Callable&lt;T&gt; task)</span></span>;  </div><div class=\"line\">Future&lt;?&gt; submit(Runnable task);  </div><div class=\"line\">&lt;T&gt; <span class=\"function\">Future&lt;T&gt; <span class=\"title\">submit</span><span class=\"params\">(Runnable task, T result)</span></span>;</div></pre></td></tr></table></figure></p>\n<ul>\n<li>第一个方法：submit提交一个实现Callable接口的任务，并且返回封装了异步计算结果的Future。</li>\n<li>第二个方法：submit提交一个实现Runnable接口的任务，并且返回封装了异步计算结果的Future。</li>\n<li>第三个方法：submit提交一个实现Runnable接口的任务，并且指定了在调用Future的get方法时返回的result对象。这个用的很少，因为是自己给定的返回结果，意义不大。</li>\n</ul>\n<p>因此我们只要创建好我们的线程对象（实现Callable接口或者Runnable接口），然后通过上面3个方法提交给线程池去执行即可。<br>还有点要注意的是，除了我们自己实现Callable对象外，我们还可以使用工厂类Executors来把一个Runnable对象包装成Callable对象。Executors工厂类提供的方法如下：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Callable&lt;Object&gt; <span class=\"title\">callable</span><span class=\"params\">(Runnable task)</span>  </span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> &lt;T&gt; Callable&lt;T&gt; <span class=\"title\">callable</span><span class=\"params\">(Runnable task, T result)</span></div></pre></td></tr></table></figure></p>\n<h2 id=\"3-Future接口\"><a href=\"#3-Future接口\" class=\"headerlink\" title=\"3. Future接口\"></a>3. Future接口</h2><p>Future<v>接口是用来获取异步计算结果的，说白了就是对具体的Runnable或者Callable对象任务执行的结果进行获取(get()),取消(cancel()),判断是否完成等操作。我们看看Future接口的源码：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Future</span>&lt;<span class=\"title\">V</span>&gt; </span>&#123;  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">cancel</span><span class=\"params\">(<span class=\"keyword\">boolean</span> mayInterruptIfRunning)</span></span>;  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">isCancelled</span><span class=\"params\">()</span></span>;  </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">isDone</span><span class=\"params\">()</span></span>;  </div><div class=\"line\">    <span class=\"function\">V <span class=\"title\">get</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException</span>;  </div><div class=\"line\">    <span class=\"function\">V <span class=\"title\">get</span><span class=\"params\">(<span class=\"keyword\">long</span> timeout, TimeUnit unit)</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException, TimeoutException</span>;  </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></v></p>\n<p>方法解析：</p>\n<ul>\n<li>get(): 获取异步执行的结果，如果没有结果可用，此方法会阻塞直到异步计算完成。</li>\n<li>get(long timeout, TimeUnit unit):获取异步执行结果，如果没有结果可用，此方法会阻塞，但是会有时间限制，如果阻塞时间超过设定的timeout时间，该方法将抛出异常。</li>\n<li>isDone():如果任务执行结束，无论是正常结束或是中途取消还是发生异常，都返回true。</li>\n<li>isCancelled():如果任务完成前被取消，则返回true。</li>\n<li>cancel():<ul>\n<li>如果任务还没开始，执行cancel(…)方法将返回false</li>\n<li>如果任务已经启动，执行cancel(true)方法将以中断执行此任务线程的方式来试图停止任务，如果停止成功，返回true；当任务已经启动，执行cancel(false)方法将不会对正在执行的任务线程产生影响(让线程正常执行到完成)，此时返回false</li>\n<li>当任务已经完成，执行cancel(…)方法将返回false</li>\n</ul>\n</li>\n</ul>\n<p>通过方法分析我们也知道实际上Future提供了3种功能：</p>\n<ol>\n<li>能够中断执行中的任务</li>\n<li>判断任务是否执行完成</li>\n<li>获取任务执行完成后额结果。</li>\n</ol>\n<p>但是我们必须明白Future只是一个接口，我们无法直接创建对象，因此就需要其实现类FutureTask登场啦</p>\n<h2 id=\"4-FutureTask\"><a href=\"#4-FutureTask\" class=\"headerlink\" title=\"4. FutureTask\"></a>4. FutureTask</h2><p>————————-<img src=\"http://upload-images.jianshu.io/upload_images/3294095-237f514c17eb5e4a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"此处输入图片的描述\">————————–<br>FutureTask除了实现了Future接口外还实现了Runnable接口，因此FutureTask也可以直接提交给Executor执行。 当然也可以调用线程直接执行（FutureTask.run()）.</p>\n<h3 id=\"4-1-FutureTask的状态\"><a href=\"#4-1-FutureTask的状态\" class=\"headerlink\" title=\"4.1 FutureTask的状态\"></a>4.1 FutureTask的状态</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">int</span> state;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> NEW          = <span class=\"number\">0</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> COMPLETING   = <span class=\"number\">1</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> NORMAL       = <span class=\"number\">2</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> EXCEPTIONAL  = <span class=\"number\">3</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> CANCELLED    = <span class=\"number\">4</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> INTERRUPTING = <span class=\"number\">5</span>;</div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">int</span> INTERRUPTED  = <span class=\"number\">6</span>;</div></pre></td></tr></table></figure>\n<p>FutureTask有7种状态，初始状态从NEW开始，状态转换路径可以归纳为图2所示。在后文的代码，会使用int的大小比较判断状态处于哪个范围，需要留意上面状态的排列顺序<br><img src=\"http://upload-images.jianshu.io/upload_images/3294095-66574ae94d956415.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"FutureTask的状态\"><br>FutureTask的状态路径，取决于run和cancel的调用顺序，在后文分析时，对号入座这几条路径。</p>\n<ol>\n<li>NEW -&gt; COMPLETING -&gt; NORMAL 正常的流程</li>\n<li>NEW -&gt; COMPLETING -&gt; EXCEPTIONAL 异常的流程</li>\n<li>NEW -&gt; CANCELLED 被取消流程</li>\n<li>NEW -&gt; INTERRUPTING -&gt; INTERRUPTED 被中断流程</li>\n</ol>\n<h3 id=\"4-2-FutureTask的变量\"><a href=\"#4-2-FutureTask的变量\" class=\"headerlink\" title=\"4.2 FutureTask的变量\"></a>4.2 FutureTask的变量</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">int</span> state;</div><div class=\"line\"><span class=\"comment\">/** The underlying callable; nulled out after running */</span></div><div class=\"line\"><span class=\"keyword\">private</span> Callable&lt;V&gt; callable;</div><div class=\"line\"><span class=\"comment\">/** The result to return or exception to throw from get() */</span></div><div class=\"line\"><span class=\"keyword\">private</span> Object outcome; <span class=\"comment\">// non-volatile, protected by state reads/writes</span></div><div class=\"line\"><span class=\"comment\">/** The thread running the callable; CASed during run() */</span></div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> Thread runner;</div><div class=\"line\"><span class=\"comment\">/** Treiber stack of waiting threads */</span></div><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> WaitNode waiters;</div></pre></td></tr></table></figure>\n<p>state、runner、waiters三个变量没有使用原子类，而是使用Unsafe对象进行原子操作。代码中会见到很多形如compareAndSwap的方法，入门原理可以看<a href=\"http://www.jianshu.com/p/e2179c74a2e4\" target=\"_blank\" rel=\"noopener\">认识非阻塞的同步机制CAS</a>。</p>\n<p>callable是要执行的任务，runner是执行任务的线程，outcome是返回的结果（正常结果或Exception结果）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WaitNode</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">volatile</span> Thread thread;</div><div class=\"line\">    <span class=\"keyword\">volatile</span> WaitNode next;</div><div class=\"line\">    WaitNode() &#123; thread = Thread.currentThread(); &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>waiters的数据结构是WaitNode，保存了Thread和下个WaitNode的引用。waiters保存了等待结果的线程，每次操作只会增减头，所以是一个栈结构，详细见后文对get方法的分析。</p>\n<h3 id=\"4-3-FutureTask的创建\"><a href=\"#4-3-FutureTask的创建\" class=\"headerlink\" title=\"4.3 FutureTask的创建\"></a>4.3 FutureTask的创建</h3><p>下面是FutureTask的两种创建方式：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">FutureTask</span><span class=\"params\">(Callable&lt;V&gt; callable)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (callable == <span class=\"keyword\">null</span>)</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</div><div class=\"line\">    <span class=\"keyword\">this</span>.callable = callable;</div><div class=\"line\">    <span class=\"keyword\">this</span>.state = NEW;       <span class=\"comment\">// ensure visibility of callable</span></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">FutureTask</span><span class=\"params\">(Runnable runnable, V result)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.callable = Executors.callable(runnable, result);</div><div class=\"line\">    <span class=\"keyword\">this</span>.state = NEW;       <span class=\"comment\">// ensure visibility of callable</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>提交FutureTask到线程池的submit定义在AbstractExecutorService，根据入参的不同，有三个submit方法。下面以提交Callable为例：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> &lt;T&gt; <span class=\"function\">Future&lt;T&gt; <span class=\"title\">submit</span><span class=\"params\">(Callable&lt;T&gt; task)</span> </span>&#123;</div><div class=\"line\">   <span class=\"keyword\">if</span> (task == <span class=\"keyword\">null</span>) <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</div><div class=\"line\">   RunnableFuture&lt;T&gt; ftask = newTaskFor(task);</div><div class=\"line\">   execute(ftask);</div><div class=\"line\">   <span class=\"keyword\">return</span> ftask;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">protected</span> &lt;T&gt; <span class=\"function\">RunnableFuture&lt;T&gt; <span class=\"title\">newTaskFor</span><span class=\"params\">(Callable&lt;T&gt; callable)</span> </span>&#123;    </div><div class=\"line\">   <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> FutureTask&lt;T&gt;(callable);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>FutureTask在newTaskFor创建，然后调用线程池的execute执行，最后返回Future。获取Future后，就可以调用get获取结果，或者调用cancel取消任务。</p>\n<h3 id=\"4-4-FutureTask的运行\"><a href=\"#4-4-FutureTask的运行\" class=\"headerlink\" title=\"4.4 FutureTask的运行\"></a>4.4 FutureTask的运行</h3><p>FutureTask实现了Runnable，在线程池里执行时调用的方法是run。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//1</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (state != NEW ||</div><div class=\"line\">        !UNSAFE.compareAndSwapObject(<span class=\"keyword\">this</span>, runnerOffset,<span class=\"keyword\">null</span>, Thread.currentThread()))</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">    <span class=\"comment\">//2</span></div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        Callable&lt;V&gt; c = callable;</div><div class=\"line\">        <span class=\"keyword\">if</span> (c != <span class=\"keyword\">null</span> &amp;&amp; state == NEW) &#123;</div><div class=\"line\">            V result;</div><div class=\"line\">            <span class=\"keyword\">boolean</span> ran;</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                result = c.call();</div><div class=\"line\">                ran = <span class=\"keyword\">true</span>;</div><div class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Throwable ex) &#123;</div><div class=\"line\">                result = <span class=\"keyword\">null</span>;</div><div class=\"line\">                ran = <span class=\"keyword\">false</span>;</div><div class=\"line\">                setException(ex);</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">if</span> (ran)</div><div class=\"line\">                set(result);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">       <span class=\"comment\">//3</span></div><div class=\"line\">        runner = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">        <span class=\"keyword\">if</span> (s &gt;= INTERRUPTING)</div><div class=\"line\">            handlePossibleCancellationInterrupt(s);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>标记1处检查FutureTask的状态，如果不是处于NEW，说明状态已经进入四条路径之一，也就没有必要继续了。如果状态是NEW，则将执行任务的线程交给runner。</p>\n<p>标记2处开始正式执行任务，调用call方法获取结果，没有异常就算成功，最后执行set方法；出现异常就调用setException方法。</p>\n<p>标记3处，无论任务执行是否成功，都需要将runner重新置为空。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">set</span><span class=\"params\">(V v)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (UNSAFE.compareAndSwapInt(<span class=\"keyword\">this</span>, stateOffset, NEW, COMPLETING)) &#123;</div><div class=\"line\">        outcome = v;</div><div class=\"line\">        UNSAFE.putOrderedInt(<span class=\"keyword\">this</span>, stateOffset, NORMAL); <span class=\"comment\">// final state</span></div><div class=\"line\">        finishCompletion();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">setException</span><span class=\"params\">(Throwable t)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (UNSAFE.compareAndSwapInt(<span class=\"keyword\">this</span>, stateOffset, NEW, COMPLETING)) &#123;</div><div class=\"line\">        outcome = t;</div><div class=\"line\">        UNSAFE.putOrderedInt(<span class=\"keyword\">this</span>, stateOffset, EXCEPTIONAL); <span class=\"comment\">// final state</span></div><div class=\"line\">        finishCompletion();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>任务执行成功与失败，分别对应NEW -&gt; COMPLETING -&gt; NORMAL和NEW -&gt; COMPLETING -&gt; EXCEPTIONAL两条路径。这里先将状态修改为中间状态，再对结果赋值，最后再修改为最终状态。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">finishCompletion</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">// assert state &gt; COMPLETING;</span></div><div class=\"line\">    <span class=\"keyword\">for</span> (WaitNode q; (q = waiters) != <span class=\"keyword\">null</span>;) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (UNSAFE.compareAndSwapObject(<span class=\"keyword\">this</span>, waitersOffset, q, <span class=\"keyword\">null</span>)) &#123;</div><div class=\"line\">            <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">                Thread t = q.thread;</div><div class=\"line\">                <span class=\"keyword\">if</span> (t != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">                    q.thread = <span class=\"keyword\">null</span>;</div><div class=\"line\">                    LockSupport.unpark(t);</div><div class=\"line\">                &#125;</div><div class=\"line\">                WaitNode next = q.next;</div><div class=\"line\">                <span class=\"keyword\">if</span> (next == <span class=\"keyword\">null</span>)</div><div class=\"line\">                    <span class=\"keyword\">break</span>;</div><div class=\"line\">                q.next = <span class=\"keyword\">null</span>; <span class=\"comment\">// unlink to help gc</span></div><div class=\"line\">                q = next;</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">break</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    done();</div><div class=\"line\">    callable = <span class=\"keyword\">null</span>;        <span class=\"comment\">// to reduce footprint</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>最后调用finishCompletion执行任务完成，唤醒并删除所有在waiters中等待的线程。done方法是空的，供子类实现，最后callable也设置为空。</p>\n<p>FutureTask还有个runAndReset，逻辑和run类似，但没有调用set方法来设置结果，执行完成后将任务重新初始化。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">boolean</span> <span class=\"title\">runAndReset</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (state != NEW ||</div><div class=\"line\">        !UNSAFE.compareAndSwapObject(<span class=\"keyword\">this</span>, runnerOffset,</div><div class=\"line\">                                     <span class=\"keyword\">null</span>, Thread.currentThread()))</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">boolean</span> ran = <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        Callable&lt;V&gt; c = callable;</div><div class=\"line\">        <span class=\"keyword\">if</span> (c != <span class=\"keyword\">null</span> &amp;&amp; s == NEW) &#123;</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                c.call(); <span class=\"comment\">// don't set result</span></div><div class=\"line\">                ran = <span class=\"keyword\">true</span>;</div><div class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Throwable ex) &#123;</div><div class=\"line\">                setException(ex);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">        <span class=\"comment\">// runner must be non-null until state is settled to</span></div><div class=\"line\">        <span class=\"comment\">// prevent concurrent calls to run()</span></div><div class=\"line\">        runner = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"comment\">// state must be re-read after nulling runner to prevent</span></div><div class=\"line\">        <span class=\"comment\">// leaked interrupts</span></div><div class=\"line\">        s = state;</div><div class=\"line\">        <span class=\"keyword\">if</span> (s &gt;= INTERRUPTING)</div><div class=\"line\">            handlePossibleCancellationInterrupt(s);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> ran &amp;&amp; s == NEW;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"4-5-FutureTask的取消\"><a href=\"#4-5-FutureTask的取消\" class=\"headerlink\" title=\"4.5 FutureTask的取消\"></a>4.5 FutureTask的取消</h3><p>对于已经提交执行的任务，可以调用cancel执行取消。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">cancel</span><span class=\"params\">(<span class=\"keyword\">boolean</span> mayInterruptIfRunning)</span> </span>&#123;</div><div class=\"line\">   <span class=\"comment\">//1</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (!(state == NEW &amp;&amp;</div><div class=\"line\">          UNSAFE.compareAndSwapInt(<span class=\"keyword\">this</span>, stateOffset, NEW,</div><div class=\"line\">              mayInterruptIfRunning ? INTERRUPTING : CANCELLED)))</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;    <span class=\"comment\">// in case call to interrupt throws exception</span></div><div class=\"line\">       <span class=\"comment\">//2</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (mayInterruptIfRunning) &#123;</div><div class=\"line\">            <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                Thread t = runner;</div><div class=\"line\">                <span class=\"keyword\">if</span> (t != <span class=\"keyword\">null</span>)</div><div class=\"line\">                    t.interrupt();</div><div class=\"line\">            &#125; <span class=\"keyword\">finally</span> &#123; <span class=\"comment\">// final state</span></div><div class=\"line\">                UNSAFE.putOrderedInt(<span class=\"keyword\">this</span>, stateOffset, INTERRUPTED);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">        finishCompletion();</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>标记1处判断任务状态，为NEW才能被取消。如果mayInterruptIfRunning是true，代表任务需要被中断，走NEW -&gt; INTERRUPTING -&gt; INTERRUPTED流程。否则代表任务被取消，走NEW -&gt; CANCELLED流程。</p>\n<p>标记2处理任务被中断的情况，这里仅仅是对线程发出中断请求，不确保任务能检测并处理中断，详细原理去看Java的中断机制。</p>\n<p>最后调用finishCompletion完成收尾工作。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isCancelled</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> state &gt;= CANCELLED;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>判断任务是否被取消，具体逻辑是判断state &gt;= CANCELLED，包括了被中断一共两条路径的结果。</p>\n<h3 id=\"4-5-FutureTask获取结果\"><a href=\"#4-5-FutureTask获取结果\" class=\"headerlink\" title=\"4.5 FutureTask获取结果\"></a>4.5 FutureTask获取结果</h3><p>调用FutureTask的get方法获取任务的执行结果，可以阻塞直到获取结果，也可以限制范围时间内获取结果，否则抛出TimeoutException。<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">get</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException, ExecutionException </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">    <span class=\"keyword\">if</span> (s &lt;= COMPLETING)</div><div class=\"line\">        s = awaitDone(<span class=\"keyword\">false</span>, <span class=\"number\">0L</span>);</div><div class=\"line\">    <span class=\"keyword\">return</span> report(s);</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> V <span class=\"title\">get</span><span class=\"params\">(<span class=\"keyword\">long</span> timeout, TimeUnit unit)</span></span></div><div class=\"line\">    <span class=\"keyword\">throws</span> InterruptedException, ExecutionException, TimeoutException &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span> (unit == <span class=\"keyword\">null</span>)</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> NullPointerException();</div><div class=\"line\">    <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">    <span class=\"keyword\">if</span> (s &lt;= COMPLETING &amp;&amp;</div><div class=\"line\">        (s = awaitDone(<span class=\"keyword\">true</span>, unit.toNanos(timeout))) &lt;= COMPLETING)</div><div class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> TimeoutException();</div><div class=\"line\">    <span class=\"keyword\">return</span> report(s);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>get的核心实现调用了awaitDone，入参为是否开启时间限制和最大的等待时间。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> <span class=\"title\">awaitDone</span><span class=\"params\">(<span class=\"keyword\">boolean</span> timed, <span class=\"keyword\">long</span> nanos)</span></span></div><div class=\"line\">    <span class=\"keyword\">throws</span> InterruptedException &#123;</div><div class=\"line\">    <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> deadline = timed ? System.nanoTime() + nanos : <span class=\"number\">0L</span>;</div><div class=\"line\">    WaitNode q = <span class=\"keyword\">null</span>;</div><div class=\"line\">    <span class=\"keyword\">boolean</span> queued = <span class=\"keyword\">false</span>;</div><div class=\"line\">    <span class=\"keyword\">for</span> (;;) &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (Thread.interrupted()) &#123;</div><div class=\"line\">            removeWaiter(q);</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> InterruptedException();</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">int</span> s = state;</div><div class=\"line\">        <span class=\"keyword\">if</span> (s &gt; COMPLETING) &#123;    <span class=\"comment\">//1</span></div><div class=\"line\">            <span class=\"keyword\">if</span> (q != <span class=\"keyword\">null</span>)</div><div class=\"line\">                q.thread = <span class=\"keyword\">null</span>;</div><div class=\"line\">            <span class=\"keyword\">return</span> s;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (s == COMPLETING) <span class=\"comment\">// cannot time out yet    //2</span></div><div class=\"line\">            Thread.yield();</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (q == <span class=\"keyword\">null</span>)     <span class=\"comment\">//3</span></div><div class=\"line\">            q = <span class=\"keyword\">new</span> WaitNode();</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!queued)    <span class=\"comment\">//4</span></div><div class=\"line\">            queued = UNSAFE.compareAndSwapObject(<span class=\"keyword\">this</span>, waitersOffset,</div><div class=\"line\">                                                 q.next = waiters, q);</div><div class=\"line\">        <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (timed) &#123;    <span class=\"comment\">//5</span></div><div class=\"line\">            nanos = deadline - System.nanoTime();</div><div class=\"line\">            <span class=\"keyword\">if</span> (nanos &lt;= <span class=\"number\">0L</span>) &#123;</div><div class=\"line\">                removeWaiter(q);</div><div class=\"line\">                <span class=\"keyword\">return</span> state;</div><div class=\"line\">            &#125;</div><div class=\"line\">            LockSupport.parkNanos(<span class=\"keyword\">this</span>, nanos);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">else</span>     <span class=\"comment\">//6</span></div><div class=\"line\">            LockSupport.park(<span class=\"keyword\">this</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>awaitDone主要逻辑是一个无限循环，首先判断线程是否被中断，是的话移除waiter并抛出中断异常。接下来是一串if-else，一共六种情况。</p>\n<ol>\n<li>判断任务状态是否已经完成，是就直接返回；</li>\n<li>任务状态是COMPLETING，代表在set结果时被阻塞了，这里先让出资源；</li>\n<li>如果WaitNode为空，就为当前线程初始化一个WaitNode；</li>\n<li>如果当前的WaitNode还没有加入waiters，就加入；</li>\n<li>如果是限定时间执行，判断有无超时，超时就将waiter移出，并返回结果，否则阻塞一定时间；</li>\n<li>如果没有限定时间，就一直阻塞到下次被唤醒。</li>\n</ol>\n<p>LockSupport是用来创建锁和其他同步类的基本线程阻塞原语。park和unpark的作用分别是阻塞线程和解除阻塞线程。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> V <span class=\"title\">report</span><span class=\"params\">(<span class=\"keyword\">int</span> s)</span> <span class=\"keyword\">throws</span> ExecutionException </span>&#123;</div><div class=\"line\">   Object x = outcome;</div><div class=\"line\">   <span class=\"keyword\">if</span> (s == NORMAL)</div><div class=\"line\">       <span class=\"keyword\">return</span> (V)x;</div><div class=\"line\">   <span class=\"keyword\">if</span> (s &gt;= CANCELLED)</div><div class=\"line\">       <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> CancellationException();</div><div class=\"line\">   <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> ExecutionException((Throwable)x);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>最后get调用report，使用outcome返回结果。</p>\n<p><img src=\"http://upload-images.jianshu.io/upload_images/3294095-123399195bd337cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"此处输入图片的描述\"></p>\n<p>如果多个线程向同一个FutureTask实例get结果，但FutureTask又没有执行完毕，线程将会阻塞并保存在waiters中。待FutureTask获取结果后，唤醒waiters等待的线程，并返回同一个结果。</p>"},{"title":"Java中读取properties","date":"2017-12-19T03:41:35.000Z","_content":"\n将一些业务常量配置成properties文件，是扩展程序兼容性的常用做法。在业务变更导致数据需要改变时，不需要修改代码，只用更改配置文件并重启即可生效。\n\n<!-- more -->\n\n## 方法一：IO实现\n```java\npublic static String getValue(String fileNamePath, String key) throws IOException {\n    Properties props = new Properties();\n    InputStream in = null;\n    \n    try {\n        in = new FileInputStream(fileNamePath);\n        //如果将in改为下面的方法，必须要将.Properties文件和此class类文件放在同一个包中    \n        //in = propertiesTools.class.getResourceAsStream(fileNamePath); \n        props.load(in);\n        String value = props.getProperty(key);\n        // 有乱码时要进行重新编码    \n        // new String(props.getProperty(\"name\").getBytes(\"ISO-8859-1\"), \"GBK\");\n        return value;\n    } catch (FileNotFoundException e) {\n        return null;\n    } finally {\n        if (null != in) {\n            in.close();\n        }\n    }\n}\n```\n\n## 方法二：spring实现\n\n在spring扫描配置文件时，将properties中的key和value放入一个map中。\n\n 1. Spring配置\n\n  ```xml\n <bean id=\"propertyConfigurer\" class=\"com.hapishop.util.ProjectDBinfoConfigurer\">\n        <property name=\"locations\">\n            <list>\n                <value>classpath*:/META-INF/*.properties</value>\n                <value>file:conf/*.properties</value>\n            </list>\n        </property>\n    </bean>\n  ```\n\n 2. 自定义CustomizedPropertyConfigurer,继承**PropertyPlaceholderConfigurer**\n\n    ```java\n    public class CustomizedPropertyConfigurer extends PropertyPlaceholderConfigurer {\n        private static Map<String, String> properties = new HashMap<String, String>();\n\n        protected void processProperties(ConfigurableListableBeanFactory beanFactoryToProcess, Properties props) throws BeansException {\n            // cache the properties\n            PropertyPlaceholderHelper helper = new PropertyPlaceholderHelper(DEFAULT_PLACEHOLDER_PREFIX,DEFAULT_PLACEHOLDER_SUFFIX, DEFAULT_VALUE_SEPARATOR, false);\n            for (Entry<Object, Object> entry : props.entrySet()) {\n                String stringKey = String.valueOf(entry.getKey());\n                String stringValue = String.valueOf(entry.getValue());\n                stringValue = helper.replacePlaceholders(stringValue, props);\n                properties.put(stringKey, stringValue);\n            }\n            super.processProperties(beanFactoryToProcess, props);\n        }\n\n        public static Map<String, String> getProperties() {\n            return properties;\n        }\n    \n        public static String getProperty(String key) {\n            return properties.get(key);\n        }\n} \n    ```\n    \n 3. 配置properties\n\n    ```xml\n    site=iteye  \n    blog=antlove  \n    url=${site}/${blog} \n    ```\n    \n\n 4. Java获取\n\n    ```java\n    //调用此方法获取value\n    CustomizedPropertyConfigurer.getContextProperty()\n    ```\n\n## 方法三：注解实现\n\n - Spring配置\n  \n  ```xml\n <bean id=\"propertyConfigurer\" class=\"com.hapishop.util.ProjectDBinfoConfigurer\">\n        <property name=\"locations\">\n            <list>\n                <value>classpath*:/META-INF/*.properties</value>\n                <value>file:conf/*.properties</value>\n            </list>\n        </property>\n    </bean>\n  ```\n  \n - 注解获取\n\n    ```java\n    @Value(\"${socket.time.out}\")\n    int socketTimeout;\n    \n    public void setSocketTimeout(int socketTimeout) {  \n        this.socketTimeout = socketTimeout;  \n    }  \n    ```\n    \n    @Value写在要注入的属性上，要提供setter方法。\n    \n    \n## spring加载properties的两个类的区别\n\n - PropertiesFactoryBean是PropertiesLoaderSupport直接的实现类，专门用来管理properties文件的工厂bean，默认是单例的。\n - PropertyPlaceholderConfigurer是解决properties文件占位符问题的，也实现了PropertiesLoaderSupport类。\n\n在java 代码里，一般是使用@Value注解来引用 properties 文件的属性。\n\n使用 PropertyPlaceholderConfigurer 时， @Value表达式的用法是 @Value(value=\"${properties key}\") ，\n\n使用 PropertiesFactoryBean 时，我们还可以用@Value 读取 properties对象的值， @Value 用法 是 @Value(value=\"#{configProperties['properties key']}\")\n     \n\n \n \n \n \n\n","source":"_posts/Java中读取properties.md","raw":"---\ntitle: Java中读取properties\ncategories:\n  - Spring\ntags:\n  - properties\ndate: 2017-12-19 11:41:35\n---\n\n将一些业务常量配置成properties文件，是扩展程序兼容性的常用做法。在业务变更导致数据需要改变时，不需要修改代码，只用更改配置文件并重启即可生效。\n\n<!-- more -->\n\n## 方法一：IO实现\n```java\npublic static String getValue(String fileNamePath, String key) throws IOException {\n    Properties props = new Properties();\n    InputStream in = null;\n    \n    try {\n        in = new FileInputStream(fileNamePath);\n        //如果将in改为下面的方法，必须要将.Properties文件和此class类文件放在同一个包中    \n        //in = propertiesTools.class.getResourceAsStream(fileNamePath); \n        props.load(in);\n        String value = props.getProperty(key);\n        // 有乱码时要进行重新编码    \n        // new String(props.getProperty(\"name\").getBytes(\"ISO-8859-1\"), \"GBK\");\n        return value;\n    } catch (FileNotFoundException e) {\n        return null;\n    } finally {\n        if (null != in) {\n            in.close();\n        }\n    }\n}\n```\n\n## 方法二：spring实现\n\n在spring扫描配置文件时，将properties中的key和value放入一个map中。\n\n 1. Spring配置\n\n  ```xml\n <bean id=\"propertyConfigurer\" class=\"com.hapishop.util.ProjectDBinfoConfigurer\">\n        <property name=\"locations\">\n            <list>\n                <value>classpath*:/META-INF/*.properties</value>\n                <value>file:conf/*.properties</value>\n            </list>\n        </property>\n    </bean>\n  ```\n\n 2. 自定义CustomizedPropertyConfigurer,继承**PropertyPlaceholderConfigurer**\n\n    ```java\n    public class CustomizedPropertyConfigurer extends PropertyPlaceholderConfigurer {\n        private static Map<String, String> properties = new HashMap<String, String>();\n\n        protected void processProperties(ConfigurableListableBeanFactory beanFactoryToProcess, Properties props) throws BeansException {\n            // cache the properties\n            PropertyPlaceholderHelper helper = new PropertyPlaceholderHelper(DEFAULT_PLACEHOLDER_PREFIX,DEFAULT_PLACEHOLDER_SUFFIX, DEFAULT_VALUE_SEPARATOR, false);\n            for (Entry<Object, Object> entry : props.entrySet()) {\n                String stringKey = String.valueOf(entry.getKey());\n                String stringValue = String.valueOf(entry.getValue());\n                stringValue = helper.replacePlaceholders(stringValue, props);\n                properties.put(stringKey, stringValue);\n            }\n            super.processProperties(beanFactoryToProcess, props);\n        }\n\n        public static Map<String, String> getProperties() {\n            return properties;\n        }\n    \n        public static String getProperty(String key) {\n            return properties.get(key);\n        }\n} \n    ```\n    \n 3. 配置properties\n\n    ```xml\n    site=iteye  \n    blog=antlove  \n    url=${site}/${blog} \n    ```\n    \n\n 4. Java获取\n\n    ```java\n    //调用此方法获取value\n    CustomizedPropertyConfigurer.getContextProperty()\n    ```\n\n## 方法三：注解实现\n\n - Spring配置\n  \n  ```xml\n <bean id=\"propertyConfigurer\" class=\"com.hapishop.util.ProjectDBinfoConfigurer\">\n        <property name=\"locations\">\n            <list>\n                <value>classpath*:/META-INF/*.properties</value>\n                <value>file:conf/*.properties</value>\n            </list>\n        </property>\n    </bean>\n  ```\n  \n - 注解获取\n\n    ```java\n    @Value(\"${socket.time.out}\")\n    int socketTimeout;\n    \n    public void setSocketTimeout(int socketTimeout) {  \n        this.socketTimeout = socketTimeout;  \n    }  \n    ```\n    \n    @Value写在要注入的属性上，要提供setter方法。\n    \n    \n## spring加载properties的两个类的区别\n\n - PropertiesFactoryBean是PropertiesLoaderSupport直接的实现类，专门用来管理properties文件的工厂bean，默认是单例的。\n - PropertyPlaceholderConfigurer是解决properties文件占位符问题的，也实现了PropertiesLoaderSupport类。\n\n在java 代码里，一般是使用@Value注解来引用 properties 文件的属性。\n\n使用 PropertyPlaceholderConfigurer 时， @Value表达式的用法是 @Value(value=\"${properties key}\") ，\n\n使用 PropertiesFactoryBean 时，我们还可以用@Value 读取 properties对象的值， @Value 用法 是 @Value(value=\"#{configProperties['properties key']}\")\n     \n\n \n \n \n \n\n","slug":"Java中读取properties","published":1,"updated":"2018-02-27T07:38:38.084Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfsg000xhwvf7jxgv2vg","content":"<p>将一些业务常量配置成properties文件，是扩展程序兼容性的常用做法。在业务变更导致数据需要改变时，不需要修改代码，只用更改配置文件并重启即可生效。</p>\n<a id=\"more\"></a>\n<h2 id=\"方法一：IO实现\"><a href=\"#方法一：IO实现\" class=\"headerlink\" title=\"方法一：IO实现\"></a>方法一：IO实现</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">getValue</span><span class=\"params\">(String fileNamePath, String key)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</div><div class=\"line\">    Properties props = <span class=\"keyword\">new</span> Properties();</div><div class=\"line\">    InputStream in = <span class=\"keyword\">null</span>;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        in = <span class=\"keyword\">new</span> FileInputStream(fileNamePath);</div><div class=\"line\">        <span class=\"comment\">//如果将in改为下面的方法，必须要将.Properties文件和此class类文件放在同一个包中    </span></div><div class=\"line\">        <span class=\"comment\">//in = propertiesTools.class.getResourceAsStream(fileNamePath); </span></div><div class=\"line\">        props.load(in);</div><div class=\"line\">        String value = props.getProperty(key);</div><div class=\"line\">        <span class=\"comment\">// 有乱码时要进行重新编码    </span></div><div class=\"line\">        <span class=\"comment\">// new String(props.getProperty(\"name\").getBytes(\"ISO-8859-1\"), \"GBK\");</span></div><div class=\"line\">        <span class=\"keyword\">return</span> value;</div><div class=\"line\">    &#125; <span class=\"keyword\">catch</span> (FileNotFoundException e) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> != in) &#123;</div><div class=\"line\">            in.close();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"方法二：spring实现\"><a href=\"#方法二：spring实现\" class=\"headerlink\" title=\"方法二：spring实现\"></a>方法二：spring实现</h2><p>在spring扫描配置文件时，将properties中的key和value放入一个map中。</p>\n<ol>\n<li><p>Spring配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"propertyConfigurer\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.hapishop.util.ProjectDBinfoConfigurer\"</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"locations\"</span>&gt;</span></div><div class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>classpath*:/META-INF/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>file:conf/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>自定义CustomizedPropertyConfigurer,继承<strong>PropertyPlaceholderConfigurer</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CustomizedPropertyConfigurer</span> <span class=\"keyword\">extends</span> <span class=\"title\">PropertyPlaceholderConfigurer</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Map&lt;String, String&gt; properties = <span class=\"keyword\">new</span> HashMap&lt;String, String&gt;();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">processProperties</span><span class=\"params\">(ConfigurableListableBeanFactory beanFactoryToProcess, Properties props)</span> <span class=\"keyword\">throws</span> BeansException </span>&#123;</div><div class=\"line\">            <span class=\"comment\">// cache the properties</span></div><div class=\"line\">            PropertyPlaceholderHelper helper = <span class=\"keyword\">new</span> PropertyPlaceholderHelper(DEFAULT_PLACEHOLDER_PREFIX,DEFAULT_PLACEHOLDER_SUFFIX, DEFAULT_VALUE_SEPARATOR, <span class=\"keyword\">false</span>);</div><div class=\"line\">            <span class=\"keyword\">for</span> (Entry&lt;Object, Object&gt; entry : props.entrySet()) &#123;</div><div class=\"line\">                String stringKey = String.valueOf(entry.getKey());</div><div class=\"line\">                String stringValue = String.valueOf(entry.getValue());</div><div class=\"line\">                stringValue = helper.replacePlaceholders(stringValue, props);</div><div class=\"line\">                properties.put(stringKey, stringValue);</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">super</span>.processProperties(beanFactoryToProcess, props);</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Map&lt;String, String&gt; <span class=\"title\">getProperties</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> properties;</div><div class=\"line\">        &#125;</div><div class=\"line\">    </div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">getProperty</span><span class=\"params\">(String key)</span> </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> properties.get(key);</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>配置properties</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">site=iteye  </div><div class=\"line\">blog=antlove  </div><div class=\"line\">url=$&#123;site&#125;/$&#123;blog&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>Java获取</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//调用此方法获取value</span></div><div class=\"line\">CustomizedPropertyConfigurer.getContextProperty()</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"方法三：注解实现\"><a href=\"#方法三：注解实现\" class=\"headerlink\" title=\"方法三：注解实现\"></a>方法三：注解实现</h2><ul>\n<li><p>Spring配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"propertyConfigurer\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.hapishop.util.ProjectDBinfoConfigurer\"</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"locations\"</span>&gt;</span></div><div class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>classpath*:/META-INF/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>file:conf/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul>\n<li><p>注解获取</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;socket.time.out&#125;\"</span>)</div><div class=\"line\"><span class=\"keyword\">int</span> socketTimeout;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setSocketTimeout</span><span class=\"params\">(<span class=\"keyword\">int</span> socketTimeout)</span> </span>&#123;  </div><div class=\"line\">    <span class=\"keyword\">this</span>.socketTimeout = socketTimeout;  </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<pre><code>@Value写在要注入的属性上，要提供setter方法。\n</code></pre><h2 id=\"spring加载properties的两个类的区别\"><a href=\"#spring加载properties的两个类的区别\" class=\"headerlink\" title=\"spring加载properties的两个类的区别\"></a>spring加载properties的两个类的区别</h2><ul>\n<li>PropertiesFactoryBean是PropertiesLoaderSupport直接的实现类，专门用来管理properties文件的工厂bean，默认是单例的。</li>\n<li>PropertyPlaceholderConfigurer是解决properties文件占位符问题的，也实现了PropertiesLoaderSupport类。</li>\n</ul>\n<p>在java 代码里，一般是使用@Value注解来引用 properties 文件的属性。</p>\n<p>使用 PropertyPlaceholderConfigurer 时， @Value表达式的用法是 @Value(value=”${properties key}”) ，</p>\n<p>使用 PropertiesFactoryBean 时，我们还可以用@Value 读取 properties对象的值， @Value 用法 是 @Value(value=”#{configProperties[‘properties key’]}”)</p>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>将一些业务常量配置成properties文件，是扩展程序兼容性的常用做法。在业务变更导致数据需要改变时，不需要修改代码，只用更改配置文件并重启即可生效。</p>","more":"<h2 id=\"方法一：IO实现\"><a href=\"#方法一：IO实现\" class=\"headerlink\" title=\"方法一：IO实现\"></a>方法一：IO实现</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">getValue</span><span class=\"params\">(String fileNamePath, String key)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</div><div class=\"line\">    Properties props = <span class=\"keyword\">new</span> Properties();</div><div class=\"line\">    InputStream in = <span class=\"keyword\">null</span>;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        in = <span class=\"keyword\">new</span> FileInputStream(fileNamePath);</div><div class=\"line\">        <span class=\"comment\">//如果将in改为下面的方法，必须要将.Properties文件和此class类文件放在同一个包中    </span></div><div class=\"line\">        <span class=\"comment\">//in = propertiesTools.class.getResourceAsStream(fileNamePath); </span></div><div class=\"line\">        props.load(in);</div><div class=\"line\">        String value = props.getProperty(key);</div><div class=\"line\">        <span class=\"comment\">// 有乱码时要进行重新编码    </span></div><div class=\"line\">        <span class=\"comment\">// new String(props.getProperty(\"name\").getBytes(\"ISO-8859-1\"), \"GBK\");</span></div><div class=\"line\">        <span class=\"keyword\">return</span> value;</div><div class=\"line\">    &#125; <span class=\"keyword\">catch</span> (FileNotFoundException e) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">null</span> != in) &#123;</div><div class=\"line\">            in.close();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"方法二：spring实现\"><a href=\"#方法二：spring实现\" class=\"headerlink\" title=\"方法二：spring实现\"></a>方法二：spring实现</h2><p>在spring扫描配置文件时，将properties中的key和value放入一个map中。</p>\n<ol>\n<li><p>Spring配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"propertyConfigurer\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.hapishop.util.ProjectDBinfoConfigurer\"</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"locations\"</span>&gt;</span></div><div class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>classpath*:/META-INF/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>file:conf/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>自定义CustomizedPropertyConfigurer,继承<strong>PropertyPlaceholderConfigurer</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CustomizedPropertyConfigurer</span> <span class=\"keyword\">extends</span> <span class=\"title\">PropertyPlaceholderConfigurer</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Map&lt;String, String&gt; properties = <span class=\"keyword\">new</span> HashMap&lt;String, String&gt;();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">processProperties</span><span class=\"params\">(ConfigurableListableBeanFactory beanFactoryToProcess, Properties props)</span> <span class=\"keyword\">throws</span> BeansException </span>&#123;</div><div class=\"line\">            <span class=\"comment\">// cache the properties</span></div><div class=\"line\">            PropertyPlaceholderHelper helper = <span class=\"keyword\">new</span> PropertyPlaceholderHelper(DEFAULT_PLACEHOLDER_PREFIX,DEFAULT_PLACEHOLDER_SUFFIX, DEFAULT_VALUE_SEPARATOR, <span class=\"keyword\">false</span>);</div><div class=\"line\">            <span class=\"keyword\">for</span> (Entry&lt;Object, Object&gt; entry : props.entrySet()) &#123;</div><div class=\"line\">                String stringKey = String.valueOf(entry.getKey());</div><div class=\"line\">                String stringValue = String.valueOf(entry.getValue());</div><div class=\"line\">                stringValue = helper.replacePlaceholders(stringValue, props);</div><div class=\"line\">                properties.put(stringKey, stringValue);</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">super</span>.processProperties(beanFactoryToProcess, props);</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Map&lt;String, String&gt; <span class=\"title\">getProperties</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> properties;</div><div class=\"line\">        &#125;</div><div class=\"line\">    </div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">getProperty</span><span class=\"params\">(String key)</span> </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> properties.get(key);</div><div class=\"line\">        &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>配置properties</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">site=iteye  </div><div class=\"line\">blog=antlove  </div><div class=\"line\">url=$&#123;site&#125;/$&#123;blog&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>Java获取</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//调用此方法获取value</span></div><div class=\"line\">CustomizedPropertyConfigurer.getContextProperty()</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"方法三：注解实现\"><a href=\"#方法三：注解实现\" class=\"headerlink\" title=\"方法三：注解实现\"></a>方法三：注解实现</h2><ul>\n<li><p>Spring配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"propertyConfigurer\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.hapishop.util.ProjectDBinfoConfigurer\"</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"locations\"</span>&gt;</span></div><div class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>classpath*:/META-INF/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">               <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>file:conf/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul>\n<li><p>注解获取</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Value</span>(<span class=\"string\">\"$&#123;socket.time.out&#125;\"</span>)</div><div class=\"line\"><span class=\"keyword\">int</span> socketTimeout;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setSocketTimeout</span><span class=\"params\">(<span class=\"keyword\">int</span> socketTimeout)</span> </span>&#123;  </div><div class=\"line\">    <span class=\"keyword\">this</span>.socketTimeout = socketTimeout;  </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<pre><code>@Value写在要注入的属性上，要提供setter方法。\n</code></pre><h2 id=\"spring加载properties的两个类的区别\"><a href=\"#spring加载properties的两个类的区别\" class=\"headerlink\" title=\"spring加载properties的两个类的区别\"></a>spring加载properties的两个类的区别</h2><ul>\n<li>PropertiesFactoryBean是PropertiesLoaderSupport直接的实现类，专门用来管理properties文件的工厂bean，默认是单例的。</li>\n<li>PropertyPlaceholderConfigurer是解决properties文件占位符问题的，也实现了PropertiesLoaderSupport类。</li>\n</ul>\n<p>在java 代码里，一般是使用@Value注解来引用 properties 文件的属性。</p>\n<p>使用 PropertyPlaceholderConfigurer 时， @Value表达式的用法是 @Value(value=”${properties key}”) ，</p>\n<p>使用 PropertiesFactoryBean 时，我们还可以用@Value 读取 properties对象的值， @Value 用法 是 @Value(value=”#{configProperties[‘properties key’]}”)</p>"},{"title":"Mybatis(2)——Dao层开发方法","date":"2018-02-27T08:21:42.000Z","_content":"mybatis的dao层通常有两种开发方式，原始dao开发及mapper接口发开方法。\n<!--more-->\n\n## 1、SqlSession的使用范围\n\nSqlSession中封装了对数据库的操作，如：查询、插入、更新、删除等。通过SqlSessionFactory创建SqlSession，而SqlSessionFactory是通过SqlSessionFactoryBuilder进行创建。\n\n### 1.1 SqlSessionFactoryBuilder\nSqlSessionFactoryBuilder用于创建SqlSessionFacoty，SqlSessionFacoty一旦创建完成就不需要SqlSessionFactoryBuilder了，因为SqlSession是通过SqlSessionFactory生产，所以可以将SqlSessionFactoryBuilder当成一个工具类使用，最佳使用范围是方法范围即方法体内局部变量。\n\n### 1.2 SqlSessionFactory\nSqlSessionFactory是一个接口，接口中定义了openSession的不同重载方法，SqlSessionFactory的最佳使用范围是整个应用运行期间，一旦创建后可以重复使用，通常以单例模式管理SqlSessionFactory。\n\n### 1.3 SqlSession\nSqlSession是一个面向用户的接口，sqlSession中定义了数据库操作，默认使用DefaultSqlSession实现类。\n\n**执行过程如下：**\n1、\t加载数据源等配置信息\n    Environment environment = configuration.getEnvironment();\n2、\t创建数据库链接\n3、\t创建事务对象\n4、\t创建Executor，SqlSession所有操作都是通过Executor完成\n5、\tSqlSession的实现类即DefaultSqlSession，此对象中对操作数据库实质上用的是Executor\n\n**结论：**\n\t每个线程都应该有它自己的SqlSession实例。SqlSession的实例不能共享使用，它也是线程不安全的。因此最佳的范围是请求或方法范围。绝对不能将SqlSession实例的引用放在一个类的静态字段或实例字段中。\n\t打开一个 SqlSession；使用完毕就要关闭它。通常把这个关闭操作放到 finally 块中以确保每次都能执行关闭。\n\n## 2、原始Dao开发\n\n原始开发方式需要编写dao接口及接口实现类。\n\n### 2.1 编写映射文件（sql）\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE mapper\nPUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n\n<mapper namespace=\"test\">\n\t<select id=\"queryById\" parameterType=\"long\" resultType=\"com.topvision.maven.mybatis.domain.Book\">\n\t\tselect book_id bookId,name,number from book where book_id = #{id}\n\t</select>\n</mapper>\n```\n\n### 2.2 编写Dao接口\n\n```java\npublic interface BookDao {\n    public Book queryById(long id);\n}\n```\n\n### 2.3 编写Dao实现类\n\n```java\npublic class BookDaoImpl implements BookDao {\n\n    private SqlSessionFactory sqlSessionFactory;\n\n    // 注入SqlSessionFactory\n    public BookDaoImpl(SqlSessionFactory sqlSessionFactory) {\n        this.setSqlSessionFactory(sqlSessionFactory);\n    }\n\n    @Override\n    public Book queryById(long id) {\n        SqlSession sqlSession = null;\n        Book book = null;\n        try {\n            sqlSession = sqlSessionFactory.openSession();\n            book = sqlSession.selectOne(\"test.queryById\", id);\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            sqlSession.close();\n        }\n        return book;\n    }\n\n    public SqlSessionFactory getSqlSessionFactory() {\n        return sqlSessionFactory;\n    }\n\n    public void setSqlSessionFactory(SqlSessionFactory sqlSessionFactory) {\n        this.sqlSessionFactory = sqlSessionFactory;\n    }\n    \n}\n```\n\n### 2.4 测试用例\n\n```java\npublic class BookDaoImplTest {\n    \n    private SqlSessionFactory sqlSessionFactory;\n    \n    @Before\n    public void createSqlSessionFactory() throws IOException{\n        String resource = \"sqlMapConfig.xml\";\n        InputStream inputStream = Resources.getResourceAsStream(resource);\n        \n        sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);\n    }\n    \n\n    @Test\n    public void testQueryById() {\n        \n        BookDao bookDao = new BookDaoImpl(sqlSessionFactory);\n        Book book = bookDao.queryById(1000l);\n        System.out.println(book);\n    }\n\n}\n```\n\n## 3、Mapper接口开发\n\nMapper接口开发方法只需要程序员编写Mapper接口（相当于Dao接口），由Mybatis框架根据接口定义创建接口的动态代理对象，代理对象的方法体同上边Dao接口实现类方法。\nMapper接口开发需要遵循以下规范：\n1、\tMapper.xml文件中的namespace与mapper接口的类路径相同。\n2、\tMapper接口方法名和Mapper.xml中定义的每个statement的id相同 \n3、\tMapper接口方法的输入参数类型和mapper.xml中定义的每个sql的parameterType的类型相同\n4、\tMapper接口方法的输出参数类型和mapper.xml中定义的每个sql的resultType的类型相同\n\n### 3.1 Mapper.xml(映射文件)\n在classpath下新建mapper文件夹，新建BookMapper.xml\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE mapper\nPUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n\n<mapper namespace=\"com.topvision.maven.mybatis.dao.BookDao\">\n\t<select id=\"queryById\" parameterType=\"long\" resultType=\"book\">\n\t\tselect book_id bookId,name,number from book where book_id = #{id}\n\t</select>\n</mapper>\n```\n\n### 3.2 BookDao接口\n\n```java\npublic interface BookDao {\n    public Book queryById(long id);\n}\n```\n\n接口定义有如下特点：\n1、\tMapper接口方法名和Mapper.xml中定义的statement的id相同\n2、\tMapper接口方法的输入参数类型和mapper.xml中定义的statement的parameterType的类型相同\n3、\tMapper接口方法的输出参数类型和mapper.xml中定义的statement的resultType的类型相同\n\n### 3.3 加载BookMapper.xml\n\n```xml\n<mappers>\n\t<mapper resource=\"mapper/BookMapper.xml\"/>\n</mappers>\n```\n\n### 3.4 测试\n\n```java\n@Test\npublic void testQueryByIdInProxy() {\n    SqlSession sqlSession = null;\n    try {\n        sqlSession = sqlSessionFactory.openSession();\n        BookDao bookDao = sqlSession.getMapper(BookDao.class);\n        Book book = bookDao.queryById(1000l);\n        System.out.println(book);\n    } catch (Exception e) {\n        e.printStackTrace();\n    } finally {\n        if (sqlSession != null) {\n            sqlSession.close();\n        }\n    }\n}\n```\n\n### 3.5 小结\n\n - electOne和selectList\n动态代理对象调用sqlSession.selectOne()和sqlSession.selectList()是根据mapper接口方法的返回值决定，如果返回list则调用selectList方法，如果返回单个对象则调用selectOne方法。\n - namespace\nmybatis官方推荐使用mapper代理方法开发mapper接口，程序员不用编写mapper接口实现类，使用mapper代理方法时，输入参数可以使用pojo包装对象或map对象，保证dao的通用性。\n","source":"_posts/Mybatis-2-——Dao层开发方法.md","raw":"---\ntitle: Mybatis(2)——Dao层开发方法\ncategories:\n  - Mybatis\ntags:\n  - Mybatis\ndate: 2018-02-27 16:21:42\n---\nmybatis的dao层通常有两种开发方式，原始dao开发及mapper接口发开方法。\n<!--more-->\n\n## 1、SqlSession的使用范围\n\nSqlSession中封装了对数据库的操作，如：查询、插入、更新、删除等。通过SqlSessionFactory创建SqlSession，而SqlSessionFactory是通过SqlSessionFactoryBuilder进行创建。\n\n### 1.1 SqlSessionFactoryBuilder\nSqlSessionFactoryBuilder用于创建SqlSessionFacoty，SqlSessionFacoty一旦创建完成就不需要SqlSessionFactoryBuilder了，因为SqlSession是通过SqlSessionFactory生产，所以可以将SqlSessionFactoryBuilder当成一个工具类使用，最佳使用范围是方法范围即方法体内局部变量。\n\n### 1.2 SqlSessionFactory\nSqlSessionFactory是一个接口，接口中定义了openSession的不同重载方法，SqlSessionFactory的最佳使用范围是整个应用运行期间，一旦创建后可以重复使用，通常以单例模式管理SqlSessionFactory。\n\n### 1.3 SqlSession\nSqlSession是一个面向用户的接口，sqlSession中定义了数据库操作，默认使用DefaultSqlSession实现类。\n\n**执行过程如下：**\n1、\t加载数据源等配置信息\n    Environment environment = configuration.getEnvironment();\n2、\t创建数据库链接\n3、\t创建事务对象\n4、\t创建Executor，SqlSession所有操作都是通过Executor完成\n5、\tSqlSession的实现类即DefaultSqlSession，此对象中对操作数据库实质上用的是Executor\n\n**结论：**\n\t每个线程都应该有它自己的SqlSession实例。SqlSession的实例不能共享使用，它也是线程不安全的。因此最佳的范围是请求或方法范围。绝对不能将SqlSession实例的引用放在一个类的静态字段或实例字段中。\n\t打开一个 SqlSession；使用完毕就要关闭它。通常把这个关闭操作放到 finally 块中以确保每次都能执行关闭。\n\n## 2、原始Dao开发\n\n原始开发方式需要编写dao接口及接口实现类。\n\n### 2.1 编写映射文件（sql）\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE mapper\nPUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n\n<mapper namespace=\"test\">\n\t<select id=\"queryById\" parameterType=\"long\" resultType=\"com.topvision.maven.mybatis.domain.Book\">\n\t\tselect book_id bookId,name,number from book where book_id = #{id}\n\t</select>\n</mapper>\n```\n\n### 2.2 编写Dao接口\n\n```java\npublic interface BookDao {\n    public Book queryById(long id);\n}\n```\n\n### 2.3 编写Dao实现类\n\n```java\npublic class BookDaoImpl implements BookDao {\n\n    private SqlSessionFactory sqlSessionFactory;\n\n    // 注入SqlSessionFactory\n    public BookDaoImpl(SqlSessionFactory sqlSessionFactory) {\n        this.setSqlSessionFactory(sqlSessionFactory);\n    }\n\n    @Override\n    public Book queryById(long id) {\n        SqlSession sqlSession = null;\n        Book book = null;\n        try {\n            sqlSession = sqlSessionFactory.openSession();\n            book = sqlSession.selectOne(\"test.queryById\", id);\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            sqlSession.close();\n        }\n        return book;\n    }\n\n    public SqlSessionFactory getSqlSessionFactory() {\n        return sqlSessionFactory;\n    }\n\n    public void setSqlSessionFactory(SqlSessionFactory sqlSessionFactory) {\n        this.sqlSessionFactory = sqlSessionFactory;\n    }\n    \n}\n```\n\n### 2.4 测试用例\n\n```java\npublic class BookDaoImplTest {\n    \n    private SqlSessionFactory sqlSessionFactory;\n    \n    @Before\n    public void createSqlSessionFactory() throws IOException{\n        String resource = \"sqlMapConfig.xml\";\n        InputStream inputStream = Resources.getResourceAsStream(resource);\n        \n        sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);\n    }\n    \n\n    @Test\n    public void testQueryById() {\n        \n        BookDao bookDao = new BookDaoImpl(sqlSessionFactory);\n        Book book = bookDao.queryById(1000l);\n        System.out.println(book);\n    }\n\n}\n```\n\n## 3、Mapper接口开发\n\nMapper接口开发方法只需要程序员编写Mapper接口（相当于Dao接口），由Mybatis框架根据接口定义创建接口的动态代理对象，代理对象的方法体同上边Dao接口实现类方法。\nMapper接口开发需要遵循以下规范：\n1、\tMapper.xml文件中的namespace与mapper接口的类路径相同。\n2、\tMapper接口方法名和Mapper.xml中定义的每个statement的id相同 \n3、\tMapper接口方法的输入参数类型和mapper.xml中定义的每个sql的parameterType的类型相同\n4、\tMapper接口方法的输出参数类型和mapper.xml中定义的每个sql的resultType的类型相同\n\n### 3.1 Mapper.xml(映射文件)\n在classpath下新建mapper文件夹，新建BookMapper.xml\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE mapper\nPUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n\n<mapper namespace=\"com.topvision.maven.mybatis.dao.BookDao\">\n\t<select id=\"queryById\" parameterType=\"long\" resultType=\"book\">\n\t\tselect book_id bookId,name,number from book where book_id = #{id}\n\t</select>\n</mapper>\n```\n\n### 3.2 BookDao接口\n\n```java\npublic interface BookDao {\n    public Book queryById(long id);\n}\n```\n\n接口定义有如下特点：\n1、\tMapper接口方法名和Mapper.xml中定义的statement的id相同\n2、\tMapper接口方法的输入参数类型和mapper.xml中定义的statement的parameterType的类型相同\n3、\tMapper接口方法的输出参数类型和mapper.xml中定义的statement的resultType的类型相同\n\n### 3.3 加载BookMapper.xml\n\n```xml\n<mappers>\n\t<mapper resource=\"mapper/BookMapper.xml\"/>\n</mappers>\n```\n\n### 3.4 测试\n\n```java\n@Test\npublic void testQueryByIdInProxy() {\n    SqlSession sqlSession = null;\n    try {\n        sqlSession = sqlSessionFactory.openSession();\n        BookDao bookDao = sqlSession.getMapper(BookDao.class);\n        Book book = bookDao.queryById(1000l);\n        System.out.println(book);\n    } catch (Exception e) {\n        e.printStackTrace();\n    } finally {\n        if (sqlSession != null) {\n            sqlSession.close();\n        }\n    }\n}\n```\n\n### 3.5 小结\n\n - electOne和selectList\n动态代理对象调用sqlSession.selectOne()和sqlSession.selectList()是根据mapper接口方法的返回值决定，如果返回list则调用selectList方法，如果返回单个对象则调用selectOne方法。\n - namespace\nmybatis官方推荐使用mapper代理方法开发mapper接口，程序员不用编写mapper接口实现类，使用mapper代理方法时，输入参数可以使用pojo包装对象或map对象，保证dao的通用性。\n","slug":"Mybatis-2-——Dao层开发方法","published":1,"updated":"2018-03-06T08:22:13.195Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfsl000zhwvfgvucz8mg","content":"<p>mybatis的dao层通常有两种开发方式，原始dao开发及mapper接口发开方法。<br><a id=\"more\"></a></p>\n<h2 id=\"1、SqlSession的使用范围\"><a href=\"#1、SqlSession的使用范围\" class=\"headerlink\" title=\"1、SqlSession的使用范围\"></a>1、SqlSession的使用范围</h2><p>SqlSession中封装了对数据库的操作，如：查询、插入、更新、删除等。通过SqlSessionFactory创建SqlSession，而SqlSessionFactory是通过SqlSessionFactoryBuilder进行创建。</p>\n<h3 id=\"1-1-SqlSessionFactoryBuilder\"><a href=\"#1-1-SqlSessionFactoryBuilder\" class=\"headerlink\" title=\"1.1 SqlSessionFactoryBuilder\"></a>1.1 SqlSessionFactoryBuilder</h3><p>SqlSessionFactoryBuilder用于创建SqlSessionFacoty，SqlSessionFacoty一旦创建完成就不需要SqlSessionFactoryBuilder了，因为SqlSession是通过SqlSessionFactory生产，所以可以将SqlSessionFactoryBuilder当成一个工具类使用，最佳使用范围是方法范围即方法体内局部变量。</p>\n<h3 id=\"1-2-SqlSessionFactory\"><a href=\"#1-2-SqlSessionFactory\" class=\"headerlink\" title=\"1.2 SqlSessionFactory\"></a>1.2 SqlSessionFactory</h3><p>SqlSessionFactory是一个接口，接口中定义了openSession的不同重载方法，SqlSessionFactory的最佳使用范围是整个应用运行期间，一旦创建后可以重复使用，通常以单例模式管理SqlSessionFactory。</p>\n<h3 id=\"1-3-SqlSession\"><a href=\"#1-3-SqlSession\" class=\"headerlink\" title=\"1.3 SqlSession\"></a>1.3 SqlSession</h3><p>SqlSession是一个面向用户的接口，sqlSession中定义了数据库操作，默认使用DefaultSqlSession实现类。</p>\n<p><strong>执行过程如下：</strong><br>1、    加载数据源等配置信息<br>    Environment environment = configuration.getEnvironment();<br>2、    创建数据库链接<br>3、    创建事务对象<br>4、    创建Executor，SqlSession所有操作都是通过Executor完成<br>5、    SqlSession的实现类即DefaultSqlSession，此对象中对操作数据库实质上用的是Executor</p>\n<p><strong>结论：</strong><br>    每个线程都应该有它自己的SqlSession实例。SqlSession的实例不能共享使用，它也是线程不安全的。因此最佳的范围是请求或方法范围。绝对不能将SqlSession实例的引用放在一个类的静态字段或实例字段中。<br>    打开一个 SqlSession；使用完毕就要关闭它。通常把这个关闭操作放到 finally 块中以确保每次都能执行关闭。</p>\n<h2 id=\"2、原始Dao开发\"><a href=\"#2、原始Dao开发\" class=\"headerlink\" title=\"2、原始Dao开发\"></a>2、原始Dao开发</h2><p>原始开发方式需要编写dao接口及接口实现类。</p>\n<h3 id=\"2-1-编写映射文件（sql）\"><a href=\"#2-1-编写映射文件（sql）\" class=\"headerlink\" title=\"2.1 编写映射文件（sql）\"></a>2.1 编写映射文件（sql）</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE mapper</span></div><div class=\"line\">PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"</div><div class=\"line\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"test\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"queryById\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"long\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"com.topvision.maven.mybatis.domain.Book\"</span>&gt;</span></div><div class=\"line\">\t\tselect book_id bookId,name,number from book where book_id = #&#123;id&#125;</div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"2-2-编写Dao接口\"><a href=\"#2-2-编写Dao接口\" class=\"headerlink\" title=\"2.2 编写Dao接口\"></a>2.2 编写Dao接口</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">BookDao</span> </span>&#123;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Book <span class=\"title\">queryById</span><span class=\"params\">(<span class=\"keyword\">long</span> id)</span></span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"2-3-编写Dao实现类\"><a href=\"#2-3-编写Dao实现类\" class=\"headerlink\" title=\"2.3 编写Dao实现类\"></a>2.3 编写Dao实现类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BookDaoImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">BookDao</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> SqlSessionFactory sqlSessionFactory;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// 注入SqlSessionFactory</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">BookDaoImpl</span><span class=\"params\">(SqlSessionFactory sqlSessionFactory)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.setSqlSessionFactory(sqlSessionFactory);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Book <span class=\"title\">queryById</span><span class=\"params\">(<span class=\"keyword\">long</span> id)</span> </span>&#123;</div><div class=\"line\">        SqlSession sqlSession = <span class=\"keyword\">null</span>;</div><div class=\"line\">        Book book = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            sqlSession = sqlSessionFactory.openSession();</div><div class=\"line\">            book = sqlSession.selectOne(<span class=\"string\">\"test.queryById\"</span>, id);</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">            sqlSession.close();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> book;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> SqlSessionFactory <span class=\"title\">getSqlSessionFactory</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> sqlSessionFactory;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setSqlSessionFactory</span><span class=\"params\">(SqlSessionFactory sqlSessionFactory)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.sqlSessionFactory = sqlSessionFactory;</div><div class=\"line\">    &#125;</div><div class=\"line\">    </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"2-4-测试用例\"><a href=\"#2-4-测试用例\" class=\"headerlink\" title=\"2.4 测试用例\"></a>2.4 测试用例</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BookDaoImplTest</span> </span>&#123;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">private</span> SqlSessionFactory sqlSessionFactory;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"meta\">@Before</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createSqlSessionFactory</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException</span>&#123;</div><div class=\"line\">        String resource = <span class=\"string\">\"sqlMapConfig.xml\"</span>;</div><div class=\"line\">        InputStream inputStream = Resources.getResourceAsStream(resource);</div><div class=\"line\">        </div><div class=\"line\">        sqlSessionFactory = <span class=\"keyword\">new</span> SqlSessionFactoryBuilder().build(inputStream);</div><div class=\"line\">    &#125;</div><div class=\"line\">    </div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testQueryById</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        </div><div class=\"line\">        BookDao bookDao = <span class=\"keyword\">new</span> BookDaoImpl(sqlSessionFactory);</div><div class=\"line\">        Book book = bookDao.queryById(<span class=\"number\">1000l</span>);</div><div class=\"line\">        System.out.println(book);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"3、Mapper接口开发\"><a href=\"#3、Mapper接口开发\" class=\"headerlink\" title=\"3、Mapper接口开发\"></a>3、Mapper接口开发</h2><p>Mapper接口开发方法只需要程序员编写Mapper接口（相当于Dao接口），由Mybatis框架根据接口定义创建接口的动态代理对象，代理对象的方法体同上边Dao接口实现类方法。<br>Mapper接口开发需要遵循以下规范：<br>1、    Mapper.xml文件中的namespace与mapper接口的类路径相同。<br>2、    Mapper接口方法名和Mapper.xml中定义的每个statement的id相同<br>3、    Mapper接口方法的输入参数类型和mapper.xml中定义的每个sql的parameterType的类型相同<br>4、    Mapper接口方法的输出参数类型和mapper.xml中定义的每个sql的resultType的类型相同</p>\n<h3 id=\"3-1-Mapper-xml-映射文件\"><a href=\"#3-1-Mapper-xml-映射文件\" class=\"headerlink\" title=\"3.1 Mapper.xml(映射文件)\"></a>3.1 Mapper.xml(映射文件)</h3><p>在classpath下新建mapper文件夹，新建BookMapper.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE mapper</span></div><div class=\"line\">PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"</div><div class=\"line\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"com.topvision.maven.mybatis.dao.BookDao\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"queryById\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"long\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"book\"</span>&gt;</span></div><div class=\"line\">\t\tselect book_id bookId,name,number from book where book_id = #&#123;id&#125;</div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"3-2-BookDao接口\"><a href=\"#3-2-BookDao接口\" class=\"headerlink\" title=\"3.2 BookDao接口\"></a>3.2 BookDao接口</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">BookDao</span> </span>&#123;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Book <span class=\"title\">queryById</span><span class=\"params\">(<span class=\"keyword\">long</span> id)</span></span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>接口定义有如下特点：<br>1、    Mapper接口方法名和Mapper.xml中定义的statement的id相同<br>2、    Mapper接口方法的输入参数类型和mapper.xml中定义的statement的parameterType的类型相同<br>3、    Mapper接口方法的输出参数类型和mapper.xml中定义的statement的resultType的类型相同</p>\n<h3 id=\"3-3-加载BookMapper-xml\"><a href=\"#3-3-加载BookMapper-xml\" class=\"headerlink\" title=\"3.3 加载BookMapper.xml\"></a>3.3 加载BookMapper.xml</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mappers</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"mapper/BookMapper.xml\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mappers</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"3-4-测试\"><a href=\"#3-4-测试\" class=\"headerlink\" title=\"3.4 测试\"></a>3.4 测试</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testQueryByIdInProxy</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    SqlSession sqlSession = <span class=\"keyword\">null</span>;</div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        sqlSession = sqlSessionFactory.openSession();</div><div class=\"line\">        BookDao bookDao = sqlSession.getMapper(BookDao.class);</div><div class=\"line\">        Book book = bookDao.queryById(<span class=\"number\">1000l</span>);</div><div class=\"line\">        System.out.println(book);</div><div class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">        e.printStackTrace();</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (sqlSession != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">            sqlSession.close();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"3-5-小结\"><a href=\"#3-5-小结\" class=\"headerlink\" title=\"3.5 小结\"></a>3.5 小结</h3><ul>\n<li>electOne和selectList<br>动态代理对象调用sqlSession.selectOne()和sqlSession.selectList()是根据mapper接口方法的返回值决定，如果返回list则调用selectList方法，如果返回单个对象则调用selectOne方法。</li>\n<li>namespace<br>mybatis官方推荐使用mapper代理方法开发mapper接口，程序员不用编写mapper接口实现类，使用mapper代理方法时，输入参数可以使用pojo包装对象或map对象，保证dao的通用性。</li>\n</ul>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>mybatis的dao层通常有两种开发方式，原始dao开发及mapper接口发开方法。<br>","more":"</p>\n<h2 id=\"1、SqlSession的使用范围\"><a href=\"#1、SqlSession的使用范围\" class=\"headerlink\" title=\"1、SqlSession的使用范围\"></a>1、SqlSession的使用范围</h2><p>SqlSession中封装了对数据库的操作，如：查询、插入、更新、删除等。通过SqlSessionFactory创建SqlSession，而SqlSessionFactory是通过SqlSessionFactoryBuilder进行创建。</p>\n<h3 id=\"1-1-SqlSessionFactoryBuilder\"><a href=\"#1-1-SqlSessionFactoryBuilder\" class=\"headerlink\" title=\"1.1 SqlSessionFactoryBuilder\"></a>1.1 SqlSessionFactoryBuilder</h3><p>SqlSessionFactoryBuilder用于创建SqlSessionFacoty，SqlSessionFacoty一旦创建完成就不需要SqlSessionFactoryBuilder了，因为SqlSession是通过SqlSessionFactory生产，所以可以将SqlSessionFactoryBuilder当成一个工具类使用，最佳使用范围是方法范围即方法体内局部变量。</p>\n<h3 id=\"1-2-SqlSessionFactory\"><a href=\"#1-2-SqlSessionFactory\" class=\"headerlink\" title=\"1.2 SqlSessionFactory\"></a>1.2 SqlSessionFactory</h3><p>SqlSessionFactory是一个接口，接口中定义了openSession的不同重载方法，SqlSessionFactory的最佳使用范围是整个应用运行期间，一旦创建后可以重复使用，通常以单例模式管理SqlSessionFactory。</p>\n<h3 id=\"1-3-SqlSession\"><a href=\"#1-3-SqlSession\" class=\"headerlink\" title=\"1.3 SqlSession\"></a>1.3 SqlSession</h3><p>SqlSession是一个面向用户的接口，sqlSession中定义了数据库操作，默认使用DefaultSqlSession实现类。</p>\n<p><strong>执行过程如下：</strong><br>1、    加载数据源等配置信息<br>    Environment environment = configuration.getEnvironment();<br>2、    创建数据库链接<br>3、    创建事务对象<br>4、    创建Executor，SqlSession所有操作都是通过Executor完成<br>5、    SqlSession的实现类即DefaultSqlSession，此对象中对操作数据库实质上用的是Executor</p>\n<p><strong>结论：</strong><br>    每个线程都应该有它自己的SqlSession实例。SqlSession的实例不能共享使用，它也是线程不安全的。因此最佳的范围是请求或方法范围。绝对不能将SqlSession实例的引用放在一个类的静态字段或实例字段中。<br>    打开一个 SqlSession；使用完毕就要关闭它。通常把这个关闭操作放到 finally 块中以确保每次都能执行关闭。</p>\n<h2 id=\"2、原始Dao开发\"><a href=\"#2、原始Dao开发\" class=\"headerlink\" title=\"2、原始Dao开发\"></a>2、原始Dao开发</h2><p>原始开发方式需要编写dao接口及接口实现类。</p>\n<h3 id=\"2-1-编写映射文件（sql）\"><a href=\"#2-1-编写映射文件（sql）\" class=\"headerlink\" title=\"2.1 编写映射文件（sql）\"></a>2.1 编写映射文件（sql）</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE mapper</span></div><div class=\"line\">PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"</div><div class=\"line\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"test\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"queryById\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"long\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"com.topvision.maven.mybatis.domain.Book\"</span>&gt;</span></div><div class=\"line\">\t\tselect book_id bookId,name,number from book where book_id = #&#123;id&#125;</div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"2-2-编写Dao接口\"><a href=\"#2-2-编写Dao接口\" class=\"headerlink\" title=\"2.2 编写Dao接口\"></a>2.2 编写Dao接口</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">BookDao</span> </span>&#123;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Book <span class=\"title\">queryById</span><span class=\"params\">(<span class=\"keyword\">long</span> id)</span></span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"2-3-编写Dao实现类\"><a href=\"#2-3-编写Dao实现类\" class=\"headerlink\" title=\"2.3 编写Dao实现类\"></a>2.3 编写Dao实现类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BookDaoImpl</span> <span class=\"keyword\">implements</span> <span class=\"title\">BookDao</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> SqlSessionFactory sqlSessionFactory;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">// 注入SqlSessionFactory</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">BookDaoImpl</span><span class=\"params\">(SqlSessionFactory sqlSessionFactory)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.setSqlSessionFactory(sqlSessionFactory);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Book <span class=\"title\">queryById</span><span class=\"params\">(<span class=\"keyword\">long</span> id)</span> </span>&#123;</div><div class=\"line\">        SqlSession sqlSession = <span class=\"keyword\">null</span>;</div><div class=\"line\">        Book book = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            sqlSession = sqlSessionFactory.openSession();</div><div class=\"line\">            book = sqlSession.selectOne(<span class=\"string\">\"test.queryById\"</span>, id);</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">            sqlSession.close();</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> book;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> SqlSessionFactory <span class=\"title\">getSqlSessionFactory</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> sqlSessionFactory;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setSqlSessionFactory</span><span class=\"params\">(SqlSessionFactory sqlSessionFactory)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.sqlSessionFactory = sqlSessionFactory;</div><div class=\"line\">    &#125;</div><div class=\"line\">    </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"2-4-测试用例\"><a href=\"#2-4-测试用例\" class=\"headerlink\" title=\"2.4 测试用例\"></a>2.4 测试用例</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BookDaoImplTest</span> </span>&#123;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">private</span> SqlSessionFactory sqlSessionFactory;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"meta\">@Before</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createSqlSessionFactory</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException</span>&#123;</div><div class=\"line\">        String resource = <span class=\"string\">\"sqlMapConfig.xml\"</span>;</div><div class=\"line\">        InputStream inputStream = Resources.getResourceAsStream(resource);</div><div class=\"line\">        </div><div class=\"line\">        sqlSessionFactory = <span class=\"keyword\">new</span> SqlSessionFactoryBuilder().build(inputStream);</div><div class=\"line\">    &#125;</div><div class=\"line\">    </div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testQueryById</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        </div><div class=\"line\">        BookDao bookDao = <span class=\"keyword\">new</span> BookDaoImpl(sqlSessionFactory);</div><div class=\"line\">        Book book = bookDao.queryById(<span class=\"number\">1000l</span>);</div><div class=\"line\">        System.out.println(book);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"3、Mapper接口开发\"><a href=\"#3、Mapper接口开发\" class=\"headerlink\" title=\"3、Mapper接口开发\"></a>3、Mapper接口开发</h2><p>Mapper接口开发方法只需要程序员编写Mapper接口（相当于Dao接口），由Mybatis框架根据接口定义创建接口的动态代理对象，代理对象的方法体同上边Dao接口实现类方法。<br>Mapper接口开发需要遵循以下规范：<br>1、    Mapper.xml文件中的namespace与mapper接口的类路径相同。<br>2、    Mapper接口方法名和Mapper.xml中定义的每个statement的id相同<br>3、    Mapper接口方法的输入参数类型和mapper.xml中定义的每个sql的parameterType的类型相同<br>4、    Mapper接口方法的输出参数类型和mapper.xml中定义的每个sql的resultType的类型相同</p>\n<h3 id=\"3-1-Mapper-xml-映射文件\"><a href=\"#3-1-Mapper-xml-映射文件\" class=\"headerlink\" title=\"3.1 Mapper.xml(映射文件)\"></a>3.1 Mapper.xml(映射文件)</h3><p>在classpath下新建mapper文件夹，新建BookMapper.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE mapper</span></div><div class=\"line\">PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"</div><div class=\"line\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"com.topvision.maven.mybatis.dao.BookDao\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"queryById\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"long\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"book\"</span>&gt;</span></div><div class=\"line\">\t\tselect book_id bookId,name,number from book where book_id = #&#123;id&#125;</div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"3-2-BookDao接口\"><a href=\"#3-2-BookDao接口\" class=\"headerlink\" title=\"3.2 BookDao接口\"></a>3.2 BookDao接口</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">BookDao</span> </span>&#123;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Book <span class=\"title\">queryById</span><span class=\"params\">(<span class=\"keyword\">long</span> id)</span></span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>接口定义有如下特点：<br>1、    Mapper接口方法名和Mapper.xml中定义的statement的id相同<br>2、    Mapper接口方法的输入参数类型和mapper.xml中定义的statement的parameterType的类型相同<br>3、    Mapper接口方法的输出参数类型和mapper.xml中定义的statement的resultType的类型相同</p>\n<h3 id=\"3-3-加载BookMapper-xml\"><a href=\"#3-3-加载BookMapper-xml\" class=\"headerlink\" title=\"3.3 加载BookMapper.xml\"></a>3.3 加载BookMapper.xml</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mappers</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"mapper/BookMapper.xml\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mappers</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"3-4-测试\"><a href=\"#3-4-测试\" class=\"headerlink\" title=\"3.4 测试\"></a>3.4 测试</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testQueryByIdInProxy</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    SqlSession sqlSession = <span class=\"keyword\">null</span>;</div><div class=\"line\">    <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">        sqlSession = sqlSessionFactory.openSession();</div><div class=\"line\">        BookDao bookDao = sqlSession.getMapper(BookDao.class);</div><div class=\"line\">        Book book = bookDao.queryById(<span class=\"number\">1000l</span>);</div><div class=\"line\">        System.out.println(book);</div><div class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">        e.printStackTrace();</div><div class=\"line\">    &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (sqlSession != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">            sqlSession.close();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"3-5-小结\"><a href=\"#3-5-小结\" class=\"headerlink\" title=\"3.5 小结\"></a>3.5 小结</h3><ul>\n<li>electOne和selectList<br>动态代理对象调用sqlSession.selectOne()和sqlSession.selectList()是根据mapper接口方法的返回值决定，如果返回list则调用selectList方法，如果返回单个对象则调用selectOne方法。</li>\n<li>namespace<br>mybatis官方推荐使用mapper代理方法开发mapper接口，程序员不用编写mapper接口实现类，使用mapper代理方法时，输入参数可以使用pojo包装对象或map对象，保证dao的通用性。</li>\n</ul>"},{"title":"Mybatis(3)——SqlMapConfig.xml文件详解","date":"2018-02-27T08:23:39.000Z","_content":"MyBatis 的配置文件包含了会深深影响MyBatis行为的设置（settings）和属性（properties）信息。\n<!--more-->\n\nSqlMapConfig.xml中配置的内容和顺序如下：\n\n - properties(属性)\n - settings（全局配置参数）\n - typeAliases(类型别名)\n - typeHandlers（类型处理器）\n - objectFactory（对象工厂）\n - plugins（插件）\n - environments(环境)\n    - environment 环境变量\n        - transactionManager 事务管理器\n        - dataSource 数据源\n - databaseIdProvider(数据库厂商标识)\n - mappers（映射器）\n\n## 1、Properties\n\n这些属性都是可外部配置且可动态替换的，既可以在典型的 Java 属性文件中配置，亦可通过 properties 元素的子元素来传递。例如：\n在工程的classpath下新建jdbc.properties文件。\n\n```properties\njdbc.driverClass\t= com.mysql.jdbc.Driver\njdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb?characterEncoding=utf-8\njdbc.username\t\t= root\njdbc.password\t\t= 123\n```\n在sqlMapConfig.xml中配置如下：\n```xml\n<properties resource=\"jdbc.properties\">\n\t<property name=\"username\" value=\"dev_user\"/>\n\t<property name=\"password\" value=\"123456\"/>\n</properties>\n```\n其中的属性就可以在整个配置文件中使用来替换需要动态配置的属性值。比如:\n\n```xml\n<!-- 数据库连接池 -->\n<dataSource type=\"POOLED\">\n\t<property name=\"driver\" value=\"${jdbc.driverClass}\" />\n    <property name=\"url\" value=\"${jdbc.url}\" />\n\t<property name=\"username\" value=\"${jdbc.username}\" />\n    <property name=\"password\" value=\"${jdbc.password}\" />\n</dataSource>\n```\n\n注意： MyBatis 将按照下面的顺序来加载属性：\n\n - 在 properties 元素体内定义的属性首先被读取。\n - 然后会读取properties 元素中resource或 url加载的属性，它会覆盖已读取的同名属性。\n - 最后读取parameterType传递的属性，它会覆盖已读取的同名属性。\n\n因此，通过parameterType传递的属性具有最高优先级，resource或 url 加载的属性次之，最低优先级的是 properties 元素体内定义的属性。\n\n## 2、settings\n这是 MyBatis 中极为重要的调整设置，它们会改变MyBatis的运行时行为。下表描述了设置中各项的意图、默认值等。\n\n参数 | 描述 | 有效值 | 默认值\n- | :-: | :-: | :-:\ncacheEnabled | 该配置影响的所有映射器中配置的缓存的全局开关 | true/false |true\nHermione Granger | Gryffindor | 100 \nDraco Malfoy | Slytherin | 90\n\n具体配置见[Mybatis 3][1]。\n\n\n## 3、typeAliases\n\n类型别名是为 Java 类型设置一个短的名字。它只和XML配置有关，存在的意义仅在于用来减少类完全限定名的冗余。\nmybatis自身已经支持了部分数据类型的别名，如：\n别名 | 映射的类型\n:-: | :-: \n_byte | byte\n_long |\tlong\n_short | short\n\n 更多见[Mybatis 3][2]。\n \n 当然，我们需要自定义别名：\n \n```xml\n<typeAliases>\n    <!-- 单个别名定义 -->\n    <typeAlias alias=\"book\" type=\"com.topvision.maven.mybatis.domain.Book\"/>\n    <!-- 批量别名定义，扫描整个包下的类，别名为类名（首字母大写或小写都可以） -->\n    <package name=\"com.topvision.maven.mybatis.domain\"/>\n    <package name=\"其它包\"/>\n</typeAliases>\n```\n\n## 4、typeHandlers\n\n类型处理器用于java类型和jdbc类型映射，如下:\n\n```xml\n<select id=\"findUserById\" parameterType=\"int\" resultType=\"user\">\n    select * from user where id = #{id}\n</select>\n```\nmybatis自带的类型处理器基本上满足日常需求，不需要单独定义。\n\n## 5、environments\n\n```xml\n<!-- 和spring整合后 environments配置将废除 -->\n<environments default=\"development\">\n\t<environment id=\"development\">\n\t\t<!-- 使用jdbc事务管理 -->\n\t\t<transactionManager type=\"JDBC\" />\n\t\t<!-- 数据库连接池 -->\n\t\t<dataSource type=\"POOLED\">\n\t\t\t<property name=\"driver\" value=\"${jdbc.driverClass}\" />\n\t\t\t<property name=\"url\" value=\"${jdbc.url}\" />\n\t\t\t<property name=\"username\" value=\"${jdbc.username}\" />\n\t\t\t<property name=\"password\" value=\"${jdbc.password}\" />\n\t\t</dataSource>\n\t</environment>\n</environments>\n```\n\n## 6、mappers\n\n既然 MyBatis 的行为已经由上述元素配置完了，我们现在就要定义SQL映射语句了。但是首先我们需要告诉 MyBatis 到哪里去找到这些语句。Java在自动查找这方面没有提供一个很好的方法，所以最佳的方式是告诉MyBatis到哪里去找映射文件。你可以使用相对于类路径的资源引用， 或完全限定资源定位符（包括 file:/// 的 URL），或类名和包名等。例如：\n\n 1. 使用相对于类路径的资源\n\n    ```xml\n    <mapper resource=\"sqlmap/User.xml\" />\n    ```\n    \n 2. 使用完全限定路径\n\n    ```xml\n    <mapper url=\"file:///D:\\workspace_spingmvc\\mybatis_01\\config\\sqlmap\\User.xml\" />\n    ```\n\n 3. 使用mapper接口类路径\n \n    ```xml\n    <mapper class=\"com.topvision.mybatis.mapper.UserMapper\"/>\n    ```\n    注意：此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中.\n    \n 4. 注册指定包下的所有mapper接口\n\n    ```xml\n    <package name=\"com.topvision.mybatis.mapper\"/>\n    ```\n    \n    注意：此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中。\n\n\n  [1]: http://www.mybatis.org/mybatis-3/zh/configuration.html#settings\n  [2]: http://www.mybatis.org/mybatis-3/zh/configuration.html#typeAliases","source":"_posts/Mybatis-3-——SqlMapConfig-xml文件详解.md","raw":"---\ntitle: Mybatis(3)——SqlMapConfig.xml文件详解\ncategories:\n  - Mybatis\ntags:\n  - Mybatis\ndate: 2018-02-27 16:23:39\n---\nMyBatis 的配置文件包含了会深深影响MyBatis行为的设置（settings）和属性（properties）信息。\n<!--more-->\n\nSqlMapConfig.xml中配置的内容和顺序如下：\n\n - properties(属性)\n - settings（全局配置参数）\n - typeAliases(类型别名)\n - typeHandlers（类型处理器）\n - objectFactory（对象工厂）\n - plugins（插件）\n - environments(环境)\n    - environment 环境变量\n        - transactionManager 事务管理器\n        - dataSource 数据源\n - databaseIdProvider(数据库厂商标识)\n - mappers（映射器）\n\n## 1、Properties\n\n这些属性都是可外部配置且可动态替换的，既可以在典型的 Java 属性文件中配置，亦可通过 properties 元素的子元素来传递。例如：\n在工程的classpath下新建jdbc.properties文件。\n\n```properties\njdbc.driverClass\t= com.mysql.jdbc.Driver\njdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb?characterEncoding=utf-8\njdbc.username\t\t= root\njdbc.password\t\t= 123\n```\n在sqlMapConfig.xml中配置如下：\n```xml\n<properties resource=\"jdbc.properties\">\n\t<property name=\"username\" value=\"dev_user\"/>\n\t<property name=\"password\" value=\"123456\"/>\n</properties>\n```\n其中的属性就可以在整个配置文件中使用来替换需要动态配置的属性值。比如:\n\n```xml\n<!-- 数据库连接池 -->\n<dataSource type=\"POOLED\">\n\t<property name=\"driver\" value=\"${jdbc.driverClass}\" />\n    <property name=\"url\" value=\"${jdbc.url}\" />\n\t<property name=\"username\" value=\"${jdbc.username}\" />\n    <property name=\"password\" value=\"${jdbc.password}\" />\n</dataSource>\n```\n\n注意： MyBatis 将按照下面的顺序来加载属性：\n\n - 在 properties 元素体内定义的属性首先被读取。\n - 然后会读取properties 元素中resource或 url加载的属性，它会覆盖已读取的同名属性。\n - 最后读取parameterType传递的属性，它会覆盖已读取的同名属性。\n\n因此，通过parameterType传递的属性具有最高优先级，resource或 url 加载的属性次之，最低优先级的是 properties 元素体内定义的属性。\n\n## 2、settings\n这是 MyBatis 中极为重要的调整设置，它们会改变MyBatis的运行时行为。下表描述了设置中各项的意图、默认值等。\n\n参数 | 描述 | 有效值 | 默认值\n- | :-: | :-: | :-:\ncacheEnabled | 该配置影响的所有映射器中配置的缓存的全局开关 | true/false |true\nHermione Granger | Gryffindor | 100 \nDraco Malfoy | Slytherin | 90\n\n具体配置见[Mybatis 3][1]。\n\n\n## 3、typeAliases\n\n类型别名是为 Java 类型设置一个短的名字。它只和XML配置有关，存在的意义仅在于用来减少类完全限定名的冗余。\nmybatis自身已经支持了部分数据类型的别名，如：\n别名 | 映射的类型\n:-: | :-: \n_byte | byte\n_long |\tlong\n_short | short\n\n 更多见[Mybatis 3][2]。\n \n 当然，我们需要自定义别名：\n \n```xml\n<typeAliases>\n    <!-- 单个别名定义 -->\n    <typeAlias alias=\"book\" type=\"com.topvision.maven.mybatis.domain.Book\"/>\n    <!-- 批量别名定义，扫描整个包下的类，别名为类名（首字母大写或小写都可以） -->\n    <package name=\"com.topvision.maven.mybatis.domain\"/>\n    <package name=\"其它包\"/>\n</typeAliases>\n```\n\n## 4、typeHandlers\n\n类型处理器用于java类型和jdbc类型映射，如下:\n\n```xml\n<select id=\"findUserById\" parameterType=\"int\" resultType=\"user\">\n    select * from user where id = #{id}\n</select>\n```\nmybatis自带的类型处理器基本上满足日常需求，不需要单独定义。\n\n## 5、environments\n\n```xml\n<!-- 和spring整合后 environments配置将废除 -->\n<environments default=\"development\">\n\t<environment id=\"development\">\n\t\t<!-- 使用jdbc事务管理 -->\n\t\t<transactionManager type=\"JDBC\" />\n\t\t<!-- 数据库连接池 -->\n\t\t<dataSource type=\"POOLED\">\n\t\t\t<property name=\"driver\" value=\"${jdbc.driverClass}\" />\n\t\t\t<property name=\"url\" value=\"${jdbc.url}\" />\n\t\t\t<property name=\"username\" value=\"${jdbc.username}\" />\n\t\t\t<property name=\"password\" value=\"${jdbc.password}\" />\n\t\t</dataSource>\n\t</environment>\n</environments>\n```\n\n## 6、mappers\n\n既然 MyBatis 的行为已经由上述元素配置完了，我们现在就要定义SQL映射语句了。但是首先我们需要告诉 MyBatis 到哪里去找到这些语句。Java在自动查找这方面没有提供一个很好的方法，所以最佳的方式是告诉MyBatis到哪里去找映射文件。你可以使用相对于类路径的资源引用， 或完全限定资源定位符（包括 file:/// 的 URL），或类名和包名等。例如：\n\n 1. 使用相对于类路径的资源\n\n    ```xml\n    <mapper resource=\"sqlmap/User.xml\" />\n    ```\n    \n 2. 使用完全限定路径\n\n    ```xml\n    <mapper url=\"file:///D:\\workspace_spingmvc\\mybatis_01\\config\\sqlmap\\User.xml\" />\n    ```\n\n 3. 使用mapper接口类路径\n \n    ```xml\n    <mapper class=\"com.topvision.mybatis.mapper.UserMapper\"/>\n    ```\n    注意：此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中.\n    \n 4. 注册指定包下的所有mapper接口\n\n    ```xml\n    <package name=\"com.topvision.mybatis.mapper\"/>\n    ```\n    \n    注意：此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中。\n\n\n  [1]: http://www.mybatis.org/mybatis-3/zh/configuration.html#settings\n  [2]: http://www.mybatis.org/mybatis-3/zh/configuration.html#typeAliases","slug":"Mybatis-3-——SqlMapConfig-xml文件详解","published":1,"updated":"2018-03-06T08:24:20.331Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfsq0013hwvfkrzbii7j","content":"<p>MyBatis 的配置文件包含了会深深影响MyBatis行为的设置（settings）和属性（properties）信息。<br><a id=\"more\"></a></p>\n<p>SqlMapConfig.xml中配置的内容和顺序如下：</p>\n<ul>\n<li>properties(属性)</li>\n<li>settings（全局配置参数）</li>\n<li>typeAliases(类型别名)</li>\n<li>typeHandlers（类型处理器）</li>\n<li>objectFactory（对象工厂）</li>\n<li>plugins（插件）</li>\n<li>environments(环境)<ul>\n<li>environment 环境变量<ul>\n<li>transactionManager 事务管理器</li>\n<li>dataSource 数据源</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>databaseIdProvider(数据库厂商标识)</li>\n<li>mappers（映射器）</li>\n</ul>\n<h2 id=\"1、Properties\"><a href=\"#1、Properties\" class=\"headerlink\" title=\"1、Properties\"></a>1、Properties</h2><p>这些属性都是可外部配置且可动态替换的，既可以在典型的 Java 属性文件中配置，亦可通过 properties 元素的子元素来传递。例如：<br>在工程的classpath下新建jdbc.properties文件。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">jdbc.driverClass\t= com.mysql.jdbc.Driver</div><div class=\"line\">jdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb?characterEncoding=utf-8</div><div class=\"line\">jdbc.username\t\t= root</div><div class=\"line\">jdbc.password\t\t= 123</div></pre></td></tr></table></figure>\n<p>在sqlMapConfig.xml中配置如下：<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">properties</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"jdbc.properties\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"dev_user\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"123456\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>其中的属性就可以在整个配置文件中使用来替换需要动态配置的属性值。比如:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 数据库连接池 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dataSource</span> <span class=\"attr\">type</span>=<span class=\"string\">\"POOLED\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.driverClass&#125;\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.url&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.username&#125;\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.password&#125;\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dataSource</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>注意： MyBatis 将按照下面的顺序来加载属性：</p>\n<ul>\n<li>在 properties 元素体内定义的属性首先被读取。</li>\n<li>然后会读取properties 元素中resource或 url加载的属性，它会覆盖已读取的同名属性。</li>\n<li>最后读取parameterType传递的属性，它会覆盖已读取的同名属性。</li>\n</ul>\n<p>因此，通过parameterType传递的属性具有最高优先级，resource或 url 加载的属性次之，最低优先级的是 properties 元素体内定义的属性。</p>\n<h2 id=\"2、settings\"><a href=\"#2、settings\" class=\"headerlink\" title=\"2、settings\"></a>2、settings</h2><p>这是 MyBatis 中极为重要的调整设置，它们会改变MyBatis的运行时行为。下表描述了设置中各项的意图、默认值等。</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th style=\"text-align:center\">描述</th>\n<th style=\"text-align:center\">有效值</th>\n<th style=\"text-align:center\">默认值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>cacheEnabled</td>\n<td style=\"text-align:center\">该配置影响的所有映射器中配置的缓存的全局开关</td>\n<td style=\"text-align:center\">true/false</td>\n<td style=\"text-align:center\">true</td>\n</tr>\n<tr>\n<td>Hermione Granger</td>\n<td style=\"text-align:center\">Gryffindor</td>\n<td style=\"text-align:center\">100 </td>\n</tr>\n<tr>\n<td>Draco Malfoy</td>\n<td style=\"text-align:center\">Slytherin</td>\n<td style=\"text-align:center\">90</td>\n</tr>\n</tbody>\n</table>\n<p>具体配置见<a href=\"http://www.mybatis.org/mybatis-3/zh/configuration.html#settings\" target=\"_blank\" rel=\"noopener\">Mybatis 3</a>。</p>\n<h2 id=\"3、typeAliases\"><a href=\"#3、typeAliases\" class=\"headerlink\" title=\"3、typeAliases\"></a>3、typeAliases</h2><p>类型别名是为 Java 类型设置一个短的名字。它只和XML配置有关，存在的意义仅在于用来减少类完全限定名的冗余。<br>mybatis自身已经支持了部分数据类型的别名，如：<br>别名 | 映射的类型<br>:-: | :-:<br>_byte | byte<br>_long |    long<br>_short | short</p>\n<p> 更多见<a href=\"http://www.mybatis.org/mybatis-3/zh/configuration.html#typeAliases\" target=\"_blank\" rel=\"noopener\">Mybatis 3</a>。</p>\n<p> 当然，我们需要自定义别名：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">typeAliases</span>&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 单个别名定义 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">typeAlias</span> <span class=\"attr\">alias</span>=<span class=\"string\">\"book\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"com.topvision.maven.mybatis.domain.Book\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 批量别名定义，扫描整个包下的类，别名为类名（首字母大写或小写都可以） --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"com.topvision.maven.mybatis.domain\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"其它包\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">typeAliases</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"4、typeHandlers\"><a href=\"#4、typeHandlers\" class=\"headerlink\" title=\"4、typeHandlers\"></a>4、typeHandlers</h2><p>类型处理器用于java类型和jdbc类型映射，如下:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findUserById\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"int\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">    select * from user where id = #&#123;id&#125;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>mybatis自带的类型处理器基本上满足日常需求，不需要单独定义。</p>\n<h2 id=\"5、environments\"><a href=\"#5、environments\" class=\"headerlink\" title=\"5、environments\"></a>5、environments</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 和spring整合后 environments配置将废除 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">environments</span> <span class=\"attr\">default</span>=<span class=\"string\">\"development\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">environment</span> <span class=\"attr\">id</span>=<span class=\"string\">\"development\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 使用jdbc事务管理 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">transactionManager</span> <span class=\"attr\">type</span>=<span class=\"string\">\"JDBC\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 数据库连接池 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dataSource</span> <span class=\"attr\">type</span>=<span class=\"string\">\"POOLED\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.driverClass&#125;\"</span> /&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.url&#125;\"</span> /&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.username&#125;\"</span> /&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.password&#125;\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dataSource</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">environment</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">environments</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"6、mappers\"><a href=\"#6、mappers\" class=\"headerlink\" title=\"6、mappers\"></a>6、mappers</h2><p>既然 MyBatis 的行为已经由上述元素配置完了，我们现在就要定义SQL映射语句了。但是首先我们需要告诉 MyBatis 到哪里去找到这些语句。Java在自动查找这方面没有提供一个很好的方法，所以最佳的方式是告诉MyBatis到哪里去找映射文件。你可以使用相对于类路径的资源引用， 或完全限定资源定位符（包括 file:/// 的 URL），或类名和包名等。例如：</p>\n<ol>\n<li><p>使用相对于类路径的资源</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"sqlmap/User.xml\"</span> /&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>使用完全限定路径</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">url</span>=<span class=\"string\">\"file:///D:\\workspace_spingmvc\\mybatis_01\\config\\sqlmap\\User.xml\"</span> /&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>使用mapper接口类路径</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.mybatis.mapper.UserMapper\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>注意：此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中.</p>\n</li>\n<li><p>注册指定包下的所有mapper接口</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"com.topvision.mybatis.mapper\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>注意：此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中。\n</code></pre>","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>MyBatis 的配置文件包含了会深深影响MyBatis行为的设置（settings）和属性（properties）信息。<br>","more":"</p>\n<p>SqlMapConfig.xml中配置的内容和顺序如下：</p>\n<ul>\n<li>properties(属性)</li>\n<li>settings（全局配置参数）</li>\n<li>typeAliases(类型别名)</li>\n<li>typeHandlers（类型处理器）</li>\n<li>objectFactory（对象工厂）</li>\n<li>plugins（插件）</li>\n<li>environments(环境)<ul>\n<li>environment 环境变量<ul>\n<li>transactionManager 事务管理器</li>\n<li>dataSource 数据源</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>databaseIdProvider(数据库厂商标识)</li>\n<li>mappers（映射器）</li>\n</ul>\n<h2 id=\"1、Properties\"><a href=\"#1、Properties\" class=\"headerlink\" title=\"1、Properties\"></a>1、Properties</h2><p>这些属性都是可外部配置且可动态替换的，既可以在典型的 Java 属性文件中配置，亦可通过 properties 元素的子元素来传递。例如：<br>在工程的classpath下新建jdbc.properties文件。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">jdbc.driverClass\t= com.mysql.jdbc.Driver</div><div class=\"line\">jdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb?characterEncoding=utf-8</div><div class=\"line\">jdbc.username\t\t= root</div><div class=\"line\">jdbc.password\t\t= 123</div></pre></td></tr></table></figure>\n<p>在sqlMapConfig.xml中配置如下：<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">properties</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"jdbc.properties\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"dev_user\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"123456\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>其中的属性就可以在整个配置文件中使用来替换需要动态配置的属性值。比如:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 数据库连接池 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dataSource</span> <span class=\"attr\">type</span>=<span class=\"string\">\"POOLED\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.driverClass&#125;\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.url&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.username&#125;\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.password&#125;\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dataSource</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>注意： MyBatis 将按照下面的顺序来加载属性：</p>\n<ul>\n<li>在 properties 元素体内定义的属性首先被读取。</li>\n<li>然后会读取properties 元素中resource或 url加载的属性，它会覆盖已读取的同名属性。</li>\n<li>最后读取parameterType传递的属性，它会覆盖已读取的同名属性。</li>\n</ul>\n<p>因此，通过parameterType传递的属性具有最高优先级，resource或 url 加载的属性次之，最低优先级的是 properties 元素体内定义的属性。</p>\n<h2 id=\"2、settings\"><a href=\"#2、settings\" class=\"headerlink\" title=\"2、settings\"></a>2、settings</h2><p>这是 MyBatis 中极为重要的调整设置，它们会改变MyBatis的运行时行为。下表描述了设置中各项的意图、默认值等。</p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th style=\"text-align:center\">描述</th>\n<th style=\"text-align:center\">有效值</th>\n<th style=\"text-align:center\">默认值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>cacheEnabled</td>\n<td style=\"text-align:center\">该配置影响的所有映射器中配置的缓存的全局开关</td>\n<td style=\"text-align:center\">true/false</td>\n<td style=\"text-align:center\">true</td>\n</tr>\n<tr>\n<td>Hermione Granger</td>\n<td style=\"text-align:center\">Gryffindor</td>\n<td style=\"text-align:center\">100 </td>\n</tr>\n<tr>\n<td>Draco Malfoy</td>\n<td style=\"text-align:center\">Slytherin</td>\n<td style=\"text-align:center\">90</td>\n</tr>\n</tbody>\n</table>\n<p>具体配置见<a href=\"http://www.mybatis.org/mybatis-3/zh/configuration.html#settings\" target=\"_blank\" rel=\"noopener\">Mybatis 3</a>。</p>\n<h2 id=\"3、typeAliases\"><a href=\"#3、typeAliases\" class=\"headerlink\" title=\"3、typeAliases\"></a>3、typeAliases</h2><p>类型别名是为 Java 类型设置一个短的名字。它只和XML配置有关，存在的意义仅在于用来减少类完全限定名的冗余。<br>mybatis自身已经支持了部分数据类型的别名，如：<br>别名 | 映射的类型<br>:-: | :-:<br>_byte | byte<br>_long |    long<br>_short | short</p>\n<p> 更多见<a href=\"http://www.mybatis.org/mybatis-3/zh/configuration.html#typeAliases\" target=\"_blank\" rel=\"noopener\">Mybatis 3</a>。</p>\n<p> 当然，我们需要自定义别名：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">typeAliases</span>&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 单个别名定义 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">typeAlias</span> <span class=\"attr\">alias</span>=<span class=\"string\">\"book\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"com.topvision.maven.mybatis.domain.Book\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 批量别名定义，扫描整个包下的类，别名为类名（首字母大写或小写都可以） --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"com.topvision.maven.mybatis.domain\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"其它包\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">typeAliases</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"4、typeHandlers\"><a href=\"#4、typeHandlers\" class=\"headerlink\" title=\"4、typeHandlers\"></a>4、typeHandlers</h2><p>类型处理器用于java类型和jdbc类型映射，如下:</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findUserById\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"int\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">    select * from user where id = #&#123;id&#125;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>mybatis自带的类型处理器基本上满足日常需求，不需要单独定义。</p>\n<h2 id=\"5、environments\"><a href=\"#5、environments\" class=\"headerlink\" title=\"5、environments\"></a>5、environments</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 和spring整合后 environments配置将废除 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">environments</span> <span class=\"attr\">default</span>=<span class=\"string\">\"development\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">environment</span> <span class=\"attr\">id</span>=<span class=\"string\">\"development\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 使用jdbc事务管理 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">transactionManager</span> <span class=\"attr\">type</span>=<span class=\"string\">\"JDBC\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 数据库连接池 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dataSource</span> <span class=\"attr\">type</span>=<span class=\"string\">\"POOLED\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.driverClass&#125;\"</span> /&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.url&#125;\"</span> /&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.username&#125;\"</span> /&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.password&#125;\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dataSource</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">environment</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">environments</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"6、mappers\"><a href=\"#6、mappers\" class=\"headerlink\" title=\"6、mappers\"></a>6、mappers</h2><p>既然 MyBatis 的行为已经由上述元素配置完了，我们现在就要定义SQL映射语句了。但是首先我们需要告诉 MyBatis 到哪里去找到这些语句。Java在自动查找这方面没有提供一个很好的方法，所以最佳的方式是告诉MyBatis到哪里去找映射文件。你可以使用相对于类路径的资源引用， 或完全限定资源定位符（包括 file:/// 的 URL），或类名和包名等。例如：</p>\n<ol>\n<li><p>使用相对于类路径的资源</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"sqlmap/User.xml\"</span> /&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>使用完全限定路径</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">url</span>=<span class=\"string\">\"file:///D:\\workspace_spingmvc\\mybatis_01\\config\\sqlmap\\User.xml\"</span> /&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>使用mapper接口类路径</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.mybatis.mapper.UserMapper\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>注意：此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中.</p>\n</li>\n<li><p>注册指定包下的所有mapper接口</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"com.topvision.mybatis.mapper\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>注意：此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中。\n</code></pre>"},{"title":"Mybatis(1)——入门","date":"2018-02-27T03:15:13.000Z","_content":"MyBatis 本是apache的一个开源项目iBatis, 2010年这个项目由apache software foundation 迁移到了google code，并且改名为MyBatis，实质上Mybatis对ibatis进行一些改进。 \nMyBatis是一个优秀的持久层框架，它对jdbc的操作数据库的过程进行封装，使开发者只需要关注 SQL 本身，而不需要花费精力去处理例如注册驱动、创建connection、创建statement、手动设置参数、结果集检索等jdbc繁杂的过程代码。\nMybatis通过xml或注解的方式将要执行的各种statement（statement、preparedStatemnt、CallableStatement）配置起来，并通过java对象和statement中的sql进行映射生成最终执行的sql语句，最后由mybatis框架执行sql并将结果映射成java对象并返回。\n<!--more-->\n\n## 1、资源下载\n\nmybaits的代码由github.com管理，地址：https://github.com/mybatis/mybatis-3/releases\n要使用 MyBatis， 只需将 mybatis-x.x.x.jar 文件置于 classpath 中即可。\n\n如果使用 Maven 来构建项目，则需将下面的 dependency 代码置于 pom.xml 文件中：\n```xml\n<dependency>\n    <groupId>org.mybatis</groupId>\n    <artifactId>mybatis</artifactId>\n    <version>x.x.x</version>\n</dependency>\n```\n\n## 2、架构\n![mybatis原理图][1]\n\n 1. SqlMapConfig.xml\n    mybatis的全局配置文件，配置了运行环境等信息。mapper.xml即映射文件，里面配置了操作数据库的sql语句，该类文件需要在SqlMapConfig.xml中加载。\n 2. SqlSessionFactory\n    通过mybatis环境等配置信息构造SqlSessionFactory即会话工厂\n 3. SqlSession\n    由会话工厂创建sqlSession即会话，操作数据库需要通过sqlSession进行\n 4. Executor\n    mybatis底层自定义了Executor执行器接口操作数据库，Executor接口有两个实现，一个是基本执行器、一个是缓存执行器。\n 5. Mapper Statement\n    mybatis底层封装对象，它包装了mybatis配置信息及sql映射信息等。mapper.xml文件中一个sql对应一个Mapped Statement对象，sql的id即是Mapped statement的id。\n    Mapped Statement对sql执行输入参数进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql前将输入的java对象映射至sql中，输入参数映射就是jdbc编程中对preparedStatement设置参数。\n    Mapped Statement对sql执行输出结果进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql后将输出结果映射至java对象中，输出结果映射过程相当于jdbc编程中对结果的解析处理过程。\n\n## 3、特点\n![此处输入图片的描述][2]\n\n上边使用jdbc的原始方法（未经封装）实现了查询数据库表记录的操作。\n\n**JDBC编程问题总结：**\n1、\t数据库链接创建、释放频繁造成系统资源浪费从而影响系统性能，如果使用数据库链接池可解决此问题。\n<font color=\"red\">解决：在SqlMapConfig.xml中配置数据链接池，使用连接池管理数据库链接</font>\n2、\tSql语句在代码中硬编码，造成代码不易维护，实际应用sql变化的可能较大，sql变动需要改变java代码。\n<font color=\"red\">解决：将Sql语句配置在XXXXmapper.xml文件中与java代码分离。</font>\n3、\t使用preparedStatement向占有位符号传参数存在硬编码，因为sql语句的where条件不一定，可能多也可能少，修改sql还要修改代码，系统不易维护。\n<font color=\"red\">解决：Mybatis自动将java对象映射至sql语句，通过statement中的parameterType定义输入参数的类型。</font>\n4、\t对结果集解析存在硬编码（查询列名），sql变化导致解析代码变化，系统不易维护，如果能将数据库记录封装成pojo对象解析比较方便。\n<font color=\"red\">解决：Mybatis自动将sql执行结果映射至java对象，通过statement中的resultType定义输出结果的类型。</font>\n\n\n## 4、入门程序搭建\n\n需求:查询图书id查询图书信息\n\n创建数据库，新建book表：\n```sql\nCREATE TABLE `book` (\n  `book_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '图书ID',\n  `name` varchar(100) NOT NULL COMMENT '图书名称',\n  `number` int(11) NOT NULL COMMENT '馆藏数量',\n  PRIMARY KEY (`book_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=1004 DEFAULT CHARSET=utf8 COMMENT='图书表'\n\nINSERT INTO `book` VALUES ('1000', 'Java程序设计', '10');\nINSERT INTO `book` VALUES ('1001', '数据结构', '10');\nINSERT INTO `book` VALUES ('1002', '设计模式', '10');\nINSERT INTO `book` VALUES ('1003', '编译原理', '10');\n```\n\n### 4.1、maven创建java工程\n省略\n\n### 4.2、引入依赖\n加入mybatis核心包、依赖包、数据驱动包。完整的pom配置如下：\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\n\t<groupId>com.topvision.maven</groupId>\n\t<artifactId>mybatis</artifactId>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<packaging>jar</packaging>\n\n\t<name>mybatis</name>\n\t<url>http://maven.apache.org</url>\n\n\t<properties>\n\t\t<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n\t\t<mybatis.version>3.4.5</mybatis.version>\n\t</properties>\n\n\t<dependencyManagement>\n\t\t<dependencies>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t\t<artifactId>mybatis</artifactId>\n\t\t\t\t<version>${mybatis.version}</version>\n\t\t\t</dependency>\n\t\t</dependencies>\n\t</dependencyManagement>\n\n\t<dependencies>\n\t\t<!-- mybatis -->\n\t\t<dependency>\n\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t<artifactId>mybatis</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t<artifactId>mybatis-spring</artifactId>\n\t\t\t<version>1.3.1</version>\n\t\t</dependency>\n\n\t\t<!-- mysql驱动 -->\n\t\t<dependency>\n\t\t\t<groupId>mysql</groupId>\n\t\t\t<artifactId>mysql-connector-java</artifactId>\n\t\t\t<version>5.1.6</version>\n\t\t\t<scope>runtime</scope>\n\t\t</dependency>\n\n\t\t<!-- c3p0 -->\n\t\t<dependency>\n\t\t\t<groupId>c3p0</groupId>\n\t\t\t<artifactId>c3p0</artifactId>\n\t\t\t<version>0.9.1.2</version>\n\t\t</dependency>\n\t\t<!-- slf4j -->\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-api</artifactId>\n\t\t\t<version>1.7.5</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-log4j12</artifactId>\n\t\t\t<version>1.7.12</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>log4j</groupId>\n\t\t\t<artifactId>log4j</artifactId>\n\t\t\t<version>1.2.17</version>\n\t\t</dependency>\n\t\t<!-- junit -->\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>4.9</version>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t</dependencies>\n\n\t<build>\n\t\t<plugins>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n\t\t\t\t<artifactId>maven-compiler-plugin</artifactId>\n\t\t\t\t<configuration>\n\t\t\t\t\t<source>1.8</source>\n\t\t\t\t\t<target>1.8</target>\n\t\t\t\t\t<encoding>UTF-8</encoding>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t</plugins>\n\n\t\t<finalName>mybatis</finalName>\n\t</build>\n</project>\n```\n\n### 4.3、log4j.properties\n\n在classpath下加入日志配置：\n```properties\n#定义LOG输出级别  \nlog4j.rootLogger=DEBUG,Console,File  \n#定义日志输出目的地为控制台  \nlog4j.appender.Console=org.apache.log4j.ConsoleAppender  \nlog4j.appender.Console.Target=System.out  \n#可以灵活地指定日志输出格式，下面一行是指定具体的格式  \nlog4j.appender.Console.layout = org.apache.log4j.PatternLayout  \nlog4j.appender.Console.layout.ConversionPattern=[%c] - %m%n  \n  \n#文件大小到达指定尺寸的时候产生一个新的文件  \nlog4j.appender.File = org.apache.log4j.RollingFileAppender  \n#指定输出目录  \nlog4j.appender.File.File = logs/ssm.log\n#定义文件最大大小  \nlog4j.appender.File.MaxFileSize = 10MB  \n#输出所有日志，如果换成DEBUG表示输出DEBUG以上级别日志  \nlog4j.appender.File.Threshold = ALL  \nlog4j.appender.File.layout = org.apache.log4j.PatternLayout  \nlog4j.appender.File.layout.ConversionPattern =[%p] [%d{yyyy-MM-dd HH\\:mm\\:ss}][%c]%m%n \n```\n\n### 4.4、jdbc.properties\n\n在classpath下新建数据库连接文件。\n\n```properties\njdbc.driverClass\t= com.mysql.jdbc.Driver\njdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb?characterEncoding=utf-8\njdbc.username\t\t= root\njdbc.password\t\t= 123\n```\n\n### 4.4、SqlMapConfig.xml\n\n在classpath下新建SqlMapConfig.xml文件，配置mybatis运行环境。\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE configuration\nPUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"\n\"http://mybatis.org/dtd/mybatis-3-config.dtd\">\n<configuration>\n\t<properties resource=\"jdbc.properties\"/>\n\t\n\t<!-- 和spring整合后 environments配置将废除 -->\n\t<environments default=\"development\">\n\t\t<environment id=\"development\">\n\t\t\t<!-- 使用jdbc事务管理 -->\n\t\t\t<transactionManager type=\"JDBC\" />\n\t\t\t<!-- 数据库连接池 -->\n\t\t\t<dataSource type=\"POOLED\">\n\t\t\t\t<property name=\"driver\" value=\"${jdbc.driverClass}\" />\n                <property name=\"url\" value=\"${jdbc.url}\" />\n\t\t\t\t<property name=\"username\" value=\"${jdbc.username}\" />\n                <property name=\"password\" value=\"${jdbc.password}\" />\n\t\t\t</dataSource>\n\t\t</environment>\n\t</environments>\n\t\n</configuration>\n```\nSqlMapConfig.xml是mybatis核心配置文件，上边文件的配置内容为数据源、事务管理。\n\n### 4.5、编写Po类\n\nPo类作为mybatis进行sql映射使用，po类通常与数据库表对应，Book.java如下:\n```java\npublic class Book {\n\n    private long bookId;// 图书ID\n    private String name;// 图书名称\n    private int number;// 馆藏数量\n    ...\n```\n\n### 4.6、编写映射文件（sql）\n在classpath下的sqlmap目录下创建sql映射文件Book.xml：\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE mapper\nPUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n\n<mapper namespace=\"test\">\n\t<select id=\"queryById\" parameterType=\"long\" resultType=\"com.topvision.maven.mybatis.domain.Book\">\n\t\tselect book_id bookId,name,number from book where book_id = #{id}\n\t</select>\n</mapper>\n```\n\nnamespace ：命名空间，用于隔离sql语句，后面会讲另一层非常重要的作用。\nparameterType：定义输入到sql中的映射类型，#{id}表示使用preparedstatement设置占位符号并将输入变量id传到sql。\nresultType：定义结果映射类型。\n\n### 4.7、加载映射文件\n\n在SqlMapConfig.xml中加载映射文件Book.xml\n\n```xml\n<mappers>\n    <mapper resource=\"sqlmap/Book.xml\"/>\n</mappers>\n```\n\n### 4.8、测试\n\n```java\npublic class BookDaoTest {\n    private SqlSessionFactory sqlSessionFactory;\n    \n    @Before\n    public void createSqlSessionFactory() throws IOException{\n        String resource = \"sqlMapConfig.xml\";\n        InputStream inputStream = Resources.getResourceAsStream(resource);\n        \n        sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);\n    }\n\n    @Test\n    public void testQueryById() {\n        SqlSession sqlSession = null;\n        try {\n            sqlSession = sqlSessionFactory.openSession();\n            Book book = sqlSession.selectOne(\"test.queryById\",1000l);\n            System.out.println(book);\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            if (sqlSession != null) {\n                sqlSession.close();\n            }\n        }\n    }\n}\n```\n\n至此，若能查询出结果，则工程搭建成功。\n\n\n\n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/mybatis/framework.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/mybatis/jdbcProgram.png","source":"_posts/Mybatis-1-——入门.md","raw":"---\ntitle: Mybatis(1)——入门\ncategories:\n  - Mybatis\ntags:\n  - Mybatis\ndate: 2018-02-27 11:15:13\n---\nMyBatis 本是apache的一个开源项目iBatis, 2010年这个项目由apache software foundation 迁移到了google code，并且改名为MyBatis，实质上Mybatis对ibatis进行一些改进。 \nMyBatis是一个优秀的持久层框架，它对jdbc的操作数据库的过程进行封装，使开发者只需要关注 SQL 本身，而不需要花费精力去处理例如注册驱动、创建connection、创建statement、手动设置参数、结果集检索等jdbc繁杂的过程代码。\nMybatis通过xml或注解的方式将要执行的各种statement（statement、preparedStatemnt、CallableStatement）配置起来，并通过java对象和statement中的sql进行映射生成最终执行的sql语句，最后由mybatis框架执行sql并将结果映射成java对象并返回。\n<!--more-->\n\n## 1、资源下载\n\nmybaits的代码由github.com管理，地址：https://github.com/mybatis/mybatis-3/releases\n要使用 MyBatis， 只需将 mybatis-x.x.x.jar 文件置于 classpath 中即可。\n\n如果使用 Maven 来构建项目，则需将下面的 dependency 代码置于 pom.xml 文件中：\n```xml\n<dependency>\n    <groupId>org.mybatis</groupId>\n    <artifactId>mybatis</artifactId>\n    <version>x.x.x</version>\n</dependency>\n```\n\n## 2、架构\n![mybatis原理图][1]\n\n 1. SqlMapConfig.xml\n    mybatis的全局配置文件，配置了运行环境等信息。mapper.xml即映射文件，里面配置了操作数据库的sql语句，该类文件需要在SqlMapConfig.xml中加载。\n 2. SqlSessionFactory\n    通过mybatis环境等配置信息构造SqlSessionFactory即会话工厂\n 3. SqlSession\n    由会话工厂创建sqlSession即会话，操作数据库需要通过sqlSession进行\n 4. Executor\n    mybatis底层自定义了Executor执行器接口操作数据库，Executor接口有两个实现，一个是基本执行器、一个是缓存执行器。\n 5. Mapper Statement\n    mybatis底层封装对象，它包装了mybatis配置信息及sql映射信息等。mapper.xml文件中一个sql对应一个Mapped Statement对象，sql的id即是Mapped statement的id。\n    Mapped Statement对sql执行输入参数进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql前将输入的java对象映射至sql中，输入参数映射就是jdbc编程中对preparedStatement设置参数。\n    Mapped Statement对sql执行输出结果进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql后将输出结果映射至java对象中，输出结果映射过程相当于jdbc编程中对结果的解析处理过程。\n\n## 3、特点\n![此处输入图片的描述][2]\n\n上边使用jdbc的原始方法（未经封装）实现了查询数据库表记录的操作。\n\n**JDBC编程问题总结：**\n1、\t数据库链接创建、释放频繁造成系统资源浪费从而影响系统性能，如果使用数据库链接池可解决此问题。\n<font color=\"red\">解决：在SqlMapConfig.xml中配置数据链接池，使用连接池管理数据库链接</font>\n2、\tSql语句在代码中硬编码，造成代码不易维护，实际应用sql变化的可能较大，sql变动需要改变java代码。\n<font color=\"red\">解决：将Sql语句配置在XXXXmapper.xml文件中与java代码分离。</font>\n3、\t使用preparedStatement向占有位符号传参数存在硬编码，因为sql语句的where条件不一定，可能多也可能少，修改sql还要修改代码，系统不易维护。\n<font color=\"red\">解决：Mybatis自动将java对象映射至sql语句，通过statement中的parameterType定义输入参数的类型。</font>\n4、\t对结果集解析存在硬编码（查询列名），sql变化导致解析代码变化，系统不易维护，如果能将数据库记录封装成pojo对象解析比较方便。\n<font color=\"red\">解决：Mybatis自动将sql执行结果映射至java对象，通过statement中的resultType定义输出结果的类型。</font>\n\n\n## 4、入门程序搭建\n\n需求:查询图书id查询图书信息\n\n创建数据库，新建book表：\n```sql\nCREATE TABLE `book` (\n  `book_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '图书ID',\n  `name` varchar(100) NOT NULL COMMENT '图书名称',\n  `number` int(11) NOT NULL COMMENT '馆藏数量',\n  PRIMARY KEY (`book_id`)\n) ENGINE=InnoDB AUTO_INCREMENT=1004 DEFAULT CHARSET=utf8 COMMENT='图书表'\n\nINSERT INTO `book` VALUES ('1000', 'Java程序设计', '10');\nINSERT INTO `book` VALUES ('1001', '数据结构', '10');\nINSERT INTO `book` VALUES ('1002', '设计模式', '10');\nINSERT INTO `book` VALUES ('1003', '编译原理', '10');\n```\n\n### 4.1、maven创建java工程\n省略\n\n### 4.2、引入依赖\n加入mybatis核心包、依赖包、数据驱动包。完整的pom配置如下：\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\n\t<groupId>com.topvision.maven</groupId>\n\t<artifactId>mybatis</artifactId>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<packaging>jar</packaging>\n\n\t<name>mybatis</name>\n\t<url>http://maven.apache.org</url>\n\n\t<properties>\n\t\t<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n\t\t<mybatis.version>3.4.5</mybatis.version>\n\t</properties>\n\n\t<dependencyManagement>\n\t\t<dependencies>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t\t<artifactId>mybatis</artifactId>\n\t\t\t\t<version>${mybatis.version}</version>\n\t\t\t</dependency>\n\t\t</dependencies>\n\t</dependencyManagement>\n\n\t<dependencies>\n\t\t<!-- mybatis -->\n\t\t<dependency>\n\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t<artifactId>mybatis</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t<artifactId>mybatis-spring</artifactId>\n\t\t\t<version>1.3.1</version>\n\t\t</dependency>\n\n\t\t<!-- mysql驱动 -->\n\t\t<dependency>\n\t\t\t<groupId>mysql</groupId>\n\t\t\t<artifactId>mysql-connector-java</artifactId>\n\t\t\t<version>5.1.6</version>\n\t\t\t<scope>runtime</scope>\n\t\t</dependency>\n\n\t\t<!-- c3p0 -->\n\t\t<dependency>\n\t\t\t<groupId>c3p0</groupId>\n\t\t\t<artifactId>c3p0</artifactId>\n\t\t\t<version>0.9.1.2</version>\n\t\t</dependency>\n\t\t<!-- slf4j -->\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-api</artifactId>\n\t\t\t<version>1.7.5</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-log4j12</artifactId>\n\t\t\t<version>1.7.12</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>log4j</groupId>\n\t\t\t<artifactId>log4j</artifactId>\n\t\t\t<version>1.2.17</version>\n\t\t</dependency>\n\t\t<!-- junit -->\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>4.9</version>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t</dependencies>\n\n\t<build>\n\t\t<plugins>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n\t\t\t\t<artifactId>maven-compiler-plugin</artifactId>\n\t\t\t\t<configuration>\n\t\t\t\t\t<source>1.8</source>\n\t\t\t\t\t<target>1.8</target>\n\t\t\t\t\t<encoding>UTF-8</encoding>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t</plugins>\n\n\t\t<finalName>mybatis</finalName>\n\t</build>\n</project>\n```\n\n### 4.3、log4j.properties\n\n在classpath下加入日志配置：\n```properties\n#定义LOG输出级别  \nlog4j.rootLogger=DEBUG,Console,File  \n#定义日志输出目的地为控制台  \nlog4j.appender.Console=org.apache.log4j.ConsoleAppender  \nlog4j.appender.Console.Target=System.out  \n#可以灵活地指定日志输出格式，下面一行是指定具体的格式  \nlog4j.appender.Console.layout = org.apache.log4j.PatternLayout  \nlog4j.appender.Console.layout.ConversionPattern=[%c] - %m%n  \n  \n#文件大小到达指定尺寸的时候产生一个新的文件  \nlog4j.appender.File = org.apache.log4j.RollingFileAppender  \n#指定输出目录  \nlog4j.appender.File.File = logs/ssm.log\n#定义文件最大大小  \nlog4j.appender.File.MaxFileSize = 10MB  \n#输出所有日志，如果换成DEBUG表示输出DEBUG以上级别日志  \nlog4j.appender.File.Threshold = ALL  \nlog4j.appender.File.layout = org.apache.log4j.PatternLayout  \nlog4j.appender.File.layout.ConversionPattern =[%p] [%d{yyyy-MM-dd HH\\:mm\\:ss}][%c]%m%n \n```\n\n### 4.4、jdbc.properties\n\n在classpath下新建数据库连接文件。\n\n```properties\njdbc.driverClass\t= com.mysql.jdbc.Driver\njdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb?characterEncoding=utf-8\njdbc.username\t\t= root\njdbc.password\t\t= 123\n```\n\n### 4.4、SqlMapConfig.xml\n\n在classpath下新建SqlMapConfig.xml文件，配置mybatis运行环境。\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE configuration\nPUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"\n\"http://mybatis.org/dtd/mybatis-3-config.dtd\">\n<configuration>\n\t<properties resource=\"jdbc.properties\"/>\n\t\n\t<!-- 和spring整合后 environments配置将废除 -->\n\t<environments default=\"development\">\n\t\t<environment id=\"development\">\n\t\t\t<!-- 使用jdbc事务管理 -->\n\t\t\t<transactionManager type=\"JDBC\" />\n\t\t\t<!-- 数据库连接池 -->\n\t\t\t<dataSource type=\"POOLED\">\n\t\t\t\t<property name=\"driver\" value=\"${jdbc.driverClass}\" />\n                <property name=\"url\" value=\"${jdbc.url}\" />\n\t\t\t\t<property name=\"username\" value=\"${jdbc.username}\" />\n                <property name=\"password\" value=\"${jdbc.password}\" />\n\t\t\t</dataSource>\n\t\t</environment>\n\t</environments>\n\t\n</configuration>\n```\nSqlMapConfig.xml是mybatis核心配置文件，上边文件的配置内容为数据源、事务管理。\n\n### 4.5、编写Po类\n\nPo类作为mybatis进行sql映射使用，po类通常与数据库表对应，Book.java如下:\n```java\npublic class Book {\n\n    private long bookId;// 图书ID\n    private String name;// 图书名称\n    private int number;// 馆藏数量\n    ...\n```\n\n### 4.6、编写映射文件（sql）\n在classpath下的sqlmap目录下创建sql映射文件Book.xml：\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE mapper\nPUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"\n\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n\n<mapper namespace=\"test\">\n\t<select id=\"queryById\" parameterType=\"long\" resultType=\"com.topvision.maven.mybatis.domain.Book\">\n\t\tselect book_id bookId,name,number from book where book_id = #{id}\n\t</select>\n</mapper>\n```\n\nnamespace ：命名空间，用于隔离sql语句，后面会讲另一层非常重要的作用。\nparameterType：定义输入到sql中的映射类型，#{id}表示使用preparedstatement设置占位符号并将输入变量id传到sql。\nresultType：定义结果映射类型。\n\n### 4.7、加载映射文件\n\n在SqlMapConfig.xml中加载映射文件Book.xml\n\n```xml\n<mappers>\n    <mapper resource=\"sqlmap/Book.xml\"/>\n</mappers>\n```\n\n### 4.8、测试\n\n```java\npublic class BookDaoTest {\n    private SqlSessionFactory sqlSessionFactory;\n    \n    @Before\n    public void createSqlSessionFactory() throws IOException{\n        String resource = \"sqlMapConfig.xml\";\n        InputStream inputStream = Resources.getResourceAsStream(resource);\n        \n        sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);\n    }\n\n    @Test\n    public void testQueryById() {\n        SqlSession sqlSession = null;\n        try {\n            sqlSession = sqlSessionFactory.openSession();\n            Book book = sqlSession.selectOne(\"test.queryById\",1000l);\n            System.out.println(book);\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            if (sqlSession != null) {\n                sqlSession.close();\n            }\n        }\n    }\n}\n```\n\n至此，若能查询出结果，则工程搭建成功。\n\n\n\n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/mybatis/framework.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/mybatis/jdbcProgram.png","slug":"Mybatis-1-——入门","published":1,"updated":"2018-02-27T07:38:38.086Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfsu0015hwvft7qmm20g","content":"<p>MyBatis 本是apache的一个开源项目iBatis, 2010年这个项目由apache software foundation 迁移到了google code，并且改名为MyBatis，实质上Mybatis对ibatis进行一些改进。<br>MyBatis是一个优秀的持久层框架，它对jdbc的操作数据库的过程进行封装，使开发者只需要关注 SQL 本身，而不需要花费精力去处理例如注册驱动、创建connection、创建statement、手动设置参数、结果集检索等jdbc繁杂的过程代码。<br>Mybatis通过xml或注解的方式将要执行的各种statement（statement、preparedStatemnt、CallableStatement）配置起来，并通过java对象和statement中的sql进行映射生成最终执行的sql语句，最后由mybatis框架执行sql并将结果映射成java对象并返回。<br><a id=\"more\"></a></p>\n<h2 id=\"1、资源下载\"><a href=\"#1、资源下载\" class=\"headerlink\" title=\"1、资源下载\"></a>1、资源下载</h2><p>mybaits的代码由github.com管理，地址：<a href=\"https://github.com/mybatis/mybatis-3/releases\" target=\"_blank\" rel=\"noopener\">https://github.com/mybatis/mybatis-3/releases</a><br>要使用 MyBatis， 只需将 mybatis-x.x.x.jar 文件置于 classpath 中即可。</p>\n<p>如果使用 Maven 来构建项目，则需将下面的 dependency 代码置于 pom.xml 文件中：<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>x.x.x<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<h2 id=\"2、架构\"><a href=\"#2、架构\" class=\"headerlink\" title=\"2、架构\"></a>2、架构</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/mybatis/framework.png\" alt=\"mybatis原理图\"></p>\n<ol>\n<li>SqlMapConfig.xml<br>mybatis的全局配置文件，配置了运行环境等信息。mapper.xml即映射文件，里面配置了操作数据库的sql语句，该类文件需要在SqlMapConfig.xml中加载。</li>\n<li>SqlSessionFactory<br>通过mybatis环境等配置信息构造SqlSessionFactory即会话工厂</li>\n<li>SqlSession<br>由会话工厂创建sqlSession即会话，操作数据库需要通过sqlSession进行</li>\n<li>Executor<br>mybatis底层自定义了Executor执行器接口操作数据库，Executor接口有两个实现，一个是基本执行器、一个是缓存执行器。</li>\n<li>Mapper Statement<br>mybatis底层封装对象，它包装了mybatis配置信息及sql映射信息等。mapper.xml文件中一个sql对应一个Mapped Statement对象，sql的id即是Mapped statement的id。<br>Mapped Statement对sql执行输入参数进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql前将输入的java对象映射至sql中，输入参数映射就是jdbc编程中对preparedStatement设置参数。<br>Mapped Statement对sql执行输出结果进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql后将输出结果映射至java对象中，输出结果映射过程相当于jdbc编程中对结果的解析处理过程。</li>\n</ol>\n<h2 id=\"3、特点\"><a href=\"#3、特点\" class=\"headerlink\" title=\"3、特点\"></a>3、特点</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/mybatis/jdbcProgram.png\" alt=\"此处输入图片的描述\"></p>\n<p>上边使用jdbc的原始方法（未经封装）实现了查询数据库表记录的操作。</p>\n<p><strong>JDBC编程问题总结：</strong><br>1、    数据库链接创建、释放频繁造成系统资源浪费从而影响系统性能，如果使用数据库链接池可解决此问题。</p>\n<font color=\"red\">解决：在SqlMapConfig.xml中配置数据链接池，使用连接池管理数据库链接</font><br>2、    Sql语句在代码中硬编码，造成代码不易维护，实际应用sql变化的可能较大，sql变动需要改变java代码。<br><font color=\"red\">解决：将Sql语句配置在XXXXmapper.xml文件中与java代码分离。</font><br>3、    使用preparedStatement向占有位符号传参数存在硬编码，因为sql语句的where条件不一定，可能多也可能少，修改sql还要修改代码，系统不易维护。<br><font color=\"red\">解决：Mybatis自动将java对象映射至sql语句，通过statement中的parameterType定义输入参数的类型。</font><br>4、    对结果集解析存在硬编码（查询列名），sql变化导致解析代码变化，系统不易维护，如果能将数据库记录封装成pojo对象解析比较方便。<br><font color=\"red\">解决：Mybatis自动将sql执行结果映射至java对象，通过statement中的resultType定义输出结果的类型。</font>\n\n\n<h2 id=\"4、入门程序搭建\"><a href=\"#4、入门程序搭建\" class=\"headerlink\" title=\"4、入门程序搭建\"></a>4、入门程序搭建</h2><p>需求:查询图书id查询图书信息</p>\n<p>创建数据库，新建book表：<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"string\">`book`</span> (</div><div class=\"line\">  <span class=\"string\">`book_id`</span> <span class=\"built_in\">bigint</span>(<span class=\"number\">20</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> AUTO_INCREMENT <span class=\"keyword\">COMMENT</span> <span class=\"string\">'图书ID'</span>,</div><div class=\"line\">  <span class=\"string\">`name`</span> <span class=\"built_in\">varchar</span>(<span class=\"number\">100</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> <span class=\"keyword\">COMMENT</span> <span class=\"string\">'图书名称'</span>,</div><div class=\"line\">  <span class=\"string\">`number`</span> <span class=\"built_in\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> <span class=\"keyword\">COMMENT</span> <span class=\"string\">'馆藏数量'</span>,</div><div class=\"line\">  PRIMARY <span class=\"keyword\">KEY</span> (<span class=\"string\">`book_id`</span>)</div><div class=\"line\">) <span class=\"keyword\">ENGINE</span>=<span class=\"keyword\">InnoDB</span> AUTO_INCREMENT=<span class=\"number\">1004</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">CHARSET</span>=utf8 <span class=\"keyword\">COMMENT</span>=<span class=\"string\">'图书表'</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`book`</span> <span class=\"keyword\">VALUES</span> (<span class=\"string\">'1000'</span>, <span class=\"string\">'Java程序设计'</span>, <span class=\"string\">'10'</span>);</div><div class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`book`</span> <span class=\"keyword\">VALUES</span> (<span class=\"string\">'1001'</span>, <span class=\"string\">'数据结构'</span>, <span class=\"string\">'10'</span>);</div><div class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`book`</span> <span class=\"keyword\">VALUES</span> (<span class=\"string\">'1002'</span>, <span class=\"string\">'设计模式'</span>, <span class=\"string\">'10'</span>);</div><div class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`book`</span> <span class=\"keyword\">VALUES</span> (<span class=\"string\">'1003'</span>, <span class=\"string\">'编译原理'</span>, <span class=\"string\">'10'</span>);</div></pre></td></tr></table></figure></p>\n<h3 id=\"4-1、maven创建java工程\"><a href=\"#4-1、maven创建java工程\" class=\"headerlink\" title=\"4.1、maven创建java工程\"></a>4.1、maven创建java工程</h3><p>省略</p>\n<h3 id=\"4-2、引入依赖\"><a href=\"#4-2、引入依赖\" class=\"headerlink\" title=\"4.2、引入依赖\"></a>4.2、引入依赖</h3><p>加入mybatis核心包、依赖包、数据驱动包。完整的pom配置如下：<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.topvision.maven<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.apache.org<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">mybatis.version</span>&gt;</span>3.4.5<span class=\"tag\">&lt;/<span class=\"name\">mybatis.version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mybatis --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-spring<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mysql驱动 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- c3p0 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- slf4j --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-log4j12<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.17<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- junit --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.9<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">encoding</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<h3 id=\"4-3、log4j-properties\"><a href=\"#4-3、log4j-properties\" class=\"headerlink\" title=\"4.3、log4j.properties\"></a>4.3、log4j.properties</h3><p>在classpath下加入日志配置：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\">#定义LOG输出级别  </div><div class=\"line\">log4j.rootLogger=DEBUG,Console,File  </div><div class=\"line\">#定义日志输出目的地为控制台  </div><div class=\"line\">log4j.appender.Console=org.apache.log4j.ConsoleAppender  </div><div class=\"line\">log4j.appender.Console.Target=System.out  </div><div class=\"line\">#可以灵活地指定日志输出格式，下面一行是指定具体的格式  </div><div class=\"line\">log4j.appender.Console.layout = org.apache.log4j.PatternLayout  </div><div class=\"line\">log4j.appender.Console.layout.ConversionPattern=[%c] - %m%n  </div><div class=\"line\">  </div><div class=\"line\">#文件大小到达指定尺寸的时候产生一个新的文件  </div><div class=\"line\">log4j.appender.File = org.apache.log4j.RollingFileAppender  </div><div class=\"line\">#指定输出目录  </div><div class=\"line\">log4j.appender.File.File = logs/ssm.log</div><div class=\"line\">#定义文件最大大小  </div><div class=\"line\">log4j.appender.File.MaxFileSize = 10MB  </div><div class=\"line\">#输出所有日志，如果换成DEBUG表示输出DEBUG以上级别日志  </div><div class=\"line\">log4j.appender.File.Threshold = ALL  </div><div class=\"line\">log4j.appender.File.layout = org.apache.log4j.PatternLayout  </div><div class=\"line\">log4j.appender.File.layout.ConversionPattern =[%p] [%d&#123;yyyy-MM-dd HH\\:mm\\:ss&#125;][%c]%m%n</div></pre></td></tr></table></figure></p>\n<h3 id=\"4-4、jdbc-properties\"><a href=\"#4-4、jdbc-properties\" class=\"headerlink\" title=\"4.4、jdbc.properties\"></a>4.4、jdbc.properties</h3><p>在classpath下新建数据库连接文件。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">jdbc.driverClass\t= com.mysql.jdbc.Driver</div><div class=\"line\">jdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb?characterEncoding=utf-8</div><div class=\"line\">jdbc.username\t\t= root</div><div class=\"line\">jdbc.password\t\t= 123</div></pre></td></tr></table></figure>\n<h3 id=\"4-4、SqlMapConfig-xml\"><a href=\"#4-4、SqlMapConfig-xml\" class=\"headerlink\" title=\"4.4、SqlMapConfig.xml\"></a>4.4、SqlMapConfig.xml</h3><p>在classpath下新建SqlMapConfig.xml文件，配置mybatis运行环境。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE configuration</span></div><div class=\"line\">PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"</div><div class=\"line\">\"http://mybatis.org/dtd/mybatis-3-config.dtd\"&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">properties</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"jdbc.properties\"</span>/&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 和spring整合后 environments配置将废除 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">environments</span> <span class=\"attr\">default</span>=<span class=\"string\">\"development\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">environment</span> <span class=\"attr\">id</span>=<span class=\"string\">\"development\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 使用jdbc事务管理 --&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">transactionManager</span> <span class=\"attr\">type</span>=<span class=\"string\">\"JDBC\"</span> /&gt;</span></div><div class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 数据库连接池 --&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dataSource</span> <span class=\"attr\">type</span>=<span class=\"string\">\"POOLED\"</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.driverClass&#125;\"</span> /&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.url&#125;\"</span> /&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.username&#125;\"</span> /&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.password&#125;\"</span> /&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dataSource</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">environment</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">environments</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>SqlMapConfig.xml是mybatis核心配置文件，上边文件的配置内容为数据源、事务管理。</p>\n<h3 id=\"4-5、编写Po类\"><a href=\"#4-5、编写Po类\" class=\"headerlink\" title=\"4.5、编写Po类\"></a>4.5、编写Po类</h3><p>Po类作为mybatis进行sql映射使用，po类通常与数据库表对应，Book.java如下:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Book</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> bookId;<span class=\"comment\">// 图书ID</span></div><div class=\"line\">    <span class=\"keyword\">private</span> String name;<span class=\"comment\">// 图书名称</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> number;<span class=\"comment\">// 馆藏数量</span></div><div class=\"line\">    ...</div></pre></td></tr></table></figure></p>\n<h3 id=\"4-6、编写映射文件（sql）\"><a href=\"#4-6、编写映射文件（sql）\" class=\"headerlink\" title=\"4.6、编写映射文件（sql）\"></a>4.6、编写映射文件（sql）</h3><p>在classpath下的sqlmap目录下创建sql映射文件Book.xml：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE mapper</span></div><div class=\"line\">PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"</div><div class=\"line\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"test\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"queryById\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"long\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"com.topvision.maven.mybatis.domain.Book\"</span>&gt;</span></div><div class=\"line\">\t\tselect book_id bookId,name,number from book where book_id = #&#123;id&#125;</div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>namespace ：命名空间，用于隔离sql语句，后面会讲另一层非常重要的作用。<br>parameterType：定义输入到sql中的映射类型，#{id}表示使用preparedstatement设置占位符号并将输入变量id传到sql。<br>resultType：定义结果映射类型。</p>\n<h3 id=\"4-7、加载映射文件\"><a href=\"#4-7、加载映射文件\" class=\"headerlink\" title=\"4.7、加载映射文件\"></a>4.7、加载映射文件</h3><p>在SqlMapConfig.xml中加载映射文件Book.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mappers</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"sqlmap/Book.xml\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mappers</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"4-8、测试\"><a href=\"#4-8、测试\" class=\"headerlink\" title=\"4.8、测试\"></a>4.8、测试</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BookDaoTest</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> SqlSessionFactory sqlSessionFactory;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"meta\">@Before</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createSqlSessionFactory</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException</span>&#123;</div><div class=\"line\">        String resource = <span class=\"string\">\"sqlMapConfig.xml\"</span>;</div><div class=\"line\">        InputStream inputStream = Resources.getResourceAsStream(resource);</div><div class=\"line\">        </div><div class=\"line\">        sqlSessionFactory = <span class=\"keyword\">new</span> SqlSessionFactoryBuilder().build(inputStream);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testQueryById</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        SqlSession sqlSession = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            sqlSession = sqlSessionFactory.openSession();</div><div class=\"line\">            Book book = sqlSession.selectOne(<span class=\"string\">\"test.queryById\"</span>,<span class=\"number\">1000l</span>);</div><div class=\"line\">            System.out.println(book);</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">if</span> (sqlSession != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">                sqlSession.close();</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>至此，若能查询出结果，则工程搭建成功。</p>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>MyBatis 本是apache的一个开源项目iBatis, 2010年这个项目由apache software foundation 迁移到了google code，并且改名为MyBatis，实质上Mybatis对ibatis进行一些改进。<br>MyBatis是一个优秀的持久层框架，它对jdbc的操作数据库的过程进行封装，使开发者只需要关注 SQL 本身，而不需要花费精力去处理例如注册驱动、创建connection、创建statement、手动设置参数、结果集检索等jdbc繁杂的过程代码。<br>Mybatis通过xml或注解的方式将要执行的各种statement（statement、preparedStatemnt、CallableStatement）配置起来，并通过java对象和statement中的sql进行映射生成最终执行的sql语句，最后由mybatis框架执行sql并将结果映射成java对象并返回。<br>","more":"</p>\n<h2 id=\"1、资源下载\"><a href=\"#1、资源下载\" class=\"headerlink\" title=\"1、资源下载\"></a>1、资源下载</h2><p>mybaits的代码由github.com管理，地址：<a href=\"https://github.com/mybatis/mybatis-3/releases\" target=\"_blank\" rel=\"noopener\">https://github.com/mybatis/mybatis-3/releases</a><br>要使用 MyBatis， 只需将 mybatis-x.x.x.jar 文件置于 classpath 中即可。</p>\n<p>如果使用 Maven 来构建项目，则需将下面的 dependency 代码置于 pom.xml 文件中：<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>x.x.x<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<h2 id=\"2、架构\"><a href=\"#2、架构\" class=\"headerlink\" title=\"2、架构\"></a>2、架构</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/mybatis/framework.png\" alt=\"mybatis原理图\"></p>\n<ol>\n<li>SqlMapConfig.xml<br>mybatis的全局配置文件，配置了运行环境等信息。mapper.xml即映射文件，里面配置了操作数据库的sql语句，该类文件需要在SqlMapConfig.xml中加载。</li>\n<li>SqlSessionFactory<br>通过mybatis环境等配置信息构造SqlSessionFactory即会话工厂</li>\n<li>SqlSession<br>由会话工厂创建sqlSession即会话，操作数据库需要通过sqlSession进行</li>\n<li>Executor<br>mybatis底层自定义了Executor执行器接口操作数据库，Executor接口有两个实现，一个是基本执行器、一个是缓存执行器。</li>\n<li>Mapper Statement<br>mybatis底层封装对象，它包装了mybatis配置信息及sql映射信息等。mapper.xml文件中一个sql对应一个Mapped Statement对象，sql的id即是Mapped statement的id。<br>Mapped Statement对sql执行输入参数进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql前将输入的java对象映射至sql中，输入参数映射就是jdbc编程中对preparedStatement设置参数。<br>Mapped Statement对sql执行输出结果进行定义，包括HashMap、基本类型、pojo，Executor通过Mapped Statement在执行sql后将输出结果映射至java对象中，输出结果映射过程相当于jdbc编程中对结果的解析处理过程。</li>\n</ol>\n<h2 id=\"3、特点\"><a href=\"#3、特点\" class=\"headerlink\" title=\"3、特点\"></a>3、特点</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/mybatis/jdbcProgram.png\" alt=\"此处输入图片的描述\"></p>\n<p>上边使用jdbc的原始方法（未经封装）实现了查询数据库表记录的操作。</p>\n<p><strong>JDBC编程问题总结：</strong><br>1、    数据库链接创建、释放频繁造成系统资源浪费从而影响系统性能，如果使用数据库链接池可解决此问题。</p>\n<font color=\"red\">解决：在SqlMapConfig.xml中配置数据链接池，使用连接池管理数据库链接</font><br>2、    Sql语句在代码中硬编码，造成代码不易维护，实际应用sql变化的可能较大，sql变动需要改变java代码。<br><font color=\"red\">解决：将Sql语句配置在XXXXmapper.xml文件中与java代码分离。</font><br>3、    使用preparedStatement向占有位符号传参数存在硬编码，因为sql语句的where条件不一定，可能多也可能少，修改sql还要修改代码，系统不易维护。<br><font color=\"red\">解决：Mybatis自动将java对象映射至sql语句，通过statement中的parameterType定义输入参数的类型。</font><br>4、    对结果集解析存在硬编码（查询列名），sql变化导致解析代码变化，系统不易维护，如果能将数据库记录封装成pojo对象解析比较方便。<br><font color=\"red\">解决：Mybatis自动将sql执行结果映射至java对象，通过statement中的resultType定义输出结果的类型。</font>\n\n\n<h2 id=\"4、入门程序搭建\"><a href=\"#4、入门程序搭建\" class=\"headerlink\" title=\"4、入门程序搭建\"></a>4、入门程序搭建</h2><p>需求:查询图书id查询图书信息</p>\n<p>创建数据库，新建book表：<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"string\">`book`</span> (</div><div class=\"line\">  <span class=\"string\">`book_id`</span> <span class=\"built_in\">bigint</span>(<span class=\"number\">20</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> AUTO_INCREMENT <span class=\"keyword\">COMMENT</span> <span class=\"string\">'图书ID'</span>,</div><div class=\"line\">  <span class=\"string\">`name`</span> <span class=\"built_in\">varchar</span>(<span class=\"number\">100</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> <span class=\"keyword\">COMMENT</span> <span class=\"string\">'图书名称'</span>,</div><div class=\"line\">  <span class=\"string\">`number`</span> <span class=\"built_in\">int</span>(<span class=\"number\">11</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> <span class=\"keyword\">COMMENT</span> <span class=\"string\">'馆藏数量'</span>,</div><div class=\"line\">  PRIMARY <span class=\"keyword\">KEY</span> (<span class=\"string\">`book_id`</span>)</div><div class=\"line\">) <span class=\"keyword\">ENGINE</span>=<span class=\"keyword\">InnoDB</span> AUTO_INCREMENT=<span class=\"number\">1004</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">CHARSET</span>=utf8 <span class=\"keyword\">COMMENT</span>=<span class=\"string\">'图书表'</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`book`</span> <span class=\"keyword\">VALUES</span> (<span class=\"string\">'1000'</span>, <span class=\"string\">'Java程序设计'</span>, <span class=\"string\">'10'</span>);</div><div class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`book`</span> <span class=\"keyword\">VALUES</span> (<span class=\"string\">'1001'</span>, <span class=\"string\">'数据结构'</span>, <span class=\"string\">'10'</span>);</div><div class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`book`</span> <span class=\"keyword\">VALUES</span> (<span class=\"string\">'1002'</span>, <span class=\"string\">'设计模式'</span>, <span class=\"string\">'10'</span>);</div><div class=\"line\"><span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> <span class=\"string\">`book`</span> <span class=\"keyword\">VALUES</span> (<span class=\"string\">'1003'</span>, <span class=\"string\">'编译原理'</span>, <span class=\"string\">'10'</span>);</div></pre></td></tr></table></figure></p>\n<h3 id=\"4-1、maven创建java工程\"><a href=\"#4-1、maven创建java工程\" class=\"headerlink\" title=\"4.1、maven创建java工程\"></a>4.1、maven创建java工程</h3><p>省略</p>\n<h3 id=\"4-2、引入依赖\"><a href=\"#4-2、引入依赖\" class=\"headerlink\" title=\"4.2、引入依赖\"></a>4.2、引入依赖</h3><p>加入mybatis核心包、依赖包、数据驱动包。完整的pom配置如下：<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.topvision.maven<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.apache.org<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">mybatis.version</span>&gt;</span>3.4.5<span class=\"tag\">&lt;/<span class=\"name\">mybatis.version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mybatis --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-spring<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mysql驱动 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- c3p0 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- slf4j --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-log4j12<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.17<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- junit --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.9<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">encoding</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<h3 id=\"4-3、log4j-properties\"><a href=\"#4-3、log4j-properties\" class=\"headerlink\" title=\"4.3、log4j.properties\"></a>4.3、log4j.properties</h3><p>在classpath下加入日志配置：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\">#定义LOG输出级别  </div><div class=\"line\">log4j.rootLogger=DEBUG,Console,File  </div><div class=\"line\">#定义日志输出目的地为控制台  </div><div class=\"line\">log4j.appender.Console=org.apache.log4j.ConsoleAppender  </div><div class=\"line\">log4j.appender.Console.Target=System.out  </div><div class=\"line\">#可以灵活地指定日志输出格式，下面一行是指定具体的格式  </div><div class=\"line\">log4j.appender.Console.layout = org.apache.log4j.PatternLayout  </div><div class=\"line\">log4j.appender.Console.layout.ConversionPattern=[%c] - %m%n  </div><div class=\"line\">  </div><div class=\"line\">#文件大小到达指定尺寸的时候产生一个新的文件  </div><div class=\"line\">log4j.appender.File = org.apache.log4j.RollingFileAppender  </div><div class=\"line\">#指定输出目录  </div><div class=\"line\">log4j.appender.File.File = logs/ssm.log</div><div class=\"line\">#定义文件最大大小  </div><div class=\"line\">log4j.appender.File.MaxFileSize = 10MB  </div><div class=\"line\">#输出所有日志，如果换成DEBUG表示输出DEBUG以上级别日志  </div><div class=\"line\">log4j.appender.File.Threshold = ALL  </div><div class=\"line\">log4j.appender.File.layout = org.apache.log4j.PatternLayout  </div><div class=\"line\">log4j.appender.File.layout.ConversionPattern =[%p] [%d&#123;yyyy-MM-dd HH\\:mm\\:ss&#125;][%c]%m%n</div></pre></td></tr></table></figure></p>\n<h3 id=\"4-4、jdbc-properties\"><a href=\"#4-4、jdbc-properties\" class=\"headerlink\" title=\"4.4、jdbc.properties\"></a>4.4、jdbc.properties</h3><p>在classpath下新建数据库连接文件。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">jdbc.driverClass\t= com.mysql.jdbc.Driver</div><div class=\"line\">jdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb?characterEncoding=utf-8</div><div class=\"line\">jdbc.username\t\t= root</div><div class=\"line\">jdbc.password\t\t= 123</div></pre></td></tr></table></figure>\n<h3 id=\"4-4、SqlMapConfig-xml\"><a href=\"#4-4、SqlMapConfig-xml\" class=\"headerlink\" title=\"4.4、SqlMapConfig.xml\"></a>4.4、SqlMapConfig.xml</h3><p>在classpath下新建SqlMapConfig.xml文件，配置mybatis运行环境。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE configuration</span></div><div class=\"line\">PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"</div><div class=\"line\">\"http://mybatis.org/dtd/mybatis-3-config.dtd\"&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">properties</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"jdbc.properties\"</span>/&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 和spring整合后 environments配置将废除 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">environments</span> <span class=\"attr\">default</span>=<span class=\"string\">\"development\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">environment</span> <span class=\"attr\">id</span>=<span class=\"string\">\"development\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 使用jdbc事务管理 --&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">transactionManager</span> <span class=\"attr\">type</span>=<span class=\"string\">\"JDBC\"</span> /&gt;</span></div><div class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 数据库连接池 --&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dataSource</span> <span class=\"attr\">type</span>=<span class=\"string\">\"POOLED\"</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driver\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.driverClass&#125;\"</span> /&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.url&#125;\"</span> /&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.username&#125;\"</span> /&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc.password&#125;\"</span> /&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dataSource</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">environment</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">environments</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>SqlMapConfig.xml是mybatis核心配置文件，上边文件的配置内容为数据源、事务管理。</p>\n<h3 id=\"4-5、编写Po类\"><a href=\"#4-5、编写Po类\" class=\"headerlink\" title=\"4.5、编写Po类\"></a>4.5、编写Po类</h3><p>Po类作为mybatis进行sql映射使用，po类通常与数据库表对应，Book.java如下:<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Book</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">long</span> bookId;<span class=\"comment\">// 图书ID</span></div><div class=\"line\">    <span class=\"keyword\">private</span> String name;<span class=\"comment\">// 图书名称</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> number;<span class=\"comment\">// 馆藏数量</span></div><div class=\"line\">    ...</div></pre></td></tr></table></figure></p>\n<h3 id=\"4-6、编写映射文件（sql）\"><a href=\"#4-6、编写映射文件（sql）\" class=\"headerlink\" title=\"4.6、编写映射文件（sql）\"></a>4.6、编写映射文件（sql）</h3><p>在classpath下的sqlmap目录下创建sql映射文件Book.xml：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE mapper</span></div><div class=\"line\">PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\"</div><div class=\"line\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"test\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"queryById\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"long\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"com.topvision.maven.mybatis.domain.Book\"</span>&gt;</span></div><div class=\"line\">\t\tselect book_id bookId,name,number from book where book_id = #&#123;id&#125;</div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>namespace ：命名空间，用于隔离sql语句，后面会讲另一层非常重要的作用。<br>parameterType：定义输入到sql中的映射类型，#{id}表示使用preparedstatement设置占位符号并将输入变量id传到sql。<br>resultType：定义结果映射类型。</p>\n<h3 id=\"4-7、加载映射文件\"><a href=\"#4-7、加载映射文件\" class=\"headerlink\" title=\"4.7、加载映射文件\"></a>4.7、加载映射文件</h3><p>在SqlMapConfig.xml中加载映射文件Book.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mappers</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">resource</span>=<span class=\"string\">\"sqlmap/Book.xml\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mappers</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"4-8、测试\"><a href=\"#4-8、测试\" class=\"headerlink\" title=\"4.8、测试\"></a>4.8、测试</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BookDaoTest</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> SqlSessionFactory sqlSessionFactory;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"meta\">@Before</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">createSqlSessionFactory</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException</span>&#123;</div><div class=\"line\">        String resource = <span class=\"string\">\"sqlMapConfig.xml\"</span>;</div><div class=\"line\">        InputStream inputStream = Resources.getResourceAsStream(resource);</div><div class=\"line\">        </div><div class=\"line\">        sqlSessionFactory = <span class=\"keyword\">new</span> SqlSessionFactoryBuilder().build(inputStream);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Test</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testQueryById</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        SqlSession sqlSession = <span class=\"keyword\">null</span>;</div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            sqlSession = sqlSessionFactory.openSession();</div><div class=\"line\">            Book book = sqlSession.selectOne(<span class=\"string\">\"test.queryById\"</span>,<span class=\"number\">1000l</span>);</div><div class=\"line\">            System.out.println(book);</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">if</span> (sqlSession != <span class=\"keyword\">null</span>) &#123;</div><div class=\"line\">                sqlSession.close();</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>至此，若能查询出结果，则工程搭建成功。</p>"},{"title":"Mybatis(5)——与spring整合","date":"2018-02-27T08:26:53.000Z","_content":"\n整合spring\n<!-- more -->\n## 1、jar包\nspring相关、mybatis、mybatis-srping整合包、数据库、数据库驱动、日志等\n\n```xml\n<dependencies>\n\t<!-- Spring -->\n\t<dependency>\n\t\t<groupId>org.springframework</groupId>\n\t\t<artifactId>spring-test</artifactId>\n\t</dependency>\n\t<dependency>\n\t\t<groupId>org.springframework</groupId>\n\t\t<artifactId>spring-context</artifactId>\n\t</dependency>\n\t<dependency>\n\t\t<groupId>org.springframework</groupId>\n\t\t<artifactId>spring-aspects</artifactId>\n\t</dependency>\n\t<dependency>\n\t\t<groupId>org.springframework</groupId>\n\t\t<artifactId>spring-orm</artifactId>\n\t</dependency>\n\t<dependency>\n\t\t<groupId>org.springframework</groupId>\n\t\t<artifactId>spring-web</artifactId>\n\t</dependency>\n\t<dependency>\n\t\t<groupId>org.springframework</groupId>\n\t\t<artifactId>spring-webmvc</artifactId>\n\t</dependency>\n\t<!-- mybatis -->\n\t<dependency>\n\t\t<groupId>org.mybatis</groupId>\n\t\t<artifactId>mybatis</artifactId>\n\t</dependency>\n\t<dependency>\n\t\t<groupId>org.mybatis</groupId>\n\t\t<artifactId>mybatis-spring</artifactId>\n\t\t<version>1.3.1</version>\n\t</dependency>\n\n\t<!-- mysql驱动 -->\n\t<dependency>\n\t\t<groupId>mysql</groupId>\n\t\t<artifactId>mysql-connector-java</artifactId>\n\t\t<version>5.1.6</version>\n\t\t<scope>runtime</scope>\n\t</dependency>\n\n\t<!-- c3p0 -->\n\t<dependency>\n\t\t<groupId>c3p0</groupId>\n\t\t<artifactId>c3p0</artifactId>\n\t\t<version>0.9.1.2</version>\n\t</dependency>\n\t<!-- slf4j -->\n\t<dependency>\n\t\t<groupId>org.slf4j</groupId>\n\t\t<artifactId>slf4j-log4j12</artifactId>\n\t\t<version>1.7.2</version>\n\t</dependency>\n\t<!-- junit -->\n\t<dependency>\n\t\t<groupId>junit</groupId>\n\t\t<artifactId>junit</artifactId>\n\t\t<version>4.12</version>\n\t\t<scope>test</scope>\n\t</dependency>\n\t<dependency>\n        <groupId>org.hamcrest</groupId>\n        <artifactId>hamcrest-library</artifactId>\n        <version>1.3</version>\n    </dependency>\n\t<!-- jstl -->\n\t<dependency>\n\t\t<groupId>javax.servlet</groupId>\n\t\t<artifactId>jstl</artifactId>\n\t\t<version>1.2</version>\n\t</dependency>\n\n\t<!-- servlet jsp -->\n\t<dependency>\n\t\t<groupId>javax.servlet</groupId>\n\t\t<artifactId>servlet-api</artifactId>\n\t\t<version>2.5</version>\n\t\t<scope>provided</scope>\n\t</dependency>\n\t<dependency>\n\t\t<groupId>javax.servlet</groupId>\n\t\t<artifactId>jsp-api</artifactId>\n\t\t<version>2.0</version>\n\t\t<scope>provided</scope>\n\t</dependency>\n</dependencies>\n```\n\n## 2、spring配置文件\n\n在classpath下创建applicationContext.xml，定义数据库链接池、SqlSessionFactory。\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:aop=\"http://www.springframework.org/schema/aop\"\n\txmlns:context=\"http://www.springframework.org/schema/context\"\n\txmlns:mvc=\"http://www.springframework.org/schema/mvc\" xmlns:tx=\"http://www.springframework.org/schema/tx\"\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd  \n        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.3.xsd  \n        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd  \n        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd  \n        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.3.xsd\">\n\t\n\t<!-- 开启注解、自动扫描 -->\n\t<context:annotation-config/>\n\t<context:component-scan base-package=\"com.topvision.ssm\"/>\n\n\t<!-- 1、加载properties -->\n\t<!-- <context:property-placeholder location=\"classpath:jdbc.properties\"/> -->\n\t<bean id=\"propertyConfigurer\" class=\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\">\n\t\t<property name=\"locations\">\n\t\t\t<list>\n\t\t\t\t<value>classpath:jdbc.properties</value>\n\t\t\t</list>\n\t\t</property>\n\t</bean>\n\n\t<!--2、 数据库C3P0 -->\n\t<bean id=\"dataSource\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\">\n\t\t<property name=\"driverClass\" value=\"${s2sm.jdbc.driverClass}\"/>\n\t\t<property name=\"jdbcUrl\" value=\"${s2sm.jdbc.url}\"/>\n\t\t<property name=\"user\" value=\"${s2sm.jdbc.username}\"/>\n\t\t<property name=\"password\" value=\"${s2sm.jdbc.password}\"/>\n\t\t\n        <property name=\"initialPoolSize\" value=\"${s2sm.cpool.initialPoolSize}\" />\n        <property name=\"minPoolSize\" value=\"${s2sm.cpool.minPoolSize}\" />\n        <property name=\"maxPoolSize\" value=\"${s2sm.cpool.maxPoolSize}\" />\n        <property name=\"acquireIncrement\" value=\"${s2sm.cpool.acquireIncrement}\" />\n        <property name=\"maxIdleTime\" value=\"${s2sm.cpool.maxIdleTime}\"/>\n        <property name=\"acquireRetryAttempts\" value=\"${s2sm.cpool.acquireRetryAttempts}\"/>\n        <property name=\"acquireRetryDelay\" value=\"${s2sm.cpool.acquireRetryDelay}\"/>\n\t</bean>\n\t\n\t <!-- 3.配置SqlSessionFactory对象 -->\n\t<bean id=\"sqlSessionFactory\" class=\"org.mybatis.spring.SqlSessionFactoryBean\">\n\t\t<!-- 注入数据库连接池 -->\n\t\t<property name=\"dataSource\" ref=\"dataSource\" />\n\t\t<!-- 配置MyBaties全局配置文件:mybatis-config.xml -->\n\t\t<property name=\"configLocation\" value=\"classpath:sqlMapConfig.xml\" />\n\t\t<!-- 扫描entity包 使用别名 -->\n\t\t<property name=\"typeAliasesPackage\" value=\"com.topvision.ssm.domain\" />\n\t\t<!-- 扫描sql配置文件:mapper需要的xml文件 -->\n\t\t<!-- <property name=\"mapperLocations\" value=\"classpath:mapper/*.xml\" /> -->\n\t\t<property name=\"mapperLocations\" value=\"classpath*:com/topvision/ssm/dao/mapper/*.xml\" />\n\t</bean>\n\n\t<!-- 4.配置扫描Dao接口包，动态实现Dao接口，注入到spring容器中 -->\n\t<bean class=\"org.mybatis.spring.mapper.MapperScannerConfigurer\">\n        <!-- 注入sqlSessionFactory -->\n\t\t<property name=\"sqlSessionFactoryBeanName\" value=\"sqlSessionFactory\" />\n\t\t<!-- 给出需要扫描Dao接口包 -->\n       \t<property name=\"basePackage\" value=\"com.topvision.ssm.dao\" />\n\t</bean>\n\t\n\t<!-- 5、事务,开启注解事务 -->\n\t<tx:annotation-driven transaction-manager=\"transactionManager\"/>\n\t<!-- 事务管理器 -->\n\t<bean id=\"transactionManager\" class=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\">\n\t\t<property name=\"dataSource\" ref=\"dataSource\"></property>\n\t</bean>\t\n\t\n</beans> \n```\n\n## 3、mybatis配置文件\n\n在classpath下新建sqlMapConfig.xml。\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE configuration\n  PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"\n  \"http://mybatis.org/dtd/mybatis-3-config.dtd\">\n<configuration>\n\t<!--此处暂时不需要任何配置，基本配置已在applicationContext.xml的第三步中配置-->\n</configuration>\n```\n\n## 4、jdbc.properties和log4j.properties\n\n在classpath下新建这两个文件，注意参数。例如下方：\n\n```xml\ns2sm.jdbc.driverClass\t= com.mysql.jdbc.Driver\ns2sm.jdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb\ns2sm.jdbc.username\t\t= root\ns2sm.jdbc.password\t\t= 123\n\ns2sm.cpool.maxIdleTimeExcessConnections = 1800\n\n\n##最常用配置\ns2sm.cpool.initialPoolSize       = 50\n#连接池初始化时创建的连接数,default : 3，取值应在minPoolSize与maxPoolSize之间\ns2sm.cpool.minPoolSize           = 10\n#连接池保持的最小连接数,default : 3\ns2sm.cpool.maxPoolSize           = 100\n#连接池中拥有的最大连接数，如果获得新连接时会使连接总数超过这个值则不会再获取新连接，而是等待其他连接释放，所以这个值有可能会设计地很大,default : 15\ns2sm.cpool.acquireIncrement      = 5\n#连接池在无空闲连接可用时一次性创建的新数据库连接数,default : 3\n\n\n\n##管理连接池的大小和连接的生存时间\n\ns2sm.cpool.maxIdleTime           = 3600\n#连接的最大空闲时间，如果超过这个时间，某个数据库连接还没有被使用，则会断开掉这个连接。如果为0，则永远不会断开连接,即回收此连接。default : 0 单位 s。建议使用\n\ns2sm.cpool.maxIdleTimeExcessConnections = 1800\n#这个配置主要是为了快速减轻连接池的负载，比如连接池中连接数因为某次数据访问高峰导致创建了很多数据连接，但是后面的时间段需要的数据库连接数很少，需要快速释放，\n#必须小于maxIdleTime。其实这个没必要配置，maxIdleTime已经配置了。default : 0 单位 s（不建议使用）\n\ns2sm.cpool.idleConnectionTestPeriod           = 900\n#每900秒检查所有连接池中的空闲连接\n\ns2sm.cpool.maxConnectionAge      = 6000\n#配置连接的生存时间，超过这个时间的连接将由连接池自动断开丢弃掉。当然正在使用的连接不会马上断开，而是等待它close再断开。配置为0的时候则不会对连接的生存时间进行限制。default : 0 单位 s（不建议使用）\n\n\n\n##配置PreparedStatement缓存\n\ns2sm.cpool.maxStatements=500\n#连接池为数据源缓存的PreparedStatement的总数。由于PreparedStatement属于单个Connection,\n#所以这个数量应该根据应用中平均连接数乘以每个连接的平均PreparedStatement\n#来计算。同时maxStatementsPerConnection的配置无效。default : 0（不建议使用）\n\ns2sm.cpool.maxStatementsPerConnection=30\n#连接池为数据源单个Connection缓存的PreparedStatement数，这个配置比maxStatements更有意义，因为它缓存的服务对象是单个数据连接，\n#如果设置的好，肯定是可以提高性能的。为0的时候不缓存。default : 0（看情况而论）\n\n\n\n##重连相关配置 \n\ns2sm.cpool.acquireRetryAttempts=5\n#连接池在获得新连接失败时重试的次数，如果小于等于0则无限重试直至连接获得成功。default : 30（建议使用）\n\ns2sm.cpool.acquireRetryDelay=1000\n#两次连接中间隔时间，单位毫秒，连接池在获得新连接时的间隔时间。default : 1000 单位ms（建议使用）\n\ns2sm.cpool.checkoutTimeout = 100\n#配置当连接池所有连接用完时应用程序getConnection的等待时间。为0则无限等待直至有其他连接释放或者创建新的连接，\n#不为0则当时间到的时候如果仍没有获得连接，则会抛出SQLException。其实就是acquireRetryAttempts*acquireRetryDelay。\n#default : 0（与上面两个，有重复，选择其中两个都行）\n\ns2sm.cpool.breakAfterAcquireFailure = false\n#如果为true，则当连接获取失败时自动关闭数据源，除非重新启动应用程序。所以一般不用。default : false（不建议使用）\n\n\n##其他\n\ns2sm.cpool.autoCommitOnClose = false\n#连接池在回收数据库连接时是否自动提交事务。如果为false，则会回滚未提交的事务，如果为true，则会自动提交事务。default : false（不建议使用）\n\ns2sm.cpool.numHelperThreads=10\n#c3p0是异步操作的，缓慢的JDBC操作通过帮助进程完成。扩展这些操作可以有效的提升性能 通过多线程实现多个操作同时被执行。Default: 3\n```\n\n```xml\n#定义LOG输出级别  \nlog4j.rootLogger=info,Console,File  \n#定义日志输出目的地为控制台  \nlog4j.appender.Console=org.apache.log4j.ConsoleAppender  \nlog4j.appender.Console.Target=System.out  \n#可以灵活地指定日志输出格式，下面一行是指定具体的格式  \nlog4j.appender.Console.layout = org.apache.log4j.PatternLayout  \nlog4j.appender.Console.layout.ConversionPattern=[%c] - %m%n  \n  \n#文件大小到达指定尺寸的时候产生一个新的文件  \nlog4j.appender.File = org.apache.log4j.RollingFileAppender  \n#指定输出目录  \nlog4j.appender.File.File = logs/ssm.log\n#定义文件最大大小  \nlog4j.appender.File.MaxFileSize = 10MB  \n#输出所有日志，如果换成DEBUG表示输出DEBUG以上级别日志  \nlog4j.appender.File.Threshold = ALL  \nlog4j.appender.File.layout = org.apache.log4j.PatternLayout  \nlog4j.appender.File.layout.ConversionPattern =[%p] [%d{yyyy-MM-dd HH\\:mm\\:ss}][%c]%m%n \n```\n\n","source":"_posts/Mybatis-5-——与spring整合.md","raw":"---\ntitle: Mybatis(5)——与spring整合\ncategories:\n  - Mybatis\ntags:\n  - Mybatis\ndate: 2018-02-27 16:26:53\n---\n\n整合spring\n<!-- more -->\n## 1、jar包\nspring相关、mybatis、mybatis-srping整合包、数据库、数据库驱动、日志等\n\n```xml\n<dependencies>\n\t<!-- Spring -->\n\t<dependency>\n\t\t<groupId>org.springframework</groupId>\n\t\t<artifactId>spring-test</artifactId>\n\t</dependency>\n\t<dependency>\n\t\t<groupId>org.springframework</groupId>\n\t\t<artifactId>spring-context</artifactId>\n\t</dependency>\n\t<dependency>\n\t\t<groupId>org.springframework</groupId>\n\t\t<artifactId>spring-aspects</artifactId>\n\t</dependency>\n\t<dependency>\n\t\t<groupId>org.springframework</groupId>\n\t\t<artifactId>spring-orm</artifactId>\n\t</dependency>\n\t<dependency>\n\t\t<groupId>org.springframework</groupId>\n\t\t<artifactId>spring-web</artifactId>\n\t</dependency>\n\t<dependency>\n\t\t<groupId>org.springframework</groupId>\n\t\t<artifactId>spring-webmvc</artifactId>\n\t</dependency>\n\t<!-- mybatis -->\n\t<dependency>\n\t\t<groupId>org.mybatis</groupId>\n\t\t<artifactId>mybatis</artifactId>\n\t</dependency>\n\t<dependency>\n\t\t<groupId>org.mybatis</groupId>\n\t\t<artifactId>mybatis-spring</artifactId>\n\t\t<version>1.3.1</version>\n\t</dependency>\n\n\t<!-- mysql驱动 -->\n\t<dependency>\n\t\t<groupId>mysql</groupId>\n\t\t<artifactId>mysql-connector-java</artifactId>\n\t\t<version>5.1.6</version>\n\t\t<scope>runtime</scope>\n\t</dependency>\n\n\t<!-- c3p0 -->\n\t<dependency>\n\t\t<groupId>c3p0</groupId>\n\t\t<artifactId>c3p0</artifactId>\n\t\t<version>0.9.1.2</version>\n\t</dependency>\n\t<!-- slf4j -->\n\t<dependency>\n\t\t<groupId>org.slf4j</groupId>\n\t\t<artifactId>slf4j-log4j12</artifactId>\n\t\t<version>1.7.2</version>\n\t</dependency>\n\t<!-- junit -->\n\t<dependency>\n\t\t<groupId>junit</groupId>\n\t\t<artifactId>junit</artifactId>\n\t\t<version>4.12</version>\n\t\t<scope>test</scope>\n\t</dependency>\n\t<dependency>\n        <groupId>org.hamcrest</groupId>\n        <artifactId>hamcrest-library</artifactId>\n        <version>1.3</version>\n    </dependency>\n\t<!-- jstl -->\n\t<dependency>\n\t\t<groupId>javax.servlet</groupId>\n\t\t<artifactId>jstl</artifactId>\n\t\t<version>1.2</version>\n\t</dependency>\n\n\t<!-- servlet jsp -->\n\t<dependency>\n\t\t<groupId>javax.servlet</groupId>\n\t\t<artifactId>servlet-api</artifactId>\n\t\t<version>2.5</version>\n\t\t<scope>provided</scope>\n\t</dependency>\n\t<dependency>\n\t\t<groupId>javax.servlet</groupId>\n\t\t<artifactId>jsp-api</artifactId>\n\t\t<version>2.0</version>\n\t\t<scope>provided</scope>\n\t</dependency>\n</dependencies>\n```\n\n## 2、spring配置文件\n\n在classpath下创建applicationContext.xml，定义数据库链接池、SqlSessionFactory。\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:aop=\"http://www.springframework.org/schema/aop\"\n\txmlns:context=\"http://www.springframework.org/schema/context\"\n\txmlns:mvc=\"http://www.springframework.org/schema/mvc\" xmlns:tx=\"http://www.springframework.org/schema/tx\"\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd  \n        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.3.xsd  \n        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd  \n        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd  \n        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.3.xsd\">\n\t\n\t<!-- 开启注解、自动扫描 -->\n\t<context:annotation-config/>\n\t<context:component-scan base-package=\"com.topvision.ssm\"/>\n\n\t<!-- 1、加载properties -->\n\t<!-- <context:property-placeholder location=\"classpath:jdbc.properties\"/> -->\n\t<bean id=\"propertyConfigurer\" class=\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\">\n\t\t<property name=\"locations\">\n\t\t\t<list>\n\t\t\t\t<value>classpath:jdbc.properties</value>\n\t\t\t</list>\n\t\t</property>\n\t</bean>\n\n\t<!--2、 数据库C3P0 -->\n\t<bean id=\"dataSource\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\">\n\t\t<property name=\"driverClass\" value=\"${s2sm.jdbc.driverClass}\"/>\n\t\t<property name=\"jdbcUrl\" value=\"${s2sm.jdbc.url}\"/>\n\t\t<property name=\"user\" value=\"${s2sm.jdbc.username}\"/>\n\t\t<property name=\"password\" value=\"${s2sm.jdbc.password}\"/>\n\t\t\n        <property name=\"initialPoolSize\" value=\"${s2sm.cpool.initialPoolSize}\" />\n        <property name=\"minPoolSize\" value=\"${s2sm.cpool.minPoolSize}\" />\n        <property name=\"maxPoolSize\" value=\"${s2sm.cpool.maxPoolSize}\" />\n        <property name=\"acquireIncrement\" value=\"${s2sm.cpool.acquireIncrement}\" />\n        <property name=\"maxIdleTime\" value=\"${s2sm.cpool.maxIdleTime}\"/>\n        <property name=\"acquireRetryAttempts\" value=\"${s2sm.cpool.acquireRetryAttempts}\"/>\n        <property name=\"acquireRetryDelay\" value=\"${s2sm.cpool.acquireRetryDelay}\"/>\n\t</bean>\n\t\n\t <!-- 3.配置SqlSessionFactory对象 -->\n\t<bean id=\"sqlSessionFactory\" class=\"org.mybatis.spring.SqlSessionFactoryBean\">\n\t\t<!-- 注入数据库连接池 -->\n\t\t<property name=\"dataSource\" ref=\"dataSource\" />\n\t\t<!-- 配置MyBaties全局配置文件:mybatis-config.xml -->\n\t\t<property name=\"configLocation\" value=\"classpath:sqlMapConfig.xml\" />\n\t\t<!-- 扫描entity包 使用别名 -->\n\t\t<property name=\"typeAliasesPackage\" value=\"com.topvision.ssm.domain\" />\n\t\t<!-- 扫描sql配置文件:mapper需要的xml文件 -->\n\t\t<!-- <property name=\"mapperLocations\" value=\"classpath:mapper/*.xml\" /> -->\n\t\t<property name=\"mapperLocations\" value=\"classpath*:com/topvision/ssm/dao/mapper/*.xml\" />\n\t</bean>\n\n\t<!-- 4.配置扫描Dao接口包，动态实现Dao接口，注入到spring容器中 -->\n\t<bean class=\"org.mybatis.spring.mapper.MapperScannerConfigurer\">\n        <!-- 注入sqlSessionFactory -->\n\t\t<property name=\"sqlSessionFactoryBeanName\" value=\"sqlSessionFactory\" />\n\t\t<!-- 给出需要扫描Dao接口包 -->\n       \t<property name=\"basePackage\" value=\"com.topvision.ssm.dao\" />\n\t</bean>\n\t\n\t<!-- 5、事务,开启注解事务 -->\n\t<tx:annotation-driven transaction-manager=\"transactionManager\"/>\n\t<!-- 事务管理器 -->\n\t<bean id=\"transactionManager\" class=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\">\n\t\t<property name=\"dataSource\" ref=\"dataSource\"></property>\n\t</bean>\t\n\t\n</beans> \n```\n\n## 3、mybatis配置文件\n\n在classpath下新建sqlMapConfig.xml。\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE configuration\n  PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"\n  \"http://mybatis.org/dtd/mybatis-3-config.dtd\">\n<configuration>\n\t<!--此处暂时不需要任何配置，基本配置已在applicationContext.xml的第三步中配置-->\n</configuration>\n```\n\n## 4、jdbc.properties和log4j.properties\n\n在classpath下新建这两个文件，注意参数。例如下方：\n\n```xml\ns2sm.jdbc.driverClass\t= com.mysql.jdbc.Driver\ns2sm.jdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb\ns2sm.jdbc.username\t\t= root\ns2sm.jdbc.password\t\t= 123\n\ns2sm.cpool.maxIdleTimeExcessConnections = 1800\n\n\n##最常用配置\ns2sm.cpool.initialPoolSize       = 50\n#连接池初始化时创建的连接数,default : 3，取值应在minPoolSize与maxPoolSize之间\ns2sm.cpool.minPoolSize           = 10\n#连接池保持的最小连接数,default : 3\ns2sm.cpool.maxPoolSize           = 100\n#连接池中拥有的最大连接数，如果获得新连接时会使连接总数超过这个值则不会再获取新连接，而是等待其他连接释放，所以这个值有可能会设计地很大,default : 15\ns2sm.cpool.acquireIncrement      = 5\n#连接池在无空闲连接可用时一次性创建的新数据库连接数,default : 3\n\n\n\n##管理连接池的大小和连接的生存时间\n\ns2sm.cpool.maxIdleTime           = 3600\n#连接的最大空闲时间，如果超过这个时间，某个数据库连接还没有被使用，则会断开掉这个连接。如果为0，则永远不会断开连接,即回收此连接。default : 0 单位 s。建议使用\n\ns2sm.cpool.maxIdleTimeExcessConnections = 1800\n#这个配置主要是为了快速减轻连接池的负载，比如连接池中连接数因为某次数据访问高峰导致创建了很多数据连接，但是后面的时间段需要的数据库连接数很少，需要快速释放，\n#必须小于maxIdleTime。其实这个没必要配置，maxIdleTime已经配置了。default : 0 单位 s（不建议使用）\n\ns2sm.cpool.idleConnectionTestPeriod           = 900\n#每900秒检查所有连接池中的空闲连接\n\ns2sm.cpool.maxConnectionAge      = 6000\n#配置连接的生存时间，超过这个时间的连接将由连接池自动断开丢弃掉。当然正在使用的连接不会马上断开，而是等待它close再断开。配置为0的时候则不会对连接的生存时间进行限制。default : 0 单位 s（不建议使用）\n\n\n\n##配置PreparedStatement缓存\n\ns2sm.cpool.maxStatements=500\n#连接池为数据源缓存的PreparedStatement的总数。由于PreparedStatement属于单个Connection,\n#所以这个数量应该根据应用中平均连接数乘以每个连接的平均PreparedStatement\n#来计算。同时maxStatementsPerConnection的配置无效。default : 0（不建议使用）\n\ns2sm.cpool.maxStatementsPerConnection=30\n#连接池为数据源单个Connection缓存的PreparedStatement数，这个配置比maxStatements更有意义，因为它缓存的服务对象是单个数据连接，\n#如果设置的好，肯定是可以提高性能的。为0的时候不缓存。default : 0（看情况而论）\n\n\n\n##重连相关配置 \n\ns2sm.cpool.acquireRetryAttempts=5\n#连接池在获得新连接失败时重试的次数，如果小于等于0则无限重试直至连接获得成功。default : 30（建议使用）\n\ns2sm.cpool.acquireRetryDelay=1000\n#两次连接中间隔时间，单位毫秒，连接池在获得新连接时的间隔时间。default : 1000 单位ms（建议使用）\n\ns2sm.cpool.checkoutTimeout = 100\n#配置当连接池所有连接用完时应用程序getConnection的等待时间。为0则无限等待直至有其他连接释放或者创建新的连接，\n#不为0则当时间到的时候如果仍没有获得连接，则会抛出SQLException。其实就是acquireRetryAttempts*acquireRetryDelay。\n#default : 0（与上面两个，有重复，选择其中两个都行）\n\ns2sm.cpool.breakAfterAcquireFailure = false\n#如果为true，则当连接获取失败时自动关闭数据源，除非重新启动应用程序。所以一般不用。default : false（不建议使用）\n\n\n##其他\n\ns2sm.cpool.autoCommitOnClose = false\n#连接池在回收数据库连接时是否自动提交事务。如果为false，则会回滚未提交的事务，如果为true，则会自动提交事务。default : false（不建议使用）\n\ns2sm.cpool.numHelperThreads=10\n#c3p0是异步操作的，缓慢的JDBC操作通过帮助进程完成。扩展这些操作可以有效的提升性能 通过多线程实现多个操作同时被执行。Default: 3\n```\n\n```xml\n#定义LOG输出级别  \nlog4j.rootLogger=info,Console,File  \n#定义日志输出目的地为控制台  \nlog4j.appender.Console=org.apache.log4j.ConsoleAppender  \nlog4j.appender.Console.Target=System.out  \n#可以灵活地指定日志输出格式，下面一行是指定具体的格式  \nlog4j.appender.Console.layout = org.apache.log4j.PatternLayout  \nlog4j.appender.Console.layout.ConversionPattern=[%c] - %m%n  \n  \n#文件大小到达指定尺寸的时候产生一个新的文件  \nlog4j.appender.File = org.apache.log4j.RollingFileAppender  \n#指定输出目录  \nlog4j.appender.File.File = logs/ssm.log\n#定义文件最大大小  \nlog4j.appender.File.MaxFileSize = 10MB  \n#输出所有日志，如果换成DEBUG表示输出DEBUG以上级别日志  \nlog4j.appender.File.Threshold = ALL  \nlog4j.appender.File.layout = org.apache.log4j.PatternLayout  \nlog4j.appender.File.layout.ConversionPattern =[%p] [%d{yyyy-MM-dd HH\\:mm\\:ss}][%c]%m%n \n```\n\n","slug":"Mybatis-5-——与spring整合","published":1,"updated":"2018-03-06T08:27:35.915Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfsz0017hwvfyhdroaje","content":"<p>整合spring<br><a id=\"more\"></a></p>\n<h2 id=\"1、jar包\"><a href=\"#1、jar包\" class=\"headerlink\" title=\"1、jar包\"></a>1、jar包</h2><p>spring相关、mybatis、mybatis-srping整合包、数据库、数据库驱动、日志等</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- Spring --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aspects<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-orm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-webmvc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- mybatis --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-spring<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- mysql驱动 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- c3p0 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- slf4j --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-log4j12<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- junit --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.hamcrest<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>hamcrest-library<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- jstl --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jstl<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- servlet jsp --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>servlet-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jsp-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"2、spring配置文件\"><a href=\"#2、spring配置文件\" class=\"headerlink\" title=\"2、spring配置文件\"></a>2、spring配置文件</h2><p>在classpath下创建applicationContext.xml，定义数据库链接池、SqlSessionFactory。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span> <span class=\"attr\">xmlns:aop</span>=<span class=\"string\">\"http://www.springframework.org/schema/aop\"</span></div><div class=\"line\">\t<span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></div><div class=\"line\">\t<span class=\"attr\">xmlns:mvc</span>=<span class=\"string\">\"http://www.springframework.org/schema/mvc\"</span> <span class=\"attr\">xmlns:tx</span>=<span class=\"string\">\"http://www.springframework.org/schema/tx\"</span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd  </span></div><div class=\"line\">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.3.xsd  </div><div class=\"line\">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd  </div><div class=\"line\">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd  </div><div class=\"line\">        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.3.xsd\"&gt;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 开启注解、自动扫描 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">context:annotation-config</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.ssm\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 1、加载properties --&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- &lt;context:property-placeholder location=\"classpath:jdbc.properties\"/&gt; --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"propertyConfigurer\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"locations\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>classpath:jdbc.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!--2、 数据库C3P0 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.mchange.v2.c3p0.ComboPooledDataSource\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.driverClass&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.url&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.username&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.password&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"initialPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.initialPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"minPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.minPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"maxPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.maxPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireIncrement\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireIncrement&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"maxIdleTime\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.maxIdleTime&#125;\"</span>/&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireRetryAttempts\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireRetryAttempts&#125;\"</span>/&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireRetryDelay\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireRetryDelay&#125;\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t <span class=\"comment\">&lt;!-- 3.配置SqlSessionFactory对象 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"sqlSessionFactory\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.mybatis.spring.SqlSessionFactoryBean\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 注入数据库连接池 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 配置MyBaties全局配置文件:mybatis-config.xml --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"configLocation\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"classpath:sqlMapConfig.xml\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 扫描entity包 使用别名 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"typeAliasesPackage\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.topvision.ssm.domain\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 扫描sql配置文件:mapper需要的xml文件 --&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- &lt;property name=\"mapperLocations\" value=\"classpath:mapper/*.xml\" /&gt; --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"mapperLocations\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"classpath*:com/topvision/ssm/dao/mapper/*.xml\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 4.配置扫描Dao接口包，动态实现Dao接口，注入到spring容器中 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.mybatis.spring.mapper.MapperScannerConfigurer\"</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!-- 注入sqlSessionFactory --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"sqlSessionFactoryBeanName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"sqlSessionFactory\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 给出需要扫描Dao接口包 --&gt;</span></div><div class=\"line\">       \t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"basePackage\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.topvision.ssm.dao\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 5、事务,开启注解事务 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">tx:annotation-driven</span> <span class=\"attr\">transaction-manager</span>=<span class=\"string\">\"transactionManager\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 事务管理器 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"transactionManager\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DataSourceTransactionManager\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span>\t</div><div class=\"line\">\t</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"3、mybatis配置文件\"><a href=\"#3、mybatis配置文件\" class=\"headerlink\" title=\"3、mybatis配置文件\"></a>3、mybatis配置文件</h2><p>在classpath下新建sqlMapConfig.xml。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE configuration</span></div><div class=\"line\">  PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"</div><div class=\"line\">  \"http://mybatis.org/dtd/mybatis-3-config.dtd\"&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!--此处暂时不需要任何配置，基本配置已在applicationContext.xml的第三步中配置--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"4、jdbc-properties和log4j-properties\"><a href=\"#4、jdbc-properties和log4j-properties\" class=\"headerlink\" title=\"4、jdbc.properties和log4j.properties\"></a>4、jdbc.properties和log4j.properties</h2><p>在classpath下新建这两个文件，注意参数。例如下方：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div></pre></td><td class=\"code\"><pre><div class=\"line\">s2sm.jdbc.driverClass\t= com.mysql.jdbc.Driver</div><div class=\"line\">s2sm.jdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb</div><div class=\"line\">s2sm.jdbc.username\t\t= root</div><div class=\"line\">s2sm.jdbc.password\t\t= 123</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.maxIdleTimeExcessConnections = 1800</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">##最常用配置</div><div class=\"line\">s2sm.cpool.initialPoolSize       = 50</div><div class=\"line\">#连接池初始化时创建的连接数,default : 3，取值应在minPoolSize与maxPoolSize之间</div><div class=\"line\">s2sm.cpool.minPoolSize           = 10</div><div class=\"line\">#连接池保持的最小连接数,default : 3</div><div class=\"line\">s2sm.cpool.maxPoolSize           = 100</div><div class=\"line\">#连接池中拥有的最大连接数，如果获得新连接时会使连接总数超过这个值则不会再获取新连接，而是等待其他连接释放，所以这个值有可能会设计地很大,default : 15</div><div class=\"line\">s2sm.cpool.acquireIncrement      = 5</div><div class=\"line\">#连接池在无空闲连接可用时一次性创建的新数据库连接数,default : 3</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">##管理连接池的大小和连接的生存时间</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.maxIdleTime           = 3600</div><div class=\"line\">#连接的最大空闲时间，如果超过这个时间，某个数据库连接还没有被使用，则会断开掉这个连接。如果为0，则永远不会断开连接,即回收此连接。default : 0 单位 s。建议使用</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.maxIdleTimeExcessConnections = 1800</div><div class=\"line\">#这个配置主要是为了快速减轻连接池的负载，比如连接池中连接数因为某次数据访问高峰导致创建了很多数据连接，但是后面的时间段需要的数据库连接数很少，需要快速释放，</div><div class=\"line\">#必须小于maxIdleTime。其实这个没必要配置，maxIdleTime已经配置了。default : 0 单位 s（不建议使用）</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.idleConnectionTestPeriod           = 900</div><div class=\"line\">#每900秒检查所有连接池中的空闲连接</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.maxConnectionAge      = 6000</div><div class=\"line\">#配置连接的生存时间，超过这个时间的连接将由连接池自动断开丢弃掉。当然正在使用的连接不会马上断开，而是等待它close再断开。配置为0的时候则不会对连接的生存时间进行限制。default : 0 单位 s（不建议使用）</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">##配置PreparedStatement缓存</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.maxStatements=500</div><div class=\"line\">#连接池为数据源缓存的PreparedStatement的总数。由于PreparedStatement属于单个Connection,</div><div class=\"line\">#所以这个数量应该根据应用中平均连接数乘以每个连接的平均PreparedStatement</div><div class=\"line\">#来计算。同时maxStatementsPerConnection的配置无效。default : 0（不建议使用）</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.maxStatementsPerConnection=30</div><div class=\"line\">#连接池为数据源单个Connection缓存的PreparedStatement数，这个配置比maxStatements更有意义，因为它缓存的服务对象是单个数据连接，</div><div class=\"line\">#如果设置的好，肯定是可以提高性能的。为0的时候不缓存。default : 0（看情况而论）</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">##重连相关配置 </div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.acquireRetryAttempts=5</div><div class=\"line\">#连接池在获得新连接失败时重试的次数，如果小于等于0则无限重试直至连接获得成功。default : 30（建议使用）</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.acquireRetryDelay=1000</div><div class=\"line\">#两次连接中间隔时间，单位毫秒，连接池在获得新连接时的间隔时间。default : 1000 单位ms（建议使用）</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.checkoutTimeout = 100</div><div class=\"line\">#配置当连接池所有连接用完时应用程序getConnection的等待时间。为0则无限等待直至有其他连接释放或者创建新的连接，</div><div class=\"line\">#不为0则当时间到的时候如果仍没有获得连接，则会抛出SQLException。其实就是acquireRetryAttempts*acquireRetryDelay。</div><div class=\"line\">#default : 0（与上面两个，有重复，选择其中两个都行）</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.breakAfterAcquireFailure = false</div><div class=\"line\">#如果为true，则当连接获取失败时自动关闭数据源，除非重新启动应用程序。所以一般不用。default : false（不建议使用）</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">##其他</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.autoCommitOnClose = false</div><div class=\"line\">#连接池在回收数据库连接时是否自动提交事务。如果为false，则会回滚未提交的事务，如果为true，则会自动提交事务。default : false（不建议使用）</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.numHelperThreads=10</div><div class=\"line\">#c3p0是异步操作的，缓慢的JDBC操作通过帮助进程完成。扩展这些操作可以有效的提升性能 通过多线程实现多个操作同时被执行。Default: 3</div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\">#定义LOG输出级别  </div><div class=\"line\">log4j.rootLogger=info,Console,File  </div><div class=\"line\">#定义日志输出目的地为控制台  </div><div class=\"line\">log4j.appender.Console=org.apache.log4j.ConsoleAppender  </div><div class=\"line\">log4j.appender.Console.Target=System.out  </div><div class=\"line\">#可以灵活地指定日志输出格式，下面一行是指定具体的格式  </div><div class=\"line\">log4j.appender.Console.layout = org.apache.log4j.PatternLayout  </div><div class=\"line\">log4j.appender.Console.layout.ConversionPattern=[%c] - %m%n  </div><div class=\"line\">  </div><div class=\"line\">#文件大小到达指定尺寸的时候产生一个新的文件  </div><div class=\"line\">log4j.appender.File = org.apache.log4j.RollingFileAppender  </div><div class=\"line\">#指定输出目录  </div><div class=\"line\">log4j.appender.File.File = logs/ssm.log</div><div class=\"line\">#定义文件最大大小  </div><div class=\"line\">log4j.appender.File.MaxFileSize = 10MB  </div><div class=\"line\">#输出所有日志，如果换成DEBUG表示输出DEBUG以上级别日志  </div><div class=\"line\">log4j.appender.File.Threshold = ALL  </div><div class=\"line\">log4j.appender.File.layout = org.apache.log4j.PatternLayout  </div><div class=\"line\">log4j.appender.File.layout.ConversionPattern =[%p] [%d&#123;yyyy-MM-dd HH\\:mm\\:ss&#125;][%c]%m%n</div></pre></td></tr></table></figure>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>整合spring<br>","more":"</p>\n<h2 id=\"1、jar包\"><a href=\"#1、jar包\" class=\"headerlink\" title=\"1、jar包\"></a>1、jar包</h2><p>spring相关、mybatis、mybatis-srping整合包、数据库、数据库驱动、日志等</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- Spring --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aspects<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-orm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-webmvc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- mybatis --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-spring<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- mysql驱动 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- c3p0 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- slf4j --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-log4j12<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- junit --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.hamcrest<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>hamcrest-library<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- jstl --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jstl<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- servlet jsp --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>servlet-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jsp-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"2、spring配置文件\"><a href=\"#2、spring配置文件\" class=\"headerlink\" title=\"2、spring配置文件\"></a>2、spring配置文件</h2><p>在classpath下创建applicationContext.xml，定义数据库链接池、SqlSessionFactory。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span> <span class=\"attr\">xmlns:aop</span>=<span class=\"string\">\"http://www.springframework.org/schema/aop\"</span></div><div class=\"line\">\t<span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></div><div class=\"line\">\t<span class=\"attr\">xmlns:mvc</span>=<span class=\"string\">\"http://www.springframework.org/schema/mvc\"</span> <span class=\"attr\">xmlns:tx</span>=<span class=\"string\">\"http://www.springframework.org/schema/tx\"</span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd  </span></div><div class=\"line\">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.3.xsd  </div><div class=\"line\">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd  </div><div class=\"line\">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd  </div><div class=\"line\">        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.3.xsd\"&gt;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 开启注解、自动扫描 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">context:annotation-config</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.ssm\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 1、加载properties --&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- &lt;context:property-placeholder location=\"classpath:jdbc.properties\"/&gt; --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"propertyConfigurer\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"locations\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>classpath:jdbc.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!--2、 数据库C3P0 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.mchange.v2.c3p0.ComboPooledDataSource\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.driverClass&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.url&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.username&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.password&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"initialPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.initialPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"minPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.minPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"maxPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.maxPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireIncrement\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireIncrement&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"maxIdleTime\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.maxIdleTime&#125;\"</span>/&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireRetryAttempts\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireRetryAttempts&#125;\"</span>/&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireRetryDelay\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireRetryDelay&#125;\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t <span class=\"comment\">&lt;!-- 3.配置SqlSessionFactory对象 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"sqlSessionFactory\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.mybatis.spring.SqlSessionFactoryBean\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 注入数据库连接池 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 配置MyBaties全局配置文件:mybatis-config.xml --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"configLocation\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"classpath:sqlMapConfig.xml\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 扫描entity包 使用别名 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"typeAliasesPackage\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.topvision.ssm.domain\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 扫描sql配置文件:mapper需要的xml文件 --&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- &lt;property name=\"mapperLocations\" value=\"classpath:mapper/*.xml\" /&gt; --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"mapperLocations\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"classpath*:com/topvision/ssm/dao/mapper/*.xml\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 4.配置扫描Dao接口包，动态实现Dao接口，注入到spring容器中 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.mybatis.spring.mapper.MapperScannerConfigurer\"</span>&gt;</span></div><div class=\"line\">        <span class=\"comment\">&lt;!-- 注入sqlSessionFactory --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"sqlSessionFactoryBeanName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"sqlSessionFactory\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 给出需要扫描Dao接口包 --&gt;</span></div><div class=\"line\">       \t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"basePackage\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.topvision.ssm.dao\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 5、事务,开启注解事务 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">tx:annotation-driven</span> <span class=\"attr\">transaction-manager</span>=<span class=\"string\">\"transactionManager\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 事务管理器 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"transactionManager\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DataSourceTransactionManager\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span>\t</div><div class=\"line\">\t</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"3、mybatis配置文件\"><a href=\"#3、mybatis配置文件\" class=\"headerlink\" title=\"3、mybatis配置文件\"></a>3、mybatis配置文件</h2><p>在classpath下新建sqlMapConfig.xml。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE configuration</span></div><div class=\"line\">  PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"</div><div class=\"line\">  \"http://mybatis.org/dtd/mybatis-3-config.dtd\"&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!--此处暂时不需要任何配置，基本配置已在applicationContext.xml的第三步中配置--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"4、jdbc-properties和log4j-properties\"><a href=\"#4、jdbc-properties和log4j-properties\" class=\"headerlink\" title=\"4、jdbc.properties和log4j.properties\"></a>4、jdbc.properties和log4j.properties</h2><p>在classpath下新建这两个文件，注意参数。例如下方：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div></pre></td><td class=\"code\"><pre><div class=\"line\">s2sm.jdbc.driverClass\t= com.mysql.jdbc.Driver</div><div class=\"line\">s2sm.jdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb</div><div class=\"line\">s2sm.jdbc.username\t\t= root</div><div class=\"line\">s2sm.jdbc.password\t\t= 123</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.maxIdleTimeExcessConnections = 1800</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">##最常用配置</div><div class=\"line\">s2sm.cpool.initialPoolSize       = 50</div><div class=\"line\">#连接池初始化时创建的连接数,default : 3，取值应在minPoolSize与maxPoolSize之间</div><div class=\"line\">s2sm.cpool.minPoolSize           = 10</div><div class=\"line\">#连接池保持的最小连接数,default : 3</div><div class=\"line\">s2sm.cpool.maxPoolSize           = 100</div><div class=\"line\">#连接池中拥有的最大连接数，如果获得新连接时会使连接总数超过这个值则不会再获取新连接，而是等待其他连接释放，所以这个值有可能会设计地很大,default : 15</div><div class=\"line\">s2sm.cpool.acquireIncrement      = 5</div><div class=\"line\">#连接池在无空闲连接可用时一次性创建的新数据库连接数,default : 3</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">##管理连接池的大小和连接的生存时间</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.maxIdleTime           = 3600</div><div class=\"line\">#连接的最大空闲时间，如果超过这个时间，某个数据库连接还没有被使用，则会断开掉这个连接。如果为0，则永远不会断开连接,即回收此连接。default : 0 单位 s。建议使用</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.maxIdleTimeExcessConnections = 1800</div><div class=\"line\">#这个配置主要是为了快速减轻连接池的负载，比如连接池中连接数因为某次数据访问高峰导致创建了很多数据连接，但是后面的时间段需要的数据库连接数很少，需要快速释放，</div><div class=\"line\">#必须小于maxIdleTime。其实这个没必要配置，maxIdleTime已经配置了。default : 0 单位 s（不建议使用）</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.idleConnectionTestPeriod           = 900</div><div class=\"line\">#每900秒检查所有连接池中的空闲连接</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.maxConnectionAge      = 6000</div><div class=\"line\">#配置连接的生存时间，超过这个时间的连接将由连接池自动断开丢弃掉。当然正在使用的连接不会马上断开，而是等待它close再断开。配置为0的时候则不会对连接的生存时间进行限制。default : 0 单位 s（不建议使用）</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">##配置PreparedStatement缓存</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.maxStatements=500</div><div class=\"line\">#连接池为数据源缓存的PreparedStatement的总数。由于PreparedStatement属于单个Connection,</div><div class=\"line\">#所以这个数量应该根据应用中平均连接数乘以每个连接的平均PreparedStatement</div><div class=\"line\">#来计算。同时maxStatementsPerConnection的配置无效。default : 0（不建议使用）</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.maxStatementsPerConnection=30</div><div class=\"line\">#连接池为数据源单个Connection缓存的PreparedStatement数，这个配置比maxStatements更有意义，因为它缓存的服务对象是单个数据连接，</div><div class=\"line\">#如果设置的好，肯定是可以提高性能的。为0的时候不缓存。default : 0（看情况而论）</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">##重连相关配置 </div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.acquireRetryAttempts=5</div><div class=\"line\">#连接池在获得新连接失败时重试的次数，如果小于等于0则无限重试直至连接获得成功。default : 30（建议使用）</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.acquireRetryDelay=1000</div><div class=\"line\">#两次连接中间隔时间，单位毫秒，连接池在获得新连接时的间隔时间。default : 1000 单位ms（建议使用）</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.checkoutTimeout = 100</div><div class=\"line\">#配置当连接池所有连接用完时应用程序getConnection的等待时间。为0则无限等待直至有其他连接释放或者创建新的连接，</div><div class=\"line\">#不为0则当时间到的时候如果仍没有获得连接，则会抛出SQLException。其实就是acquireRetryAttempts*acquireRetryDelay。</div><div class=\"line\">#default : 0（与上面两个，有重复，选择其中两个都行）</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.breakAfterAcquireFailure = false</div><div class=\"line\">#如果为true，则当连接获取失败时自动关闭数据源，除非重新启动应用程序。所以一般不用。default : false（不建议使用）</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">##其他</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.autoCommitOnClose = false</div><div class=\"line\">#连接池在回收数据库连接时是否自动提交事务。如果为false，则会回滚未提交的事务，如果为true，则会自动提交事务。default : false（不建议使用）</div><div class=\"line\"></div><div class=\"line\">s2sm.cpool.numHelperThreads=10</div><div class=\"line\">#c3p0是异步操作的，缓慢的JDBC操作通过帮助进程完成。扩展这些操作可以有效的提升性能 通过多线程实现多个操作同时被执行。Default: 3</div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\">#定义LOG输出级别  </div><div class=\"line\">log4j.rootLogger=info,Console,File  </div><div class=\"line\">#定义日志输出目的地为控制台  </div><div class=\"line\">log4j.appender.Console=org.apache.log4j.ConsoleAppender  </div><div class=\"line\">log4j.appender.Console.Target=System.out  </div><div class=\"line\">#可以灵活地指定日志输出格式，下面一行是指定具体的格式  </div><div class=\"line\">log4j.appender.Console.layout = org.apache.log4j.PatternLayout  </div><div class=\"line\">log4j.appender.Console.layout.ConversionPattern=[%c] - %m%n  </div><div class=\"line\">  </div><div class=\"line\">#文件大小到达指定尺寸的时候产生一个新的文件  </div><div class=\"line\">log4j.appender.File = org.apache.log4j.RollingFileAppender  </div><div class=\"line\">#指定输出目录  </div><div class=\"line\">log4j.appender.File.File = logs/ssm.log</div><div class=\"line\">#定义文件最大大小  </div><div class=\"line\">log4j.appender.File.MaxFileSize = 10MB  </div><div class=\"line\">#输出所有日志，如果换成DEBUG表示输出DEBUG以上级别日志  </div><div class=\"line\">log4j.appender.File.Threshold = ALL  </div><div class=\"line\">log4j.appender.File.layout = org.apache.log4j.PatternLayout  </div><div class=\"line\">log4j.appender.File.layout.ConversionPattern =[%p] [%d&#123;yyyy-MM-dd HH\\:mm\\:ss&#125;][%c]%m%n</div></pre></td></tr></table></figure>"},{"title":"Mysql存储过程","keyword":["Mysql","存储过程"],"date":"2017-07-25T05:08:58.000Z","_content":"## 1. 存储过程\n\n### 1.1 简介\n\n&emsp;&emsp;普通的sql语句在执行的时候需要先编译再执行，而存储过程（Stored Procedure）是一组为了特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定的存储过程名称并给定参数（如果有的话）来调用执行它。\n&emsp;&emsp;存储过程是可编程的函数，在数据库中创建并保存，可以由SQL语句和控制结构组成。当想要在不同的应用程序或平台上执行相同的函数，或者封装特定功能时，存储过程是非常有用的。数据库中的存储过程可以看做是对编程中面向对象方法的模拟，它允许控制数据的访问方式。\n<!--more-->\n\n### 1.2 优点\n\n 1. 增强SQL语言的功能和灵活性：存储过程可以用流控制语句编写，有很强的灵活性，可以完成复杂的判断和较复杂的运算。\n 2. 标准组件式编程：存储过程被创建后，可以在程序中被多次调用，而不必重新编写该存储过程的SQL语句。而且数据库专业人员可以随时对存储过程进行修改，对应用程序源代码毫无影响。\n 3. 较快的执行速度：如果某一操作包含大量的Transaction-SQL代码或分别被多次执行，那么存储过程要比批处理的执行速度快很多。因为存储过程是预编译的。在首次运行一个存储过程时查询，优化器对其进行分析优化，并且给出最终被存储在系统表中的执行计划。而批处理的Transaction-SQL语句在每次运行时都要进行编译和优化，速度相对要慢一些。\n 4. 减少网络流量：针对同一个数据库对象的操作（如查询、修改），如果这一操作所涉及的Transaction-SQL语句被组织程存储过程，那么当在客户计算机上调用该存储过程时，网络中传送的只是该调用语句，从而大大增加了网络流量并降低了网络负载。\n 5. 安全机制：通过对执行某一存储过程的权限进行限制，能够实现对相应的数据的访问权限的限制，避免了非授权用户对数据的访问，保证了数据的安全。\n\n### 1.3 存储过程创建\n\n#### 1.3.1 语法\n**CREATE PROCEDURE  过程名([[IN|OUT|INOUT] 参数名 数据类型[,[IN|OUT|INOUT] 参数名 数据类型…]]) [特性 ...] 过程体**\n\n```sql\nDELIMITER //\n  CREATE PROCEDURE myproc(OUT s int)\n    BEGIN\n      SELECT COUNT(*) INTO s FROM students;\n    END\n    //\nDELIMITER ;\n```\n\n#### 1.3.2 分隔符\n\n&emsp;&emsp;MySQL默认以\";\"为分隔符，如果没有声明分割符，则编译器会把存储过程当成SQL语句进行处理，因此编译过程会报错，所以要事先用“DELIMITER //”声明当前段分隔符，让编译器把两个\"//\"之间的内容当做存储过程的代码，不会执行这些代码；“DELIMITER ;”的意为把分隔符还原。\n\n#### 1.3.3 参数\n\n&emsp;&emsp;存储过程根据需要可能会有输入、输出、输入输出参数，如果有多个参数用\",\"分割开。MySQL存储过程的参数用在存储过程的定义，共有三种参数类型,IN,OUT,INOUT:\n\n - IN:参数的值必须在调用存储过程时指定，在存储过程中修改该参数的值不能被返回，为默认值.\n - OUT:值可在存储过程内部被改变，并可返回.\n - INOUT:调用时指定，并且可被改变和返回.\n \n#### 2.3.4 过程体\n\n&emsp;&emsp;过程体的开始与结束使用BEGIN与END进行标识。\n\n### 1.4 变量\n\n#### 1.4.1 声明变量\n\n&emsp;&emsp;**DECLARE 变量名1[,变量名2...] 数据类型 [默认值];**\n\n#### 1.4.2 数值类型\n\n&emsp;&emsp;数据类型为MySQL的数据类型\n\n 1. 数值类型!\n     ![此处输入图片的描述][1]\n 2. 日期和时间类型!\n    ![此处输入图片的描述][2]\n 3. 字符串类型!\n    ![此处输入图片的描述][3]\n\n#### 1.4.3 变量赋值\n\n&emsp;&emsp;**SET 变量名 = 变量值 [,变量名= 变量值 ...]**\n\n#### 1.4.4 用户变量\n\n&emsp;&emsp;用户变量一般以@开头。\n&emsp;&emsp;注意：滥用用户变量会导致程序难以理解及管理\n```sql\nSELECT 'Hello World' into @x;\nSELECT @x;\n\nSET @y='Goodbye Cruel World';\nSELECT @y;\nSET @z=1+2+3;\nSELECT @z;\n```\n执行结果:\n![此处输入图片的描述][4]\n![此处输入图片的描述][5]\n![此处输入图片的描述][6]\n\n - 在存储过程中使用用户变量\n    \n    ```sql\n    CREATE PROCEDURE GreetWorld() SELECT CONCAT(@greeting,' World');\n    SET @greeting='Hello';\n    CALL GreetWorld();\n    ```\n    \n    执行结果:\n    ![此处输入图片的描述][7]\n    \n - 在存储过程间传递全局范围的用户变量\n\n    ```sql\n    CREATE PROCEDURE p1() SET @last_proc='p1';\n    CREATE PROCEDURE p2() SELECT CONCAT('Last procedure was ',@last_proc);\n    CALL p1();\n    CALL p2();\n    ```\n    \n    执行结果:\n    ![此处输入图片的描述][8]\n    \n#### 1.4.5 变量作用域\n\n&emsp;&emsp;内部变量在其作用域范围内享有更高的优先权，当执行到end时，内部变量消失，不再可见了，在存储过程外再也找不到这个内部变量，但是可以通过out参数或者将其值指派给会话变量来保存其值。\n\n```sql\n#变量作用域\nDELIMITER //\n  CREATE PROCEDURE proc()\n    BEGIN\n      DECLARE x1 VARCHAR(5) DEFAULT 'outer';\n        BEGIN\n          DECLARE x1 VARCHAR(5) DEFAULT 'inner';\n          SELECT x1;\n        END;\n      SELECT x1;\n    END;\n    //\nDELIMITER ;\n#调用\nCALL proc();\n```\n\n执行结果：\n```sql\ninner  outer\n```\n    \n### 1.5 存储过程的CRUD\n\n#### 1.5.1 调用\n&emsp;&emsp;用call和你过程名以及一个括号，括号里面根据需要，加入参数，参数包括输入参数、输出参数、输入输出参数。\n\n#### 1.5.2 查询\n\n```sql\n#查询存储过程\nSELECT name FROM mysql.proc WHERE db='数据库名';\nSELECT routine_name FROM information_schema.routines WHERE routine_schema='数据库名';\nSHOW PROCEDURE STATUS WHERE db='数据库名';\n\n#查看存储过程详细信息\nSHOW CREATE PROCEDURE 数据库.存储过程名;\n```\n\n#### 1.5.3 修改\n\n&emsp;&emsp;**ALTER PROCEDURE 更改用CREATE PROCEDURE 建立的预先指定的存储过程，其不会影响相关存储过程或存储功能。**\n\n```sql\nALTER {PROCEDURE | FUNCTION} sp_name [characteristic ...]\ncharacteristic:{ CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }\n| SQL SECURITY { DEFINER | INVOKER }\n| COMMENT 'string'\n```\n\n - sp_name参数表示存储过程或函数的名称；\n - characteristic参数指定存储函数的特性。\n - CONTAINS SQL表示子程序包含SQL语句，但不包含读或写数据的语句；\n - NO SQL表示子程序中不包含SQL语句；\n - READS SQL DATA表示子程序中包含读数据的语句；\n - MODIFIES SQL DATA表示子程序中包含写数据的语句。\n - SQL SECURITY { DEFINER | INVOKER }指明谁有权限来执行，DEFINER表示只有定义者自己才能够执行；INVOKER表示调用者可以执行。\n - COMMENT 'string'是注释信息。\n\nExample:\n```sql\n#将读写权限改为MODIFIES SQL DATA，并指明调用者可以执行。\nALTER  PROCEDURE  num_from_employee\n  MODIFIES SQL DATA\n  SQL SECURITY INVOKER ;\n#将读写权限改为READS SQL DATA，并加上注释信息'FIND NAME'。\nALTER  PROCEDURE  name_from_employee\n  READS SQL DATA\n  COMMENT 'FIND NAME' ;\n```\n\n#### 1.5.4 删除\n\n&emsp;&emsp;**DROP PROCEDURE [过程1[,过程2…]]**\n&emsp;&emsp;从MySQL的表格中删除一个或多个存储过程。\n \n \n### 1.6 控制语句\n\n#### 1.6.1 条件语句\n\n```sql\n#条件语句IF-THEN-ELSE\nDROP PROCEDURE IF EXISTS proc3;\nDELIMITER //\nCREATE PROCEDURE proc3(IN parameter int)\n  BEGIN\n    DECLARE var int;\n    SET var=parameter+1;\n    IF var=0 THEN\n      INSERT INTO t VALUES (17);\n    END IF ;\n    IF parameter=0 THEN\n      UPDATE t SET s1=s1+1;\n    ELSE\n      UPDATE t SET s1=s1+2;\n    END IF ;\n  END ;\n  //\nDELIMITER ;\n```\n```sql\n#CASE-WHEN-THEN-ELSE语句\nDELIMITER //\n  CREATE PROCEDURE proc4 (IN parameter INT)\n    BEGIN\n      DECLARE var INT;\n      SET var=parameter+1;\n      CASE var\n        WHEN 0 THEN\n          INSERT INTO t VALUES (17);\n        WHEN 1 THEN\n          INSERT INTO t VALUES (18);\n        ELSE\n          INSERT INTO t VALUES (19);\n      END CASE ;\n    END ;\n  //\nDELIMITER ;\n```\n\n#### 1.6.2 循环语句\n\n```sql\n#WHILE-DO…END-WHILE语句\nDELIMITER //\n  CREATE PROCEDURE proc5()\n    BEGIN\n      DECLARE var INT;\n      SET var=0;\n      WHILE var<6 DO\n        INSERT INTO t VALUES (var);\n        SET var=var+1;\n      END WHILE ;\n    END;\n  //\nDELIMITER ;\n```\n\n```sql\n#REPEAT...END REPEAT\n#此语句的特点是执行操作后检查结果\nDELIMITER //\n  CREATE PROCEDURE proc6 ()\n    BEGIN\n      DECLARE v INT;\n      SET v=0;\n      REPEAT\n        INSERT INTO t VALUES(v);\n        SET v=v+1;\n        UNTIL v>=5\n      END REPEAT;\n    END;\n  //\nDELIMITER ;\n```\n\n```sql\n#LOOP...END LOOP\nDELIMITER //\n  CREATE PROCEDURE proc7 ()\n    BEGIN\n      DECLARE v INT;\n      SET v=0;\n      LOOP_LABLE:LOOP\n        INSERT INTO t VALUES(v);\n        SET v=v+1;\n        IF v >=5 THEN\n          LEAVE LOOP_LABLE;\n        END IF;\n      END LOOP;\n    END;\n  //\nDELIMITER ;\n```\n\n**LABLES标号**\n&emsp;&emsp;标号可以用在begin repeat while 或者loop语句前，语句标号只能在合法的语句前面使用。可以跳出循环，使运行指令达到复合语句的最后一步。\n\n#### 1.6.3 迭代\n\n&emsp;&emsp;通过引用复合语句的标号,来从新开始复合语句\n\n```sql\n#ITERATE\nDELIMITER //\n  CREATE PROCEDURE proc8()\n  BEGIN\n    DECLARE v INT;\n    SET v=0;\n    LOOP_LABLE:LOOP\n      IF v=3 THEN\n        SET v=v+1;\n        ITERATE LOOP_LABLE;\n      END IF;\n      INSERT INTO t VALUES(v);\n      SET v=v+1;\n      IF v>=5 THEN\n        LEAVE LOOP_LABLE;\n      END IF;\n    END LOOP;\n  END;\n  //\nDELIMITER ;\n```\n\n## 2. MySQL存储过程的基本函数\n\n### 2.1 字符串类\n```sql\nCHARSET(str) //返回字串字符集\nCONCAT (string2 [,... ]) //连接字串\nINSTR (string ,substring ) //返回substring首次在string中出现的位置,不存在返回0\nLCASE (string2 ) //转换成小写\nLEFT (string2 ,length ) //从string2中的左边起取length个字符\nLENGTH (string ) //string长度\nLOAD_FILE (file_name ) //从文件读取内容\nLOCATE (substring , string [,start_position ] ) 同INSTR,但可指定开始位置\nLPAD (string2 ,length ,pad ) //重复用pad加在string开头,直到字串长度为length\nLTRIM (string2 ) //去除前端空格\nREPEAT (string2 ,count ) //重复count次\nREPLACE (str ,search_str ,replace_str ) //在str中用replace_str替换search_str\nRPAD (string2 ,length ,pad) //在str后用pad补充,直到长度为length\nRTRIM (string2 ) //去除后端空格\nSTRCMP (string1 ,string2 ) //逐字符比较两字串大小,\nSUBSTRING (str , position [,length ]) //从str的position开始,取length个字符,\n注：mysql中处理字符串时，默认第一个字符下标为1，即参数position必须大于等于1\nTRIM([[BOTH|LEADING|TRAILING] [padding] FROM]string2) //去除指定位置的指定字符\nUCASE (string2 ) //转换成大写\nRIGHT(string2,length) //取string2最后length个字符\nSPACE(count) //生成count个空格\n```\n    \n### 2.2 数学类\n\n```sql\nABS (number2 ) //绝对值\nBIN (decimal_number ) //十进制转二进制\nCEILING (number2 ) //向上取整\nCONV(number2,from_base,to_base) //进制转换\nFLOOR (number2 ) //向下取整\nFORMAT (number,decimal_places ) //保留小数位数\nHEX (DecimalNumber ) //转十六进制\n注：HEX()中可传入字符串，则返回其ASC-11码，如HEX('DEF')返回4142143\n也可以传入十进制整数，返回其十六进制编码，如HEX(25)返回19\nLEAST (number , number2 [,..]) //求最小值\nMOD (numerator ,denominator ) //求余\nPOWER (number ,power ) //求指数\nRAND([seed]) //随机数\nROUND (number [,decimals ]) //四舍五入,decimals为小数位数]\nSIGN (number2 ) // 正数返回1，负数返回-1注：返回类型并非均为整数，如：\nSQRT(number2) //开平方\n```\n\n### 2.3 时间类\n\n```sql\nADDTIME (date2 ,time_interval ) //将time_interval加到date2\nCONVERT_TZ (datetime2 ,fromTZ ,toTZ ) //转换时区\nCURRENT_DATE ( ) //当前日期\nCURRENT_TIME ( ) //当前时间\nCURRENT_TIMESTAMP ( ) //当前时间戳\nDATE (datetime ) //返回datetime的日期部分\nDATE_ADD (date2 , INTERVAL d_value d_type ) //在date2中加上日期或时间\nDATE_FORMAT (datetime ,FormatCodes ) //使用formatcodes格式显示datetime\nDATE_SUB (date2 , INTERVAL d_value d_type ) //在date2上减去一个时间\nDATEDIFF (date1 ,date2 ) //两个日期差\nDAY (date ) //返回日期的天\nDAYNAME (date ) //英文星期\nDAYOFWEEK (date ) //星期(1-7) ,1为星期天\nDAYOFYEAR (date ) //一年中的第几天\nEXTRACT (interval_name FROM date ) //从date中提取日期的指定部分\nMAKEDATE (year ,day ) //给出年及年中的第几天,生成日期串\nMAKETIME (hour ,minute ,second ) //生成时间串\nMONTHNAME (date ) //英文月份名\nNOW ( ) //当前时间\nSEC_TO_TIME (seconds ) //秒数转成时间\nSTR_TO_DATE (string ,format ) //字串转成时间,以format格式显示\nTIMEDIFF (datetime1 ,datetime2 ) //两个时间差\nTIME_TO_SEC (time ) //时间转秒数]\nWEEK (date_time [,start_of_week ]) //第几周\nYEAR (datetime ) //年份\nDAYOFMONTH(datetime) //月的第几天\nHOUR(datetime) //小时\nLAST_DAY(date) //date的月的最后日期\nMICROSECOND(datetime) //微秒\nMONTH(datetime) //月\nMINUTE(datetime) //分返回符号,正负或0\n```\n\n \n \n \n\n\n  [1]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201446988-1864698114.png\n  [2]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201448332-1505149268.png\n  [3]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201449535-2004058554.png\n  [4]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201450582-1967285160.png\n  [5]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201451254-1893179304.png\n  [6]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201451910-256935933.png\n  [7]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201452707-1144703374.png\n  [8]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201453520-1437835050.png\n  [9]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201454316-1239511390.png","source":"_posts/Mysql存储过程.md","raw":"---\ntitle: Mysql存储过程\ncategories:\n  - Mysql\ntags:\n  - Mysql\n  - 数据库\nkeyword:\n  - Mysql\n  - 存储过程\ndate: 2017-07-25 13:08:58\n---\n## 1. 存储过程\n\n### 1.1 简介\n\n&emsp;&emsp;普通的sql语句在执行的时候需要先编译再执行，而存储过程（Stored Procedure）是一组为了特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定的存储过程名称并给定参数（如果有的话）来调用执行它。\n&emsp;&emsp;存储过程是可编程的函数，在数据库中创建并保存，可以由SQL语句和控制结构组成。当想要在不同的应用程序或平台上执行相同的函数，或者封装特定功能时，存储过程是非常有用的。数据库中的存储过程可以看做是对编程中面向对象方法的模拟，它允许控制数据的访问方式。\n<!--more-->\n\n### 1.2 优点\n\n 1. 增强SQL语言的功能和灵活性：存储过程可以用流控制语句编写，有很强的灵活性，可以完成复杂的判断和较复杂的运算。\n 2. 标准组件式编程：存储过程被创建后，可以在程序中被多次调用，而不必重新编写该存储过程的SQL语句。而且数据库专业人员可以随时对存储过程进行修改，对应用程序源代码毫无影响。\n 3. 较快的执行速度：如果某一操作包含大量的Transaction-SQL代码或分别被多次执行，那么存储过程要比批处理的执行速度快很多。因为存储过程是预编译的。在首次运行一个存储过程时查询，优化器对其进行分析优化，并且给出最终被存储在系统表中的执行计划。而批处理的Transaction-SQL语句在每次运行时都要进行编译和优化，速度相对要慢一些。\n 4. 减少网络流量：针对同一个数据库对象的操作（如查询、修改），如果这一操作所涉及的Transaction-SQL语句被组织程存储过程，那么当在客户计算机上调用该存储过程时，网络中传送的只是该调用语句，从而大大增加了网络流量并降低了网络负载。\n 5. 安全机制：通过对执行某一存储过程的权限进行限制，能够实现对相应的数据的访问权限的限制，避免了非授权用户对数据的访问，保证了数据的安全。\n\n### 1.3 存储过程创建\n\n#### 1.3.1 语法\n**CREATE PROCEDURE  过程名([[IN|OUT|INOUT] 参数名 数据类型[,[IN|OUT|INOUT] 参数名 数据类型…]]) [特性 ...] 过程体**\n\n```sql\nDELIMITER //\n  CREATE PROCEDURE myproc(OUT s int)\n    BEGIN\n      SELECT COUNT(*) INTO s FROM students;\n    END\n    //\nDELIMITER ;\n```\n\n#### 1.3.2 分隔符\n\n&emsp;&emsp;MySQL默认以\";\"为分隔符，如果没有声明分割符，则编译器会把存储过程当成SQL语句进行处理，因此编译过程会报错，所以要事先用“DELIMITER //”声明当前段分隔符，让编译器把两个\"//\"之间的内容当做存储过程的代码，不会执行这些代码；“DELIMITER ;”的意为把分隔符还原。\n\n#### 1.3.3 参数\n\n&emsp;&emsp;存储过程根据需要可能会有输入、输出、输入输出参数，如果有多个参数用\",\"分割开。MySQL存储过程的参数用在存储过程的定义，共有三种参数类型,IN,OUT,INOUT:\n\n - IN:参数的值必须在调用存储过程时指定，在存储过程中修改该参数的值不能被返回，为默认值.\n - OUT:值可在存储过程内部被改变，并可返回.\n - INOUT:调用时指定，并且可被改变和返回.\n \n#### 2.3.4 过程体\n\n&emsp;&emsp;过程体的开始与结束使用BEGIN与END进行标识。\n\n### 1.4 变量\n\n#### 1.4.1 声明变量\n\n&emsp;&emsp;**DECLARE 变量名1[,变量名2...] 数据类型 [默认值];**\n\n#### 1.4.2 数值类型\n\n&emsp;&emsp;数据类型为MySQL的数据类型\n\n 1. 数值类型!\n     ![此处输入图片的描述][1]\n 2. 日期和时间类型!\n    ![此处输入图片的描述][2]\n 3. 字符串类型!\n    ![此处输入图片的描述][3]\n\n#### 1.4.3 变量赋值\n\n&emsp;&emsp;**SET 变量名 = 变量值 [,变量名= 变量值 ...]**\n\n#### 1.4.4 用户变量\n\n&emsp;&emsp;用户变量一般以@开头。\n&emsp;&emsp;注意：滥用用户变量会导致程序难以理解及管理\n```sql\nSELECT 'Hello World' into @x;\nSELECT @x;\n\nSET @y='Goodbye Cruel World';\nSELECT @y;\nSET @z=1+2+3;\nSELECT @z;\n```\n执行结果:\n![此处输入图片的描述][4]\n![此处输入图片的描述][5]\n![此处输入图片的描述][6]\n\n - 在存储过程中使用用户变量\n    \n    ```sql\n    CREATE PROCEDURE GreetWorld() SELECT CONCAT(@greeting,' World');\n    SET @greeting='Hello';\n    CALL GreetWorld();\n    ```\n    \n    执行结果:\n    ![此处输入图片的描述][7]\n    \n - 在存储过程间传递全局范围的用户变量\n\n    ```sql\n    CREATE PROCEDURE p1() SET @last_proc='p1';\n    CREATE PROCEDURE p2() SELECT CONCAT('Last procedure was ',@last_proc);\n    CALL p1();\n    CALL p2();\n    ```\n    \n    执行结果:\n    ![此处输入图片的描述][8]\n    \n#### 1.4.5 变量作用域\n\n&emsp;&emsp;内部变量在其作用域范围内享有更高的优先权，当执行到end时，内部变量消失，不再可见了，在存储过程外再也找不到这个内部变量，但是可以通过out参数或者将其值指派给会话变量来保存其值。\n\n```sql\n#变量作用域\nDELIMITER //\n  CREATE PROCEDURE proc()\n    BEGIN\n      DECLARE x1 VARCHAR(5) DEFAULT 'outer';\n        BEGIN\n          DECLARE x1 VARCHAR(5) DEFAULT 'inner';\n          SELECT x1;\n        END;\n      SELECT x1;\n    END;\n    //\nDELIMITER ;\n#调用\nCALL proc();\n```\n\n执行结果：\n```sql\ninner  outer\n```\n    \n### 1.5 存储过程的CRUD\n\n#### 1.5.1 调用\n&emsp;&emsp;用call和你过程名以及一个括号，括号里面根据需要，加入参数，参数包括输入参数、输出参数、输入输出参数。\n\n#### 1.5.2 查询\n\n```sql\n#查询存储过程\nSELECT name FROM mysql.proc WHERE db='数据库名';\nSELECT routine_name FROM information_schema.routines WHERE routine_schema='数据库名';\nSHOW PROCEDURE STATUS WHERE db='数据库名';\n\n#查看存储过程详细信息\nSHOW CREATE PROCEDURE 数据库.存储过程名;\n```\n\n#### 1.5.3 修改\n\n&emsp;&emsp;**ALTER PROCEDURE 更改用CREATE PROCEDURE 建立的预先指定的存储过程，其不会影响相关存储过程或存储功能。**\n\n```sql\nALTER {PROCEDURE | FUNCTION} sp_name [characteristic ...]\ncharacteristic:{ CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }\n| SQL SECURITY { DEFINER | INVOKER }\n| COMMENT 'string'\n```\n\n - sp_name参数表示存储过程或函数的名称；\n - characteristic参数指定存储函数的特性。\n - CONTAINS SQL表示子程序包含SQL语句，但不包含读或写数据的语句；\n - NO SQL表示子程序中不包含SQL语句；\n - READS SQL DATA表示子程序中包含读数据的语句；\n - MODIFIES SQL DATA表示子程序中包含写数据的语句。\n - SQL SECURITY { DEFINER | INVOKER }指明谁有权限来执行，DEFINER表示只有定义者自己才能够执行；INVOKER表示调用者可以执行。\n - COMMENT 'string'是注释信息。\n\nExample:\n```sql\n#将读写权限改为MODIFIES SQL DATA，并指明调用者可以执行。\nALTER  PROCEDURE  num_from_employee\n  MODIFIES SQL DATA\n  SQL SECURITY INVOKER ;\n#将读写权限改为READS SQL DATA，并加上注释信息'FIND NAME'。\nALTER  PROCEDURE  name_from_employee\n  READS SQL DATA\n  COMMENT 'FIND NAME' ;\n```\n\n#### 1.5.4 删除\n\n&emsp;&emsp;**DROP PROCEDURE [过程1[,过程2…]]**\n&emsp;&emsp;从MySQL的表格中删除一个或多个存储过程。\n \n \n### 1.6 控制语句\n\n#### 1.6.1 条件语句\n\n```sql\n#条件语句IF-THEN-ELSE\nDROP PROCEDURE IF EXISTS proc3;\nDELIMITER //\nCREATE PROCEDURE proc3(IN parameter int)\n  BEGIN\n    DECLARE var int;\n    SET var=parameter+1;\n    IF var=0 THEN\n      INSERT INTO t VALUES (17);\n    END IF ;\n    IF parameter=0 THEN\n      UPDATE t SET s1=s1+1;\n    ELSE\n      UPDATE t SET s1=s1+2;\n    END IF ;\n  END ;\n  //\nDELIMITER ;\n```\n```sql\n#CASE-WHEN-THEN-ELSE语句\nDELIMITER //\n  CREATE PROCEDURE proc4 (IN parameter INT)\n    BEGIN\n      DECLARE var INT;\n      SET var=parameter+1;\n      CASE var\n        WHEN 0 THEN\n          INSERT INTO t VALUES (17);\n        WHEN 1 THEN\n          INSERT INTO t VALUES (18);\n        ELSE\n          INSERT INTO t VALUES (19);\n      END CASE ;\n    END ;\n  //\nDELIMITER ;\n```\n\n#### 1.6.2 循环语句\n\n```sql\n#WHILE-DO…END-WHILE语句\nDELIMITER //\n  CREATE PROCEDURE proc5()\n    BEGIN\n      DECLARE var INT;\n      SET var=0;\n      WHILE var<6 DO\n        INSERT INTO t VALUES (var);\n        SET var=var+1;\n      END WHILE ;\n    END;\n  //\nDELIMITER ;\n```\n\n```sql\n#REPEAT...END REPEAT\n#此语句的特点是执行操作后检查结果\nDELIMITER //\n  CREATE PROCEDURE proc6 ()\n    BEGIN\n      DECLARE v INT;\n      SET v=0;\n      REPEAT\n        INSERT INTO t VALUES(v);\n        SET v=v+1;\n        UNTIL v>=5\n      END REPEAT;\n    END;\n  //\nDELIMITER ;\n```\n\n```sql\n#LOOP...END LOOP\nDELIMITER //\n  CREATE PROCEDURE proc7 ()\n    BEGIN\n      DECLARE v INT;\n      SET v=0;\n      LOOP_LABLE:LOOP\n        INSERT INTO t VALUES(v);\n        SET v=v+1;\n        IF v >=5 THEN\n          LEAVE LOOP_LABLE;\n        END IF;\n      END LOOP;\n    END;\n  //\nDELIMITER ;\n```\n\n**LABLES标号**\n&emsp;&emsp;标号可以用在begin repeat while 或者loop语句前，语句标号只能在合法的语句前面使用。可以跳出循环，使运行指令达到复合语句的最后一步。\n\n#### 1.6.3 迭代\n\n&emsp;&emsp;通过引用复合语句的标号,来从新开始复合语句\n\n```sql\n#ITERATE\nDELIMITER //\n  CREATE PROCEDURE proc8()\n  BEGIN\n    DECLARE v INT;\n    SET v=0;\n    LOOP_LABLE:LOOP\n      IF v=3 THEN\n        SET v=v+1;\n        ITERATE LOOP_LABLE;\n      END IF;\n      INSERT INTO t VALUES(v);\n      SET v=v+1;\n      IF v>=5 THEN\n        LEAVE LOOP_LABLE;\n      END IF;\n    END LOOP;\n  END;\n  //\nDELIMITER ;\n```\n\n## 2. MySQL存储过程的基本函数\n\n### 2.1 字符串类\n```sql\nCHARSET(str) //返回字串字符集\nCONCAT (string2 [,... ]) //连接字串\nINSTR (string ,substring ) //返回substring首次在string中出现的位置,不存在返回0\nLCASE (string2 ) //转换成小写\nLEFT (string2 ,length ) //从string2中的左边起取length个字符\nLENGTH (string ) //string长度\nLOAD_FILE (file_name ) //从文件读取内容\nLOCATE (substring , string [,start_position ] ) 同INSTR,但可指定开始位置\nLPAD (string2 ,length ,pad ) //重复用pad加在string开头,直到字串长度为length\nLTRIM (string2 ) //去除前端空格\nREPEAT (string2 ,count ) //重复count次\nREPLACE (str ,search_str ,replace_str ) //在str中用replace_str替换search_str\nRPAD (string2 ,length ,pad) //在str后用pad补充,直到长度为length\nRTRIM (string2 ) //去除后端空格\nSTRCMP (string1 ,string2 ) //逐字符比较两字串大小,\nSUBSTRING (str , position [,length ]) //从str的position开始,取length个字符,\n注：mysql中处理字符串时，默认第一个字符下标为1，即参数position必须大于等于1\nTRIM([[BOTH|LEADING|TRAILING] [padding] FROM]string2) //去除指定位置的指定字符\nUCASE (string2 ) //转换成大写\nRIGHT(string2,length) //取string2最后length个字符\nSPACE(count) //生成count个空格\n```\n    \n### 2.2 数学类\n\n```sql\nABS (number2 ) //绝对值\nBIN (decimal_number ) //十进制转二进制\nCEILING (number2 ) //向上取整\nCONV(number2,from_base,to_base) //进制转换\nFLOOR (number2 ) //向下取整\nFORMAT (number,decimal_places ) //保留小数位数\nHEX (DecimalNumber ) //转十六进制\n注：HEX()中可传入字符串，则返回其ASC-11码，如HEX('DEF')返回4142143\n也可以传入十进制整数，返回其十六进制编码，如HEX(25)返回19\nLEAST (number , number2 [,..]) //求最小值\nMOD (numerator ,denominator ) //求余\nPOWER (number ,power ) //求指数\nRAND([seed]) //随机数\nROUND (number [,decimals ]) //四舍五入,decimals为小数位数]\nSIGN (number2 ) // 正数返回1，负数返回-1注：返回类型并非均为整数，如：\nSQRT(number2) //开平方\n```\n\n### 2.3 时间类\n\n```sql\nADDTIME (date2 ,time_interval ) //将time_interval加到date2\nCONVERT_TZ (datetime2 ,fromTZ ,toTZ ) //转换时区\nCURRENT_DATE ( ) //当前日期\nCURRENT_TIME ( ) //当前时间\nCURRENT_TIMESTAMP ( ) //当前时间戳\nDATE (datetime ) //返回datetime的日期部分\nDATE_ADD (date2 , INTERVAL d_value d_type ) //在date2中加上日期或时间\nDATE_FORMAT (datetime ,FormatCodes ) //使用formatcodes格式显示datetime\nDATE_SUB (date2 , INTERVAL d_value d_type ) //在date2上减去一个时间\nDATEDIFF (date1 ,date2 ) //两个日期差\nDAY (date ) //返回日期的天\nDAYNAME (date ) //英文星期\nDAYOFWEEK (date ) //星期(1-7) ,1为星期天\nDAYOFYEAR (date ) //一年中的第几天\nEXTRACT (interval_name FROM date ) //从date中提取日期的指定部分\nMAKEDATE (year ,day ) //给出年及年中的第几天,生成日期串\nMAKETIME (hour ,minute ,second ) //生成时间串\nMONTHNAME (date ) //英文月份名\nNOW ( ) //当前时间\nSEC_TO_TIME (seconds ) //秒数转成时间\nSTR_TO_DATE (string ,format ) //字串转成时间,以format格式显示\nTIMEDIFF (datetime1 ,datetime2 ) //两个时间差\nTIME_TO_SEC (time ) //时间转秒数]\nWEEK (date_time [,start_of_week ]) //第几周\nYEAR (datetime ) //年份\nDAYOFMONTH(datetime) //月的第几天\nHOUR(datetime) //小时\nLAST_DAY(date) //date的月的最后日期\nMICROSECOND(datetime) //微秒\nMONTH(datetime) //月\nMINUTE(datetime) //分返回符号,正负或0\n```\n\n \n \n \n\n\n  [1]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201446988-1864698114.png\n  [2]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201448332-1505149268.png\n  [3]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201449535-2004058554.png\n  [4]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201450582-1967285160.png\n  [5]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201451254-1893179304.png\n  [6]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201451910-256935933.png\n  [7]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201452707-1144703374.png\n  [8]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201453520-1437835050.png\n  [9]: http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201454316-1239511390.png","slug":"Mysql存储过程","published":1,"updated":"2018-04-11T03:32:47.138Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qft3001chwvffn6emk6i","content":"<h2 id=\"1-存储过程\"><a href=\"#1-存储过程\" class=\"headerlink\" title=\"1. 存储过程\"></a>1. 存储过程</h2><h3 id=\"1-1-简介\"><a href=\"#1-1-简介\" class=\"headerlink\" title=\"1.1 简介\"></a>1.1 简介</h3><p>&emsp;&emsp;普通的sql语句在执行的时候需要先编译再执行，而存储过程（Stored Procedure）是一组为了特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定的存储过程名称并给定参数（如果有的话）来调用执行它。<br>&emsp;&emsp;存储过程是可编程的函数，在数据库中创建并保存，可以由SQL语句和控制结构组成。当想要在不同的应用程序或平台上执行相同的函数，或者封装特定功能时，存储过程是非常有用的。数据库中的存储过程可以看做是对编程中面向对象方法的模拟，它允许控制数据的访问方式。<br><a id=\"more\"></a></p>\n<h3 id=\"1-2-优点\"><a href=\"#1-2-优点\" class=\"headerlink\" title=\"1.2 优点\"></a>1.2 优点</h3><ol>\n<li>增强SQL语言的功能和灵活性：存储过程可以用流控制语句编写，有很强的灵活性，可以完成复杂的判断和较复杂的运算。</li>\n<li>标准组件式编程：存储过程被创建后，可以在程序中被多次调用，而不必重新编写该存储过程的SQL语句。而且数据库专业人员可以随时对存储过程进行修改，对应用程序源代码毫无影响。</li>\n<li>较快的执行速度：如果某一操作包含大量的Transaction-SQL代码或分别被多次执行，那么存储过程要比批处理的执行速度快很多。因为存储过程是预编译的。在首次运行一个存储过程时查询，优化器对其进行分析优化，并且给出最终被存储在系统表中的执行计划。而批处理的Transaction-SQL语句在每次运行时都要进行编译和优化，速度相对要慢一些。</li>\n<li>减少网络流量：针对同一个数据库对象的操作（如查询、修改），如果这一操作所涉及的Transaction-SQL语句被组织程存储过程，那么当在客户计算机上调用该存储过程时，网络中传送的只是该调用语句，从而大大增加了网络流量并降低了网络负载。</li>\n<li>安全机制：通过对执行某一存储过程的权限进行限制，能够实现对相应的数据的访问权限的限制，避免了非授权用户对数据的访问，保证了数据的安全。</li>\n</ol>\n<h3 id=\"1-3-存储过程创建\"><a href=\"#1-3-存储过程创建\" class=\"headerlink\" title=\"1.3 存储过程创建\"></a>1.3 存储过程创建</h3><h4 id=\"1-3-1-语法\"><a href=\"#1-3-1-语法\" class=\"headerlink\" title=\"1.3.1 语法\"></a>1.3.1 语法</h4><p><strong>CREATE PROCEDURE  过程名([[IN|OUT|INOUT] 参数名 数据类型[,[IN|OUT|INOUT] 参数名 数据类型…]]) [特性 …] 过程体</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">DELIMITER //</div><div class=\"line\">  <span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> myproc(<span class=\"keyword\">OUT</span> s <span class=\"built_in\">int</span>)</div><div class=\"line\">    <span class=\"keyword\">BEGIN</span></div><div class=\"line\">      <span class=\"keyword\">SELECT</span> <span class=\"keyword\">COUNT</span>(*) <span class=\"keyword\">INTO</span> s <span class=\"keyword\">FROM</span> students;</div><div class=\"line\">    <span class=\"keyword\">END</span></div><div class=\"line\">    //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<h4 id=\"1-3-2-分隔符\"><a href=\"#1-3-2-分隔符\" class=\"headerlink\" title=\"1.3.2 分隔符\"></a>1.3.2 分隔符</h4><p>&emsp;&emsp;MySQL默认以”;”为分隔符，如果没有声明分割符，则编译器会把存储过程当成SQL语句进行处理，因此编译过程会报错，所以要事先用“DELIMITER //”声明当前段分隔符，让编译器把两个”//“之间的内容当做存储过程的代码，不会执行这些代码；“DELIMITER ;”的意为把分隔符还原。</p>\n<h4 id=\"1-3-3-参数\"><a href=\"#1-3-3-参数\" class=\"headerlink\" title=\"1.3.3 参数\"></a>1.3.3 参数</h4><p>&emsp;&emsp;存储过程根据需要可能会有输入、输出、输入输出参数，如果有多个参数用”,”分割开。MySQL存储过程的参数用在存储过程的定义，共有三种参数类型,IN,OUT,INOUT:</p>\n<ul>\n<li>IN:参数的值必须在调用存储过程时指定，在存储过程中修改该参数的值不能被返回，为默认值.</li>\n<li>OUT:值可在存储过程内部被改变，并可返回.</li>\n<li>INOUT:调用时指定，并且可被改变和返回.</li>\n</ul>\n<h4 id=\"2-3-4-过程体\"><a href=\"#2-3-4-过程体\" class=\"headerlink\" title=\"2.3.4 过程体\"></a>2.3.4 过程体</h4><p>&emsp;&emsp;过程体的开始与结束使用BEGIN与END进行标识。</p>\n<h3 id=\"1-4-变量\"><a href=\"#1-4-变量\" class=\"headerlink\" title=\"1.4 变量\"></a>1.4 变量</h3><h4 id=\"1-4-1-声明变量\"><a href=\"#1-4-1-声明变量\" class=\"headerlink\" title=\"1.4.1 声明变量\"></a>1.4.1 声明变量</h4><p>&emsp;&emsp;<strong>DECLARE 变量名1[,变量名2…] 数据类型 [默认值];</strong></p>\n<h4 id=\"1-4-2-数值类型\"><a href=\"#1-4-2-数值类型\" class=\"headerlink\" title=\"1.4.2 数值类型\"></a>1.4.2 数值类型</h4><p>&emsp;&emsp;数据类型为MySQL的数据类型</p>\n<ol>\n<li>数值类型!<br> <img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201446988-1864698114.png\" alt=\"此处输入图片的描述\"></li>\n<li>日期和时间类型!<br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201448332-1505149268.png\" alt=\"此处输入图片的描述\"></li>\n<li>字符串类型!<br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201449535-2004058554.png\" alt=\"此处输入图片的描述\"></li>\n</ol>\n<h4 id=\"1-4-3-变量赋值\"><a href=\"#1-4-3-变量赋值\" class=\"headerlink\" title=\"1.4.3 变量赋值\"></a>1.4.3 变量赋值</h4><p>&emsp;&emsp;<strong>SET 变量名 = 变量值 [,变量名= 变量值 …]</strong></p>\n<h4 id=\"1-4-4-用户变量\"><a href=\"#1-4-4-用户变量\" class=\"headerlink\" title=\"1.4.4 用户变量\"></a>1.4.4 用户变量</h4><p>&emsp;&emsp;用户变量一般以@开头。<br>&emsp;&emsp;注意：滥用用户变量会导致程序难以理解及管理<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"string\">'Hello World'</span> <span class=\"keyword\">into</span> @x;</div><div class=\"line\"><span class=\"keyword\">SELECT</span> @x;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">SET</span> @y=<span class=\"string\">'Goodbye Cruel World'</span>;</div><div class=\"line\"><span class=\"keyword\">SELECT</span> @y;</div><div class=\"line\"><span class=\"keyword\">SET</span> @z=<span class=\"number\">1</span>+<span class=\"number\">2</span>+<span class=\"number\">3</span>;</div><div class=\"line\"><span class=\"keyword\">SELECT</span> @z;</div></pre></td></tr></table></figure></p>\n<p>执行结果:<br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201450582-1967285160.png\" alt=\"此处输入图片的描述\"><br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201451254-1893179304.png\" alt=\"此处输入图片的描述\"><br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201451910-256935933.png\" alt=\"此处输入图片的描述\"></p>\n<ul>\n<li><p>在存储过程中使用用户变量</p>\n <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> GreetWorld() <span class=\"keyword\">SELECT</span> <span class=\"keyword\">CONCAT</span>(@greeting,<span class=\"string\">' World'</span>);</div><div class=\"line\"><span class=\"keyword\">SET</span> @greeting=<span class=\"string\">'Hello'</span>;</div><div class=\"line\"><span class=\"keyword\">CALL</span> GreetWorld();</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<pre><code>执行结果:\n![此处输入图片的描述][7]\n</code></pre><ul>\n<li><p>在存储过程间传递全局范围的用户变量</p>\n <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> p1() <span class=\"keyword\">SET</span> @last_proc=<span class=\"string\">'p1'</span>;</div><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> p2() <span class=\"keyword\">SELECT</span> <span class=\"keyword\">CONCAT</span>(<span class=\"string\">'Last procedure was '</span>,@last_proc);</div><div class=\"line\"><span class=\"keyword\">CALL</span> p1();</div><div class=\"line\"><span class=\"keyword\">CALL</span> p2();</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<pre><code>执行结果:\n![此处输入图片的描述][8]\n</code></pre><h4 id=\"1-4-5-变量作用域\"><a href=\"#1-4-5-变量作用域\" class=\"headerlink\" title=\"1.4.5 变量作用域\"></a>1.4.5 变量作用域</h4><p>&emsp;&emsp;内部变量在其作用域范围内享有更高的优先权，当执行到end时，内部变量消失，不再可见了，在存储过程外再也找不到这个内部变量，但是可以通过out参数或者将其值指派给会话变量来保存其值。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">#变量作用域</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc()</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE x1 VARCHAR(5) DEFAULT 'outer';</div><div class=\"line\">        BEGIN</div><div class=\"line\">          DECLARE x1 VARCHAR(5) DEFAULT 'inner';</div><div class=\"line\">          SELECT x1;</div><div class=\"line\">        END;</div><div class=\"line\">      SELECT x1;</div><div class=\"line\">    END;</div><div class=\"line\">    //</div><div class=\"line\">DELIMITER ;</div><div class=\"line\">#调用</div><div class=\"line\">CALL proc();</div></pre></td></tr></table></figure>\n<p>执行结果：<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">inner  outer</div></pre></td></tr></table></figure></p>\n<h3 id=\"1-5-存储过程的CRUD\"><a href=\"#1-5-存储过程的CRUD\" class=\"headerlink\" title=\"1.5 存储过程的CRUD\"></a>1.5 存储过程的CRUD</h3><h4 id=\"1-5-1-调用\"><a href=\"#1-5-1-调用\" class=\"headerlink\" title=\"1.5.1 调用\"></a>1.5.1 调用</h4><p>&emsp;&emsp;用call和你过程名以及一个括号，括号里面根据需要，加入参数，参数包括输入参数、输出参数、输入输出参数。</p>\n<h4 id=\"1-5-2-查询\"><a href=\"#1-5-2-查询\" class=\"headerlink\" title=\"1.5.2 查询\"></a>1.5.2 查询</h4><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">#查询存储过程</div><div class=\"line\">SELECT name FROM mysql.proc WHERE db='数据库名';</div><div class=\"line\">SELECT routine_name FROM information_schema.routines WHERE routine_schema='数据库名';</div><div class=\"line\">SHOW PROCEDURE STATUS WHERE db='数据库名';</div><div class=\"line\"></div><div class=\"line\">#查看存储过程详细信息</div><div class=\"line\">SHOW CREATE PROCEDURE 数据库.存储过程名;</div></pre></td></tr></table></figure>\n<h4 id=\"1-5-3-修改\"><a href=\"#1-5-3-修改\" class=\"headerlink\" title=\"1.5.3 修改\"></a>1.5.3 修改</h4><p>&emsp;&emsp;<strong>ALTER PROCEDURE 更改用CREATE PROCEDURE 建立的预先指定的存储过程，其不会影响相关存储过程或存储功能。</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">ALTER</span> &#123;<span class=\"keyword\">PROCEDURE</span> | <span class=\"keyword\">FUNCTION</span>&#125; sp_name [characteristic ...]</div><div class=\"line\">characteristic:&#123; CONTAINS <span class=\"keyword\">SQL</span> | <span class=\"keyword\">NO</span> <span class=\"keyword\">SQL</span> | <span class=\"keyword\">READS</span> <span class=\"keyword\">SQL</span> <span class=\"keyword\">DATA</span> | MODIFIES <span class=\"keyword\">SQL</span> <span class=\"keyword\">DATA</span> &#125;</div><div class=\"line\">| <span class=\"keyword\">SQL</span> <span class=\"keyword\">SECURITY</span> &#123; DEFINER | INVOKER &#125;</div><div class=\"line\">| <span class=\"keyword\">COMMENT</span> <span class=\"string\">'string'</span></div></pre></td></tr></table></figure>\n<ul>\n<li>sp_name参数表示存储过程或函数的名称；</li>\n<li>characteristic参数指定存储函数的特性。</li>\n<li>CONTAINS SQL表示子程序包含SQL语句，但不包含读或写数据的语句；</li>\n<li>NO SQL表示子程序中不包含SQL语句；</li>\n<li>READS SQL DATA表示子程序中包含读数据的语句；</li>\n<li>MODIFIES SQL DATA表示子程序中包含写数据的语句。</li>\n<li>SQL SECURITY { DEFINER | INVOKER }指明谁有权限来执行，DEFINER表示只有定义者自己才能够执行；INVOKER表示调用者可以执行。</li>\n<li>COMMENT ‘string’是注释信息。</li>\n</ul>\n<p>Example:<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">#将读写权限改为MODIFIES SQL DATA，并指明调用者可以执行。</div><div class=\"line\">ALTER  PROCEDURE  num_from_employee</div><div class=\"line\">  MODIFIES SQL DATA</div><div class=\"line\">  SQL SECURITY INVOKER ;</div><div class=\"line\">#将读写权限改为READS SQL DATA，并加上注释信息'FIND NAME'。</div><div class=\"line\">ALTER  PROCEDURE  name_from_employee</div><div class=\"line\">  READS SQL DATA</div><div class=\"line\">  COMMENT 'FIND NAME' ;</div></pre></td></tr></table></figure></p>\n<h4 id=\"1-5-4-删除\"><a href=\"#1-5-4-删除\" class=\"headerlink\" title=\"1.5.4 删除\"></a>1.5.4 删除</h4><p>&emsp;&emsp;<strong>DROP PROCEDURE [过程1[,过程2…]]</strong><br>&emsp;&emsp;从MySQL的表格中删除一个或多个存储过程。</p>\n<h3 id=\"1-6-控制语句\"><a href=\"#1-6-控制语句\" class=\"headerlink\" title=\"1.6 控制语句\"></a>1.6 控制语句</h3><h4 id=\"1-6-1-条件语句\"><a href=\"#1-6-1-条件语句\" class=\"headerlink\" title=\"1.6.1 条件语句\"></a>1.6.1 条件语句</h4><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">#条件语句IF-THEN-ELSE</div><div class=\"line\">DROP PROCEDURE IF EXISTS proc3;</div><div class=\"line\">DELIMITER //</div><div class=\"line\">CREATE PROCEDURE proc3(IN parameter int)</div><div class=\"line\">  BEGIN</div><div class=\"line\">    DECLARE var int;</div><div class=\"line\">    SET var=parameter+1;</div><div class=\"line\">    IF var=0 THEN</div><div class=\"line\">      INSERT INTO t VALUES (17);</div><div class=\"line\">    END IF ;</div><div class=\"line\">    IF parameter=0 THEN</div><div class=\"line\">      UPDATE t SET s1=s1+1;</div><div class=\"line\">    ELSE</div><div class=\"line\">      UPDATE t SET s1=s1+2;</div><div class=\"line\">    END IF ;</div><div class=\"line\">  END ;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">#CASE-WHEN-THEN-ELSE语句</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc4 (IN parameter INT)</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE var INT;</div><div class=\"line\">      SET var=parameter+1;</div><div class=\"line\">      CASE var</div><div class=\"line\">        WHEN 0 THEN</div><div class=\"line\">          INSERT INTO t VALUES (17);</div><div class=\"line\">        WHEN 1 THEN</div><div class=\"line\">          INSERT INTO t VALUES (18);</div><div class=\"line\">        ELSE</div><div class=\"line\">          INSERT INTO t VALUES (19);</div><div class=\"line\">      END CASE ;</div><div class=\"line\">    END ;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<h4 id=\"1-6-2-循环语句\"><a href=\"#1-6-2-循环语句\" class=\"headerlink\" title=\"1.6.2 循环语句\"></a>1.6.2 循环语句</h4><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">#WHILE-DO…END-WHILE语句</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc5()</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE var INT;</div><div class=\"line\">      SET var=0;</div><div class=\"line\">      WHILE var&lt;6 DO</div><div class=\"line\">        INSERT INTO t VALUES (var);</div><div class=\"line\">        SET var=var+1;</div><div class=\"line\">      END WHILE ;</div><div class=\"line\">    END;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">#REPEAT...END REPEAT</div><div class=\"line\">#此语句的特点是执行操作后检查结果</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc6 ()</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE v INT;</div><div class=\"line\">      SET v=0;</div><div class=\"line\">      REPEAT</div><div class=\"line\">        INSERT INTO t VALUES(v);</div><div class=\"line\">        SET v=v+1;</div><div class=\"line\">        UNTIL v&gt;=5</div><div class=\"line\">      END REPEAT;</div><div class=\"line\">    END;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">#LOOP...END LOOP</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc7 ()</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE v INT;</div><div class=\"line\">      SET v=0;</div><div class=\"line\">      LOOP_LABLE:LOOP</div><div class=\"line\">        INSERT INTO t VALUES(v);</div><div class=\"line\">        SET v=v+1;</div><div class=\"line\">        IF v &gt;=5 THEN</div><div class=\"line\">          LEAVE LOOP_LABLE;</div><div class=\"line\">        END IF;</div><div class=\"line\">      END LOOP;</div><div class=\"line\">    END;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<p><strong>LABLES标号</strong><br>&emsp;&emsp;标号可以用在begin repeat while 或者loop语句前，语句标号只能在合法的语句前面使用。可以跳出循环，使运行指令达到复合语句的最后一步。</p>\n<h4 id=\"1-6-3-迭代\"><a href=\"#1-6-3-迭代\" class=\"headerlink\" title=\"1.6.3 迭代\"></a>1.6.3 迭代</h4><p>&emsp;&emsp;通过引用复合语句的标号,来从新开始复合语句</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">#ITERATE</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc8()</div><div class=\"line\">  BEGIN</div><div class=\"line\">    DECLARE v INT;</div><div class=\"line\">    SET v=0;</div><div class=\"line\">    LOOP_LABLE:LOOP</div><div class=\"line\">      IF v=3 THEN</div><div class=\"line\">        SET v=v+1;</div><div class=\"line\">        ITERATE LOOP_LABLE;</div><div class=\"line\">      END IF;</div><div class=\"line\">      INSERT INTO t VALUES(v);</div><div class=\"line\">      SET v=v+1;</div><div class=\"line\">      IF v&gt;=5 THEN</div><div class=\"line\">        LEAVE LOOP_LABLE;</div><div class=\"line\">      END IF;</div><div class=\"line\">    END LOOP;</div><div class=\"line\">  END;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<h2 id=\"2-MySQL存储过程的基本函数\"><a href=\"#2-MySQL存储过程的基本函数\" class=\"headerlink\" title=\"2. MySQL存储过程的基本函数\"></a>2. MySQL存储过程的基本函数</h2><h3 id=\"2-1-字符串类\"><a href=\"#2-1-字符串类\" class=\"headerlink\" title=\"2.1 字符串类\"></a>2.1 字符串类</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\">CHARSET(str) //返回字串字符集</div><div class=\"line\">CONCAT (string2 [,... ]) //连接字串</div><div class=\"line\">INSTR (string ,substring ) //返回substring首次在string中出现的位置,不存在返回0</div><div class=\"line\">LCASE (string2 ) //转换成小写</div><div class=\"line\">LEFT (string2 ,length ) //从string2中的左边起取length个字符</div><div class=\"line\">LENGTH (string ) //string长度</div><div class=\"line\">LOAD_FILE (file_name ) //从文件读取内容</div><div class=\"line\">LOCATE (substring , string [,start_position ] ) 同INSTR,但可指定开始位置</div><div class=\"line\">LPAD (string2 ,length ,pad ) //重复用pad加在string开头,直到字串长度为length</div><div class=\"line\">LTRIM (string2 ) //去除前端空格</div><div class=\"line\">REPEAT (string2 ,count ) //重复count次</div><div class=\"line\"><span class=\"keyword\">REPLACE</span> (<span class=\"keyword\">str</span> ,search_str ,replace_str ) //在<span class=\"keyword\">str</span>中用replace_str替换search_str</div><div class=\"line\">RPAD (string2 ,<span class=\"keyword\">length</span> ,<span class=\"keyword\">pad</span>) //在<span class=\"keyword\">str</span>后用<span class=\"keyword\">pad</span>补充,直到长度为<span class=\"keyword\">length</span></div><div class=\"line\"><span class=\"keyword\">RTRIM</span> (string2 ) //去除后端空格</div><div class=\"line\"><span class=\"keyword\">STRCMP</span> (string1 ,string2 ) //逐字符比较两字串大小,</div><div class=\"line\"><span class=\"keyword\">SUBSTRING</span> (<span class=\"keyword\">str</span> , <span class=\"keyword\">position</span> [,<span class=\"keyword\">length</span> ]) //从<span class=\"keyword\">str</span>的<span class=\"keyword\">position</span>开始,取<span class=\"keyword\">length</span>个字符,</div><div class=\"line\">注：mysql中处理字符串时，默认第一个字符下标为<span class=\"number\">1</span>，即参数<span class=\"keyword\">position</span>必须大于等于<span class=\"number\">1</span></div><div class=\"line\"><span class=\"keyword\">TRIM</span>([[<span class=\"keyword\">BOTH</span>|<span class=\"keyword\">LEADING</span>|TRAILING] [padding] <span class=\"keyword\">FROM</span>]string2) //去除指定位置的指定字符</div><div class=\"line\"><span class=\"keyword\">UCASE</span> (string2 ) //转换成大写</div><div class=\"line\"><span class=\"keyword\">RIGHT</span>(string2,<span class=\"keyword\">length</span>) //取string2最后<span class=\"keyword\">length</span>个字符</div><div class=\"line\"><span class=\"keyword\">SPACE</span>(<span class=\"keyword\">count</span>) //生成<span class=\"keyword\">count</span>个空格</div></pre></td></tr></table></figure>\n<h3 id=\"2-2-数学类\"><a href=\"#2-2-数学类\" class=\"headerlink\" title=\"2.2 数学类\"></a>2.2 数学类</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">ABS (number2 ) //绝对值</div><div class=\"line\">BIN (decimal_number ) //十进制转二进制</div><div class=\"line\">CEILING (number2 ) //向上取整</div><div class=\"line\">CONV(number2,from_base,to_base) //进制转换</div><div class=\"line\">FLOOR (number2 ) //向下取整</div><div class=\"line\">FORMAT (number,decimal_places ) //保留小数位数</div><div class=\"line\">HEX (DecimalNumber ) //转十六进制</div><div class=\"line\">注：HEX()中可传入字符串，则返回其ASC-11码，如HEX('DEF')返回4142143</div><div class=\"line\">也可以传入十进制整数，返回其十六进制编码，如HEX(25)返回19</div><div class=\"line\">LEAST (number , number2 [,..]) //求最小值</div><div class=\"line\">MOD (numerator ,denominator ) //求余</div><div class=\"line\">POWER (number ,power ) //求指数</div><div class=\"line\">RAND([seed]) //随机数</div><div class=\"line\">ROUND (number [,decimals ]) //四舍五入,decimals为小数位数]</div><div class=\"line\">SIGN (number2 ) // 正数返回1，负数返回-1注：返回类型并非均为整数，如：</div><div class=\"line\">SQRT(number2) //开平方</div></pre></td></tr></table></figure>\n<h3 id=\"2-3-时间类\"><a href=\"#2-3-时间类\" class=\"headerlink\" title=\"2.3 时间类\"></a>2.3 时间类</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\">ADDTIME (date2 ,time_interval ) //将time_interval加到date2</div><div class=\"line\">CONVERT_TZ (datetime2 ,fromTZ ,toTZ ) //转换时区</div><div class=\"line\">CURRENT_DATE ( ) //当前日期</div><div class=\"line\">CURRENT_TIME ( ) //当前时间</div><div class=\"line\">CURRENT_TIMESTAMP ( ) //当前时间戳</div><div class=\"line\">DATE (datetime ) //返回datetime的日期部分</div><div class=\"line\">DATE_ADD (date2 , INTERVAL d_value d_type ) //在date2中加上日期或时间</div><div class=\"line\">DATE_FORMAT (datetime ,FormatCodes ) //使用formatcodes格式显示datetime</div><div class=\"line\">DATE_SUB (date2 , INTERVAL d_value d_type ) //在date2上减去一个时间</div><div class=\"line\">DATEDIFF (date1 ,date2 ) //两个日期差</div><div class=\"line\">DAY (date ) //返回日期的天</div><div class=\"line\">DAYNAME (date ) //英文星期</div><div class=\"line\">DAYOFWEEK (date ) //星期(1-7) ,1为星期天</div><div class=\"line\">DAYOFYEAR (date ) //一年中的第几天</div><div class=\"line\">EXTRACT (interval_name FROM date ) //从date中提取日期的指定部分</div><div class=\"line\">MAKEDATE (year ,day ) //给出年及年中的第几天,生成日期串</div><div class=\"line\">MAKETIME (hour ,minute ,second ) //生成时间串</div><div class=\"line\">MONTHNAME (date ) //英文月份名</div><div class=\"line\">NOW ( ) //当前时间</div><div class=\"line\">SEC_TO_TIME (seconds ) //秒数转成时间</div><div class=\"line\">STR_TO_DATE (string ,format ) //字串转成时间,以format格式显示</div><div class=\"line\">TIMEDIFF (datetime1 ,datetime2 ) //两个时间差</div><div class=\"line\">TIME_TO_SEC (time ) //时间转秒数]</div><div class=\"line\">WEEK (date_time [,start_of_week ]) //第几周</div><div class=\"line\">YEAR (datetime ) //年份</div><div class=\"line\">DAYOFMONTH(datetime) //月的第几天</div><div class=\"line\">HOUR(datetime) //小时</div><div class=\"line\">LAST_DAY(date) //date的月的最后日期</div><div class=\"line\">MICROSECOND(datetime) //微秒</div><div class=\"line\">MONTH(datetime) //月</div><div class=\"line\">MINUTE(datetime) //分返回符号,正负或0</div></pre></td></tr></table></figure>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<h2 id=\"1-存储过程\"><a href=\"#1-存储过程\" class=\"headerlink\" title=\"1. 存储过程\"></a>1. 存储过程</h2><h3 id=\"1-1-简介\"><a href=\"#1-1-简介\" class=\"headerlink\" title=\"1.1 简介\"></a>1.1 简介</h3><p>&emsp;&emsp;普通的sql语句在执行的时候需要先编译再执行，而存储过程（Stored Procedure）是一组为了特定功能的SQL语句集，经编译后存储在数据库中，用户通过指定的存储过程名称并给定参数（如果有的话）来调用执行它。<br>&emsp;&emsp;存储过程是可编程的函数，在数据库中创建并保存，可以由SQL语句和控制结构组成。当想要在不同的应用程序或平台上执行相同的函数，或者封装特定功能时，存储过程是非常有用的。数据库中的存储过程可以看做是对编程中面向对象方法的模拟，它允许控制数据的访问方式。<br>","more":"</p>\n<h3 id=\"1-2-优点\"><a href=\"#1-2-优点\" class=\"headerlink\" title=\"1.2 优点\"></a>1.2 优点</h3><ol>\n<li>增强SQL语言的功能和灵活性：存储过程可以用流控制语句编写，有很强的灵活性，可以完成复杂的判断和较复杂的运算。</li>\n<li>标准组件式编程：存储过程被创建后，可以在程序中被多次调用，而不必重新编写该存储过程的SQL语句。而且数据库专业人员可以随时对存储过程进行修改，对应用程序源代码毫无影响。</li>\n<li>较快的执行速度：如果某一操作包含大量的Transaction-SQL代码或分别被多次执行，那么存储过程要比批处理的执行速度快很多。因为存储过程是预编译的。在首次运行一个存储过程时查询，优化器对其进行分析优化，并且给出最终被存储在系统表中的执行计划。而批处理的Transaction-SQL语句在每次运行时都要进行编译和优化，速度相对要慢一些。</li>\n<li>减少网络流量：针对同一个数据库对象的操作（如查询、修改），如果这一操作所涉及的Transaction-SQL语句被组织程存储过程，那么当在客户计算机上调用该存储过程时，网络中传送的只是该调用语句，从而大大增加了网络流量并降低了网络负载。</li>\n<li>安全机制：通过对执行某一存储过程的权限进行限制，能够实现对相应的数据的访问权限的限制，避免了非授权用户对数据的访问，保证了数据的安全。</li>\n</ol>\n<h3 id=\"1-3-存储过程创建\"><a href=\"#1-3-存储过程创建\" class=\"headerlink\" title=\"1.3 存储过程创建\"></a>1.3 存储过程创建</h3><h4 id=\"1-3-1-语法\"><a href=\"#1-3-1-语法\" class=\"headerlink\" title=\"1.3.1 语法\"></a>1.3.1 语法</h4><p><strong>CREATE PROCEDURE  过程名([[IN|OUT|INOUT] 参数名 数据类型[,[IN|OUT|INOUT] 参数名 数据类型…]]) [特性 …] 过程体</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">DELIMITER //</div><div class=\"line\">  <span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> myproc(<span class=\"keyword\">OUT</span> s <span class=\"built_in\">int</span>)</div><div class=\"line\">    <span class=\"keyword\">BEGIN</span></div><div class=\"line\">      <span class=\"keyword\">SELECT</span> <span class=\"keyword\">COUNT</span>(*) <span class=\"keyword\">INTO</span> s <span class=\"keyword\">FROM</span> students;</div><div class=\"line\">    <span class=\"keyword\">END</span></div><div class=\"line\">    //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<h4 id=\"1-3-2-分隔符\"><a href=\"#1-3-2-分隔符\" class=\"headerlink\" title=\"1.3.2 分隔符\"></a>1.3.2 分隔符</h4><p>&emsp;&emsp;MySQL默认以”;”为分隔符，如果没有声明分割符，则编译器会把存储过程当成SQL语句进行处理，因此编译过程会报错，所以要事先用“DELIMITER //”声明当前段分隔符，让编译器把两个”//“之间的内容当做存储过程的代码，不会执行这些代码；“DELIMITER ;”的意为把分隔符还原。</p>\n<h4 id=\"1-3-3-参数\"><a href=\"#1-3-3-参数\" class=\"headerlink\" title=\"1.3.3 参数\"></a>1.3.3 参数</h4><p>&emsp;&emsp;存储过程根据需要可能会有输入、输出、输入输出参数，如果有多个参数用”,”分割开。MySQL存储过程的参数用在存储过程的定义，共有三种参数类型,IN,OUT,INOUT:</p>\n<ul>\n<li>IN:参数的值必须在调用存储过程时指定，在存储过程中修改该参数的值不能被返回，为默认值.</li>\n<li>OUT:值可在存储过程内部被改变，并可返回.</li>\n<li>INOUT:调用时指定，并且可被改变和返回.</li>\n</ul>\n<h4 id=\"2-3-4-过程体\"><a href=\"#2-3-4-过程体\" class=\"headerlink\" title=\"2.3.4 过程体\"></a>2.3.4 过程体</h4><p>&emsp;&emsp;过程体的开始与结束使用BEGIN与END进行标识。</p>\n<h3 id=\"1-4-变量\"><a href=\"#1-4-变量\" class=\"headerlink\" title=\"1.4 变量\"></a>1.4 变量</h3><h4 id=\"1-4-1-声明变量\"><a href=\"#1-4-1-声明变量\" class=\"headerlink\" title=\"1.4.1 声明变量\"></a>1.4.1 声明变量</h4><p>&emsp;&emsp;<strong>DECLARE 变量名1[,变量名2…] 数据类型 [默认值];</strong></p>\n<h4 id=\"1-4-2-数值类型\"><a href=\"#1-4-2-数值类型\" class=\"headerlink\" title=\"1.4.2 数值类型\"></a>1.4.2 数值类型</h4><p>&emsp;&emsp;数据类型为MySQL的数据类型</p>\n<ol>\n<li>数值类型!<br> <img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201446988-1864698114.png\" alt=\"此处输入图片的描述\"></li>\n<li>日期和时间类型!<br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201448332-1505149268.png\" alt=\"此处输入图片的描述\"></li>\n<li>字符串类型!<br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201449535-2004058554.png\" alt=\"此处输入图片的描述\"></li>\n</ol>\n<h4 id=\"1-4-3-变量赋值\"><a href=\"#1-4-3-变量赋值\" class=\"headerlink\" title=\"1.4.3 变量赋值\"></a>1.4.3 变量赋值</h4><p>&emsp;&emsp;<strong>SET 变量名 = 变量值 [,变量名= 变量值 …]</strong></p>\n<h4 id=\"1-4-4-用户变量\"><a href=\"#1-4-4-用户变量\" class=\"headerlink\" title=\"1.4.4 用户变量\"></a>1.4.4 用户变量</h4><p>&emsp;&emsp;用户变量一般以@开头。<br>&emsp;&emsp;注意：滥用用户变量会导致程序难以理解及管理<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"string\">'Hello World'</span> <span class=\"keyword\">into</span> @x;</div><div class=\"line\"><span class=\"keyword\">SELECT</span> @x;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">SET</span> @y=<span class=\"string\">'Goodbye Cruel World'</span>;</div><div class=\"line\"><span class=\"keyword\">SELECT</span> @y;</div><div class=\"line\"><span class=\"keyword\">SET</span> @z=<span class=\"number\">1</span>+<span class=\"number\">2</span>+<span class=\"number\">3</span>;</div><div class=\"line\"><span class=\"keyword\">SELECT</span> @z;</div></pre></td></tr></table></figure></p>\n<p>执行结果:<br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201450582-1967285160.png\" alt=\"此处输入图片的描述\"><br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201451254-1893179304.png\" alt=\"此处输入图片的描述\"><br><img src=\"http://images2015.cnblogs.com/blog/932264/201604/932264-20160412201451910-256935933.png\" alt=\"此处输入图片的描述\"></p>\n<ul>\n<li><p>在存储过程中使用用户变量</p>\n <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> GreetWorld() <span class=\"keyword\">SELECT</span> <span class=\"keyword\">CONCAT</span>(@greeting,<span class=\"string\">' World'</span>);</div><div class=\"line\"><span class=\"keyword\">SET</span> @greeting=<span class=\"string\">'Hello'</span>;</div><div class=\"line\"><span class=\"keyword\">CALL</span> GreetWorld();</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<pre><code>执行结果:\n![此处输入图片的描述][7]\n</code></pre><ul>\n<li><p>在存储过程间传递全局范围的用户变量</p>\n <figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> p1() <span class=\"keyword\">SET</span> @last_proc=<span class=\"string\">'p1'</span>;</div><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">PROCEDURE</span> p2() <span class=\"keyword\">SELECT</span> <span class=\"keyword\">CONCAT</span>(<span class=\"string\">'Last procedure was '</span>,@last_proc);</div><div class=\"line\"><span class=\"keyword\">CALL</span> p1();</div><div class=\"line\"><span class=\"keyword\">CALL</span> p2();</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<pre><code>执行结果:\n![此处输入图片的描述][8]\n</code></pre><h4 id=\"1-4-5-变量作用域\"><a href=\"#1-4-5-变量作用域\" class=\"headerlink\" title=\"1.4.5 变量作用域\"></a>1.4.5 变量作用域</h4><p>&emsp;&emsp;内部变量在其作用域范围内享有更高的优先权，当执行到end时，内部变量消失，不再可见了，在存储过程外再也找不到这个内部变量，但是可以通过out参数或者将其值指派给会话变量来保存其值。</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">#变量作用域</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc()</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE x1 VARCHAR(5) DEFAULT 'outer';</div><div class=\"line\">        BEGIN</div><div class=\"line\">          DECLARE x1 VARCHAR(5) DEFAULT 'inner';</div><div class=\"line\">          SELECT x1;</div><div class=\"line\">        END;</div><div class=\"line\">      SELECT x1;</div><div class=\"line\">    END;</div><div class=\"line\">    //</div><div class=\"line\">DELIMITER ;</div><div class=\"line\">#调用</div><div class=\"line\">CALL proc();</div></pre></td></tr></table></figure>\n<p>执行结果：<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">inner  outer</div></pre></td></tr></table></figure></p>\n<h3 id=\"1-5-存储过程的CRUD\"><a href=\"#1-5-存储过程的CRUD\" class=\"headerlink\" title=\"1.5 存储过程的CRUD\"></a>1.5 存储过程的CRUD</h3><h4 id=\"1-5-1-调用\"><a href=\"#1-5-1-调用\" class=\"headerlink\" title=\"1.5.1 调用\"></a>1.5.1 调用</h4><p>&emsp;&emsp;用call和你过程名以及一个括号，括号里面根据需要，加入参数，参数包括输入参数、输出参数、输入输出参数。</p>\n<h4 id=\"1-5-2-查询\"><a href=\"#1-5-2-查询\" class=\"headerlink\" title=\"1.5.2 查询\"></a>1.5.2 查询</h4><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">#查询存储过程</div><div class=\"line\">SELECT name FROM mysql.proc WHERE db='数据库名';</div><div class=\"line\">SELECT routine_name FROM information_schema.routines WHERE routine_schema='数据库名';</div><div class=\"line\">SHOW PROCEDURE STATUS WHERE db='数据库名';</div><div class=\"line\"></div><div class=\"line\">#查看存储过程详细信息</div><div class=\"line\">SHOW CREATE PROCEDURE 数据库.存储过程名;</div></pre></td></tr></table></figure>\n<h4 id=\"1-5-3-修改\"><a href=\"#1-5-3-修改\" class=\"headerlink\" title=\"1.5.3 修改\"></a>1.5.3 修改</h4><p>&emsp;&emsp;<strong>ALTER PROCEDURE 更改用CREATE PROCEDURE 建立的预先指定的存储过程，其不会影响相关存储过程或存储功能。</strong></p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">ALTER</span> &#123;<span class=\"keyword\">PROCEDURE</span> | <span class=\"keyword\">FUNCTION</span>&#125; sp_name [characteristic ...]</div><div class=\"line\">characteristic:&#123; CONTAINS <span class=\"keyword\">SQL</span> | <span class=\"keyword\">NO</span> <span class=\"keyword\">SQL</span> | <span class=\"keyword\">READS</span> <span class=\"keyword\">SQL</span> <span class=\"keyword\">DATA</span> | MODIFIES <span class=\"keyword\">SQL</span> <span class=\"keyword\">DATA</span> &#125;</div><div class=\"line\">| <span class=\"keyword\">SQL</span> <span class=\"keyword\">SECURITY</span> &#123; DEFINER | INVOKER &#125;</div><div class=\"line\">| <span class=\"keyword\">COMMENT</span> <span class=\"string\">'string'</span></div></pre></td></tr></table></figure>\n<ul>\n<li>sp_name参数表示存储过程或函数的名称；</li>\n<li>characteristic参数指定存储函数的特性。</li>\n<li>CONTAINS SQL表示子程序包含SQL语句，但不包含读或写数据的语句；</li>\n<li>NO SQL表示子程序中不包含SQL语句；</li>\n<li>READS SQL DATA表示子程序中包含读数据的语句；</li>\n<li>MODIFIES SQL DATA表示子程序中包含写数据的语句。</li>\n<li>SQL SECURITY { DEFINER | INVOKER }指明谁有权限来执行，DEFINER表示只有定义者自己才能够执行；INVOKER表示调用者可以执行。</li>\n<li>COMMENT ‘string’是注释信息。</li>\n</ul>\n<p>Example:<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">#将读写权限改为MODIFIES SQL DATA，并指明调用者可以执行。</div><div class=\"line\">ALTER  PROCEDURE  num_from_employee</div><div class=\"line\">  MODIFIES SQL DATA</div><div class=\"line\">  SQL SECURITY INVOKER ;</div><div class=\"line\">#将读写权限改为READS SQL DATA，并加上注释信息'FIND NAME'。</div><div class=\"line\">ALTER  PROCEDURE  name_from_employee</div><div class=\"line\">  READS SQL DATA</div><div class=\"line\">  COMMENT 'FIND NAME' ;</div></pre></td></tr></table></figure></p>\n<h4 id=\"1-5-4-删除\"><a href=\"#1-5-4-删除\" class=\"headerlink\" title=\"1.5.4 删除\"></a>1.5.4 删除</h4><p>&emsp;&emsp;<strong>DROP PROCEDURE [过程1[,过程2…]]</strong><br>&emsp;&emsp;从MySQL的表格中删除一个或多个存储过程。</p>\n<h3 id=\"1-6-控制语句\"><a href=\"#1-6-控制语句\" class=\"headerlink\" title=\"1.6 控制语句\"></a>1.6 控制语句</h3><h4 id=\"1-6-1-条件语句\"><a href=\"#1-6-1-条件语句\" class=\"headerlink\" title=\"1.6.1 条件语句\"></a>1.6.1 条件语句</h4><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">#条件语句IF-THEN-ELSE</div><div class=\"line\">DROP PROCEDURE IF EXISTS proc3;</div><div class=\"line\">DELIMITER //</div><div class=\"line\">CREATE PROCEDURE proc3(IN parameter int)</div><div class=\"line\">  BEGIN</div><div class=\"line\">    DECLARE var int;</div><div class=\"line\">    SET var=parameter+1;</div><div class=\"line\">    IF var=0 THEN</div><div class=\"line\">      INSERT INTO t VALUES (17);</div><div class=\"line\">    END IF ;</div><div class=\"line\">    IF parameter=0 THEN</div><div class=\"line\">      UPDATE t SET s1=s1+1;</div><div class=\"line\">    ELSE</div><div class=\"line\">      UPDATE t SET s1=s1+2;</div><div class=\"line\">    END IF ;</div><div class=\"line\">  END ;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">#CASE-WHEN-THEN-ELSE语句</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc4 (IN parameter INT)</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE var INT;</div><div class=\"line\">      SET var=parameter+1;</div><div class=\"line\">      CASE var</div><div class=\"line\">        WHEN 0 THEN</div><div class=\"line\">          INSERT INTO t VALUES (17);</div><div class=\"line\">        WHEN 1 THEN</div><div class=\"line\">          INSERT INTO t VALUES (18);</div><div class=\"line\">        ELSE</div><div class=\"line\">          INSERT INTO t VALUES (19);</div><div class=\"line\">      END CASE ;</div><div class=\"line\">    END ;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<h4 id=\"1-6-2-循环语句\"><a href=\"#1-6-2-循环语句\" class=\"headerlink\" title=\"1.6.2 循环语句\"></a>1.6.2 循环语句</h4><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">#WHILE-DO…END-WHILE语句</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc5()</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE var INT;</div><div class=\"line\">      SET var=0;</div><div class=\"line\">      WHILE var&lt;6 DO</div><div class=\"line\">        INSERT INTO t VALUES (var);</div><div class=\"line\">        SET var=var+1;</div><div class=\"line\">      END WHILE ;</div><div class=\"line\">    END;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">#REPEAT...END REPEAT</div><div class=\"line\">#此语句的特点是执行操作后检查结果</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc6 ()</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE v INT;</div><div class=\"line\">      SET v=0;</div><div class=\"line\">      REPEAT</div><div class=\"line\">        INSERT INTO t VALUES(v);</div><div class=\"line\">        SET v=v+1;</div><div class=\"line\">        UNTIL v&gt;=5</div><div class=\"line\">      END REPEAT;</div><div class=\"line\">    END;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">#LOOP...END LOOP</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc7 ()</div><div class=\"line\">    BEGIN</div><div class=\"line\">      DECLARE v INT;</div><div class=\"line\">      SET v=0;</div><div class=\"line\">      LOOP_LABLE:LOOP</div><div class=\"line\">        INSERT INTO t VALUES(v);</div><div class=\"line\">        SET v=v+1;</div><div class=\"line\">        IF v &gt;=5 THEN</div><div class=\"line\">          LEAVE LOOP_LABLE;</div><div class=\"line\">        END IF;</div><div class=\"line\">      END LOOP;</div><div class=\"line\">    END;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<p><strong>LABLES标号</strong><br>&emsp;&emsp;标号可以用在begin repeat while 或者loop语句前，语句标号只能在合法的语句前面使用。可以跳出循环，使运行指令达到复合语句的最后一步。</p>\n<h4 id=\"1-6-3-迭代\"><a href=\"#1-6-3-迭代\" class=\"headerlink\" title=\"1.6.3 迭代\"></a>1.6.3 迭代</h4><p>&emsp;&emsp;通过引用复合语句的标号,来从新开始复合语句</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">#ITERATE</div><div class=\"line\">DELIMITER //</div><div class=\"line\">  CREATE PROCEDURE proc8()</div><div class=\"line\">  BEGIN</div><div class=\"line\">    DECLARE v INT;</div><div class=\"line\">    SET v=0;</div><div class=\"line\">    LOOP_LABLE:LOOP</div><div class=\"line\">      IF v=3 THEN</div><div class=\"line\">        SET v=v+1;</div><div class=\"line\">        ITERATE LOOP_LABLE;</div><div class=\"line\">      END IF;</div><div class=\"line\">      INSERT INTO t VALUES(v);</div><div class=\"line\">      SET v=v+1;</div><div class=\"line\">      IF v&gt;=5 THEN</div><div class=\"line\">        LEAVE LOOP_LABLE;</div><div class=\"line\">      END IF;</div><div class=\"line\">    END LOOP;</div><div class=\"line\">  END;</div><div class=\"line\">  //</div><div class=\"line\">DELIMITER ;</div></pre></td></tr></table></figure>\n<h2 id=\"2-MySQL存储过程的基本函数\"><a href=\"#2-MySQL存储过程的基本函数\" class=\"headerlink\" title=\"2. MySQL存储过程的基本函数\"></a>2. MySQL存储过程的基本函数</h2><h3 id=\"2-1-字符串类\"><a href=\"#2-1-字符串类\" class=\"headerlink\" title=\"2.1 字符串类\"></a>2.1 字符串类</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\">CHARSET(str) //返回字串字符集</div><div class=\"line\">CONCAT (string2 [,... ]) //连接字串</div><div class=\"line\">INSTR (string ,substring ) //返回substring首次在string中出现的位置,不存在返回0</div><div class=\"line\">LCASE (string2 ) //转换成小写</div><div class=\"line\">LEFT (string2 ,length ) //从string2中的左边起取length个字符</div><div class=\"line\">LENGTH (string ) //string长度</div><div class=\"line\">LOAD_FILE (file_name ) //从文件读取内容</div><div class=\"line\">LOCATE (substring , string [,start_position ] ) 同INSTR,但可指定开始位置</div><div class=\"line\">LPAD (string2 ,length ,pad ) //重复用pad加在string开头,直到字串长度为length</div><div class=\"line\">LTRIM (string2 ) //去除前端空格</div><div class=\"line\">REPEAT (string2 ,count ) //重复count次</div><div class=\"line\"><span class=\"keyword\">REPLACE</span> (<span class=\"keyword\">str</span> ,search_str ,replace_str ) //在<span class=\"keyword\">str</span>中用replace_str替换search_str</div><div class=\"line\">RPAD (string2 ,<span class=\"keyword\">length</span> ,<span class=\"keyword\">pad</span>) //在<span class=\"keyword\">str</span>后用<span class=\"keyword\">pad</span>补充,直到长度为<span class=\"keyword\">length</span></div><div class=\"line\"><span class=\"keyword\">RTRIM</span> (string2 ) //去除后端空格</div><div class=\"line\"><span class=\"keyword\">STRCMP</span> (string1 ,string2 ) //逐字符比较两字串大小,</div><div class=\"line\"><span class=\"keyword\">SUBSTRING</span> (<span class=\"keyword\">str</span> , <span class=\"keyword\">position</span> [,<span class=\"keyword\">length</span> ]) //从<span class=\"keyword\">str</span>的<span class=\"keyword\">position</span>开始,取<span class=\"keyword\">length</span>个字符,</div><div class=\"line\">注：mysql中处理字符串时，默认第一个字符下标为<span class=\"number\">1</span>，即参数<span class=\"keyword\">position</span>必须大于等于<span class=\"number\">1</span></div><div class=\"line\"><span class=\"keyword\">TRIM</span>([[<span class=\"keyword\">BOTH</span>|<span class=\"keyword\">LEADING</span>|TRAILING] [padding] <span class=\"keyword\">FROM</span>]string2) //去除指定位置的指定字符</div><div class=\"line\"><span class=\"keyword\">UCASE</span> (string2 ) //转换成大写</div><div class=\"line\"><span class=\"keyword\">RIGHT</span>(string2,<span class=\"keyword\">length</span>) //取string2最后<span class=\"keyword\">length</span>个字符</div><div class=\"line\"><span class=\"keyword\">SPACE</span>(<span class=\"keyword\">count</span>) //生成<span class=\"keyword\">count</span>个空格</div></pre></td></tr></table></figure>\n<h3 id=\"2-2-数学类\"><a href=\"#2-2-数学类\" class=\"headerlink\" title=\"2.2 数学类\"></a>2.2 数学类</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">ABS (number2 ) //绝对值</div><div class=\"line\">BIN (decimal_number ) //十进制转二进制</div><div class=\"line\">CEILING (number2 ) //向上取整</div><div class=\"line\">CONV(number2,from_base,to_base) //进制转换</div><div class=\"line\">FLOOR (number2 ) //向下取整</div><div class=\"line\">FORMAT (number,decimal_places ) //保留小数位数</div><div class=\"line\">HEX (DecimalNumber ) //转十六进制</div><div class=\"line\">注：HEX()中可传入字符串，则返回其ASC-11码，如HEX('DEF')返回4142143</div><div class=\"line\">也可以传入十进制整数，返回其十六进制编码，如HEX(25)返回19</div><div class=\"line\">LEAST (number , number2 [,..]) //求最小值</div><div class=\"line\">MOD (numerator ,denominator ) //求余</div><div class=\"line\">POWER (number ,power ) //求指数</div><div class=\"line\">RAND([seed]) //随机数</div><div class=\"line\">ROUND (number [,decimals ]) //四舍五入,decimals为小数位数]</div><div class=\"line\">SIGN (number2 ) // 正数返回1，负数返回-1注：返回类型并非均为整数，如：</div><div class=\"line\">SQRT(number2) //开平方</div></pre></td></tr></table></figure>\n<h3 id=\"2-3-时间类\"><a href=\"#2-3-时间类\" class=\"headerlink\" title=\"2.3 时间类\"></a>2.3 时间类</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\">ADDTIME (date2 ,time_interval ) //将time_interval加到date2</div><div class=\"line\">CONVERT_TZ (datetime2 ,fromTZ ,toTZ ) //转换时区</div><div class=\"line\">CURRENT_DATE ( ) //当前日期</div><div class=\"line\">CURRENT_TIME ( ) //当前时间</div><div class=\"line\">CURRENT_TIMESTAMP ( ) //当前时间戳</div><div class=\"line\">DATE (datetime ) //返回datetime的日期部分</div><div class=\"line\">DATE_ADD (date2 , INTERVAL d_value d_type ) //在date2中加上日期或时间</div><div class=\"line\">DATE_FORMAT (datetime ,FormatCodes ) //使用formatcodes格式显示datetime</div><div class=\"line\">DATE_SUB (date2 , INTERVAL d_value d_type ) //在date2上减去一个时间</div><div class=\"line\">DATEDIFF (date1 ,date2 ) //两个日期差</div><div class=\"line\">DAY (date ) //返回日期的天</div><div class=\"line\">DAYNAME (date ) //英文星期</div><div class=\"line\">DAYOFWEEK (date ) //星期(1-7) ,1为星期天</div><div class=\"line\">DAYOFYEAR (date ) //一年中的第几天</div><div class=\"line\">EXTRACT (interval_name FROM date ) //从date中提取日期的指定部分</div><div class=\"line\">MAKEDATE (year ,day ) //给出年及年中的第几天,生成日期串</div><div class=\"line\">MAKETIME (hour ,minute ,second ) //生成时间串</div><div class=\"line\">MONTHNAME (date ) //英文月份名</div><div class=\"line\">NOW ( ) //当前时间</div><div class=\"line\">SEC_TO_TIME (seconds ) //秒数转成时间</div><div class=\"line\">STR_TO_DATE (string ,format ) //字串转成时间,以format格式显示</div><div class=\"line\">TIMEDIFF (datetime1 ,datetime2 ) //两个时间差</div><div class=\"line\">TIME_TO_SEC (time ) //时间转秒数]</div><div class=\"line\">WEEK (date_time [,start_of_week ]) //第几周</div><div class=\"line\">YEAR (datetime ) //年份</div><div class=\"line\">DAYOFMONTH(datetime) //月的第几天</div><div class=\"line\">HOUR(datetime) //小时</div><div class=\"line\">LAST_DAY(date) //date的月的最后日期</div><div class=\"line\">MICROSECOND(datetime) //微秒</div><div class=\"line\">MONTH(datetime) //月</div><div class=\"line\">MINUTE(datetime) //分返回符号,正负或0</div></pre></td></tr></table></figure>"},{"title":"Mysql索引的简单使用","keyword":["Mysql","索引"],"date":"2018-04-10T13:11:36.000Z","_content":"这篇记录了mysql中索引的简单使用方法，基本上满足大部分的开发需求。\n\n<!--more-->\n\n\n## 1、索引是什么\n\n索引（Index）是帮助Mysql高效查询数据的一种数据结构，其本质：数据结构。\n\n## 2、优势\n\n好比图书馆建立的书目索引，提高数据检索效率，降低数据库的IO成本。\n通过索引对数据库进行排序，降低数据排序的成本，降低CPU的消耗。\n\n## 3、劣势\n\n索引也是一张表，该表保存了主键与索引片段，并指向实体表的记录，所以索引也是需要占用空间的。\n同时会降低更新表的速度，如对表进行INSERT、UPDATE和DELETE。因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件。\n\n## 4、分类\n\n 1. 单列索引：即一个索引只包含一个列，一张表可以有多个单列索引。\n 2. 唯一索引(UNIQUE)：索引列的值必须唯一，允许为空值。\n 3. 全文索引(FULLTEXT)：仅用于MyISAM表。\n 4. 组合索引(最左前缀): 多个列构成一个索引，适用于查询条件较复杂的情况。\n\n> 最左前缀：\n\nmysql查询时只能使用一个索引。建立组合索引时，本质上同时建立了好几个索引，下面以实例讲解：\n\n```sql\nALTER TABLE people ADD INDEX lname_fname_age (lame,fname,age); \n```\n创建一个组合索引，相当于同时创建了(lname)单列索引，(lname,fname)组合索引以及(lname,fname,age)组合索引。\n\n**注：在创建多列索引时，要根据业务需求，where子句中使用最频繁的一列放在最左边。**\n\n虽然索引对顺序敏感，但是mysql优化器会自动调整where后面的条件顺序，来匹配合适的索引。\n\n \n## 5、基本语法\n\n 1. 创建索引\n\n    ```sql\n    CREATE [UNIQUE] INDEX indexName ON tableName(columnName(length))\n    ```\n    如果是CHAR，VARCHAR类型，length可以小于字段实际长度；如果是BLOB和TEXT类型，必须指定 length。\n    \n    \n    ```sql\n    ALTER TABLE tableName ADD INDEX indexName(columnName(length))\n    ```\n    修改表结构添加索引\n    \n    ```sql\n    CREATE TABLE mytable (\n    \tID INT NOT NULL,\n    \tusername VARCHAR (16) NOT NULL,\n    \tINDEX [ indexName ] (username(length))\n    );  \n    ```\n    创建表的时候直接指定。\n    \n    \n\n    > 使用ALTER 命令添加和删除索引：\n    \n     - ALTER TABLE tbl_name ADD PRIMARY KEY (column_list):\n        该语句添加一个主键，这意味着索引值必须是唯一的，且不能为NULL。\n     - ALTER TABLE tbl_name ADD UNIQUE index_name (column_list):\n        这条语句创建索引的值必须是唯一的（除了NULL外，NULL可能会出现多次）。\n     - ALTER TABLE tbl_name ADD INDEX index_name (column_list): \n        添加普通索引，索引值可出现多次。\n     - ALTER TABLE tbl_name ADD FULLTEXT index_name (column_list):\n        该语句指定了索引为 FULLTEXT ，用于全文索引。\n\n 2. 删除索引\n\n    ```sql\n    DROP INDEX [indexName] ON tableName   \n    ```\n    \n 3. 查看索引\n\n    ```sql\n    SHOW INDEX FROM table_name;  \n    ```\n    \n    \n## 6、Mysql索引结构\n\n    \n - BTree：\n    - 可以用于使用 =, >, >=, <, <= 或者 BETWEEN 运算符的列比较\n    - 如果 LIKE 的参数是一个没有以通配符起始的常量字符串的话也可以使用这种索引\n\n - Hash：\n    - 只能够用于使用 = 或者 <=> 运算符的相等比较(但是速度更快)\n    - 优化器不能够使用 hash 索引来加速 ORDER BY 操作\n    - 无法使用 hash 索引估计两个值之间有多少行\n    \n - full-text：MyISAM的一个特殊索引类型，主要用于全文检索。\n - R-Tree：MyISAM支持空间索引，主要用于地理空间数据类型，例如GEOMETRY。\n\n## 7、哪些情况需要创建索引\n\n 1. 主键自动建立唯一索引\n 2. 频繁作为查询条件的字段应该创建索引\n 3. 查询中与其他表关联的字段，外键关系建立索引\n 4. 单键/组合索引的选择问题，who?(在高并发下倾向创建组合索引)\n 5. 查询中排序的字段，排序的字段若通过索引去访问将大大提高排序速度\n 6. 查询中统计或者分组字段\n\n## 8、哪些情况不需要创建索引\n\n 1. 表记录太少\n 2. 经常增删改的表\n　　　　提高了查询速度，同时却会降低更新表的速度，如对表进行INSERT、UPDATE、和DELETE。\n　　　　因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件。\n　　　　数据重复且分布平均的表字段，因此应该只为最经常查询和最经常排序的数据建立索引。\n 3. 注意，如果某个数据列包含许多重复的内容，为它建立索引就没有太大的实际效果。\n 4. 频繁更新的字段不适合建立索引，因为每次更新不单单是更新了记录还会更新索引\n 5. WHERE条件里用不到的字段不创建索引","source":"_posts/Mysql索引的简单使用.md","raw":"---\ntitle: Mysql索引的简单使用\ncategories:\n  - Mysql\ntags:\n  - Mysql\n  - 数据库\nkeyword:\n  - Mysql\n  - 索引\ndate: 2018-04-10 21:11:36\n---\n这篇记录了mysql中索引的简单使用方法，基本上满足大部分的开发需求。\n\n<!--more-->\n\n\n## 1、索引是什么\n\n索引（Index）是帮助Mysql高效查询数据的一种数据结构，其本质：数据结构。\n\n## 2、优势\n\n好比图书馆建立的书目索引，提高数据检索效率，降低数据库的IO成本。\n通过索引对数据库进行排序，降低数据排序的成本，降低CPU的消耗。\n\n## 3、劣势\n\n索引也是一张表，该表保存了主键与索引片段，并指向实体表的记录，所以索引也是需要占用空间的。\n同时会降低更新表的速度，如对表进行INSERT、UPDATE和DELETE。因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件。\n\n## 4、分类\n\n 1. 单列索引：即一个索引只包含一个列，一张表可以有多个单列索引。\n 2. 唯一索引(UNIQUE)：索引列的值必须唯一，允许为空值。\n 3. 全文索引(FULLTEXT)：仅用于MyISAM表。\n 4. 组合索引(最左前缀): 多个列构成一个索引，适用于查询条件较复杂的情况。\n\n> 最左前缀：\n\nmysql查询时只能使用一个索引。建立组合索引时，本质上同时建立了好几个索引，下面以实例讲解：\n\n```sql\nALTER TABLE people ADD INDEX lname_fname_age (lame,fname,age); \n```\n创建一个组合索引，相当于同时创建了(lname)单列索引，(lname,fname)组合索引以及(lname,fname,age)组合索引。\n\n**注：在创建多列索引时，要根据业务需求，where子句中使用最频繁的一列放在最左边。**\n\n虽然索引对顺序敏感，但是mysql优化器会自动调整where后面的条件顺序，来匹配合适的索引。\n\n \n## 5、基本语法\n\n 1. 创建索引\n\n    ```sql\n    CREATE [UNIQUE] INDEX indexName ON tableName(columnName(length))\n    ```\n    如果是CHAR，VARCHAR类型，length可以小于字段实际长度；如果是BLOB和TEXT类型，必须指定 length。\n    \n    \n    ```sql\n    ALTER TABLE tableName ADD INDEX indexName(columnName(length))\n    ```\n    修改表结构添加索引\n    \n    ```sql\n    CREATE TABLE mytable (\n    \tID INT NOT NULL,\n    \tusername VARCHAR (16) NOT NULL,\n    \tINDEX [ indexName ] (username(length))\n    );  \n    ```\n    创建表的时候直接指定。\n    \n    \n\n    > 使用ALTER 命令添加和删除索引：\n    \n     - ALTER TABLE tbl_name ADD PRIMARY KEY (column_list):\n        该语句添加一个主键，这意味着索引值必须是唯一的，且不能为NULL。\n     - ALTER TABLE tbl_name ADD UNIQUE index_name (column_list):\n        这条语句创建索引的值必须是唯一的（除了NULL外，NULL可能会出现多次）。\n     - ALTER TABLE tbl_name ADD INDEX index_name (column_list): \n        添加普通索引，索引值可出现多次。\n     - ALTER TABLE tbl_name ADD FULLTEXT index_name (column_list):\n        该语句指定了索引为 FULLTEXT ，用于全文索引。\n\n 2. 删除索引\n\n    ```sql\n    DROP INDEX [indexName] ON tableName   \n    ```\n    \n 3. 查看索引\n\n    ```sql\n    SHOW INDEX FROM table_name;  \n    ```\n    \n    \n## 6、Mysql索引结构\n\n    \n - BTree：\n    - 可以用于使用 =, >, >=, <, <= 或者 BETWEEN 运算符的列比较\n    - 如果 LIKE 的参数是一个没有以通配符起始的常量字符串的话也可以使用这种索引\n\n - Hash：\n    - 只能够用于使用 = 或者 <=> 运算符的相等比较(但是速度更快)\n    - 优化器不能够使用 hash 索引来加速 ORDER BY 操作\n    - 无法使用 hash 索引估计两个值之间有多少行\n    \n - full-text：MyISAM的一个特殊索引类型，主要用于全文检索。\n - R-Tree：MyISAM支持空间索引，主要用于地理空间数据类型，例如GEOMETRY。\n\n## 7、哪些情况需要创建索引\n\n 1. 主键自动建立唯一索引\n 2. 频繁作为查询条件的字段应该创建索引\n 3. 查询中与其他表关联的字段，外键关系建立索引\n 4. 单键/组合索引的选择问题，who?(在高并发下倾向创建组合索引)\n 5. 查询中排序的字段，排序的字段若通过索引去访问将大大提高排序速度\n 6. 查询中统计或者分组字段\n\n## 8、哪些情况不需要创建索引\n\n 1. 表记录太少\n 2. 经常增删改的表\n　　　　提高了查询速度，同时却会降低更新表的速度，如对表进行INSERT、UPDATE、和DELETE。\n　　　　因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件。\n　　　　数据重复且分布平均的表字段，因此应该只为最经常查询和最经常排序的数据建立索引。\n 3. 注意，如果某个数据列包含许多重复的内容，为它建立索引就没有太大的实际效果。\n 4. 频繁更新的字段不适合建立索引，因为每次更新不单单是更新了记录还会更新索引\n 5. WHERE条件里用不到的字段不创建索引","slug":"Mysql索引的简单使用","published":1,"updated":"2018-04-11T06:18:03.457Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qft8001ehwvfc8s4vpbl","content":"<p>这篇记录了mysql中索引的简单使用方法，基本上满足大部分的开发需求。</p>\n<a id=\"more\"></a>\n<h2 id=\"1、索引是什么\"><a href=\"#1、索引是什么\" class=\"headerlink\" title=\"1、索引是什么\"></a>1、索引是什么</h2><p>索引（Index）是帮助Mysql高效查询数据的一种数据结构，其本质：数据结构。</p>\n<h2 id=\"2、优势\"><a href=\"#2、优势\" class=\"headerlink\" title=\"2、优势\"></a>2、优势</h2><p>好比图书馆建立的书目索引，提高数据检索效率，降低数据库的IO成本。<br>通过索引对数据库进行排序，降低数据排序的成本，降低CPU的消耗。</p>\n<h2 id=\"3、劣势\"><a href=\"#3、劣势\" class=\"headerlink\" title=\"3、劣势\"></a>3、劣势</h2><p>索引也是一张表，该表保存了主键与索引片段，并指向实体表的记录，所以索引也是需要占用空间的。<br>同时会降低更新表的速度，如对表进行INSERT、UPDATE和DELETE。因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件。</p>\n<h2 id=\"4、分类\"><a href=\"#4、分类\" class=\"headerlink\" title=\"4、分类\"></a>4、分类</h2><ol>\n<li>单列索引：即一个索引只包含一个列，一张表可以有多个单列索引。</li>\n<li>唯一索引(UNIQUE)：索引列的值必须唯一，允许为空值。</li>\n<li>全文索引(FULLTEXT)：仅用于MyISAM表。</li>\n<li>组合索引(最左前缀): 多个列构成一个索引，适用于查询条件较复杂的情况。</li>\n</ol>\n<blockquote>\n<p>最左前缀：</p>\n</blockquote>\n<p>mysql查询时只能使用一个索引。建立组合索引时，本质上同时建立了好几个索引，下面以实例讲解：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> people <span class=\"keyword\">ADD</span> <span class=\"keyword\">INDEX</span> lname_fname_age (lame,fname,age);</div></pre></td></tr></table></figure>\n<p>创建一个组合索引，相当于同时创建了(lname)单列索引，(lname,fname)组合索引以及(lname,fname,age)组合索引。</p>\n<p><strong>注：在创建多列索引时，要根据业务需求，where子句中使用最频繁的一列放在最左边。</strong></p>\n<p>虽然索引对顺序敏感，但是mysql优化器会自动调整where后面的条件顺序，来匹配合适的索引。</p>\n<h2 id=\"5、基本语法\"><a href=\"#5、基本语法\" class=\"headerlink\" title=\"5、基本语法\"></a>5、基本语法</h2><ol>\n<li><p>创建索引</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> [<span class=\"keyword\">UNIQUE</span>] <span class=\"keyword\">INDEX</span> indexName <span class=\"keyword\">ON</span> tableName(columnName(<span class=\"keyword\">length</span>))</div></pre></td></tr></table></figure>\n<p>如果是CHAR，VARCHAR类型，length可以小于字段实际长度；如果是BLOB和TEXT类型，必须指定 length。</p>\n</li>\n</ol>\n<pre><code><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> tableName <span class=\"keyword\">ADD</span> <span class=\"keyword\">INDEX</span> indexName(columnName(<span class=\"keyword\">length</span>))</div></pre></td></tr></table></figure>\n\n修改表结构添加索引\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> mytable (</div><div class=\"line\">\t<span class=\"keyword\">ID</span> <span class=\"built_in\">INT</span> <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">\tusername <span class=\"built_in\">VARCHAR</span> (<span class=\"number\">16</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">\t<span class=\"keyword\">INDEX</span> [ indexName ] (username(<span class=\"keyword\">length</span>))</div><div class=\"line\">);</div></pre></td></tr></table></figure>\n\n创建表的时候直接指定。\n\n\n\n&gt; 使用ALTER 命令添加和删除索引：\n\n - ALTER TABLE tbl_name ADD PRIMARY KEY (column_list):\n    该语句添加一个主键，这意味着索引值必须是唯一的，且不能为NULL。\n - ALTER TABLE tbl_name ADD UNIQUE index_name (column_list):\n    这条语句创建索引的值必须是唯一的（除了NULL外，NULL可能会出现多次）。\n - ALTER TABLE tbl_name ADD INDEX index_name (column_list): \n    添加普通索引，索引值可出现多次。\n - ALTER TABLE tbl_name ADD FULLTEXT index_name (column_list):\n    该语句指定了索引为 FULLTEXT ，用于全文索引。\n</code></pre><ol>\n<li><p>删除索引</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">INDEX</span> [indexName] <span class=\"keyword\">ON</span> tableName</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>查看索引</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">SHOW</span> <span class=\"keyword\">INDEX</span> <span class=\"keyword\">FROM</span> table_name;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"6、Mysql索引结构\"><a href=\"#6、Mysql索引结构\" class=\"headerlink\" title=\"6、Mysql索引结构\"></a>6、Mysql索引结构</h2><ul>\n<li><p>BTree：</p>\n<ul>\n<li>可以用于使用 =, &gt;, &gt;=, &lt;, &lt;= 或者 BETWEEN 运算符的列比较</li>\n<li>如果 LIKE 的参数是一个没有以通配符起始的常量字符串的话也可以使用这种索引</li>\n</ul>\n</li>\n<li><p>Hash：</p>\n<ul>\n<li>只能够用于使用 = 或者 &lt;=&gt; 运算符的相等比较(但是速度更快)</li>\n<li>优化器不能够使用 hash 索引来加速 ORDER BY 操作</li>\n<li>无法使用 hash 索引估计两个值之间有多少行</li>\n</ul>\n</li>\n<li><p>full-text：MyISAM的一个特殊索引类型，主要用于全文检索。</p>\n</li>\n<li>R-Tree：MyISAM支持空间索引，主要用于地理空间数据类型，例如GEOMETRY。</li>\n</ul>\n<h2 id=\"7、哪些情况需要创建索引\"><a href=\"#7、哪些情况需要创建索引\" class=\"headerlink\" title=\"7、哪些情况需要创建索引\"></a>7、哪些情况需要创建索引</h2><ol>\n<li>主键自动建立唯一索引</li>\n<li>频繁作为查询条件的字段应该创建索引</li>\n<li>查询中与其他表关联的字段，外键关系建立索引</li>\n<li>单键/组合索引的选择问题，who?(在高并发下倾向创建组合索引)</li>\n<li>查询中排序的字段，排序的字段若通过索引去访问将大大提高排序速度</li>\n<li>查询中统计或者分组字段</li>\n</ol>\n<h2 id=\"8、哪些情况不需要创建索引\"><a href=\"#8、哪些情况不需要创建索引\" class=\"headerlink\" title=\"8、哪些情况不需要创建索引\"></a>8、哪些情况不需要创建索引</h2><ol>\n<li>表记录太少</li>\n<li>经常增删改的表<br>　　　　提高了查询速度，同时却会降低更新表的速度，如对表进行INSERT、UPDATE、和DELETE。<br>　　　　因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件。<br>　　　　数据重复且分布平均的表字段，因此应该只为最经常查询和最经常排序的数据建立索引。</li>\n<li>注意，如果某个数据列包含许多重复的内容，为它建立索引就没有太大的实际效果。</li>\n<li>频繁更新的字段不适合建立索引，因为每次更新不单单是更新了记录还会更新索引</li>\n<li>WHERE条件里用不到的字段不创建索引</li>\n</ol>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>这篇记录了mysql中索引的简单使用方法，基本上满足大部分的开发需求。</p>","more":"<h2 id=\"1、索引是什么\"><a href=\"#1、索引是什么\" class=\"headerlink\" title=\"1、索引是什么\"></a>1、索引是什么</h2><p>索引（Index）是帮助Mysql高效查询数据的一种数据结构，其本质：数据结构。</p>\n<h2 id=\"2、优势\"><a href=\"#2、优势\" class=\"headerlink\" title=\"2、优势\"></a>2、优势</h2><p>好比图书馆建立的书目索引，提高数据检索效率，降低数据库的IO成本。<br>通过索引对数据库进行排序，降低数据排序的成本，降低CPU的消耗。</p>\n<h2 id=\"3、劣势\"><a href=\"#3、劣势\" class=\"headerlink\" title=\"3、劣势\"></a>3、劣势</h2><p>索引也是一张表，该表保存了主键与索引片段，并指向实体表的记录，所以索引也是需要占用空间的。<br>同时会降低更新表的速度，如对表进行INSERT、UPDATE和DELETE。因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件。</p>\n<h2 id=\"4、分类\"><a href=\"#4、分类\" class=\"headerlink\" title=\"4、分类\"></a>4、分类</h2><ol>\n<li>单列索引：即一个索引只包含一个列，一张表可以有多个单列索引。</li>\n<li>唯一索引(UNIQUE)：索引列的值必须唯一，允许为空值。</li>\n<li>全文索引(FULLTEXT)：仅用于MyISAM表。</li>\n<li>组合索引(最左前缀): 多个列构成一个索引，适用于查询条件较复杂的情况。</li>\n</ol>\n<blockquote>\n<p>最左前缀：</p>\n</blockquote>\n<p>mysql查询时只能使用一个索引。建立组合索引时，本质上同时建立了好几个索引，下面以实例讲解：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> people <span class=\"keyword\">ADD</span> <span class=\"keyword\">INDEX</span> lname_fname_age (lame,fname,age);</div></pre></td></tr></table></figure>\n<p>创建一个组合索引，相当于同时创建了(lname)单列索引，(lname,fname)组合索引以及(lname,fname,age)组合索引。</p>\n<p><strong>注：在创建多列索引时，要根据业务需求，where子句中使用最频繁的一列放在最左边。</strong></p>\n<p>虽然索引对顺序敏感，但是mysql优化器会自动调整where后面的条件顺序，来匹配合适的索引。</p>\n<h2 id=\"5、基本语法\"><a href=\"#5、基本语法\" class=\"headerlink\" title=\"5、基本语法\"></a>5、基本语法</h2><ol>\n<li><p>创建索引</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> [<span class=\"keyword\">UNIQUE</span>] <span class=\"keyword\">INDEX</span> indexName <span class=\"keyword\">ON</span> tableName(columnName(<span class=\"keyword\">length</span>))</div></pre></td></tr></table></figure>\n<p>如果是CHAR，VARCHAR类型，length可以小于字段实际长度；如果是BLOB和TEXT类型，必须指定 length。</p>\n</li>\n</ol>\n<pre><code><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">TABLE</span> tableName <span class=\"keyword\">ADD</span> <span class=\"keyword\">INDEX</span> indexName(columnName(<span class=\"keyword\">length</span>))</div></pre></td></tr></table></figure>\n\n修改表结构添加索引\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> mytable (</div><div class=\"line\">\t<span class=\"keyword\">ID</span> <span class=\"built_in\">INT</span> <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">\tusername <span class=\"built_in\">VARCHAR</span> (<span class=\"number\">16</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">\t<span class=\"keyword\">INDEX</span> [ indexName ] (username(<span class=\"keyword\">length</span>))</div><div class=\"line\">);</div></pre></td></tr></table></figure>\n\n创建表的时候直接指定。\n\n\n\n&gt; 使用ALTER 命令添加和删除索引：\n\n - ALTER TABLE tbl_name ADD PRIMARY KEY (column_list):\n    该语句添加一个主键，这意味着索引值必须是唯一的，且不能为NULL。\n - ALTER TABLE tbl_name ADD UNIQUE index_name (column_list):\n    这条语句创建索引的值必须是唯一的（除了NULL外，NULL可能会出现多次）。\n - ALTER TABLE tbl_name ADD INDEX index_name (column_list): \n    添加普通索引，索引值可出现多次。\n - ALTER TABLE tbl_name ADD FULLTEXT index_name (column_list):\n    该语句指定了索引为 FULLTEXT ，用于全文索引。\n</code></pre><ol>\n<li><p>删除索引</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">INDEX</span> [indexName] <span class=\"keyword\">ON</span> tableName</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>查看索引</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">SHOW</span> <span class=\"keyword\">INDEX</span> <span class=\"keyword\">FROM</span> table_name;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"6、Mysql索引结构\"><a href=\"#6、Mysql索引结构\" class=\"headerlink\" title=\"6、Mysql索引结构\"></a>6、Mysql索引结构</h2><ul>\n<li><p>BTree：</p>\n<ul>\n<li>可以用于使用 =, &gt;, &gt;=, &lt;, &lt;= 或者 BETWEEN 运算符的列比较</li>\n<li>如果 LIKE 的参数是一个没有以通配符起始的常量字符串的话也可以使用这种索引</li>\n</ul>\n</li>\n<li><p>Hash：</p>\n<ul>\n<li>只能够用于使用 = 或者 &lt;=&gt; 运算符的相等比较(但是速度更快)</li>\n<li>优化器不能够使用 hash 索引来加速 ORDER BY 操作</li>\n<li>无法使用 hash 索引估计两个值之间有多少行</li>\n</ul>\n</li>\n<li><p>full-text：MyISAM的一个特殊索引类型，主要用于全文检索。</p>\n</li>\n<li>R-Tree：MyISAM支持空间索引，主要用于地理空间数据类型，例如GEOMETRY。</li>\n</ul>\n<h2 id=\"7、哪些情况需要创建索引\"><a href=\"#7、哪些情况需要创建索引\" class=\"headerlink\" title=\"7、哪些情况需要创建索引\"></a>7、哪些情况需要创建索引</h2><ol>\n<li>主键自动建立唯一索引</li>\n<li>频繁作为查询条件的字段应该创建索引</li>\n<li>查询中与其他表关联的字段，外键关系建立索引</li>\n<li>单键/组合索引的选择问题，who?(在高并发下倾向创建组合索引)</li>\n<li>查询中排序的字段，排序的字段若通过索引去访问将大大提高排序速度</li>\n<li>查询中统计或者分组字段</li>\n</ol>\n<h2 id=\"8、哪些情况不需要创建索引\"><a href=\"#8、哪些情况不需要创建索引\" class=\"headerlink\" title=\"8、哪些情况不需要创建索引\"></a>8、哪些情况不需要创建索引</h2><ol>\n<li>表记录太少</li>\n<li>经常增删改的表<br>　　　　提高了查询速度，同时却会降低更新表的速度，如对表进行INSERT、UPDATE、和DELETE。<br>　　　　因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件。<br>　　　　数据重复且分布平均的表字段，因此应该只为最经常查询和最经常排序的数据建立索引。</li>\n<li>注意，如果某个数据列包含许多重复的内容，为它建立索引就没有太大的实际效果。</li>\n<li>频繁更新的字段不适合建立索引，因为每次更新不单单是更新了记录还会更新索引</li>\n<li>WHERE条件里用不到的字段不创建索引</li>\n</ol>"},{"title":"Mysql事务的隔离级别","keyword":["Mysql","事务","隔离级别"],"date":"2018-04-11T06:02:50.000Z","_content":"\n隔离级别 | 脏读 | 不可重复读 | 幻读\n:- | :-: | :-: | :-:\nread-unconmitted | √ | √ | √\nread-conmitted | × | √ | √\nrepeatable-read | × | × | √\nserializable | × | × | ×\n\n<!--more-->\n\n## 1、事务的基本要素(ACID)\n\n - 原子性（Atomicity）：事务开始后所有操作，要么全部做完，要么全部不做，不可能停滞在中间环节。事务执行过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发生一样。也就是说事务是一个不可分割的整体，就像化学中学过的原子，是物质构成的基本单位。\n - 一致性（Consistency）：事务开始前和结束后，数据库的完整性约束没有被破坏 。比如A向B转账，不可能A扣了钱，B却没收到。\n - 隔离性（Isolation）：同一时间，只允许一个事务请求同一数据，不同的事务之间彼此没有任何干扰。比如A正在从一张银行卡中取钱，在A取钱的过程结束前，B不能向这张卡转账。\n - 持久性（Durability）：事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。\n\n## 2、隔离级别\n\n - read-unconmitted\n\n    可以读到其他事务未提交的数据，是最低级别的事务隔离级别。\n    \n    例如：事务A读取了事务B更新的数据，然后B回滚操作，那么A读取到的数据是错误的，称之为**脏数据**。\n    \n - read-conmitted\n\n    为了解决脏读，就需要保证读取被事务提交的数据，也就是**read-conmitted**。\n    \n    **看一个例子**：\n    \n        事务A读一个数据，读到100.\n        此时另外一个线程执行事务B将数据改为200，并提交事务。\n        接下来事务A再次读该数据，读到200.\n        \n    这种在一个事务中两次读取到数据不一致的情况，我们称之为**不可重复读**。\n    \n - repeatable-read\n\n    为了解决不可重复读，就需要保证一个事务在操作一份数据时，不允许其他事务操作该数据。此时反应到数据库上，就是需要对行加锁。这种隔离级别称之为**repeatable-read**。\n    \n    **看一个例子**：\n    \n        事务A统计当天营业额（遍历表，计和），为1000.\n        事务B插入一条销售记录，200。\n        事务A再统计当天营业额，为1200.\n        \n    这种一个事务中前后两次统计不一致的情况，称之为**幻读**。\n    \n - serializable\n\n    为了解决幻读，只能严格要求所有线程的所有事务都按照顺序依次执行，也就是 表锁。\n    \n    但是此种级别并发性太差，且一般也没有必要。\n    \n## 3、总结\n\n我们需要区分事务的隔离级别和现象。\n隔离级别是指导原则，现象是产生的问题，而数据库锁则是解决手段。\n\nMysql默认隔离级别是 **repeatable-read**。\nOracle默认隔离级别是 **read-conmitted**。\n \n    \n \n \n \n \n\n\n\n\n","source":"_posts/Mysql事务的隔离级别.md","raw":"---\ntitle: Mysql事务的隔离级别\ncategories:\n  - Mysql\ntags:\n  - Mysql\n  - 数据库\nkeyword:\n  - Mysql\n  - 事务\n  - 隔离级别\ndate: 2018-04-11 14:02:50\n---\n\n隔离级别 | 脏读 | 不可重复读 | 幻读\n:- | :-: | :-: | :-:\nread-unconmitted | √ | √ | √\nread-conmitted | × | √ | √\nrepeatable-read | × | × | √\nserializable | × | × | ×\n\n<!--more-->\n\n## 1、事务的基本要素(ACID)\n\n - 原子性（Atomicity）：事务开始后所有操作，要么全部做完，要么全部不做，不可能停滞在中间环节。事务执行过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发生一样。也就是说事务是一个不可分割的整体，就像化学中学过的原子，是物质构成的基本单位。\n - 一致性（Consistency）：事务开始前和结束后，数据库的完整性约束没有被破坏 。比如A向B转账，不可能A扣了钱，B却没收到。\n - 隔离性（Isolation）：同一时间，只允许一个事务请求同一数据，不同的事务之间彼此没有任何干扰。比如A正在从一张银行卡中取钱，在A取钱的过程结束前，B不能向这张卡转账。\n - 持久性（Durability）：事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。\n\n## 2、隔离级别\n\n - read-unconmitted\n\n    可以读到其他事务未提交的数据，是最低级别的事务隔离级别。\n    \n    例如：事务A读取了事务B更新的数据，然后B回滚操作，那么A读取到的数据是错误的，称之为**脏数据**。\n    \n - read-conmitted\n\n    为了解决脏读，就需要保证读取被事务提交的数据，也就是**read-conmitted**。\n    \n    **看一个例子**：\n    \n        事务A读一个数据，读到100.\n        此时另外一个线程执行事务B将数据改为200，并提交事务。\n        接下来事务A再次读该数据，读到200.\n        \n    这种在一个事务中两次读取到数据不一致的情况，我们称之为**不可重复读**。\n    \n - repeatable-read\n\n    为了解决不可重复读，就需要保证一个事务在操作一份数据时，不允许其他事务操作该数据。此时反应到数据库上，就是需要对行加锁。这种隔离级别称之为**repeatable-read**。\n    \n    **看一个例子**：\n    \n        事务A统计当天营业额（遍历表，计和），为1000.\n        事务B插入一条销售记录，200。\n        事务A再统计当天营业额，为1200.\n        \n    这种一个事务中前后两次统计不一致的情况，称之为**幻读**。\n    \n - serializable\n\n    为了解决幻读，只能严格要求所有线程的所有事务都按照顺序依次执行，也就是 表锁。\n    \n    但是此种级别并发性太差，且一般也没有必要。\n    \n## 3、总结\n\n我们需要区分事务的隔离级别和现象。\n隔离级别是指导原则，现象是产生的问题，而数据库锁则是解决手段。\n\nMysql默认隔离级别是 **repeatable-read**。\nOracle默认隔离级别是 **read-conmitted**。\n \n    \n \n \n \n \n\n\n\n\n","slug":"Mysql事务的隔离级别","published":1,"updated":"2018-04-11T06:06:46.621Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfte001jhwvf0dhdblkz","content":"<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">隔离级别</th>\n<th style=\"text-align:center\">脏读</th>\n<th style=\"text-align:center\">不可重复读</th>\n<th style=\"text-align:center\">幻读</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">read-unconmitted</td>\n<td style=\"text-align:center\">√</td>\n<td style=\"text-align:center\">√</td>\n<td style=\"text-align:center\">√</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">read-conmitted</td>\n<td style=\"text-align:center\">×</td>\n<td style=\"text-align:center\">√</td>\n<td style=\"text-align:center\">√</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">repeatable-read</td>\n<td style=\"text-align:center\">×</td>\n<td style=\"text-align:center\">×</td>\n<td style=\"text-align:center\">√</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">serializable</td>\n<td style=\"text-align:center\">×</td>\n<td style=\"text-align:center\">×</td>\n<td style=\"text-align:center\">×</td>\n</tr>\n</tbody>\n</table>\n<a id=\"more\"></a>\n<h2 id=\"1、事务的基本要素-ACID\"><a href=\"#1、事务的基本要素-ACID\" class=\"headerlink\" title=\"1、事务的基本要素(ACID)\"></a>1、事务的基本要素(ACID)</h2><ul>\n<li>原子性（Atomicity）：事务开始后所有操作，要么全部做完，要么全部不做，不可能停滞在中间环节。事务执行过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发生一样。也就是说事务是一个不可分割的整体，就像化学中学过的原子，是物质构成的基本单位。</li>\n<li>一致性（Consistency）：事务开始前和结束后，数据库的完整性约束没有被破坏 。比如A向B转账，不可能A扣了钱，B却没收到。</li>\n<li>隔离性（Isolation）：同一时间，只允许一个事务请求同一数据，不同的事务之间彼此没有任何干扰。比如A正在从一张银行卡中取钱，在A取钱的过程结束前，B不能向这张卡转账。</li>\n<li>持久性（Durability）：事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。</li>\n</ul>\n<h2 id=\"2、隔离级别\"><a href=\"#2、隔离级别\" class=\"headerlink\" title=\"2、隔离级别\"></a>2、隔离级别</h2><ul>\n<li><p>read-unconmitted</p>\n<p> 可以读到其他事务未提交的数据，是最低级别的事务隔离级别。</p>\n<p> 例如：事务A读取了事务B更新的数据，然后B回滚操作，那么A读取到的数据是错误的，称之为<strong>脏数据</strong>。</p>\n</li>\n<li><p>read-conmitted</p>\n<p> 为了解决脏读，就需要保证读取被事务提交的数据，也就是<strong>read-conmitted</strong>。</p>\n<p> <strong>看一个例子</strong>：</p>\n<pre><code>事务A读一个数据，读到100.\n此时另外一个线程执行事务B将数据改为200，并提交事务。\n接下来事务A再次读该数据，读到200.\n</code></pre><p> 这种在一个事务中两次读取到数据不一致的情况，我们称之为<strong>不可重复读</strong>。</p>\n</li>\n<li><p>repeatable-read</p>\n<p> 为了解决不可重复读，就需要保证一个事务在操作一份数据时，不允许其他事务操作该数据。此时反应到数据库上，就是需要对行加锁。这种隔离级别称之为<strong>repeatable-read</strong>。</p>\n<p> <strong>看一个例子</strong>：</p>\n<pre><code>事务A统计当天营业额（遍历表，计和），为1000.\n事务B插入一条销售记录，200。\n事务A再统计当天营业额，为1200.\n</code></pre><p> 这种一个事务中前后两次统计不一致的情况，称之为<strong>幻读</strong>。</p>\n</li>\n<li><p>serializable</p>\n<p> 为了解决幻读，只能严格要求所有线程的所有事务都按照顺序依次执行，也就是 表锁。</p>\n<p> 但是此种级别并发性太差，且一般也没有必要。</p>\n</li>\n</ul>\n<h2 id=\"3、总结\"><a href=\"#3、总结\" class=\"headerlink\" title=\"3、总结\"></a>3、总结</h2><p>我们需要区分事务的隔离级别和现象。<br>隔离级别是指导原则，现象是产生的问题，而数据库锁则是解决手段。</p>\n<p>Mysql默认隔离级别是 <strong>repeatable-read</strong>。<br>Oracle默认隔离级别是 <strong>read-conmitted</strong>。</p>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">隔离级别</th>\n<th style=\"text-align:center\">脏读</th>\n<th style=\"text-align:center\">不可重复读</th>\n<th style=\"text-align:center\">幻读</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">read-unconmitted</td>\n<td style=\"text-align:center\">√</td>\n<td style=\"text-align:center\">√</td>\n<td style=\"text-align:center\">√</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">read-conmitted</td>\n<td style=\"text-align:center\">×</td>\n<td style=\"text-align:center\">√</td>\n<td style=\"text-align:center\">√</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">repeatable-read</td>\n<td style=\"text-align:center\">×</td>\n<td style=\"text-align:center\">×</td>\n<td style=\"text-align:center\">√</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">serializable</td>\n<td style=\"text-align:center\">×</td>\n<td style=\"text-align:center\">×</td>\n<td style=\"text-align:center\">×</td>\n</tr>\n</tbody>\n</table>","more":"<h2 id=\"1、事务的基本要素-ACID\"><a href=\"#1、事务的基本要素-ACID\" class=\"headerlink\" title=\"1、事务的基本要素(ACID)\"></a>1、事务的基本要素(ACID)</h2><ul>\n<li>原子性（Atomicity）：事务开始后所有操作，要么全部做完，要么全部不做，不可能停滞在中间环节。事务执行过程中出错，会回滚到事务开始前的状态，所有的操作就像没有发生一样。也就是说事务是一个不可分割的整体，就像化学中学过的原子，是物质构成的基本单位。</li>\n<li>一致性（Consistency）：事务开始前和结束后，数据库的完整性约束没有被破坏 。比如A向B转账，不可能A扣了钱，B却没收到。</li>\n<li>隔离性（Isolation）：同一时间，只允许一个事务请求同一数据，不同的事务之间彼此没有任何干扰。比如A正在从一张银行卡中取钱，在A取钱的过程结束前，B不能向这张卡转账。</li>\n<li>持久性（Durability）：事务完成后，事务对数据库的所有更新将被保存到数据库，不能回滚。</li>\n</ul>\n<h2 id=\"2、隔离级别\"><a href=\"#2、隔离级别\" class=\"headerlink\" title=\"2、隔离级别\"></a>2、隔离级别</h2><ul>\n<li><p>read-unconmitted</p>\n<p> 可以读到其他事务未提交的数据，是最低级别的事务隔离级别。</p>\n<p> 例如：事务A读取了事务B更新的数据，然后B回滚操作，那么A读取到的数据是错误的，称之为<strong>脏数据</strong>。</p>\n</li>\n<li><p>read-conmitted</p>\n<p> 为了解决脏读，就需要保证读取被事务提交的数据，也就是<strong>read-conmitted</strong>。</p>\n<p> <strong>看一个例子</strong>：</p>\n<pre><code>事务A读一个数据，读到100.\n此时另外一个线程执行事务B将数据改为200，并提交事务。\n接下来事务A再次读该数据，读到200.\n</code></pre><p> 这种在一个事务中两次读取到数据不一致的情况，我们称之为<strong>不可重复读</strong>。</p>\n</li>\n<li><p>repeatable-read</p>\n<p> 为了解决不可重复读，就需要保证一个事务在操作一份数据时，不允许其他事务操作该数据。此时反应到数据库上，就是需要对行加锁。这种隔离级别称之为<strong>repeatable-read</strong>。</p>\n<p> <strong>看一个例子</strong>：</p>\n<pre><code>事务A统计当天营业额（遍历表，计和），为1000.\n事务B插入一条销售记录，200。\n事务A再统计当天营业额，为1200.\n</code></pre><p> 这种一个事务中前后两次统计不一致的情况，称之为<strong>幻读</strong>。</p>\n</li>\n<li><p>serializable</p>\n<p> 为了解决幻读，只能严格要求所有线程的所有事务都按照顺序依次执行，也就是 表锁。</p>\n<p> 但是此种级别并发性太差，且一般也没有必要。</p>\n</li>\n</ul>\n<h2 id=\"3、总结\"><a href=\"#3、总结\" class=\"headerlink\" title=\"3、总结\"></a>3、总结</h2><p>我们需要区分事务的隔离级别和现象。<br>隔离级别是指导原则，现象是产生的问题，而数据库锁则是解决手段。</p>\n<p>Mysql默认隔离级别是 <strong>repeatable-read</strong>。<br>Oracle默认隔离级别是 <strong>read-conmitted</strong>。</p>"},{"title":"Java线程池的创建","date":"2017-10-12T03:13:25.000Z","_content":"## 1. Executor框架\n\n从JDK 1.5 开始，java.util.concurrent包中的Executor执行器将用来管理Thread对象，从而简化并发编程。\n\n**Executor**是一套线程池管理框架，接口里只有一个方法execute，执行Runnable任务。\n**ExecutorService**接口扩展了Executor，添加了线程生命周期的管理，提供任务终止、返回任务结果等方法。\n**AbstractExecutorService**实现了ExecutorService，提供例如submit方法的默认实现逻辑。\n\n然后到今天的主题**ThreadPoolExecutor**，继承了AbstractExecutorService，提供线程池的具体实现。\n\n<!--more-->\n\n## 2. ThreadPoolExecutor\n\n### 2.1 构造\n\nThreadPoolExecutor的构造方法有四种，下面是参数最全的构造：\n\n```java\npublic ThreadPoolExecutor(int corePoolSize, \n\t\tint maximumPoolSize, \n\t\tlong keepAliveTime, \n\t\tTimeUnit unit, \n\t\tBlockingQueue<Runnable> workQueue, \n\t\tThreadFactory threadFactory,\n        RejectedExecutionHandler handler) {\n\t\n}\n```\n\n - corePoolSize:线程池目标大小，即刚刚创建时的线程数\n - maximumPoolSize: 线程池的最大上限\n - keepAliveTime: 线程的存活时间，当线程池内的线程数量超过corePoolSize，超出存活时间的空闲线程就会被回收；\n - unit: 时间单位\n - workQueue: 缓存队列\n - threadFactory: 线程工厂\n - handler: 缓存队列饱和处理策略\n\n### 2.2 定制线程池\n\nThreadPoolExecutor中有几个预先设置好的线程池，通过Executors的工厂方法创建。\n\n#### 2.2.1 newFixedThreadPool\n\n```java\npublic static ExecutorService newFixedThreadPool(int nThreads) {\n        return new ThreadPoolExecutor(nThreads, nThreads,\n                                      0L, TimeUnit.MILLISECONDS,\n                                      new LinkedBlockingQueue<Runnable>());\n    }\n```\n\nnewFixedThreadPool的corePoolSize和maximumPoolSize都设置为传入的固定数量，keepAliveTim设置为0。线程池创建后，线程数量将会固定不变，适合需要线程很稳定的场合。\n\n#### 2.2.2 newSingleThreadExecutor\n\n```java\npublic static ExecutorService newSingleThreadExecutor() {\n        return new FinalizableDelegatedExecutorService\n            (new ThreadPoolExecutor(1, 1,\n                                    0L, TimeUnit.MILLISECONDS,\n                                    new LinkedBlockingQueue<Runnable>()));\n    }\n```\n\nnewSingleThreadExecutor是线程数量固定为1的newFixedThreadPool版本，保证池内的任务串行。注意到返回的是FinalizableDelegatedExecutorService，来看看源码：\n\n```java\nstatic class FinalizableDelegatedExecutorService\n    extends DelegatedExecutorService {\n    FinalizableDelegatedExecutorService(ExecutorService executor) {\n        super(executor);\n    }\n    protected void finalize() {\n        super.shutdown();\n    }\n}\n```\nFinalizableDelegatedExecutorService继承了DelegatedExecutorService，仅仅在gc时增加关闭线程池的操作，再来看看DelegatedExecutorService的源码：\n\n```java\nstatic class DelegatedExecutorService extends AbstractExecutorService {\n        private final ExecutorService e;\n        DelegatedExecutorService(ExecutorService executor) { e = executor; }\n        public void execute(Runnable command) { e.execute(command); }\n        public void shutdown() { e.shutdown(); }\n        public List<Runnable> shutdownNow() { return e.shutdownNow(); }\n        public boolean isShutdown() { return e.isShutdown(); }\n        public boolean isTerminated() { return e.isTerminated(); }\n        ...\n}\n```\nDelegatedExecutorService包装了ExecutorService，使其只暴露出ExecutorService的方法，因此不能再配置线程池的参数。本来，线程池创建的参数是可以调整的，ThreadPoolExecutor提供了set方法。使用newSingleThreadExecutor目的是生成单线程串行的线程池，如果还能配置线程池大小，那就没意思了。\n\nExecutors还提供了unconfigurableExecutorService方法，将普通线程池包装成不可配置的线程池。如果不想线程池被不明所以的后人修改，可以调用这个方法。\n\n#### 2.2.3 newCachedThreadPool\n\n```java\npublic static ExecutorService newCachedThreadPool() {\n    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,\n                                  60L, TimeUnit.SECONDS,\n                                  new SynchronousQueue<Runnable>());\n}\n```\n\nnewCachedThreadPool生成一个会缓存的线程池，线程数量可以从0到Integer.MAX_VALUE，超时时间为1分钟。线程池用起来的效果是：如果有空闲线程，会复用线程；如果没有空闲线程，会新建线程；如果线程空闲超过1分钟，将会被回收。\n\n#### 2.2.4 newScheduledThreadPool\n\n```java\npublic static ScheduledExecutorService newScheduledThreadPool(int corePoolSize) {\n        return new ScheduledThreadPoolExecutor(corePoolSize);\n    }\n```\n```java\npublic ScheduledThreadPoolExecutor(int corePoolSize) {\n        super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS,\n              new DelayedWorkQueue());\n    }\n```\n\nnewScheduledThreadPool将会创建一个可定时执行任务的线程池。这个不打算在本文展开，后续会另开文章细讲。\n\n### 2.3 等待队列\n\n看完上面四个预设置的线程池，回发现在构造中都有一个 **Queue** 参数。\n\n线程池的大小或有限（newFixedThreadPool）、或几乎无限（newCachedThreadPool），但是系统资源是有限的，任务的处理速度总有可能比不上任务的提交速度。因此，可以为ThreadPoolExecutor提供一个阻塞队列来保存因线程不足而等待的Runnable任务，这就是BlockingQueue。\n\nExecutor提供了以下几种等待队列（部分）：\n\n - ArrayBlockingQueue：数组结构的阻塞队列\n - LinkedBlockingQueue：链表结构的阻塞队列\n - PriorityBlockingQueue：有优先级的阻塞队列\n - SynchronousQueue：不会存储元素的阻塞队列\n - DelayedWorkQueue\n\nnewFixedThreadPool和newSingleThreadExecutor在默认情况下使用一个**无界的LinkedBlockingQueue**。要注意的是，如果任务一直提交，但线程池又不能及时处理，等待队列将会无限制地加长，系统资源总会有消耗殆尽的一刻。所以，推荐使用有界的等待队列，避免资源耗尽。但解决一个问题，又会带来新问题：队列填满之后，再来新任务，这个时候怎么办？后文会介绍如何处理队列饱和。\n\nnewCachedThreadPool使用的SynchronousQueue十分有趣，看名称是个队列，但它却不能存储元素。要将一个任务放进队列，必须有另一个线程去接收这个任务，一个进就有一个出，队列不会存储任何东西。因此，SynchronousQueue是一种移交机制，不能算是队列。newCachedThreadPool生成的是一个没有上限的线程池，理论上提交多少任务都可以，使用SynchronousQueue作为等待队列正合适。\n\n### 2.4 饱和策略\n\n在上一小节中说道，等待队列不能无限制的增长，但若队列填满了该如何处理？此时就是饱和策略在发挥作用。ThreadPoolExecutor的饱和策略通过传入RejectedExecutionHandler来实现。如果没有为构造函数传入，将会使用默认的defaultHandler。\n\n```java\nprivate static final RejectedExecutionHandler defaultHandler = new AbortPolicy();\n```\n\n - AbortPolicy\n\n```java\npublic static class AbortPolicy implements RejectedExecutionHandler {\n       public AbortPolicy() { }\n       public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n           throw new RejectedExecutionException(\"Task \" + r.toString() + \" rejected from \" + e.toString());\n       }\n   }\n```\n\nAbortPolicy是默认的实现，直接抛出一个RejectedExecutionException异常，让调用者自己处理。除此之外，还有几种饱和策略，来看一下\n\n - DiscardPolicy\n\n```java\npublic static class DiscardPolicy implements RejectedExecutionHandler {\n       public DiscardPolicy() { }\n       public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n       }\n   }\n```\nDiscardPolicy的rejectedExecution直接是空方法，什么也不干。如果队列满了，后续的任务都抛弃掉。\n\n - DiscardOldestPolicy\n\n```java\npublic static class DiscardOldestPolicy implements RejectedExecutionHandler {\n       public DiscardOldestPolicy() { }\n       public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n           if (!e.isShutdown()) {\n               e.getQueue().poll();\n               e.execute(r);\n           }\n       }\n   }\n```\n\nDiscardOldestPolicy会将等待队列里最旧的任务踢走，让新任务得以执行。\n\n - CallerRunsPolicy\n\n```java\npublic static class CallerRunsPolicy implements RejectedExecutionHandler {\n    public CallerRunsPolicy() { }\n    public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n        if (!e.isShutdown()) {\n            r.run();\n        }\n    }\n}\n```\n\nCallerRunsPolicy它既不抛弃新任务，也不抛弃旧任务，而是直接在当前线程运行这个任务。当前线程一般就是主线程啊，让主线程运行任务，说不定就阻塞了。如果不是想清楚了整套方案，还是少用这种策略为妙。\n\n### 2.5 ThreadFactory\n\n每当线程池需要创建一个新线程，都是通过线程工厂获取。如果不为ThreadPoolExecutor设定一个线程工厂，就会使用默认的defaultThreadFactory：\n\n```java\npublic static ThreadFactory defaultThreadFactory() {\n    return new DefaultThreadFactory();\n}\n```\n```java\nstatic class DefaultThreadFactory implements ThreadFactory {\n       private static final AtomicInteger poolNumber = new AtomicInteger(1);\n       private final ThreadGroup group;\n       private final AtomicInteger threadNumber = new AtomicInteger(1);\n       private final String namePrefix;\n\n       DefaultThreadFactory() {\n           SecurityManager s = System.getSecurityManager();\n           group = (s != null) ? s.getThreadGroup() :\n                                 Thread.currentThread().getThreadGroup();\n           namePrefix = \"pool-\" +\n                         poolNumber.getAndIncrement() +\n                        \"-thread-\";\n       }\n\n       public Thread newThread(Runnable r) {\n           Thread t = new Thread(group, r,\n                                 namePrefix + threadNumber.getAndIncrement(),\n                                 0);\n           if (t.isDaemon())\n               t.setDaemon(false);\n           if (t.getPriority() != Thread.NORM_PRIORITY)\n               t.setPriority(Thread.NORM_PRIORITY);\n           return t;\n       }\n   }\n```\n\n平时打印线程池里线程的name时，会输出形如pool-1-thread-1之类的名称，就是在这里设置的。这个默认的线程工厂，创建的线程是普通的非守护线程，如果需要定制，实现ThreadFactory后传给ThreadPoolExecutor即可。\n \n \n[参考文章链接][1]\n \n \n\n\n  [1]: http://www.jianshu.com/p/adbf37ef77bb","source":"_posts/Java线程池的创建.md","raw":"---\ntitle: Java线程池的创建\ncategories:\n  - JavaSE\ntags:\n  - Java\n  - 多线程\ndate: 2017-10-12 11:13:25\n---\n## 1. Executor框架\n\n从JDK 1.5 开始，java.util.concurrent包中的Executor执行器将用来管理Thread对象，从而简化并发编程。\n\n**Executor**是一套线程池管理框架，接口里只有一个方法execute，执行Runnable任务。\n**ExecutorService**接口扩展了Executor，添加了线程生命周期的管理，提供任务终止、返回任务结果等方法。\n**AbstractExecutorService**实现了ExecutorService，提供例如submit方法的默认实现逻辑。\n\n然后到今天的主题**ThreadPoolExecutor**，继承了AbstractExecutorService，提供线程池的具体实现。\n\n<!--more-->\n\n## 2. ThreadPoolExecutor\n\n### 2.1 构造\n\nThreadPoolExecutor的构造方法有四种，下面是参数最全的构造：\n\n```java\npublic ThreadPoolExecutor(int corePoolSize, \n\t\tint maximumPoolSize, \n\t\tlong keepAliveTime, \n\t\tTimeUnit unit, \n\t\tBlockingQueue<Runnable> workQueue, \n\t\tThreadFactory threadFactory,\n        RejectedExecutionHandler handler) {\n\t\n}\n```\n\n - corePoolSize:线程池目标大小，即刚刚创建时的线程数\n - maximumPoolSize: 线程池的最大上限\n - keepAliveTime: 线程的存活时间，当线程池内的线程数量超过corePoolSize，超出存活时间的空闲线程就会被回收；\n - unit: 时间单位\n - workQueue: 缓存队列\n - threadFactory: 线程工厂\n - handler: 缓存队列饱和处理策略\n\n### 2.2 定制线程池\n\nThreadPoolExecutor中有几个预先设置好的线程池，通过Executors的工厂方法创建。\n\n#### 2.2.1 newFixedThreadPool\n\n```java\npublic static ExecutorService newFixedThreadPool(int nThreads) {\n        return new ThreadPoolExecutor(nThreads, nThreads,\n                                      0L, TimeUnit.MILLISECONDS,\n                                      new LinkedBlockingQueue<Runnable>());\n    }\n```\n\nnewFixedThreadPool的corePoolSize和maximumPoolSize都设置为传入的固定数量，keepAliveTim设置为0。线程池创建后，线程数量将会固定不变，适合需要线程很稳定的场合。\n\n#### 2.2.2 newSingleThreadExecutor\n\n```java\npublic static ExecutorService newSingleThreadExecutor() {\n        return new FinalizableDelegatedExecutorService\n            (new ThreadPoolExecutor(1, 1,\n                                    0L, TimeUnit.MILLISECONDS,\n                                    new LinkedBlockingQueue<Runnable>()));\n    }\n```\n\nnewSingleThreadExecutor是线程数量固定为1的newFixedThreadPool版本，保证池内的任务串行。注意到返回的是FinalizableDelegatedExecutorService，来看看源码：\n\n```java\nstatic class FinalizableDelegatedExecutorService\n    extends DelegatedExecutorService {\n    FinalizableDelegatedExecutorService(ExecutorService executor) {\n        super(executor);\n    }\n    protected void finalize() {\n        super.shutdown();\n    }\n}\n```\nFinalizableDelegatedExecutorService继承了DelegatedExecutorService，仅仅在gc时增加关闭线程池的操作，再来看看DelegatedExecutorService的源码：\n\n```java\nstatic class DelegatedExecutorService extends AbstractExecutorService {\n        private final ExecutorService e;\n        DelegatedExecutorService(ExecutorService executor) { e = executor; }\n        public void execute(Runnable command) { e.execute(command); }\n        public void shutdown() { e.shutdown(); }\n        public List<Runnable> shutdownNow() { return e.shutdownNow(); }\n        public boolean isShutdown() { return e.isShutdown(); }\n        public boolean isTerminated() { return e.isTerminated(); }\n        ...\n}\n```\nDelegatedExecutorService包装了ExecutorService，使其只暴露出ExecutorService的方法，因此不能再配置线程池的参数。本来，线程池创建的参数是可以调整的，ThreadPoolExecutor提供了set方法。使用newSingleThreadExecutor目的是生成单线程串行的线程池，如果还能配置线程池大小，那就没意思了。\n\nExecutors还提供了unconfigurableExecutorService方法，将普通线程池包装成不可配置的线程池。如果不想线程池被不明所以的后人修改，可以调用这个方法。\n\n#### 2.2.3 newCachedThreadPool\n\n```java\npublic static ExecutorService newCachedThreadPool() {\n    return new ThreadPoolExecutor(0, Integer.MAX_VALUE,\n                                  60L, TimeUnit.SECONDS,\n                                  new SynchronousQueue<Runnable>());\n}\n```\n\nnewCachedThreadPool生成一个会缓存的线程池，线程数量可以从0到Integer.MAX_VALUE，超时时间为1分钟。线程池用起来的效果是：如果有空闲线程，会复用线程；如果没有空闲线程，会新建线程；如果线程空闲超过1分钟，将会被回收。\n\n#### 2.2.4 newScheduledThreadPool\n\n```java\npublic static ScheduledExecutorService newScheduledThreadPool(int corePoolSize) {\n        return new ScheduledThreadPoolExecutor(corePoolSize);\n    }\n```\n```java\npublic ScheduledThreadPoolExecutor(int corePoolSize) {\n        super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS,\n              new DelayedWorkQueue());\n    }\n```\n\nnewScheduledThreadPool将会创建一个可定时执行任务的线程池。这个不打算在本文展开，后续会另开文章细讲。\n\n### 2.3 等待队列\n\n看完上面四个预设置的线程池，回发现在构造中都有一个 **Queue** 参数。\n\n线程池的大小或有限（newFixedThreadPool）、或几乎无限（newCachedThreadPool），但是系统资源是有限的，任务的处理速度总有可能比不上任务的提交速度。因此，可以为ThreadPoolExecutor提供一个阻塞队列来保存因线程不足而等待的Runnable任务，这就是BlockingQueue。\n\nExecutor提供了以下几种等待队列（部分）：\n\n - ArrayBlockingQueue：数组结构的阻塞队列\n - LinkedBlockingQueue：链表结构的阻塞队列\n - PriorityBlockingQueue：有优先级的阻塞队列\n - SynchronousQueue：不会存储元素的阻塞队列\n - DelayedWorkQueue\n\nnewFixedThreadPool和newSingleThreadExecutor在默认情况下使用一个**无界的LinkedBlockingQueue**。要注意的是，如果任务一直提交，但线程池又不能及时处理，等待队列将会无限制地加长，系统资源总会有消耗殆尽的一刻。所以，推荐使用有界的等待队列，避免资源耗尽。但解决一个问题，又会带来新问题：队列填满之后，再来新任务，这个时候怎么办？后文会介绍如何处理队列饱和。\n\nnewCachedThreadPool使用的SynchronousQueue十分有趣，看名称是个队列，但它却不能存储元素。要将一个任务放进队列，必须有另一个线程去接收这个任务，一个进就有一个出，队列不会存储任何东西。因此，SynchronousQueue是一种移交机制，不能算是队列。newCachedThreadPool生成的是一个没有上限的线程池，理论上提交多少任务都可以，使用SynchronousQueue作为等待队列正合适。\n\n### 2.4 饱和策略\n\n在上一小节中说道，等待队列不能无限制的增长，但若队列填满了该如何处理？此时就是饱和策略在发挥作用。ThreadPoolExecutor的饱和策略通过传入RejectedExecutionHandler来实现。如果没有为构造函数传入，将会使用默认的defaultHandler。\n\n```java\nprivate static final RejectedExecutionHandler defaultHandler = new AbortPolicy();\n```\n\n - AbortPolicy\n\n```java\npublic static class AbortPolicy implements RejectedExecutionHandler {\n       public AbortPolicy() { }\n       public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n           throw new RejectedExecutionException(\"Task \" + r.toString() + \" rejected from \" + e.toString());\n       }\n   }\n```\n\nAbortPolicy是默认的实现，直接抛出一个RejectedExecutionException异常，让调用者自己处理。除此之外，还有几种饱和策略，来看一下\n\n - DiscardPolicy\n\n```java\npublic static class DiscardPolicy implements RejectedExecutionHandler {\n       public DiscardPolicy() { }\n       public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n       }\n   }\n```\nDiscardPolicy的rejectedExecution直接是空方法，什么也不干。如果队列满了，后续的任务都抛弃掉。\n\n - DiscardOldestPolicy\n\n```java\npublic static class DiscardOldestPolicy implements RejectedExecutionHandler {\n       public DiscardOldestPolicy() { }\n       public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n           if (!e.isShutdown()) {\n               e.getQueue().poll();\n               e.execute(r);\n           }\n       }\n   }\n```\n\nDiscardOldestPolicy会将等待队列里最旧的任务踢走，让新任务得以执行。\n\n - CallerRunsPolicy\n\n```java\npublic static class CallerRunsPolicy implements RejectedExecutionHandler {\n    public CallerRunsPolicy() { }\n    public void rejectedExecution(Runnable r, ThreadPoolExecutor e) {\n        if (!e.isShutdown()) {\n            r.run();\n        }\n    }\n}\n```\n\nCallerRunsPolicy它既不抛弃新任务，也不抛弃旧任务，而是直接在当前线程运行这个任务。当前线程一般就是主线程啊，让主线程运行任务，说不定就阻塞了。如果不是想清楚了整套方案，还是少用这种策略为妙。\n\n### 2.5 ThreadFactory\n\n每当线程池需要创建一个新线程，都是通过线程工厂获取。如果不为ThreadPoolExecutor设定一个线程工厂，就会使用默认的defaultThreadFactory：\n\n```java\npublic static ThreadFactory defaultThreadFactory() {\n    return new DefaultThreadFactory();\n}\n```\n```java\nstatic class DefaultThreadFactory implements ThreadFactory {\n       private static final AtomicInteger poolNumber = new AtomicInteger(1);\n       private final ThreadGroup group;\n       private final AtomicInteger threadNumber = new AtomicInteger(1);\n       private final String namePrefix;\n\n       DefaultThreadFactory() {\n           SecurityManager s = System.getSecurityManager();\n           group = (s != null) ? s.getThreadGroup() :\n                                 Thread.currentThread().getThreadGroup();\n           namePrefix = \"pool-\" +\n                         poolNumber.getAndIncrement() +\n                        \"-thread-\";\n       }\n\n       public Thread newThread(Runnable r) {\n           Thread t = new Thread(group, r,\n                                 namePrefix + threadNumber.getAndIncrement(),\n                                 0);\n           if (t.isDaemon())\n               t.setDaemon(false);\n           if (t.getPriority() != Thread.NORM_PRIORITY)\n               t.setPriority(Thread.NORM_PRIORITY);\n           return t;\n       }\n   }\n```\n\n平时打印线程池里线程的name时，会输出形如pool-1-thread-1之类的名称，就是在这里设置的。这个默认的线程工厂，创建的线程是普通的非守护线程，如果需要定制，实现ThreadFactory后传给ThreadPoolExecutor即可。\n \n \n[参考文章链接][1]\n \n \n\n\n  [1]: http://www.jianshu.com/p/adbf37ef77bb","slug":"Java线程池的创建","published":1,"updated":"2018-02-27T07:38:38.085Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfth001mhwvfnctznxiv","content":"<h2 id=\"1-Executor框架\"><a href=\"#1-Executor框架\" class=\"headerlink\" title=\"1. Executor框架\"></a>1. Executor框架</h2><p>从JDK 1.5 开始，java.util.concurrent包中的Executor执行器将用来管理Thread对象，从而简化并发编程。</p>\n<p><strong>Executor</strong>是一套线程池管理框架，接口里只有一个方法execute，执行Runnable任务。<br><strong>ExecutorService</strong>接口扩展了Executor，添加了线程生命周期的管理，提供任务终止、返回任务结果等方法。<br><strong>AbstractExecutorService</strong>实现了ExecutorService，提供例如submit方法的默认实现逻辑。</p>\n<p>然后到今天的主题<strong>ThreadPoolExecutor</strong>，继承了AbstractExecutorService，提供线程池的具体实现。</p>\n<a id=\"more\"></a>\n<h2 id=\"2-ThreadPoolExecutor\"><a href=\"#2-ThreadPoolExecutor\" class=\"headerlink\" title=\"2. ThreadPoolExecutor\"></a>2. ThreadPoolExecutor</h2><h3 id=\"2-1-构造\"><a href=\"#2-1-构造\" class=\"headerlink\" title=\"2.1 构造\"></a>2.1 构造</h3><p>ThreadPoolExecutor的构造方法有四种，下面是参数最全的构造：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ThreadPoolExecutor</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize, </span></span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> maximumPoolSize, </div><div class=\"line\">\t\t<span class=\"keyword\">long</span> keepAliveTime, </div><div class=\"line\">\t\tTimeUnit unit, </div><div class=\"line\">\t\tBlockingQueue&lt;Runnable&gt; workQueue, </div><div class=\"line\">\t\tThreadFactory threadFactory,</div><div class=\"line\">        RejectedExecutionHandler handler) &#123;</div><div class=\"line\">\t</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<ul>\n<li>corePoolSize:线程池目标大小，即刚刚创建时的线程数</li>\n<li>maximumPoolSize: 线程池的最大上限</li>\n<li>keepAliveTime: 线程的存活时间，当线程池内的线程数量超过corePoolSize，超出存活时间的空闲线程就会被回收；</li>\n<li>unit: 时间单位</li>\n<li>workQueue: 缓存队列</li>\n<li>threadFactory: 线程工厂</li>\n<li>handler: 缓存队列饱和处理策略</li>\n</ul>\n<h3 id=\"2-2-定制线程池\"><a href=\"#2-2-定制线程池\" class=\"headerlink\" title=\"2.2 定制线程池\"></a>2.2 定制线程池</h3><p>ThreadPoolExecutor中有几个预先设置好的线程池，通过Executors的工厂方法创建。</p>\n<h4 id=\"2-2-1-newFixedThreadPool\"><a href=\"#2-2-1-newFixedThreadPool\" class=\"headerlink\" title=\"2.2.1 newFixedThreadPool\"></a>2.2.1 newFixedThreadPool</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ExecutorService <span class=\"title\">newFixedThreadPool</span><span class=\"params\">(<span class=\"keyword\">int</span> nThreads)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ThreadPoolExecutor(nThreads, nThreads,</div><div class=\"line\">                                      <span class=\"number\">0L</span>, TimeUnit.MILLISECONDS,</div><div class=\"line\">                                      <span class=\"keyword\">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<p>newFixedThreadPool的corePoolSize和maximumPoolSize都设置为传入的固定数量，keepAliveTim设置为0。线程池创建后，线程数量将会固定不变，适合需要线程很稳定的场合。</p>\n<h4 id=\"2-2-2-newSingleThreadExecutor\"><a href=\"#2-2-2-newSingleThreadExecutor\" class=\"headerlink\" title=\"2.2.2 newSingleThreadExecutor\"></a>2.2.2 newSingleThreadExecutor</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ExecutorService <span class=\"title\">newSingleThreadExecutor</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> FinalizableDelegatedExecutorService</div><div class=\"line\">            (<span class=\"keyword\">new</span> ThreadPoolExecutor(<span class=\"number\">1</span>, <span class=\"number\">1</span>,</div><div class=\"line\">                                    <span class=\"number\">0L</span>, TimeUnit.MILLISECONDS,</div><div class=\"line\">                                    <span class=\"keyword\">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<p>newSingleThreadExecutor是线程数量固定为1的newFixedThreadPool版本，保证池内的任务串行。注意到返回的是FinalizableDelegatedExecutorService，来看看源码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FinalizableDelegatedExecutorService</span></span></div><div class=\"line\">    <span class=\"keyword\">extends</span> <span class=\"title\">DelegatedExecutorService</span> &#123;</div><div class=\"line\">    FinalizableDelegatedExecutorService(ExecutorService executor) &#123;</div><div class=\"line\">        <span class=\"keyword\">super</span>(executor);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">finalize</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">super</span>.shutdown();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>FinalizableDelegatedExecutorService继承了DelegatedExecutorService，仅仅在gc时增加关闭线程池的操作，再来看看DelegatedExecutorService的源码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DelegatedExecutorService</span> <span class=\"keyword\">extends</span> <span class=\"title\">AbstractExecutorService</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ExecutorService e;</div><div class=\"line\">        DelegatedExecutorService(ExecutorService executor) &#123; e = executor; &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">execute</span><span class=\"params\">(Runnable command)</span> </span>&#123; e.execute(command); &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">shutdown</span><span class=\"params\">()</span> </span>&#123; e.shutdown(); &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Runnable&gt; <span class=\"title\">shutdownNow</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> e.shutdownNow(); &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isShutdown</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> e.isShutdown(); &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isTerminated</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> e.isTerminated(); &#125;</div><div class=\"line\">        ...</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>DelegatedExecutorService包装了ExecutorService，使其只暴露出ExecutorService的方法，因此不能再配置线程池的参数。本来，线程池创建的参数是可以调整的，ThreadPoolExecutor提供了set方法。使用newSingleThreadExecutor目的是生成单线程串行的线程池，如果还能配置线程池大小，那就没意思了。</p>\n<p>Executors还提供了unconfigurableExecutorService方法，将普通线程池包装成不可配置的线程池。如果不想线程池被不明所以的后人修改，可以调用这个方法。</p>\n<h4 id=\"2-2-3-newCachedThreadPool\"><a href=\"#2-2-3-newCachedThreadPool\" class=\"headerlink\" title=\"2.2.3 newCachedThreadPool\"></a>2.2.3 newCachedThreadPool</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ExecutorService <span class=\"title\">newCachedThreadPool</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ThreadPoolExecutor(<span class=\"number\">0</span>, Integer.MAX_VALUE,</div><div class=\"line\">                                  <span class=\"number\">60L</span>, TimeUnit.SECONDS,</div><div class=\"line\">                                  <span class=\"keyword\">new</span> SynchronousQueue&lt;Runnable&gt;());</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>newCachedThreadPool生成一个会缓存的线程池，线程数量可以从0到Integer.MAX_VALUE，超时时间为1分钟。线程池用起来的效果是：如果有空闲线程，会复用线程；如果没有空闲线程，会新建线程；如果线程空闲超过1分钟，将会被回收。</p>\n<h4 id=\"2-2-4-newScheduledThreadPool\"><a href=\"#2-2-4-newScheduledThreadPool\" class=\"headerlink\" title=\"2.2.4 newScheduledThreadPool\"></a>2.2.4 newScheduledThreadPool</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ScheduledExecutorService <span class=\"title\">newScheduledThreadPool</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ScheduledThreadPoolExecutor(corePoolSize);</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ScheduledThreadPoolExecutor</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">super</span>(corePoolSize, Integer.MAX_VALUE, <span class=\"number\">0</span>, NANOSECONDS,</div><div class=\"line\">              <span class=\"keyword\">new</span> DelayedWorkQueue());</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<p>newScheduledThreadPool将会创建一个可定时执行任务的线程池。这个不打算在本文展开，后续会另开文章细讲。</p>\n<h3 id=\"2-3-等待队列\"><a href=\"#2-3-等待队列\" class=\"headerlink\" title=\"2.3 等待队列\"></a>2.3 等待队列</h3><p>看完上面四个预设置的线程池，回发现在构造中都有一个 <strong>Queue</strong> 参数。</p>\n<p>线程池的大小或有限（newFixedThreadPool）、或几乎无限（newCachedThreadPool），但是系统资源是有限的，任务的处理速度总有可能比不上任务的提交速度。因此，可以为ThreadPoolExecutor提供一个阻塞队列来保存因线程不足而等待的Runnable任务，这就是BlockingQueue。</p>\n<p>Executor提供了以下几种等待队列（部分）：</p>\n<ul>\n<li>ArrayBlockingQueue：数组结构的阻塞队列</li>\n<li>LinkedBlockingQueue：链表结构的阻塞队列</li>\n<li>PriorityBlockingQueue：有优先级的阻塞队列</li>\n<li>SynchronousQueue：不会存储元素的阻塞队列</li>\n<li>DelayedWorkQueue</li>\n</ul>\n<p>newFixedThreadPool和newSingleThreadExecutor在默认情况下使用一个<strong>无界的LinkedBlockingQueue</strong>。要注意的是，如果任务一直提交，但线程池又不能及时处理，等待队列将会无限制地加长，系统资源总会有消耗殆尽的一刻。所以，推荐使用有界的等待队列，避免资源耗尽。但解决一个问题，又会带来新问题：队列填满之后，再来新任务，这个时候怎么办？后文会介绍如何处理队列饱和。</p>\n<p>newCachedThreadPool使用的SynchronousQueue十分有趣，看名称是个队列，但它却不能存储元素。要将一个任务放进队列，必须有另一个线程去接收这个任务，一个进就有一个出，队列不会存储任何东西。因此，SynchronousQueue是一种移交机制，不能算是队列。newCachedThreadPool生成的是一个没有上限的线程池，理论上提交多少任务都可以，使用SynchronousQueue作为等待队列正合适。</p>\n<h3 id=\"2-4-饱和策略\"><a href=\"#2-4-饱和策略\" class=\"headerlink\" title=\"2.4 饱和策略\"></a>2.4 饱和策略</h3><p>在上一小节中说道，等待队列不能无限制的增长，但若队列填满了该如何处理？此时就是饱和策略在发挥作用。ThreadPoolExecutor的饱和策略通过传入RejectedExecutionHandler来实现。如果没有为构造函数传入，将会使用默认的defaultHandler。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> RejectedExecutionHandler defaultHandler = <span class=\"keyword\">new</span> AbortPolicy();</div></pre></td></tr></table></figure>\n<ul>\n<li>AbortPolicy</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AbortPolicy</span> <span class=\"keyword\">implements</span> <span class=\"title\">RejectedExecutionHandler</span> </span>&#123;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">AbortPolicy</span><span class=\"params\">()</span> </span>&#123; &#125;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rejectedExecution</span><span class=\"params\">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class=\"line\">           <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RejectedExecutionException(<span class=\"string\">\"Task \"</span> + r.toString() + <span class=\"string\">\" rejected from \"</span> + e.toString());</div><div class=\"line\">       &#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n<p>AbortPolicy是默认的实现，直接抛出一个RejectedExecutionException异常，让调用者自己处理。除此之外，还有几种饱和策略，来看一下</p>\n<ul>\n<li>DiscardPolicy</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DiscardPolicy</span> <span class=\"keyword\">implements</span> <span class=\"title\">RejectedExecutionHandler</span> </span>&#123;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">DiscardPolicy</span><span class=\"params\">()</span> </span>&#123; &#125;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rejectedExecution</span><span class=\"params\">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class=\"line\">       &#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n<p>DiscardPolicy的rejectedExecution直接是空方法，什么也不干。如果队列满了，后续的任务都抛弃掉。</p>\n<ul>\n<li>DiscardOldestPolicy</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DiscardOldestPolicy</span> <span class=\"keyword\">implements</span> <span class=\"title\">RejectedExecutionHandler</span> </span>&#123;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">DiscardOldestPolicy</span><span class=\"params\">()</span> </span>&#123; &#125;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rejectedExecution</span><span class=\"params\">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class=\"line\">           <span class=\"keyword\">if</span> (!e.isShutdown()) &#123;</div><div class=\"line\">               e.getQueue().poll();</div><div class=\"line\">               e.execute(r);</div><div class=\"line\">           &#125;</div><div class=\"line\">       &#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n<p>DiscardOldestPolicy会将等待队列里最旧的任务踢走，让新任务得以执行。</p>\n<ul>\n<li>CallerRunsPolicy</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CallerRunsPolicy</span> <span class=\"keyword\">implements</span> <span class=\"title\">RejectedExecutionHandler</span> </span>&#123;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">CallerRunsPolicy</span><span class=\"params\">()</span> </span>&#123; &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rejectedExecution</span><span class=\"params\">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (!e.isShutdown()) &#123;</div><div class=\"line\">            r.run();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>CallerRunsPolicy它既不抛弃新任务，也不抛弃旧任务，而是直接在当前线程运行这个任务。当前线程一般就是主线程啊，让主线程运行任务，说不定就阻塞了。如果不是想清楚了整套方案，还是少用这种策略为妙。</p>\n<h3 id=\"2-5-ThreadFactory\"><a href=\"#2-5-ThreadFactory\" class=\"headerlink\" title=\"2.5 ThreadFactory\"></a>2.5 ThreadFactory</h3><p>每当线程池需要创建一个新线程，都是通过线程工厂获取。如果不为ThreadPoolExecutor设定一个线程工厂，就会使用默认的defaultThreadFactory：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ThreadFactory <span class=\"title\">defaultThreadFactory</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> DefaultThreadFactory();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DefaultThreadFactory</span> <span class=\"keyword\">implements</span> <span class=\"title\">ThreadFactory</span> </span>&#123;</div><div class=\"line\">       <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> AtomicInteger poolNumber = <span class=\"keyword\">new</span> AtomicInteger(<span class=\"number\">1</span>);</div><div class=\"line\">       <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ThreadGroup group;</div><div class=\"line\">       <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> AtomicInteger threadNumber = <span class=\"keyword\">new</span> AtomicInteger(<span class=\"number\">1</span>);</div><div class=\"line\">       <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> String namePrefix;</div><div class=\"line\"></div><div class=\"line\">       DefaultThreadFactory() &#123;</div><div class=\"line\">           SecurityManager s = System.getSecurityManager();</div><div class=\"line\">           group = (s != <span class=\"keyword\">null</span>) ? s.getThreadGroup() :</div><div class=\"line\">                                 Thread.currentThread().getThreadGroup();</div><div class=\"line\">           namePrefix = <span class=\"string\">\"pool-\"</span> +</div><div class=\"line\">                         poolNumber.getAndIncrement() +</div><div class=\"line\">                        <span class=\"string\">\"-thread-\"</span>;</div><div class=\"line\">       &#125;</div><div class=\"line\"></div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> Thread <span class=\"title\">newThread</span><span class=\"params\">(Runnable r)</span> </span>&#123;</div><div class=\"line\">           Thread t = <span class=\"keyword\">new</span> Thread(group, r,</div><div class=\"line\">                                 namePrefix + threadNumber.getAndIncrement(),</div><div class=\"line\">                                 <span class=\"number\">0</span>);</div><div class=\"line\">           <span class=\"keyword\">if</span> (t.isDaemon())</div><div class=\"line\">               t.setDaemon(<span class=\"keyword\">false</span>);</div><div class=\"line\">           <span class=\"keyword\">if</span> (t.getPriority() != Thread.NORM_PRIORITY)</div><div class=\"line\">               t.setPriority(Thread.NORM_PRIORITY);</div><div class=\"line\">           <span class=\"keyword\">return</span> t;</div><div class=\"line\">       &#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n<p>平时打印线程池里线程的name时，会输出形如pool-1-thread-1之类的名称，就是在这里设置的。这个默认的线程工厂，创建的线程是普通的非守护线程，如果需要定制，实现ThreadFactory后传给ThreadPoolExecutor即可。</p>\n<p><a href=\"http://www.jianshu.com/p/adbf37ef77bb\" target=\"_blank\" rel=\"noopener\">参考文章链接</a></p>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<h2 id=\"1-Executor框架\"><a href=\"#1-Executor框架\" class=\"headerlink\" title=\"1. Executor框架\"></a>1. Executor框架</h2><p>从JDK 1.5 开始，java.util.concurrent包中的Executor执行器将用来管理Thread对象，从而简化并发编程。</p>\n<p><strong>Executor</strong>是一套线程池管理框架，接口里只有一个方法execute，执行Runnable任务。<br><strong>ExecutorService</strong>接口扩展了Executor，添加了线程生命周期的管理，提供任务终止、返回任务结果等方法。<br><strong>AbstractExecutorService</strong>实现了ExecutorService，提供例如submit方法的默认实现逻辑。</p>\n<p>然后到今天的主题<strong>ThreadPoolExecutor</strong>，继承了AbstractExecutorService，提供线程池的具体实现。</p>","more":"<h2 id=\"2-ThreadPoolExecutor\"><a href=\"#2-ThreadPoolExecutor\" class=\"headerlink\" title=\"2. ThreadPoolExecutor\"></a>2. ThreadPoolExecutor</h2><h3 id=\"2-1-构造\"><a href=\"#2-1-构造\" class=\"headerlink\" title=\"2.1 构造\"></a>2.1 构造</h3><p>ThreadPoolExecutor的构造方法有四种，下面是参数最全的构造：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ThreadPoolExecutor</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize, </span></span></div><div class=\"line\">\t\t<span class=\"keyword\">int</span> maximumPoolSize, </div><div class=\"line\">\t\t<span class=\"keyword\">long</span> keepAliveTime, </div><div class=\"line\">\t\tTimeUnit unit, </div><div class=\"line\">\t\tBlockingQueue&lt;Runnable&gt; workQueue, </div><div class=\"line\">\t\tThreadFactory threadFactory,</div><div class=\"line\">        RejectedExecutionHandler handler) &#123;</div><div class=\"line\">\t</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<ul>\n<li>corePoolSize:线程池目标大小，即刚刚创建时的线程数</li>\n<li>maximumPoolSize: 线程池的最大上限</li>\n<li>keepAliveTime: 线程的存活时间，当线程池内的线程数量超过corePoolSize，超出存活时间的空闲线程就会被回收；</li>\n<li>unit: 时间单位</li>\n<li>workQueue: 缓存队列</li>\n<li>threadFactory: 线程工厂</li>\n<li>handler: 缓存队列饱和处理策略</li>\n</ul>\n<h3 id=\"2-2-定制线程池\"><a href=\"#2-2-定制线程池\" class=\"headerlink\" title=\"2.2 定制线程池\"></a>2.2 定制线程池</h3><p>ThreadPoolExecutor中有几个预先设置好的线程池，通过Executors的工厂方法创建。</p>\n<h4 id=\"2-2-1-newFixedThreadPool\"><a href=\"#2-2-1-newFixedThreadPool\" class=\"headerlink\" title=\"2.2.1 newFixedThreadPool\"></a>2.2.1 newFixedThreadPool</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ExecutorService <span class=\"title\">newFixedThreadPool</span><span class=\"params\">(<span class=\"keyword\">int</span> nThreads)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ThreadPoolExecutor(nThreads, nThreads,</div><div class=\"line\">                                      <span class=\"number\">0L</span>, TimeUnit.MILLISECONDS,</div><div class=\"line\">                                      <span class=\"keyword\">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<p>newFixedThreadPool的corePoolSize和maximumPoolSize都设置为传入的固定数量，keepAliveTim设置为0。线程池创建后，线程数量将会固定不变，适合需要线程很稳定的场合。</p>\n<h4 id=\"2-2-2-newSingleThreadExecutor\"><a href=\"#2-2-2-newSingleThreadExecutor\" class=\"headerlink\" title=\"2.2.2 newSingleThreadExecutor\"></a>2.2.2 newSingleThreadExecutor</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ExecutorService <span class=\"title\">newSingleThreadExecutor</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> FinalizableDelegatedExecutorService</div><div class=\"line\">            (<span class=\"keyword\">new</span> ThreadPoolExecutor(<span class=\"number\">1</span>, <span class=\"number\">1</span>,</div><div class=\"line\">                                    <span class=\"number\">0L</span>, TimeUnit.MILLISECONDS,</div><div class=\"line\">                                    <span class=\"keyword\">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<p>newSingleThreadExecutor是线程数量固定为1的newFixedThreadPool版本，保证池内的任务串行。注意到返回的是FinalizableDelegatedExecutorService，来看看源码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FinalizableDelegatedExecutorService</span></span></div><div class=\"line\">    <span class=\"keyword\">extends</span> <span class=\"title\">DelegatedExecutorService</span> &#123;</div><div class=\"line\">    FinalizableDelegatedExecutorService(ExecutorService executor) &#123;</div><div class=\"line\">        <span class=\"keyword\">super</span>(executor);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">finalize</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">super</span>.shutdown();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>FinalizableDelegatedExecutorService继承了DelegatedExecutorService，仅仅在gc时增加关闭线程池的操作，再来看看DelegatedExecutorService的源码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DelegatedExecutorService</span> <span class=\"keyword\">extends</span> <span class=\"title\">AbstractExecutorService</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ExecutorService e;</div><div class=\"line\">        DelegatedExecutorService(ExecutorService executor) &#123; e = executor; &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">execute</span><span class=\"params\">(Runnable command)</span> </span>&#123; e.execute(command); &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">shutdown</span><span class=\"params\">()</span> </span>&#123; e.shutdown(); &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> List&lt;Runnable&gt; <span class=\"title\">shutdownNow</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> e.shutdownNow(); &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isShutdown</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> e.isShutdown(); &#125;</div><div class=\"line\">        <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isTerminated</span><span class=\"params\">()</span> </span>&#123; <span class=\"keyword\">return</span> e.isTerminated(); &#125;</div><div class=\"line\">        ...</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>DelegatedExecutorService包装了ExecutorService，使其只暴露出ExecutorService的方法，因此不能再配置线程池的参数。本来，线程池创建的参数是可以调整的，ThreadPoolExecutor提供了set方法。使用newSingleThreadExecutor目的是生成单线程串行的线程池，如果还能配置线程池大小，那就没意思了。</p>\n<p>Executors还提供了unconfigurableExecutorService方法，将普通线程池包装成不可配置的线程池。如果不想线程池被不明所以的后人修改，可以调用这个方法。</p>\n<h4 id=\"2-2-3-newCachedThreadPool\"><a href=\"#2-2-3-newCachedThreadPool\" class=\"headerlink\" title=\"2.2.3 newCachedThreadPool\"></a>2.2.3 newCachedThreadPool</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ExecutorService <span class=\"title\">newCachedThreadPool</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ThreadPoolExecutor(<span class=\"number\">0</span>, Integer.MAX_VALUE,</div><div class=\"line\">                                  <span class=\"number\">60L</span>, TimeUnit.SECONDS,</div><div class=\"line\">                                  <span class=\"keyword\">new</span> SynchronousQueue&lt;Runnable&gt;());</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>newCachedThreadPool生成一个会缓存的线程池，线程数量可以从0到Integer.MAX_VALUE，超时时间为1分钟。线程池用起来的效果是：如果有空闲线程，会复用线程；如果没有空闲线程，会新建线程；如果线程空闲超过1分钟，将会被回收。</p>\n<h4 id=\"2-2-4-newScheduledThreadPool\"><a href=\"#2-2-4-newScheduledThreadPool\" class=\"headerlink\" title=\"2.2.4 newScheduledThreadPool\"></a>2.2.4 newScheduledThreadPool</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ScheduledExecutorService <span class=\"title\">newScheduledThreadPool</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> ScheduledThreadPoolExecutor(corePoolSize);</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ScheduledThreadPoolExecutor</span><span class=\"params\">(<span class=\"keyword\">int</span> corePoolSize)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">super</span>(corePoolSize, Integer.MAX_VALUE, <span class=\"number\">0</span>, NANOSECONDS,</div><div class=\"line\">              <span class=\"keyword\">new</span> DelayedWorkQueue());</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<p>newScheduledThreadPool将会创建一个可定时执行任务的线程池。这个不打算在本文展开，后续会另开文章细讲。</p>\n<h3 id=\"2-3-等待队列\"><a href=\"#2-3-等待队列\" class=\"headerlink\" title=\"2.3 等待队列\"></a>2.3 等待队列</h3><p>看完上面四个预设置的线程池，回发现在构造中都有一个 <strong>Queue</strong> 参数。</p>\n<p>线程池的大小或有限（newFixedThreadPool）、或几乎无限（newCachedThreadPool），但是系统资源是有限的，任务的处理速度总有可能比不上任务的提交速度。因此，可以为ThreadPoolExecutor提供一个阻塞队列来保存因线程不足而等待的Runnable任务，这就是BlockingQueue。</p>\n<p>Executor提供了以下几种等待队列（部分）：</p>\n<ul>\n<li>ArrayBlockingQueue：数组结构的阻塞队列</li>\n<li>LinkedBlockingQueue：链表结构的阻塞队列</li>\n<li>PriorityBlockingQueue：有优先级的阻塞队列</li>\n<li>SynchronousQueue：不会存储元素的阻塞队列</li>\n<li>DelayedWorkQueue</li>\n</ul>\n<p>newFixedThreadPool和newSingleThreadExecutor在默认情况下使用一个<strong>无界的LinkedBlockingQueue</strong>。要注意的是，如果任务一直提交，但线程池又不能及时处理，等待队列将会无限制地加长，系统资源总会有消耗殆尽的一刻。所以，推荐使用有界的等待队列，避免资源耗尽。但解决一个问题，又会带来新问题：队列填满之后，再来新任务，这个时候怎么办？后文会介绍如何处理队列饱和。</p>\n<p>newCachedThreadPool使用的SynchronousQueue十分有趣，看名称是个队列，但它却不能存储元素。要将一个任务放进队列，必须有另一个线程去接收这个任务，一个进就有一个出，队列不会存储任何东西。因此，SynchronousQueue是一种移交机制，不能算是队列。newCachedThreadPool生成的是一个没有上限的线程池，理论上提交多少任务都可以，使用SynchronousQueue作为等待队列正合适。</p>\n<h3 id=\"2-4-饱和策略\"><a href=\"#2-4-饱和策略\" class=\"headerlink\" title=\"2.4 饱和策略\"></a>2.4 饱和策略</h3><p>在上一小节中说道，等待队列不能无限制的增长，但若队列填满了该如何处理？此时就是饱和策略在发挥作用。ThreadPoolExecutor的饱和策略通过传入RejectedExecutionHandler来实现。如果没有为构造函数传入，将会使用默认的defaultHandler。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> RejectedExecutionHandler defaultHandler = <span class=\"keyword\">new</span> AbortPolicy();</div></pre></td></tr></table></figure>\n<ul>\n<li>AbortPolicy</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AbortPolicy</span> <span class=\"keyword\">implements</span> <span class=\"title\">RejectedExecutionHandler</span> </span>&#123;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">AbortPolicy</span><span class=\"params\">()</span> </span>&#123; &#125;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rejectedExecution</span><span class=\"params\">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class=\"line\">           <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RejectedExecutionException(<span class=\"string\">\"Task \"</span> + r.toString() + <span class=\"string\">\" rejected from \"</span> + e.toString());</div><div class=\"line\">       &#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n<p>AbortPolicy是默认的实现，直接抛出一个RejectedExecutionException异常，让调用者自己处理。除此之外，还有几种饱和策略，来看一下</p>\n<ul>\n<li>DiscardPolicy</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DiscardPolicy</span> <span class=\"keyword\">implements</span> <span class=\"title\">RejectedExecutionHandler</span> </span>&#123;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">DiscardPolicy</span><span class=\"params\">()</span> </span>&#123; &#125;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rejectedExecution</span><span class=\"params\">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class=\"line\">       &#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n<p>DiscardPolicy的rejectedExecution直接是空方法，什么也不干。如果队列满了，后续的任务都抛弃掉。</p>\n<ul>\n<li>DiscardOldestPolicy</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DiscardOldestPolicy</span> <span class=\"keyword\">implements</span> <span class=\"title\">RejectedExecutionHandler</span> </span>&#123;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">DiscardOldestPolicy</span><span class=\"params\">()</span> </span>&#123; &#125;</div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rejectedExecution</span><span class=\"params\">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class=\"line\">           <span class=\"keyword\">if</span> (!e.isShutdown()) &#123;</div><div class=\"line\">               e.getQueue().poll();</div><div class=\"line\">               e.execute(r);</div><div class=\"line\">           &#125;</div><div class=\"line\">       &#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n<p>DiscardOldestPolicy会将等待队列里最旧的任务踢走，让新任务得以执行。</p>\n<ul>\n<li>CallerRunsPolicy</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CallerRunsPolicy</span> <span class=\"keyword\">implements</span> <span class=\"title\">RejectedExecutionHandler</span> </span>&#123;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">CallerRunsPolicy</span><span class=\"params\">()</span> </span>&#123; &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rejectedExecution</span><span class=\"params\">(Runnable r, ThreadPoolExecutor e)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (!e.isShutdown()) &#123;</div><div class=\"line\">            r.run();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>CallerRunsPolicy它既不抛弃新任务，也不抛弃旧任务，而是直接在当前线程运行这个任务。当前线程一般就是主线程啊，让主线程运行任务，说不定就阻塞了。如果不是想清楚了整套方案，还是少用这种策略为妙。</p>\n<h3 id=\"2-5-ThreadFactory\"><a href=\"#2-5-ThreadFactory\" class=\"headerlink\" title=\"2.5 ThreadFactory\"></a>2.5 ThreadFactory</h3><p>每当线程池需要创建一个新线程，都是通过线程工厂获取。如果不为ThreadPoolExecutor设定一个线程工厂，就会使用默认的defaultThreadFactory：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> ThreadFactory <span class=\"title\">defaultThreadFactory</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> DefaultThreadFactory();</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DefaultThreadFactory</span> <span class=\"keyword\">implements</span> <span class=\"title\">ThreadFactory</span> </span>&#123;</div><div class=\"line\">       <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> AtomicInteger poolNumber = <span class=\"keyword\">new</span> AtomicInteger(<span class=\"number\">1</span>);</div><div class=\"line\">       <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ThreadGroup group;</div><div class=\"line\">       <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> AtomicInteger threadNumber = <span class=\"keyword\">new</span> AtomicInteger(<span class=\"number\">1</span>);</div><div class=\"line\">       <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> String namePrefix;</div><div class=\"line\"></div><div class=\"line\">       DefaultThreadFactory() &#123;</div><div class=\"line\">           SecurityManager s = System.getSecurityManager();</div><div class=\"line\">           group = (s != <span class=\"keyword\">null</span>) ? s.getThreadGroup() :</div><div class=\"line\">                                 Thread.currentThread().getThreadGroup();</div><div class=\"line\">           namePrefix = <span class=\"string\">\"pool-\"</span> +</div><div class=\"line\">                         poolNumber.getAndIncrement() +</div><div class=\"line\">                        <span class=\"string\">\"-thread-\"</span>;</div><div class=\"line\">       &#125;</div><div class=\"line\"></div><div class=\"line\">       <span class=\"function\"><span class=\"keyword\">public</span> Thread <span class=\"title\">newThread</span><span class=\"params\">(Runnable r)</span> </span>&#123;</div><div class=\"line\">           Thread t = <span class=\"keyword\">new</span> Thread(group, r,</div><div class=\"line\">                                 namePrefix + threadNumber.getAndIncrement(),</div><div class=\"line\">                                 <span class=\"number\">0</span>);</div><div class=\"line\">           <span class=\"keyword\">if</span> (t.isDaemon())</div><div class=\"line\">               t.setDaemon(<span class=\"keyword\">false</span>);</div><div class=\"line\">           <span class=\"keyword\">if</span> (t.getPriority() != Thread.NORM_PRIORITY)</div><div class=\"line\">               t.setPriority(Thread.NORM_PRIORITY);</div><div class=\"line\">           <span class=\"keyword\">return</span> t;</div><div class=\"line\">       &#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n<p>平时打印线程池里线程的name时，会输出形如pool-1-thread-1之类的名称，就是在这里设置的。这个默认的线程工厂，创建的线程是普通的非守护线程，如果需要定制，实现ThreadFactory后传给ThreadPoolExecutor即可。</p>\n<p><a href=\"http://www.jianshu.com/p/adbf37ef77bb\" target=\"_blank\" rel=\"noopener\">参考文章链接</a></p>"},{"title":"NM3000告警框架简介","date":"2018-03-16T09:32:29.000Z","_content":"NM3000网管系统核心架构之一：trap告警框架简介\n\n<!-- more -->\n\n## 1、告警概念\n\n设备在发生变化（比如断纤/断电/上线）时，会向trapserver中配置的各ip地址发送trap，上报这些变化信息。 \n一般我们网管的ip都会配置到各设备的trapserver中，也就是说，设备发出的trap，网管是能够收到的。 \n网管根据收到的trap作出对应的响应，包括产生告警、清除告警等。\n\n## 2、snmp4j简介\n\n网管是利用snmp4j在指定端口监听SNMP消息。\n\n### 2.1 重要类及接口\n\n**Snmp类** \nSNMP4J的最核心的类，负责SNMP报文的接受和发送。\n\n**PDU类和ScopedPDU类** \n该类是SNMP报文单元的抽象，其中PDU类适用于SNMPv1、SNMPv2。ScopedPDU类继承于PDU类，适用于SNMPv3。\n\n**Target接口和UserTarget类** \n对应于SNMP代理的地址信息，包括地址和端口号。其中Target接口适用于SNMPv1、SNMPv2。UserTarget类实现了UserTarget接口，适用于SNMPv3。\n\n**TransportMapping接口**\n该接口代表了SNMP4J所使用的传输层协议。这也是SNMP4J的一大特色的地方。按照RFC规定，SNMP是只使用UDP作为传输层协议。而SNMP4J支持管理端和代理端使用UDP或TCP进行传输。该接口有两个子接口。\n![此处输入图片的描述][1]\n\n**CommandResponder接口** \n该接口接收PDU报文。实现了该接口的类，可以在processPdu方法中处理收到的报文。\n\n### 2.2 两种消息发送模式\nSNMP支持两种消息发送模式：同步发送模式和异步发送模式。 \n同步发送模式也称阻塞模式。当管理端发送出一条消息后，线程会被阻塞，直到收到对方的回应或者超时。 \n异步发送模式也称非阻塞模式。当管理端发出一条消息后，线程将会继续执行，当收到消息的回应的时候，程序会对消息做出相应的处理。要实现异步模式，需要实例化一个实现了ResponseListener接口的对象。ResponseListener接口有一个onResponse的函数。这是一个回调函数，当程序收到响应的时候，会自动调用该函数。由该函数完成对响应的处理。\n\n### 2.3 监听trap的步骤\n1. 明确SNMP在传输层所使用的协议 \n一般情况下，我们使用UDP协议作为SNMP的传输层协议，所以需要实例化一个DefaultUdpTransportMapping接口对象。\n\n2. 实例化SNMP对象 \n我们需要将实例化的DefaultUdpTransportMapping接口对象作为参数，构造SNMP对象。 \n另外，如果实现SNMPv3协议，还需要设计安全机制，添加安全用户等。\n\n3. 监听SNMP消息 \n实例化实现CommandResponder接口的对象，设置为snmp对象的消息处理器，以后监听到的PDU报文由接口的processPdu方法处理。 \nSNMP对象开启监听。\n\n## 3、网管如何收到Trap\n\n### 3.1 监听调度示意图\n\n![监听调度示意图][2]\n\n### 3.2 获取server ip + port\n\n![获取server ip + port][3]\n\n### 3.3 下发给engine，启动trap监听\n\n![下发给engine，启动trap监听][4]\n\n将TrapCallBack接口的实现类（TrapServiceImpl）添加到SnmpTrapManager的监听集合中。\n\n![此处输入图片的描述][5]\n\n### 3.4 实际监听类\n\nSnmpTrapManager实现了CommandResponder接口，trap上来后会自动进入processPdu中处理。\n\n![此处输入图片的描述][6]\n\n### 3.5 小结\n\n关于trap是如何从设备上到网管系统的，我们不必太过于关心，基本上都是snmp4j的封装实现。只需要大概知道是如何实现监听的即可。最重要的还是网管处理trap的过程。\n\n\n## 4、 网管处理Trap流程\n\n![网管处理流程图][7]\n\n整个trap的处理流程较为复杂，我们把它分解为几个阶段： \n1. snmpTrapManager处理trap，发送给server \n2. trapparser将trap转成event \n3. eventparser根据event生成告警或者清除告警\n\n### 4.1 SnmpTrapManager处理trap，发送给server\n\n - 为何使用多线程消费缓存的trap队列\n\n    最开始的模型是一个长度为1024的队列缓存接收到的trap，一个线程不断的处理这些trap。 \n后来在珠江数码实网中发生了trap丢失的问题，经过抓取log日志发现，由于华为的部分OLT不断的向我们网管发送trap，平均每天收到43W条trap。而单线程的处理速度不够，在接收到trap频率达到一定程度后，导致缓存队列达到上限，丢失了部分trap。为了提升我们trap接收端的处理能力，需要改为多线程来进行处理。\n\n - 多线程处理注意事项\n\n    每个ip发过来的trap处理顺序必须保证，因为告警间存在清除关系（断电/上线）。\n    \n - trap缓存数据模型\n\n    ```java\n    Map<String, ConcurrentTrapQueue> deviceTraps\n    ```\n    \n    以设备IP为key，该设备上报的trap都存在单独的ConcurrentTrapQueue中。\n    \n\n - ConcurrentTrapQueue\n\n    这个自定义非阻塞队列非常关键，它继承自ConcurrentLinkedQueue，使用锁的机制来确保同时只有一个线程能操作队列数据，从而保证了trap的处理顺序。\n    因为如果同时可以从队列里面取出多条trap进行处理，后面的trap就可能先处理完成，从而破坏了顺序，导致告警无法产生或者告警无法清除等bug。\n    \n    **ConcurrentLinkedQueue**使用了可重入锁ReentrantLock，来保证在一个trap处理完成前，该队列数据不能被其他线程取出。具体实现机制为：\n    1、判断当前队列是否被锁住，如果被锁住，表明有其他线程在处理该队列，不做尝试，直接返回。 \n    2、如果没有被锁住，先加锁，保证处理期间其他线程不能操作队列。 \n    3、取出队列中所有的trap，一个一个发送给server\n    4、释放锁，使得其他线程可以访问该队列。\n    \n    ![此处输入图片的描述][8]\n \n \n\n - 线程池-ThreadPoolExecutor\n\n    ConcurrentTrapQueue提供了支持并发的缓冲数据结构，我们还需要执行并发的线程池。我们使用executor框架提供的ThreadPoolExecutor来达到目的。\n    \n    实现机制：\n    在SnmpTrapManager初始化时，创建线程池([线程池的创建][9])，\n    \n    ![此处输入图片的描述][10]\n    \n    并不断的将各IP对应的ConcurrentTrapQueue丢到线程池中去执行。如何进行循环，一遍遍的将ConcurrentTrapQueue丢到线程池中去执行，这里使用了JAVA同步机制中非常重要的wait/notify机制。\n    \n    wait/notify机制的简单介绍\n    \n        JAVA中每个对象都有一个monitor对象（监视器）对象。线程获取了monitor对象，就获取了对应JAVA对象的锁。其他线程就会进入锁对应的等待队列/阻塞队列中。等待持有锁的线程释放锁，通知这些等待的线程去争抢锁。\n        \n        Object.wait()：在对应对象上等待，等待其他持有该对象的线程通知唤醒 \n        Object.notify()/notifyAll()：通知唤醒在该对象上wait的一个线程/所有线程\n    \n    这是处理消费线程，每处理完一轮，最多等1s。如果有新来的trap，及时进行响应处理。 \n    ![此处输入图片的描述][11]\n    \n    在接收trap端，每收到一条trap，就通知消费线程立即处理。\n    ![此处输入图片的描述][12]\n    \n\n - 如何发送给server端\n\n    实现机制大致如下： \n    在server端的trapServiceImpl调用engine端的TrapFacadeImpl来开始监听的时候，就注册在发送trap时应该调用的回调函数callback类。从而对每一条trap，就知道怎样进行发送。\n    \n    代码见上面的3.3小节。\n    \n\n### 4.2 trapparser将trap转成event\n\n不同设备的trap有不同的特征，在转成event时也需要不同的处理。所以，按照设备类型进行划分为几个不同的trapParser，分别用来处理不同设备类型的trap。\n\n![trapParser][13]\n\n那么，如何让trap被正确的trapParser处理呢？这里使用的方式时，遍历调用每个trapParser的parse方法，命中则返回false，告知已经找到正确trapParser，遍历停止。如果返回true，表示trap不应被该trapParser处理，继续寻找。解析顺序：cos值越小越靠前。\n\n![此处输入图片的描述][14]\n\n我们可以关注下这种设计模式，它有几点值得我们学习： \n1. 将不同设备类型的trap处理封装成独立的类，避免难以维护的trap处理类。 \n2. 采用各trapParser注册的模式，避免在分发trap给不同trapParser时硬编码各trap类。 \n3. 巧妙使用parse()接口，不能处理的返回true，继续遍历寻找合适的trapParser，自己能处理的trap返回false停止遍历。而不是if-else或者switch这种硬编码。\n \nTrapParser.parser()区分机制： \n设备上报的trap，1.3.6.1.6.3.1.1.4.1.0 这个节点标识trap的类型，区分是哪一种alarm还是event \nOLT发送的trap，1.3.6.1.4.1.17409.2.2.11.1.2.4.0 标识trap的code \nCCMTS发送的trap，1.3.6.1.2.1.69.1.5.8.1.6.0 标识trap的code\n\n结合这些节点，根据业务逻辑的需要，判断上报的trap是否应该被当前trapParser解析。\n\n - Trap如何转成event\n\n    ![TRAP转成Event][15]\n    \n\n - EventSend\n\n    EventSender是事件event分发器，它也采用了队列缓冲加处理线程消费队列的模式来解耦做什么（分发event）和怎么做（怎么分发）。 \n    \n    以单例模式创建EventSend\n    \n    ![单例模式创建EventSend][16]\n    \n    ![单例模式创建EventSend][17]\n    \n    循环从event队列中消费,发送event\n    \n    ![此处输入图片的描述][18]\n    \n    ![此处输入图片的描述][19]\n    \n    insertEvent是不是很熟悉，eventParser的实现策略跟前面的trapParser是一致的，唯一不同的这里面符合条件的返回true，跟trapParser是反过来的。不是很清楚为什么弄成相反的。\n    \n    \n### 4.3 eventparser根据event生成告警或者清除告警\n \n最顶层的是抽象类EventParser，提供了一些抽象方法让子类实现，也提供了最重要的doEvent()方法，实现了几乎所有event都需要经历的处理逻辑。 \n\n![EventParser][20]\n\nEventParser和TrapParser有个最重要的区别在于： \nTrapParser目前基本定死了有4种，如果某条trap一个都不符合，就会被丢弃，不处理。 \nEventParser不一样，有太多种不同的event，所以这里面的设计策略是自定义的EventParser按照一定的优先级排号顺序依次执行，匹配上就结束。如果没有跟自定义的EventParser匹配上，就会调用默认实现的DefaultEventParser去处理，起到一个兜底的作用。\n\n我们一起看看如何实现eventParser的优先级排序机制： eventPriority\n\n![此处输入图片的描述][21]\n\n![此处输入图片的描述][22]\n\n自定义的eventParser只需要将自己的cos设置为大于0即可。\n\n潜在隐患： \n有些eventParser没有修改默认值，就为0。而defaultEventParser也没有修改默认值，也是0。这样，就没有办法保证defaultEventParser一定是在最后，建议将defaultEventParser的cos设置为-1。\n\n### 4.4 EventParser\n\nEventParser主要用于拿event跟数据库中的alert进行比对，来判断是否生成/清除告警。而操作数据库属于I/O操作，可能会被阻塞住。所以与trapParser不同，eventParser使用了队列缓冲+消费线程的模式来处理。parse()方法将event存入缓冲队列，消费线程不断取出event，进行处理。 \n\n![此处输入图片的描述][23]\n\n### 4.5 doEvent\n\n这个方法非常关键，理解它是理解告警触发机制的核心。\n\n我们先来了解一些基本概念： \n事件event与告警alert的关系存放在event2alert表中，并且：\n每一个告警事件都可能对应多种网管侧的告警类型（eventType），生成多条告警（一般产生告警只会对应一个） \n每一个清除事件都可能清除多种告警类型（eventType）的告警\n\n针对每一个event，找到与之对应的所有alertType，针对每一个alertType,查找系统中当前是否有对应的alert。由此hyansheng衍生出以下4种情况：\n\n 1. 数据库中存在告警，当前event是清除事件\n 2. 数据库中存在告警，当前event是产生事件\n 3. 数据库中不存在告警，当前event是清除事件\n 4. 数据库中不存在告警，当前event是产生事件\n\n![doEvent逻辑][24]\n \n\n \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/TransportMapping.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/trapListener.png\n  [3]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/getTrapServer.png\n  [4]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/startListen.png\n  [5]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/addListener.png\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/processPDU.png\n  [7]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/totalFlow.png\n  [8]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/concurrentTrapQueue.png\n  [9]: https://www.zybuluo.com/MrXiao/note/910328\n  [10]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/threadPool.png\n  [11]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/wait.png\n  [12]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/notifyall.png\n  [13]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/trapParser.png\n  [14]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/trapParserCode.png\n  [15]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/trap2event.png\n  [16]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/createSender.png\n  [17]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/senderInit%5D.png\n  [18]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/sendEvent.png\n  [19]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/insertEvent.png\n  [20]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/eventParser.png\n  [21]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/eventPriority.png\n  [22]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/registEventParser.png\n  [23]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/eventParserInit.png\n  [24]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/doEvent.png\n","source":"_posts/NM3000告警框架简介.md","raw":"---\ntitle: NM3000告警框架简介\ncategories:\n  - NM3000\ntags:\n  - NM3000\ndate: 2018-03-16 17:32:29\n---\nNM3000网管系统核心架构之一：trap告警框架简介\n\n<!-- more -->\n\n## 1、告警概念\n\n设备在发生变化（比如断纤/断电/上线）时，会向trapserver中配置的各ip地址发送trap，上报这些变化信息。 \n一般我们网管的ip都会配置到各设备的trapserver中，也就是说，设备发出的trap，网管是能够收到的。 \n网管根据收到的trap作出对应的响应，包括产生告警、清除告警等。\n\n## 2、snmp4j简介\n\n网管是利用snmp4j在指定端口监听SNMP消息。\n\n### 2.1 重要类及接口\n\n**Snmp类** \nSNMP4J的最核心的类，负责SNMP报文的接受和发送。\n\n**PDU类和ScopedPDU类** \n该类是SNMP报文单元的抽象，其中PDU类适用于SNMPv1、SNMPv2。ScopedPDU类继承于PDU类，适用于SNMPv3。\n\n**Target接口和UserTarget类** \n对应于SNMP代理的地址信息，包括地址和端口号。其中Target接口适用于SNMPv1、SNMPv2。UserTarget类实现了UserTarget接口，适用于SNMPv3。\n\n**TransportMapping接口**\n该接口代表了SNMP4J所使用的传输层协议。这也是SNMP4J的一大特色的地方。按照RFC规定，SNMP是只使用UDP作为传输层协议。而SNMP4J支持管理端和代理端使用UDP或TCP进行传输。该接口有两个子接口。\n![此处输入图片的描述][1]\n\n**CommandResponder接口** \n该接口接收PDU报文。实现了该接口的类，可以在processPdu方法中处理收到的报文。\n\n### 2.2 两种消息发送模式\nSNMP支持两种消息发送模式：同步发送模式和异步发送模式。 \n同步发送模式也称阻塞模式。当管理端发送出一条消息后，线程会被阻塞，直到收到对方的回应或者超时。 \n异步发送模式也称非阻塞模式。当管理端发出一条消息后，线程将会继续执行，当收到消息的回应的时候，程序会对消息做出相应的处理。要实现异步模式，需要实例化一个实现了ResponseListener接口的对象。ResponseListener接口有一个onResponse的函数。这是一个回调函数，当程序收到响应的时候，会自动调用该函数。由该函数完成对响应的处理。\n\n### 2.3 监听trap的步骤\n1. 明确SNMP在传输层所使用的协议 \n一般情况下，我们使用UDP协议作为SNMP的传输层协议，所以需要实例化一个DefaultUdpTransportMapping接口对象。\n\n2. 实例化SNMP对象 \n我们需要将实例化的DefaultUdpTransportMapping接口对象作为参数，构造SNMP对象。 \n另外，如果实现SNMPv3协议，还需要设计安全机制，添加安全用户等。\n\n3. 监听SNMP消息 \n实例化实现CommandResponder接口的对象，设置为snmp对象的消息处理器，以后监听到的PDU报文由接口的processPdu方法处理。 \nSNMP对象开启监听。\n\n## 3、网管如何收到Trap\n\n### 3.1 监听调度示意图\n\n![监听调度示意图][2]\n\n### 3.2 获取server ip + port\n\n![获取server ip + port][3]\n\n### 3.3 下发给engine，启动trap监听\n\n![下发给engine，启动trap监听][4]\n\n将TrapCallBack接口的实现类（TrapServiceImpl）添加到SnmpTrapManager的监听集合中。\n\n![此处输入图片的描述][5]\n\n### 3.4 实际监听类\n\nSnmpTrapManager实现了CommandResponder接口，trap上来后会自动进入processPdu中处理。\n\n![此处输入图片的描述][6]\n\n### 3.5 小结\n\n关于trap是如何从设备上到网管系统的，我们不必太过于关心，基本上都是snmp4j的封装实现。只需要大概知道是如何实现监听的即可。最重要的还是网管处理trap的过程。\n\n\n## 4、 网管处理Trap流程\n\n![网管处理流程图][7]\n\n整个trap的处理流程较为复杂，我们把它分解为几个阶段： \n1. snmpTrapManager处理trap，发送给server \n2. trapparser将trap转成event \n3. eventparser根据event生成告警或者清除告警\n\n### 4.1 SnmpTrapManager处理trap，发送给server\n\n - 为何使用多线程消费缓存的trap队列\n\n    最开始的模型是一个长度为1024的队列缓存接收到的trap，一个线程不断的处理这些trap。 \n后来在珠江数码实网中发生了trap丢失的问题，经过抓取log日志发现，由于华为的部分OLT不断的向我们网管发送trap，平均每天收到43W条trap。而单线程的处理速度不够，在接收到trap频率达到一定程度后，导致缓存队列达到上限，丢失了部分trap。为了提升我们trap接收端的处理能力，需要改为多线程来进行处理。\n\n - 多线程处理注意事项\n\n    每个ip发过来的trap处理顺序必须保证，因为告警间存在清除关系（断电/上线）。\n    \n - trap缓存数据模型\n\n    ```java\n    Map<String, ConcurrentTrapQueue> deviceTraps\n    ```\n    \n    以设备IP为key，该设备上报的trap都存在单独的ConcurrentTrapQueue中。\n    \n\n - ConcurrentTrapQueue\n\n    这个自定义非阻塞队列非常关键，它继承自ConcurrentLinkedQueue，使用锁的机制来确保同时只有一个线程能操作队列数据，从而保证了trap的处理顺序。\n    因为如果同时可以从队列里面取出多条trap进行处理，后面的trap就可能先处理完成，从而破坏了顺序，导致告警无法产生或者告警无法清除等bug。\n    \n    **ConcurrentLinkedQueue**使用了可重入锁ReentrantLock，来保证在一个trap处理完成前，该队列数据不能被其他线程取出。具体实现机制为：\n    1、判断当前队列是否被锁住，如果被锁住，表明有其他线程在处理该队列，不做尝试，直接返回。 \n    2、如果没有被锁住，先加锁，保证处理期间其他线程不能操作队列。 \n    3、取出队列中所有的trap，一个一个发送给server\n    4、释放锁，使得其他线程可以访问该队列。\n    \n    ![此处输入图片的描述][8]\n \n \n\n - 线程池-ThreadPoolExecutor\n\n    ConcurrentTrapQueue提供了支持并发的缓冲数据结构，我们还需要执行并发的线程池。我们使用executor框架提供的ThreadPoolExecutor来达到目的。\n    \n    实现机制：\n    在SnmpTrapManager初始化时，创建线程池([线程池的创建][9])，\n    \n    ![此处输入图片的描述][10]\n    \n    并不断的将各IP对应的ConcurrentTrapQueue丢到线程池中去执行。如何进行循环，一遍遍的将ConcurrentTrapQueue丢到线程池中去执行，这里使用了JAVA同步机制中非常重要的wait/notify机制。\n    \n    wait/notify机制的简单介绍\n    \n        JAVA中每个对象都有一个monitor对象（监视器）对象。线程获取了monitor对象，就获取了对应JAVA对象的锁。其他线程就会进入锁对应的等待队列/阻塞队列中。等待持有锁的线程释放锁，通知这些等待的线程去争抢锁。\n        \n        Object.wait()：在对应对象上等待，等待其他持有该对象的线程通知唤醒 \n        Object.notify()/notifyAll()：通知唤醒在该对象上wait的一个线程/所有线程\n    \n    这是处理消费线程，每处理完一轮，最多等1s。如果有新来的trap，及时进行响应处理。 \n    ![此处输入图片的描述][11]\n    \n    在接收trap端，每收到一条trap，就通知消费线程立即处理。\n    ![此处输入图片的描述][12]\n    \n\n - 如何发送给server端\n\n    实现机制大致如下： \n    在server端的trapServiceImpl调用engine端的TrapFacadeImpl来开始监听的时候，就注册在发送trap时应该调用的回调函数callback类。从而对每一条trap，就知道怎样进行发送。\n    \n    代码见上面的3.3小节。\n    \n\n### 4.2 trapparser将trap转成event\n\n不同设备的trap有不同的特征，在转成event时也需要不同的处理。所以，按照设备类型进行划分为几个不同的trapParser，分别用来处理不同设备类型的trap。\n\n![trapParser][13]\n\n那么，如何让trap被正确的trapParser处理呢？这里使用的方式时，遍历调用每个trapParser的parse方法，命中则返回false，告知已经找到正确trapParser，遍历停止。如果返回true，表示trap不应被该trapParser处理，继续寻找。解析顺序：cos值越小越靠前。\n\n![此处输入图片的描述][14]\n\n我们可以关注下这种设计模式，它有几点值得我们学习： \n1. 将不同设备类型的trap处理封装成独立的类，避免难以维护的trap处理类。 \n2. 采用各trapParser注册的模式，避免在分发trap给不同trapParser时硬编码各trap类。 \n3. 巧妙使用parse()接口，不能处理的返回true，继续遍历寻找合适的trapParser，自己能处理的trap返回false停止遍历。而不是if-else或者switch这种硬编码。\n \nTrapParser.parser()区分机制： \n设备上报的trap，1.3.6.1.6.3.1.1.4.1.0 这个节点标识trap的类型，区分是哪一种alarm还是event \nOLT发送的trap，1.3.6.1.4.1.17409.2.2.11.1.2.4.0 标识trap的code \nCCMTS发送的trap，1.3.6.1.2.1.69.1.5.8.1.6.0 标识trap的code\n\n结合这些节点，根据业务逻辑的需要，判断上报的trap是否应该被当前trapParser解析。\n\n - Trap如何转成event\n\n    ![TRAP转成Event][15]\n    \n\n - EventSend\n\n    EventSender是事件event分发器，它也采用了队列缓冲加处理线程消费队列的模式来解耦做什么（分发event）和怎么做（怎么分发）。 \n    \n    以单例模式创建EventSend\n    \n    ![单例模式创建EventSend][16]\n    \n    ![单例模式创建EventSend][17]\n    \n    循环从event队列中消费,发送event\n    \n    ![此处输入图片的描述][18]\n    \n    ![此处输入图片的描述][19]\n    \n    insertEvent是不是很熟悉，eventParser的实现策略跟前面的trapParser是一致的，唯一不同的这里面符合条件的返回true，跟trapParser是反过来的。不是很清楚为什么弄成相反的。\n    \n    \n### 4.3 eventparser根据event生成告警或者清除告警\n \n最顶层的是抽象类EventParser，提供了一些抽象方法让子类实现，也提供了最重要的doEvent()方法，实现了几乎所有event都需要经历的处理逻辑。 \n\n![EventParser][20]\n\nEventParser和TrapParser有个最重要的区别在于： \nTrapParser目前基本定死了有4种，如果某条trap一个都不符合，就会被丢弃，不处理。 \nEventParser不一样，有太多种不同的event，所以这里面的设计策略是自定义的EventParser按照一定的优先级排号顺序依次执行，匹配上就结束。如果没有跟自定义的EventParser匹配上，就会调用默认实现的DefaultEventParser去处理，起到一个兜底的作用。\n\n我们一起看看如何实现eventParser的优先级排序机制： eventPriority\n\n![此处输入图片的描述][21]\n\n![此处输入图片的描述][22]\n\n自定义的eventParser只需要将自己的cos设置为大于0即可。\n\n潜在隐患： \n有些eventParser没有修改默认值，就为0。而defaultEventParser也没有修改默认值，也是0。这样，就没有办法保证defaultEventParser一定是在最后，建议将defaultEventParser的cos设置为-1。\n\n### 4.4 EventParser\n\nEventParser主要用于拿event跟数据库中的alert进行比对，来判断是否生成/清除告警。而操作数据库属于I/O操作，可能会被阻塞住。所以与trapParser不同，eventParser使用了队列缓冲+消费线程的模式来处理。parse()方法将event存入缓冲队列，消费线程不断取出event，进行处理。 \n\n![此处输入图片的描述][23]\n\n### 4.5 doEvent\n\n这个方法非常关键，理解它是理解告警触发机制的核心。\n\n我们先来了解一些基本概念： \n事件event与告警alert的关系存放在event2alert表中，并且：\n每一个告警事件都可能对应多种网管侧的告警类型（eventType），生成多条告警（一般产生告警只会对应一个） \n每一个清除事件都可能清除多种告警类型（eventType）的告警\n\n针对每一个event，找到与之对应的所有alertType，针对每一个alertType,查找系统中当前是否有对应的alert。由此hyansheng衍生出以下4种情况：\n\n 1. 数据库中存在告警，当前event是清除事件\n 2. 数据库中存在告警，当前event是产生事件\n 3. 数据库中不存在告警，当前event是清除事件\n 4. 数据库中不存在告警，当前event是产生事件\n\n![doEvent逻辑][24]\n \n\n \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/TransportMapping.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/trapListener.png\n  [3]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/getTrapServer.png\n  [4]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/startListen.png\n  [5]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/addListener.png\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/processPDU.png\n  [7]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/totalFlow.png\n  [8]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/concurrentTrapQueue.png\n  [9]: https://www.zybuluo.com/MrXiao/note/910328\n  [10]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/threadPool.png\n  [11]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/wait.png\n  [12]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/notifyall.png\n  [13]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/trapParser.png\n  [14]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/trapParserCode.png\n  [15]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/trap2event.png\n  [16]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/createSender.png\n  [17]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/senderInit%5D.png\n  [18]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/sendEvent.png\n  [19]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/insertEvent.png\n  [20]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/eventParser.png\n  [21]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/eventPriority.png\n  [22]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/registEventParser.png\n  [23]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/eventParserInit.png\n  [24]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/doEvent.png\n","slug":"NM3000告警框架简介","published":1,"updated":"2018-03-16T09:33:16.157Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qftl001rhwvfq9xmx96r","content":"<p>NM3000网管系统核心架构之一：trap告警框架简介</p>\n<a id=\"more\"></a>\n<h2 id=\"1、告警概念\"><a href=\"#1、告警概念\" class=\"headerlink\" title=\"1、告警概念\"></a>1、告警概念</h2><p>设备在发生变化（比如断纤/断电/上线）时，会向trapserver中配置的各ip地址发送trap，上报这些变化信息。<br>一般我们网管的ip都会配置到各设备的trapserver中，也就是说，设备发出的trap，网管是能够收到的。<br>网管根据收到的trap作出对应的响应，包括产生告警、清除告警等。</p>\n<h2 id=\"2、snmp4j简介\"><a href=\"#2、snmp4j简介\" class=\"headerlink\" title=\"2、snmp4j简介\"></a>2、snmp4j简介</h2><p>网管是利用snmp4j在指定端口监听SNMP消息。</p>\n<h3 id=\"2-1-重要类及接口\"><a href=\"#2-1-重要类及接口\" class=\"headerlink\" title=\"2.1 重要类及接口\"></a>2.1 重要类及接口</h3><p><strong>Snmp类</strong><br>SNMP4J的最核心的类，负责SNMP报文的接受和发送。</p>\n<p><strong>PDU类和ScopedPDU类</strong><br>该类是SNMP报文单元的抽象，其中PDU类适用于SNMPv1、SNMPv2。ScopedPDU类继承于PDU类，适用于SNMPv3。</p>\n<p><strong>Target接口和UserTarget类</strong><br>对应于SNMP代理的地址信息，包括地址和端口号。其中Target接口适用于SNMPv1、SNMPv2。UserTarget类实现了UserTarget接口，适用于SNMPv3。</p>\n<p><strong>TransportMapping接口</strong><br>该接口代表了SNMP4J所使用的传输层协议。这也是SNMP4J的一大特色的地方。按照RFC规定，SNMP是只使用UDP作为传输层协议。而SNMP4J支持管理端和代理端使用UDP或TCP进行传输。该接口有两个子接口。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/TransportMapping.png\" alt=\"此处输入图片的描述\"></p>\n<p><strong>CommandResponder接口</strong><br>该接口接收PDU报文。实现了该接口的类，可以在processPdu方法中处理收到的报文。</p>\n<h3 id=\"2-2-两种消息发送模式\"><a href=\"#2-2-两种消息发送模式\" class=\"headerlink\" title=\"2.2 两种消息发送模式\"></a>2.2 两种消息发送模式</h3><p>SNMP支持两种消息发送模式：同步发送模式和异步发送模式。<br>同步发送模式也称阻塞模式。当管理端发送出一条消息后，线程会被阻塞，直到收到对方的回应或者超时。<br>异步发送模式也称非阻塞模式。当管理端发出一条消息后，线程将会继续执行，当收到消息的回应的时候，程序会对消息做出相应的处理。要实现异步模式，需要实例化一个实现了ResponseListener接口的对象。ResponseListener接口有一个onResponse的函数。这是一个回调函数，当程序收到响应的时候，会自动调用该函数。由该函数完成对响应的处理。</p>\n<h3 id=\"2-3-监听trap的步骤\"><a href=\"#2-3-监听trap的步骤\" class=\"headerlink\" title=\"2.3 监听trap的步骤\"></a>2.3 监听trap的步骤</h3><ol>\n<li><p>明确SNMP在传输层所使用的协议<br>一般情况下，我们使用UDP协议作为SNMP的传输层协议，所以需要实例化一个DefaultUdpTransportMapping接口对象。</p>\n</li>\n<li><p>实例化SNMP对象<br>我们需要将实例化的DefaultUdpTransportMapping接口对象作为参数，构造SNMP对象。<br>另外，如果实现SNMPv3协议，还需要设计安全机制，添加安全用户等。</p>\n</li>\n<li><p>监听SNMP消息<br>实例化实现CommandResponder接口的对象，设置为snmp对象的消息处理器，以后监听到的PDU报文由接口的processPdu方法处理。<br>SNMP对象开启监听。</p>\n</li>\n</ol>\n<h2 id=\"3、网管如何收到Trap\"><a href=\"#3、网管如何收到Trap\" class=\"headerlink\" title=\"3、网管如何收到Trap\"></a>3、网管如何收到Trap</h2><h3 id=\"3-1-监听调度示意图\"><a href=\"#3-1-监听调度示意图\" class=\"headerlink\" title=\"3.1 监听调度示意图\"></a>3.1 监听调度示意图</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/trapListener.png\" alt=\"监听调度示意图\"></p>\n<h3 id=\"3-2-获取server-ip-port\"><a href=\"#3-2-获取server-ip-port\" class=\"headerlink\" title=\"3.2 获取server ip + port\"></a>3.2 获取server ip + port</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/getTrapServer.png\" alt=\"获取server ip + port\"></p>\n<h3 id=\"3-3-下发给engine，启动trap监听\"><a href=\"#3-3-下发给engine，启动trap监听\" class=\"headerlink\" title=\"3.3 下发给engine，启动trap监听\"></a>3.3 下发给engine，启动trap监听</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/startListen.png\" alt=\"下发给engine，启动trap监听\"></p>\n<p>将TrapCallBack接口的实现类（TrapServiceImpl）添加到SnmpTrapManager的监听集合中。</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/addListener.png\" alt=\"此处输入图片的描述\"></p>\n<h3 id=\"3-4-实际监听类\"><a href=\"#3-4-实际监听类\" class=\"headerlink\" title=\"3.4 实际监听类\"></a>3.4 实际监听类</h3><p>SnmpTrapManager实现了CommandResponder接口，trap上来后会自动进入processPdu中处理。</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/processPDU.png\" alt=\"此处输入图片的描述\"></p>\n<h3 id=\"3-5-小结\"><a href=\"#3-5-小结\" class=\"headerlink\" title=\"3.5 小结\"></a>3.5 小结</h3><p>关于trap是如何从设备上到网管系统的，我们不必太过于关心，基本上都是snmp4j的封装实现。只需要大概知道是如何实现监听的即可。最重要的还是网管处理trap的过程。</p>\n<h2 id=\"4、-网管处理Trap流程\"><a href=\"#4、-网管处理Trap流程\" class=\"headerlink\" title=\"4、 网管处理Trap流程\"></a>4、 网管处理Trap流程</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/totalFlow.png\" alt=\"网管处理流程图\"></p>\n<p>整个trap的处理流程较为复杂，我们把它分解为几个阶段： </p>\n<ol>\n<li>snmpTrapManager处理trap，发送给server </li>\n<li>trapparser将trap转成event </li>\n<li>eventparser根据event生成告警或者清除告警</li>\n</ol>\n<h3 id=\"4-1-SnmpTrapManager处理trap，发送给server\"><a href=\"#4-1-SnmpTrapManager处理trap，发送给server\" class=\"headerlink\" title=\"4.1 SnmpTrapManager处理trap，发送给server\"></a>4.1 SnmpTrapManager处理trap，发送给server</h3><ul>\n<li><p>为何使用多线程消费缓存的trap队列</p>\n<p> 最开始的模型是一个长度为1024的队列缓存接收到的trap，一个线程不断的处理这些trap。<br>后来在珠江数码实网中发生了trap丢失的问题，经过抓取log日志发现，由于华为的部分OLT不断的向我们网管发送trap，平均每天收到43W条trap。而单线程的处理速度不够，在接收到trap频率达到一定程度后，导致缓存队列达到上限，丢失了部分trap。为了提升我们trap接收端的处理能力，需要改为多线程来进行处理。</p>\n</li>\n<li><p>多线程处理注意事项</p>\n<p> 每个ip发过来的trap处理顺序必须保证，因为告警间存在清除关系（断电/上线）。</p>\n</li>\n<li><p>trap缓存数据模型</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">Map&lt;String, ConcurrentTrapQueue&gt; deviceTraps</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<pre><code>以设备IP为key，该设备上报的trap都存在单独的ConcurrentTrapQueue中。\n</code></pre><ul>\n<li><p>ConcurrentTrapQueue</p>\n<p> 这个自定义非阻塞队列非常关键，它继承自ConcurrentLinkedQueue，使用锁的机制来确保同时只有一个线程能操作队列数据，从而保证了trap的处理顺序。<br> 因为如果同时可以从队列里面取出多条trap进行处理，后面的trap就可能先处理完成，从而破坏了顺序，导致告警无法产生或者告警无法清除等bug。</p>\n<p> <strong>ConcurrentLinkedQueue</strong>使用了可重入锁ReentrantLock，来保证在一个trap处理完成前，该队列数据不能被其他线程取出。具体实现机制为：<br> 1、判断当前队列是否被锁住，如果被锁住，表明有其他线程在处理该队列，不做尝试，直接返回。<br> 2、如果没有被锁住，先加锁，保证处理期间其他线程不能操作队列。<br> 3、取出队列中所有的trap，一个一个发送给server<br> 4、释放锁，使得其他线程可以访问该队列。</p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/concurrentTrapQueue.png\" alt=\"此处输入图片的描述\"></p>\n</li>\n</ul>\n<ul>\n<li><p>线程池-ThreadPoolExecutor</p>\n<p> ConcurrentTrapQueue提供了支持并发的缓冲数据结构，我们还需要执行并发的线程池。我们使用executor框架提供的ThreadPoolExecutor来达到目的。</p>\n<p> 实现机制：<br> 在SnmpTrapManager初始化时，创建线程池(<a href=\"https://www.zybuluo.com/MrXiao/note/910328\" target=\"_blank\" rel=\"noopener\">线程池的创建</a>)，</p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/threadPool.png\" alt=\"此处输入图片的描述\"></p>\n<p> 并不断的将各IP对应的ConcurrentTrapQueue丢到线程池中去执行。如何进行循环，一遍遍的将ConcurrentTrapQueue丢到线程池中去执行，这里使用了JAVA同步机制中非常重要的wait/notify机制。</p>\n<p> wait/notify机制的简单介绍</p>\n<pre><code>JAVA中每个对象都有一个monitor对象（监视器）对象。线程获取了monitor对象，就获取了对应JAVA对象的锁。其他线程就会进入锁对应的等待队列/阻塞队列中。等待持有锁的线程释放锁，通知这些等待的线程去争抢锁。\n\nObject.wait()：在对应对象上等待，等待其他持有该对象的线程通知唤醒 \nObject.notify()/notifyAll()：通知唤醒在该对象上wait的一个线程/所有线程\n</code></pre><p> 这是处理消费线程，每处理完一轮，最多等1s。如果有新来的trap，及时进行响应处理。<br> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/wait.png\" alt=\"此处输入图片的描述\"></p>\n<p> 在接收trap端，每收到一条trap，就通知消费线程立即处理。<br> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/notifyall.png\" alt=\"此处输入图片的描述\"></p>\n</li>\n</ul>\n<ul>\n<li><p>如何发送给server端</p>\n<p> 实现机制大致如下：<br> 在server端的trapServiceImpl调用engine端的TrapFacadeImpl来开始监听的时候，就注册在发送trap时应该调用的回调函数callback类。从而对每一条trap，就知道怎样进行发送。</p>\n<p> 代码见上面的3.3小节。</p>\n</li>\n</ul>\n<h3 id=\"4-2-trapparser将trap转成event\"><a href=\"#4-2-trapparser将trap转成event\" class=\"headerlink\" title=\"4.2 trapparser将trap转成event\"></a>4.2 trapparser将trap转成event</h3><p>不同设备的trap有不同的特征，在转成event时也需要不同的处理。所以，按照设备类型进行划分为几个不同的trapParser，分别用来处理不同设备类型的trap。</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/trapParser.png\" alt=\"trapParser\"></p>\n<p>那么，如何让trap被正确的trapParser处理呢？这里使用的方式时，遍历调用每个trapParser的parse方法，命中则返回false，告知已经找到正确trapParser，遍历停止。如果返回true，表示trap不应被该trapParser处理，继续寻找。解析顺序：cos值越小越靠前。</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/trapParserCode.png\" alt=\"此处输入图片的描述\"></p>\n<p>我们可以关注下这种设计模式，它有几点值得我们学习： </p>\n<ol>\n<li>将不同设备类型的trap处理封装成独立的类，避免难以维护的trap处理类。 </li>\n<li>采用各trapParser注册的模式，避免在分发trap给不同trapParser时硬编码各trap类。 </li>\n<li>巧妙使用parse()接口，不能处理的返回true，继续遍历寻找合适的trapParser，自己能处理的trap返回false停止遍历。而不是if-else或者switch这种硬编码。</li>\n</ol>\n<p>TrapParser.parser()区分机制：<br>设备上报的trap，1.3.6.1.6.3.1.1.4.1.0 这个节点标识trap的类型，区分是哪一种alarm还是event<br>OLT发送的trap，1.3.6.1.4.1.17409.2.2.11.1.2.4.0 标识trap的code<br>CCMTS发送的trap，1.3.6.1.2.1.69.1.5.8.1.6.0 标识trap的code</p>\n<p>结合这些节点，根据业务逻辑的需要，判断上报的trap是否应该被当前trapParser解析。</p>\n<ul>\n<li><p>Trap如何转成event</p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/trap2event.png\" alt=\"TRAP转成Event\"></p>\n</li>\n</ul>\n<ul>\n<li><p>EventSend</p>\n<p> EventSender是事件event分发器，它也采用了队列缓冲加处理线程消费队列的模式来解耦做什么（分发event）和怎么做（怎么分发）。 </p>\n<p> 以单例模式创建EventSend</p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/createSender.png\" alt=\"单例模式创建EventSend\"></p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/senderInit%5D.png\" alt=\"单例模式创建EventSend\"></p>\n<p> 循环从event队列中消费,发送event</p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/sendEvent.png\" alt=\"此处输入图片的描述\"></p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/insertEvent.png\" alt=\"此处输入图片的描述\"></p>\n<p> insertEvent是不是很熟悉，eventParser的实现策略跟前面的trapParser是一致的，唯一不同的这里面符合条件的返回true，跟trapParser是反过来的。不是很清楚为什么弄成相反的。</p>\n</li>\n</ul>\n<h3 id=\"4-3-eventparser根据event生成告警或者清除告警\"><a href=\"#4-3-eventparser根据event生成告警或者清除告警\" class=\"headerlink\" title=\"4.3 eventparser根据event生成告警或者清除告警\"></a>4.3 eventparser根据event生成告警或者清除告警</h3><p>最顶层的是抽象类EventParser，提供了一些抽象方法让子类实现，也提供了最重要的doEvent()方法，实现了几乎所有event都需要经历的处理逻辑。 </p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/eventParser.png\" alt=\"EventParser\"></p>\n<p>EventParser和TrapParser有个最重要的区别在于：<br>TrapParser目前基本定死了有4种，如果某条trap一个都不符合，就会被丢弃，不处理。<br>EventParser不一样，有太多种不同的event，所以这里面的设计策略是自定义的EventParser按照一定的优先级排号顺序依次执行，匹配上就结束。如果没有跟自定义的EventParser匹配上，就会调用默认实现的DefaultEventParser去处理，起到一个兜底的作用。</p>\n<p>我们一起看看如何实现eventParser的优先级排序机制： eventPriority</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/eventPriority.png\" alt=\"此处输入图片的描述\"></p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/registEventParser.png\" alt=\"此处输入图片的描述\"></p>\n<p>自定义的eventParser只需要将自己的cos设置为大于0即可。</p>\n<p>潜在隐患：<br>有些eventParser没有修改默认值，就为0。而defaultEventParser也没有修改默认值，也是0。这样，就没有办法保证defaultEventParser一定是在最后，建议将defaultEventParser的cos设置为-1。</p>\n<h3 id=\"4-4-EventParser\"><a href=\"#4-4-EventParser\" class=\"headerlink\" title=\"4.4 EventParser\"></a>4.4 EventParser</h3><p>EventParser主要用于拿event跟数据库中的alert进行比对，来判断是否生成/清除告警。而操作数据库属于I/O操作，可能会被阻塞住。所以与trapParser不同，eventParser使用了队列缓冲+消费线程的模式来处理。parse()方法将event存入缓冲队列，消费线程不断取出event，进行处理。 </p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/eventParserInit.png\" alt=\"此处输入图片的描述\"></p>\n<h3 id=\"4-5-doEvent\"><a href=\"#4-5-doEvent\" class=\"headerlink\" title=\"4.5 doEvent\"></a>4.5 doEvent</h3><p>这个方法非常关键，理解它是理解告警触发机制的核心。</p>\n<p>我们先来了解一些基本概念：<br>事件event与告警alert的关系存放在event2alert表中，并且：<br>每一个告警事件都可能对应多种网管侧的告警类型（eventType），生成多条告警（一般产生告警只会对应一个）<br>每一个清除事件都可能清除多种告警类型（eventType）的告警</p>\n<p>针对每一个event，找到与之对应的所有alertType，针对每一个alertType,查找系统中当前是否有对应的alert。由此hyansheng衍生出以下4种情况：</p>\n<ol>\n<li>数据库中存在告警，当前event是清除事件</li>\n<li>数据库中存在告警，当前event是产生事件</li>\n<li>数据库中不存在告警，当前event是清除事件</li>\n<li>数据库中不存在告警，当前event是产生事件</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/doEvent.png\" alt=\"doEvent逻辑\"></p>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>NM3000网管系统核心架构之一：trap告警框架简介</p>","more":"<h2 id=\"1、告警概念\"><a href=\"#1、告警概念\" class=\"headerlink\" title=\"1、告警概念\"></a>1、告警概念</h2><p>设备在发生变化（比如断纤/断电/上线）时，会向trapserver中配置的各ip地址发送trap，上报这些变化信息。<br>一般我们网管的ip都会配置到各设备的trapserver中，也就是说，设备发出的trap，网管是能够收到的。<br>网管根据收到的trap作出对应的响应，包括产生告警、清除告警等。</p>\n<h2 id=\"2、snmp4j简介\"><a href=\"#2、snmp4j简介\" class=\"headerlink\" title=\"2、snmp4j简介\"></a>2、snmp4j简介</h2><p>网管是利用snmp4j在指定端口监听SNMP消息。</p>\n<h3 id=\"2-1-重要类及接口\"><a href=\"#2-1-重要类及接口\" class=\"headerlink\" title=\"2.1 重要类及接口\"></a>2.1 重要类及接口</h3><p><strong>Snmp类</strong><br>SNMP4J的最核心的类，负责SNMP报文的接受和发送。</p>\n<p><strong>PDU类和ScopedPDU类</strong><br>该类是SNMP报文单元的抽象，其中PDU类适用于SNMPv1、SNMPv2。ScopedPDU类继承于PDU类，适用于SNMPv3。</p>\n<p><strong>Target接口和UserTarget类</strong><br>对应于SNMP代理的地址信息，包括地址和端口号。其中Target接口适用于SNMPv1、SNMPv2。UserTarget类实现了UserTarget接口，适用于SNMPv3。</p>\n<p><strong>TransportMapping接口</strong><br>该接口代表了SNMP4J所使用的传输层协议。这也是SNMP4J的一大特色的地方。按照RFC规定，SNMP是只使用UDP作为传输层协议。而SNMP4J支持管理端和代理端使用UDP或TCP进行传输。该接口有两个子接口。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/TransportMapping.png\" alt=\"此处输入图片的描述\"></p>\n<p><strong>CommandResponder接口</strong><br>该接口接收PDU报文。实现了该接口的类，可以在processPdu方法中处理收到的报文。</p>\n<h3 id=\"2-2-两种消息发送模式\"><a href=\"#2-2-两种消息发送模式\" class=\"headerlink\" title=\"2.2 两种消息发送模式\"></a>2.2 两种消息发送模式</h3><p>SNMP支持两种消息发送模式：同步发送模式和异步发送模式。<br>同步发送模式也称阻塞模式。当管理端发送出一条消息后，线程会被阻塞，直到收到对方的回应或者超时。<br>异步发送模式也称非阻塞模式。当管理端发出一条消息后，线程将会继续执行，当收到消息的回应的时候，程序会对消息做出相应的处理。要实现异步模式，需要实例化一个实现了ResponseListener接口的对象。ResponseListener接口有一个onResponse的函数。这是一个回调函数，当程序收到响应的时候，会自动调用该函数。由该函数完成对响应的处理。</p>\n<h3 id=\"2-3-监听trap的步骤\"><a href=\"#2-3-监听trap的步骤\" class=\"headerlink\" title=\"2.3 监听trap的步骤\"></a>2.3 监听trap的步骤</h3><ol>\n<li><p>明确SNMP在传输层所使用的协议<br>一般情况下，我们使用UDP协议作为SNMP的传输层协议，所以需要实例化一个DefaultUdpTransportMapping接口对象。</p>\n</li>\n<li><p>实例化SNMP对象<br>我们需要将实例化的DefaultUdpTransportMapping接口对象作为参数，构造SNMP对象。<br>另外，如果实现SNMPv3协议，还需要设计安全机制，添加安全用户等。</p>\n</li>\n<li><p>监听SNMP消息<br>实例化实现CommandResponder接口的对象，设置为snmp对象的消息处理器，以后监听到的PDU报文由接口的processPdu方法处理。<br>SNMP对象开启监听。</p>\n</li>\n</ol>\n<h2 id=\"3、网管如何收到Trap\"><a href=\"#3、网管如何收到Trap\" class=\"headerlink\" title=\"3、网管如何收到Trap\"></a>3、网管如何收到Trap</h2><h3 id=\"3-1-监听调度示意图\"><a href=\"#3-1-监听调度示意图\" class=\"headerlink\" title=\"3.1 监听调度示意图\"></a>3.1 监听调度示意图</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/trapListener.png\" alt=\"监听调度示意图\"></p>\n<h3 id=\"3-2-获取server-ip-port\"><a href=\"#3-2-获取server-ip-port\" class=\"headerlink\" title=\"3.2 获取server ip + port\"></a>3.2 获取server ip + port</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/getTrapServer.png\" alt=\"获取server ip + port\"></p>\n<h3 id=\"3-3-下发给engine，启动trap监听\"><a href=\"#3-3-下发给engine，启动trap监听\" class=\"headerlink\" title=\"3.3 下发给engine，启动trap监听\"></a>3.3 下发给engine，启动trap监听</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/startListen.png\" alt=\"下发给engine，启动trap监听\"></p>\n<p>将TrapCallBack接口的实现类（TrapServiceImpl）添加到SnmpTrapManager的监听集合中。</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/addListener.png\" alt=\"此处输入图片的描述\"></p>\n<h3 id=\"3-4-实际监听类\"><a href=\"#3-4-实际监听类\" class=\"headerlink\" title=\"3.4 实际监听类\"></a>3.4 实际监听类</h3><p>SnmpTrapManager实现了CommandResponder接口，trap上来后会自动进入processPdu中处理。</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/processPDU.png\" alt=\"此处输入图片的描述\"></p>\n<h3 id=\"3-5-小结\"><a href=\"#3-5-小结\" class=\"headerlink\" title=\"3.5 小结\"></a>3.5 小结</h3><p>关于trap是如何从设备上到网管系统的，我们不必太过于关心，基本上都是snmp4j的封装实现。只需要大概知道是如何实现监听的即可。最重要的还是网管处理trap的过程。</p>\n<h2 id=\"4、-网管处理Trap流程\"><a href=\"#4、-网管处理Trap流程\" class=\"headerlink\" title=\"4、 网管处理Trap流程\"></a>4、 网管处理Trap流程</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/totalFlow.png\" alt=\"网管处理流程图\"></p>\n<p>整个trap的处理流程较为复杂，我们把它分解为几个阶段： </p>\n<ol>\n<li>snmpTrapManager处理trap，发送给server </li>\n<li>trapparser将trap转成event </li>\n<li>eventparser根据event生成告警或者清除告警</li>\n</ol>\n<h3 id=\"4-1-SnmpTrapManager处理trap，发送给server\"><a href=\"#4-1-SnmpTrapManager处理trap，发送给server\" class=\"headerlink\" title=\"4.1 SnmpTrapManager处理trap，发送给server\"></a>4.1 SnmpTrapManager处理trap，发送给server</h3><ul>\n<li><p>为何使用多线程消费缓存的trap队列</p>\n<p> 最开始的模型是一个长度为1024的队列缓存接收到的trap，一个线程不断的处理这些trap。<br>后来在珠江数码实网中发生了trap丢失的问题，经过抓取log日志发现，由于华为的部分OLT不断的向我们网管发送trap，平均每天收到43W条trap。而单线程的处理速度不够，在接收到trap频率达到一定程度后，导致缓存队列达到上限，丢失了部分trap。为了提升我们trap接收端的处理能力，需要改为多线程来进行处理。</p>\n</li>\n<li><p>多线程处理注意事项</p>\n<p> 每个ip发过来的trap处理顺序必须保证，因为告警间存在清除关系（断电/上线）。</p>\n</li>\n<li><p>trap缓存数据模型</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">Map&lt;String, ConcurrentTrapQueue&gt; deviceTraps</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<pre><code>以设备IP为key，该设备上报的trap都存在单独的ConcurrentTrapQueue中。\n</code></pre><ul>\n<li><p>ConcurrentTrapQueue</p>\n<p> 这个自定义非阻塞队列非常关键，它继承自ConcurrentLinkedQueue，使用锁的机制来确保同时只有一个线程能操作队列数据，从而保证了trap的处理顺序。<br> 因为如果同时可以从队列里面取出多条trap进行处理，后面的trap就可能先处理完成，从而破坏了顺序，导致告警无法产生或者告警无法清除等bug。</p>\n<p> <strong>ConcurrentLinkedQueue</strong>使用了可重入锁ReentrantLock，来保证在一个trap处理完成前，该队列数据不能被其他线程取出。具体实现机制为：<br> 1、判断当前队列是否被锁住，如果被锁住，表明有其他线程在处理该队列，不做尝试，直接返回。<br> 2、如果没有被锁住，先加锁，保证处理期间其他线程不能操作队列。<br> 3、取出队列中所有的trap，一个一个发送给server<br> 4、释放锁，使得其他线程可以访问该队列。</p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/concurrentTrapQueue.png\" alt=\"此处输入图片的描述\"></p>\n</li>\n</ul>\n<ul>\n<li><p>线程池-ThreadPoolExecutor</p>\n<p> ConcurrentTrapQueue提供了支持并发的缓冲数据结构，我们还需要执行并发的线程池。我们使用executor框架提供的ThreadPoolExecutor来达到目的。</p>\n<p> 实现机制：<br> 在SnmpTrapManager初始化时，创建线程池(<a href=\"https://www.zybuluo.com/MrXiao/note/910328\" target=\"_blank\" rel=\"noopener\">线程池的创建</a>)，</p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/threadPool.png\" alt=\"此处输入图片的描述\"></p>\n<p> 并不断的将各IP对应的ConcurrentTrapQueue丢到线程池中去执行。如何进行循环，一遍遍的将ConcurrentTrapQueue丢到线程池中去执行，这里使用了JAVA同步机制中非常重要的wait/notify机制。</p>\n<p> wait/notify机制的简单介绍</p>\n<pre><code>JAVA中每个对象都有一个monitor对象（监视器）对象。线程获取了monitor对象，就获取了对应JAVA对象的锁。其他线程就会进入锁对应的等待队列/阻塞队列中。等待持有锁的线程释放锁，通知这些等待的线程去争抢锁。\n\nObject.wait()：在对应对象上等待，等待其他持有该对象的线程通知唤醒 \nObject.notify()/notifyAll()：通知唤醒在该对象上wait的一个线程/所有线程\n</code></pre><p> 这是处理消费线程，每处理完一轮，最多等1s。如果有新来的trap，及时进行响应处理。<br> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/wait.png\" alt=\"此处输入图片的描述\"></p>\n<p> 在接收trap端，每收到一条trap，就通知消费线程立即处理。<br> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/notifyall.png\" alt=\"此处输入图片的描述\"></p>\n</li>\n</ul>\n<ul>\n<li><p>如何发送给server端</p>\n<p> 实现机制大致如下：<br> 在server端的trapServiceImpl调用engine端的TrapFacadeImpl来开始监听的时候，就注册在发送trap时应该调用的回调函数callback类。从而对每一条trap，就知道怎样进行发送。</p>\n<p> 代码见上面的3.3小节。</p>\n</li>\n</ul>\n<h3 id=\"4-2-trapparser将trap转成event\"><a href=\"#4-2-trapparser将trap转成event\" class=\"headerlink\" title=\"4.2 trapparser将trap转成event\"></a>4.2 trapparser将trap转成event</h3><p>不同设备的trap有不同的特征，在转成event时也需要不同的处理。所以，按照设备类型进行划分为几个不同的trapParser，分别用来处理不同设备类型的trap。</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/trapParser.png\" alt=\"trapParser\"></p>\n<p>那么，如何让trap被正确的trapParser处理呢？这里使用的方式时，遍历调用每个trapParser的parse方法，命中则返回false，告知已经找到正确trapParser，遍历停止。如果返回true，表示trap不应被该trapParser处理，继续寻找。解析顺序：cos值越小越靠前。</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/trapParserCode.png\" alt=\"此处输入图片的描述\"></p>\n<p>我们可以关注下这种设计模式，它有几点值得我们学习： </p>\n<ol>\n<li>将不同设备类型的trap处理封装成独立的类，避免难以维护的trap处理类。 </li>\n<li>采用各trapParser注册的模式，避免在分发trap给不同trapParser时硬编码各trap类。 </li>\n<li>巧妙使用parse()接口，不能处理的返回true，继续遍历寻找合适的trapParser，自己能处理的trap返回false停止遍历。而不是if-else或者switch这种硬编码。</li>\n</ol>\n<p>TrapParser.parser()区分机制：<br>设备上报的trap，1.3.6.1.6.3.1.1.4.1.0 这个节点标识trap的类型，区分是哪一种alarm还是event<br>OLT发送的trap，1.3.6.1.4.1.17409.2.2.11.1.2.4.0 标识trap的code<br>CCMTS发送的trap，1.3.6.1.2.1.69.1.5.8.1.6.0 标识trap的code</p>\n<p>结合这些节点，根据业务逻辑的需要，判断上报的trap是否应该被当前trapParser解析。</p>\n<ul>\n<li><p>Trap如何转成event</p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/trap2event.png\" alt=\"TRAP转成Event\"></p>\n</li>\n</ul>\n<ul>\n<li><p>EventSend</p>\n<p> EventSender是事件event分发器，它也采用了队列缓冲加处理线程消费队列的模式来解耦做什么（分发event）和怎么做（怎么分发）。 </p>\n<p> 以单例模式创建EventSend</p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/createSender.png\" alt=\"单例模式创建EventSend\"></p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/senderInit%5D.png\" alt=\"单例模式创建EventSend\"></p>\n<p> 循环从event队列中消费,发送event</p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/sendEvent.png\" alt=\"此处输入图片的描述\"></p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/insertEvent.png\" alt=\"此处输入图片的描述\"></p>\n<p> insertEvent是不是很熟悉，eventParser的实现策略跟前面的trapParser是一致的，唯一不同的这里面符合条件的返回true，跟trapParser是反过来的。不是很清楚为什么弄成相反的。</p>\n</li>\n</ul>\n<h3 id=\"4-3-eventparser根据event生成告警或者清除告警\"><a href=\"#4-3-eventparser根据event生成告警或者清除告警\" class=\"headerlink\" title=\"4.3 eventparser根据event生成告警或者清除告警\"></a>4.3 eventparser根据event生成告警或者清除告警</h3><p>最顶层的是抽象类EventParser，提供了一些抽象方法让子类实现，也提供了最重要的doEvent()方法，实现了几乎所有event都需要经历的处理逻辑。 </p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/eventParser.png\" alt=\"EventParser\"></p>\n<p>EventParser和TrapParser有个最重要的区别在于：<br>TrapParser目前基本定死了有4种，如果某条trap一个都不符合，就会被丢弃，不处理。<br>EventParser不一样，有太多种不同的event，所以这里面的设计策略是自定义的EventParser按照一定的优先级排号顺序依次执行，匹配上就结束。如果没有跟自定义的EventParser匹配上，就会调用默认实现的DefaultEventParser去处理，起到一个兜底的作用。</p>\n<p>我们一起看看如何实现eventParser的优先级排序机制： eventPriority</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/eventPriority.png\" alt=\"此处输入图片的描述\"></p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/registEventParser.png\" alt=\"此处输入图片的描述\"></p>\n<p>自定义的eventParser只需要将自己的cos设置为大于0即可。</p>\n<p>潜在隐患：<br>有些eventParser没有修改默认值，就为0。而defaultEventParser也没有修改默认值，也是0。这样，就没有办法保证defaultEventParser一定是在最后，建议将defaultEventParser的cos设置为-1。</p>\n<h3 id=\"4-4-EventParser\"><a href=\"#4-4-EventParser\" class=\"headerlink\" title=\"4.4 EventParser\"></a>4.4 EventParser</h3><p>EventParser主要用于拿event跟数据库中的alert进行比对，来判断是否生成/清除告警。而操作数据库属于I/O操作，可能会被阻塞住。所以与trapParser不同，eventParser使用了队列缓冲+消费线程的模式来处理。parse()方法将event存入缓冲队列，消费线程不断取出event，进行处理。 </p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/eventParserInit.png\" alt=\"此处输入图片的描述\"></p>\n<h3 id=\"4-5-doEvent\"><a href=\"#4-5-doEvent\" class=\"headerlink\" title=\"4.5 doEvent\"></a>4.5 doEvent</h3><p>这个方法非常关键，理解它是理解告警触发机制的核心。</p>\n<p>我们先来了解一些基本概念：<br>事件event与告警alert的关系存放在event2alert表中，并且：<br>每一个告警事件都可能对应多种网管侧的告警类型（eventType），生成多条告警（一般产生告警只会对应一个）<br>每一个清除事件都可能清除多种告警类型（eventType）的告警</p>\n<p>针对每一个event，找到与之对应的所有alertType，针对每一个alertType,查找系统中当前是否有对应的alert。由此hyansheng衍生出以下4种情况：</p>\n<ol>\n<li>数据库中存在告警，当前event是清除事件</li>\n<li>数据库中存在告警，当前event是产生事件</li>\n<li>数据库中不存在告警，当前event是清除事件</li>\n<li>数据库中不存在告警，当前event是产生事件</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/NM3000/doEvent.png\" alt=\"doEvent逻辑\"></p>"},{"title":"NM3000消息推送框架简介","date":"2018-03-26T08:50:08.000Z","_content":"\nNM3000网管系统架构之一：消息推送框架简介\n\n<!--more-->\n\n\n## 1、简介\n\n传统的顺序程序设计总是按照流程来安排所有的工作，而事件机制的特点在于:等待，有事情发生则处理。这样的好处是避免了顺序程序设计在没有工作时的空循环处理，释放了各种资源。\n\nJava事件处理采用观察者模式，即发布-订阅模式。关于该设计模式，请参照[观察者模式][1]。\n\n## 2、NM3000事件机制相关接口、类介绍\n\n### 2.1 监听者接口:主题和监听者之间消息传递的标准接口规范。\n\n![EmsListener][2]\n### 2.2 监听者：实现监听者接口，具体的事件执行者。\n### 2.3  *Adapter类：适配器类，继承该类后无需实现接口中所有方法，如果需要实现方法不多，可以无需建立适配器类。\n### 2.4  主题接口：被监听者的顶层接口.\n### 2.5  主题:被监听者，包含监听者接口的引用，一个事件队列，两个消息发送方法。\n\n![messageService][3]\n\n - regs:监听者接口引用map集合\n \n    map的key是监听者接口的class对象，value是该接口下的实现类对象。\n\n - eventQueue:消息对象队列\n\n    阻塞队列中存放的是EmsEventObject对象，所以继承自该对象的消息对象都可以存放到队列中。\n    \n - executorService：java线程池\n \n    采用生产者-消费者模式，多线程处理消息队列。\n\n - addListener：监听者类初始化时，调用该方法，将自己添加到messageService的监听者集合中。\n - addMessage:添加消息，将消息放到eventQueue中，等待执行\n - fireMessage：立即将消息传递给对应的监听者，即立即执行\n\n    ![sendMessage][4]\n    \n    重点：封装消息对象，设置监听该消息的接口和响应方法。\n    \n    ![fireMessage][5]\n    \n    使用反射，从消息对象中获得响应方法，invoke执行，即将消息传递给指定接口的监听者。\n \n### 2.6  消息对象：主题和监听者之间传递的事件描述对象。\n\n![EmsEventObject][6]\n\n\n## 3、NM3000事件机制的使用\n\n 1. 新建*Listener接口，继承EmsListener\n 2. 新建*Adapter类，继承EmsAdapter，实现*Listener接口。(可选)\n 3. 新建*Event类，继承EmsEventObject<*Listener>类\n\n一般在service层使用消息。\n\n 1. 在监听者实现类(实现监听者接口)中注MessageServiceImpl类，并在initialize方法中添加*Listener接口。在destroy方法中移除*Listener接口。\n 注意：在配置*serviceImpl实现类时，需要配置初始化及销毁时方法。示例：\nmessageService.addListener(CmcEntityListener.class, this);\nmessageService.removeListener(CmcEntityListener.class, this);\n 2. 在需要发送消息的地方，构建消息对象，设置监听接口及方法，调用messageService发送消息。\n    addMessage:将消息添加到消息缓冲队列，延迟执行\n    fireMessage:立即执行\n\n    ![此处输入图片的描述][7]\n\n\n \n\n\n  [1]: https://www.zybuluo.com/MrXiao/note/1083019\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/87acf6357b65e538382dcffc92e8901f77bf138b/imageStorage/NM3000/EmsListener.png\n  [3]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/abac82e2616e5df40201a8637628c7cfb15321b2/imageStorage/NM3000/messageService.png\n  [4]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/d3a7a1131d0248f5233ceb0c1a87879f43ea1b49/imageStorage/NM3000/sendMessage.png\n  [5]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/d3a7a1131d0248f5233ceb0c1a87879f43ea1b49/imageStorage/NM3000/fireMessage.png\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/87acf6357b65e538382dcffc92e8901f77bf138b/imageStorage/NM3000/EmsEventObject.png\n  [7]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/d3a7a1131d0248f5233ceb0c1a87879f43ea1b49/imageStorage/NM3000/sendMessage.png\n","source":"_posts/NM3000消息推送框架简介.md","raw":"---\ntitle: NM3000消息推送框架简介\ncategories:\n  - NM3000\ntags:\n  - NM3000\ndate: 2018-03-26 16:50:08\n---\n\nNM3000网管系统架构之一：消息推送框架简介\n\n<!--more-->\n\n\n## 1、简介\n\n传统的顺序程序设计总是按照流程来安排所有的工作，而事件机制的特点在于:等待，有事情发生则处理。这样的好处是避免了顺序程序设计在没有工作时的空循环处理，释放了各种资源。\n\nJava事件处理采用观察者模式，即发布-订阅模式。关于该设计模式，请参照[观察者模式][1]。\n\n## 2、NM3000事件机制相关接口、类介绍\n\n### 2.1 监听者接口:主题和监听者之间消息传递的标准接口规范。\n\n![EmsListener][2]\n### 2.2 监听者：实现监听者接口，具体的事件执行者。\n### 2.3  *Adapter类：适配器类，继承该类后无需实现接口中所有方法，如果需要实现方法不多，可以无需建立适配器类。\n### 2.4  主题接口：被监听者的顶层接口.\n### 2.5  主题:被监听者，包含监听者接口的引用，一个事件队列，两个消息发送方法。\n\n![messageService][3]\n\n - regs:监听者接口引用map集合\n \n    map的key是监听者接口的class对象，value是该接口下的实现类对象。\n\n - eventQueue:消息对象队列\n\n    阻塞队列中存放的是EmsEventObject对象，所以继承自该对象的消息对象都可以存放到队列中。\n    \n - executorService：java线程池\n \n    采用生产者-消费者模式，多线程处理消息队列。\n\n - addListener：监听者类初始化时，调用该方法，将自己添加到messageService的监听者集合中。\n - addMessage:添加消息，将消息放到eventQueue中，等待执行\n - fireMessage：立即将消息传递给对应的监听者，即立即执行\n\n    ![sendMessage][4]\n    \n    重点：封装消息对象，设置监听该消息的接口和响应方法。\n    \n    ![fireMessage][5]\n    \n    使用反射，从消息对象中获得响应方法，invoke执行，即将消息传递给指定接口的监听者。\n \n### 2.6  消息对象：主题和监听者之间传递的事件描述对象。\n\n![EmsEventObject][6]\n\n\n## 3、NM3000事件机制的使用\n\n 1. 新建*Listener接口，继承EmsListener\n 2. 新建*Adapter类，继承EmsAdapter，实现*Listener接口。(可选)\n 3. 新建*Event类，继承EmsEventObject<*Listener>类\n\n一般在service层使用消息。\n\n 1. 在监听者实现类(实现监听者接口)中注MessageServiceImpl类，并在initialize方法中添加*Listener接口。在destroy方法中移除*Listener接口。\n 注意：在配置*serviceImpl实现类时，需要配置初始化及销毁时方法。示例：\nmessageService.addListener(CmcEntityListener.class, this);\nmessageService.removeListener(CmcEntityListener.class, this);\n 2. 在需要发送消息的地方，构建消息对象，设置监听接口及方法，调用messageService发送消息。\n    addMessage:将消息添加到消息缓冲队列，延迟执行\n    fireMessage:立即执行\n\n    ![此处输入图片的描述][7]\n\n\n \n\n\n  [1]: https://www.zybuluo.com/MrXiao/note/1083019\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/87acf6357b65e538382dcffc92e8901f77bf138b/imageStorage/NM3000/EmsListener.png\n  [3]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/abac82e2616e5df40201a8637628c7cfb15321b2/imageStorage/NM3000/messageService.png\n  [4]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/d3a7a1131d0248f5233ceb0c1a87879f43ea1b49/imageStorage/NM3000/sendMessage.png\n  [5]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/d3a7a1131d0248f5233ceb0c1a87879f43ea1b49/imageStorage/NM3000/fireMessage.png\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/87acf6357b65e538382dcffc92e8901f77bf138b/imageStorage/NM3000/EmsEventObject.png\n  [7]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/d3a7a1131d0248f5233ceb0c1a87879f43ea1b49/imageStorage/NM3000/sendMessage.png\n","slug":"NM3000消息推送框架简介","published":1,"updated":"2018-03-26T08:54:11.093Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfto001thwvfwvlmkoz1","content":"<p>NM3000网管系统架构之一：消息推送框架简介</p>\n<a id=\"more\"></a>\n<h2 id=\"1、简介\"><a href=\"#1、简介\" class=\"headerlink\" title=\"1、简介\"></a>1、简介</h2><p>传统的顺序程序设计总是按照流程来安排所有的工作，而事件机制的特点在于:等待，有事情发生则处理。这样的好处是避免了顺序程序设计在没有工作时的空循环处理，释放了各种资源。</p>\n<p>Java事件处理采用观察者模式，即发布-订阅模式。关于该设计模式，请参照<a href=\"https://www.zybuluo.com/MrXiao/note/1083019\" target=\"_blank\" rel=\"noopener\">观察者模式</a>。</p>\n<h2 id=\"2、NM3000事件机制相关接口、类介绍\"><a href=\"#2、NM3000事件机制相关接口、类介绍\" class=\"headerlink\" title=\"2、NM3000事件机制相关接口、类介绍\"></a>2、NM3000事件机制相关接口、类介绍</h2><h3 id=\"2-1-监听者接口-主题和监听者之间消息传递的标准接口规范。\"><a href=\"#2-1-监听者接口-主题和监听者之间消息传递的标准接口规范。\" class=\"headerlink\" title=\"2.1 监听者接口:主题和监听者之间消息传递的标准接口规范。\"></a>2.1 监听者接口:主题和监听者之间消息传递的标准接口规范。</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/87acf6357b65e538382dcffc92e8901f77bf138b/imageStorage/NM3000/EmsListener.png\" alt=\"EmsListener\"></p>\n<h3 id=\"2-2-监听者：实现监听者接口，具体的事件执行者。\"><a href=\"#2-2-监听者：实现监听者接口，具体的事件执行者。\" class=\"headerlink\" title=\"2.2 监听者：实现监听者接口，具体的事件执行者。\"></a>2.2 监听者：实现监听者接口，具体的事件执行者。</h3><h3 id=\"2-3-Adapter类：适配器类，继承该类后无需实现接口中所有方法，如果需要实现方法不多，可以无需建立适配器类。\"><a href=\"#2-3-Adapter类：适配器类，继承该类后无需实现接口中所有方法，如果需要实现方法不多，可以无需建立适配器类。\" class=\"headerlink\" title=\"2.3  *Adapter类：适配器类，继承该类后无需实现接口中所有方法，如果需要实现方法不多，可以无需建立适配器类。\"></a>2.3  *Adapter类：适配器类，继承该类后无需实现接口中所有方法，如果需要实现方法不多，可以无需建立适配器类。</h3><h3 id=\"2-4-主题接口：被监听者的顶层接口\"><a href=\"#2-4-主题接口：被监听者的顶层接口\" class=\"headerlink\" title=\"2.4  主题接口：被监听者的顶层接口.\"></a>2.4  主题接口：被监听者的顶层接口.</h3><h3 id=\"2-5-主题-被监听者，包含监听者接口的引用，一个事件队列，两个消息发送方法。\"><a href=\"#2-5-主题-被监听者，包含监听者接口的引用，一个事件队列，两个消息发送方法。\" class=\"headerlink\" title=\"2.5  主题:被监听者，包含监听者接口的引用，一个事件队列，两个消息发送方法。\"></a>2.5  主题:被监听者，包含监听者接口的引用，一个事件队列，两个消息发送方法。</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/abac82e2616e5df40201a8637628c7cfb15321b2/imageStorage/NM3000/messageService.png\" alt=\"messageService\"></p>\n<ul>\n<li><p>regs:监听者接口引用map集合</p>\n<p> map的key是监听者接口的class对象，value是该接口下的实现类对象。</p>\n</li>\n<li><p>eventQueue:消息对象队列</p>\n<p> 阻塞队列中存放的是EmsEventObject对象，所以继承自该对象的消息对象都可以存放到队列中。</p>\n</li>\n<li><p>executorService：java线程池</p>\n<p> 采用生产者-消费者模式，多线程处理消息队列。</p>\n</li>\n<li><p>addListener：监听者类初始化时，调用该方法，将自己添加到messageService的监听者集合中。</p>\n</li>\n<li>addMessage:添加消息，将消息放到eventQueue中，等待执行</li>\n<li><p>fireMessage：立即将消息传递给对应的监听者，即立即执行</p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/d3a7a1131d0248f5233ceb0c1a87879f43ea1b49/imageStorage/NM3000/sendMessage.png\" alt=\"sendMessage\"></p>\n<p> 重点：封装消息对象，设置监听该消息的接口和响应方法。</p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/d3a7a1131d0248f5233ceb0c1a87879f43ea1b49/imageStorage/NM3000/fireMessage.png\" alt=\"fireMessage\"></p>\n<p> 使用反射，从消息对象中获得响应方法，invoke执行，即将消息传递给指定接口的监听者。</p>\n</li>\n</ul>\n<h3 id=\"2-6-消息对象：主题和监听者之间传递的事件描述对象。\"><a href=\"#2-6-消息对象：主题和监听者之间传递的事件描述对象。\" class=\"headerlink\" title=\"2.6  消息对象：主题和监听者之间传递的事件描述对象。\"></a>2.6  消息对象：主题和监听者之间传递的事件描述对象。</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/87acf6357b65e538382dcffc92e8901f77bf138b/imageStorage/NM3000/EmsEventObject.png\" alt=\"EmsEventObject\"></p>\n<h2 id=\"3、NM3000事件机制的使用\"><a href=\"#3、NM3000事件机制的使用\" class=\"headerlink\" title=\"3、NM3000事件机制的使用\"></a>3、NM3000事件机制的使用</h2><ol>\n<li>新建*Listener接口，继承EmsListener</li>\n<li>新建<em>Adapter类，继承EmsAdapter，实现</em>Listener接口。(可选)</li>\n<li>新建<em>Event类，继承EmsEventObject&lt;</em>Listener&gt;类</li>\n</ol>\n<p>一般在service层使用消息。</p>\n<ol>\n<li>在监听者实现类(实现监听者接口)中注MessageServiceImpl类，并在initialize方法中添加<em>Listener接口。在destroy方法中移除</em>Listener接口。<br>注意：在配置*serviceImpl实现类时，需要配置初始化及销毁时方法。示例：<br>messageService.addListener(CmcEntityListener.class, this);<br>messageService.removeListener(CmcEntityListener.class, this);</li>\n<li><p>在需要发送消息的地方，构建消息对象，设置监听接口及方法，调用messageService发送消息。<br>addMessage:将消息添加到消息缓冲队列，延迟执行<br>fireMessage:立即执行</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/d3a7a1131d0248f5233ceb0c1a87879f43ea1b49/imageStorage/NM3000/sendMessage.png\" alt=\"此处输入图片的描述\"></p>\n</li>\n</ol>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>NM3000网管系统架构之一：消息推送框架简介</p>","more":"<h2 id=\"1、简介\"><a href=\"#1、简介\" class=\"headerlink\" title=\"1、简介\"></a>1、简介</h2><p>传统的顺序程序设计总是按照流程来安排所有的工作，而事件机制的特点在于:等待，有事情发生则处理。这样的好处是避免了顺序程序设计在没有工作时的空循环处理，释放了各种资源。</p>\n<p>Java事件处理采用观察者模式，即发布-订阅模式。关于该设计模式，请参照<a href=\"https://www.zybuluo.com/MrXiao/note/1083019\" target=\"_blank\" rel=\"noopener\">观察者模式</a>。</p>\n<h2 id=\"2、NM3000事件机制相关接口、类介绍\"><a href=\"#2、NM3000事件机制相关接口、类介绍\" class=\"headerlink\" title=\"2、NM3000事件机制相关接口、类介绍\"></a>2、NM3000事件机制相关接口、类介绍</h2><h3 id=\"2-1-监听者接口-主题和监听者之间消息传递的标准接口规范。\"><a href=\"#2-1-监听者接口-主题和监听者之间消息传递的标准接口规范。\" class=\"headerlink\" title=\"2.1 监听者接口:主题和监听者之间消息传递的标准接口规范。\"></a>2.1 监听者接口:主题和监听者之间消息传递的标准接口规范。</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/87acf6357b65e538382dcffc92e8901f77bf138b/imageStorage/NM3000/EmsListener.png\" alt=\"EmsListener\"></p>\n<h3 id=\"2-2-监听者：实现监听者接口，具体的事件执行者。\"><a href=\"#2-2-监听者：实现监听者接口，具体的事件执行者。\" class=\"headerlink\" title=\"2.2 监听者：实现监听者接口，具体的事件执行者。\"></a>2.2 监听者：实现监听者接口，具体的事件执行者。</h3><h3 id=\"2-3-Adapter类：适配器类，继承该类后无需实现接口中所有方法，如果需要实现方法不多，可以无需建立适配器类。\"><a href=\"#2-3-Adapter类：适配器类，继承该类后无需实现接口中所有方法，如果需要实现方法不多，可以无需建立适配器类。\" class=\"headerlink\" title=\"2.3  *Adapter类：适配器类，继承该类后无需实现接口中所有方法，如果需要实现方法不多，可以无需建立适配器类。\"></a>2.3  *Adapter类：适配器类，继承该类后无需实现接口中所有方法，如果需要实现方法不多，可以无需建立适配器类。</h3><h3 id=\"2-4-主题接口：被监听者的顶层接口\"><a href=\"#2-4-主题接口：被监听者的顶层接口\" class=\"headerlink\" title=\"2.4  主题接口：被监听者的顶层接口.\"></a>2.4  主题接口：被监听者的顶层接口.</h3><h3 id=\"2-5-主题-被监听者，包含监听者接口的引用，一个事件队列，两个消息发送方法。\"><a href=\"#2-5-主题-被监听者，包含监听者接口的引用，一个事件队列，两个消息发送方法。\" class=\"headerlink\" title=\"2.5  主题:被监听者，包含监听者接口的引用，一个事件队列，两个消息发送方法。\"></a>2.5  主题:被监听者，包含监听者接口的引用，一个事件队列，两个消息发送方法。</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/abac82e2616e5df40201a8637628c7cfb15321b2/imageStorage/NM3000/messageService.png\" alt=\"messageService\"></p>\n<ul>\n<li><p>regs:监听者接口引用map集合</p>\n<p> map的key是监听者接口的class对象，value是该接口下的实现类对象。</p>\n</li>\n<li><p>eventQueue:消息对象队列</p>\n<p> 阻塞队列中存放的是EmsEventObject对象，所以继承自该对象的消息对象都可以存放到队列中。</p>\n</li>\n<li><p>executorService：java线程池</p>\n<p> 采用生产者-消费者模式，多线程处理消息队列。</p>\n</li>\n<li><p>addListener：监听者类初始化时，调用该方法，将自己添加到messageService的监听者集合中。</p>\n</li>\n<li>addMessage:添加消息，将消息放到eventQueue中，等待执行</li>\n<li><p>fireMessage：立即将消息传递给对应的监听者，即立即执行</p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/d3a7a1131d0248f5233ceb0c1a87879f43ea1b49/imageStorage/NM3000/sendMessage.png\" alt=\"sendMessage\"></p>\n<p> 重点：封装消息对象，设置监听该消息的接口和响应方法。</p>\n<p> <img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/d3a7a1131d0248f5233ceb0c1a87879f43ea1b49/imageStorage/NM3000/fireMessage.png\" alt=\"fireMessage\"></p>\n<p> 使用反射，从消息对象中获得响应方法，invoke执行，即将消息传递给指定接口的监听者。</p>\n</li>\n</ul>\n<h3 id=\"2-6-消息对象：主题和监听者之间传递的事件描述对象。\"><a href=\"#2-6-消息对象：主题和监听者之间传递的事件描述对象。\" class=\"headerlink\" title=\"2.6  消息对象：主题和监听者之间传递的事件描述对象。\"></a>2.6  消息对象：主题和监听者之间传递的事件描述对象。</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/87acf6357b65e538382dcffc92e8901f77bf138b/imageStorage/NM3000/EmsEventObject.png\" alt=\"EmsEventObject\"></p>\n<h2 id=\"3、NM3000事件机制的使用\"><a href=\"#3、NM3000事件机制的使用\" class=\"headerlink\" title=\"3、NM3000事件机制的使用\"></a>3、NM3000事件机制的使用</h2><ol>\n<li>新建*Listener接口，继承EmsListener</li>\n<li>新建<em>Adapter类，继承EmsAdapter，实现</em>Listener接口。(可选)</li>\n<li>新建<em>Event类，继承EmsEventObject&lt;</em>Listener&gt;类</li>\n</ol>\n<p>一般在service层使用消息。</p>\n<ol>\n<li>在监听者实现类(实现监听者接口)中注MessageServiceImpl类，并在initialize方法中添加<em>Listener接口。在destroy方法中移除</em>Listener接口。<br>注意：在配置*serviceImpl实现类时，需要配置初始化及销毁时方法。示例：<br>messageService.addListener(CmcEntityListener.class, this);<br>messageService.removeListener(CmcEntityListener.class, this);</li>\n<li><p>在需要发送消息的地方，构建消息对象，设置监听接口及方法，调用messageService发送消息。<br>addMessage:将消息添加到消息缓冲队列，延迟执行<br>fireMessage:立即执行</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/d3a7a1131d0248f5233ceb0c1a87879f43ea1b49/imageStorage/NM3000/sendMessage.png\" alt=\"此处输入图片的描述\"></p>\n</li>\n</ol>"},{"title":"Mybatis(4)——Mapper.xml映射文件","date":"2018-02-27T08:24:43.000Z","_content":"Mapper.xml映射文件中定义了操作数据库的sql，每个sql是一个statement，映射文件是mybatis的核心。\n<!--more-->\n\nSQL 映射文件有很少的几个顶级元素（按照它们应该被定义的顺序）：\n\ncache – 给定命名空间的缓存配置。\ncache-ref – 其他命名空间缓存配置的引用。\nresultMap – 是最复杂也是最强大的元素，用来描述如何从数据库结果集中来加载对象。\nparameterMap – 已废弃！老式风格的参数映射。内联参数是首选,这个元素可能在将来被移除，这里不会记录。\nsql – 可被其他语句引用的可重用语句块。\ninsert – 映射插入语句\nupdate – 映射更新语句\ndelete – 映射删除语句\nselect – 映射查询语句\n下一部分将从语句本身开始来描述每个元素的细节。\n\n\n## 1、parameterType(输入类型)\n\n### 1.1 传递简单类型\n\n```xml\n<!-- 根据名称模糊查询用户信息 -->\n<select id=\"selectUserByName\" parameterType=\"string\" resultType=\"user\">\n   select * from user where username like '%${value}%'\n</select>\n\n<!-- 根据id查询用户信息 -->\n<select id=\"selectUserById\" parameterType=\"int\" resultType=\"user\">\n   select * from user where userId = #{id}\n</select>\n```\n\n### 1.2 传递pojo\n\nMybatis使用ognl表达式解析对象字段的值，如下例子：\n\n```xml\n<!-- 传递pojo对象综合查询用户信息 -->\n<select id=\"findUserByUser\" parameterType=\"user\" resultType=\"user\">\n   select * from user where id=#{id} and username like '%${username}%'\n</select>\n```\n\nid 和 username 都是 User对象里面的属性字段。\n\n\n### 1.3 传递pojo包装对象\n\n```java\npublic class QueryVo {\n\t\n\tprivate User user;\n\t\n\t//自定义用户扩展类\n\tprivate UserCustom userCustom;\n\n```\n```xml\n<!-- 传递pojo包装对象综合查询用户信息 -->\n<select id=\"findUserList\" parameterType=\"queryVo\" resultType=\"user\">\n   select * from user where id=#{user.id} and username like '%${user.username}%'\n</select>\n```\n### 1.4 传递hashmap\n\n```xml\n<!-- 传递hashmap综合查询用户信息 -->\n<select id=\"findUserByHashmap\" parameterType=\"hashmap\" resultType=\"user\">\n    select * from user where id=#{id} and username like '%${username}%'\n</select>\n```\n\nid和username是map的key\n\n## 2、resultType(输出类型)\n\n**输出简单类型，输出pojo,输出pojo列表（list），输出hashmap**\n\n输出pojo对象和输出pojo列表在sql中定义的resultType是一样的。\n返回单个pojo对象要保证sql查询出来的结果集为单条，内部使用session.selectOne方法调用，mapper接口使用pojo对象作为方法返回值。\n\n返回pojo列表表示查询出来的结果集可能为多条，内部使用session.selectList方法，mapper接口使用List<pojo>对象作为方法返回值。\n\n输出pojo对象可以改用hashmap输出类型，将输出的字段名称作为map的key，value为字段值。\n\n## 3、resultMap\n\nresultType可以指定pojo将查询结果映射为pojo，但需要pojo的属性名和sql查询的列名一致方可映射成功。\n如果sql查询字段名和pojo的属性名不一致，可以通过resultMap将字段名和属性名作一个对应关系 ，resultMap实质上还需要将查询结果映射到pojo对象中。\nresultMap可以实现将查询结果映射为复杂类型的pojo，比如在查询结果映射对象中包括pojo和list实现一对一查询和一对多查询。\n\n\n## 4、动态sql\n\n通过mybatis提供的各种标签方法实现动态拼接sql。\n\n### 4.1 if\n\n```xml\n<!-- 传递pojo综合查询用户信息 -->\n<select id=\"findUserList\" parameterType=\"user\" resultType=\"user\">\n\tselect * from user \n\twhere 1=1 \n\t<if test=\"id!=null and id!=''\">\n\t    and id=#{id}\n\t</if>\n\t<if test=\"username!=null and username!=''\">\n\t    and username like '%${username}%'\n\t</if>\n</select>\n```\n\n### 4.2 where\n\n```xml\n<select id=\"findUserList\" parameterType=\"user\" resultType=\"user\">\n\tselect * from user \n\t<where>\n    \t<if test=\"id!=null and id!=''\">\n    \t    and id=#{id}\n    \t</if>\n    \t<if test=\"username!=null and username!=''\">\n    \t    and username like '%${username}%'\n    \t</if>\n\t</where>\n</select>\n```\n\nwhere 元素知道只有在一个以上的if条件有值的情况下才去插入“WHERE”子句。而且，若最后的内容是“AND”或“OR”开头的，where 元素也知道如何将他们去除。\n\n### 4.3 choose, when, otherwise\n有些时候，我们不想用到所有的条件语句，而只想从中择其一二。针对这种情况，MyBatis 提供了 choose 元素，它有点像 Java 中的 switch 语句。\n\n```xml\n<select id=\"findActiveBlogLike\"\n     resultType=\"Blog\">\n  SELECT * FROM BLOG WHERE state = ‘ACTIVE’\n  <choose>\n    <when test=\"title != null\">\n      AND title like #{title}\n    </when>\n    <when test=\"author != null and author.name != null\">\n      AND author_name like #{author.name}\n    </when>\n    <otherwise>\n      AND featured = 1\n    </otherwise>\n  </choose>\n</select>\n```\n\n### 4.4 foreach\n\n向sql传递数组或List，mybatis使用foreach解析，如下：\n\n 1. 通过pojo传递list\n \n    ```xml\n    <if test=\"ids!=null and ids.size>0\">\n        <foreach collection=\"ids\" open=\" and id in(\" close=\")\" item=\"id\" separator=\",\" >\n        #{id}\n        </foreach>\n    </if>\n    ```\n \n 2. 传递单个List\n\n    ```xml\n\t<select id=\"selectUserByList\" parameterType=\"java.util.List\" resultType=\"user\">\n\t\tselect * from user\n\t\t<where>\n\t\t\t<!-- 传递List，List中是pojo -->\n\t\t\t<if test=\"list!=null\">\n\t\t\t\t<foreach collection=\"list\" item=\"item\" open=\"and id in(\"\n\t\t\t\t\tseparator=\",\" close=\")\">\n\t\t\t\t\t#{item.id}\n\t\t\t\t</foreach>\n\t\t\t</if>\n\t\t</where>\n\t</select>\n    ```\n\n 3. 传递单个数组（数组中是pojo）\n\n    ```xml\n    <!-- 传递数组综合查询用户信息 -->\n\t<select id=\"selectUserByArray\" parameterType=\"Object[]\" resultType=\"user\">\n\t\tselect * from user\n\t\t<where>\n\t\t\t<!-- 传递数组 -->\n\t\t\t<if test=\"array!=null\">\n\t\t\t\t<foreach collection=\"array\" index=\"index\" item=\"item\" open=\"and id in(\"\n\t\t\t\t\tseparator=\",\" close=\")\">\n\t\t\t\t\t#{item.id}\n\t\t\t\t</foreach>\n\t\t\t</if>\n\t\t</where>\n\t</select>\n    ```\n\n 4. 传递单个数组（数组中是字符串类型）\n \n    ```xml\n    <!-- 传递数组综合查询用户信息 -->\n\t<select id=\"selectUserByArray\" parameterType=\"Object[]\" resultType=\"user\">\n\t\tselect * from user\n\t\t<where>\n\t\t\t<!-- 传递数组 -->\n\t\t\t<if test=\"array!=null\">\n\t\t\t\t<foreach collection=\"array\" index=\"index\" item=\"item\" open=\"and id in(\"\n\t\t\t\t\tseparator=\",\" close=\")\">\n\t\t\t\t\t#{item}\n\t\t\t\t</foreach>\n\t\t\t</if>\n\t\t</where>\n\t</select>\n    ```\n    \n\n 5. SQL片段\n\n    感觉实际开发中不怎么使用，不利于维护。\n    \n\n\n## 5、#{}与\\${}\n\n 1. #{}实现的是向prepareStatement中的预处理语句中设置参数值，sql语句中#{}表示一个占位符即?。使用占位符#{}可以有效防止sql注入，在使用时不需要关心参数值的类型，mybatis会自动进行java类型和jdbc类型的转换。#{}可以接收简单类型值或pojo属性值，如果parameterType传输单个简单类型值，#{}括号中可以是value或其它名称\n 2. \\${}和#{}不同，通过\\${}可以将parameterType传入的内容拼接在sql中且不进行jdbc类型转换,\\${}可以接收简单类型值或pojo属性值，如果parameterType传输单个简单类型值，\\${}括号中只能是value，使用\\${}不能防止sql注入。\n 3. 模糊查询时，推荐使用\\${}\n\n    ```xml\n    <!-- 根据名称模糊查询用户信息 -->\n    <select id=\"selectUserByName\" parameterType=\"string\" resultType=\"user\">\n        select * from user where username like '%${value}%'\n    </select>\n    ```\n\n 4. order by排序，如果将列名通过参数传入sql，根据传的列名进行排序，应该写为：\nORDER BY \\${columnName}\n如果使用#{}将无法实现此功能。","source":"_posts/Mybatis-4-——Mapper-xml映射文件.md","raw":"---\ntitle: Mybatis(4)——Mapper.xml映射文件\ncategories:\n  - Mybatis\ntags:\n  - Mybatis\ndate: 2018-02-27 16:24:43\n---\nMapper.xml映射文件中定义了操作数据库的sql，每个sql是一个statement，映射文件是mybatis的核心。\n<!--more-->\n\nSQL 映射文件有很少的几个顶级元素（按照它们应该被定义的顺序）：\n\ncache – 给定命名空间的缓存配置。\ncache-ref – 其他命名空间缓存配置的引用。\nresultMap – 是最复杂也是最强大的元素，用来描述如何从数据库结果集中来加载对象。\nparameterMap – 已废弃！老式风格的参数映射。内联参数是首选,这个元素可能在将来被移除，这里不会记录。\nsql – 可被其他语句引用的可重用语句块。\ninsert – 映射插入语句\nupdate – 映射更新语句\ndelete – 映射删除语句\nselect – 映射查询语句\n下一部分将从语句本身开始来描述每个元素的细节。\n\n\n## 1、parameterType(输入类型)\n\n### 1.1 传递简单类型\n\n```xml\n<!-- 根据名称模糊查询用户信息 -->\n<select id=\"selectUserByName\" parameterType=\"string\" resultType=\"user\">\n   select * from user where username like '%${value}%'\n</select>\n\n<!-- 根据id查询用户信息 -->\n<select id=\"selectUserById\" parameterType=\"int\" resultType=\"user\">\n   select * from user where userId = #{id}\n</select>\n```\n\n### 1.2 传递pojo\n\nMybatis使用ognl表达式解析对象字段的值，如下例子：\n\n```xml\n<!-- 传递pojo对象综合查询用户信息 -->\n<select id=\"findUserByUser\" parameterType=\"user\" resultType=\"user\">\n   select * from user where id=#{id} and username like '%${username}%'\n</select>\n```\n\nid 和 username 都是 User对象里面的属性字段。\n\n\n### 1.3 传递pojo包装对象\n\n```java\npublic class QueryVo {\n\t\n\tprivate User user;\n\t\n\t//自定义用户扩展类\n\tprivate UserCustom userCustom;\n\n```\n```xml\n<!-- 传递pojo包装对象综合查询用户信息 -->\n<select id=\"findUserList\" parameterType=\"queryVo\" resultType=\"user\">\n   select * from user where id=#{user.id} and username like '%${user.username}%'\n</select>\n```\n### 1.4 传递hashmap\n\n```xml\n<!-- 传递hashmap综合查询用户信息 -->\n<select id=\"findUserByHashmap\" parameterType=\"hashmap\" resultType=\"user\">\n    select * from user where id=#{id} and username like '%${username}%'\n</select>\n```\n\nid和username是map的key\n\n## 2、resultType(输出类型)\n\n**输出简单类型，输出pojo,输出pojo列表（list），输出hashmap**\n\n输出pojo对象和输出pojo列表在sql中定义的resultType是一样的。\n返回单个pojo对象要保证sql查询出来的结果集为单条，内部使用session.selectOne方法调用，mapper接口使用pojo对象作为方法返回值。\n\n返回pojo列表表示查询出来的结果集可能为多条，内部使用session.selectList方法，mapper接口使用List<pojo>对象作为方法返回值。\n\n输出pojo对象可以改用hashmap输出类型，将输出的字段名称作为map的key，value为字段值。\n\n## 3、resultMap\n\nresultType可以指定pojo将查询结果映射为pojo，但需要pojo的属性名和sql查询的列名一致方可映射成功。\n如果sql查询字段名和pojo的属性名不一致，可以通过resultMap将字段名和属性名作一个对应关系 ，resultMap实质上还需要将查询结果映射到pojo对象中。\nresultMap可以实现将查询结果映射为复杂类型的pojo，比如在查询结果映射对象中包括pojo和list实现一对一查询和一对多查询。\n\n\n## 4、动态sql\n\n通过mybatis提供的各种标签方法实现动态拼接sql。\n\n### 4.1 if\n\n```xml\n<!-- 传递pojo综合查询用户信息 -->\n<select id=\"findUserList\" parameterType=\"user\" resultType=\"user\">\n\tselect * from user \n\twhere 1=1 \n\t<if test=\"id!=null and id!=''\">\n\t    and id=#{id}\n\t</if>\n\t<if test=\"username!=null and username!=''\">\n\t    and username like '%${username}%'\n\t</if>\n</select>\n```\n\n### 4.2 where\n\n```xml\n<select id=\"findUserList\" parameterType=\"user\" resultType=\"user\">\n\tselect * from user \n\t<where>\n    \t<if test=\"id!=null and id!=''\">\n    \t    and id=#{id}\n    \t</if>\n    \t<if test=\"username!=null and username!=''\">\n    \t    and username like '%${username}%'\n    \t</if>\n\t</where>\n</select>\n```\n\nwhere 元素知道只有在一个以上的if条件有值的情况下才去插入“WHERE”子句。而且，若最后的内容是“AND”或“OR”开头的，where 元素也知道如何将他们去除。\n\n### 4.3 choose, when, otherwise\n有些时候，我们不想用到所有的条件语句，而只想从中择其一二。针对这种情况，MyBatis 提供了 choose 元素，它有点像 Java 中的 switch 语句。\n\n```xml\n<select id=\"findActiveBlogLike\"\n     resultType=\"Blog\">\n  SELECT * FROM BLOG WHERE state = ‘ACTIVE’\n  <choose>\n    <when test=\"title != null\">\n      AND title like #{title}\n    </when>\n    <when test=\"author != null and author.name != null\">\n      AND author_name like #{author.name}\n    </when>\n    <otherwise>\n      AND featured = 1\n    </otherwise>\n  </choose>\n</select>\n```\n\n### 4.4 foreach\n\n向sql传递数组或List，mybatis使用foreach解析，如下：\n\n 1. 通过pojo传递list\n \n    ```xml\n    <if test=\"ids!=null and ids.size>0\">\n        <foreach collection=\"ids\" open=\" and id in(\" close=\")\" item=\"id\" separator=\",\" >\n        #{id}\n        </foreach>\n    </if>\n    ```\n \n 2. 传递单个List\n\n    ```xml\n\t<select id=\"selectUserByList\" parameterType=\"java.util.List\" resultType=\"user\">\n\t\tselect * from user\n\t\t<where>\n\t\t\t<!-- 传递List，List中是pojo -->\n\t\t\t<if test=\"list!=null\">\n\t\t\t\t<foreach collection=\"list\" item=\"item\" open=\"and id in(\"\n\t\t\t\t\tseparator=\",\" close=\")\">\n\t\t\t\t\t#{item.id}\n\t\t\t\t</foreach>\n\t\t\t</if>\n\t\t</where>\n\t</select>\n    ```\n\n 3. 传递单个数组（数组中是pojo）\n\n    ```xml\n    <!-- 传递数组综合查询用户信息 -->\n\t<select id=\"selectUserByArray\" parameterType=\"Object[]\" resultType=\"user\">\n\t\tselect * from user\n\t\t<where>\n\t\t\t<!-- 传递数组 -->\n\t\t\t<if test=\"array!=null\">\n\t\t\t\t<foreach collection=\"array\" index=\"index\" item=\"item\" open=\"and id in(\"\n\t\t\t\t\tseparator=\",\" close=\")\">\n\t\t\t\t\t#{item.id}\n\t\t\t\t</foreach>\n\t\t\t</if>\n\t\t</where>\n\t</select>\n    ```\n\n 4. 传递单个数组（数组中是字符串类型）\n \n    ```xml\n    <!-- 传递数组综合查询用户信息 -->\n\t<select id=\"selectUserByArray\" parameterType=\"Object[]\" resultType=\"user\">\n\t\tselect * from user\n\t\t<where>\n\t\t\t<!-- 传递数组 -->\n\t\t\t<if test=\"array!=null\">\n\t\t\t\t<foreach collection=\"array\" index=\"index\" item=\"item\" open=\"and id in(\"\n\t\t\t\t\tseparator=\",\" close=\")\">\n\t\t\t\t\t#{item}\n\t\t\t\t</foreach>\n\t\t\t</if>\n\t\t</where>\n\t</select>\n    ```\n    \n\n 5. SQL片段\n\n    感觉实际开发中不怎么使用，不利于维护。\n    \n\n\n## 5、#{}与\\${}\n\n 1. #{}实现的是向prepareStatement中的预处理语句中设置参数值，sql语句中#{}表示一个占位符即?。使用占位符#{}可以有效防止sql注入，在使用时不需要关心参数值的类型，mybatis会自动进行java类型和jdbc类型的转换。#{}可以接收简单类型值或pojo属性值，如果parameterType传输单个简单类型值，#{}括号中可以是value或其它名称\n 2. \\${}和#{}不同，通过\\${}可以将parameterType传入的内容拼接在sql中且不进行jdbc类型转换,\\${}可以接收简单类型值或pojo属性值，如果parameterType传输单个简单类型值，\\${}括号中只能是value，使用\\${}不能防止sql注入。\n 3. 模糊查询时，推荐使用\\${}\n\n    ```xml\n    <!-- 根据名称模糊查询用户信息 -->\n    <select id=\"selectUserByName\" parameterType=\"string\" resultType=\"user\">\n        select * from user where username like '%${value}%'\n    </select>\n    ```\n\n 4. order by排序，如果将列名通过参数传入sql，根据传的列名进行排序，应该写为：\nORDER BY \\${columnName}\n如果使用#{}将无法实现此功能。","slug":"Mybatis-4-——Mapper-xml映射文件","published":1,"updated":"2018-03-06T08:30:14.651Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qftr001yhwvfxwcyx6yl","content":"<p>Mapper.xml映射文件中定义了操作数据库的sql，每个sql是一个statement，映射文件是mybatis的核心。<br><a id=\"more\"></a></p>\n<p>SQL 映射文件有很少的几个顶级元素（按照它们应该被定义的顺序）：</p>\n<p>cache – 给定命名空间的缓存配置。<br>cache-ref – 其他命名空间缓存配置的引用。<br>resultMap – 是最复杂也是最强大的元素，用来描述如何从数据库结果集中来加载对象。<br>parameterMap – 已废弃！老式风格的参数映射。内联参数是首选,这个元素可能在将来被移除，这里不会记录。<br>sql – 可被其他语句引用的可重用语句块。<br>insert – 映射插入语句<br>update – 映射更新语句<br>delete – 映射删除语句<br>select – 映射查询语句<br>下一部分将从语句本身开始来描述每个元素的细节。</p>\n<h2 id=\"1、parameterType-输入类型\"><a href=\"#1、parameterType-输入类型\" class=\"headerlink\" title=\"1、parameterType(输入类型)\"></a>1、parameterType(输入类型)</h2><h3 id=\"1-1-传递简单类型\"><a href=\"#1-1-传递简单类型\" class=\"headerlink\" title=\"1.1 传递简单类型\"></a>1.1 传递简单类型</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 根据名称模糊查询用户信息 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"selectUserByName\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"string\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">   select * from user where username like '%$&#123;value&#125;%'</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">&lt;!-- 根据id查询用户信息 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"selectUserById\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"int\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">   select * from user where userId = #&#123;id&#125;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"1-2-传递pojo\"><a href=\"#1-2-传递pojo\" class=\"headerlink\" title=\"1.2 传递pojo\"></a>1.2 传递pojo</h3><p>Mybatis使用ognl表达式解析对象字段的值，如下例子：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 传递pojo对象综合查询用户信息 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findUserByUser\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">   select * from user where id=#&#123;id&#125; and username like '%$&#123;username&#125;%'</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>id 和 username 都是 User对象里面的属性字段。</p>\n<h3 id=\"1-3-传递pojo包装对象\"><a href=\"#1-3-传递pojo包装对象\" class=\"headerlink\" title=\"1.3 传递pojo包装对象\"></a>1.3 传递pojo包装对象</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">QueryVo</span> </span>&#123;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"keyword\">private</span> User user;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">//自定义用户扩展类</span></div><div class=\"line\">\t<span class=\"keyword\">private</span> UserCustom userCustom;</div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 传递pojo包装对象综合查询用户信息 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findUserList\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"queryVo\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">   select * from user where id=#&#123;user.id&#125; and username like '%$&#123;user.username&#125;%'</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"1-4-传递hashmap\"><a href=\"#1-4-传递hashmap\" class=\"headerlink\" title=\"1.4 传递hashmap\"></a>1.4 传递hashmap</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 传递hashmap综合查询用户信息 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findUserByHashmap\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"hashmap\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">    select * from user where id=#&#123;id&#125; and username like '%$&#123;username&#125;%'</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>id和username是map的key</p>\n<h2 id=\"2、resultType-输出类型\"><a href=\"#2、resultType-输出类型\" class=\"headerlink\" title=\"2、resultType(输出类型)\"></a>2、resultType(输出类型)</h2><p><strong>输出简单类型，输出pojo,输出pojo列表（list），输出hashmap</strong></p>\n<p>输出pojo对象和输出pojo列表在sql中定义的resultType是一样的。<br>返回单个pojo对象要保证sql查询出来的结果集为单条，内部使用session.selectOne方法调用，mapper接口使用pojo对象作为方法返回值。</p>\n<p>返回pojo列表表示查询出来的结果集可能为多条，内部使用session.selectList方法，mapper接口使用List<pojo>对象作为方法返回值。</pojo></p>\n<p>输出pojo对象可以改用hashmap输出类型，将输出的字段名称作为map的key，value为字段值。</p>\n<h2 id=\"3、resultMap\"><a href=\"#3、resultMap\" class=\"headerlink\" title=\"3、resultMap\"></a>3、resultMap</h2><p>resultType可以指定pojo将查询结果映射为pojo，但需要pojo的属性名和sql查询的列名一致方可映射成功。<br>如果sql查询字段名和pojo的属性名不一致，可以通过resultMap将字段名和属性名作一个对应关系 ，resultMap实质上还需要将查询结果映射到pojo对象中。<br>resultMap可以实现将查询结果映射为复杂类型的pojo，比如在查询结果映射对象中包括pojo和list实现一对一查询和一对多查询。</p>\n<h2 id=\"4、动态sql\"><a href=\"#4、动态sql\" class=\"headerlink\" title=\"4、动态sql\"></a>4、动态sql</h2><p>通过mybatis提供的各种标签方法实现动态拼接sql。</p>\n<h3 id=\"4-1-if\"><a href=\"#4-1-if\" class=\"headerlink\" title=\"4.1 if\"></a>4.1 if</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 传递pojo综合查询用户信息 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findUserList\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">\tselect * from user </div><div class=\"line\">\twhere 1=1 </div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"id!=null and id!=''\"</span>&gt;</span></div><div class=\"line\">\t    and id=#&#123;id&#125;</div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"username!=null and username!=''\"</span>&gt;</span></div><div class=\"line\">\t    and username like '%$&#123;username&#125;%'</div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"4-2-where\"><a href=\"#4-2-where\" class=\"headerlink\" title=\"4.2 where\"></a>4.2 where</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findUserList\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">\tselect * from user </div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"id!=null and id!=''\"</span>&gt;</span></div><div class=\"line\">    \t    and id=#&#123;id&#125;</div><div class=\"line\">    \t<span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"username!=null and username!=''\"</span>&gt;</span></div><div class=\"line\">    \t    and username like '%$&#123;username&#125;%'</div><div class=\"line\">    \t<span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>where 元素知道只有在一个以上的if条件有值的情况下才去插入“WHERE”子句。而且，若最后的内容是“AND”或“OR”开头的，where 元素也知道如何将他们去除。</p>\n<h3 id=\"4-3-choose-when-otherwise\"><a href=\"#4-3-choose-when-otherwise\" class=\"headerlink\" title=\"4.3 choose, when, otherwise\"></a>4.3 choose, when, otherwise</h3><p>有些时候，我们不想用到所有的条件语句，而只想从中择其一二。针对这种情况，MyBatis 提供了 choose 元素，它有点像 Java 中的 switch 语句。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findActiveBlogLike\"</span></span></div><div class=\"line\">     <span class=\"attr\">resultType</span>=<span class=\"string\">\"Blog\"</span>&gt;</div><div class=\"line\">  SELECT * FROM BLOG WHERE state = ‘ACTIVE’</div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">choose</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">when</span> <span class=\"attr\">test</span>=<span class=\"string\">\"title != null\"</span>&gt;</span></div><div class=\"line\">      AND title like #&#123;title&#125;</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">when</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">when</span> <span class=\"attr\">test</span>=<span class=\"string\">\"author != null and author.name != null\"</span>&gt;</span></div><div class=\"line\">      AND author_name like #&#123;author.name&#125;</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">when</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">otherwise</span>&gt;</span></div><div class=\"line\">      AND featured = 1</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">otherwise</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">choose</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"4-4-foreach\"><a href=\"#4-4-foreach\" class=\"headerlink\" title=\"4.4 foreach\"></a>4.4 foreach</h3><p>向sql传递数组或List，mybatis使用foreach解析，如下：</p>\n<ol>\n<li><p>通过pojo传递list</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"ids!=null and ids.size&gt;0\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">foreach</span> <span class=\"attr\">collection</span>=<span class=\"string\">\"ids\"</span> <span class=\"attr\">open</span>=<span class=\"string\">\" and id in(\"</span> <span class=\"attr\">close</span>=<span class=\"string\">\")\"</span> <span class=\"attr\">item</span>=<span class=\"string\">\"id\"</span> <span class=\"attr\">separator</span>=<span class=\"string\">\",\"</span> &gt;</span></div><div class=\"line\">    #&#123;id&#125;</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">foreach</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>传递单个List</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"selectUserByList\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"java.util.List\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">\tselect * from user</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 传递List，List中是pojo --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"list!=null\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">foreach</span> <span class=\"attr\">collection</span>=<span class=\"string\">\"list\"</span> <span class=\"attr\">item</span>=<span class=\"string\">\"item\"</span> <span class=\"attr\">open</span>=<span class=\"string\">\"and id in(\"</span></span></div><div class=\"line\">\t\t\t\t<span class=\"attr\">separator</span>=<span class=\"string\">\",\"</span> <span class=\"attr\">close</span>=<span class=\"string\">\")\"</span>&gt;</div><div class=\"line\">\t\t\t\t#&#123;item.id&#125;</div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">foreach</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>传递单个数组（数组中是pojo）</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"comment\">&lt;!-- 传递数组综合查询用户信息 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"selectUserByArray\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"Object[]\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">\tselect * from user</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 传递数组 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"array!=null\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">foreach</span> <span class=\"attr\">collection</span>=<span class=\"string\">\"array\"</span> <span class=\"attr\">index</span>=<span class=\"string\">\"index\"</span> <span class=\"attr\">item</span>=<span class=\"string\">\"item\"</span> <span class=\"attr\">open</span>=<span class=\"string\">\"and id in(\"</span></span></div><div class=\"line\">\t\t\t\t<span class=\"attr\">separator</span>=<span class=\"string\">\",\"</span> <span class=\"attr\">close</span>=<span class=\"string\">\")\"</span>&gt;</div><div class=\"line\">\t\t\t\t#&#123;item.id&#125;</div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">foreach</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>传递单个数组（数组中是字符串类型）</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"comment\">&lt;!-- 传递数组综合查询用户信息 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"selectUserByArray\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"Object[]\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">\tselect * from user</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 传递数组 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"array!=null\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">foreach</span> <span class=\"attr\">collection</span>=<span class=\"string\">\"array\"</span> <span class=\"attr\">index</span>=<span class=\"string\">\"index\"</span> <span class=\"attr\">item</span>=<span class=\"string\">\"item\"</span> <span class=\"attr\">open</span>=<span class=\"string\">\"and id in(\"</span></span></div><div class=\"line\">\t\t\t\t<span class=\"attr\">separator</span>=<span class=\"string\">\",\"</span> <span class=\"attr\">close</span>=<span class=\"string\">\")\"</span>&gt;</div><div class=\"line\">\t\t\t\t#&#123;item&#125;</div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">foreach</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>SQL片段</p>\n<p>感觉实际开发中不怎么使用，不利于维护。</p>\n</li>\n</ol>\n<h2 id=\"5、-与\"><a href=\"#5、-与\" class=\"headerlink\" title=\"5、#{}与\\${}\"></a>5、#{}与\\${}</h2><ol>\n<li>#{}实现的是向prepareStatement中的预处理语句中设置参数值，sql语句中#{}表示一个占位符即?。使用占位符#{}可以有效防止sql注入，在使用时不需要关心参数值的类型，mybatis会自动进行java类型和jdbc类型的转换。#{}可以接收简单类型值或pojo属性值，如果parameterType传输单个简单类型值，#{}括号中可以是value或其它名称</li>\n<li>\\${}和#{}不同，通过\\${}可以将parameterType传入的内容拼接在sql中且不进行jdbc类型转换,\\${}可以接收简单类型值或pojo属性值，如果parameterType传输单个简单类型值，\\${}括号中只能是value，使用\\${}不能防止sql注入。</li>\n<li><p>模糊查询时，推荐使用\\${}</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 根据名称模糊查询用户信息 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"selectUserByName\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"string\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">    select * from user where username like '%$&#123;value&#125;%'</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>order by排序，如果将列名通过参数传入sql，根据传的列名进行排序，应该写为：<br>ORDER BY \\${columnName}<br>如果使用#{}将无法实现此功能。</p>\n</li>\n</ol>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>Mapper.xml映射文件中定义了操作数据库的sql，每个sql是一个statement，映射文件是mybatis的核心。<br>","more":"</p>\n<p>SQL 映射文件有很少的几个顶级元素（按照它们应该被定义的顺序）：</p>\n<p>cache – 给定命名空间的缓存配置。<br>cache-ref – 其他命名空间缓存配置的引用。<br>resultMap – 是最复杂也是最强大的元素，用来描述如何从数据库结果集中来加载对象。<br>parameterMap – 已废弃！老式风格的参数映射。内联参数是首选,这个元素可能在将来被移除，这里不会记录。<br>sql – 可被其他语句引用的可重用语句块。<br>insert – 映射插入语句<br>update – 映射更新语句<br>delete – 映射删除语句<br>select – 映射查询语句<br>下一部分将从语句本身开始来描述每个元素的细节。</p>\n<h2 id=\"1、parameterType-输入类型\"><a href=\"#1、parameterType-输入类型\" class=\"headerlink\" title=\"1、parameterType(输入类型)\"></a>1、parameterType(输入类型)</h2><h3 id=\"1-1-传递简单类型\"><a href=\"#1-1-传递简单类型\" class=\"headerlink\" title=\"1.1 传递简单类型\"></a>1.1 传递简单类型</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 根据名称模糊查询用户信息 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"selectUserByName\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"string\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">   select * from user where username like '%$&#123;value&#125;%'</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">&lt;!-- 根据id查询用户信息 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"selectUserById\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"int\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">   select * from user where userId = #&#123;id&#125;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"1-2-传递pojo\"><a href=\"#1-2-传递pojo\" class=\"headerlink\" title=\"1.2 传递pojo\"></a>1.2 传递pojo</h3><p>Mybatis使用ognl表达式解析对象字段的值，如下例子：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 传递pojo对象综合查询用户信息 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findUserByUser\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">   select * from user where id=#&#123;id&#125; and username like '%$&#123;username&#125;%'</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>id 和 username 都是 User对象里面的属性字段。</p>\n<h3 id=\"1-3-传递pojo包装对象\"><a href=\"#1-3-传递pojo包装对象\" class=\"headerlink\" title=\"1.3 传递pojo包装对象\"></a>1.3 传递pojo包装对象</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">QueryVo</span> </span>&#123;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"keyword\">private</span> User user;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">//自定义用户扩展类</span></div><div class=\"line\">\t<span class=\"keyword\">private</span> UserCustom userCustom;</div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 传递pojo包装对象综合查询用户信息 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findUserList\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"queryVo\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">   select * from user where id=#&#123;user.id&#125; and username like '%$&#123;user.username&#125;%'</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"1-4-传递hashmap\"><a href=\"#1-4-传递hashmap\" class=\"headerlink\" title=\"1.4 传递hashmap\"></a>1.4 传递hashmap</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 传递hashmap综合查询用户信息 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findUserByHashmap\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"hashmap\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">    select * from user where id=#&#123;id&#125; and username like '%$&#123;username&#125;%'</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>id和username是map的key</p>\n<h2 id=\"2、resultType-输出类型\"><a href=\"#2、resultType-输出类型\" class=\"headerlink\" title=\"2、resultType(输出类型)\"></a>2、resultType(输出类型)</h2><p><strong>输出简单类型，输出pojo,输出pojo列表（list），输出hashmap</strong></p>\n<p>输出pojo对象和输出pojo列表在sql中定义的resultType是一样的。<br>返回单个pojo对象要保证sql查询出来的结果集为单条，内部使用session.selectOne方法调用，mapper接口使用pojo对象作为方法返回值。</p>\n<p>返回pojo列表表示查询出来的结果集可能为多条，内部使用session.selectList方法，mapper接口使用List<pojo>对象作为方法返回值。</pojo></p>\n<p>输出pojo对象可以改用hashmap输出类型，将输出的字段名称作为map的key，value为字段值。</p>\n<h2 id=\"3、resultMap\"><a href=\"#3、resultMap\" class=\"headerlink\" title=\"3、resultMap\"></a>3、resultMap</h2><p>resultType可以指定pojo将查询结果映射为pojo，但需要pojo的属性名和sql查询的列名一致方可映射成功。<br>如果sql查询字段名和pojo的属性名不一致，可以通过resultMap将字段名和属性名作一个对应关系 ，resultMap实质上还需要将查询结果映射到pojo对象中。<br>resultMap可以实现将查询结果映射为复杂类型的pojo，比如在查询结果映射对象中包括pojo和list实现一对一查询和一对多查询。</p>\n<h2 id=\"4、动态sql\"><a href=\"#4、动态sql\" class=\"headerlink\" title=\"4、动态sql\"></a>4、动态sql</h2><p>通过mybatis提供的各种标签方法实现动态拼接sql。</p>\n<h3 id=\"4-1-if\"><a href=\"#4-1-if\" class=\"headerlink\" title=\"4.1 if\"></a>4.1 if</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 传递pojo综合查询用户信息 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findUserList\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">\tselect * from user </div><div class=\"line\">\twhere 1=1 </div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"id!=null and id!=''\"</span>&gt;</span></div><div class=\"line\">\t    and id=#&#123;id&#125;</div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"username!=null and username!=''\"</span>&gt;</span></div><div class=\"line\">\t    and username like '%$&#123;username&#125;%'</div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"4-2-where\"><a href=\"#4-2-where\" class=\"headerlink\" title=\"4.2 where\"></a>4.2 where</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findUserList\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">\tselect * from user </div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"id!=null and id!=''\"</span>&gt;</span></div><div class=\"line\">    \t    and id=#&#123;id&#125;</div><div class=\"line\">    \t<span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"username!=null and username!=''\"</span>&gt;</span></div><div class=\"line\">    \t    and username like '%$&#123;username&#125;%'</div><div class=\"line\">    \t<span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>where 元素知道只有在一个以上的if条件有值的情况下才去插入“WHERE”子句。而且，若最后的内容是“AND”或“OR”开头的，where 元素也知道如何将他们去除。</p>\n<h3 id=\"4-3-choose-when-otherwise\"><a href=\"#4-3-choose-when-otherwise\" class=\"headerlink\" title=\"4.3 choose, when, otherwise\"></a>4.3 choose, when, otherwise</h3><p>有些时候，我们不想用到所有的条件语句，而只想从中择其一二。针对这种情况，MyBatis 提供了 choose 元素，它有点像 Java 中的 switch 语句。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"findActiveBlogLike\"</span></span></div><div class=\"line\">     <span class=\"attr\">resultType</span>=<span class=\"string\">\"Blog\"</span>&gt;</div><div class=\"line\">  SELECT * FROM BLOG WHERE state = ‘ACTIVE’</div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">choose</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">when</span> <span class=\"attr\">test</span>=<span class=\"string\">\"title != null\"</span>&gt;</span></div><div class=\"line\">      AND title like #&#123;title&#125;</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">when</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">when</span> <span class=\"attr\">test</span>=<span class=\"string\">\"author != null and author.name != null\"</span>&gt;</span></div><div class=\"line\">      AND author_name like #&#123;author.name&#125;</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">when</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">otherwise</span>&gt;</span></div><div class=\"line\">      AND featured = 1</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">otherwise</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">choose</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"4-4-foreach\"><a href=\"#4-4-foreach\" class=\"headerlink\" title=\"4.4 foreach\"></a>4.4 foreach</h3><p>向sql传递数组或List，mybatis使用foreach解析，如下：</p>\n<ol>\n<li><p>通过pojo传递list</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"ids!=null and ids.size&gt;0\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">foreach</span> <span class=\"attr\">collection</span>=<span class=\"string\">\"ids\"</span> <span class=\"attr\">open</span>=<span class=\"string\">\" and id in(\"</span> <span class=\"attr\">close</span>=<span class=\"string\">\")\"</span> <span class=\"attr\">item</span>=<span class=\"string\">\"id\"</span> <span class=\"attr\">separator</span>=<span class=\"string\">\",\"</span> &gt;</span></div><div class=\"line\">    #&#123;id&#125;</div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">foreach</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>传递单个List</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"selectUserByList\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"java.util.List\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">\tselect * from user</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 传递List，List中是pojo --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"list!=null\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">foreach</span> <span class=\"attr\">collection</span>=<span class=\"string\">\"list\"</span> <span class=\"attr\">item</span>=<span class=\"string\">\"item\"</span> <span class=\"attr\">open</span>=<span class=\"string\">\"and id in(\"</span></span></div><div class=\"line\">\t\t\t\t<span class=\"attr\">separator</span>=<span class=\"string\">\",\"</span> <span class=\"attr\">close</span>=<span class=\"string\">\")\"</span>&gt;</div><div class=\"line\">\t\t\t\t#&#123;item.id&#125;</div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">foreach</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>传递单个数组（数组中是pojo）</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"comment\">&lt;!-- 传递数组综合查询用户信息 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"selectUserByArray\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"Object[]\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">\tselect * from user</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 传递数组 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"array!=null\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">foreach</span> <span class=\"attr\">collection</span>=<span class=\"string\">\"array\"</span> <span class=\"attr\">index</span>=<span class=\"string\">\"index\"</span> <span class=\"attr\">item</span>=<span class=\"string\">\"item\"</span> <span class=\"attr\">open</span>=<span class=\"string\">\"and id in(\"</span></span></div><div class=\"line\">\t\t\t\t<span class=\"attr\">separator</span>=<span class=\"string\">\",\"</span> <span class=\"attr\">close</span>=<span class=\"string\">\")\"</span>&gt;</div><div class=\"line\">\t\t\t\t#&#123;item.id&#125;</div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">foreach</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>传递单个数组（数组中是字符串类型）</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"comment\">&lt;!-- 传递数组综合查询用户信息 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"selectUserByArray\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"Object[]\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">\tselect * from user</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">where</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 传递数组 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">\"array!=null\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">foreach</span> <span class=\"attr\">collection</span>=<span class=\"string\">\"array\"</span> <span class=\"attr\">index</span>=<span class=\"string\">\"index\"</span> <span class=\"attr\">item</span>=<span class=\"string\">\"item\"</span> <span class=\"attr\">open</span>=<span class=\"string\">\"and id in(\"</span></span></div><div class=\"line\">\t\t\t\t<span class=\"attr\">separator</span>=<span class=\"string\">\",\"</span> <span class=\"attr\">close</span>=<span class=\"string\">\")\"</span>&gt;</div><div class=\"line\">\t\t\t\t#&#123;item&#125;</div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">foreach</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">where</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>SQL片段</p>\n<p>感觉实际开发中不怎么使用，不利于维护。</p>\n</li>\n</ol>\n<h2 id=\"5、-与\"><a href=\"#5、-与\" class=\"headerlink\" title=\"5、#{}与\\${}\"></a>5、#{}与\\${}</h2><ol>\n<li>#{}实现的是向prepareStatement中的预处理语句中设置参数值，sql语句中#{}表示一个占位符即?。使用占位符#{}可以有效防止sql注入，在使用时不需要关心参数值的类型，mybatis会自动进行java类型和jdbc类型的转换。#{}可以接收简单类型值或pojo属性值，如果parameterType传输单个简单类型值，#{}括号中可以是value或其它名称</li>\n<li>\\${}和#{}不同，通过\\${}可以将parameterType传入的内容拼接在sql中且不进行jdbc类型转换,\\${}可以接收简单类型值或pojo属性值，如果parameterType传输单个简单类型值，\\${}括号中只能是value，使用\\${}不能防止sql注入。</li>\n<li><p>模糊查询时，推荐使用\\${}</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 根据名称模糊查询用户信息 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">\"selectUserByName\"</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">\"string\"</span> <span class=\"attr\">resultType</span>=<span class=\"string\">\"user\"</span>&gt;</span></div><div class=\"line\">    select * from user where username like '%$&#123;value&#125;%'</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>order by排序，如果将列名通过参数传入sql，根据传的列名进行排序，应该写为：<br>ORDER BY \\${columnName}<br>如果使用#{}将无法实现此功能。</p>\n</li>\n</ol>"},{"title":"Mysql触发器","keyword":["Mysql","触发器"],"date":"2018-02-13T01:34:00.000Z","_content":"触发器（TRIGGER）是MySQL的数据库对象之一，从5.0.2版本开始支持。它和函数比较相似，也需要声明和执行，但是它不用程序或人工调用，而是由事件驱动的。\n\n那么，什么是触发器？\n    \n在MySQL Server里面也就是对某一个表的一定的操作，触发某种条件（Insert,Update,Delete 等），从而自动执行的一段程序。从这种意义上讲触发器是一个特殊的存储过程\n<!--more-->\n\n## 1、语法\n\n```sql\nCREATE TRIGGER trigger_name\ntrigger_time trigger_event\nON tbl_name\nFOR EACH ROW \ntrigger_body              \n```\n\n - trigger_name：触发器的名称，不能与已经存在的触发器重复；\n - trigger_time：{ BEFORE | AFTER }，表示在事件之前或之后触发；\n - trigger_event:：{ INSERT |UPDATE | DELETE }，触发该触发器的具体事件；\n - tbl_name：该触发器作用在tbl_name上；\n - trigger_body：sql语句\n\n你必须拥有相当大的权限才能创建触发器（CREATE TRIGGER），如果你已经是Root用户，那么就足够了。这跟SQL的标准有所不同。\n\n## 2、实例\n\n创建学生表\n\n```sql\nCREATE TABLE `student` (\n  `id` int(5) NOT NULL AUTO_INCREMENT,\n  `classId` int(5) NOT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8\n```\n\n创建班级表\n\n```sql\nCREATE TABLE `class` (\n  `id` int(5) NOT NULL,\n  `name` varchar(10) NOT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8\n```\n\n创建插入触发器\n\n```sql\nCREATE TRIGGER tri_insert\nAFTER INSERT \nON student\nFOR EACH ROW\nBEGIN\n  DECLARE c INT;\n  SET c = (SELECT num from class WHERE id = new.classId);\n  UPDATE class SET num = c + 1 WHERE id = new.classId;\nEND\n```\n\n插入一条数据到student表，class表对应的班级学生数+1\n\n## 3、变量详解\n\nMySQL 中使用 DECLARE 来定义一局部变量，该变量只能在 BEGIN … END 复合语句中使用，并且应该定义在复合语句的开头，\n\n即其它语句之前，语法如下：\n\n```sql\nDECLARE var_name[,...] type [DEFAULT value]\n```\n\n - var_name 为变量名称，同 SQL 语句一样，变量名不区分大小写；\n - type 为 MySQL 支持的任何数据类型；可以同时定义多个同类型的变量，用逗号隔开；\n\n变量初始值为 NULL，如果需要，可以使用DEFAULT子句提供默认值，值可以被指定为一个表达式。\n\n对变量赋值采用 SET 语句，语法为：\n\n```sql\nSET var_name = expr [,var_name = expr] ...\n```\n\n## 4、NEW 与 OLD 详解\n\n上述示例中使用了NEW关键字，和 MS SQL Server 中的 INSERTED 和 DELETED 类似，MySQL 中定义了 NEW 和 OLD，用来表示\n\n触发器的所在表中，触发了触发器的那一行数据。\n具体地：\n在 INSERT 型触发器中，NEW用来表示将要（BEFORE）或已经（AFTER）插入的新数据；\n在 UPDATE 型触发器中，OLD用来表示将要或已经被修改的原数据，NEW用来表示将要或已经修改为的新数据；\n在 DELETE 型触发器中，OLD 用来表示将要或已经被删除的原数据；\n\n使用方法： NEW.columnName （columnName 为相应数据表某一列名）\n另外，OLD 是只读的，而 NEW 则可以在触发器中使用 SET 赋值，这样不会再次触发触发器，造成循环调用（如每插入一个学生前，都在其学号前加“2013”）。\n\n## 5、查看与删除触发器\n\n和查看数据库（show databases;）查看表格（showtables;）一样，查看触发器的语法如下：\n\n```sql\nSHOW TRIGGERS [FROM schema_name];\n```\n\n其中，schema_name 即 Schema 的名称，在 MySQL 中 Schema 和 Database 是一样的，也就是说，可以指定数据库名，这样就不必先“USE database_name;”了。\n \n和删除数据库、删除表格一样，删除触发器的语法如下：\n \n```sql\nDROP TRIGGER [IF EXISTS] [schema_name.]trigger_name\n```\n## 6、执行顺序\n\n我们建立的数据库一般都是 InnoDB 数据库，其上建立的表是事务性表，也就是事务安全的。这时，若SQL语句或触发器执行失败，MySQL 会回滚事务，有：\n\n①如果 BEFORE 触发器执行失败，SQL 无法正确执行。\n②SQL 执行失败时，AFTER 型触发器不会触发。\n③AFTER 类型的触发器执行失败，SQL 会回滚。\n  \n","source":"_posts/Mysql触发器.md","raw":"---\ntitle: Mysql触发器\ncategories:\n  - Mysql\ntags:\n  - Mysql\n  - 数据库\nkeyword:\n  - Mysql\n  - 触发器\ndate: 2018-02-13 09:34:00\n---\n触发器（TRIGGER）是MySQL的数据库对象之一，从5.0.2版本开始支持。它和函数比较相似，也需要声明和执行，但是它不用程序或人工调用，而是由事件驱动的。\n\n那么，什么是触发器？\n    \n在MySQL Server里面也就是对某一个表的一定的操作，触发某种条件（Insert,Update,Delete 等），从而自动执行的一段程序。从这种意义上讲触发器是一个特殊的存储过程\n<!--more-->\n\n## 1、语法\n\n```sql\nCREATE TRIGGER trigger_name\ntrigger_time trigger_event\nON tbl_name\nFOR EACH ROW \ntrigger_body              \n```\n\n - trigger_name：触发器的名称，不能与已经存在的触发器重复；\n - trigger_time：{ BEFORE | AFTER }，表示在事件之前或之后触发；\n - trigger_event:：{ INSERT |UPDATE | DELETE }，触发该触发器的具体事件；\n - tbl_name：该触发器作用在tbl_name上；\n - trigger_body：sql语句\n\n你必须拥有相当大的权限才能创建触发器（CREATE TRIGGER），如果你已经是Root用户，那么就足够了。这跟SQL的标准有所不同。\n\n## 2、实例\n\n创建学生表\n\n```sql\nCREATE TABLE `student` (\n  `id` int(5) NOT NULL AUTO_INCREMENT,\n  `classId` int(5) NOT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8\n```\n\n创建班级表\n\n```sql\nCREATE TABLE `class` (\n  `id` int(5) NOT NULL,\n  `name` varchar(10) NOT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8\n```\n\n创建插入触发器\n\n```sql\nCREATE TRIGGER tri_insert\nAFTER INSERT \nON student\nFOR EACH ROW\nBEGIN\n  DECLARE c INT;\n  SET c = (SELECT num from class WHERE id = new.classId);\n  UPDATE class SET num = c + 1 WHERE id = new.classId;\nEND\n```\n\n插入一条数据到student表，class表对应的班级学生数+1\n\n## 3、变量详解\n\nMySQL 中使用 DECLARE 来定义一局部变量，该变量只能在 BEGIN … END 复合语句中使用，并且应该定义在复合语句的开头，\n\n即其它语句之前，语法如下：\n\n```sql\nDECLARE var_name[,...] type [DEFAULT value]\n```\n\n - var_name 为变量名称，同 SQL 语句一样，变量名不区分大小写；\n - type 为 MySQL 支持的任何数据类型；可以同时定义多个同类型的变量，用逗号隔开；\n\n变量初始值为 NULL，如果需要，可以使用DEFAULT子句提供默认值，值可以被指定为一个表达式。\n\n对变量赋值采用 SET 语句，语法为：\n\n```sql\nSET var_name = expr [,var_name = expr] ...\n```\n\n## 4、NEW 与 OLD 详解\n\n上述示例中使用了NEW关键字，和 MS SQL Server 中的 INSERTED 和 DELETED 类似，MySQL 中定义了 NEW 和 OLD，用来表示\n\n触发器的所在表中，触发了触发器的那一行数据。\n具体地：\n在 INSERT 型触发器中，NEW用来表示将要（BEFORE）或已经（AFTER）插入的新数据；\n在 UPDATE 型触发器中，OLD用来表示将要或已经被修改的原数据，NEW用来表示将要或已经修改为的新数据；\n在 DELETE 型触发器中，OLD 用来表示将要或已经被删除的原数据；\n\n使用方法： NEW.columnName （columnName 为相应数据表某一列名）\n另外，OLD 是只读的，而 NEW 则可以在触发器中使用 SET 赋值，这样不会再次触发触发器，造成循环调用（如每插入一个学生前，都在其学号前加“2013”）。\n\n## 5、查看与删除触发器\n\n和查看数据库（show databases;）查看表格（showtables;）一样，查看触发器的语法如下：\n\n```sql\nSHOW TRIGGERS [FROM schema_name];\n```\n\n其中，schema_name 即 Schema 的名称，在 MySQL 中 Schema 和 Database 是一样的，也就是说，可以指定数据库名，这样就不必先“USE database_name;”了。\n \n和删除数据库、删除表格一样，删除触发器的语法如下：\n \n```sql\nDROP TRIGGER [IF EXISTS] [schema_name.]trigger_name\n```\n## 6、执行顺序\n\n我们建立的数据库一般都是 InnoDB 数据库，其上建立的表是事务性表，也就是事务安全的。这时，若SQL语句或触发器执行失败，MySQL 会回滚事务，有：\n\n①如果 BEFORE 触发器执行失败，SQL 无法正确执行。\n②SQL 执行失败时，AFTER 型触发器不会触发。\n③AFTER 类型的触发器执行失败，SQL 会回滚。\n  \n","slug":"Mysql触发器","published":1,"updated":"2018-04-11T03:32:54.538Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qftt0021hwvfi5lt419g","content":"<p>触发器（TRIGGER）是MySQL的数据库对象之一，从5.0.2版本开始支持。它和函数比较相似，也需要声明和执行，但是它不用程序或人工调用，而是由事件驱动的。</p>\n<p>那么，什么是触发器？</p>\n<p>在MySQL Server里面也就是对某一个表的一定的操作，触发某种条件（Insert,Update,Delete 等），从而自动执行的一段程序。从这种意义上讲触发器是一个特殊的存储过程<br><a id=\"more\"></a></p>\n<h2 id=\"1、语法\"><a href=\"#1、语法\" class=\"headerlink\" title=\"1、语法\"></a>1、语法</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TRIGGER</span> trigger_name</div><div class=\"line\">trigger_time trigger_event</div><div class=\"line\"><span class=\"keyword\">ON</span> tbl_name</div><div class=\"line\"><span class=\"keyword\">FOR</span> <span class=\"keyword\">EACH</span> <span class=\"keyword\">ROW</span> </div><div class=\"line\">trigger_body</div></pre></td></tr></table></figure>\n<ul>\n<li>trigger_name：触发器的名称，不能与已经存在的触发器重复；</li>\n<li>trigger_time：{ BEFORE | AFTER }，表示在事件之前或之后触发；</li>\n<li>trigger_event:：{ INSERT |UPDATE | DELETE }，触发该触发器的具体事件；</li>\n<li>tbl_name：该触发器作用在tbl_name上；</li>\n<li>trigger_body：sql语句</li>\n</ul>\n<p>你必须拥有相当大的权限才能创建触发器（CREATE TRIGGER），如果你已经是Root用户，那么就足够了。这跟SQL的标准有所不同。</p>\n<h2 id=\"2、实例\"><a href=\"#2、实例\" class=\"headerlink\" title=\"2、实例\"></a>2、实例</h2><p>创建学生表</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"string\">`student`</span> (</div><div class=\"line\">  <span class=\"string\">`id`</span> <span class=\"built_in\">int</span>(<span class=\"number\">5</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> AUTO_INCREMENT,</div><div class=\"line\">  <span class=\"string\">`classId`</span> <span class=\"built_in\">int</span>(<span class=\"number\">5</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  PRIMARY <span class=\"keyword\">KEY</span> (<span class=\"string\">`id`</span>)</div><div class=\"line\">) <span class=\"keyword\">ENGINE</span>=<span class=\"keyword\">InnoDB</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">CHARSET</span>=utf8</div></pre></td></tr></table></figure>\n<p>创建班级表</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"string\">`class`</span> (</div><div class=\"line\">  <span class=\"string\">`id`</span> <span class=\"built_in\">int</span>(<span class=\"number\">5</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  <span class=\"string\">`name`</span> <span class=\"built_in\">varchar</span>(<span class=\"number\">10</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  PRIMARY <span class=\"keyword\">KEY</span> (<span class=\"string\">`id`</span>)</div><div class=\"line\">) <span class=\"keyword\">ENGINE</span>=<span class=\"keyword\">InnoDB</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">CHARSET</span>=utf8</div></pre></td></tr></table></figure>\n<p>创建插入触发器</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TRIGGER</span> tri_insert</div><div class=\"line\"><span class=\"keyword\">AFTER</span> <span class=\"keyword\">INSERT</span> </div><div class=\"line\"><span class=\"keyword\">ON</span> student</div><div class=\"line\"><span class=\"keyword\">FOR</span> <span class=\"keyword\">EACH</span> <span class=\"keyword\">ROW</span></div><div class=\"line\"><span class=\"keyword\">BEGIN</span></div><div class=\"line\">  <span class=\"keyword\">DECLARE</span> c <span class=\"built_in\">INT</span>;</div><div class=\"line\">  <span class=\"keyword\">SET</span> c = (<span class=\"keyword\">SELECT</span> <span class=\"keyword\">num</span> <span class=\"keyword\">from</span> <span class=\"keyword\">class</span> <span class=\"keyword\">WHERE</span> <span class=\"keyword\">id</span> = new.classId);</div><div class=\"line\">  <span class=\"keyword\">UPDATE</span> <span class=\"keyword\">class</span> <span class=\"keyword\">SET</span> <span class=\"keyword\">num</span> = c + <span class=\"number\">1</span> <span class=\"keyword\">WHERE</span> <span class=\"keyword\">id</span> = new.classId;</div><div class=\"line\"><span class=\"keyword\">END</span></div></pre></td></tr></table></figure>\n<p>插入一条数据到student表，class表对应的班级学生数+1</p>\n<h2 id=\"3、变量详解\"><a href=\"#3、变量详解\" class=\"headerlink\" title=\"3、变量详解\"></a>3、变量详解</h2><p>MySQL 中使用 DECLARE 来定义一局部变量，该变量只能在 BEGIN … END 复合语句中使用，并且应该定义在复合语句的开头，</p>\n<p>即其它语句之前，语法如下：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">DECLARE</span> var_name[,...] <span class=\"keyword\">type</span> [<span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">value</span>]</div></pre></td></tr></table></figure>\n<ul>\n<li>var_name 为变量名称，同 SQL 语句一样，变量名不区分大小写；</li>\n<li>type 为 MySQL 支持的任何数据类型；可以同时定义多个同类型的变量，用逗号隔开；</li>\n</ul>\n<p>变量初始值为 NULL，如果需要，可以使用DEFAULT子句提供默认值，值可以被指定为一个表达式。</p>\n<p>对变量赋值采用 SET 语句，语法为：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">SET</span> var_name = expr [,var_name = expr] ...</div></pre></td></tr></table></figure>\n<h2 id=\"4、NEW-与-OLD-详解\"><a href=\"#4、NEW-与-OLD-详解\" class=\"headerlink\" title=\"4、NEW 与 OLD 详解\"></a>4、NEW 与 OLD 详解</h2><p>上述示例中使用了NEW关键字，和 MS SQL Server 中的 INSERTED 和 DELETED 类似，MySQL 中定义了 NEW 和 OLD，用来表示</p>\n<p>触发器的所在表中，触发了触发器的那一行数据。<br>具体地：<br>在 INSERT 型触发器中，NEW用来表示将要（BEFORE）或已经（AFTER）插入的新数据；<br>在 UPDATE 型触发器中，OLD用来表示将要或已经被修改的原数据，NEW用来表示将要或已经修改为的新数据；<br>在 DELETE 型触发器中，OLD 用来表示将要或已经被删除的原数据；</p>\n<p>使用方法： NEW.columnName （columnName 为相应数据表某一列名）<br>另外，OLD 是只读的，而 NEW 则可以在触发器中使用 SET 赋值，这样不会再次触发触发器，造成循环调用（如每插入一个学生前，都在其学号前加“2013”）。</p>\n<h2 id=\"5、查看与删除触发器\"><a href=\"#5、查看与删除触发器\" class=\"headerlink\" title=\"5、查看与删除触发器\"></a>5、查看与删除触发器</h2><p>和查看数据库（show databases;）查看表格（showtables;）一样，查看触发器的语法如下：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">SHOW</span> <span class=\"keyword\">TRIGGERS</span> [<span class=\"keyword\">FROM</span> schema_name];</div></pre></td></tr></table></figure>\n<p>其中，schema_name 即 Schema 的名称，在 MySQL 中 Schema 和 Database 是一样的，也就是说，可以指定数据库名，这样就不必先“USE database_name;”了。</p>\n<p>和删除数据库、删除表格一样，删除触发器的语法如下：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">TRIGGER</span> [<span class=\"keyword\">IF</span> <span class=\"keyword\">EXISTS</span>] [schema_name.]trigger_name</div></pre></td></tr></table></figure>\n<h2 id=\"6、执行顺序\"><a href=\"#6、执行顺序\" class=\"headerlink\" title=\"6、执行顺序\"></a>6、执行顺序</h2><p>我们建立的数据库一般都是 InnoDB 数据库，其上建立的表是事务性表，也就是事务安全的。这时，若SQL语句或触发器执行失败，MySQL 会回滚事务，有：</p>\n<p>①如果 BEFORE 触发器执行失败，SQL 无法正确执行。<br>②SQL 执行失败时，AFTER 型触发器不会触发。<br>③AFTER 类型的触发器执行失败，SQL 会回滚。</p>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>触发器（TRIGGER）是MySQL的数据库对象之一，从5.0.2版本开始支持。它和函数比较相似，也需要声明和执行，但是它不用程序或人工调用，而是由事件驱动的。</p>\n<p>那么，什么是触发器？</p>\n<p>在MySQL Server里面也就是对某一个表的一定的操作，触发某种条件（Insert,Update,Delete 等），从而自动执行的一段程序。从这种意义上讲触发器是一个特殊的存储过程<br>","more":"</p>\n<h2 id=\"1、语法\"><a href=\"#1、语法\" class=\"headerlink\" title=\"1、语法\"></a>1、语法</h2><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TRIGGER</span> trigger_name</div><div class=\"line\">trigger_time trigger_event</div><div class=\"line\"><span class=\"keyword\">ON</span> tbl_name</div><div class=\"line\"><span class=\"keyword\">FOR</span> <span class=\"keyword\">EACH</span> <span class=\"keyword\">ROW</span> </div><div class=\"line\">trigger_body</div></pre></td></tr></table></figure>\n<ul>\n<li>trigger_name：触发器的名称，不能与已经存在的触发器重复；</li>\n<li>trigger_time：{ BEFORE | AFTER }，表示在事件之前或之后触发；</li>\n<li>trigger_event:：{ INSERT |UPDATE | DELETE }，触发该触发器的具体事件；</li>\n<li>tbl_name：该触发器作用在tbl_name上；</li>\n<li>trigger_body：sql语句</li>\n</ul>\n<p>你必须拥有相当大的权限才能创建触发器（CREATE TRIGGER），如果你已经是Root用户，那么就足够了。这跟SQL的标准有所不同。</p>\n<h2 id=\"2、实例\"><a href=\"#2、实例\" class=\"headerlink\" title=\"2、实例\"></a>2、实例</h2><p>创建学生表</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"string\">`student`</span> (</div><div class=\"line\">  <span class=\"string\">`id`</span> <span class=\"built_in\">int</span>(<span class=\"number\">5</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span> AUTO_INCREMENT,</div><div class=\"line\">  <span class=\"string\">`classId`</span> <span class=\"built_in\">int</span>(<span class=\"number\">5</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  PRIMARY <span class=\"keyword\">KEY</span> (<span class=\"string\">`id`</span>)</div><div class=\"line\">) <span class=\"keyword\">ENGINE</span>=<span class=\"keyword\">InnoDB</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">CHARSET</span>=utf8</div></pre></td></tr></table></figure>\n<p>创建班级表</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TABLE</span> <span class=\"string\">`class`</span> (</div><div class=\"line\">  <span class=\"string\">`id`</span> <span class=\"built_in\">int</span>(<span class=\"number\">5</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  <span class=\"string\">`name`</span> <span class=\"built_in\">varchar</span>(<span class=\"number\">10</span>) <span class=\"keyword\">NOT</span> <span class=\"literal\">NULL</span>,</div><div class=\"line\">  PRIMARY <span class=\"keyword\">KEY</span> (<span class=\"string\">`id`</span>)</div><div class=\"line\">) <span class=\"keyword\">ENGINE</span>=<span class=\"keyword\">InnoDB</span> <span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">CHARSET</span>=utf8</div></pre></td></tr></table></figure>\n<p>创建插入触发器</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TRIGGER</span> tri_insert</div><div class=\"line\"><span class=\"keyword\">AFTER</span> <span class=\"keyword\">INSERT</span> </div><div class=\"line\"><span class=\"keyword\">ON</span> student</div><div class=\"line\"><span class=\"keyword\">FOR</span> <span class=\"keyword\">EACH</span> <span class=\"keyword\">ROW</span></div><div class=\"line\"><span class=\"keyword\">BEGIN</span></div><div class=\"line\">  <span class=\"keyword\">DECLARE</span> c <span class=\"built_in\">INT</span>;</div><div class=\"line\">  <span class=\"keyword\">SET</span> c = (<span class=\"keyword\">SELECT</span> <span class=\"keyword\">num</span> <span class=\"keyword\">from</span> <span class=\"keyword\">class</span> <span class=\"keyword\">WHERE</span> <span class=\"keyword\">id</span> = new.classId);</div><div class=\"line\">  <span class=\"keyword\">UPDATE</span> <span class=\"keyword\">class</span> <span class=\"keyword\">SET</span> <span class=\"keyword\">num</span> = c + <span class=\"number\">1</span> <span class=\"keyword\">WHERE</span> <span class=\"keyword\">id</span> = new.classId;</div><div class=\"line\"><span class=\"keyword\">END</span></div></pre></td></tr></table></figure>\n<p>插入一条数据到student表，class表对应的班级学生数+1</p>\n<h2 id=\"3、变量详解\"><a href=\"#3、变量详解\" class=\"headerlink\" title=\"3、变量详解\"></a>3、变量详解</h2><p>MySQL 中使用 DECLARE 来定义一局部变量，该变量只能在 BEGIN … END 复合语句中使用，并且应该定义在复合语句的开头，</p>\n<p>即其它语句之前，语法如下：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">DECLARE</span> var_name[,...] <span class=\"keyword\">type</span> [<span class=\"keyword\">DEFAULT</span> <span class=\"keyword\">value</span>]</div></pre></td></tr></table></figure>\n<ul>\n<li>var_name 为变量名称，同 SQL 语句一样，变量名不区分大小写；</li>\n<li>type 为 MySQL 支持的任何数据类型；可以同时定义多个同类型的变量，用逗号隔开；</li>\n</ul>\n<p>变量初始值为 NULL，如果需要，可以使用DEFAULT子句提供默认值，值可以被指定为一个表达式。</p>\n<p>对变量赋值采用 SET 语句，语法为：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">SET</span> var_name = expr [,var_name = expr] ...</div></pre></td></tr></table></figure>\n<h2 id=\"4、NEW-与-OLD-详解\"><a href=\"#4、NEW-与-OLD-详解\" class=\"headerlink\" title=\"4、NEW 与 OLD 详解\"></a>4、NEW 与 OLD 详解</h2><p>上述示例中使用了NEW关键字，和 MS SQL Server 中的 INSERTED 和 DELETED 类似，MySQL 中定义了 NEW 和 OLD，用来表示</p>\n<p>触发器的所在表中，触发了触发器的那一行数据。<br>具体地：<br>在 INSERT 型触发器中，NEW用来表示将要（BEFORE）或已经（AFTER）插入的新数据；<br>在 UPDATE 型触发器中，OLD用来表示将要或已经被修改的原数据，NEW用来表示将要或已经修改为的新数据；<br>在 DELETE 型触发器中，OLD 用来表示将要或已经被删除的原数据；</p>\n<p>使用方法： NEW.columnName （columnName 为相应数据表某一列名）<br>另外，OLD 是只读的，而 NEW 则可以在触发器中使用 SET 赋值，这样不会再次触发触发器，造成循环调用（如每插入一个学生前，都在其学号前加“2013”）。</p>\n<h2 id=\"5、查看与删除触发器\"><a href=\"#5、查看与删除触发器\" class=\"headerlink\" title=\"5、查看与删除触发器\"></a>5、查看与删除触发器</h2><p>和查看数据库（show databases;）查看表格（showtables;）一样，查看触发器的语法如下：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">SHOW</span> <span class=\"keyword\">TRIGGERS</span> [<span class=\"keyword\">FROM</span> schema_name];</div></pre></td></tr></table></figure>\n<p>其中，schema_name 即 Schema 的名称，在 MySQL 中 Schema 和 Database 是一样的，也就是说，可以指定数据库名，这样就不必先“USE database_name;”了。</p>\n<p>和删除数据库、删除表格一样，删除触发器的语法如下：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">TRIGGER</span> [<span class=\"keyword\">IF</span> <span class=\"keyword\">EXISTS</span>] [schema_name.]trigger_name</div></pre></td></tr></table></figure>\n<h2 id=\"6、执行顺序\"><a href=\"#6、执行顺序\" class=\"headerlink\" title=\"6、执行顺序\"></a>6、执行顺序</h2><p>我们建立的数据库一般都是 InnoDB 数据库，其上建立的表是事务性表，也就是事务安全的。这时，若SQL语句或触发器执行失败，MySQL 会回滚事务，有：</p>\n<p>①如果 BEFORE 触发器执行失败，SQL 无法正确执行。<br>②SQL 执行失败时，AFTER 型触发器不会触发。<br>③AFTER 类型的触发器执行失败，SQL 会回滚。</p>"},{"title":"SNMP学习总结(2)——snmp安装和配置","date":"2017-05-25T00:42:50.000Z","_content":"这篇博客简要介绍了snmp的安装\n<!-- more -->\n\n针对不同的操作系统有不同的操作流程，具体参见[孤傲苍狼的博客][1]。\n\n\n  [1]: http://www.cnblogs.com/xdp-gacl/category/613358.html","source":"_posts/SNMP学习总结(2)——snmp安装和配置.md","raw":"---\ntitle: SNMP学习总结(2)——snmp安装和配置\ndate: 2017-05-25 8:42:50\ncategories:\n  - SNMP\ntags:\n  - snmp\n  - network\n  - snmp4j\n---\n这篇博客简要介绍了snmp的安装\n<!-- more -->\n\n针对不同的操作系统有不同的操作流程，具体参见[孤傲苍狼的博客][1]。\n\n\n  [1]: http://www.cnblogs.com/xdp-gacl/category/613358.html","slug":"SNMP学习总结(2)——snmp安装和配置","published":1,"updated":"2018-02-27T07:38:38.091Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qftw0026hwvf93cu6816","content":"<p>这篇博客简要介绍了snmp的安装<br><a id=\"more\"></a></p>\n<p>针对不同的操作系统有不同的操作流程，具体参见<a href=\"http://www.cnblogs.com/xdp-gacl/category/613358.html\" target=\"_blank\" rel=\"noopener\">孤傲苍狼的博客</a>。</p>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>这篇博客简要介绍了snmp的安装<br>","more":"</p>\n<p>针对不同的操作系统有不同的操作流程，具体参见<a href=\"http://www.cnblogs.com/xdp-gacl/category/613358.html\" target=\"_blank\" rel=\"noopener\">孤傲苍狼的博客</a>。</p>"},{"title":"SNMP学习总结(1)——基本概念","date":"2017-05-25T00:42:50.000Z","_content":"这篇博客简要介绍了snmp协议的基本概念\n<!-- more -->\n## 1 SNMP简单概述\n\n### 1.1 什么是SNMP?\n\n　　SNMP是英文\"Simple Network Management Protocol\"的缩写，中文意思是“简单的网络管理协议”。它属于TCP/IP五层协议中的应用层协议，用于网络管理的协议。SNMP主要用于网络设备的管理。由于SNMP协议简单可靠 ，受到了众多厂商的欢迎，成为了目前最为广泛的网管协议。\n　　SNMP协议主要由两大部分组成：**SNMP管理站**和**SNMP代理**。SNMP管理站是一个中心节点，负责收集维护各个SNMP元素的信息，并对这些信息进行处理，最后反馈给网络管理员；而SNMP代理是运行在各个被管理的网络节点之上，负责统计该节点的各项信息，并且负责与SNMP管理站交互，接收并执行管理站的命令，上传各种本地的网络信息。\n　　SNMP管理站和SNMP代理之间是松散耦合。他们之间的通信是通过UDP协议完成的。一般情况下，SNMP管理站通过UDP协议向SNMP代理发送各种命令，当SNMP代理收到命令后，返回SNMP管理站需要的参数。但是当SNMP代理检测到网络元素异常的时候，也可以主动向SNMP管理站发送消息，通告当前异常状况。\n　　SNMP的基本思想：为不同种类的设备、不同厂家生产的设备、不同型号的设备，定义为一个统一的接口和协议，使得管理员可以是使用统一的外观面对这些需要管理的网络设备进行管理。通过网络，管理员可以管理位于不同物理空间的设备，从而大大提高网络管理的效率，简化网络管理员的工作。\n　　SNMP的工作方式：管理员需要向设备获取数据，所以SNMP提供了【读】操作；管理员需要向设备执行设置操作，所以SNMP提供了【写】操作；设备需要在重要状况改变的时候，向管理员通报事件的发生，所以SNMP提供了【Trap】操作。\n\n### 1.2 SNMP和UDP\n\nSNMP采用UDP协议在管理端和agent之间传输信息。 SNMP采用UDP161端口接收和发送请求，162端口接收trap，执行SNMP的设备缺省都必须采用这些端口。SNMP消息全部通过UDP端口161接收，只有Trap信息采用UDP端口162。\n \n### 1.3 Snmp版本\n\nSNMP目前共有v1，v2，v3这三个版本： \n\n - SNMP v1是SNMP协议的最初版本，不过依然是众多厂家实现SNMP基本方式。 \n - SNMP v2通常被指是基于community的SNMP V2。Community实质上就是密码。\n - SNMP v3 是最新版本的SNMP。它对网络管理最大的贡献在于其安全性。增加了对认证和密文传输的支持。\n\n## 2 SNMP工作原理\n　　在具体的实现上，SNMP为管理员提供了一个网管平台（NMS），又称为管理站，负责网管命令的发出、数据存储及数据分析。被监管的设备上运行一个SNMP代理（Agent），代理实现设备与管理站的SNMP通信。\n　　![snmp工作原理][1]\n　　管理站和代理端使用MIB进行接口统一，MIB定义了设备中的被管理对象。管理站和代理都实现相应的MIB对象，使得双方可以识别对方的数据，实现通信。管理站向代理请求MIB中定义的数据，代理端识别后，将管理设备提供的相关状态或参数等数据转换成MIB定义的格式，最后将该信息返回给管理站，完成一次管理操作。\n　　\n## 3 SNMP报文\n### 3.1 报文类型\n　　SNMP中定义了五种消息类型：Get-Request、Get-Response、Get-Next-Request、Set-Request和Trap。\n\n - Get-Request 、Get-Next-Request与Get-Response\nSNMP 管理站用Get-Request消息从拥有SNMP代理的网络设备中检索信息，而SNMP代理则用Get-Response消息响应。Get-Next- Request用于和Get-Request组合起来查询特定的表对象中的列元素。\n - Set-Request SNMP管理站用Set-Request 可以对网络设备进行远程配置（包括设备名、设备属性、删除设备或使某一个设备属性有效/无效等）。\n - Trap SNMP代理使用Trap向SNMP管理站发送非请求消息，一般用于描述某一事件的发生，如接口UP/DOWN，IP地址更改等。\n\n上面五种消息中Get-Request、Get-Next-Request和Set-Request是由管理站发送到代理侧的161端口的；后面两种Get-Response和Trap 是由代理进程发给管理进程的，其中Trap消息被发送到管理进程的162端口，所有数据都是走UDP封装。SNMP工作流程如图2：\n![SNMP工作流程][2]\n### 3.2 报文格式\nSNMP代理和管理站通过SNMP协议中的标准消息进行通信，每个消息都是一个单独的数据报。SNMP使用UDP（用户数据报协议）作为第四层协议（传输协议），进行无连接操作。SNMP消息报文包含两个部分：SNMP报头和协议数据单元PDU。\n![SNMP报文格式][3]\n\n**以下部分是报文格式的具体分析，有需要可以继续学习。**\n    \n　　在实际网络传输环境下，SNMP报文的长度取决于其所采用的编码方式。SNMP统一采用BER(Basic Encoding Rule)的编码规则，同时在正式SNMP规范中使用的是ASN.1语法，Abastract Syntax Notation v1，即抽象语法描述语言。这两个概念在后面实践环节再做进一步介绍，这里只要稍微了解一下即可，不妨碍我们对协议本身的分析。这里我们简单解释一下BER编码规则：\n　　BER作为ANS.1的基本编码规则，描述具体的ANS.1对象如何编码为比特流在网络上进行传输。BER编码规则由三部分组成：\n　　![BER编码方式][4]\n    SNMP中定义了几种基本的数据类型，其中v1和v2版有些改动，具体参见相应的RFC文档。这里我们只介绍几种最常见的类型：\n\n - INTEGER：一个整数\n - OCTER STRING： 0或多个8bit字节，每个字节在0~255之间取值\n - DisplayString：0或多个8bit字节，每个字节必须是ASCII码。在MIB-II中，所有该类型变量不能超过255个字符(0个字符可以)\n - NULL：代表相关的变量没有值\n - IpAddress：4字节长的OCTER STRING，以网络字节序表示IP地址\n - PhyAddress：6字节长的OCTER STRING，代表物理地址\n - Counter：非负整数，可以从0递增到232-1()。达到最大值后归0\n - TimeTicks：时间计数器，以0.01秒为单位递增，不同的变量可以有不同的递增幅度。所以在定义这种类型的变量时需要制定递增幅度\n - SEQUENCE：与C语言中的结构体类似\n - SEQUENCE OF：一个向量，参见后面ANS.1语法详细介绍章节\n\nSNMP报文在传输层是封装在UDP报文中的，而UDP又是基于IP网络的，因此，我们可以得到完整的报文描述结构，如下图所示：\n![SNMP协议报文格式][5]\nPDU类型其实包含两个字节，第一个字节表示真实的PDU的类型；第二个字节表示后面报文所占的字节总数。针对SNMPv1，这个字段取值如下：\n| PDU类型  | 名 称   |\n| :--------: | :-----:  |\n| 0     | get-request |\n| 1        |   get-next-request   |\n| 2        |    get-response    |\n| 3        |    set-request   |\n| 4        |    trap   |\n　　也就是说，trap的类型是4。但是在数据报文中，该字段一般表示为ax，其中x取[0,4]，即a0~a3表示相应的get、set等操作，a4表示trap报文。这里除了类型字段意外，其他字段均采用BER编码方式：\n![采用BER编码的字段][6]\n　　\n**实战演练之报文格式分析**\n　　Trap报文格式和上述图5所展示的结构有些差别，这里我们只分析SNMPv1和SNMPv2的Trap报文格式。trap报文前面的部分都一样，区别在PDU协议数据单元部分。\n\nSNMPv1 Trap报文\nSNMPv1的Trap报文格式如下所示：\n![SNMPv1的Trap报文格式][7]\n注意：除了PDU类型和PDU长度字段外，后面的每个字段都是BER编码方式。\n    trap类型”可以取以下值，其中0~6是已定义的特定trap，7及其以后的类型由供应商自定义。\n表2 trap类型、名称及描述信息\n| trap类型        | 名称   |  描述信息  |\n| :--------:   | :-----:  | :----:  |\n| ０     | coldStart |   代理进程对自己初始化     |\n| １        |   warmStart   |   代理进程对自己重新初始化   |\n| ２        |   linkDown    |  一个接口已从工作状态变为故障状态(报文中的第一个变量标识此接口)  |\n| ３     | linkUp |  一个接口已从故障状态变为工作状态(报文中的第一个变量标识此接口)     |\n| ４        |   authenticationFailure   |   从SNMP管理进程收到无效共同体的报文   |\n| ５        |    egpNeighborLoss    |  一个EGP邻站已变为故障状态(报文中的第一个变量包含邻站IP地址) |\n| ６     | enterpriseSpecific |   在这个特定的代码段中查找trap信息     |\n　　通过wireshark抓包工具，捕获一条如下的SNMP报文，接下来对其进行仔细分析。\nSNMPv1原始报文内容：\n\n<font color=\"green\">00 23 5a 9e 58 b9</font> <font color=\"blue\">00 4c 41 49 50 55</font> <font color=\"red\">08 005</font> <font color=\"gold\">45 00 00 48 00 00 40 00 40 11 a5 4e c0 a8 0a 01 c0 a8 0a 05</font> <font color=\"purple\">0c 00 00 a2 00 34 ff e0</font> 30 2a 02 01 00 04 06 70 75 62 6c 69 63 a4 1d 06 0a 2b 06 01 04 01 bf 08 03 02 0a 40 04 c0 a8 0a 01 02 01 00 02 01 00 43 01 0e 30 00\n \n目的MAC：<font color=\"green\">00 23 5a 9e 58 b9</font>\n源MAC：<font color=\"blue\">00 4c 41 49 50 55</font>\n协议类型：<font color=\"red\">08 005</font> ，为IP数据报\nIP头：<font color=\"gold\">45 00 00 48 00 00 40 00 40 11 a5 4e c0 a8 0a 01 c0 a8 0a 05</font>\nUDP头：<font color=\"purple\">0c 00 00 a2 00 34 ff e0</font>\n其余部分都为SNMP报文，接下来我们对照前面的报文结构体来逐个分析一下。\n\n - 30 表示SNMP消息是ASN.1的SEQUENCE类型；\n - 2a 表示该SNMP报文的总长度是42(0x2a)个字节，该字段所表示的报文长度起始于它后面的第一个字节直到报文结束；\n - 02 01 00 表示版本号，可见其确实为BER编码方式。02表示该字段是INTEGER类型；01表示该字段占1个字节；00表示版本号，该值为“版本号-1”；\n - 04 06 70 75 62 6c 69 63 表示团体名，04表示该字段为OCTET STRING类型；06表示该字段占6个字节；70 75 62 6c 69 63 表示团体名的ANSII码的十六进制形式，这里是“public”；\n - a4 1d 其中a4中的“4”表示这是一个trap报文，a4又叫报文的标签标记；1d表示后面还有29(0x1d)个字节的数据；\n - 06 0a 2b 06 01 04 01 bf 08 03 02 0a 企业OID标识。06表示该字段是个对象标识符，OBJECT IDENTIFIER；0a表示该字段占10(0x0a)个字节；关于SNMP的OID的编码方式有些奇特：例如1.3.6.1.2…. 取前两个数字分别记为x和y。编码时40*x+y，这里x=1，y=3，因此结果为40*1+3=43，即表示十六进制的2b。因此，这里的企业OID编码即为1.3.6.1.4.1.8072.3.2.10；\n - 40 04 c0 a8 0a 01 同样40表示该字段为OCTET STRING 类型；04表示IP地址占4个字节；IP地址为192.168.10.1；\n - 02 01 00 其中00表示trap类型为coldStart；\n - 02 01 00 其中00表示我们指定的trap即specific-trap也为coldStart类型；\n - 43 01 0e 43表示为TimeTicks类型；01表示该字段占1个字节；0e即十进制的14表示时间标签为0.14秒，这里时间计数器以0.01秒递增；\n - 30 00 30表示“键-值”值对的编码类型为SEQUENCE；00表示该字段占0个字节，即没有该字段。\n\nSNMPv2 Trap报文 \nSNMPv2的Trap报文格式如图8所示：\n![SNMPv2的Trap报文格式][8]\n同样的，这里除了trap类型和报文长度是标准网络字节序之外，其余协议字段也均为BER编码方式。可以看到v2版的trap报文正在向统一的报文格式发展，已经非常类似普通的SNMP请求、响应报文了。\nSNMPv2原始报文内容：\n00 23 5a 9e 58 b9 00 4c 41 49 50 55 08 00 45 00 00 7b 00 00 40 00 40 11 a5 1b c0 a8 0a 01 c0 a8 0a 05 0c 01 00 a2 00 67 04 bb 30 5d 02 01 01 04 06 70 75 62 6c 69 63 a7 50 02 04 17 73 2c fb 02 01 00 02 01 00 30 42 30 0d 06 08 2b 06 01 02 01 01 03 00 43 01 0e 30 17 06 0a 2b 06 01 06 03 01 01 04 01 00 06 09 2b 06 01 06 03 01 01 05 01 30 18 06 0a 2b 06 01 06 03 01 01 04 03 00 06 0a 2b 06 01 04 01 bf 08 03 02 0a\n \n目的MAC：00 23 5a 9e 58 b9\n源MAC：00 4c 41 49 50 55\n协议类型：08 00，IP报文\nIP头：45 00 00 7b 00 00 40 00 40 11 a5 1b c0 a8 0a 01 c0 a8 0a 05\nUDP头：0c 01 00 a2 00 67 04 bb\n余下部分全为SNMP报文内容，这里我们做一下简单的约定：\nxx 标注类型；xx 标注长度；xx 标注真正的数据。\n这样一来上面这串原始数据就好分析多了\n\n - 30 5d 整个SNMP报文的编码方式为30，即SEQUENCE类型，报文长度93(0x5d)字节；\n - 02 01 01 版本号01即v2版本；\n - 04 06 70 75 62 6c 69 63 团体名70 75 62 6c 69 63  即英文的“public”；\n - a7 50 a7表示trap类型为7，即厂商自定义trap；50表示PDU区段占80(0x50)字节；\n - 02 04 17 73 2c fb 请求ID为17 73 2c fb 十进制的393424123；\n - 02 01 00 错误状态0；\n - 02 01 00 错误索引0；\n - 30 42 “变量名-值”对编码类型30 即SEQUENCE类型；“变量名-值”所占总字节0x42，即66字节；\n - 30 0d 06 08 2b 06 01 02 01 01 03 00 43 01 0e 第一个“名-值”对区段编码方式30 即SEQUENCE类型；第一个“名-值”对总长度0x0d，13字节；第一个变量名的编码类型0x06，时间标签；第一个变量名占0x08个字节；第一个变量名2b 06 01 02 01 01 03 00，为1.3.6.1.2.1.1.3.0；第一个变量值为0x0e，即14；\n - 30 17 06 0a 2b 06 01 06 03 01 01 04 01 00 06 09 2b 06 01 06 03 01 01 05 01 第二个“名-值”对；变量名1.3.6.1.6.3.1.1.4.1.0；变量值1.3.6.1.6.3.1.1.5.1；\n - 30 18 06 0a 2b 06 01 06 03 01 01 04 03 00 06 0a 2b 06 01 04 01 bf 08 03 02 0a 第三个“名-值”对；变量名1.3.6.1.6.3.1.1.4.3.0；变量值1.3.6.1.4.1.8072.3.2.10；\n\n今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。\n  ------\n\n\n  [1]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274236dktq.jpg\n  [2]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274238733S.jpg\n  [3]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274240Yo8Q.jpg\n  [4]: http://blog.chinaunix.net/attachment/201206/21/23069658_134027424269yP.jpg\n  [5]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274245phSV.jpg\n  [6]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274247srSc.jpg\n  [7]: http://blog.chinaunix.net/attachment/201206/21/23069658_134027425066MR.jpg\n  [8]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274252oJOX.jpg","source":"_posts/SNMP学习总结(1)——基本概念.md","raw":"---\ntitle: SNMP学习总结(1)——基本概念\ndate: 2017-05-25 8:42:50\ncategories:\n  - SNMP\ntags:\n  - snmp\n  - network\n  - snmp4j\n---\n这篇博客简要介绍了snmp协议的基本概念\n<!-- more -->\n## 1 SNMP简单概述\n\n### 1.1 什么是SNMP?\n\n　　SNMP是英文\"Simple Network Management Protocol\"的缩写，中文意思是“简单的网络管理协议”。它属于TCP/IP五层协议中的应用层协议，用于网络管理的协议。SNMP主要用于网络设备的管理。由于SNMP协议简单可靠 ，受到了众多厂商的欢迎，成为了目前最为广泛的网管协议。\n　　SNMP协议主要由两大部分组成：**SNMP管理站**和**SNMP代理**。SNMP管理站是一个中心节点，负责收集维护各个SNMP元素的信息，并对这些信息进行处理，最后反馈给网络管理员；而SNMP代理是运行在各个被管理的网络节点之上，负责统计该节点的各项信息，并且负责与SNMP管理站交互，接收并执行管理站的命令，上传各种本地的网络信息。\n　　SNMP管理站和SNMP代理之间是松散耦合。他们之间的通信是通过UDP协议完成的。一般情况下，SNMP管理站通过UDP协议向SNMP代理发送各种命令，当SNMP代理收到命令后，返回SNMP管理站需要的参数。但是当SNMP代理检测到网络元素异常的时候，也可以主动向SNMP管理站发送消息，通告当前异常状况。\n　　SNMP的基本思想：为不同种类的设备、不同厂家生产的设备、不同型号的设备，定义为一个统一的接口和协议，使得管理员可以是使用统一的外观面对这些需要管理的网络设备进行管理。通过网络，管理员可以管理位于不同物理空间的设备，从而大大提高网络管理的效率，简化网络管理员的工作。\n　　SNMP的工作方式：管理员需要向设备获取数据，所以SNMP提供了【读】操作；管理员需要向设备执行设置操作，所以SNMP提供了【写】操作；设备需要在重要状况改变的时候，向管理员通报事件的发生，所以SNMP提供了【Trap】操作。\n\n### 1.2 SNMP和UDP\n\nSNMP采用UDP协议在管理端和agent之间传输信息。 SNMP采用UDP161端口接收和发送请求，162端口接收trap，执行SNMP的设备缺省都必须采用这些端口。SNMP消息全部通过UDP端口161接收，只有Trap信息采用UDP端口162。\n \n### 1.3 Snmp版本\n\nSNMP目前共有v1，v2，v3这三个版本： \n\n - SNMP v1是SNMP协议的最初版本，不过依然是众多厂家实现SNMP基本方式。 \n - SNMP v2通常被指是基于community的SNMP V2。Community实质上就是密码。\n - SNMP v3 是最新版本的SNMP。它对网络管理最大的贡献在于其安全性。增加了对认证和密文传输的支持。\n\n## 2 SNMP工作原理\n　　在具体的实现上，SNMP为管理员提供了一个网管平台（NMS），又称为管理站，负责网管命令的发出、数据存储及数据分析。被监管的设备上运行一个SNMP代理（Agent），代理实现设备与管理站的SNMP通信。\n　　![snmp工作原理][1]\n　　管理站和代理端使用MIB进行接口统一，MIB定义了设备中的被管理对象。管理站和代理都实现相应的MIB对象，使得双方可以识别对方的数据，实现通信。管理站向代理请求MIB中定义的数据，代理端识别后，将管理设备提供的相关状态或参数等数据转换成MIB定义的格式，最后将该信息返回给管理站，完成一次管理操作。\n　　\n## 3 SNMP报文\n### 3.1 报文类型\n　　SNMP中定义了五种消息类型：Get-Request、Get-Response、Get-Next-Request、Set-Request和Trap。\n\n - Get-Request 、Get-Next-Request与Get-Response\nSNMP 管理站用Get-Request消息从拥有SNMP代理的网络设备中检索信息，而SNMP代理则用Get-Response消息响应。Get-Next- Request用于和Get-Request组合起来查询特定的表对象中的列元素。\n - Set-Request SNMP管理站用Set-Request 可以对网络设备进行远程配置（包括设备名、设备属性、删除设备或使某一个设备属性有效/无效等）。\n - Trap SNMP代理使用Trap向SNMP管理站发送非请求消息，一般用于描述某一事件的发生，如接口UP/DOWN，IP地址更改等。\n\n上面五种消息中Get-Request、Get-Next-Request和Set-Request是由管理站发送到代理侧的161端口的；后面两种Get-Response和Trap 是由代理进程发给管理进程的，其中Trap消息被发送到管理进程的162端口，所有数据都是走UDP封装。SNMP工作流程如图2：\n![SNMP工作流程][2]\n### 3.2 报文格式\nSNMP代理和管理站通过SNMP协议中的标准消息进行通信，每个消息都是一个单独的数据报。SNMP使用UDP（用户数据报协议）作为第四层协议（传输协议），进行无连接操作。SNMP消息报文包含两个部分：SNMP报头和协议数据单元PDU。\n![SNMP报文格式][3]\n\n**以下部分是报文格式的具体分析，有需要可以继续学习。**\n    \n　　在实际网络传输环境下，SNMP报文的长度取决于其所采用的编码方式。SNMP统一采用BER(Basic Encoding Rule)的编码规则，同时在正式SNMP规范中使用的是ASN.1语法，Abastract Syntax Notation v1，即抽象语法描述语言。这两个概念在后面实践环节再做进一步介绍，这里只要稍微了解一下即可，不妨碍我们对协议本身的分析。这里我们简单解释一下BER编码规则：\n　　BER作为ANS.1的基本编码规则，描述具体的ANS.1对象如何编码为比特流在网络上进行传输。BER编码规则由三部分组成：\n　　![BER编码方式][4]\n    SNMP中定义了几种基本的数据类型，其中v1和v2版有些改动，具体参见相应的RFC文档。这里我们只介绍几种最常见的类型：\n\n - INTEGER：一个整数\n - OCTER STRING： 0或多个8bit字节，每个字节在0~255之间取值\n - DisplayString：0或多个8bit字节，每个字节必须是ASCII码。在MIB-II中，所有该类型变量不能超过255个字符(0个字符可以)\n - NULL：代表相关的变量没有值\n - IpAddress：4字节长的OCTER STRING，以网络字节序表示IP地址\n - PhyAddress：6字节长的OCTER STRING，代表物理地址\n - Counter：非负整数，可以从0递增到232-1()。达到最大值后归0\n - TimeTicks：时间计数器，以0.01秒为单位递增，不同的变量可以有不同的递增幅度。所以在定义这种类型的变量时需要制定递增幅度\n - SEQUENCE：与C语言中的结构体类似\n - SEQUENCE OF：一个向量，参见后面ANS.1语法详细介绍章节\n\nSNMP报文在传输层是封装在UDP报文中的，而UDP又是基于IP网络的，因此，我们可以得到完整的报文描述结构，如下图所示：\n![SNMP协议报文格式][5]\nPDU类型其实包含两个字节，第一个字节表示真实的PDU的类型；第二个字节表示后面报文所占的字节总数。针对SNMPv1，这个字段取值如下：\n| PDU类型  | 名 称   |\n| :--------: | :-----:  |\n| 0     | get-request |\n| 1        |   get-next-request   |\n| 2        |    get-response    |\n| 3        |    set-request   |\n| 4        |    trap   |\n　　也就是说，trap的类型是4。但是在数据报文中，该字段一般表示为ax，其中x取[0,4]，即a0~a3表示相应的get、set等操作，a4表示trap报文。这里除了类型字段意外，其他字段均采用BER编码方式：\n![采用BER编码的字段][6]\n　　\n**实战演练之报文格式分析**\n　　Trap报文格式和上述图5所展示的结构有些差别，这里我们只分析SNMPv1和SNMPv2的Trap报文格式。trap报文前面的部分都一样，区别在PDU协议数据单元部分。\n\nSNMPv1 Trap报文\nSNMPv1的Trap报文格式如下所示：\n![SNMPv1的Trap报文格式][7]\n注意：除了PDU类型和PDU长度字段外，后面的每个字段都是BER编码方式。\n    trap类型”可以取以下值，其中0~6是已定义的特定trap，7及其以后的类型由供应商自定义。\n表2 trap类型、名称及描述信息\n| trap类型        | 名称   |  描述信息  |\n| :--------:   | :-----:  | :----:  |\n| ０     | coldStart |   代理进程对自己初始化     |\n| １        |   warmStart   |   代理进程对自己重新初始化   |\n| ２        |   linkDown    |  一个接口已从工作状态变为故障状态(报文中的第一个变量标识此接口)  |\n| ３     | linkUp |  一个接口已从故障状态变为工作状态(报文中的第一个变量标识此接口)     |\n| ４        |   authenticationFailure   |   从SNMP管理进程收到无效共同体的报文   |\n| ５        |    egpNeighborLoss    |  一个EGP邻站已变为故障状态(报文中的第一个变量包含邻站IP地址) |\n| ６     | enterpriseSpecific |   在这个特定的代码段中查找trap信息     |\n　　通过wireshark抓包工具，捕获一条如下的SNMP报文，接下来对其进行仔细分析。\nSNMPv1原始报文内容：\n\n<font color=\"green\">00 23 5a 9e 58 b9</font> <font color=\"blue\">00 4c 41 49 50 55</font> <font color=\"red\">08 005</font> <font color=\"gold\">45 00 00 48 00 00 40 00 40 11 a5 4e c0 a8 0a 01 c0 a8 0a 05</font> <font color=\"purple\">0c 00 00 a2 00 34 ff e0</font> 30 2a 02 01 00 04 06 70 75 62 6c 69 63 a4 1d 06 0a 2b 06 01 04 01 bf 08 03 02 0a 40 04 c0 a8 0a 01 02 01 00 02 01 00 43 01 0e 30 00\n \n目的MAC：<font color=\"green\">00 23 5a 9e 58 b9</font>\n源MAC：<font color=\"blue\">00 4c 41 49 50 55</font>\n协议类型：<font color=\"red\">08 005</font> ，为IP数据报\nIP头：<font color=\"gold\">45 00 00 48 00 00 40 00 40 11 a5 4e c0 a8 0a 01 c0 a8 0a 05</font>\nUDP头：<font color=\"purple\">0c 00 00 a2 00 34 ff e0</font>\n其余部分都为SNMP报文，接下来我们对照前面的报文结构体来逐个分析一下。\n\n - 30 表示SNMP消息是ASN.1的SEQUENCE类型；\n - 2a 表示该SNMP报文的总长度是42(0x2a)个字节，该字段所表示的报文长度起始于它后面的第一个字节直到报文结束；\n - 02 01 00 表示版本号，可见其确实为BER编码方式。02表示该字段是INTEGER类型；01表示该字段占1个字节；00表示版本号，该值为“版本号-1”；\n - 04 06 70 75 62 6c 69 63 表示团体名，04表示该字段为OCTET STRING类型；06表示该字段占6个字节；70 75 62 6c 69 63 表示团体名的ANSII码的十六进制形式，这里是“public”；\n - a4 1d 其中a4中的“4”表示这是一个trap报文，a4又叫报文的标签标记；1d表示后面还有29(0x1d)个字节的数据；\n - 06 0a 2b 06 01 04 01 bf 08 03 02 0a 企业OID标识。06表示该字段是个对象标识符，OBJECT IDENTIFIER；0a表示该字段占10(0x0a)个字节；关于SNMP的OID的编码方式有些奇特：例如1.3.6.1.2…. 取前两个数字分别记为x和y。编码时40*x+y，这里x=1，y=3，因此结果为40*1+3=43，即表示十六进制的2b。因此，这里的企业OID编码即为1.3.6.1.4.1.8072.3.2.10；\n - 40 04 c0 a8 0a 01 同样40表示该字段为OCTET STRING 类型；04表示IP地址占4个字节；IP地址为192.168.10.1；\n - 02 01 00 其中00表示trap类型为coldStart；\n - 02 01 00 其中00表示我们指定的trap即specific-trap也为coldStart类型；\n - 43 01 0e 43表示为TimeTicks类型；01表示该字段占1个字节；0e即十进制的14表示时间标签为0.14秒，这里时间计数器以0.01秒递增；\n - 30 00 30表示“键-值”值对的编码类型为SEQUENCE；00表示该字段占0个字节，即没有该字段。\n\nSNMPv2 Trap报文 \nSNMPv2的Trap报文格式如图8所示：\n![SNMPv2的Trap报文格式][8]\n同样的，这里除了trap类型和报文长度是标准网络字节序之外，其余协议字段也均为BER编码方式。可以看到v2版的trap报文正在向统一的报文格式发展，已经非常类似普通的SNMP请求、响应报文了。\nSNMPv2原始报文内容：\n00 23 5a 9e 58 b9 00 4c 41 49 50 55 08 00 45 00 00 7b 00 00 40 00 40 11 a5 1b c0 a8 0a 01 c0 a8 0a 05 0c 01 00 a2 00 67 04 bb 30 5d 02 01 01 04 06 70 75 62 6c 69 63 a7 50 02 04 17 73 2c fb 02 01 00 02 01 00 30 42 30 0d 06 08 2b 06 01 02 01 01 03 00 43 01 0e 30 17 06 0a 2b 06 01 06 03 01 01 04 01 00 06 09 2b 06 01 06 03 01 01 05 01 30 18 06 0a 2b 06 01 06 03 01 01 04 03 00 06 0a 2b 06 01 04 01 bf 08 03 02 0a\n \n目的MAC：00 23 5a 9e 58 b9\n源MAC：00 4c 41 49 50 55\n协议类型：08 00，IP报文\nIP头：45 00 00 7b 00 00 40 00 40 11 a5 1b c0 a8 0a 01 c0 a8 0a 05\nUDP头：0c 01 00 a2 00 67 04 bb\n余下部分全为SNMP报文内容，这里我们做一下简单的约定：\nxx 标注类型；xx 标注长度；xx 标注真正的数据。\n这样一来上面这串原始数据就好分析多了\n\n - 30 5d 整个SNMP报文的编码方式为30，即SEQUENCE类型，报文长度93(0x5d)字节；\n - 02 01 01 版本号01即v2版本；\n - 04 06 70 75 62 6c 69 63 团体名70 75 62 6c 69 63  即英文的“public”；\n - a7 50 a7表示trap类型为7，即厂商自定义trap；50表示PDU区段占80(0x50)字节；\n - 02 04 17 73 2c fb 请求ID为17 73 2c fb 十进制的393424123；\n - 02 01 00 错误状态0；\n - 02 01 00 错误索引0；\n - 30 42 “变量名-值”对编码类型30 即SEQUENCE类型；“变量名-值”所占总字节0x42，即66字节；\n - 30 0d 06 08 2b 06 01 02 01 01 03 00 43 01 0e 第一个“名-值”对区段编码方式30 即SEQUENCE类型；第一个“名-值”对总长度0x0d，13字节；第一个变量名的编码类型0x06，时间标签；第一个变量名占0x08个字节；第一个变量名2b 06 01 02 01 01 03 00，为1.3.6.1.2.1.1.3.0；第一个变量值为0x0e，即14；\n - 30 17 06 0a 2b 06 01 06 03 01 01 04 01 00 06 09 2b 06 01 06 03 01 01 05 01 第二个“名-值”对；变量名1.3.6.1.6.3.1.1.4.1.0；变量值1.3.6.1.6.3.1.1.5.1；\n - 30 18 06 0a 2b 06 01 06 03 01 01 04 03 00 06 0a 2b 06 01 04 01 bf 08 03 02 0a 第三个“名-值”对；变量名1.3.6.1.6.3.1.1.4.3.0；变量值1.3.6.1.4.1.8072.3.2.10；\n\n今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。\n  ------\n\n\n  [1]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274236dktq.jpg\n  [2]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274238733S.jpg\n  [3]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274240Yo8Q.jpg\n  [4]: http://blog.chinaunix.net/attachment/201206/21/23069658_134027424269yP.jpg\n  [5]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274245phSV.jpg\n  [6]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274247srSc.jpg\n  [7]: http://blog.chinaunix.net/attachment/201206/21/23069658_134027425066MR.jpg\n  [8]: http://blog.chinaunix.net/attachment/201206/21/23069658_1340274252oJOX.jpg","slug":"SNMP学习总结(1)——基本概念","published":1,"updated":"2018-02-27T07:38:38.090Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfty0028hwvffi31zjoj","content":"<p>这篇博客简要介绍了snmp协议的基本概念<br><a id=\"more\"></a></p>\n<h2 id=\"1-SNMP简单概述\"><a href=\"#1-SNMP简单概述\" class=\"headerlink\" title=\"1 SNMP简单概述\"></a>1 SNMP简单概述</h2><h3 id=\"1-1-什么是SNMP\"><a href=\"#1-1-什么是SNMP\" class=\"headerlink\" title=\"1.1 什么是SNMP?\"></a>1.1 什么是SNMP?</h3><p>　　SNMP是英文”Simple Network Management Protocol”的缩写，中文意思是“简单的网络管理协议”。它属于TCP/IP五层协议中的应用层协议，用于网络管理的协议。SNMP主要用于网络设备的管理。由于SNMP协议简单可靠 ，受到了众多厂商的欢迎，成为了目前最为广泛的网管协议。<br>　　SNMP协议主要由两大部分组成：<strong>SNMP管理站</strong>和<strong>SNMP代理</strong>。SNMP管理站是一个中心节点，负责收集维护各个SNMP元素的信息，并对这些信息进行处理，最后反馈给网络管理员；而SNMP代理是运行在各个被管理的网络节点之上，负责统计该节点的各项信息，并且负责与SNMP管理站交互，接收并执行管理站的命令，上传各种本地的网络信息。<br>　　SNMP管理站和SNMP代理之间是松散耦合。他们之间的通信是通过UDP协议完成的。一般情况下，SNMP管理站通过UDP协议向SNMP代理发送各种命令，当SNMP代理收到命令后，返回SNMP管理站需要的参数。但是当SNMP代理检测到网络元素异常的时候，也可以主动向SNMP管理站发送消息，通告当前异常状况。<br>　　SNMP的基本思想：为不同种类的设备、不同厂家生产的设备、不同型号的设备，定义为一个统一的接口和协议，使得管理员可以是使用统一的外观面对这些需要管理的网络设备进行管理。通过网络，管理员可以管理位于不同物理空间的设备，从而大大提高网络管理的效率，简化网络管理员的工作。<br>　　SNMP的工作方式：管理员需要向设备获取数据，所以SNMP提供了【读】操作；管理员需要向设备执行设置操作，所以SNMP提供了【写】操作；设备需要在重要状况改变的时候，向管理员通报事件的发生，所以SNMP提供了【Trap】操作。</p>\n<h3 id=\"1-2-SNMP和UDP\"><a href=\"#1-2-SNMP和UDP\" class=\"headerlink\" title=\"1.2 SNMP和UDP\"></a>1.2 SNMP和UDP</h3><p>SNMP采用UDP协议在管理端和agent之间传输信息。 SNMP采用UDP161端口接收和发送请求，162端口接收trap，执行SNMP的设备缺省都必须采用这些端口。SNMP消息全部通过UDP端口161接收，只有Trap信息采用UDP端口162。</p>\n<h3 id=\"1-3-Snmp版本\"><a href=\"#1-3-Snmp版本\" class=\"headerlink\" title=\"1.3 Snmp版本\"></a>1.3 Snmp版本</h3><p>SNMP目前共有v1，v2，v3这三个版本： </p>\n<ul>\n<li>SNMP v1是SNMP协议的最初版本，不过依然是众多厂家实现SNMP基本方式。 </li>\n<li>SNMP v2通常被指是基于community的SNMP V2。Community实质上就是密码。</li>\n<li>SNMP v3 是最新版本的SNMP。它对网络管理最大的贡献在于其安全性。增加了对认证和密文传输的支持。</li>\n</ul>\n<h2 id=\"2-SNMP工作原理\"><a href=\"#2-SNMP工作原理\" class=\"headerlink\" title=\"2 SNMP工作原理\"></a>2 SNMP工作原理</h2><p>　　在具体的实现上，SNMP为管理员提供了一个网管平台（NMS），又称为管理站，负责网管命令的发出、数据存储及数据分析。被监管的设备上运行一个SNMP代理（Agent），代理实现设备与管理站的SNMP通信。<br>　　<img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274236dktq.jpg\" alt=\"snmp工作原理\"><br>　　管理站和代理端使用MIB进行接口统一，MIB定义了设备中的被管理对象。管理站和代理都实现相应的MIB对象，使得双方可以识别对方的数据，实现通信。管理站向代理请求MIB中定义的数据，代理端识别后，将管理设备提供的相关状态或参数等数据转换成MIB定义的格式，最后将该信息返回给管理站，完成一次管理操作。\n　　</p>\n<h2 id=\"3-SNMP报文\"><a href=\"#3-SNMP报文\" class=\"headerlink\" title=\"3 SNMP报文\"></a>3 SNMP报文</h2><h3 id=\"3-1-报文类型\"><a href=\"#3-1-报文类型\" class=\"headerlink\" title=\"3.1 报文类型\"></a>3.1 报文类型</h3><p>　　SNMP中定义了五种消息类型：Get-Request、Get-Response、Get-Next-Request、Set-Request和Trap。</p>\n<ul>\n<li>Get-Request 、Get-Next-Request与Get-Response<br>SNMP 管理站用Get-Request消息从拥有SNMP代理的网络设备中检索信息，而SNMP代理则用Get-Response消息响应。Get-Next- Request用于和Get-Request组合起来查询特定的表对象中的列元素。</li>\n<li>Set-Request SNMP管理站用Set-Request 可以对网络设备进行远程配置（包括设备名、设备属性、删除设备或使某一个设备属性有效/无效等）。</li>\n<li>Trap SNMP代理使用Trap向SNMP管理站发送非请求消息，一般用于描述某一事件的发生，如接口UP/DOWN，IP地址更改等。</li>\n</ul>\n<p>上面五种消息中Get-Request、Get-Next-Request和Set-Request是由管理站发送到代理侧的161端口的；后面两种Get-Response和Trap 是由代理进程发给管理进程的，其中Trap消息被发送到管理进程的162端口，所有数据都是走UDP封装。SNMP工作流程如图2：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274238733S.jpg\" alt=\"SNMP工作流程\"></p>\n<h3 id=\"3-2-报文格式\"><a href=\"#3-2-报文格式\" class=\"headerlink\" title=\"3.2 报文格式\"></a>3.2 报文格式</h3><p>SNMP代理和管理站通过SNMP协议中的标准消息进行通信，每个消息都是一个单独的数据报。SNMP使用UDP（用户数据报协议）作为第四层协议（传输协议），进行无连接操作。SNMP消息报文包含两个部分：SNMP报头和协议数据单元PDU。<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274240Yo8Q.jpg\" alt=\"SNMP报文格式\"></p>\n<p><strong>以下部分是报文格式的具体分析，有需要可以继续学习。</strong></p>\n<p>　　在实际网络传输环境下，SNMP报文的长度取决于其所采用的编码方式。SNMP统一采用BER(Basic Encoding Rule)的编码规则，同时在正式SNMP规范中使用的是ASN.1语法，Abastract Syntax Notation v1，即抽象语法描述语言。这两个概念在后面实践环节再做进一步介绍，这里只要稍微了解一下即可，不妨碍我们对协议本身的分析。这里我们简单解释一下BER编码规则：<br>　　BER作为ANS.1的基本编码规则，描述具体的ANS.1对象如何编码为比特流在网络上进行传输。BER编码规则由三部分组成：<br>　　<img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_134027424269yP.jpg\" alt=\"BER编码方式\"><br>    SNMP中定义了几种基本的数据类型，其中v1和v2版有些改动，具体参见相应的RFC文档。这里我们只介绍几种最常见的类型：</p>\n<ul>\n<li>INTEGER：一个整数</li>\n<li>OCTER STRING： 0或多个8bit字节，每个字节在0~255之间取值</li>\n<li>DisplayString：0或多个8bit字节，每个字节必须是ASCII码。在MIB-II中，所有该类型变量不能超过255个字符(0个字符可以)</li>\n<li>NULL：代表相关的变量没有值</li>\n<li>IpAddress：4字节长的OCTER STRING，以网络字节序表示IP地址</li>\n<li>PhyAddress：6字节长的OCTER STRING，代表物理地址</li>\n<li>Counter：非负整数，可以从0递增到232-1()。达到最大值后归0</li>\n<li>TimeTicks：时间计数器，以0.01秒为单位递增，不同的变量可以有不同的递增幅度。所以在定义这种类型的变量时需要制定递增幅度</li>\n<li>SEQUENCE：与C语言中的结构体类似</li>\n<li>SEQUENCE OF：一个向量，参见后面ANS.1语法详细介绍章节</li>\n</ul>\n<p>SNMP报文在传输层是封装在UDP报文中的，而UDP又是基于IP网络的，因此，我们可以得到完整的报文描述结构，如下图所示：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274245phSV.jpg\" alt=\"SNMP协议报文格式\"><br>PDU类型其实包含两个字节，第一个字节表示真实的PDU的类型；第二个字节表示后面报文所占的字节总数。针对SNMPv1，这个字段取值如下：<br>| PDU类型  | 名 称   |<br>| :——–: | :—–:  |<br>| 0     | get-request |<br>| 1        |   get-next-request   |<br>| 2        |    get-response    |<br>| 3        |    set-request   |<br>| 4        |    trap   |<br>　　也就是说，trap的类型是4。但是在数据报文中，该字段一般表示为ax，其中x取[0,4]，即a0~a3表示相应的get、set等操作，a4表示trap报文。这里除了类型字段意外，其他字段均采用BER编码方式：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274247srSc.jpg\" alt=\"采用BER编码的字段\"><br>　　<br><strong>实战演练之报文格式分析</strong><br>　　Trap报文格式和上述图5所展示的结构有些差别，这里我们只分析SNMPv1和SNMPv2的Trap报文格式。trap报文前面的部分都一样，区别在PDU协议数据单元部分。</p>\n<p>SNMPv1 Trap报文<br>SNMPv1的Trap报文格式如下所示：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_134027425066MR.jpg\" alt=\"SNMPv1的Trap报文格式\"><br>注意：除了PDU类型和PDU长度字段外，后面的每个字段都是BER编码方式。<br>    trap类型”可以取以下值，其中0~6是已定义的特定trap，7及其以后的类型由供应商自定义。<br>表2 trap类型、名称及描述信息<br>| trap类型        | 名称   |  描述信息  |<br>| :——–:   | :—–:  | :—-:  |<br>| ０     | coldStart |   代理进程对自己初始化     |<br>| １        |   warmStart   |   代理进程对自己重新初始化   |<br>| ２        |   linkDown    |  一个接口已从工作状态变为故障状态(报文中的第一个变量标识此接口)  |<br>| ３     | linkUp |  一个接口已从故障状态变为工作状态(报文中的第一个变量标识此接口)     |<br>| ４        |   authenticationFailure   |   从SNMP管理进程收到无效共同体的报文   |<br>| ５        |    egpNeighborLoss    |  一个EGP邻站已变为故障状态(报文中的第一个变量包含邻站IP地址) |<br>| ６     | enterpriseSpecific |   在这个特定的代码段中查找trap信息     |<br>　　通过wireshark抓包工具，捕获一条如下的SNMP报文，接下来对其进行仔细分析。<br>SNMPv1原始报文内容：</p>\n<p><font color=\"green\">00 23 5a 9e 58 b9</font> <font color=\"blue\">00 4c 41 49 50 55</font> <font color=\"red\">08 005</font> <font color=\"gold\">45 00 00 48 00 00 40 00 40 11 a5 4e c0 a8 0a 01 c0 a8 0a 05</font> <font color=\"purple\">0c 00 00 a2 00 34 ff e0</font> 30 2a 02 01 00 04 06 70 75 62 6c 69 63 a4 1d 06 0a 2b 06 01 04 01 bf 08 03 02 0a 40 04 c0 a8 0a 01 02 01 00 02 01 00 43 01 0e 30 00</p>\n<p>目的MAC：<font color=\"green\">00 23 5a 9e 58 b9</font><br>源MAC：<font color=\"blue\">00 4c 41 49 50 55</font><br>协议类型：<font color=\"red\">08 005</font> ，为IP数据报<br>IP头：<font color=\"gold\">45 00 00 48 00 00 40 00 40 11 a5 4e c0 a8 0a 01 c0 a8 0a 05</font><br>UDP头：<font color=\"purple\">0c 00 00 a2 00 34 ff e0</font><br>其余部分都为SNMP报文，接下来我们对照前面的报文结构体来逐个分析一下。</p>\n<ul>\n<li>30 表示SNMP消息是ASN.1的SEQUENCE类型；</li>\n<li>2a 表示该SNMP报文的总长度是42(0x2a)个字节，该字段所表示的报文长度起始于它后面的第一个字节直到报文结束；</li>\n<li>02 01 00 表示版本号，可见其确实为BER编码方式。02表示该字段是INTEGER类型；01表示该字段占1个字节；00表示版本号，该值为“版本号-1”；</li>\n<li>04 06 70 75 62 6c 69 63 表示团体名，04表示该字段为OCTET STRING类型；06表示该字段占6个字节；70 75 62 6c 69 63 表示团体名的ANSII码的十六进制形式，这里是“public”；</li>\n<li>a4 1d 其中a4中的“4”表示这是一个trap报文，a4又叫报文的标签标记；1d表示后面还有29(0x1d)个字节的数据；</li>\n<li>06 0a 2b 06 01 04 01 bf 08 03 02 0a 企业OID标识。06表示该字段是个对象标识符，OBJECT IDENTIFIER；0a表示该字段占10(0x0a)个字节；关于SNMP的OID的编码方式有些奇特：例如1.3.6.1.2…. 取前两个数字分别记为x和y。编码时40<em>x+y，这里x=1，y=3，因此结果为40</em>1+3=43，即表示十六进制的2b。因此，这里的企业OID编码即为1.3.6.1.4.1.8072.3.2.10；</li>\n<li>40 04 c0 a8 0a 01 同样40表示该字段为OCTET STRING 类型；04表示IP地址占4个字节；IP地址为192.168.10.1；</li>\n<li>02 01 00 其中00表示trap类型为coldStart；</li>\n<li>02 01 00 其中00表示我们指定的trap即specific-trap也为coldStart类型；</li>\n<li>43 01 0e 43表示为TimeTicks类型；01表示该字段占1个字节；0e即十进制的14表示时间标签为0.14秒，这里时间计数器以0.01秒递增；</li>\n<li>30 00 30表示“键-值”值对的编码类型为SEQUENCE；00表示该字段占0个字节，即没有该字段。</li>\n</ul>\n<p>SNMPv2 Trap报文<br>SNMPv2的Trap报文格式如图8所示：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274252oJOX.jpg\" alt=\"SNMPv2的Trap报文格式\"><br>同样的，这里除了trap类型和报文长度是标准网络字节序之外，其余协议字段也均为BER编码方式。可以看到v2版的trap报文正在向统一的报文格式发展，已经非常类似普通的SNMP请求、响应报文了。<br>SNMPv2原始报文内容：<br>00 23 5a 9e 58 b9 00 4c 41 49 50 55 08 00 45 00 00 7b 00 00 40 00 40 11 a5 1b c0 a8 0a 01 c0 a8 0a 05 0c 01 00 a2 00 67 04 bb 30 5d 02 01 01 04 06 70 75 62 6c 69 63 a7 50 02 04 17 73 2c fb 02 01 00 02 01 00 30 42 30 0d 06 08 2b 06 01 02 01 01 03 00 43 01 0e 30 17 06 0a 2b 06 01 06 03 01 01 04 01 00 06 09 2b 06 01 06 03 01 01 05 01 30 18 06 0a 2b 06 01 06 03 01 01 04 03 00 06 0a 2b 06 01 04 01 bf 08 03 02 0a</p>\n<p>目的MAC：00 23 5a 9e 58 b9<br>源MAC：00 4c 41 49 50 55<br>协议类型：08 00，IP报文<br>IP头：45 00 00 7b 00 00 40 00 40 11 a5 1b c0 a8 0a 01 c0 a8 0a 05<br>UDP头：0c 01 00 a2 00 67 04 bb<br>余下部分全为SNMP报文内容，这里我们做一下简单的约定：<br>xx 标注类型；xx 标注长度；xx 标注真正的数据。<br>这样一来上面这串原始数据就好分析多了</p>\n<ul>\n<li>30 5d 整个SNMP报文的编码方式为30，即SEQUENCE类型，报文长度93(0x5d)字节；</li>\n<li>02 01 01 版本号01即v2版本；</li>\n<li>04 06 70 75 62 6c 69 63 团体名70 75 62 6c 69 63  即英文的“public”；</li>\n<li>a7 50 a7表示trap类型为7，即厂商自定义trap；50表示PDU区段占80(0x50)字节；</li>\n<li>02 04 17 73 2c fb 请求ID为17 73 2c fb 十进制的393424123；</li>\n<li>02 01 00 错误状态0；</li>\n<li>02 01 00 错误索引0；</li>\n<li>30 42 “变量名-值”对编码类型30 即SEQUENCE类型；“变量名-值”所占总字节0x42，即66字节；</li>\n<li>30 0d 06 08 2b 06 01 02 01 01 03 00 43 01 0e 第一个“名-值”对区段编码方式30 即SEQUENCE类型；第一个“名-值”对总长度0x0d，13字节；第一个变量名的编码类型0x06，时间标签；第一个变量名占0x08个字节；第一个变量名2b 06 01 02 01 01 03 00，为1.3.6.1.2.1.1.3.0；第一个变量值为0x0e，即14；</li>\n<li>30 17 06 0a 2b 06 01 06 03 01 01 04 01 00 06 09 2b 06 01 06 03 01 01 05 01 第二个“名-值”对；变量名1.3.6.1.6.3.1.1.4.1.0；变量值1.3.6.1.6.3.1.1.5.1；</li>\n<li>30 18 06 0a 2b 06 01 06 03 01 01 04 03 00 06 0a 2b 06 01 04 01 bf 08 03 02 0a 第三个“名-值”对；变量名1.3.6.1.6.3.1.1.4.3.0；变量值1.3.6.1.4.1.8072.3.2.10；</li>\n</ul>\n<h2 id=\"今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。\"><a href=\"#今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。\" class=\"headerlink\" title=\"今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。\"></a>今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。</h2>","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>这篇博客简要介绍了snmp协议的基本概念<br>","more":"</p>\n<h2 id=\"1-SNMP简单概述\"><a href=\"#1-SNMP简单概述\" class=\"headerlink\" title=\"1 SNMP简单概述\"></a>1 SNMP简单概述</h2><h3 id=\"1-1-什么是SNMP\"><a href=\"#1-1-什么是SNMP\" class=\"headerlink\" title=\"1.1 什么是SNMP?\"></a>1.1 什么是SNMP?</h3><p>　　SNMP是英文”Simple Network Management Protocol”的缩写，中文意思是“简单的网络管理协议”。它属于TCP/IP五层协议中的应用层协议，用于网络管理的协议。SNMP主要用于网络设备的管理。由于SNMP协议简单可靠 ，受到了众多厂商的欢迎，成为了目前最为广泛的网管协议。<br>　　SNMP协议主要由两大部分组成：<strong>SNMP管理站</strong>和<strong>SNMP代理</strong>。SNMP管理站是一个中心节点，负责收集维护各个SNMP元素的信息，并对这些信息进行处理，最后反馈给网络管理员；而SNMP代理是运行在各个被管理的网络节点之上，负责统计该节点的各项信息，并且负责与SNMP管理站交互，接收并执行管理站的命令，上传各种本地的网络信息。<br>　　SNMP管理站和SNMP代理之间是松散耦合。他们之间的通信是通过UDP协议完成的。一般情况下，SNMP管理站通过UDP协议向SNMP代理发送各种命令，当SNMP代理收到命令后，返回SNMP管理站需要的参数。但是当SNMP代理检测到网络元素异常的时候，也可以主动向SNMP管理站发送消息，通告当前异常状况。<br>　　SNMP的基本思想：为不同种类的设备、不同厂家生产的设备、不同型号的设备，定义为一个统一的接口和协议，使得管理员可以是使用统一的外观面对这些需要管理的网络设备进行管理。通过网络，管理员可以管理位于不同物理空间的设备，从而大大提高网络管理的效率，简化网络管理员的工作。<br>　　SNMP的工作方式：管理员需要向设备获取数据，所以SNMP提供了【读】操作；管理员需要向设备执行设置操作，所以SNMP提供了【写】操作；设备需要在重要状况改变的时候，向管理员通报事件的发生，所以SNMP提供了【Trap】操作。</p>\n<h3 id=\"1-2-SNMP和UDP\"><a href=\"#1-2-SNMP和UDP\" class=\"headerlink\" title=\"1.2 SNMP和UDP\"></a>1.2 SNMP和UDP</h3><p>SNMP采用UDP协议在管理端和agent之间传输信息。 SNMP采用UDP161端口接收和发送请求，162端口接收trap，执行SNMP的设备缺省都必须采用这些端口。SNMP消息全部通过UDP端口161接收，只有Trap信息采用UDP端口162。</p>\n<h3 id=\"1-3-Snmp版本\"><a href=\"#1-3-Snmp版本\" class=\"headerlink\" title=\"1.3 Snmp版本\"></a>1.3 Snmp版本</h3><p>SNMP目前共有v1，v2，v3这三个版本： </p>\n<ul>\n<li>SNMP v1是SNMP协议的最初版本，不过依然是众多厂家实现SNMP基本方式。 </li>\n<li>SNMP v2通常被指是基于community的SNMP V2。Community实质上就是密码。</li>\n<li>SNMP v3 是最新版本的SNMP。它对网络管理最大的贡献在于其安全性。增加了对认证和密文传输的支持。</li>\n</ul>\n<h2 id=\"2-SNMP工作原理\"><a href=\"#2-SNMP工作原理\" class=\"headerlink\" title=\"2 SNMP工作原理\"></a>2 SNMP工作原理</h2><p>　　在具体的实现上，SNMP为管理员提供了一个网管平台（NMS），又称为管理站，负责网管命令的发出、数据存储及数据分析。被监管的设备上运行一个SNMP代理（Agent），代理实现设备与管理站的SNMP通信。<br>　　<img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274236dktq.jpg\" alt=\"snmp工作原理\"><br>　　管理站和代理端使用MIB进行接口统一，MIB定义了设备中的被管理对象。管理站和代理都实现相应的MIB对象，使得双方可以识别对方的数据，实现通信。管理站向代理请求MIB中定义的数据，代理端识别后，将管理设备提供的相关状态或参数等数据转换成MIB定义的格式，最后将该信息返回给管理站，完成一次管理操作。\n　　</p>\n<h2 id=\"3-SNMP报文\"><a href=\"#3-SNMP报文\" class=\"headerlink\" title=\"3 SNMP报文\"></a>3 SNMP报文</h2><h3 id=\"3-1-报文类型\"><a href=\"#3-1-报文类型\" class=\"headerlink\" title=\"3.1 报文类型\"></a>3.1 报文类型</h3><p>　　SNMP中定义了五种消息类型：Get-Request、Get-Response、Get-Next-Request、Set-Request和Trap。</p>\n<ul>\n<li>Get-Request 、Get-Next-Request与Get-Response<br>SNMP 管理站用Get-Request消息从拥有SNMP代理的网络设备中检索信息，而SNMP代理则用Get-Response消息响应。Get-Next- Request用于和Get-Request组合起来查询特定的表对象中的列元素。</li>\n<li>Set-Request SNMP管理站用Set-Request 可以对网络设备进行远程配置（包括设备名、设备属性、删除设备或使某一个设备属性有效/无效等）。</li>\n<li>Trap SNMP代理使用Trap向SNMP管理站发送非请求消息，一般用于描述某一事件的发生，如接口UP/DOWN，IP地址更改等。</li>\n</ul>\n<p>上面五种消息中Get-Request、Get-Next-Request和Set-Request是由管理站发送到代理侧的161端口的；后面两种Get-Response和Trap 是由代理进程发给管理进程的，其中Trap消息被发送到管理进程的162端口，所有数据都是走UDP封装。SNMP工作流程如图2：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274238733S.jpg\" alt=\"SNMP工作流程\"></p>\n<h3 id=\"3-2-报文格式\"><a href=\"#3-2-报文格式\" class=\"headerlink\" title=\"3.2 报文格式\"></a>3.2 报文格式</h3><p>SNMP代理和管理站通过SNMP协议中的标准消息进行通信，每个消息都是一个单独的数据报。SNMP使用UDP（用户数据报协议）作为第四层协议（传输协议），进行无连接操作。SNMP消息报文包含两个部分：SNMP报头和协议数据单元PDU。<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274240Yo8Q.jpg\" alt=\"SNMP报文格式\"></p>\n<p><strong>以下部分是报文格式的具体分析，有需要可以继续学习。</strong></p>\n<p>　　在实际网络传输环境下，SNMP报文的长度取决于其所采用的编码方式。SNMP统一采用BER(Basic Encoding Rule)的编码规则，同时在正式SNMP规范中使用的是ASN.1语法，Abastract Syntax Notation v1，即抽象语法描述语言。这两个概念在后面实践环节再做进一步介绍，这里只要稍微了解一下即可，不妨碍我们对协议本身的分析。这里我们简单解释一下BER编码规则：<br>　　BER作为ANS.1的基本编码规则，描述具体的ANS.1对象如何编码为比特流在网络上进行传输。BER编码规则由三部分组成：<br>　　<img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_134027424269yP.jpg\" alt=\"BER编码方式\"><br>    SNMP中定义了几种基本的数据类型，其中v1和v2版有些改动，具体参见相应的RFC文档。这里我们只介绍几种最常见的类型：</p>\n<ul>\n<li>INTEGER：一个整数</li>\n<li>OCTER STRING： 0或多个8bit字节，每个字节在0~255之间取值</li>\n<li>DisplayString：0或多个8bit字节，每个字节必须是ASCII码。在MIB-II中，所有该类型变量不能超过255个字符(0个字符可以)</li>\n<li>NULL：代表相关的变量没有值</li>\n<li>IpAddress：4字节长的OCTER STRING，以网络字节序表示IP地址</li>\n<li>PhyAddress：6字节长的OCTER STRING，代表物理地址</li>\n<li>Counter：非负整数，可以从0递增到232-1()。达到最大值后归0</li>\n<li>TimeTicks：时间计数器，以0.01秒为单位递增，不同的变量可以有不同的递增幅度。所以在定义这种类型的变量时需要制定递增幅度</li>\n<li>SEQUENCE：与C语言中的结构体类似</li>\n<li>SEQUENCE OF：一个向量，参见后面ANS.1语法详细介绍章节</li>\n</ul>\n<p>SNMP报文在传输层是封装在UDP报文中的，而UDP又是基于IP网络的，因此，我们可以得到完整的报文描述结构，如下图所示：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274245phSV.jpg\" alt=\"SNMP协议报文格式\"><br>PDU类型其实包含两个字节，第一个字节表示真实的PDU的类型；第二个字节表示后面报文所占的字节总数。针对SNMPv1，这个字段取值如下：<br>| PDU类型  | 名 称   |<br>| :——–: | :—–:  |<br>| 0     | get-request |<br>| 1        |   get-next-request   |<br>| 2        |    get-response    |<br>| 3        |    set-request   |<br>| 4        |    trap   |<br>　　也就是说，trap的类型是4。但是在数据报文中，该字段一般表示为ax，其中x取[0,4]，即a0~a3表示相应的get、set等操作，a4表示trap报文。这里除了类型字段意外，其他字段均采用BER编码方式：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274247srSc.jpg\" alt=\"采用BER编码的字段\"><br>　　<br><strong>实战演练之报文格式分析</strong><br>　　Trap报文格式和上述图5所展示的结构有些差别，这里我们只分析SNMPv1和SNMPv2的Trap报文格式。trap报文前面的部分都一样，区别在PDU协议数据单元部分。</p>\n<p>SNMPv1 Trap报文<br>SNMPv1的Trap报文格式如下所示：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_134027425066MR.jpg\" alt=\"SNMPv1的Trap报文格式\"><br>注意：除了PDU类型和PDU长度字段外，后面的每个字段都是BER编码方式。<br>    trap类型”可以取以下值，其中0~6是已定义的特定trap，7及其以后的类型由供应商自定义。<br>表2 trap类型、名称及描述信息<br>| trap类型        | 名称   |  描述信息  |<br>| :——–:   | :—–:  | :—-:  |<br>| ０     | coldStart |   代理进程对自己初始化     |<br>| １        |   warmStart   |   代理进程对自己重新初始化   |<br>| ２        |   linkDown    |  一个接口已从工作状态变为故障状态(报文中的第一个变量标识此接口)  |<br>| ３     | linkUp |  一个接口已从故障状态变为工作状态(报文中的第一个变量标识此接口)     |<br>| ４        |   authenticationFailure   |   从SNMP管理进程收到无效共同体的报文   |<br>| ５        |    egpNeighborLoss    |  一个EGP邻站已变为故障状态(报文中的第一个变量包含邻站IP地址) |<br>| ６     | enterpriseSpecific |   在这个特定的代码段中查找trap信息     |<br>　　通过wireshark抓包工具，捕获一条如下的SNMP报文，接下来对其进行仔细分析。<br>SNMPv1原始报文内容：</p>\n<p><font color=\"green\">00 23 5a 9e 58 b9</font> <font color=\"blue\">00 4c 41 49 50 55</font> <font color=\"red\">08 005</font> <font color=\"gold\">45 00 00 48 00 00 40 00 40 11 a5 4e c0 a8 0a 01 c0 a8 0a 05</font> <font color=\"purple\">0c 00 00 a2 00 34 ff e0</font> 30 2a 02 01 00 04 06 70 75 62 6c 69 63 a4 1d 06 0a 2b 06 01 04 01 bf 08 03 02 0a 40 04 c0 a8 0a 01 02 01 00 02 01 00 43 01 0e 30 00</p>\n<p>目的MAC：<font color=\"green\">00 23 5a 9e 58 b9</font><br>源MAC：<font color=\"blue\">00 4c 41 49 50 55</font><br>协议类型：<font color=\"red\">08 005</font> ，为IP数据报<br>IP头：<font color=\"gold\">45 00 00 48 00 00 40 00 40 11 a5 4e c0 a8 0a 01 c0 a8 0a 05</font><br>UDP头：<font color=\"purple\">0c 00 00 a2 00 34 ff e0</font><br>其余部分都为SNMP报文，接下来我们对照前面的报文结构体来逐个分析一下。</p>\n<ul>\n<li>30 表示SNMP消息是ASN.1的SEQUENCE类型；</li>\n<li>2a 表示该SNMP报文的总长度是42(0x2a)个字节，该字段所表示的报文长度起始于它后面的第一个字节直到报文结束；</li>\n<li>02 01 00 表示版本号，可见其确实为BER编码方式。02表示该字段是INTEGER类型；01表示该字段占1个字节；00表示版本号，该值为“版本号-1”；</li>\n<li>04 06 70 75 62 6c 69 63 表示团体名，04表示该字段为OCTET STRING类型；06表示该字段占6个字节；70 75 62 6c 69 63 表示团体名的ANSII码的十六进制形式，这里是“public”；</li>\n<li>a4 1d 其中a4中的“4”表示这是一个trap报文，a4又叫报文的标签标记；1d表示后面还有29(0x1d)个字节的数据；</li>\n<li>06 0a 2b 06 01 04 01 bf 08 03 02 0a 企业OID标识。06表示该字段是个对象标识符，OBJECT IDENTIFIER；0a表示该字段占10(0x0a)个字节；关于SNMP的OID的编码方式有些奇特：例如1.3.6.1.2…. 取前两个数字分别记为x和y。编码时40<em>x+y，这里x=1，y=3，因此结果为40</em>1+3=43，即表示十六进制的2b。因此，这里的企业OID编码即为1.3.6.1.4.1.8072.3.2.10；</li>\n<li>40 04 c0 a8 0a 01 同样40表示该字段为OCTET STRING 类型；04表示IP地址占4个字节；IP地址为192.168.10.1；</li>\n<li>02 01 00 其中00表示trap类型为coldStart；</li>\n<li>02 01 00 其中00表示我们指定的trap即specific-trap也为coldStart类型；</li>\n<li>43 01 0e 43表示为TimeTicks类型；01表示该字段占1个字节；0e即十进制的14表示时间标签为0.14秒，这里时间计数器以0.01秒递增；</li>\n<li>30 00 30表示“键-值”值对的编码类型为SEQUENCE；00表示该字段占0个字节，即没有该字段。</li>\n</ul>\n<p>SNMPv2 Trap报文<br>SNMPv2的Trap报文格式如图8所示：<br><img src=\"http://blog.chinaunix.net/attachment/201206/21/23069658_1340274252oJOX.jpg\" alt=\"SNMPv2的Trap报文格式\"><br>同样的，这里除了trap类型和报文长度是标准网络字节序之外，其余协议字段也均为BER编码方式。可以看到v2版的trap报文正在向统一的报文格式发展，已经非常类似普通的SNMP请求、响应报文了。<br>SNMPv2原始报文内容：<br>00 23 5a 9e 58 b9 00 4c 41 49 50 55 08 00 45 00 00 7b 00 00 40 00 40 11 a5 1b c0 a8 0a 01 c0 a8 0a 05 0c 01 00 a2 00 67 04 bb 30 5d 02 01 01 04 06 70 75 62 6c 69 63 a7 50 02 04 17 73 2c fb 02 01 00 02 01 00 30 42 30 0d 06 08 2b 06 01 02 01 01 03 00 43 01 0e 30 17 06 0a 2b 06 01 06 03 01 01 04 01 00 06 09 2b 06 01 06 03 01 01 05 01 30 18 06 0a 2b 06 01 06 03 01 01 04 03 00 06 0a 2b 06 01 04 01 bf 08 03 02 0a</p>\n<p>目的MAC：00 23 5a 9e 58 b9<br>源MAC：00 4c 41 49 50 55<br>协议类型：08 00，IP报文<br>IP头：45 00 00 7b 00 00 40 00 40 11 a5 1b c0 a8 0a 01 c0 a8 0a 05<br>UDP头：0c 01 00 a2 00 67 04 bb<br>余下部分全为SNMP报文内容，这里我们做一下简单的约定：<br>xx 标注类型；xx 标注长度；xx 标注真正的数据。<br>这样一来上面这串原始数据就好分析多了</p>\n<ul>\n<li>30 5d 整个SNMP报文的编码方式为30，即SEQUENCE类型，报文长度93(0x5d)字节；</li>\n<li>02 01 01 版本号01即v2版本；</li>\n<li>04 06 70 75 62 6c 69 63 团体名70 75 62 6c 69 63  即英文的“public”；</li>\n<li>a7 50 a7表示trap类型为7，即厂商自定义trap；50表示PDU区段占80(0x50)字节；</li>\n<li>02 04 17 73 2c fb 请求ID为17 73 2c fb 十进制的393424123；</li>\n<li>02 01 00 错误状态0；</li>\n<li>02 01 00 错误索引0；</li>\n<li>30 42 “变量名-值”对编码类型30 即SEQUENCE类型；“变量名-值”所占总字节0x42，即66字节；</li>\n<li>30 0d 06 08 2b 06 01 02 01 01 03 00 43 01 0e 第一个“名-值”对区段编码方式30 即SEQUENCE类型；第一个“名-值”对总长度0x0d，13字节；第一个变量名的编码类型0x06，时间标签；第一个变量名占0x08个字节；第一个变量名2b 06 01 02 01 01 03 00，为1.3.6.1.2.1.1.3.0；第一个变量值为0x0e，即14；</li>\n<li>30 17 06 0a 2b 06 01 06 03 01 01 04 01 00 06 09 2b 06 01 06 03 01 01 05 01 第二个“名-值”对；变量名1.3.6.1.6.3.1.1.4.1.0；变量值1.3.6.1.6.3.1.1.5.1；</li>\n<li>30 18 06 0a 2b 06 01 06 03 01 01 04 03 00 06 0a 2b 06 01 04 01 bf 08 03 02 0a 第三个“名-值”对；变量名1.3.6.1.6.3.1.1.4.3.0；变量值1.3.6.1.4.1.8072.3.2.10；</li>\n</ul>\n<h2 id=\"今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。\"><a href=\"#今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。\" class=\"headerlink\" title=\"今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。\"></a>今天我们简单对SNMP协议做个入门普及，包括它的原理，应用场景报文格式等。下面的章节，我们将以开源net-snmp为例来向大家阐述多种代理开发流程和原理，以及要注意的问题，其中每种扩展mib的方式都对应不同的开发需求。</h2>"},{"title":"NexT主题深度优化","date":"2018-03-30T10:29:19.000Z","keyword":["next","优化","主题","next主题"],"_content":"\n本文主要对next主题导入后的基本及深度优化行为做了记录。其中基本配置直接贴出了配置文件，里面写上了中文注释。深度优化方面，既有总结，也有大量的链接推荐。\n\n<!-- more -->\n\n\n## 1.开始搭建博客\n\n## 2.优化：基本功能配置\n\n接下来是配置和增强功能，如阅读统计、评论、插件之类的，这些基本配置建议在写文章之前配置好。\n\n基本功能配置大部分是修改两个文件，都叫_config.yml。一个是站点的，一个是主题的。\n\n与其将各个功能分散开来讲，不如直接贴出配置文件，打上注释，从头到尾看一遍就知道如何配置了。\n\n### 2.1 选择主题\n\n我选择的是[NexT][1],是在Github上[被Star最多][2]【2018.3.30】的一个Hexo主题。从V6.0.0开始next主仓库已从 [iissnan][3] 名下 迁移至 [theme-next ][4]。组织\n\n想要什么样的主题，去[Hexo Themes][5]上慢慢找。\n\n至于更换主题，很简单，用NexT主题举个例子。\n\n 1. 首先，去主题所在仓库拷贝仓库地址，如下图：\n    \n    ![拷贝仓库地址][6]    \n\n 2. 然后，到博客站点根目录下,打开 **git bash**\n\n    ```\n    // next是自定义的主题名字，可以随意更改\n    git clone https://github.com/theme-next/hexo-theme-next.git themes/next\n    ```\n\n 3. 最后，修改站点配置文件_config.yml\n \n    ```\n    ## Themes: https://hexo.io/themes/\n    theme: next\n    ```\n    \n### 2.2 站点配置文件\n\n请先查看 [Hexo官方文档][7] ，再查看下面我贴出的，如果这样后你还是对有些地方比较懵，可以自行 Google。\n\n**注意：文件中所有的 : 都是英文字符，且后面都有一个空格。**\n\n【2018.3.30更新】文件位置： ~/blog/_config.yml\n\n```\n# Hexo Configuration\n## Docs: https://hexo.io/docs/configuration.html\n## Source: https://github.com/hexojs/hexo/\n\n# Site\ntitle: 温故而知新\nsubtitle: \ndescription: 天下事有难易乎？<br/>为之，则难者亦易矣；<br/>不为，则易者亦难矣。\nauthor: 肖悦\nlanguage: zh-CN\ntimezone: \n\n# URL\n## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'\nurl: http://kevinXiao2016.github.io\nroot: /\n# 博客文章的 URL 结构，请务必写文章之前就想好！\n# 详细参数请查看：https://hexo.io/docs/permalinks.html\npermalink: :year/:month/:day/:title/\npermalink_defaults:\n\n# Directory\nsource_dir: source\npublic_dir: public\ntag_dir: tags\narchive_dir: archives\ncategory_dir: categories\ncode_dir: downloads/code\ni18n_dir: :lang\nskip_render:\n\n# Writing\nnew_post_name: :title.md # File name of new posts\ndefault_layout: post\ntitlecase: false # Transform title into titlecase\nexternal_link: true # Open external links in new tab\nfilename_case: 0\nrender_drafts: false\npost_asset_folder: false\nrelative_link: false\nfuture: true\n# 代码高亮设置\nhighlight:\n  enable: true\n  line_number: true\n  auto_detect: false\n  tab_replace:\n\n# Category & Tag\ndefault_category: uncategorized\ncategory_map:\ntag_map:\n\n# Date / Time format\n## Hexo uses Moment.js to parse and display date\n## You can customize the date format as defined in\n## http://momentjs.com/docs/#/displaying/format/\ndate_format: YYYY-MM-DD\ntime_format: HH:mm:ss\n\n\n# ---------------------------------------------------------------\n# 扩展设置\n# ---------------------------------------------------------------\n# 集成Local Search 支持站内搜索\nsearch:\n  path: search.xml\n  field: post\n  format: html\n  limit: 10000\n# Pagination\n## Set per_page to 0 to disable pagination\nper_page: 10\npagination_dir: page\n\nindex_generator:\n  per_page: 10 ##首页默认10篇文章标题 如果值为0不分页\n## 修改归档页面、某一分类页面、某一标签页面的显示篇数\n## 参考：http://theme-next.iissnan.com/faqs.html#setting-page-size\narchive_generator:\n\tper_page: 10 ##归档页面默认10篇文章标题\n\tyearly: true  ##生成年视图\n\tmonthly: true ##生成月视图\ntag_generator:\n\tper_page: 10 ##标签分类页面默认10篇文章\ncategory_generator: \n\tper_page: 10 ###分类页面默认10篇文章\n\n# Extensions\n## Plugins: https://hexo.io/plugins/\n## Themes: https://hexo.io/themes/\ntheme: next\n\n# Deployment\n## Docs: https://hexo.io/docs/deployment.html\ndeploy:\n  type: git\n  # 没有做cdn映射前，请使用下面注释掉的配置\n  repo: \n        github: git@github.com:kevinXiao2016/kevinXiao2016.github.io.git,master\n        coding: git@git.coding.net:kevinXiao2016/kevinXiao2016.git,master\n\n  #repository: https://github.com/kevinXiao2016/kevinXiao2016.github.io.git\n  #branch: master\n```\n\n### 2.3 主题配置文件\n\n如果使用的主题不是Next，那么请另 Google。建议先查看 [NexT 官方文档][8]。\n\n【2018.3.30更新】文件位置： ~/blog/themes/next/_config.yml\n\n```\n# ---------------------------------------------------------------\n# Theme Core Configuration Settings\n# ---------------------------------------------------------------\n\n# 更新相关，参考：https://github.com/iissnan/hexo-theme-next/issues/328\n# 简单说：从V6.0.0开始支持以下功能，不更改主题设置，在站点中设置主题\n# 1.在~/blog/source 目录下新建source目录，在里面新建 next.yml文件\n# 2.将主题配置文件全部拷贝过去\n# 3.设置此处override为true,表明此文件配置可被next.yml中的配置覆盖\noverride: true\n\n# Allow to cache content generation. Introduced in NexT v6.0.0.\ncache:\n  enable: true\n  \n```\n\n【2018.3.30更新】文件位置： ~/blog/source/_data/next.yml\n```\n# ---------------------------------------------------------------\n# Site Information Settings\n# ---------------------------------------------------------------\n\n# 站点图标啦，直接去 https://realfavicongenerator.net\n# 选项弄好后，下载压缩包，解压复制粘贴\n# 建议放在 hexo-site/source/images/ 里（没有自己建）\n# 这样可以避免更新 NexT 主题的时候遇到麻烦\n# 最后记得要稍微改下文件名，与下面的保持一致\nfavicon:\n  small: /images/favicon-16x16\n  medium: /images/favicon-32x32\n  #apple_touch_icon: /images/apple-touch-icon-next.png\n  #safari_pinned_tab: /images/logo.svg\n  #android_manifest: /images/manifest.json\n  #ms_browserconfig: /images/browserconfig.xml\n\n# Set rss to false to disable feed link.\n# Leave rss as empty to use site's feed link.\n# Set rss to specific value if you have burned your feed already.\nrss:\n\n# 页脚配置\nfooter:\n  # Specify the date when the site was setup.\n  # If not defined, current year will be used.\n  # 建站年份\n  since: 2017\n\n  # Icon between year and copyright info.\n  # 年份后面的图标，为 Font Awesome 图标\n  icon: \n    # Icon name in fontawesome, see: https://fontawesome.com/v4.7.0/icons\n    # `heart` is recommended with animation in red (#ff0000).\n    name: heart\n    # If you want to animate the icon, set it to true.\n    # 设置true时开启动画效果\n    animated: true\n    # Change the color of icon, using Hex Code.\n    color: \"#ff0000\"\n\n  # If not defined, will be used `author` from Hexo main config.\n  # 如果不定义，默认用站点配置文件的 author 名\n  copyright:\n  # -------------------------------------------------------------\n  # Hexo link (Powered by Hexo).\n  # Hexo 的链接\n  powered: true\n\n  theme:\n    # Theme & scheme info link (Theme - NexT.scheme).\n    # 是否支持主题\n    enable: true\n    # Version info of NexT after scheme info (vX.X.X).\n    # 是否显示next的版本\n    version: true\n  # -------------------------------------------------------------\n  # Any custom text can be defined here.\n  # 自定义内容\n  #custom_text: Hosted by <a target=\"_blank\" rel=\"external nofollow\" href=\"https://pages.coding.me\"><b>Coding Pages</b></a>\n\n# ---------------------------------------------------------------\n# SEO Settings\n# ---------------------------------------------------------------\n\n# Canonical, set a canonical link tag in your hexo, you could use it for your SEO of blog.\n# See: https://support.google.com/webmasters/answer/139066\n# Tips: Before you open this tag, remember set up your URL in hexo _config.yml ( ex. url: http://yourdomain.com )\ncanonical: true\n\n# Change headers hierarchy on site-subtitle (will be main site description) and on all post/pages titles for better SEO-optimization.\nseo: false\n\n# If true, will add site-subtitle to index page, added in main hexo config.\n# subtitle: Subtitle\nindex_with_subtitle: false\n\n\n# ---------------------------------------------------------------\n# Menu Settings\n# ---------------------------------------------------------------\n\n# When running the site in a subdirectory (e.g. domain.tld/blog), remove the leading slash from link value (/archives -> archives).\n# Usage: `Key: /link/ || icon`\n# Key is the name of menu item. If translate for this menu will find in languages - this translate will be loaded; if not - Key name will be used. Key is case-senstive.\n# Value before `||` delimeter is the target link.\n# Value after `||` delimeter is the name of FontAwesome icon. If icon (with or without delimeter) is not specified, question icon will be loaded.\n# 菜单设置 || 菜单图标设置\n# 编辑 ~/blog/themes/next/languages 下的相应文件\n# 比如添加一个“留言”菜单，站点配置文件的 language 是 zh-Hans\n# 则编辑 zh-Hans.yml，在 menu: 项内添加一行 留言: 留言\n# 注意空格，且符号 : 为英文字符！\nmenu:\n  home: / || home\n  about: /about/ || user\n  tags: /tags/ || tags\n  categories: /categories/ || th\n  archives: /archives/ || archive\n  #schedule: /schedule/ || calendar\n  #sitemap: /sitemap.xml || sitemap\n  #commonweal: /404/ || heartbeat\n\n# Enable/Disable menu icons / item badges.\n# 是否开启菜单图标\nmenu_settings:\n  icons: true\n  badges: false\n\n# ---------------------------------------------------------------\n# Scheme Settings\n# ---------------------------------------------------------------\n\n# Schemes\n# 设计板式，都长啥样，去 README 里面的链接里看看\n#scheme: Muse\nscheme: Mist\n#scheme: Pisces\n#scheme: Gemini\n\n\n# ---------------------------------------------------------------\n# Sidebar Settings\n# ---------------------------------------------------------------\n\n# Posts / Categories / Tags in sidebar.\nsite_state: true\n\n# 侧栏社交链接设置，与上面菜单差不多，要生效记得把前面的 # 去掉\n# Social Links.\n# Usage: `Key: permalink || icon`\n# Key is the link label showing to end users.\n# Value before `||` delimeter is the target permalink.\n# Value after `||` delimeter is the name of FontAwesome icon. If icon (with or without delimeter) is not specified, globe icon will be loaded.\nsocial:\n  #GitHub: https://github.com/kevinXiao2016 || github\n  #E-Mail: mailto:yourname@gmail.com || envelope\n  #Google: https://plus.google.com/yourname || google\n  #Twitter: https://twitter.com/yourname || twitter\n  #FB Page: https://www.facebook.com/yourname || facebook\n  #VK Group: https://vk.com/yourname || vk\n  #StackOverflow: https://stackoverflow.com/yourname || stack-overflow\n  #YouTube: https://youtube.com/yourname || youtube\n  #Instagram: https://instagram.com/yourname || instagram\n  #Skype: skype:yourname?call|chat || skype\n\n# 侧栏社交链接图标设置\nsocial_icons:\n  enable: true\n  icons_only: false\n  transition: false\n  # Dependencies: exturl: true in Tags Settings section below.\n  # To encrypt links above use https://www.base64encode.org\n  # Example encoded link: `GitHub: aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQ= || github`\n  exturl: false\n\n# Follow me on GitHub banner in right-top corner.\n# Usage: `permalink || title`\n# Value before `||` delimeter is the target permalink.\n# Value after `||` delimeter is the title and aria-label name.\ngithub_banner: https://github.com/kevinXiao2016 || Follow me on GitHub\n\n# Blog rolls\n# 侧栏友链设置\nlinks_icon: globe\nlinks_title: 神奇的链接\nlinks_layout: block\n#links_layout: inline\nlinks:\n  EMS规范: http://ems.top-vision.cn:8110/dm/dm.html\n  #网易云音乐 : https://music.163.com/#/user/home?id=86590096\n  #Coldplay Official Website: http://coldplay.com/\n  #获取 Elon Musk 的新闻: https://elonmusknews.org/\n  #尼古拉·特斯拉：发明了现代世界的人: http://www.bilibili.com/video/av6211226/\n  #关于此博客: https://reuixiy.github.io/about/\n\n# Sidebar Avatar\n# in theme directory(source/images): /images/avatar.gif\n# in site  directory(source/uploads): /uploads/avatar.gif\n# 侧栏头像设置\n# 建议放在 hexo-site/source/uploads/ 里（没有自己建）\n# 这样可以避免更新 NexT 主题的时候遇到麻烦\navatar: /images/avatar.png\n\n# Table Of Contents in the Sidebar\n# 侧栏文章目录设置（前提是 Markdown 书写正确）\ntoc:\n  enable: true\n\n  # Automatically add list number to toc.\n  # 自动加数字序号\n  number: false\n\n  # If true, all words will placed on next lines if header width longer then sidebar width.\n  # 如果标题太长，则放到下一行继续显示\n  wrap: false\n\n# Creative Commons 4.0 International License.\n# http://creativecommons.org/\n# Available: by | by-nc | by-nc-nd | by-nc-sa | by-nd | by-sa | zero\n#creative_commons: by-nc-sa\n#creative_commons:\n\nsidebar:\n  # Sidebar Position, available value: left | right (only for Pisces | Gemini).\n  # 侧栏位置设置，可用值：左 | 右（只对 Pisces 和 Gemini 设计版式有效！）\n  position: left\n  #position: right\n  \n  # 侧栏显示方式\n  # Sidebar Display, available value (only for Muse | Mist):\n  #  - post    expand on posts automatically. Default.\n  #  - always  expand for all pages automatically\n  #  - hide    expand only when click on the sidebar toggle icon.\n  #  - remove  Totally remove sidebar including sidebar toggle.\n  display: post\n  #display: always\n  #display: hide\n  #display: remove\n\n  # Sidebar offset from top menubar in pixels (only for Pisces | Gemini).\n  # 只对 Pisces 和 Gemini 设计版式有效！\n  offset: 12\n\n  # Back to top in sidebar (only for Pisces | Gemini).\n  # 只对 Pisces 和 Gemini 设计版式有效！\n  b2t: false\n\n  # Scroll percent label in b2t button.\n  scrollpercent: true\n\n  # Enable sidebar on narrow view (only for Muse | Mist).\n  # 移动端显示侧栏，只对 Muse 和 Mist 设计版式有效！\n  onmobile: true\n\n\n# ---------------------------------------------------------------\n# Post Settings\n# ---------------------------------------------------------------\n\n# Automatically scroll page to section which is under <!-- more --> mark.\n# 点击 [Read More]，页面自动滚动到 <!-- more --> 标记处\nscroll_to_more: false\n\n# Automatically saving scroll position on each post/page in cookies.\n# 用 cookies 保存浏览的位置信息，意味着重新打开这个页面后\n# 页面就会自动滚动到上次的位置，除非读者清理浏览器 cookies\nsave_scroll: false\n\n# Automatically excerpt description in homepage as preamble text.\n# 将每篇文章 Front-matter 里 description 的文字作为页面显示的文章摘要\nexcerpt_description: true\n\n# Automatically Excerpt. Not recommend.\n# Please use <!-- more --> in the post to control excerpt accurately.\n# 按字数自动加入 [Read More]，不建议！\n# 建议在文章中加入 <!-- more -->\n# 自定义 [Read More] 按钮之前要显示的内容！\nauto_excerpt:\n  enable: false\n  length: 150\n\n# Post meta display settings\n# 文章顶部显示的文章元数据设置\npost_meta:\n  item_text: true\n  created_at: true\n  updated_at: false\n  # Only show 'updated' if different from 'created'.\n  updated_diff: false\n  categories: true\n\n# Post wordcount display settings\n# Dependencies: https://github.com/theme-next/hexo-symbols-count-time\n# 显示统计字数和估计阅读时长\n# 注意：这个要安装插件，先进入站点文件夹根目录\n# 然后：npm install hexo-symbols-count-time --save\nsymbols_count_time:\n  separated_meta: true\n  item_text_post: true\n  item_text_total: false\n  awl: 5\n  wpm: 200\n\n# Manual define the border radius in codeblock\n# Leave it empty for the default 1\ncodeblock:\n  border_radius: \n\n# Wechat Subscriber\n#wechat_subscriber:\n  #enabled: true\n  #qcode: /path/to/your/wechatqcode ex. /uploads/wechat-qcode.jpg\n  #description: ex. subscribe to my blog by scanning my public wechat account\n\n# Reward\nreward_comment: 坚持原创技术分享，您的支持将鼓励我继续创作！\nwechatpay: /images/wechat-reward-image.jpg\nalipay: /images/alipay-reward-image.jpg\n#bitcoin: /images/bitcoin.png\n\n# Related popular posts\n# Dependencies: https://github.com/tea3/hexo-related-popular-posts\nrelated_posts:\n  enable: false\n  title: # custom header, leave empty to use the default one\n  display_in_home: false\n  params:\n    maxCount: 5\n    #PPMixingRate: 0.0\n    #isDate: false\n    #isImage: false\n    #isExcerpt: false\n\n# Declare license on posts\npost_copyright:\n  enable: false\n  license: <a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>\n\n\n# ---------------------------------------------------------------\n# Misc Theme Settings\n# ---------------------------------------------------------------\n\n# Reduce padding / margin indents on devices with narrow width.\n# 移动端把页面两边留白去除，个人不建议\nmobile_layout_economy: false\n\n# Android Chrome header panel color ($brand-bg / $headband-bg => $black-deep).\n# Android 上 Chrome 浏览器顶部颜色设置\nandroid_chrome_color: \"#222\"\n\n# Custom Logo.\n# !!Only available for Default Scheme currently.\n# Options:\n#   enabled: [true/false] - Replace with specific image\n#   image: url-of-image   - Images's url\ncustom_logo:\n  enabled: false\n  image:\n\n# Code Highlight theme\n# Available values: normal | night | night eighties | night blue | night bright\n# https://github.com/chriskempson/tomorrow-theme\n# 代码高亮主题设置\n# 都长啥样自己点开上面的链接查看\nhighlight_theme: normal\n\n# Enable \"cheers\" for archive page.\ncheers_enabled: true\n\n# Manual define the max content width\n# !!Only available for Gemini Scheme currently\n# Leave it empty for the default 75% (suggest not less than 1000px)\n#max_content_width: 1000px\n\n# Manual define the sidebar width\n# !!Only available for Gemini Scheme currently\n# Leave it empty for the default 240\nsidebar_width:\n\n# ---------------------------------------------------------------\n# Font Settings\n# - Find fonts on Google Fonts (https://www.google.com/fonts)\n# - All fonts set here will have the following styles:\n#     light, light italic, normal, normal italic, bold, bold italic\n# - Be aware that setting too much fonts will cause site running slowly\n# - Introduce in 5.0.1\n# ---------------------------------------------------------------\n# CAUTION! Safari Version 10.1.2 bug: https://github.com/iissnan/hexo-theme-next/issues/1844\n# To avoid space between header and sidebar in Pisces / Gemini themes recommended to use Web Safe fonts for `global` (and `logo`):\n# Arial | Tahoma | Helvetica | Times New Roman | Courier New | Verdana | Georgia | Palatino | Garamond | Comic Sans MS | Trebuchet MS\n# ---------------------------------------------------------------\n# 字体设置\nfont:\n  enable: false\n\n  # Uri of fonts host. E.g. //fonts.googleapis.com (Default).\n  host:\n\n  # Font options:\n  # `external: true` will load this font family from `host` above.\n  # `family: Times New Roman`. Without any quotes.\n  # `size: xx`. Use `px` as unit.\n\n  # Global font settings used for all elements in <body>.\n  global:\n    external: true\n    family: Lato\n    size:\n\n  # Font settings for Headlines (H1, H2, H3, H4, H5, H6).\n  # Fallback to `global` font settings.\n  headings:\n    external: true\n    family:\n    size:\n\n  # Font settings for posts.\n  # Fallback to `global` font settings.\n  posts:\n    external: true\n    family:\n\n  # Font settings for Logo.\n  # Fallback to `global` font settings.\n  logo:\n    external: true\n    family:\n    size:\n\n  # Font settings for <code> and code blocks.\n  codes:\n    external: true\n    family:\n    size:\n\n\n# ---------------------------------------------------------------\n# Third Party Services Settings\n# ---------------------------------------------------------------\n\n# Math Equations Render Support\nmath:\n  enable: false\n\n  # Default(true) will load mathjax/katex script on demand\n  # That is it only render those page who has 'mathjax: true' in Front Matter.\n  # If you set it to false, it will load mathjax/katex srcipt EVERY PAGE.\n  per_page: true\n\n  engine: mathjax\n  #engine: katex\n\n  # hexo-rendering-pandoc (or hexo-renderer-kramed) needed to full MathJax support.\n  mathjax:\n    # Use 2.7.1 as default, jsdelivr as default CDN, works everywhere even in China\n    cdn: //cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML\n    # For newMathJax CDN (cdnjs.cloudflare.com) with fallback to oldMathJax (cdn.mathjax.org).\n    #cdn: //cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML\n    # For direct link to MathJax.js with CloudFlare CDN (cdnjs.cloudflare.com).\n    #cdn: //cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML\n    # For automatic detect latest version link to MathJax.js and get from Bootcss.\n    #cdn: //cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML\n\n  # hexo-renderer-markdown-it-plus (or hexo-renderer-markdown-it with markdown-it-katex plugin)\n  # needed to full Katex support.\n  katex:\n    # Use 0.7.1 as default, jsdelivr as default CDN, works everywhere even in China\n    cdn: //cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css\n    # CDNJS, provided by cloudflare, maybe the best CDN, but not works in China\n    #cdn: //cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css\n    # Bootcss, works great in China, but not so well in other region\n    #cdn: //cdn.bootcss.com/KaTeX/0.7.1/katex.min.css\n\n# Han Support\n# Dependencies: https://github.com/theme-next/theme-next-han\n# 汉字标准格式，没用过暂时不了解\nhan: false\n\n# Pangu Support\n# Dependencies: https://github.com/theme-next/theme-next-pangu\n# For more information: https://github.com/vinta/pangu.js\npangu: false\n\n# Swiftype Search API Key\n#swiftype_key:\n\n# Baidu Analytics ID\n#baidu_analytics:\n\n# Disqus\ndisqus:\n  enable: false\n  shortname:\n  count: true\n  lazyload: false\n\n# Hypercomments\n#hypercomments_id:\n\n# changyan\nchangyan:\n  enable: false\n  appid:\n  appkey:\n\n# leanCloud支持的评论插件\n# Valine. \n# You can get your appid and appkey from https://leancloud.cn\n# more info please open https://valine.js.org\nvaline:\n  enable: false\n  appid:  P08Jh3wwb2zPhfm9puCevcUa-*******\n  appkey:  CnhNSWBKT3kwj52v********\n  notify: false # mail notifier , https://github.com/xCss/Valine/wiki\n  verify: false # Verification code\n  placeholder: Just go go # comment box placeholder\n  avatar: mm # gravatar style\n  guest_info: nick,mail,link # custom comment header\n  pageSize: 10 # pagination size\n\n\n# Support for youyan comments system.\n# You can get your uid from http://www.uyan.cc\n#youyan_uid: your uid\n\n# Support for LiveRe comments system.\n# You can get your uid from https://livere.com/insight/myCode (General web site)\nlivere_uid: MTAyMC8yODQwNi******\n\n# Gitment\n# Introduction: https://imsun.net/posts/gitment-introduction/\ngitment:\n  enable: false\n  mint: true # RECOMMEND, A mint on Gitment, to support count, language and proxy_gateway\n  count: true # Show comments count in post meta area\n  lazy: false # Comments lazy loading with a button\n  cleanly: false # Hide 'Powered by ...' on footer, and more\n  language: # Force language, or auto switch by theme\n  github_user: # MUST HAVE, Your Github Username\n  github_repo: # MUST HAVE, The name of the repo you use to store Gitment comments\n  client_id: # MUST HAVE, Github client id for the Gitment\n  client_secret: # EITHER this or proxy_gateway, Github access secret token for the Gitment\n  proxy_gateway: # Address of api proxy, See: https://github.com/aimingoo/intersect\n  redirect_protocol: # Protocol of redirect_uri with force_redirect_protocol when mint enabled\n\n# Baidu Share\n# Available value:\n#    button | slide\n# Warning: Baidu Share does not support https.\n#baidushare:\n##  type: button\n\n# Share\n# This plugin is more useful in China, make sure you known how to use it.\n# And you can find the use guide at official webiste: http://www.jiathis.com/.\n# Warning: JiaThis does not support https.\n#jiathis:\n  ##uid: Get this uid from http://www.jiathis.com/\n\n#add_this_id:\n\n# NeedMoreShare2\n# Dependencies: https://github.com/theme-next/theme-next-needmoreshare2\n# See: https://github.com/revir/need-more-share2\n# Also see: https://github.com/DzmVasileusky/needShareButton\n# iconStyle: default | box\n# boxForm: horizontal | vertical\n# position: top / middle / bottom + Left / Center / Right\n# networks: Weibo,Wechat,Douban,QQZone,Twitter,Linkedin,Mailto,Reddit,\n#           Delicious,StumbleUpon,Pinterest,Facebook,GooglePlus,Slashdot,\n#           Technorati,Posterous,Tumblr,GoogleBookmarks,Newsvine,\n#           Evernote,Friendfeed,Vkontakte,Odnoklassniki,Mailru\nneedmoreshare2:\n  enable: false\n  postbottom:\n    enable: false\n    options:\n      iconStyle: box\n      boxForm: horizontal\n      position: bottomCenter\n      networks: Weibo,Wechat,Douban,QQZone,Twitter,Facebook\n  float:\n    enable: false\n    options:\n      iconStyle: box\n      boxForm: horizontal\n      position: middleRight\n      networks: Weibo,Wechat,Douban,QQZone,Twitter,Facebook\n\n# Google Webmaster tools verification setting\n# See: https://www.google.com/webmasters/\n#google_site_verification:\n\n# Google Analytics\n#google_analytics:\n\n# Bing Webmaster tools verification setting\n# See: https://www.bing.com/webmaster/\n#bing_site_verification:\n\n# Yandex Webmaster tools verification setting\n# See: https://webmaster.yandex.ru/\n#yandex_site_verification:\n\n# CNZZ count\n#cnzz_siteid:\n\n# Application Insights\n# See https://azure.microsoft.com/en-us/services/application-insights/\n# application_insights:\n\n# Post widgets & FB/VK comments settings.\n# ---------------------------------------------------------------\n# Facebook SDK Support.\n# https://github.com/iissnan/hexo-theme-next/pull/410\nfacebook_sdk:\n  enable:       false\n  app_id:       #<app_id>\n  fb_admin:     #<user_id>\n  like_button:  #true\n  webmaster:    #true\n\n# Facebook comments plugin\n# This plugin depends on Facebook SDK.\n# If facebook_sdk.enable is false, Facebook comments plugin is unavailable.\nfacebook_comments_plugin:\n  enable:       false\n  num_of_posts: 10    # min posts num is 1\n  width:        100%  # default width is 550px\n  scheme:       light # default scheme is light (light or dark)\n\n# VKontakte API Support.\n# To get your AppID visit https://vk.com/editapp?act=create\nvkontakte_api:\n  enable:       false\n  app_id:       #<app_id>\n  like:         true\n  comments:     true\n  num_of_posts: 10\n\n# Star rating support to each article.\n# To get your ID visit https://widgetpack.com\nrating:\n  enable: false\n  id:     #<app_id>\n  color:  fc6423\n# ---------------------------------------------------------------\n\n# Show number of visitors to each article.\n# You can visit https://leancloud.cn get AppID and AppKey.\nleancloud_visitors:\n  enable: false\n  app_id: P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz\n  app_key: CnhNSWBKT3kwj52vyJ36armb\n  # Dependencies: https://github.com/theme-next/hexo-leancloud-counter-security\n  # If you don't care about security in lc counter and just want to use it directly\n  # (without hexo-leancloud-counter-security plugin), set the `security` to `false`.\n  security: true\n  betterPerformance: false\n\n# Another tool to show number of visitors to each article.\n# visit https://console.firebase.google.com/u/0/ to get apiKey and projectId\n# visit https://firebase.google.com/docs/firestore/ to get more information about firestore\nfirestore:\n  enable: false\n  collection: articles #required, a string collection name to access firestore database\n  apiKey: #required\n  projectId: #required\n  bluebird: false #enable this if you want to include bluebird 3.5.1(core version) Promise polyfill\n\n# Show Views/Visitors of the website/page with busuanzi.\n# Get more information on http://ibruce.info/2015/04/04/busuanzi/\nbusuanzi_count:\n  enable: true\n  total_visitors: true\n  total_visitors_icon: user\n  total_views: true\n  total_views_icon: eye\n  post_views: true\n  post_views_icon: eye\n\n\n# Tencent analytics ID\n# tencent_analytics:\n\n# Tencent MTA ID\n# tencent_mta:\n\n\n# Enable baidu push so that the blog will push the url to baidu automatically which is very helpful for SEO\nbaidu_push: false\n\n# Google Calendar\n# Share your recent schedule to others via calendar page\n#\n# API Documentation:\n# https://developers.google.com/google-apps/calendar/v3/reference/events/list\ncalendar:\n  enable: false\n  calendar_id: <required>\n  api_key: <required>\n  orderBy: startTime\n  offsetMax: 24\n  offsetMin: 4\n  timeZone:\n  showDeleted: false\n  singleEvents: true\n  maxResults: 250\n\n# Algolia Search\n# See: https://github.com/theme-next/hexo-theme-next/blob/master/docs/ALGOLIA-SEARCH.md\n# Dependencies: https://github.com/theme-next/theme-next-algolia-instant-search\nalgolia_search:\n  enable: false\n  hits:\n    per_page: 10\n  labels:\n    input_placeholder: Search for Posts\n    hits_empty: \"We didn't find any results for the search: ${query}\"\n    hits_stats: \"${hits} results found in ${time} ms\"\n\n# Local search\n# Dependencies: https://github.com/theme-next/hexo-generator-searchdb\n# 要安装插件才能使用，先进入站点文件夹根目录\n#  然后：npm install hexo-generator-searchdb --save\nlocal_search:\n  enable: true\n  # if auto, trigger search by changing input\n  # if manual, trigger search by pressing enter key or search button\n  trigger: auto\n  # show top n results per article, show all results by setting to -1\n  top_n_per_article: 1\n  # unescape html strings to the readable one\n  unescape: false\n\n# Bookmark Support\n# Dependencies: https://github.com/theme-next/theme-next-bookmark\nbookmark:\n  enable: false\n  # if auto\n  #   - save the reading position when closing the page\n  #   - or clicking the bookmark-icon\n  # if manual, only save it by clicking the bookmark-icon\n  save: auto\n\n\n# ---------------------------------------------------------------\n# Tags Settings\n# ---------------------------------------------------------------\n\n# External URL with BASE64 encrypt & decrypt.\n# Usage: {% exturl text url \"title\" %}\n# Alias: {% extlink text url \"title\" %}\n# 用法见：\n# https://github.com/iissnan/hexo-theme-next/pull/1438\nexturl: false\n\n# 主题的标签样式，有 note、label、tabs 三种\n# Note tag (bs-callout).\nnote:\n  # Note tag style values:\n  #  - simple    bs-callout old alert style. Default.\n  #  - modern    bs-callout new (v2-v3) alert style.\n  #  - flat      flat callout style with background, like on Mozilla or StackOverflow.\n  #  - disabled  disable all CSS styles import of note tag.\n  style: simple\n  icons: false\n  border_radius: 3\n  # Offset lighter of background in % for modern and flat styles (modern: -12 | 12; flat: -18 | 6).\n  # Offset also applied to label tag variables. This option can work with disabled note tag.\n  light_bg_offset: 0\n\n# Label tag.\nlabel: true\n\n# Tabs tag.\ntabs:\n  enable: true\n  transition:\n    tabs: false\n    labels: true\n  border_radius: 0\n\n# Reading progress bar\n# Dependencies: https://github.com/theme-next/theme-next-reading-progress\nreading_progress:\n  enable: false\n  color: \"#37c6c0\"\n  height: 2px\n\n\n#! ---------------------------------------------------------------\n#! DO NOT EDIT THE FOLLOWING SETTINGS\n#! UNLESS YOU KNOW WHAT YOU ARE DOING\n#! ---------------------------------------------------------------\n\n# 动画\n# Use velocity to animate everything.\nmotion:\n  enable: true\n  async: false\n  transition:\n    # Transition variants:\n    # fadeIn | fadeOut | flipXIn | flipXOut | flipYIn | flipYOut | flipBounceXIn | flipBounceXOut | flipBounceYIn | flipBounceYOut\n    # swoopIn | swoopOut | whirlIn | whirlOut | shrinkIn | shrinkOut | expandIn | expandOut\n    # bounceIn | bounceOut | bounceUpIn | bounceUpOut | bounceDownIn | bounceDownOut | bounceLeftIn | bounceLeftOut | bounceRightIn | bounceRightOut\n    # slideUpIn | slideUpOut | slideDownIn | slideDownOut | slideLeftIn | slideLeftOut | slideRightIn | slideRightOut\n    # slideUpBigIn | slideUpBigOut | slideDownBigIn | slideDownBigOut | slideLeftBigIn | slideLeftBigOut | slideRightBigIn | slideRightBigOut\n    # perspectiveUpIn | perspectiveUpOut | perspectiveDownIn | perspectiveDownOut | perspectiveLeftIn | perspectiveLeftOut | perspectiveRightIn | perspectiveRightOut\n    post_block: fadeIn\n    post_header: slideDownIn\n    post_body: slideDownIn\n    coll_header: slideLeftIn\n    # Only for Pisces | Gemini.\n    sidebar: slideUpIn\n\n# Fancybox. There is support for old version 2 and new version 3.\n# Please, choose only any one variant, do not need to install both.\n# For install 2.x: https://github.com/theme-next/theme-next-fancybox\n# For install 3.x: https://github.com/theme-next/theme-next-fancybox3\n# 查看图片的\nfancybox: false\n\n# Added switch option for separated repo in 6.0.0.\n# Dependencies: https://github.com/theme-next/theme-next-fastclick\nfastclick: false\n\n# Added switch option for separated repo in 6.0.0.\n# Dependencies: https://github.com/theme-next/theme-next-jquery-lazyload\nlazyload: false\n\n# Progress bar in the top during page loading.\n# Dependencies: https://github.com/theme-next/theme-next-pace\npace: false\n# Themes list:\n#pace-theme-big-counter\n#pace-theme-bounce\n#pace-theme-barber-shop\n#pace-theme-center-atom\n#pace-theme-center-circle\n#pace-theme-center-radar\n#pace-theme-center-simple\n#pace-theme-corner-indicator\n#pace-theme-fill-left\n#pace-theme-flash\n#pace-theme-loading-bar\n#pace-theme-mac-osx\n#pace-theme-minimal\n# For example\n# pace_theme: pace-theme-center-simple\npace_theme: pace-theme-minimal\n\n# Canvas-nest\n# Dependencies: https://github.com/theme-next/theme-next-canvas-nest\ncanvas_nest: true\n\n# JavaScript 3D library.\n# Dependencies: https://github.com/theme-next/theme-next-three\n# three_waves\nthree_waves: false\n# canvas_lines\ncanvas_lines: false\n# canvas_sphere\ncanvas_sphere: false\n\n# Only fit scheme Pisces\n# Dependencies: https://github.com/theme-next/theme-next-canvas-ribbon\n# Canvas-ribbon\n# size: The width of the ribbon.\n# alpha: The transparency of the ribbon.\n# zIndex: The display level of the ribbon.\ncanvas_ribbon:\n  enable: false\n  size: 300\n  alpha: 0.6\n  zIndex: -1\n\n# Script Vendors.\n# Set a CDN address for the vendor you want to customize.\n# For example\n#    jquery: https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js\n# Be aware that you should use the same version as internal ones to avoid potential problems.\n# Please use the https protocol of CDN files when you enable https on your site.\n# 相关内容用 CDN 地址取代，加速网站访问，注意版本尽可能要一致\nvendors:\n  # Internal path prefix. Please do not edit it.\n  _internal: lib\n\n  # Internal version: 2.1.3\n  jquery:\n\n  # Internal version: 2.1.5\n  # See: http://fancyapps.com/fancybox/\n  fancybox:\n  fancybox_css:\n\n  # Internal version: 1.0.6\n  # See: https://github.com/ftlabs/fastclick\n  fastclick:\n\n  # Internal version: 1.9.7\n  # See: https://github.com/tuupola/jquery_lazyload\n  lazyload:\n\n  # Internal version: 1.2.1\n  # See: http://VelocityJS.org\n  velocity:\n\n  # Internal version: 1.2.1\n  # See: http://VelocityJS.org\n  velocity_ui:\n\n  # Internal version: 0.7.9\n  # See: https://faisalman.github.io/ua-parser-js/\n  ua_parser:\n\n  # Internal version: 4.6.2\n  # See: http://fontawesome.io/\n  fontawesome:\n\n  # Internal version: 1\n  # https://www.algolia.com\n  algolia_instant_js:\n  algolia_instant_css:\n\n  # Internal version: 1.0.2\n  # See: https://github.com/HubSpot/pace\n  # Or use direct links below:\n  # pace: //cdn.bootcss.com/pace/1.0.2/pace.min.js\n  # pace_css: //cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-flash.min.css\n  pace:\n  pace_css:\n\n  # Internal version: 1.0.0\n  # https://github.com/hustcc/canvas-nest.js\n  canvas_nest: \n\n  # three\n  three:\n\n  # three_waves\n  # https://github.com/jjandxa/three_waves\n  three_waves:\n\n  # three_waves\n  # https://github.com/jjandxa/canvas_lines\n  canvas_lines:\n\n  # three_waves\n  # https://github.com/jjandxa/canvas_sphere\n  canvas_sphere:\n\n  # Internal version: 1.0.0\n  # https://github.com/zproo/canvas-ribbon\n  canvas_ribbon:\n\n  # Internal version: 3.3.0\n  # https://github.com/ethantw/Han\n  han:\n\n  # Internal version: 3.3.0\n  # https://github.com/vinta/pangu.js\n  pangu:\n\n  # needMoreShare2\n  # https://github.com/revir/need-more-share2\n  needmoreshare2_js:\n  needmoreshare2_css:\n\n  # bookmark\n  # Internal version: 1.0.0\n  # https://github.com/theme-next/theme-next-bookmark\n  bookmark:\n\n  # reading_progress\n  # Internal version: 1.0\n  # https://github.com/theme-next/theme-next-reading-progress\n  # Example: https://cdn.jsdelivr.net/gh/theme-next/theme-next-reading-progress@1.1/reading_progress.min.js\n  reading_progress:\n\n  # valine comment\n  # Example: https://cdn.jsdelivr.net/npm/valine@1.1.8/dist/Valine.min.js\n  valine:\n\n\n# Assets\ncss: css\njs: js\nimages: images\n\n# Theme version\nversion: 6.0.6\n```\n\n### 2.4 动态背景\n\n在主题配置文件中，靠后面，改canvas_nest: true，想要更改颜色和数量？修改文件：\n\n文件位置：~/blog/themes/next/source/lib/canvas-nest/canvas-nest.min.js\n\n怎么修改？参考[canvas-nest.js][9]。\n\n### 2.5 注脚\n\n参考[hexo-footnotes][10]。\n\n## 3.优化:高级功能配置\n\n### 3.1 大佬们的文章\n\n更多如外挂一样的功能配置，就直接贴大佬的文章了，哪些功能自己喜欢，按照大佬的教程来配置就行。不过也有坑，比如有些功能（超链接样式、侧栏头像圆形并旋转）可以直接通过在custom.styl添加 CSS 代码实现，无需更改其它文件！\n\n 1. [打造个性超赞博客Hexo+NexT+GithubPages的超深度优化][11]\n 2. [hexo高阶教程next主题优化][12]\n 3. [hexo的next主题个性化教程:打造炫酷网站][13]\n 4. [Hexo搭建博客的个性化设置][14]\n\n### 3.2 鼠标点击效果\n\n 1. 新建mouse.js，复制[love][15]或者[富强民主...][16]中的内容到js文件中。\n 2. 将mouse.js放到**/themes/next/source/js/src**路径下\n 3. 打开/themes/next/layout/layout.swig文件，添加如下代码：\n    \n    ```js\n    <script type=\"text/javascript\" src=\"/js/src/mouse.js\"></script>\n    ```\n\n \n### 3.3 文章加密\n        \n参考：[hexo-blog-encrypt][17]\n\n 1. 在博客根目录下的package.json文件中添加一行代码\n\n    ```json\n    \"hexo-blog-encrypt\": \"2.0.*\"\n    ```\n\n 2. 在博客根目录下：  **npm install**\n 3. 在站点配置文件中配置文章加密\n\n    ```json\n    # Security\n    encrypt:\n        enable: true\n    ```\n\n 4. 然后在你的文章的头部添加上对应的字段，如 password, abstract, message\n\n    ```md\n    title: hello world\n    date: 2016-03-30 21:18:02\n    tags:\n        - fdsafsdaf\n    password: Mike\n    abstract: 没点开文章前显示的类容，类似于<!--more-->之前写的描述.\n    message: 点开文章后，提示输入密码的信息.\n    ```\n \n\n    \n\n### 3.4 博客推广及SEO优化\n\n\n建站完成后百度和Google是没有收录我们的网站的，想要搜索到我们的博客非常困难。因此优化搜索非常有必要。\n\n**博客推广**\n\n博客推广第一步，手动推广。\n\n你可以多浏览别人的博客并留下你的爪印（博客地址），比如 评论 本文；你可以去 [README.md][18]中提到的 [这个issue][19] 留下你的爪印；你可以去 [Issues页面][20] 试着回答下大家的问题并留下你的爪印。\n\n博客推广第二步，[SEO][21]（Search Engine Optimization）。\n\n**搜索引擎**\n\n直接推荐大佬文章：[【搜索优化】Hexo-next百度和谷歌搜索优化][22]\n\n### 3.5 随机生成背景图\n\n在主题下的/source/css/_custom/custom.style文件中，添加如下代码：\n\n```css\nbody{   \n\tbackground:url(https://source.unsplash.com/random/1920x1080);\n\tbackground-size:cover;\n\tbackground-repeat:no-repeat;\n\tbackground-attachment:fixed;\n\tbackground-position:50% 50%;\n}\n\n.main-inner { \n    margin-top: 60px;\n    padding: 60px 60px 60px 60px;\n    background: #fff;\n    opacity: 0.8;\n    min-height: 500px;\n}\n```\n\n### 3.6 背景动画\n\n依赖于[theme-next-canvas-nest][23],或者[3D library][24]。\n\n 1. 进入到主题目录，如：cd themes/next\n 2. 下载插件\n\n    ```\n    git clone https://github.com/theme-next/theme-next-canvas-nest source/lib/canvas-nest\n    git clone https://github.com/theme-next/theme-next-three source/lib/three\n    ```\n 3. 在主题配置文件中开启，一次只开启一个\n\n    ```\n    canvas_nest: false\n    \n    three_waves: false\n    canvas_lines: true\n    canvas_sphere: false\n    ```\n    \n 4. 插件更新\n\n    ```\n    $ cd themes/next/source/lib/canvas-nest\n    $ git pull\n    ```\n \n \n\n \n\n\n  [1]: https://github.com/iissnan/hexo-theme-next\n  [2]: https://github.com/search?o=desc&q=topic:hexo-theme&s=stars&type=Repositories\n  [3]: https://github.com/iissnan/hexo-theme-next\n  [4]: https://github.com/theme-next\n  [5]: https://hexo.io/themes/\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/blog/copyLink.png\n  [7]: https://hexo.io/zh-cn/docs/configuration.html\n  [8]: http://theme-next.iissnan.com/getting-started.html\n  [9]: https://github.com/hustcc/canvas-nest.js/blob/master/README-zh.md\n  [10]: https://github.com/LouisBarranqueiro/hexo-footnotes\n  [11]: https://reuixiy.github.io/technology/computer/computer-aided-art/2017/06/09/hexo-next-optimization.html\n  [12]: http://cherryblog.site/Hexo-high-level-tutorialcloudmusic,bg-customthemes-statistical.html\n  [13]: http://shenzekun.cn/hexo%E7%9A%84next%E4%B8%BB%E9%A2%98%E4%B8%AA%E6%80%A7%E5%8C%96%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B.html\n  [14]: http://www.dingxuewen.com/categories/Site/\n  [15]: https://github.com/kevinXiao2016/kevinXiao2016.github.io/blob/hexo/source/love.js\n  [16]: https://github.com/kevinXiao2016/kevinXiao2016.github.io/blob/hexo/source/mouse.js\n  [17]: https://github.com/MikeCoder/hexo-blog-encrypt/blob/master/ReadMe.zh.md\n  [18]: https://github.com/iissnan/hexo-theme-next#live-preview\n  [19]: https://github.com/iissnan/hexo-theme-next/issues/119\n  [20]: https://github.com/iissnan/hexo-theme-next/issuess://github.com/iissnan/hexo-theme-next/issues/119\n  [21]: https://baike.baidu.com/item/SEO\n  [22]: http://www.ehcoo.com/seo.html\n  [23]: https://github.com/theme-next/theme-next-canvas-nest\n  [24]: https://github.com/theme-next/theme-next-three","source":"_posts/NexT主题深度优化.md","raw":"---\ntitle: NexT主题深度优化\ncategories:\n  - Blog\ntags:\n  - Blog\ndate: 2018-03-30 18:29:19\nkeyword:\n  - next\n  - 优化\n  - 主题\n  - next主题\n---\n\n本文主要对next主题导入后的基本及深度优化行为做了记录。其中基本配置直接贴出了配置文件，里面写上了中文注释。深度优化方面，既有总结，也有大量的链接推荐。\n\n<!-- more -->\n\n\n## 1.开始搭建博客\n\n## 2.优化：基本功能配置\n\n接下来是配置和增强功能，如阅读统计、评论、插件之类的，这些基本配置建议在写文章之前配置好。\n\n基本功能配置大部分是修改两个文件，都叫_config.yml。一个是站点的，一个是主题的。\n\n与其将各个功能分散开来讲，不如直接贴出配置文件，打上注释，从头到尾看一遍就知道如何配置了。\n\n### 2.1 选择主题\n\n我选择的是[NexT][1],是在Github上[被Star最多][2]【2018.3.30】的一个Hexo主题。从V6.0.0开始next主仓库已从 [iissnan][3] 名下 迁移至 [theme-next ][4]。组织\n\n想要什么样的主题，去[Hexo Themes][5]上慢慢找。\n\n至于更换主题，很简单，用NexT主题举个例子。\n\n 1. 首先，去主题所在仓库拷贝仓库地址，如下图：\n    \n    ![拷贝仓库地址][6]    \n\n 2. 然后，到博客站点根目录下,打开 **git bash**\n\n    ```\n    // next是自定义的主题名字，可以随意更改\n    git clone https://github.com/theme-next/hexo-theme-next.git themes/next\n    ```\n\n 3. 最后，修改站点配置文件_config.yml\n \n    ```\n    ## Themes: https://hexo.io/themes/\n    theme: next\n    ```\n    \n### 2.2 站点配置文件\n\n请先查看 [Hexo官方文档][7] ，再查看下面我贴出的，如果这样后你还是对有些地方比较懵，可以自行 Google。\n\n**注意：文件中所有的 : 都是英文字符，且后面都有一个空格。**\n\n【2018.3.30更新】文件位置： ~/blog/_config.yml\n\n```\n# Hexo Configuration\n## Docs: https://hexo.io/docs/configuration.html\n## Source: https://github.com/hexojs/hexo/\n\n# Site\ntitle: 温故而知新\nsubtitle: \ndescription: 天下事有难易乎？<br/>为之，则难者亦易矣；<br/>不为，则易者亦难矣。\nauthor: 肖悦\nlanguage: zh-CN\ntimezone: \n\n# URL\n## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'\nurl: http://kevinXiao2016.github.io\nroot: /\n# 博客文章的 URL 结构，请务必写文章之前就想好！\n# 详细参数请查看：https://hexo.io/docs/permalinks.html\npermalink: :year/:month/:day/:title/\npermalink_defaults:\n\n# Directory\nsource_dir: source\npublic_dir: public\ntag_dir: tags\narchive_dir: archives\ncategory_dir: categories\ncode_dir: downloads/code\ni18n_dir: :lang\nskip_render:\n\n# Writing\nnew_post_name: :title.md # File name of new posts\ndefault_layout: post\ntitlecase: false # Transform title into titlecase\nexternal_link: true # Open external links in new tab\nfilename_case: 0\nrender_drafts: false\npost_asset_folder: false\nrelative_link: false\nfuture: true\n# 代码高亮设置\nhighlight:\n  enable: true\n  line_number: true\n  auto_detect: false\n  tab_replace:\n\n# Category & Tag\ndefault_category: uncategorized\ncategory_map:\ntag_map:\n\n# Date / Time format\n## Hexo uses Moment.js to parse and display date\n## You can customize the date format as defined in\n## http://momentjs.com/docs/#/displaying/format/\ndate_format: YYYY-MM-DD\ntime_format: HH:mm:ss\n\n\n# ---------------------------------------------------------------\n# 扩展设置\n# ---------------------------------------------------------------\n# 集成Local Search 支持站内搜索\nsearch:\n  path: search.xml\n  field: post\n  format: html\n  limit: 10000\n# Pagination\n## Set per_page to 0 to disable pagination\nper_page: 10\npagination_dir: page\n\nindex_generator:\n  per_page: 10 ##首页默认10篇文章标题 如果值为0不分页\n## 修改归档页面、某一分类页面、某一标签页面的显示篇数\n## 参考：http://theme-next.iissnan.com/faqs.html#setting-page-size\narchive_generator:\n\tper_page: 10 ##归档页面默认10篇文章标题\n\tyearly: true  ##生成年视图\n\tmonthly: true ##生成月视图\ntag_generator:\n\tper_page: 10 ##标签分类页面默认10篇文章\ncategory_generator: \n\tper_page: 10 ###分类页面默认10篇文章\n\n# Extensions\n## Plugins: https://hexo.io/plugins/\n## Themes: https://hexo.io/themes/\ntheme: next\n\n# Deployment\n## Docs: https://hexo.io/docs/deployment.html\ndeploy:\n  type: git\n  # 没有做cdn映射前，请使用下面注释掉的配置\n  repo: \n        github: git@github.com:kevinXiao2016/kevinXiao2016.github.io.git,master\n        coding: git@git.coding.net:kevinXiao2016/kevinXiao2016.git,master\n\n  #repository: https://github.com/kevinXiao2016/kevinXiao2016.github.io.git\n  #branch: master\n```\n\n### 2.3 主题配置文件\n\n如果使用的主题不是Next，那么请另 Google。建议先查看 [NexT 官方文档][8]。\n\n【2018.3.30更新】文件位置： ~/blog/themes/next/_config.yml\n\n```\n# ---------------------------------------------------------------\n# Theme Core Configuration Settings\n# ---------------------------------------------------------------\n\n# 更新相关，参考：https://github.com/iissnan/hexo-theme-next/issues/328\n# 简单说：从V6.0.0开始支持以下功能，不更改主题设置，在站点中设置主题\n# 1.在~/blog/source 目录下新建source目录，在里面新建 next.yml文件\n# 2.将主题配置文件全部拷贝过去\n# 3.设置此处override为true,表明此文件配置可被next.yml中的配置覆盖\noverride: true\n\n# Allow to cache content generation. Introduced in NexT v6.0.0.\ncache:\n  enable: true\n  \n```\n\n【2018.3.30更新】文件位置： ~/blog/source/_data/next.yml\n```\n# ---------------------------------------------------------------\n# Site Information Settings\n# ---------------------------------------------------------------\n\n# 站点图标啦，直接去 https://realfavicongenerator.net\n# 选项弄好后，下载压缩包，解压复制粘贴\n# 建议放在 hexo-site/source/images/ 里（没有自己建）\n# 这样可以避免更新 NexT 主题的时候遇到麻烦\n# 最后记得要稍微改下文件名，与下面的保持一致\nfavicon:\n  small: /images/favicon-16x16\n  medium: /images/favicon-32x32\n  #apple_touch_icon: /images/apple-touch-icon-next.png\n  #safari_pinned_tab: /images/logo.svg\n  #android_manifest: /images/manifest.json\n  #ms_browserconfig: /images/browserconfig.xml\n\n# Set rss to false to disable feed link.\n# Leave rss as empty to use site's feed link.\n# Set rss to specific value if you have burned your feed already.\nrss:\n\n# 页脚配置\nfooter:\n  # Specify the date when the site was setup.\n  # If not defined, current year will be used.\n  # 建站年份\n  since: 2017\n\n  # Icon between year and copyright info.\n  # 年份后面的图标，为 Font Awesome 图标\n  icon: \n    # Icon name in fontawesome, see: https://fontawesome.com/v4.7.0/icons\n    # `heart` is recommended with animation in red (#ff0000).\n    name: heart\n    # If you want to animate the icon, set it to true.\n    # 设置true时开启动画效果\n    animated: true\n    # Change the color of icon, using Hex Code.\n    color: \"#ff0000\"\n\n  # If not defined, will be used `author` from Hexo main config.\n  # 如果不定义，默认用站点配置文件的 author 名\n  copyright:\n  # -------------------------------------------------------------\n  # Hexo link (Powered by Hexo).\n  # Hexo 的链接\n  powered: true\n\n  theme:\n    # Theme & scheme info link (Theme - NexT.scheme).\n    # 是否支持主题\n    enable: true\n    # Version info of NexT after scheme info (vX.X.X).\n    # 是否显示next的版本\n    version: true\n  # -------------------------------------------------------------\n  # Any custom text can be defined here.\n  # 自定义内容\n  #custom_text: Hosted by <a target=\"_blank\" rel=\"external nofollow\" href=\"https://pages.coding.me\"><b>Coding Pages</b></a>\n\n# ---------------------------------------------------------------\n# SEO Settings\n# ---------------------------------------------------------------\n\n# Canonical, set a canonical link tag in your hexo, you could use it for your SEO of blog.\n# See: https://support.google.com/webmasters/answer/139066\n# Tips: Before you open this tag, remember set up your URL in hexo _config.yml ( ex. url: http://yourdomain.com )\ncanonical: true\n\n# Change headers hierarchy on site-subtitle (will be main site description) and on all post/pages titles for better SEO-optimization.\nseo: false\n\n# If true, will add site-subtitle to index page, added in main hexo config.\n# subtitle: Subtitle\nindex_with_subtitle: false\n\n\n# ---------------------------------------------------------------\n# Menu Settings\n# ---------------------------------------------------------------\n\n# When running the site in a subdirectory (e.g. domain.tld/blog), remove the leading slash from link value (/archives -> archives).\n# Usage: `Key: /link/ || icon`\n# Key is the name of menu item. If translate for this menu will find in languages - this translate will be loaded; if not - Key name will be used. Key is case-senstive.\n# Value before `||` delimeter is the target link.\n# Value after `||` delimeter is the name of FontAwesome icon. If icon (with or without delimeter) is not specified, question icon will be loaded.\n# 菜单设置 || 菜单图标设置\n# 编辑 ~/blog/themes/next/languages 下的相应文件\n# 比如添加一个“留言”菜单，站点配置文件的 language 是 zh-Hans\n# 则编辑 zh-Hans.yml，在 menu: 项内添加一行 留言: 留言\n# 注意空格，且符号 : 为英文字符！\nmenu:\n  home: / || home\n  about: /about/ || user\n  tags: /tags/ || tags\n  categories: /categories/ || th\n  archives: /archives/ || archive\n  #schedule: /schedule/ || calendar\n  #sitemap: /sitemap.xml || sitemap\n  #commonweal: /404/ || heartbeat\n\n# Enable/Disable menu icons / item badges.\n# 是否开启菜单图标\nmenu_settings:\n  icons: true\n  badges: false\n\n# ---------------------------------------------------------------\n# Scheme Settings\n# ---------------------------------------------------------------\n\n# Schemes\n# 设计板式，都长啥样，去 README 里面的链接里看看\n#scheme: Muse\nscheme: Mist\n#scheme: Pisces\n#scheme: Gemini\n\n\n# ---------------------------------------------------------------\n# Sidebar Settings\n# ---------------------------------------------------------------\n\n# Posts / Categories / Tags in sidebar.\nsite_state: true\n\n# 侧栏社交链接设置，与上面菜单差不多，要生效记得把前面的 # 去掉\n# Social Links.\n# Usage: `Key: permalink || icon`\n# Key is the link label showing to end users.\n# Value before `||` delimeter is the target permalink.\n# Value after `||` delimeter is the name of FontAwesome icon. If icon (with or without delimeter) is not specified, globe icon will be loaded.\nsocial:\n  #GitHub: https://github.com/kevinXiao2016 || github\n  #E-Mail: mailto:yourname@gmail.com || envelope\n  #Google: https://plus.google.com/yourname || google\n  #Twitter: https://twitter.com/yourname || twitter\n  #FB Page: https://www.facebook.com/yourname || facebook\n  #VK Group: https://vk.com/yourname || vk\n  #StackOverflow: https://stackoverflow.com/yourname || stack-overflow\n  #YouTube: https://youtube.com/yourname || youtube\n  #Instagram: https://instagram.com/yourname || instagram\n  #Skype: skype:yourname?call|chat || skype\n\n# 侧栏社交链接图标设置\nsocial_icons:\n  enable: true\n  icons_only: false\n  transition: false\n  # Dependencies: exturl: true in Tags Settings section below.\n  # To encrypt links above use https://www.base64encode.org\n  # Example encoded link: `GitHub: aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQ= || github`\n  exturl: false\n\n# Follow me on GitHub banner in right-top corner.\n# Usage: `permalink || title`\n# Value before `||` delimeter is the target permalink.\n# Value after `||` delimeter is the title and aria-label name.\ngithub_banner: https://github.com/kevinXiao2016 || Follow me on GitHub\n\n# Blog rolls\n# 侧栏友链设置\nlinks_icon: globe\nlinks_title: 神奇的链接\nlinks_layout: block\n#links_layout: inline\nlinks:\n  EMS规范: http://ems.top-vision.cn:8110/dm/dm.html\n  #网易云音乐 : https://music.163.com/#/user/home?id=86590096\n  #Coldplay Official Website: http://coldplay.com/\n  #获取 Elon Musk 的新闻: https://elonmusknews.org/\n  #尼古拉·特斯拉：发明了现代世界的人: http://www.bilibili.com/video/av6211226/\n  #关于此博客: https://reuixiy.github.io/about/\n\n# Sidebar Avatar\n# in theme directory(source/images): /images/avatar.gif\n# in site  directory(source/uploads): /uploads/avatar.gif\n# 侧栏头像设置\n# 建议放在 hexo-site/source/uploads/ 里（没有自己建）\n# 这样可以避免更新 NexT 主题的时候遇到麻烦\navatar: /images/avatar.png\n\n# Table Of Contents in the Sidebar\n# 侧栏文章目录设置（前提是 Markdown 书写正确）\ntoc:\n  enable: true\n\n  # Automatically add list number to toc.\n  # 自动加数字序号\n  number: false\n\n  # If true, all words will placed on next lines if header width longer then sidebar width.\n  # 如果标题太长，则放到下一行继续显示\n  wrap: false\n\n# Creative Commons 4.0 International License.\n# http://creativecommons.org/\n# Available: by | by-nc | by-nc-nd | by-nc-sa | by-nd | by-sa | zero\n#creative_commons: by-nc-sa\n#creative_commons:\n\nsidebar:\n  # Sidebar Position, available value: left | right (only for Pisces | Gemini).\n  # 侧栏位置设置，可用值：左 | 右（只对 Pisces 和 Gemini 设计版式有效！）\n  position: left\n  #position: right\n  \n  # 侧栏显示方式\n  # Sidebar Display, available value (only for Muse | Mist):\n  #  - post    expand on posts automatically. Default.\n  #  - always  expand for all pages automatically\n  #  - hide    expand only when click on the sidebar toggle icon.\n  #  - remove  Totally remove sidebar including sidebar toggle.\n  display: post\n  #display: always\n  #display: hide\n  #display: remove\n\n  # Sidebar offset from top menubar in pixels (only for Pisces | Gemini).\n  # 只对 Pisces 和 Gemini 设计版式有效！\n  offset: 12\n\n  # Back to top in sidebar (only for Pisces | Gemini).\n  # 只对 Pisces 和 Gemini 设计版式有效！\n  b2t: false\n\n  # Scroll percent label in b2t button.\n  scrollpercent: true\n\n  # Enable sidebar on narrow view (only for Muse | Mist).\n  # 移动端显示侧栏，只对 Muse 和 Mist 设计版式有效！\n  onmobile: true\n\n\n# ---------------------------------------------------------------\n# Post Settings\n# ---------------------------------------------------------------\n\n# Automatically scroll page to section which is under <!-- more --> mark.\n# 点击 [Read More]，页面自动滚动到 <!-- more --> 标记处\nscroll_to_more: false\n\n# Automatically saving scroll position on each post/page in cookies.\n# 用 cookies 保存浏览的位置信息，意味着重新打开这个页面后\n# 页面就会自动滚动到上次的位置，除非读者清理浏览器 cookies\nsave_scroll: false\n\n# Automatically excerpt description in homepage as preamble text.\n# 将每篇文章 Front-matter 里 description 的文字作为页面显示的文章摘要\nexcerpt_description: true\n\n# Automatically Excerpt. Not recommend.\n# Please use <!-- more --> in the post to control excerpt accurately.\n# 按字数自动加入 [Read More]，不建议！\n# 建议在文章中加入 <!-- more -->\n# 自定义 [Read More] 按钮之前要显示的内容！\nauto_excerpt:\n  enable: false\n  length: 150\n\n# Post meta display settings\n# 文章顶部显示的文章元数据设置\npost_meta:\n  item_text: true\n  created_at: true\n  updated_at: false\n  # Only show 'updated' if different from 'created'.\n  updated_diff: false\n  categories: true\n\n# Post wordcount display settings\n# Dependencies: https://github.com/theme-next/hexo-symbols-count-time\n# 显示统计字数和估计阅读时长\n# 注意：这个要安装插件，先进入站点文件夹根目录\n# 然后：npm install hexo-symbols-count-time --save\nsymbols_count_time:\n  separated_meta: true\n  item_text_post: true\n  item_text_total: false\n  awl: 5\n  wpm: 200\n\n# Manual define the border radius in codeblock\n# Leave it empty for the default 1\ncodeblock:\n  border_radius: \n\n# Wechat Subscriber\n#wechat_subscriber:\n  #enabled: true\n  #qcode: /path/to/your/wechatqcode ex. /uploads/wechat-qcode.jpg\n  #description: ex. subscribe to my blog by scanning my public wechat account\n\n# Reward\nreward_comment: 坚持原创技术分享，您的支持将鼓励我继续创作！\nwechatpay: /images/wechat-reward-image.jpg\nalipay: /images/alipay-reward-image.jpg\n#bitcoin: /images/bitcoin.png\n\n# Related popular posts\n# Dependencies: https://github.com/tea3/hexo-related-popular-posts\nrelated_posts:\n  enable: false\n  title: # custom header, leave empty to use the default one\n  display_in_home: false\n  params:\n    maxCount: 5\n    #PPMixingRate: 0.0\n    #isDate: false\n    #isImage: false\n    #isExcerpt: false\n\n# Declare license on posts\npost_copyright:\n  enable: false\n  license: <a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>\n\n\n# ---------------------------------------------------------------\n# Misc Theme Settings\n# ---------------------------------------------------------------\n\n# Reduce padding / margin indents on devices with narrow width.\n# 移动端把页面两边留白去除，个人不建议\nmobile_layout_economy: false\n\n# Android Chrome header panel color ($brand-bg / $headband-bg => $black-deep).\n# Android 上 Chrome 浏览器顶部颜色设置\nandroid_chrome_color: \"#222\"\n\n# Custom Logo.\n# !!Only available for Default Scheme currently.\n# Options:\n#   enabled: [true/false] - Replace with specific image\n#   image: url-of-image   - Images's url\ncustom_logo:\n  enabled: false\n  image:\n\n# Code Highlight theme\n# Available values: normal | night | night eighties | night blue | night bright\n# https://github.com/chriskempson/tomorrow-theme\n# 代码高亮主题设置\n# 都长啥样自己点开上面的链接查看\nhighlight_theme: normal\n\n# Enable \"cheers\" for archive page.\ncheers_enabled: true\n\n# Manual define the max content width\n# !!Only available for Gemini Scheme currently\n# Leave it empty for the default 75% (suggest not less than 1000px)\n#max_content_width: 1000px\n\n# Manual define the sidebar width\n# !!Only available for Gemini Scheme currently\n# Leave it empty for the default 240\nsidebar_width:\n\n# ---------------------------------------------------------------\n# Font Settings\n# - Find fonts on Google Fonts (https://www.google.com/fonts)\n# - All fonts set here will have the following styles:\n#     light, light italic, normal, normal italic, bold, bold italic\n# - Be aware that setting too much fonts will cause site running slowly\n# - Introduce in 5.0.1\n# ---------------------------------------------------------------\n# CAUTION! Safari Version 10.1.2 bug: https://github.com/iissnan/hexo-theme-next/issues/1844\n# To avoid space between header and sidebar in Pisces / Gemini themes recommended to use Web Safe fonts for `global` (and `logo`):\n# Arial | Tahoma | Helvetica | Times New Roman | Courier New | Verdana | Georgia | Palatino | Garamond | Comic Sans MS | Trebuchet MS\n# ---------------------------------------------------------------\n# 字体设置\nfont:\n  enable: false\n\n  # Uri of fonts host. E.g. //fonts.googleapis.com (Default).\n  host:\n\n  # Font options:\n  # `external: true` will load this font family from `host` above.\n  # `family: Times New Roman`. Without any quotes.\n  # `size: xx`. Use `px` as unit.\n\n  # Global font settings used for all elements in <body>.\n  global:\n    external: true\n    family: Lato\n    size:\n\n  # Font settings for Headlines (H1, H2, H3, H4, H5, H6).\n  # Fallback to `global` font settings.\n  headings:\n    external: true\n    family:\n    size:\n\n  # Font settings for posts.\n  # Fallback to `global` font settings.\n  posts:\n    external: true\n    family:\n\n  # Font settings for Logo.\n  # Fallback to `global` font settings.\n  logo:\n    external: true\n    family:\n    size:\n\n  # Font settings for <code> and code blocks.\n  codes:\n    external: true\n    family:\n    size:\n\n\n# ---------------------------------------------------------------\n# Third Party Services Settings\n# ---------------------------------------------------------------\n\n# Math Equations Render Support\nmath:\n  enable: false\n\n  # Default(true) will load mathjax/katex script on demand\n  # That is it only render those page who has 'mathjax: true' in Front Matter.\n  # If you set it to false, it will load mathjax/katex srcipt EVERY PAGE.\n  per_page: true\n\n  engine: mathjax\n  #engine: katex\n\n  # hexo-rendering-pandoc (or hexo-renderer-kramed) needed to full MathJax support.\n  mathjax:\n    # Use 2.7.1 as default, jsdelivr as default CDN, works everywhere even in China\n    cdn: //cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML\n    # For newMathJax CDN (cdnjs.cloudflare.com) with fallback to oldMathJax (cdn.mathjax.org).\n    #cdn: //cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML\n    # For direct link to MathJax.js with CloudFlare CDN (cdnjs.cloudflare.com).\n    #cdn: //cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML\n    # For automatic detect latest version link to MathJax.js and get from Bootcss.\n    #cdn: //cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML\n\n  # hexo-renderer-markdown-it-plus (or hexo-renderer-markdown-it with markdown-it-katex plugin)\n  # needed to full Katex support.\n  katex:\n    # Use 0.7.1 as default, jsdelivr as default CDN, works everywhere even in China\n    cdn: //cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css\n    # CDNJS, provided by cloudflare, maybe the best CDN, but not works in China\n    #cdn: //cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css\n    # Bootcss, works great in China, but not so well in other region\n    #cdn: //cdn.bootcss.com/KaTeX/0.7.1/katex.min.css\n\n# Han Support\n# Dependencies: https://github.com/theme-next/theme-next-han\n# 汉字标准格式，没用过暂时不了解\nhan: false\n\n# Pangu Support\n# Dependencies: https://github.com/theme-next/theme-next-pangu\n# For more information: https://github.com/vinta/pangu.js\npangu: false\n\n# Swiftype Search API Key\n#swiftype_key:\n\n# Baidu Analytics ID\n#baidu_analytics:\n\n# Disqus\ndisqus:\n  enable: false\n  shortname:\n  count: true\n  lazyload: false\n\n# Hypercomments\n#hypercomments_id:\n\n# changyan\nchangyan:\n  enable: false\n  appid:\n  appkey:\n\n# leanCloud支持的评论插件\n# Valine. \n# You can get your appid and appkey from https://leancloud.cn\n# more info please open https://valine.js.org\nvaline:\n  enable: false\n  appid:  P08Jh3wwb2zPhfm9puCevcUa-*******\n  appkey:  CnhNSWBKT3kwj52v********\n  notify: false # mail notifier , https://github.com/xCss/Valine/wiki\n  verify: false # Verification code\n  placeholder: Just go go # comment box placeholder\n  avatar: mm # gravatar style\n  guest_info: nick,mail,link # custom comment header\n  pageSize: 10 # pagination size\n\n\n# Support for youyan comments system.\n# You can get your uid from http://www.uyan.cc\n#youyan_uid: your uid\n\n# Support for LiveRe comments system.\n# You can get your uid from https://livere.com/insight/myCode (General web site)\nlivere_uid: MTAyMC8yODQwNi******\n\n# Gitment\n# Introduction: https://imsun.net/posts/gitment-introduction/\ngitment:\n  enable: false\n  mint: true # RECOMMEND, A mint on Gitment, to support count, language and proxy_gateway\n  count: true # Show comments count in post meta area\n  lazy: false # Comments lazy loading with a button\n  cleanly: false # Hide 'Powered by ...' on footer, and more\n  language: # Force language, or auto switch by theme\n  github_user: # MUST HAVE, Your Github Username\n  github_repo: # MUST HAVE, The name of the repo you use to store Gitment comments\n  client_id: # MUST HAVE, Github client id for the Gitment\n  client_secret: # EITHER this or proxy_gateway, Github access secret token for the Gitment\n  proxy_gateway: # Address of api proxy, See: https://github.com/aimingoo/intersect\n  redirect_protocol: # Protocol of redirect_uri with force_redirect_protocol when mint enabled\n\n# Baidu Share\n# Available value:\n#    button | slide\n# Warning: Baidu Share does not support https.\n#baidushare:\n##  type: button\n\n# Share\n# This plugin is more useful in China, make sure you known how to use it.\n# And you can find the use guide at official webiste: http://www.jiathis.com/.\n# Warning: JiaThis does not support https.\n#jiathis:\n  ##uid: Get this uid from http://www.jiathis.com/\n\n#add_this_id:\n\n# NeedMoreShare2\n# Dependencies: https://github.com/theme-next/theme-next-needmoreshare2\n# See: https://github.com/revir/need-more-share2\n# Also see: https://github.com/DzmVasileusky/needShareButton\n# iconStyle: default | box\n# boxForm: horizontal | vertical\n# position: top / middle / bottom + Left / Center / Right\n# networks: Weibo,Wechat,Douban,QQZone,Twitter,Linkedin,Mailto,Reddit,\n#           Delicious,StumbleUpon,Pinterest,Facebook,GooglePlus,Slashdot,\n#           Technorati,Posterous,Tumblr,GoogleBookmarks,Newsvine,\n#           Evernote,Friendfeed,Vkontakte,Odnoklassniki,Mailru\nneedmoreshare2:\n  enable: false\n  postbottom:\n    enable: false\n    options:\n      iconStyle: box\n      boxForm: horizontal\n      position: bottomCenter\n      networks: Weibo,Wechat,Douban,QQZone,Twitter,Facebook\n  float:\n    enable: false\n    options:\n      iconStyle: box\n      boxForm: horizontal\n      position: middleRight\n      networks: Weibo,Wechat,Douban,QQZone,Twitter,Facebook\n\n# Google Webmaster tools verification setting\n# See: https://www.google.com/webmasters/\n#google_site_verification:\n\n# Google Analytics\n#google_analytics:\n\n# Bing Webmaster tools verification setting\n# See: https://www.bing.com/webmaster/\n#bing_site_verification:\n\n# Yandex Webmaster tools verification setting\n# See: https://webmaster.yandex.ru/\n#yandex_site_verification:\n\n# CNZZ count\n#cnzz_siteid:\n\n# Application Insights\n# See https://azure.microsoft.com/en-us/services/application-insights/\n# application_insights:\n\n# Post widgets & FB/VK comments settings.\n# ---------------------------------------------------------------\n# Facebook SDK Support.\n# https://github.com/iissnan/hexo-theme-next/pull/410\nfacebook_sdk:\n  enable:       false\n  app_id:       #<app_id>\n  fb_admin:     #<user_id>\n  like_button:  #true\n  webmaster:    #true\n\n# Facebook comments plugin\n# This plugin depends on Facebook SDK.\n# If facebook_sdk.enable is false, Facebook comments plugin is unavailable.\nfacebook_comments_plugin:\n  enable:       false\n  num_of_posts: 10    # min posts num is 1\n  width:        100%  # default width is 550px\n  scheme:       light # default scheme is light (light or dark)\n\n# VKontakte API Support.\n# To get your AppID visit https://vk.com/editapp?act=create\nvkontakte_api:\n  enable:       false\n  app_id:       #<app_id>\n  like:         true\n  comments:     true\n  num_of_posts: 10\n\n# Star rating support to each article.\n# To get your ID visit https://widgetpack.com\nrating:\n  enable: false\n  id:     #<app_id>\n  color:  fc6423\n# ---------------------------------------------------------------\n\n# Show number of visitors to each article.\n# You can visit https://leancloud.cn get AppID and AppKey.\nleancloud_visitors:\n  enable: false\n  app_id: P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz\n  app_key: CnhNSWBKT3kwj52vyJ36armb\n  # Dependencies: https://github.com/theme-next/hexo-leancloud-counter-security\n  # If you don't care about security in lc counter and just want to use it directly\n  # (without hexo-leancloud-counter-security plugin), set the `security` to `false`.\n  security: true\n  betterPerformance: false\n\n# Another tool to show number of visitors to each article.\n# visit https://console.firebase.google.com/u/0/ to get apiKey and projectId\n# visit https://firebase.google.com/docs/firestore/ to get more information about firestore\nfirestore:\n  enable: false\n  collection: articles #required, a string collection name to access firestore database\n  apiKey: #required\n  projectId: #required\n  bluebird: false #enable this if you want to include bluebird 3.5.1(core version) Promise polyfill\n\n# Show Views/Visitors of the website/page with busuanzi.\n# Get more information on http://ibruce.info/2015/04/04/busuanzi/\nbusuanzi_count:\n  enable: true\n  total_visitors: true\n  total_visitors_icon: user\n  total_views: true\n  total_views_icon: eye\n  post_views: true\n  post_views_icon: eye\n\n\n# Tencent analytics ID\n# tencent_analytics:\n\n# Tencent MTA ID\n# tencent_mta:\n\n\n# Enable baidu push so that the blog will push the url to baidu automatically which is very helpful for SEO\nbaidu_push: false\n\n# Google Calendar\n# Share your recent schedule to others via calendar page\n#\n# API Documentation:\n# https://developers.google.com/google-apps/calendar/v3/reference/events/list\ncalendar:\n  enable: false\n  calendar_id: <required>\n  api_key: <required>\n  orderBy: startTime\n  offsetMax: 24\n  offsetMin: 4\n  timeZone:\n  showDeleted: false\n  singleEvents: true\n  maxResults: 250\n\n# Algolia Search\n# See: https://github.com/theme-next/hexo-theme-next/blob/master/docs/ALGOLIA-SEARCH.md\n# Dependencies: https://github.com/theme-next/theme-next-algolia-instant-search\nalgolia_search:\n  enable: false\n  hits:\n    per_page: 10\n  labels:\n    input_placeholder: Search for Posts\n    hits_empty: \"We didn't find any results for the search: ${query}\"\n    hits_stats: \"${hits} results found in ${time} ms\"\n\n# Local search\n# Dependencies: https://github.com/theme-next/hexo-generator-searchdb\n# 要安装插件才能使用，先进入站点文件夹根目录\n#  然后：npm install hexo-generator-searchdb --save\nlocal_search:\n  enable: true\n  # if auto, trigger search by changing input\n  # if manual, trigger search by pressing enter key or search button\n  trigger: auto\n  # show top n results per article, show all results by setting to -1\n  top_n_per_article: 1\n  # unescape html strings to the readable one\n  unescape: false\n\n# Bookmark Support\n# Dependencies: https://github.com/theme-next/theme-next-bookmark\nbookmark:\n  enable: false\n  # if auto\n  #   - save the reading position when closing the page\n  #   - or clicking the bookmark-icon\n  # if manual, only save it by clicking the bookmark-icon\n  save: auto\n\n\n# ---------------------------------------------------------------\n# Tags Settings\n# ---------------------------------------------------------------\n\n# External URL with BASE64 encrypt & decrypt.\n# Usage: {% exturl text url \"title\" %}\n# Alias: {% extlink text url \"title\" %}\n# 用法见：\n# https://github.com/iissnan/hexo-theme-next/pull/1438\nexturl: false\n\n# 主题的标签样式，有 note、label、tabs 三种\n# Note tag (bs-callout).\nnote:\n  # Note tag style values:\n  #  - simple    bs-callout old alert style. Default.\n  #  - modern    bs-callout new (v2-v3) alert style.\n  #  - flat      flat callout style with background, like on Mozilla or StackOverflow.\n  #  - disabled  disable all CSS styles import of note tag.\n  style: simple\n  icons: false\n  border_radius: 3\n  # Offset lighter of background in % for modern and flat styles (modern: -12 | 12; flat: -18 | 6).\n  # Offset also applied to label tag variables. This option can work with disabled note tag.\n  light_bg_offset: 0\n\n# Label tag.\nlabel: true\n\n# Tabs tag.\ntabs:\n  enable: true\n  transition:\n    tabs: false\n    labels: true\n  border_radius: 0\n\n# Reading progress bar\n# Dependencies: https://github.com/theme-next/theme-next-reading-progress\nreading_progress:\n  enable: false\n  color: \"#37c6c0\"\n  height: 2px\n\n\n#! ---------------------------------------------------------------\n#! DO NOT EDIT THE FOLLOWING SETTINGS\n#! UNLESS YOU KNOW WHAT YOU ARE DOING\n#! ---------------------------------------------------------------\n\n# 动画\n# Use velocity to animate everything.\nmotion:\n  enable: true\n  async: false\n  transition:\n    # Transition variants:\n    # fadeIn | fadeOut | flipXIn | flipXOut | flipYIn | flipYOut | flipBounceXIn | flipBounceXOut | flipBounceYIn | flipBounceYOut\n    # swoopIn | swoopOut | whirlIn | whirlOut | shrinkIn | shrinkOut | expandIn | expandOut\n    # bounceIn | bounceOut | bounceUpIn | bounceUpOut | bounceDownIn | bounceDownOut | bounceLeftIn | bounceLeftOut | bounceRightIn | bounceRightOut\n    # slideUpIn | slideUpOut | slideDownIn | slideDownOut | slideLeftIn | slideLeftOut | slideRightIn | slideRightOut\n    # slideUpBigIn | slideUpBigOut | slideDownBigIn | slideDownBigOut | slideLeftBigIn | slideLeftBigOut | slideRightBigIn | slideRightBigOut\n    # perspectiveUpIn | perspectiveUpOut | perspectiveDownIn | perspectiveDownOut | perspectiveLeftIn | perspectiveLeftOut | perspectiveRightIn | perspectiveRightOut\n    post_block: fadeIn\n    post_header: slideDownIn\n    post_body: slideDownIn\n    coll_header: slideLeftIn\n    # Only for Pisces | Gemini.\n    sidebar: slideUpIn\n\n# Fancybox. There is support for old version 2 and new version 3.\n# Please, choose only any one variant, do not need to install both.\n# For install 2.x: https://github.com/theme-next/theme-next-fancybox\n# For install 3.x: https://github.com/theme-next/theme-next-fancybox3\n# 查看图片的\nfancybox: false\n\n# Added switch option for separated repo in 6.0.0.\n# Dependencies: https://github.com/theme-next/theme-next-fastclick\nfastclick: false\n\n# Added switch option for separated repo in 6.0.0.\n# Dependencies: https://github.com/theme-next/theme-next-jquery-lazyload\nlazyload: false\n\n# Progress bar in the top during page loading.\n# Dependencies: https://github.com/theme-next/theme-next-pace\npace: false\n# Themes list:\n#pace-theme-big-counter\n#pace-theme-bounce\n#pace-theme-barber-shop\n#pace-theme-center-atom\n#pace-theme-center-circle\n#pace-theme-center-radar\n#pace-theme-center-simple\n#pace-theme-corner-indicator\n#pace-theme-fill-left\n#pace-theme-flash\n#pace-theme-loading-bar\n#pace-theme-mac-osx\n#pace-theme-minimal\n# For example\n# pace_theme: pace-theme-center-simple\npace_theme: pace-theme-minimal\n\n# Canvas-nest\n# Dependencies: https://github.com/theme-next/theme-next-canvas-nest\ncanvas_nest: true\n\n# JavaScript 3D library.\n# Dependencies: https://github.com/theme-next/theme-next-three\n# three_waves\nthree_waves: false\n# canvas_lines\ncanvas_lines: false\n# canvas_sphere\ncanvas_sphere: false\n\n# Only fit scheme Pisces\n# Dependencies: https://github.com/theme-next/theme-next-canvas-ribbon\n# Canvas-ribbon\n# size: The width of the ribbon.\n# alpha: The transparency of the ribbon.\n# zIndex: The display level of the ribbon.\ncanvas_ribbon:\n  enable: false\n  size: 300\n  alpha: 0.6\n  zIndex: -1\n\n# Script Vendors.\n# Set a CDN address for the vendor you want to customize.\n# For example\n#    jquery: https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js\n# Be aware that you should use the same version as internal ones to avoid potential problems.\n# Please use the https protocol of CDN files when you enable https on your site.\n# 相关内容用 CDN 地址取代，加速网站访问，注意版本尽可能要一致\nvendors:\n  # Internal path prefix. Please do not edit it.\n  _internal: lib\n\n  # Internal version: 2.1.3\n  jquery:\n\n  # Internal version: 2.1.5\n  # See: http://fancyapps.com/fancybox/\n  fancybox:\n  fancybox_css:\n\n  # Internal version: 1.0.6\n  # See: https://github.com/ftlabs/fastclick\n  fastclick:\n\n  # Internal version: 1.9.7\n  # See: https://github.com/tuupola/jquery_lazyload\n  lazyload:\n\n  # Internal version: 1.2.1\n  # See: http://VelocityJS.org\n  velocity:\n\n  # Internal version: 1.2.1\n  # See: http://VelocityJS.org\n  velocity_ui:\n\n  # Internal version: 0.7.9\n  # See: https://faisalman.github.io/ua-parser-js/\n  ua_parser:\n\n  # Internal version: 4.6.2\n  # See: http://fontawesome.io/\n  fontawesome:\n\n  # Internal version: 1\n  # https://www.algolia.com\n  algolia_instant_js:\n  algolia_instant_css:\n\n  # Internal version: 1.0.2\n  # See: https://github.com/HubSpot/pace\n  # Or use direct links below:\n  # pace: //cdn.bootcss.com/pace/1.0.2/pace.min.js\n  # pace_css: //cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-flash.min.css\n  pace:\n  pace_css:\n\n  # Internal version: 1.0.0\n  # https://github.com/hustcc/canvas-nest.js\n  canvas_nest: \n\n  # three\n  three:\n\n  # three_waves\n  # https://github.com/jjandxa/three_waves\n  three_waves:\n\n  # three_waves\n  # https://github.com/jjandxa/canvas_lines\n  canvas_lines:\n\n  # three_waves\n  # https://github.com/jjandxa/canvas_sphere\n  canvas_sphere:\n\n  # Internal version: 1.0.0\n  # https://github.com/zproo/canvas-ribbon\n  canvas_ribbon:\n\n  # Internal version: 3.3.0\n  # https://github.com/ethantw/Han\n  han:\n\n  # Internal version: 3.3.0\n  # https://github.com/vinta/pangu.js\n  pangu:\n\n  # needMoreShare2\n  # https://github.com/revir/need-more-share2\n  needmoreshare2_js:\n  needmoreshare2_css:\n\n  # bookmark\n  # Internal version: 1.0.0\n  # https://github.com/theme-next/theme-next-bookmark\n  bookmark:\n\n  # reading_progress\n  # Internal version: 1.0\n  # https://github.com/theme-next/theme-next-reading-progress\n  # Example: https://cdn.jsdelivr.net/gh/theme-next/theme-next-reading-progress@1.1/reading_progress.min.js\n  reading_progress:\n\n  # valine comment\n  # Example: https://cdn.jsdelivr.net/npm/valine@1.1.8/dist/Valine.min.js\n  valine:\n\n\n# Assets\ncss: css\njs: js\nimages: images\n\n# Theme version\nversion: 6.0.6\n```\n\n### 2.4 动态背景\n\n在主题配置文件中，靠后面，改canvas_nest: true，想要更改颜色和数量？修改文件：\n\n文件位置：~/blog/themes/next/source/lib/canvas-nest/canvas-nest.min.js\n\n怎么修改？参考[canvas-nest.js][9]。\n\n### 2.5 注脚\n\n参考[hexo-footnotes][10]。\n\n## 3.优化:高级功能配置\n\n### 3.1 大佬们的文章\n\n更多如外挂一样的功能配置，就直接贴大佬的文章了，哪些功能自己喜欢，按照大佬的教程来配置就行。不过也有坑，比如有些功能（超链接样式、侧栏头像圆形并旋转）可以直接通过在custom.styl添加 CSS 代码实现，无需更改其它文件！\n\n 1. [打造个性超赞博客Hexo+NexT+GithubPages的超深度优化][11]\n 2. [hexo高阶教程next主题优化][12]\n 3. [hexo的next主题个性化教程:打造炫酷网站][13]\n 4. [Hexo搭建博客的个性化设置][14]\n\n### 3.2 鼠标点击效果\n\n 1. 新建mouse.js，复制[love][15]或者[富强民主...][16]中的内容到js文件中。\n 2. 将mouse.js放到**/themes/next/source/js/src**路径下\n 3. 打开/themes/next/layout/layout.swig文件，添加如下代码：\n    \n    ```js\n    <script type=\"text/javascript\" src=\"/js/src/mouse.js\"></script>\n    ```\n\n \n### 3.3 文章加密\n        \n参考：[hexo-blog-encrypt][17]\n\n 1. 在博客根目录下的package.json文件中添加一行代码\n\n    ```json\n    \"hexo-blog-encrypt\": \"2.0.*\"\n    ```\n\n 2. 在博客根目录下：  **npm install**\n 3. 在站点配置文件中配置文章加密\n\n    ```json\n    # Security\n    encrypt:\n        enable: true\n    ```\n\n 4. 然后在你的文章的头部添加上对应的字段，如 password, abstract, message\n\n    ```md\n    title: hello world\n    date: 2016-03-30 21:18:02\n    tags:\n        - fdsafsdaf\n    password: Mike\n    abstract: 没点开文章前显示的类容，类似于<!--more-->之前写的描述.\n    message: 点开文章后，提示输入密码的信息.\n    ```\n \n\n    \n\n### 3.4 博客推广及SEO优化\n\n\n建站完成后百度和Google是没有收录我们的网站的，想要搜索到我们的博客非常困难。因此优化搜索非常有必要。\n\n**博客推广**\n\n博客推广第一步，手动推广。\n\n你可以多浏览别人的博客并留下你的爪印（博客地址），比如 评论 本文；你可以去 [README.md][18]中提到的 [这个issue][19] 留下你的爪印；你可以去 [Issues页面][20] 试着回答下大家的问题并留下你的爪印。\n\n博客推广第二步，[SEO][21]（Search Engine Optimization）。\n\n**搜索引擎**\n\n直接推荐大佬文章：[【搜索优化】Hexo-next百度和谷歌搜索优化][22]\n\n### 3.5 随机生成背景图\n\n在主题下的/source/css/_custom/custom.style文件中，添加如下代码：\n\n```css\nbody{   \n\tbackground:url(https://source.unsplash.com/random/1920x1080);\n\tbackground-size:cover;\n\tbackground-repeat:no-repeat;\n\tbackground-attachment:fixed;\n\tbackground-position:50% 50%;\n}\n\n.main-inner { \n    margin-top: 60px;\n    padding: 60px 60px 60px 60px;\n    background: #fff;\n    opacity: 0.8;\n    min-height: 500px;\n}\n```\n\n### 3.6 背景动画\n\n依赖于[theme-next-canvas-nest][23],或者[3D library][24]。\n\n 1. 进入到主题目录，如：cd themes/next\n 2. 下载插件\n\n    ```\n    git clone https://github.com/theme-next/theme-next-canvas-nest source/lib/canvas-nest\n    git clone https://github.com/theme-next/theme-next-three source/lib/three\n    ```\n 3. 在主题配置文件中开启，一次只开启一个\n\n    ```\n    canvas_nest: false\n    \n    three_waves: false\n    canvas_lines: true\n    canvas_sphere: false\n    ```\n    \n 4. 插件更新\n\n    ```\n    $ cd themes/next/source/lib/canvas-nest\n    $ git pull\n    ```\n \n \n\n \n\n\n  [1]: https://github.com/iissnan/hexo-theme-next\n  [2]: https://github.com/search?o=desc&q=topic:hexo-theme&s=stars&type=Repositories\n  [3]: https://github.com/iissnan/hexo-theme-next\n  [4]: https://github.com/theme-next\n  [5]: https://hexo.io/themes/\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/blog/copyLink.png\n  [7]: https://hexo.io/zh-cn/docs/configuration.html\n  [8]: http://theme-next.iissnan.com/getting-started.html\n  [9]: https://github.com/hustcc/canvas-nest.js/blob/master/README-zh.md\n  [10]: https://github.com/LouisBarranqueiro/hexo-footnotes\n  [11]: https://reuixiy.github.io/technology/computer/computer-aided-art/2017/06/09/hexo-next-optimization.html\n  [12]: http://cherryblog.site/Hexo-high-level-tutorialcloudmusic,bg-customthemes-statistical.html\n  [13]: http://shenzekun.cn/hexo%E7%9A%84next%E4%B8%BB%E9%A2%98%E4%B8%AA%E6%80%A7%E5%8C%96%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B.html\n  [14]: http://www.dingxuewen.com/categories/Site/\n  [15]: https://github.com/kevinXiao2016/kevinXiao2016.github.io/blob/hexo/source/love.js\n  [16]: https://github.com/kevinXiao2016/kevinXiao2016.github.io/blob/hexo/source/mouse.js\n  [17]: https://github.com/MikeCoder/hexo-blog-encrypt/blob/master/ReadMe.zh.md\n  [18]: https://github.com/iissnan/hexo-theme-next#live-preview\n  [19]: https://github.com/iissnan/hexo-theme-next/issues/119\n  [20]: https://github.com/iissnan/hexo-theme-next/issuess://github.com/iissnan/hexo-theme-next/issues/119\n  [21]: https://baike.baidu.com/item/SEO\n  [22]: http://www.ehcoo.com/seo.html\n  [23]: https://github.com/theme-next/theme-next-canvas-nest\n  [24]: https://github.com/theme-next/theme-next-three","slug":"NexT主题深度优化","published":1,"updated":"2018-04-04T09:27:28.091Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfu1002dhwvfgihr2t6i","content":"<p>本文主要对next主题导入后的基本及深度优化行为做了记录。其中基本配置直接贴出了配置文件，里面写上了中文注释。深度优化方面，既有总结，也有大量的链接推荐。</p>\n<a id=\"more\"></a>\n<h2 id=\"1-开始搭建博客\"><a href=\"#1-开始搭建博客\" class=\"headerlink\" title=\"1.开始搭建博客\"></a>1.开始搭建博客</h2><h2 id=\"2-优化：基本功能配置\"><a href=\"#2-优化：基本功能配置\" class=\"headerlink\" title=\"2.优化：基本功能配置\"></a>2.优化：基本功能配置</h2><p>接下来是配置和增强功能，如阅读统计、评论、插件之类的，这些基本配置建议在写文章之前配置好。</p>\n<p>基本功能配置大部分是修改两个文件，都叫_config.yml。一个是站点的，一个是主题的。</p>\n<p>与其将各个功能分散开来讲，不如直接贴出配置文件，打上注释，从头到尾看一遍就知道如何配置了。</p>\n<h3 id=\"2-1-选择主题\"><a href=\"#2-1-选择主题\" class=\"headerlink\" title=\"2.1 选择主题\"></a>2.1 选择主题</h3><p>我选择的是<a href=\"https://github.com/iissnan/hexo-theme-next\" target=\"_blank\" rel=\"noopener\">NexT</a>,是在Github上<a href=\"https://github.com/search?o=desc&amp;q=topic:hexo-theme&amp;s=stars&amp;type=Repositories\" target=\"_blank\" rel=\"noopener\">被Star最多</a>【2018.3.30】的一个Hexo主题。从V6.0.0开始next主仓库已从 <a href=\"https://github.com/iissnan/hexo-theme-next\" target=\"_blank\" rel=\"noopener\">iissnan</a> 名下 迁移至 <a href=\"https://github.com/theme-next\" target=\"_blank\" rel=\"noopener\">theme-next </a>。组织</p>\n<p>想要什么样的主题，去<a href=\"https://hexo.io/themes/\" target=\"_blank\" rel=\"noopener\">Hexo Themes</a>上慢慢找。</p>\n<p>至于更换主题，很简单，用NexT主题举个例子。</p>\n<ol>\n<li><p>首先，去主题所在仓库拷贝仓库地址，如下图：</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/blog/copyLink.png\" alt=\"拷贝仓库地址\">    </p>\n</li>\n<li><p>然后，到博客站点根目录下,打开 <strong>git bash</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">// next是自定义的主题名字，可以随意更改</div><div class=\"line\">git clone https://github.com/theme-next/hexo-theme-next.git themes/next</div></pre></td></tr></table></figure>\n</li>\n<li><p>最后，修改站点配置文件_config.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">## Themes: https://hexo.io/themes/</div><div class=\"line\">theme: next</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"2-2-站点配置文件\"><a href=\"#2-2-站点配置文件\" class=\"headerlink\" title=\"2.2 站点配置文件\"></a>2.2 站点配置文件</h3><p>请先查看 <a href=\"https://hexo.io/zh-cn/docs/configuration.html\" target=\"_blank\" rel=\"noopener\">Hexo官方文档</a> ，再查看下面我贴出的，如果这样后你还是对有些地方比较懵，可以自行 Google。</p>\n<p><strong>注意：文件中所有的 : 都是英文字符，且后面都有一个空格。</strong></p>\n<p>【2018.3.30更新】文件位置： ~/blog/_config.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div></pre></td><td class=\"code\"><pre><div class=\"line\"># Hexo Configuration</div><div class=\"line\">## Docs: https://hexo.io/docs/configuration.html</div><div class=\"line\">## Source: https://github.com/hexojs/hexo/</div><div class=\"line\"></div><div class=\"line\"># Site</div><div class=\"line\">title: 温故而知新</div><div class=\"line\">subtitle: </div><div class=\"line\">description: 天下事有难易乎？&lt;br/&gt;为之，则难者亦易矣；&lt;br/&gt;不为，则易者亦难矣。</div><div class=\"line\">author: 肖悦</div><div class=\"line\">language: zh-CN</div><div class=\"line\">timezone: </div><div class=\"line\"></div><div class=\"line\"># URL</div><div class=\"line\">## If your site is put in a subdirectory, set url as &apos;http://yoursite.com/child&apos; and root as &apos;/child/&apos;</div><div class=\"line\">url: http://kevinXiao2016.github.io</div><div class=\"line\">root: /</div><div class=\"line\"># 博客文章的 URL 结构，请务必写文章之前就想好！</div><div class=\"line\"># 详细参数请查看：https://hexo.io/docs/permalinks.html</div><div class=\"line\">permalink: :year/:month/:day/:title/</div><div class=\"line\">permalink_defaults:</div><div class=\"line\"></div><div class=\"line\"># Directory</div><div class=\"line\">source_dir: source</div><div class=\"line\">public_dir: public</div><div class=\"line\">tag_dir: tags</div><div class=\"line\">archive_dir: archives</div><div class=\"line\">category_dir: categories</div><div class=\"line\">code_dir: downloads/code</div><div class=\"line\">i18n_dir: :lang</div><div class=\"line\">skip_render:</div><div class=\"line\"></div><div class=\"line\"># Writing</div><div class=\"line\">new_post_name: :title.md # File name of new posts</div><div class=\"line\">default_layout: post</div><div class=\"line\">titlecase: false # Transform title into titlecase</div><div class=\"line\">external_link: true # Open external links in new tab</div><div class=\"line\">filename_case: 0</div><div class=\"line\">render_drafts: false</div><div class=\"line\">post_asset_folder: false</div><div class=\"line\">relative_link: false</div><div class=\"line\">future: true</div><div class=\"line\"># 代码高亮设置</div><div class=\"line\">highlight:</div><div class=\"line\">  enable: true</div><div class=\"line\">  line_number: true</div><div class=\"line\">  auto_detect: false</div><div class=\"line\">  tab_replace:</div><div class=\"line\"></div><div class=\"line\"># Category &amp; Tag</div><div class=\"line\">default_category: uncategorized</div><div class=\"line\">category_map:</div><div class=\"line\">tag_map:</div><div class=\"line\"></div><div class=\"line\"># Date / Time format</div><div class=\"line\">## Hexo uses Moment.js to parse and display date</div><div class=\"line\">## You can customize the date format as defined in</div><div class=\"line\">## http://momentjs.com/docs/#/displaying/format/</div><div class=\"line\">date_format: YYYY-MM-DD</div><div class=\"line\">time_format: HH:mm:ss</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># 扩展设置</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># 集成Local Search 支持站内搜索</div><div class=\"line\">search:</div><div class=\"line\">  path: search.xml</div><div class=\"line\">  field: post</div><div class=\"line\">  format: html</div><div class=\"line\">  limit: 10000</div><div class=\"line\"># Pagination</div><div class=\"line\">## Set per_page to 0 to disable pagination</div><div class=\"line\">per_page: 10</div><div class=\"line\">pagination_dir: page</div><div class=\"line\"></div><div class=\"line\">index_generator:</div><div class=\"line\">  per_page: 10 ##首页默认10篇文章标题 如果值为0不分页</div><div class=\"line\">## 修改归档页面、某一分类页面、某一标签页面的显示篇数</div><div class=\"line\">## 参考：http://theme-next.iissnan.com/faqs.html#setting-page-size</div><div class=\"line\">archive_generator:</div><div class=\"line\">\tper_page: 10 ##归档页面默认10篇文章标题</div><div class=\"line\">\tyearly: true  ##生成年视图</div><div class=\"line\">\tmonthly: true ##生成月视图</div><div class=\"line\">tag_generator:</div><div class=\"line\">\tper_page: 10 ##标签分类页面默认10篇文章</div><div class=\"line\">category_generator: </div><div class=\"line\">\tper_page: 10 ###分类页面默认10篇文章</div><div class=\"line\"></div><div class=\"line\"># Extensions</div><div class=\"line\">## Plugins: https://hexo.io/plugins/</div><div class=\"line\">## Themes: https://hexo.io/themes/</div><div class=\"line\">theme: next</div><div class=\"line\"></div><div class=\"line\"># Deployment</div><div class=\"line\">## Docs: https://hexo.io/docs/deployment.html</div><div class=\"line\">deploy:</div><div class=\"line\">  type: git</div><div class=\"line\">  # 没有做cdn映射前，请使用下面注释掉的配置</div><div class=\"line\">  repo: </div><div class=\"line\">        github: git@github.com:kevinXiao2016/kevinXiao2016.github.io.git,master</div><div class=\"line\">        coding: git@git.coding.net:kevinXiao2016/kevinXiao2016.git,master</div><div class=\"line\"></div><div class=\"line\">  #repository: https://github.com/kevinXiao2016/kevinXiao2016.github.io.git</div><div class=\"line\">  #branch: master</div></pre></td></tr></table></figure>\n<h3 id=\"2-3-主题配置文件\"><a href=\"#2-3-主题配置文件\" class=\"headerlink\" title=\"2.3 主题配置文件\"></a>2.3 主题配置文件</h3><p>如果使用的主题不是Next，那么请另 Google。建议先查看 <a href=\"http://theme-next.iissnan.com/getting-started.html\" target=\"_blank\" rel=\"noopener\">NexT 官方文档</a>。</p>\n<p>【2018.3.30更新】文件位置： ~/blog/themes/next/_config.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Theme Core Configuration Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># 更新相关，参考：https://github.com/iissnan/hexo-theme-next/issues/328</div><div class=\"line\"># 简单说：从V6.0.0开始支持以下功能，不更改主题设置，在站点中设置主题</div><div class=\"line\"># 1.在~/blog/source 目录下新建source目录，在里面新建 next.yml文件</div><div class=\"line\"># 2.将主题配置文件全部拷贝过去</div><div class=\"line\"># 3.设置此处override为true,表明此文件配置可被next.yml中的配置覆盖</div><div class=\"line\">override: true</div><div class=\"line\"></div><div class=\"line\"># Allow to cache content generation. Introduced in NexT v6.0.0.</div><div class=\"line\">cache:</div><div class=\"line\">  enable: true</div></pre></td></tr></table></figure>\n<p>【2018.3.30更新】文件位置： ~/blog/source/_data/next.yml<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div><div class=\"line\">210</div><div class=\"line\">211</div><div class=\"line\">212</div><div class=\"line\">213</div><div class=\"line\">214</div><div class=\"line\">215</div><div class=\"line\">216</div><div class=\"line\">217</div><div class=\"line\">218</div><div class=\"line\">219</div><div class=\"line\">220</div><div class=\"line\">221</div><div class=\"line\">222</div><div class=\"line\">223</div><div class=\"line\">224</div><div class=\"line\">225</div><div class=\"line\">226</div><div class=\"line\">227</div><div class=\"line\">228</div><div class=\"line\">229</div><div class=\"line\">230</div><div class=\"line\">231</div><div class=\"line\">232</div><div class=\"line\">233</div><div class=\"line\">234</div><div class=\"line\">235</div><div class=\"line\">236</div><div class=\"line\">237</div><div class=\"line\">238</div><div class=\"line\">239</div><div class=\"line\">240</div><div class=\"line\">241</div><div class=\"line\">242</div><div class=\"line\">243</div><div class=\"line\">244</div><div class=\"line\">245</div><div class=\"line\">246</div><div class=\"line\">247</div><div class=\"line\">248</div><div class=\"line\">249</div><div class=\"line\">250</div><div class=\"line\">251</div><div class=\"line\">252</div><div class=\"line\">253</div><div class=\"line\">254</div><div class=\"line\">255</div><div class=\"line\">256</div><div class=\"line\">257</div><div class=\"line\">258</div><div class=\"line\">259</div><div class=\"line\">260</div><div class=\"line\">261</div><div class=\"line\">262</div><div class=\"line\">263</div><div class=\"line\">264</div><div class=\"line\">265</div><div class=\"line\">266</div><div class=\"line\">267</div><div class=\"line\">268</div><div class=\"line\">269</div><div class=\"line\">270</div><div class=\"line\">271</div><div class=\"line\">272</div><div class=\"line\">273</div><div class=\"line\">274</div><div class=\"line\">275</div><div class=\"line\">276</div><div class=\"line\">277</div><div class=\"line\">278</div><div class=\"line\">279</div><div class=\"line\">280</div><div class=\"line\">281</div><div class=\"line\">282</div><div class=\"line\">283</div><div class=\"line\">284</div><div class=\"line\">285</div><div class=\"line\">286</div><div class=\"line\">287</div><div class=\"line\">288</div><div class=\"line\">289</div><div class=\"line\">290</div><div class=\"line\">291</div><div class=\"line\">292</div><div class=\"line\">293</div><div class=\"line\">294</div><div class=\"line\">295</div><div class=\"line\">296</div><div class=\"line\">297</div><div class=\"line\">298</div><div class=\"line\">299</div><div class=\"line\">300</div><div class=\"line\">301</div><div class=\"line\">302</div><div class=\"line\">303</div><div class=\"line\">304</div><div class=\"line\">305</div><div class=\"line\">306</div><div class=\"line\">307</div><div class=\"line\">308</div><div class=\"line\">309</div><div class=\"line\">310</div><div class=\"line\">311</div><div class=\"line\">312</div><div class=\"line\">313</div><div class=\"line\">314</div><div class=\"line\">315</div><div class=\"line\">316</div><div class=\"line\">317</div><div class=\"line\">318</div><div class=\"line\">319</div><div class=\"line\">320</div><div class=\"line\">321</div><div class=\"line\">322</div><div class=\"line\">323</div><div class=\"line\">324</div><div class=\"line\">325</div><div class=\"line\">326</div><div class=\"line\">327</div><div class=\"line\">328</div><div class=\"line\">329</div><div class=\"line\">330</div><div class=\"line\">331</div><div class=\"line\">332</div><div class=\"line\">333</div><div class=\"line\">334</div><div class=\"line\">335</div><div class=\"line\">336</div><div class=\"line\">337</div><div class=\"line\">338</div><div class=\"line\">339</div><div class=\"line\">340</div><div class=\"line\">341</div><div class=\"line\">342</div><div class=\"line\">343</div><div class=\"line\">344</div><div class=\"line\">345</div><div class=\"line\">346</div><div class=\"line\">347</div><div class=\"line\">348</div><div class=\"line\">349</div><div class=\"line\">350</div><div class=\"line\">351</div><div class=\"line\">352</div><div class=\"line\">353</div><div class=\"line\">354</div><div class=\"line\">355</div><div class=\"line\">356</div><div class=\"line\">357</div><div class=\"line\">358</div><div class=\"line\">359</div><div class=\"line\">360</div><div class=\"line\">361</div><div class=\"line\">362</div><div class=\"line\">363</div><div class=\"line\">364</div><div class=\"line\">365</div><div class=\"line\">366</div><div class=\"line\">367</div><div class=\"line\">368</div><div class=\"line\">369</div><div class=\"line\">370</div><div class=\"line\">371</div><div class=\"line\">372</div><div class=\"line\">373</div><div class=\"line\">374</div><div class=\"line\">375</div><div class=\"line\">376</div><div class=\"line\">377</div><div class=\"line\">378</div><div class=\"line\">379</div><div class=\"line\">380</div><div class=\"line\">381</div><div class=\"line\">382</div><div class=\"line\">383</div><div class=\"line\">384</div><div class=\"line\">385</div><div class=\"line\">386</div><div class=\"line\">387</div><div class=\"line\">388</div><div class=\"line\">389</div><div class=\"line\">390</div><div class=\"line\">391</div><div class=\"line\">392</div><div class=\"line\">393</div><div class=\"line\">394</div><div class=\"line\">395</div><div class=\"line\">396</div><div class=\"line\">397</div><div class=\"line\">398</div><div class=\"line\">399</div><div class=\"line\">400</div><div class=\"line\">401</div><div class=\"line\">402</div><div class=\"line\">403</div><div class=\"line\">404</div><div class=\"line\">405</div><div class=\"line\">406</div><div class=\"line\">407</div><div class=\"line\">408</div><div class=\"line\">409</div><div class=\"line\">410</div><div class=\"line\">411</div><div class=\"line\">412</div><div class=\"line\">413</div><div class=\"line\">414</div><div class=\"line\">415</div><div class=\"line\">416</div><div class=\"line\">417</div><div class=\"line\">418</div><div class=\"line\">419</div><div class=\"line\">420</div><div class=\"line\">421</div><div class=\"line\">422</div><div class=\"line\">423</div><div class=\"line\">424</div><div class=\"line\">425</div><div class=\"line\">426</div><div class=\"line\">427</div><div class=\"line\">428</div><div class=\"line\">429</div><div class=\"line\">430</div><div class=\"line\">431</div><div class=\"line\">432</div><div class=\"line\">433</div><div class=\"line\">434</div><div class=\"line\">435</div><div class=\"line\">436</div><div class=\"line\">437</div><div class=\"line\">438</div><div class=\"line\">439</div><div class=\"line\">440</div><div class=\"line\">441</div><div class=\"line\">442</div><div class=\"line\">443</div><div class=\"line\">444</div><div class=\"line\">445</div><div class=\"line\">446</div><div class=\"line\">447</div><div class=\"line\">448</div><div class=\"line\">449</div><div class=\"line\">450</div><div class=\"line\">451</div><div class=\"line\">452</div><div class=\"line\">453</div><div class=\"line\">454</div><div class=\"line\">455</div><div class=\"line\">456</div><div class=\"line\">457</div><div class=\"line\">458</div><div class=\"line\">459</div><div class=\"line\">460</div><div class=\"line\">461</div><div class=\"line\">462</div><div class=\"line\">463</div><div class=\"line\">464</div><div class=\"line\">465</div><div class=\"line\">466</div><div class=\"line\">467</div><div class=\"line\">468</div><div class=\"line\">469</div><div class=\"line\">470</div><div class=\"line\">471</div><div class=\"line\">472</div><div class=\"line\">473</div><div class=\"line\">474</div><div class=\"line\">475</div><div class=\"line\">476</div><div class=\"line\">477</div><div class=\"line\">478</div><div class=\"line\">479</div><div class=\"line\">480</div><div class=\"line\">481</div><div class=\"line\">482</div><div class=\"line\">483</div><div class=\"line\">484</div><div class=\"line\">485</div><div class=\"line\">486</div><div class=\"line\">487</div><div class=\"line\">488</div><div class=\"line\">489</div><div class=\"line\">490</div><div class=\"line\">491</div><div class=\"line\">492</div><div class=\"line\">493</div><div class=\"line\">494</div><div class=\"line\">495</div><div class=\"line\">496</div><div class=\"line\">497</div><div class=\"line\">498</div><div class=\"line\">499</div><div class=\"line\">500</div><div class=\"line\">501</div><div class=\"line\">502</div><div class=\"line\">503</div><div class=\"line\">504</div><div class=\"line\">505</div><div class=\"line\">506</div><div class=\"line\">507</div><div class=\"line\">508</div><div class=\"line\">509</div><div class=\"line\">510</div><div class=\"line\">511</div><div class=\"line\">512</div><div class=\"line\">513</div><div class=\"line\">514</div><div class=\"line\">515</div><div class=\"line\">516</div><div class=\"line\">517</div><div class=\"line\">518</div><div class=\"line\">519</div><div class=\"line\">520</div><div class=\"line\">521</div><div class=\"line\">522</div><div class=\"line\">523</div><div class=\"line\">524</div><div class=\"line\">525</div><div class=\"line\">526</div><div class=\"line\">527</div><div class=\"line\">528</div><div class=\"line\">529</div><div class=\"line\">530</div><div class=\"line\">531</div><div class=\"line\">532</div><div class=\"line\">533</div><div class=\"line\">534</div><div class=\"line\">535</div><div class=\"line\">536</div><div class=\"line\">537</div><div class=\"line\">538</div><div class=\"line\">539</div><div class=\"line\">540</div><div class=\"line\">541</div><div class=\"line\">542</div><div class=\"line\">543</div><div class=\"line\">544</div><div class=\"line\">545</div><div class=\"line\">546</div><div class=\"line\">547</div><div class=\"line\">548</div><div class=\"line\">549</div><div class=\"line\">550</div><div class=\"line\">551</div><div class=\"line\">552</div><div class=\"line\">553</div><div class=\"line\">554</div><div class=\"line\">555</div><div class=\"line\">556</div><div class=\"line\">557</div><div class=\"line\">558</div><div class=\"line\">559</div><div class=\"line\">560</div><div class=\"line\">561</div><div class=\"line\">562</div><div class=\"line\">563</div><div class=\"line\">564</div><div class=\"line\">565</div><div class=\"line\">566</div><div class=\"line\">567</div><div class=\"line\">568</div><div class=\"line\">569</div><div class=\"line\">570</div><div class=\"line\">571</div><div class=\"line\">572</div><div class=\"line\">573</div><div class=\"line\">574</div><div class=\"line\">575</div><div class=\"line\">576</div><div class=\"line\">577</div><div class=\"line\">578</div><div class=\"line\">579</div><div class=\"line\">580</div><div class=\"line\">581</div><div class=\"line\">582</div><div class=\"line\">583</div><div class=\"line\">584</div><div class=\"line\">585</div><div class=\"line\">586</div><div class=\"line\">587</div><div class=\"line\">588</div><div class=\"line\">589</div><div class=\"line\">590</div><div class=\"line\">591</div><div class=\"line\">592</div><div class=\"line\">593</div><div class=\"line\">594</div><div class=\"line\">595</div><div class=\"line\">596</div><div class=\"line\">597</div><div class=\"line\">598</div><div class=\"line\">599</div><div class=\"line\">600</div><div class=\"line\">601</div><div class=\"line\">602</div><div class=\"line\">603</div><div class=\"line\">604</div><div class=\"line\">605</div><div class=\"line\">606</div><div class=\"line\">607</div><div class=\"line\">608</div><div class=\"line\">609</div><div class=\"line\">610</div><div class=\"line\">611</div><div class=\"line\">612</div><div class=\"line\">613</div><div class=\"line\">614</div><div class=\"line\">615</div><div class=\"line\">616</div><div class=\"line\">617</div><div class=\"line\">618</div><div class=\"line\">619</div><div class=\"line\">620</div><div class=\"line\">621</div><div class=\"line\">622</div><div class=\"line\">623</div><div class=\"line\">624</div><div class=\"line\">625</div><div class=\"line\">626</div><div class=\"line\">627</div><div class=\"line\">628</div><div class=\"line\">629</div><div class=\"line\">630</div><div class=\"line\">631</div><div class=\"line\">632</div><div class=\"line\">633</div><div class=\"line\">634</div><div class=\"line\">635</div><div class=\"line\">636</div><div class=\"line\">637</div><div class=\"line\">638</div><div class=\"line\">639</div><div class=\"line\">640</div><div class=\"line\">641</div><div class=\"line\">642</div><div class=\"line\">643</div><div class=\"line\">644</div><div class=\"line\">645</div><div class=\"line\">646</div><div class=\"line\">647</div><div class=\"line\">648</div><div class=\"line\">649</div><div class=\"line\">650</div><div class=\"line\">651</div><div class=\"line\">652</div><div class=\"line\">653</div><div class=\"line\">654</div><div class=\"line\">655</div><div class=\"line\">656</div><div class=\"line\">657</div><div class=\"line\">658</div><div class=\"line\">659</div><div class=\"line\">660</div><div class=\"line\">661</div><div class=\"line\">662</div><div class=\"line\">663</div><div class=\"line\">664</div><div class=\"line\">665</div><div class=\"line\">666</div><div class=\"line\">667</div><div class=\"line\">668</div><div class=\"line\">669</div><div class=\"line\">670</div><div class=\"line\">671</div><div class=\"line\">672</div><div class=\"line\">673</div><div class=\"line\">674</div><div class=\"line\">675</div><div class=\"line\">676</div><div class=\"line\">677</div><div class=\"line\">678</div><div class=\"line\">679</div><div class=\"line\">680</div><div class=\"line\">681</div><div class=\"line\">682</div><div class=\"line\">683</div><div class=\"line\">684</div><div class=\"line\">685</div><div class=\"line\">686</div><div class=\"line\">687</div><div class=\"line\">688</div><div class=\"line\">689</div><div class=\"line\">690</div><div class=\"line\">691</div><div class=\"line\">692</div><div class=\"line\">693</div><div class=\"line\">694</div><div class=\"line\">695</div><div class=\"line\">696</div><div class=\"line\">697</div><div class=\"line\">698</div><div class=\"line\">699</div><div class=\"line\">700</div><div class=\"line\">701</div><div class=\"line\">702</div><div class=\"line\">703</div><div class=\"line\">704</div><div class=\"line\">705</div><div class=\"line\">706</div><div class=\"line\">707</div><div class=\"line\">708</div><div class=\"line\">709</div><div class=\"line\">710</div><div class=\"line\">711</div><div class=\"line\">712</div><div class=\"line\">713</div><div class=\"line\">714</div><div class=\"line\">715</div><div class=\"line\">716</div><div class=\"line\">717</div><div class=\"line\">718</div><div class=\"line\">719</div><div class=\"line\">720</div><div class=\"line\">721</div><div class=\"line\">722</div><div class=\"line\">723</div><div class=\"line\">724</div><div class=\"line\">725</div><div class=\"line\">726</div><div class=\"line\">727</div><div class=\"line\">728</div><div class=\"line\">729</div><div class=\"line\">730</div><div class=\"line\">731</div><div class=\"line\">732</div><div class=\"line\">733</div><div class=\"line\">734</div><div class=\"line\">735</div><div class=\"line\">736</div><div class=\"line\">737</div><div class=\"line\">738</div><div class=\"line\">739</div><div class=\"line\">740</div><div class=\"line\">741</div><div class=\"line\">742</div><div class=\"line\">743</div><div class=\"line\">744</div><div class=\"line\">745</div><div class=\"line\">746</div><div class=\"line\">747</div><div class=\"line\">748</div><div class=\"line\">749</div><div class=\"line\">750</div><div class=\"line\">751</div><div class=\"line\">752</div><div class=\"line\">753</div><div class=\"line\">754</div><div class=\"line\">755</div><div class=\"line\">756</div><div class=\"line\">757</div><div class=\"line\">758</div><div class=\"line\">759</div><div class=\"line\">760</div><div class=\"line\">761</div><div class=\"line\">762</div><div class=\"line\">763</div><div class=\"line\">764</div><div class=\"line\">765</div><div class=\"line\">766</div><div class=\"line\">767</div><div class=\"line\">768</div><div class=\"line\">769</div><div class=\"line\">770</div><div class=\"line\">771</div><div class=\"line\">772</div><div class=\"line\">773</div><div class=\"line\">774</div><div class=\"line\">775</div><div class=\"line\">776</div><div class=\"line\">777</div><div class=\"line\">778</div><div class=\"line\">779</div><div class=\"line\">780</div><div class=\"line\">781</div><div class=\"line\">782</div><div class=\"line\">783</div><div class=\"line\">784</div><div class=\"line\">785</div><div class=\"line\">786</div><div class=\"line\">787</div><div class=\"line\">788</div><div class=\"line\">789</div><div class=\"line\">790</div><div class=\"line\">791</div><div class=\"line\">792</div><div class=\"line\">793</div><div class=\"line\">794</div><div class=\"line\">795</div><div class=\"line\">796</div><div class=\"line\">797</div><div class=\"line\">798</div><div class=\"line\">799</div><div class=\"line\">800</div><div class=\"line\">801</div><div class=\"line\">802</div><div class=\"line\">803</div><div class=\"line\">804</div><div class=\"line\">805</div><div class=\"line\">806</div><div class=\"line\">807</div><div class=\"line\">808</div><div class=\"line\">809</div><div class=\"line\">810</div><div class=\"line\">811</div><div class=\"line\">812</div><div class=\"line\">813</div><div class=\"line\">814</div><div class=\"line\">815</div><div class=\"line\">816</div><div class=\"line\">817</div><div class=\"line\">818</div><div class=\"line\">819</div><div class=\"line\">820</div><div class=\"line\">821</div><div class=\"line\">822</div><div class=\"line\">823</div><div class=\"line\">824</div><div class=\"line\">825</div><div class=\"line\">826</div><div class=\"line\">827</div><div class=\"line\">828</div><div class=\"line\">829</div><div class=\"line\">830</div><div class=\"line\">831</div><div class=\"line\">832</div><div class=\"line\">833</div><div class=\"line\">834</div><div class=\"line\">835</div><div class=\"line\">836</div><div class=\"line\">837</div><div class=\"line\">838</div><div class=\"line\">839</div><div class=\"line\">840</div><div class=\"line\">841</div><div class=\"line\">842</div><div class=\"line\">843</div><div class=\"line\">844</div><div class=\"line\">845</div><div class=\"line\">846</div><div class=\"line\">847</div><div class=\"line\">848</div><div class=\"line\">849</div><div class=\"line\">850</div><div class=\"line\">851</div><div class=\"line\">852</div><div class=\"line\">853</div><div class=\"line\">854</div><div class=\"line\">855</div><div class=\"line\">856</div><div class=\"line\">857</div><div class=\"line\">858</div><div class=\"line\">859</div><div class=\"line\">860</div><div class=\"line\">861</div><div class=\"line\">862</div><div class=\"line\">863</div><div class=\"line\">864</div><div class=\"line\">865</div><div class=\"line\">866</div><div class=\"line\">867</div><div class=\"line\">868</div><div class=\"line\">869</div><div class=\"line\">870</div><div class=\"line\">871</div><div class=\"line\">872</div><div class=\"line\">873</div><div class=\"line\">874</div><div class=\"line\">875</div><div class=\"line\">876</div><div class=\"line\">877</div><div class=\"line\">878</div><div class=\"line\">879</div><div class=\"line\">880</div><div class=\"line\">881</div><div class=\"line\">882</div><div class=\"line\">883</div><div class=\"line\">884</div><div class=\"line\">885</div><div class=\"line\">886</div><div class=\"line\">887</div><div class=\"line\">888</div><div class=\"line\">889</div><div class=\"line\">890</div><div class=\"line\">891</div><div class=\"line\">892</div><div class=\"line\">893</div><div class=\"line\">894</div><div class=\"line\">895</div><div class=\"line\">896</div><div class=\"line\">897</div><div class=\"line\">898</div><div class=\"line\">899</div><div class=\"line\">900</div><div class=\"line\">901</div><div class=\"line\">902</div><div class=\"line\">903</div><div class=\"line\">904</div><div class=\"line\">905</div><div class=\"line\">906</div><div class=\"line\">907</div><div class=\"line\">908</div><div class=\"line\">909</div><div class=\"line\">910</div><div class=\"line\">911</div><div class=\"line\">912</div><div class=\"line\">913</div><div class=\"line\">914</div><div class=\"line\">915</div><div class=\"line\">916</div><div class=\"line\">917</div><div class=\"line\">918</div><div class=\"line\">919</div><div class=\"line\">920</div><div class=\"line\">921</div><div class=\"line\">922</div><div class=\"line\">923</div><div class=\"line\">924</div><div class=\"line\">925</div><div class=\"line\">926</div><div class=\"line\">927</div><div class=\"line\">928</div><div class=\"line\">929</div><div class=\"line\">930</div><div class=\"line\">931</div><div class=\"line\">932</div><div class=\"line\">933</div><div class=\"line\">934</div><div class=\"line\">935</div><div class=\"line\">936</div><div class=\"line\">937</div><div class=\"line\">938</div><div class=\"line\">939</div><div class=\"line\">940</div><div class=\"line\">941</div><div class=\"line\">942</div><div class=\"line\">943</div><div class=\"line\">944</div><div class=\"line\">945</div><div class=\"line\">946</div><div class=\"line\">947</div><div class=\"line\">948</div><div class=\"line\">949</div><div class=\"line\">950</div><div class=\"line\">951</div><div class=\"line\">952</div><div class=\"line\">953</div><div class=\"line\">954</div><div class=\"line\">955</div><div class=\"line\">956</div><div class=\"line\">957</div><div class=\"line\">958</div><div class=\"line\">959</div><div class=\"line\">960</div><div class=\"line\">961</div><div class=\"line\">962</div><div class=\"line\">963</div><div class=\"line\">964</div><div class=\"line\">965</div><div class=\"line\">966</div><div class=\"line\">967</div><div class=\"line\">968</div><div class=\"line\">969</div><div class=\"line\">970</div><div class=\"line\">971</div><div class=\"line\">972</div><div class=\"line\">973</div></pre></td><td class=\"code\"><pre><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Site Information Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># 站点图标啦，直接去 https://realfavicongenerator.net</div><div class=\"line\"># 选项弄好后，下载压缩包，解压复制粘贴</div><div class=\"line\"># 建议放在 hexo-site/source/images/ 里（没有自己建）</div><div class=\"line\"># 这样可以避免更新 NexT 主题的时候遇到麻烦</div><div class=\"line\"># 最后记得要稍微改下文件名，与下面的保持一致</div><div class=\"line\">favicon:</div><div class=\"line\">  small: /images/favicon-16x16</div><div class=\"line\">  medium: /images/favicon-32x32</div><div class=\"line\">  #apple_touch_icon: /images/apple-touch-icon-next.png</div><div class=\"line\">  #safari_pinned_tab: /images/logo.svg</div><div class=\"line\">  #android_manifest: /images/manifest.json</div><div class=\"line\">  #ms_browserconfig: /images/browserconfig.xml</div><div class=\"line\"></div><div class=\"line\"># Set rss to false to disable feed link.</div><div class=\"line\"># Leave rss as empty to use site&apos;s feed link.</div><div class=\"line\"># Set rss to specific value if you have burned your feed already.</div><div class=\"line\">rss:</div><div class=\"line\"></div><div class=\"line\"># 页脚配置</div><div class=\"line\">footer:</div><div class=\"line\">  # Specify the date when the site was setup.</div><div class=\"line\">  # If not defined, current year will be used.</div><div class=\"line\">  # 建站年份</div><div class=\"line\">  since: 2017</div><div class=\"line\"></div><div class=\"line\">  # Icon between year and copyright info.</div><div class=\"line\">  # 年份后面的图标，为 Font Awesome 图标</div><div class=\"line\">  icon: </div><div class=\"line\">    # Icon name in fontawesome, see: https://fontawesome.com/v4.7.0/icons</div><div class=\"line\">    # `heart` is recommended with animation in red (#ff0000).</div><div class=\"line\">    name: heart</div><div class=\"line\">    # If you want to animate the icon, set it to true.</div><div class=\"line\">    # 设置true时开启动画效果</div><div class=\"line\">    animated: true</div><div class=\"line\">    # Change the color of icon, using Hex Code.</div><div class=\"line\">    color: &quot;#ff0000&quot;</div><div class=\"line\"></div><div class=\"line\">  # If not defined, will be used `author` from Hexo main config.</div><div class=\"line\">  # 如果不定义，默认用站点配置文件的 author 名</div><div class=\"line\">  copyright:</div><div class=\"line\">  # -------------------------------------------------------------</div><div class=\"line\">  # Hexo link (Powered by Hexo).</div><div class=\"line\">  # Hexo 的链接</div><div class=\"line\">  powered: true</div><div class=\"line\"></div><div class=\"line\">  theme:</div><div class=\"line\">    # Theme &amp; scheme info link (Theme - NexT.scheme).</div><div class=\"line\">    # 是否支持主题</div><div class=\"line\">    enable: true</div><div class=\"line\">    # Version info of NexT after scheme info (vX.X.X).</div><div class=\"line\">    # 是否显示next的版本</div><div class=\"line\">    version: true</div><div class=\"line\">  # -------------------------------------------------------------</div><div class=\"line\">  # Any custom text can be defined here.</div><div class=\"line\">  # 自定义内容</div><div class=\"line\">  #custom_text: Hosted by &lt;a target=&quot;_blank&quot; rel=&quot;external nofollow&quot; href=&quot;https://pages.coding.me&quot;&gt;&lt;b&gt;Coding Pages&lt;/b&gt;&lt;/a&gt;</div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># SEO Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># Canonical, set a canonical link tag in your hexo, you could use it for your SEO of blog.</div><div class=\"line\"># See: https://support.google.com/webmasters/answer/139066</div><div class=\"line\"># Tips: Before you open this tag, remember set up your URL in hexo _config.yml ( ex. url: http://yourdomain.com )</div><div class=\"line\">canonical: true</div><div class=\"line\"></div><div class=\"line\"># Change headers hierarchy on site-subtitle (will be main site description) and on all post/pages titles for better SEO-optimization.</div><div class=\"line\">seo: false</div><div class=\"line\"></div><div class=\"line\"># If true, will add site-subtitle to index page, added in main hexo config.</div><div class=\"line\"># subtitle: Subtitle</div><div class=\"line\">index_with_subtitle: false</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Menu Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># When running the site in a subdirectory (e.g. domain.tld/blog), remove the leading slash from link value (/archives -&gt; archives).</div><div class=\"line\"># Usage: `Key: /link/ || icon`</div><div class=\"line\"># Key is the name of menu item. If translate for this menu will find in languages - this translate will be loaded; if not - Key name will be used. Key is case-senstive.</div><div class=\"line\"># Value before `||` delimeter is the target link.</div><div class=\"line\"># Value after `||` delimeter is the name of FontAwesome icon. If icon (with or without delimeter) is not specified, question icon will be loaded.</div><div class=\"line\"># 菜单设置 || 菜单图标设置</div><div class=\"line\"># 编辑 ~/blog/themes/next/languages 下的相应文件</div><div class=\"line\"># 比如添加一个“留言”菜单，站点配置文件的 language 是 zh-Hans</div><div class=\"line\"># 则编辑 zh-Hans.yml，在 menu: 项内添加一行 留言: 留言</div><div class=\"line\"># 注意空格，且符号 : 为英文字符！</div><div class=\"line\">menu:</div><div class=\"line\">  home: / || home</div><div class=\"line\">  about: /about/ || user</div><div class=\"line\">  tags: /tags/ || tags</div><div class=\"line\">  categories: /categories/ || th</div><div class=\"line\">  archives: /archives/ || archive</div><div class=\"line\">  #schedule: /schedule/ || calendar</div><div class=\"line\">  #sitemap: /sitemap.xml || sitemap</div><div class=\"line\">  #commonweal: /404/ || heartbeat</div><div class=\"line\"></div><div class=\"line\"># Enable/Disable menu icons / item badges.</div><div class=\"line\"># 是否开启菜单图标</div><div class=\"line\">menu_settings:</div><div class=\"line\">  icons: true</div><div class=\"line\">  badges: false</div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Scheme Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># Schemes</div><div class=\"line\"># 设计板式，都长啥样，去 README 里面的链接里看看</div><div class=\"line\">#scheme: Muse</div><div class=\"line\">scheme: Mist</div><div class=\"line\">#scheme: Pisces</div><div class=\"line\">#scheme: Gemini</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Sidebar Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># Posts / Categories / Tags in sidebar.</div><div class=\"line\">site_state: true</div><div class=\"line\"></div><div class=\"line\"># 侧栏社交链接设置，与上面菜单差不多，要生效记得把前面的 # 去掉</div><div class=\"line\"># Social Links.</div><div class=\"line\"># Usage: `Key: permalink || icon`</div><div class=\"line\"># Key is the link label showing to end users.</div><div class=\"line\"># Value before `||` delimeter is the target permalink.</div><div class=\"line\"># Value after `||` delimeter is the name of FontAwesome icon. If icon (with or without delimeter) is not specified, globe icon will be loaded.</div><div class=\"line\">social:</div><div class=\"line\">  #GitHub: https://github.com/kevinXiao2016 || github</div><div class=\"line\">  #E-Mail: mailto:yourname@gmail.com || envelope</div><div class=\"line\">  #Google: https://plus.google.com/yourname || google</div><div class=\"line\">  #Twitter: https://twitter.com/yourname || twitter</div><div class=\"line\">  #FB Page: https://www.facebook.com/yourname || facebook</div><div class=\"line\">  #VK Group: https://vk.com/yourname || vk</div><div class=\"line\">  #StackOverflow: https://stackoverflow.com/yourname || stack-overflow</div><div class=\"line\">  #YouTube: https://youtube.com/yourname || youtube</div><div class=\"line\">  #Instagram: https://instagram.com/yourname || instagram</div><div class=\"line\">  #Skype: skype:yourname?call|chat || skype</div><div class=\"line\"></div><div class=\"line\"># 侧栏社交链接图标设置</div><div class=\"line\">social_icons:</div><div class=\"line\">  enable: true</div><div class=\"line\">  icons_only: false</div><div class=\"line\">  transition: false</div><div class=\"line\">  # Dependencies: exturl: true in Tags Settings section below.</div><div class=\"line\">  # To encrypt links above use https://www.base64encode.org</div><div class=\"line\">  # Example encoded link: `GitHub: aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQ= || github`</div><div class=\"line\">  exturl: false</div><div class=\"line\"></div><div class=\"line\"># Follow me on GitHub banner in right-top corner.</div><div class=\"line\"># Usage: `permalink || title`</div><div class=\"line\"># Value before `||` delimeter is the target permalink.</div><div class=\"line\"># Value after `||` delimeter is the title and aria-label name.</div><div class=\"line\">github_banner: https://github.com/kevinXiao2016 || Follow me on GitHub</div><div class=\"line\"></div><div class=\"line\"># Blog rolls</div><div class=\"line\"># 侧栏友链设置</div><div class=\"line\">links_icon: globe</div><div class=\"line\">links_title: 神奇的链接</div><div class=\"line\">links_layout: block</div><div class=\"line\">#links_layout: inline</div><div class=\"line\">links:</div><div class=\"line\">  EMS规范: http://ems.top-vision.cn:8110/dm/dm.html</div><div class=\"line\">  #网易云音乐 : https://music.163.com/#/user/home?id=86590096</div><div class=\"line\">  #Coldplay Official Website: http://coldplay.com/</div><div class=\"line\">  #获取 Elon Musk 的新闻: https://elonmusknews.org/</div><div class=\"line\">  #尼古拉·特斯拉：发明了现代世界的人: http://www.bilibili.com/video/av6211226/</div><div class=\"line\">  #关于此博客: https://reuixiy.github.io/about/</div><div class=\"line\"></div><div class=\"line\"># Sidebar Avatar</div><div class=\"line\"># in theme directory(source/images): /images/avatar.gif</div><div class=\"line\"># in site  directory(source/uploads): /uploads/avatar.gif</div><div class=\"line\"># 侧栏头像设置</div><div class=\"line\"># 建议放在 hexo-site/source/uploads/ 里（没有自己建）</div><div class=\"line\"># 这样可以避免更新 NexT 主题的时候遇到麻烦</div><div class=\"line\">avatar: /images/avatar.png</div><div class=\"line\"></div><div class=\"line\"># Table Of Contents in the Sidebar</div><div class=\"line\"># 侧栏文章目录设置（前提是 Markdown 书写正确）</div><div class=\"line\">toc:</div><div class=\"line\">  enable: true</div><div class=\"line\"></div><div class=\"line\">  # Automatically add list number to toc.</div><div class=\"line\">  # 自动加数字序号</div><div class=\"line\">  number: false</div><div class=\"line\"></div><div class=\"line\">  # If true, all words will placed on next lines if header width longer then sidebar width.</div><div class=\"line\">  # 如果标题太长，则放到下一行继续显示</div><div class=\"line\">  wrap: false</div><div class=\"line\"></div><div class=\"line\"># Creative Commons 4.0 International License.</div><div class=\"line\"># http://creativecommons.org/</div><div class=\"line\"># Available: by | by-nc | by-nc-nd | by-nc-sa | by-nd | by-sa | zero</div><div class=\"line\">#creative_commons: by-nc-sa</div><div class=\"line\">#creative_commons:</div><div class=\"line\"></div><div class=\"line\">sidebar:</div><div class=\"line\">  # Sidebar Position, available value: left | right (only for Pisces | Gemini).</div><div class=\"line\">  # 侧栏位置设置，可用值：左 | 右（只对 Pisces 和 Gemini 设计版式有效！）</div><div class=\"line\">  position: left</div><div class=\"line\">  #position: right</div><div class=\"line\">  </div><div class=\"line\">  # 侧栏显示方式</div><div class=\"line\">  # Sidebar Display, available value (only for Muse | Mist):</div><div class=\"line\">  #  - post    expand on posts automatically. Default.</div><div class=\"line\">  #  - always  expand for all pages automatically</div><div class=\"line\">  #  - hide    expand only when click on the sidebar toggle icon.</div><div class=\"line\">  #  - remove  Totally remove sidebar including sidebar toggle.</div><div class=\"line\">  display: post</div><div class=\"line\">  #display: always</div><div class=\"line\">  #display: hide</div><div class=\"line\">  #display: remove</div><div class=\"line\"></div><div class=\"line\">  # Sidebar offset from top menubar in pixels (only for Pisces | Gemini).</div><div class=\"line\">  # 只对 Pisces 和 Gemini 设计版式有效！</div><div class=\"line\">  offset: 12</div><div class=\"line\"></div><div class=\"line\">  # Back to top in sidebar (only for Pisces | Gemini).</div><div class=\"line\">  # 只对 Pisces 和 Gemini 设计版式有效！</div><div class=\"line\">  b2t: false</div><div class=\"line\"></div><div class=\"line\">  # Scroll percent label in b2t button.</div><div class=\"line\">  scrollpercent: true</div><div class=\"line\"></div><div class=\"line\">  # Enable sidebar on narrow view (only for Muse | Mist).</div><div class=\"line\">  # 移动端显示侧栏，只对 Muse 和 Mist 设计版式有效！</div><div class=\"line\">  onmobile: true</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Post Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># Automatically scroll page to section which is under &lt;!-- more --&gt; mark.</div><div class=\"line\"># 点击 [Read More]，页面自动滚动到 &lt;!-- more --&gt; 标记处</div><div class=\"line\">scroll_to_more: false</div><div class=\"line\"></div><div class=\"line\"># Automatically saving scroll position on each post/page in cookies.</div><div class=\"line\"># 用 cookies 保存浏览的位置信息，意味着重新打开这个页面后</div><div class=\"line\"># 页面就会自动滚动到上次的位置，除非读者清理浏览器 cookies</div><div class=\"line\">save_scroll: false</div><div class=\"line\"></div><div class=\"line\"># Automatically excerpt description in homepage as preamble text.</div><div class=\"line\"># 将每篇文章 Front-matter 里 description 的文字作为页面显示的文章摘要</div><div class=\"line\">excerpt_description: true</div><div class=\"line\"></div><div class=\"line\"># Automatically Excerpt. Not recommend.</div><div class=\"line\"># Please use &lt;!-- more --&gt; in the post to control excerpt accurately.</div><div class=\"line\"># 按字数自动加入 [Read More]，不建议！</div><div class=\"line\"># 建议在文章中加入 &lt;!-- more --&gt;</div><div class=\"line\"># 自定义 [Read More] 按钮之前要显示的内容！</div><div class=\"line\">auto_excerpt:</div><div class=\"line\">  enable: false</div><div class=\"line\">  length: 150</div><div class=\"line\"></div><div class=\"line\"># Post meta display settings</div><div class=\"line\"># 文章顶部显示的文章元数据设置</div><div class=\"line\">post_meta:</div><div class=\"line\">  item_text: true</div><div class=\"line\">  created_at: true</div><div class=\"line\">  updated_at: false</div><div class=\"line\">  # Only show &apos;updated&apos; if different from &apos;created&apos;.</div><div class=\"line\">  updated_diff: false</div><div class=\"line\">  categories: true</div><div class=\"line\"></div><div class=\"line\"># Post wordcount display settings</div><div class=\"line\"># Dependencies: https://github.com/theme-next/hexo-symbols-count-time</div><div class=\"line\"># 显示统计字数和估计阅读时长</div><div class=\"line\"># 注意：这个要安装插件，先进入站点文件夹根目录</div><div class=\"line\"># 然后：npm install hexo-symbols-count-time --save</div><div class=\"line\">symbols_count_time:</div><div class=\"line\">  separated_meta: true</div><div class=\"line\">  item_text_post: true</div><div class=\"line\">  item_text_total: false</div><div class=\"line\">  awl: 5</div><div class=\"line\">  wpm: 200</div><div class=\"line\"></div><div class=\"line\"># Manual define the border radius in codeblock</div><div class=\"line\"># Leave it empty for the default 1</div><div class=\"line\">codeblock:</div><div class=\"line\">  border_radius: </div><div class=\"line\"></div><div class=\"line\"># Wechat Subscriber</div><div class=\"line\">#wechat_subscriber:</div><div class=\"line\">  #enabled: true</div><div class=\"line\">  #qcode: /path/to/your/wechatqcode ex. /uploads/wechat-qcode.jpg</div><div class=\"line\">  #description: ex. subscribe to my blog by scanning my public wechat account</div><div class=\"line\"></div><div class=\"line\"># Reward</div><div class=\"line\">reward_comment: 坚持原创技术分享，您的支持将鼓励我继续创作！</div><div class=\"line\">wechatpay: /images/wechat-reward-image.jpg</div><div class=\"line\">alipay: /images/alipay-reward-image.jpg</div><div class=\"line\">#bitcoin: /images/bitcoin.png</div><div class=\"line\"></div><div class=\"line\"># Related popular posts</div><div class=\"line\"># Dependencies: https://github.com/tea3/hexo-related-popular-posts</div><div class=\"line\">related_posts:</div><div class=\"line\">  enable: false</div><div class=\"line\">  title: # custom header, leave empty to use the default one</div><div class=\"line\">  display_in_home: false</div><div class=\"line\">  params:</div><div class=\"line\">    maxCount: 5</div><div class=\"line\">    #PPMixingRate: 0.0</div><div class=\"line\">    #isDate: false</div><div class=\"line\">    #isImage: false</div><div class=\"line\">    #isExcerpt: false</div><div class=\"line\"></div><div class=\"line\"># Declare license on posts</div><div class=\"line\">post_copyright:</div><div class=\"line\">  enable: false</div><div class=\"line\">  license: &lt;a href=&quot;https://creativecommons.org/licenses/by-nc-sa/4.0/&quot; rel=&quot;external nofollow&quot; target=&quot;_blank&quot;&gt;CC BY-NC-SA 4.0&lt;/a&gt;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Misc Theme Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># Reduce padding / margin indents on devices with narrow width.</div><div class=\"line\"># 移动端把页面两边留白去除，个人不建议</div><div class=\"line\">mobile_layout_economy: false</div><div class=\"line\"></div><div class=\"line\"># Android Chrome header panel color ($brand-bg / $headband-bg =&gt; $black-deep).</div><div class=\"line\"># Android 上 Chrome 浏览器顶部颜色设置</div><div class=\"line\">android_chrome_color: &quot;#222&quot;</div><div class=\"line\"></div><div class=\"line\"># Custom Logo.</div><div class=\"line\"># !!Only available for Default Scheme currently.</div><div class=\"line\"># Options:</div><div class=\"line\">#   enabled: [true/false] - Replace with specific image</div><div class=\"line\">#   image: url-of-image   - Images&apos;s url</div><div class=\"line\">custom_logo:</div><div class=\"line\">  enabled: false</div><div class=\"line\">  image:</div><div class=\"line\"></div><div class=\"line\"># Code Highlight theme</div><div class=\"line\"># Available values: normal | night | night eighties | night blue | night bright</div><div class=\"line\"># https://github.com/chriskempson/tomorrow-theme</div><div class=\"line\"># 代码高亮主题设置</div><div class=\"line\"># 都长啥样自己点开上面的链接查看</div><div class=\"line\">highlight_theme: normal</div><div class=\"line\"></div><div class=\"line\"># Enable &quot;cheers&quot; for archive page.</div><div class=\"line\">cheers_enabled: true</div><div class=\"line\"></div><div class=\"line\"># Manual define the max content width</div><div class=\"line\"># !!Only available for Gemini Scheme currently</div><div class=\"line\"># Leave it empty for the default 75% (suggest not less than 1000px)</div><div class=\"line\">#max_content_width: 1000px</div><div class=\"line\"></div><div class=\"line\"># Manual define the sidebar width</div><div class=\"line\"># !!Only available for Gemini Scheme currently</div><div class=\"line\"># Leave it empty for the default 240</div><div class=\"line\">sidebar_width:</div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Font Settings</div><div class=\"line\"># - Find fonts on Google Fonts (https://www.google.com/fonts)</div><div class=\"line\"># - All fonts set here will have the following styles:</div><div class=\"line\">#     light, light italic, normal, normal italic, bold, bold italic</div><div class=\"line\"># - Be aware that setting too much fonts will cause site running slowly</div><div class=\"line\"># - Introduce in 5.0.1</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># CAUTION! Safari Version 10.1.2 bug: https://github.com/iissnan/hexo-theme-next/issues/1844</div><div class=\"line\"># To avoid space between header and sidebar in Pisces / Gemini themes recommended to use Web Safe fonts for `global` (and `logo`):</div><div class=\"line\"># Arial | Tahoma | Helvetica | Times New Roman | Courier New | Verdana | Georgia | Palatino | Garamond | Comic Sans MS | Trebuchet MS</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># 字体设置</div><div class=\"line\">font:</div><div class=\"line\">  enable: false</div><div class=\"line\"></div><div class=\"line\">  # Uri of fonts host. E.g. //fonts.googleapis.com (Default).</div><div class=\"line\">  host:</div><div class=\"line\"></div><div class=\"line\">  # Font options:</div><div class=\"line\">  # `external: true` will load this font family from `host` above.</div><div class=\"line\">  # `family: Times New Roman`. Without any quotes.</div><div class=\"line\">  # `size: xx`. Use `px` as unit.</div><div class=\"line\"></div><div class=\"line\">  # Global font settings used for all elements in &lt;body&gt;.</div><div class=\"line\">  global:</div><div class=\"line\">    external: true</div><div class=\"line\">    family: Lato</div><div class=\"line\">    size:</div><div class=\"line\"></div><div class=\"line\">  # Font settings for Headlines (H1, H2, H3, H4, H5, H6).</div><div class=\"line\">  # Fallback to `global` font settings.</div><div class=\"line\">  headings:</div><div class=\"line\">    external: true</div><div class=\"line\">    family:</div><div class=\"line\">    size:</div><div class=\"line\"></div><div class=\"line\">  # Font settings for posts.</div><div class=\"line\">  # Fallback to `global` font settings.</div><div class=\"line\">  posts:</div><div class=\"line\">    external: true</div><div class=\"line\">    family:</div><div class=\"line\"></div><div class=\"line\">  # Font settings for Logo.</div><div class=\"line\">  # Fallback to `global` font settings.</div><div class=\"line\">  logo:</div><div class=\"line\">    external: true</div><div class=\"line\">    family:</div><div class=\"line\">    size:</div><div class=\"line\"></div><div class=\"line\">  # Font settings for &lt;code&gt; and code blocks.</div><div class=\"line\">  codes:</div><div class=\"line\">    external: true</div><div class=\"line\">    family:</div><div class=\"line\">    size:</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Third Party Services Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># Math Equations Render Support</div><div class=\"line\">math:</div><div class=\"line\">  enable: false</div><div class=\"line\"></div><div class=\"line\">  # Default(true) will load mathjax/katex script on demand</div><div class=\"line\">  # That is it only render those page who has &apos;mathjax: true&apos; in Front Matter.</div><div class=\"line\">  # If you set it to false, it will load mathjax/katex srcipt EVERY PAGE.</div><div class=\"line\">  per_page: true</div><div class=\"line\"></div><div class=\"line\">  engine: mathjax</div><div class=\"line\">  #engine: katex</div><div class=\"line\"></div><div class=\"line\">  # hexo-rendering-pandoc (or hexo-renderer-kramed) needed to full MathJax support.</div><div class=\"line\">  mathjax:</div><div class=\"line\">    # Use 2.7.1 as default, jsdelivr as default CDN, works everywhere even in China</div><div class=\"line\">    cdn: //cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML</div><div class=\"line\">    # For newMathJax CDN (cdnjs.cloudflare.com) with fallback to oldMathJax (cdn.mathjax.org).</div><div class=\"line\">    #cdn: //cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML</div><div class=\"line\">    # For direct link to MathJax.js with CloudFlare CDN (cdnjs.cloudflare.com).</div><div class=\"line\">    #cdn: //cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML</div><div class=\"line\">    # For automatic detect latest version link to MathJax.js and get from Bootcss.</div><div class=\"line\">    #cdn: //cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML</div><div class=\"line\"></div><div class=\"line\">  # hexo-renderer-markdown-it-plus (or hexo-renderer-markdown-it with markdown-it-katex plugin)</div><div class=\"line\">  # needed to full Katex support.</div><div class=\"line\">  katex:</div><div class=\"line\">    # Use 0.7.1 as default, jsdelivr as default CDN, works everywhere even in China</div><div class=\"line\">    cdn: //cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css</div><div class=\"line\">    # CDNJS, provided by cloudflare, maybe the best CDN, but not works in China</div><div class=\"line\">    #cdn: //cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css</div><div class=\"line\">    # Bootcss, works great in China, but not so well in other region</div><div class=\"line\">    #cdn: //cdn.bootcss.com/KaTeX/0.7.1/katex.min.css</div><div class=\"line\"></div><div class=\"line\"># Han Support</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-han</div><div class=\"line\"># 汉字标准格式，没用过暂时不了解</div><div class=\"line\">han: false</div><div class=\"line\"></div><div class=\"line\"># Pangu Support</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-pangu</div><div class=\"line\"># For more information: https://github.com/vinta/pangu.js</div><div class=\"line\">pangu: false</div><div class=\"line\"></div><div class=\"line\"># Swiftype Search API Key</div><div class=\"line\">#swiftype_key:</div><div class=\"line\"></div><div class=\"line\"># Baidu Analytics ID</div><div class=\"line\">#baidu_analytics:</div><div class=\"line\"></div><div class=\"line\"># Disqus</div><div class=\"line\">disqus:</div><div class=\"line\">  enable: false</div><div class=\"line\">  shortname:</div><div class=\"line\">  count: true</div><div class=\"line\">  lazyload: false</div><div class=\"line\"></div><div class=\"line\"># Hypercomments</div><div class=\"line\">#hypercomments_id:</div><div class=\"line\"></div><div class=\"line\"># changyan</div><div class=\"line\">changyan:</div><div class=\"line\">  enable: false</div><div class=\"line\">  appid:</div><div class=\"line\">  appkey:</div><div class=\"line\"></div><div class=\"line\"># leanCloud支持的评论插件</div><div class=\"line\"># Valine. </div><div class=\"line\"># You can get your appid and appkey from https://leancloud.cn</div><div class=\"line\"># more info please open https://valine.js.org</div><div class=\"line\">valine:</div><div class=\"line\">  enable: false</div><div class=\"line\">  appid:  P08Jh3wwb2zPhfm9puCevcUa-*******</div><div class=\"line\">  appkey:  CnhNSWBKT3kwj52v********</div><div class=\"line\">  notify: false # mail notifier , https://github.com/xCss/Valine/wiki</div><div class=\"line\">  verify: false # Verification code</div><div class=\"line\">  placeholder: Just go go # comment box placeholder</div><div class=\"line\">  avatar: mm # gravatar style</div><div class=\"line\">  guest_info: nick,mail,link # custom comment header</div><div class=\"line\">  pageSize: 10 # pagination size</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># Support for youyan comments system.</div><div class=\"line\"># You can get your uid from http://www.uyan.cc</div><div class=\"line\">#youyan_uid: your uid</div><div class=\"line\"></div><div class=\"line\"># Support for LiveRe comments system.</div><div class=\"line\"># You can get your uid from https://livere.com/insight/myCode (General web site)</div><div class=\"line\">livere_uid: MTAyMC8yODQwNi******</div><div class=\"line\"></div><div class=\"line\"># Gitment</div><div class=\"line\"># Introduction: https://imsun.net/posts/gitment-introduction/</div><div class=\"line\">gitment:</div><div class=\"line\">  enable: false</div><div class=\"line\">  mint: true # RECOMMEND, A mint on Gitment, to support count, language and proxy_gateway</div><div class=\"line\">  count: true # Show comments count in post meta area</div><div class=\"line\">  lazy: false # Comments lazy loading with a button</div><div class=\"line\">  cleanly: false # Hide &apos;Powered by ...&apos; on footer, and more</div><div class=\"line\">  language: # Force language, or auto switch by theme</div><div class=\"line\">  github_user: # MUST HAVE, Your Github Username</div><div class=\"line\">  github_repo: # MUST HAVE, The name of the repo you use to store Gitment comments</div><div class=\"line\">  client_id: # MUST HAVE, Github client id for the Gitment</div><div class=\"line\">  client_secret: # EITHER this or proxy_gateway, Github access secret token for the Gitment</div><div class=\"line\">  proxy_gateway: # Address of api proxy, See: https://github.com/aimingoo/intersect</div><div class=\"line\">  redirect_protocol: # Protocol of redirect_uri with force_redirect_protocol when mint enabled</div><div class=\"line\"></div><div class=\"line\"># Baidu Share</div><div class=\"line\"># Available value:</div><div class=\"line\">#    button | slide</div><div class=\"line\"># Warning: Baidu Share does not support https.</div><div class=\"line\">#baidushare:</div><div class=\"line\">##  type: button</div><div class=\"line\"></div><div class=\"line\"># Share</div><div class=\"line\"># This plugin is more useful in China, make sure you known how to use it.</div><div class=\"line\"># And you can find the use guide at official webiste: http://www.jiathis.com/.</div><div class=\"line\"># Warning: JiaThis does not support https.</div><div class=\"line\">#jiathis:</div><div class=\"line\">  ##uid: Get this uid from http://www.jiathis.com/</div><div class=\"line\"></div><div class=\"line\">#add_this_id:</div><div class=\"line\"></div><div class=\"line\"># NeedMoreShare2</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-needmoreshare2</div><div class=\"line\"># See: https://github.com/revir/need-more-share2</div><div class=\"line\"># Also see: https://github.com/DzmVasileusky/needShareButton</div><div class=\"line\"># iconStyle: default | box</div><div class=\"line\"># boxForm: horizontal | vertical</div><div class=\"line\"># position: top / middle / bottom + Left / Center / Right</div><div class=\"line\"># networks: Weibo,Wechat,Douban,QQZone,Twitter,Linkedin,Mailto,Reddit,</div><div class=\"line\">#           Delicious,StumbleUpon,Pinterest,Facebook,GooglePlus,Slashdot,</div><div class=\"line\">#           Technorati,Posterous,Tumblr,GoogleBookmarks,Newsvine,</div><div class=\"line\">#           Evernote,Friendfeed,Vkontakte,Odnoklassniki,Mailru</div><div class=\"line\">needmoreshare2:</div><div class=\"line\">  enable: false</div><div class=\"line\">  postbottom:</div><div class=\"line\">    enable: false</div><div class=\"line\">    options:</div><div class=\"line\">      iconStyle: box</div><div class=\"line\">      boxForm: horizontal</div><div class=\"line\">      position: bottomCenter</div><div class=\"line\">      networks: Weibo,Wechat,Douban,QQZone,Twitter,Facebook</div><div class=\"line\">  float:</div><div class=\"line\">    enable: false</div><div class=\"line\">    options:</div><div class=\"line\">      iconStyle: box</div><div class=\"line\">      boxForm: horizontal</div><div class=\"line\">      position: middleRight</div><div class=\"line\">      networks: Weibo,Wechat,Douban,QQZone,Twitter,Facebook</div><div class=\"line\"></div><div class=\"line\"># Google Webmaster tools verification setting</div><div class=\"line\"># See: https://www.google.com/webmasters/</div><div class=\"line\">#google_site_verification:</div><div class=\"line\"></div><div class=\"line\"># Google Analytics</div><div class=\"line\">#google_analytics:</div><div class=\"line\"></div><div class=\"line\"># Bing Webmaster tools verification setting</div><div class=\"line\"># See: https://www.bing.com/webmaster/</div><div class=\"line\">#bing_site_verification:</div><div class=\"line\"></div><div class=\"line\"># Yandex Webmaster tools verification setting</div><div class=\"line\"># See: https://webmaster.yandex.ru/</div><div class=\"line\">#yandex_site_verification:</div><div class=\"line\"></div><div class=\"line\"># CNZZ count</div><div class=\"line\">#cnzz_siteid:</div><div class=\"line\"></div><div class=\"line\"># Application Insights</div><div class=\"line\"># See https://azure.microsoft.com/en-us/services/application-insights/</div><div class=\"line\"># application_insights:</div><div class=\"line\"></div><div class=\"line\"># Post widgets &amp; FB/VK comments settings.</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Facebook SDK Support.</div><div class=\"line\"># https://github.com/iissnan/hexo-theme-next/pull/410</div><div class=\"line\">facebook_sdk:</div><div class=\"line\">  enable:       false</div><div class=\"line\">  app_id:       #&lt;app_id&gt;</div><div class=\"line\">  fb_admin:     #&lt;user_id&gt;</div><div class=\"line\">  like_button:  #true</div><div class=\"line\">  webmaster:    #true</div><div class=\"line\"></div><div class=\"line\"># Facebook comments plugin</div><div class=\"line\"># This plugin depends on Facebook SDK.</div><div class=\"line\"># If facebook_sdk.enable is false, Facebook comments plugin is unavailable.</div><div class=\"line\">facebook_comments_plugin:</div><div class=\"line\">  enable:       false</div><div class=\"line\">  num_of_posts: 10    # min posts num is 1</div><div class=\"line\">  width:        100%  # default width is 550px</div><div class=\"line\">  scheme:       light # default scheme is light (light or dark)</div><div class=\"line\"></div><div class=\"line\"># VKontakte API Support.</div><div class=\"line\"># To get your AppID visit https://vk.com/editapp?act=create</div><div class=\"line\">vkontakte_api:</div><div class=\"line\">  enable:       false</div><div class=\"line\">  app_id:       #&lt;app_id&gt;</div><div class=\"line\">  like:         true</div><div class=\"line\">  comments:     true</div><div class=\"line\">  num_of_posts: 10</div><div class=\"line\"></div><div class=\"line\"># Star rating support to each article.</div><div class=\"line\"># To get your ID visit https://widgetpack.com</div><div class=\"line\">rating:</div><div class=\"line\">  enable: false</div><div class=\"line\">  id:     #&lt;app_id&gt;</div><div class=\"line\">  color:  fc6423</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># Show number of visitors to each article.</div><div class=\"line\"># You can visit https://leancloud.cn get AppID and AppKey.</div><div class=\"line\">leancloud_visitors:</div><div class=\"line\">  enable: false</div><div class=\"line\">  app_id: P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz</div><div class=\"line\">  app_key: CnhNSWBKT3kwj52vyJ36armb</div><div class=\"line\">  # Dependencies: https://github.com/theme-next/hexo-leancloud-counter-security</div><div class=\"line\">  # If you don&apos;t care about security in lc counter and just want to use it directly</div><div class=\"line\">  # (without hexo-leancloud-counter-security plugin), set the `security` to `false`.</div><div class=\"line\">  security: true</div><div class=\"line\">  betterPerformance: false</div><div class=\"line\"></div><div class=\"line\"># Another tool to show number of visitors to each article.</div><div class=\"line\"># visit https://console.firebase.google.com/u/0/ to get apiKey and projectId</div><div class=\"line\"># visit https://firebase.google.com/docs/firestore/ to get more information about firestore</div><div class=\"line\">firestore:</div><div class=\"line\">  enable: false</div><div class=\"line\">  collection: articles #required, a string collection name to access firestore database</div><div class=\"line\">  apiKey: #required</div><div class=\"line\">  projectId: #required</div><div class=\"line\">  bluebird: false #enable this if you want to include bluebird 3.5.1(core version) Promise polyfill</div><div class=\"line\"></div><div class=\"line\"># Show Views/Visitors of the website/page with busuanzi.</div><div class=\"line\"># Get more information on http://ibruce.info/2015/04/04/busuanzi/</div><div class=\"line\">busuanzi_count:</div><div class=\"line\">  enable: true</div><div class=\"line\">  total_visitors: true</div><div class=\"line\">  total_visitors_icon: user</div><div class=\"line\">  total_views: true</div><div class=\"line\">  total_views_icon: eye</div><div class=\"line\">  post_views: true</div><div class=\"line\">  post_views_icon: eye</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># Tencent analytics ID</div><div class=\"line\"># tencent_analytics:</div><div class=\"line\"></div><div class=\"line\"># Tencent MTA ID</div><div class=\"line\"># tencent_mta:</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># Enable baidu push so that the blog will push the url to baidu automatically which is very helpful for SEO</div><div class=\"line\">baidu_push: false</div><div class=\"line\"></div><div class=\"line\"># Google Calendar</div><div class=\"line\"># Share your recent schedule to others via calendar page</div><div class=\"line\">#</div><div class=\"line\"># API Documentation:</div><div class=\"line\"># https://developers.google.com/google-apps/calendar/v3/reference/events/list</div><div class=\"line\">calendar:</div><div class=\"line\">  enable: false</div><div class=\"line\">  calendar_id: &lt;required&gt;</div><div class=\"line\">  api_key: &lt;required&gt;</div><div class=\"line\">  orderBy: startTime</div><div class=\"line\">  offsetMax: 24</div><div class=\"line\">  offsetMin: 4</div><div class=\"line\">  timeZone:</div><div class=\"line\">  showDeleted: false</div><div class=\"line\">  singleEvents: true</div><div class=\"line\">  maxResults: 250</div><div class=\"line\"></div><div class=\"line\"># Algolia Search</div><div class=\"line\"># See: https://github.com/theme-next/hexo-theme-next/blob/master/docs/ALGOLIA-SEARCH.md</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-algolia-instant-search</div><div class=\"line\">algolia_search:</div><div class=\"line\">  enable: false</div><div class=\"line\">  hits:</div><div class=\"line\">    per_page: 10</div><div class=\"line\">  labels:</div><div class=\"line\">    input_placeholder: Search for Posts</div><div class=\"line\">    hits_empty: &quot;We didn&apos;t find any results for the search: $&#123;query&#125;&quot;</div><div class=\"line\">    hits_stats: &quot;$&#123;hits&#125; results found in $&#123;time&#125; ms&quot;</div><div class=\"line\"></div><div class=\"line\"># Local search</div><div class=\"line\"># Dependencies: https://github.com/theme-next/hexo-generator-searchdb</div><div class=\"line\"># 要安装插件才能使用，先进入站点文件夹根目录</div><div class=\"line\">#  然后：npm install hexo-generator-searchdb --save</div><div class=\"line\">local_search:</div><div class=\"line\">  enable: true</div><div class=\"line\">  # if auto, trigger search by changing input</div><div class=\"line\">  # if manual, trigger search by pressing enter key or search button</div><div class=\"line\">  trigger: auto</div><div class=\"line\">  # show top n results per article, show all results by setting to -1</div><div class=\"line\">  top_n_per_article: 1</div><div class=\"line\">  # unescape html strings to the readable one</div><div class=\"line\">  unescape: false</div><div class=\"line\"></div><div class=\"line\"># Bookmark Support</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-bookmark</div><div class=\"line\">bookmark:</div><div class=\"line\">  enable: false</div><div class=\"line\">  # if auto</div><div class=\"line\">  #   - save the reading position when closing the page</div><div class=\"line\">  #   - or clicking the bookmark-icon</div><div class=\"line\">  # if manual, only save it by clicking the bookmark-icon</div><div class=\"line\">  save: auto</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Tags Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># External URL with BASE64 encrypt &amp; decrypt.</div><div class=\"line\"># Usage: &#123;% exturl text url &quot;title&quot; %&#125;</div><div class=\"line\"># Alias: &#123;% extlink text url &quot;title&quot; %&#125;</div><div class=\"line\"># 用法见：</div><div class=\"line\"># https://github.com/iissnan/hexo-theme-next/pull/1438</div><div class=\"line\">exturl: false</div><div class=\"line\"></div><div class=\"line\"># 主题的标签样式，有 note、label、tabs 三种</div><div class=\"line\"># Note tag (bs-callout).</div><div class=\"line\">note:</div><div class=\"line\">  # Note tag style values:</div><div class=\"line\">  #  - simple    bs-callout old alert style. Default.</div><div class=\"line\">  #  - modern    bs-callout new (v2-v3) alert style.</div><div class=\"line\">  #  - flat      flat callout style with background, like on Mozilla or StackOverflow.</div><div class=\"line\">  #  - disabled  disable all CSS styles import of note tag.</div><div class=\"line\">  style: simple</div><div class=\"line\">  icons: false</div><div class=\"line\">  border_radius: 3</div><div class=\"line\">  # Offset lighter of background in % for modern and flat styles (modern: -12 | 12; flat: -18 | 6).</div><div class=\"line\">  # Offset also applied to label tag variables. This option can work with disabled note tag.</div><div class=\"line\">  light_bg_offset: 0</div><div class=\"line\"></div><div class=\"line\"># Label tag.</div><div class=\"line\">label: true</div><div class=\"line\"></div><div class=\"line\"># Tabs tag.</div><div class=\"line\">tabs:</div><div class=\"line\">  enable: true</div><div class=\"line\">  transition:</div><div class=\"line\">    tabs: false</div><div class=\"line\">    labels: true</div><div class=\"line\">  border_radius: 0</div><div class=\"line\"></div><div class=\"line\"># Reading progress bar</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-reading-progress</div><div class=\"line\">reading_progress:</div><div class=\"line\">  enable: false</div><div class=\"line\">  color: &quot;#37c6c0&quot;</div><div class=\"line\">  height: 2px</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">#! ---------------------------------------------------------------</div><div class=\"line\">#! DO NOT EDIT THE FOLLOWING SETTINGS</div><div class=\"line\">#! UNLESS YOU KNOW WHAT YOU ARE DOING</div><div class=\"line\">#! ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># 动画</div><div class=\"line\"># Use velocity to animate everything.</div><div class=\"line\">motion:</div><div class=\"line\">  enable: true</div><div class=\"line\">  async: false</div><div class=\"line\">  transition:</div><div class=\"line\">    # Transition variants:</div><div class=\"line\">    # fadeIn | fadeOut | flipXIn | flipXOut | flipYIn | flipYOut | flipBounceXIn | flipBounceXOut | flipBounceYIn | flipBounceYOut</div><div class=\"line\">    # swoopIn | swoopOut | whirlIn | whirlOut | shrinkIn | shrinkOut | expandIn | expandOut</div><div class=\"line\">    # bounceIn | bounceOut | bounceUpIn | bounceUpOut | bounceDownIn | bounceDownOut | bounceLeftIn | bounceLeftOut | bounceRightIn | bounceRightOut</div><div class=\"line\">    # slideUpIn | slideUpOut | slideDownIn | slideDownOut | slideLeftIn | slideLeftOut | slideRightIn | slideRightOut</div><div class=\"line\">    # slideUpBigIn | slideUpBigOut | slideDownBigIn | slideDownBigOut | slideLeftBigIn | slideLeftBigOut | slideRightBigIn | slideRightBigOut</div><div class=\"line\">    # perspectiveUpIn | perspectiveUpOut | perspectiveDownIn | perspectiveDownOut | perspectiveLeftIn | perspectiveLeftOut | perspectiveRightIn | perspectiveRightOut</div><div class=\"line\">    post_block: fadeIn</div><div class=\"line\">    post_header: slideDownIn</div><div class=\"line\">    post_body: slideDownIn</div><div class=\"line\">    coll_header: slideLeftIn</div><div class=\"line\">    # Only for Pisces | Gemini.</div><div class=\"line\">    sidebar: slideUpIn</div><div class=\"line\"></div><div class=\"line\"># Fancybox. There is support for old version 2 and new version 3.</div><div class=\"line\"># Please, choose only any one variant, do not need to install both.</div><div class=\"line\"># For install 2.x: https://github.com/theme-next/theme-next-fancybox</div><div class=\"line\"># For install 3.x: https://github.com/theme-next/theme-next-fancybox3</div><div class=\"line\"># 查看图片的</div><div class=\"line\">fancybox: false</div><div class=\"line\"></div><div class=\"line\"># Added switch option for separated repo in 6.0.0.</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-fastclick</div><div class=\"line\">fastclick: false</div><div class=\"line\"></div><div class=\"line\"># Added switch option for separated repo in 6.0.0.</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-jquery-lazyload</div><div class=\"line\">lazyload: false</div><div class=\"line\"></div><div class=\"line\"># Progress bar in the top during page loading.</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-pace</div><div class=\"line\">pace: false</div><div class=\"line\"># Themes list:</div><div class=\"line\">#pace-theme-big-counter</div><div class=\"line\">#pace-theme-bounce</div><div class=\"line\">#pace-theme-barber-shop</div><div class=\"line\">#pace-theme-center-atom</div><div class=\"line\">#pace-theme-center-circle</div><div class=\"line\">#pace-theme-center-radar</div><div class=\"line\">#pace-theme-center-simple</div><div class=\"line\">#pace-theme-corner-indicator</div><div class=\"line\">#pace-theme-fill-left</div><div class=\"line\">#pace-theme-flash</div><div class=\"line\">#pace-theme-loading-bar</div><div class=\"line\">#pace-theme-mac-osx</div><div class=\"line\">#pace-theme-minimal</div><div class=\"line\"># For example</div><div class=\"line\"># pace_theme: pace-theme-center-simple</div><div class=\"line\">pace_theme: pace-theme-minimal</div><div class=\"line\"></div><div class=\"line\"># Canvas-nest</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-canvas-nest</div><div class=\"line\">canvas_nest: true</div><div class=\"line\"></div><div class=\"line\"># JavaScript 3D library.</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-three</div><div class=\"line\"># three_waves</div><div class=\"line\">three_waves: false</div><div class=\"line\"># canvas_lines</div><div class=\"line\">canvas_lines: false</div><div class=\"line\"># canvas_sphere</div><div class=\"line\">canvas_sphere: false</div><div class=\"line\"></div><div class=\"line\"># Only fit scheme Pisces</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-canvas-ribbon</div><div class=\"line\"># Canvas-ribbon</div><div class=\"line\"># size: The width of the ribbon.</div><div class=\"line\"># alpha: The transparency of the ribbon.</div><div class=\"line\"># zIndex: The display level of the ribbon.</div><div class=\"line\">canvas_ribbon:</div><div class=\"line\">  enable: false</div><div class=\"line\">  size: 300</div><div class=\"line\">  alpha: 0.6</div><div class=\"line\">  zIndex: -1</div><div class=\"line\"></div><div class=\"line\"># Script Vendors.</div><div class=\"line\"># Set a CDN address for the vendor you want to customize.</div><div class=\"line\"># For example</div><div class=\"line\">#    jquery: https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js</div><div class=\"line\"># Be aware that you should use the same version as internal ones to avoid potential problems.</div><div class=\"line\"># Please use the https protocol of CDN files when you enable https on your site.</div><div class=\"line\"># 相关内容用 CDN 地址取代，加速网站访问，注意版本尽可能要一致</div><div class=\"line\">vendors:</div><div class=\"line\">  # Internal path prefix. Please do not edit it.</div><div class=\"line\">  _internal: lib</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 2.1.3</div><div class=\"line\">  jquery:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 2.1.5</div><div class=\"line\">  # See: http://fancyapps.com/fancybox/</div><div class=\"line\">  fancybox:</div><div class=\"line\">  fancybox_css:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 1.0.6</div><div class=\"line\">  # See: https://github.com/ftlabs/fastclick</div><div class=\"line\">  fastclick:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 1.9.7</div><div class=\"line\">  # See: https://github.com/tuupola/jquery_lazyload</div><div class=\"line\">  lazyload:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 1.2.1</div><div class=\"line\">  # See: http://VelocityJS.org</div><div class=\"line\">  velocity:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 1.2.1</div><div class=\"line\">  # See: http://VelocityJS.org</div><div class=\"line\">  velocity_ui:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 0.7.9</div><div class=\"line\">  # See: https://faisalman.github.io/ua-parser-js/</div><div class=\"line\">  ua_parser:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 4.6.2</div><div class=\"line\">  # See: http://fontawesome.io/</div><div class=\"line\">  fontawesome:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 1</div><div class=\"line\">  # https://www.algolia.com</div><div class=\"line\">  algolia_instant_js:</div><div class=\"line\">  algolia_instant_css:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 1.0.2</div><div class=\"line\">  # See: https://github.com/HubSpot/pace</div><div class=\"line\">  # Or use direct links below:</div><div class=\"line\">  # pace: //cdn.bootcss.com/pace/1.0.2/pace.min.js</div><div class=\"line\">  # pace_css: //cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-flash.min.css</div><div class=\"line\">  pace:</div><div class=\"line\">  pace_css:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 1.0.0</div><div class=\"line\">  # https://github.com/hustcc/canvas-nest.js</div><div class=\"line\">  canvas_nest: </div><div class=\"line\"></div><div class=\"line\">  # three</div><div class=\"line\">  three:</div><div class=\"line\"></div><div class=\"line\">  # three_waves</div><div class=\"line\">  # https://github.com/jjandxa/three_waves</div><div class=\"line\">  three_waves:</div><div class=\"line\"></div><div class=\"line\">  # three_waves</div><div class=\"line\">  # https://github.com/jjandxa/canvas_lines</div><div class=\"line\">  canvas_lines:</div><div class=\"line\"></div><div class=\"line\">  # three_waves</div><div class=\"line\">  # https://github.com/jjandxa/canvas_sphere</div><div class=\"line\">  canvas_sphere:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 1.0.0</div><div class=\"line\">  # https://github.com/zproo/canvas-ribbon</div><div class=\"line\">  canvas_ribbon:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 3.3.0</div><div class=\"line\">  # https://github.com/ethantw/Han</div><div class=\"line\">  han:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 3.3.0</div><div class=\"line\">  # https://github.com/vinta/pangu.js</div><div class=\"line\">  pangu:</div><div class=\"line\"></div><div class=\"line\">  # needMoreShare2</div><div class=\"line\">  # https://github.com/revir/need-more-share2</div><div class=\"line\">  needmoreshare2_js:</div><div class=\"line\">  needmoreshare2_css:</div><div class=\"line\"></div><div class=\"line\">  # bookmark</div><div class=\"line\">  # Internal version: 1.0.0</div><div class=\"line\">  # https://github.com/theme-next/theme-next-bookmark</div><div class=\"line\">  bookmark:</div><div class=\"line\"></div><div class=\"line\">  # reading_progress</div><div class=\"line\">  # Internal version: 1.0</div><div class=\"line\">  # https://github.com/theme-next/theme-next-reading-progress</div><div class=\"line\">  # Example: https://cdn.jsdelivr.net/gh/theme-next/theme-next-reading-progress@1.1/reading_progress.min.js</div><div class=\"line\">  reading_progress:</div><div class=\"line\"></div><div class=\"line\">  # valine comment</div><div class=\"line\">  # Example: https://cdn.jsdelivr.net/npm/valine@1.1.8/dist/Valine.min.js</div><div class=\"line\">  valine:</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># Assets</div><div class=\"line\">css: css</div><div class=\"line\">js: js</div><div class=\"line\">images: images</div><div class=\"line\"></div><div class=\"line\"># Theme version</div><div class=\"line\">version: 6.0.6</div></pre></td></tr></table></figure></p>\n<h3 id=\"2-4-动态背景\"><a href=\"#2-4-动态背景\" class=\"headerlink\" title=\"2.4 动态背景\"></a>2.4 动态背景</h3><p>在主题配置文件中，靠后面，改canvas_nest: true，想要更改颜色和数量？修改文件：</p>\n<p>文件位置：~/blog/themes/next/source/lib/canvas-nest/canvas-nest.min.js</p>\n<p>怎么修改？参考<a href=\"https://github.com/hustcc/canvas-nest.js/blob/master/README-zh.md\" target=\"_blank\" rel=\"noopener\">canvas-nest.js</a>。</p>\n<h3 id=\"2-5-注脚\"><a href=\"#2-5-注脚\" class=\"headerlink\" title=\"2.5 注脚\"></a>2.5 注脚</h3><p>参考<a href=\"https://github.com/LouisBarranqueiro/hexo-footnotes\" target=\"_blank\" rel=\"noopener\">hexo-footnotes</a>。</p>\n<h2 id=\"3-优化-高级功能配置\"><a href=\"#3-优化-高级功能配置\" class=\"headerlink\" title=\"3.优化:高级功能配置\"></a>3.优化:高级功能配置</h2><h3 id=\"3-1-大佬们的文章\"><a href=\"#3-1-大佬们的文章\" class=\"headerlink\" title=\"3.1 大佬们的文章\"></a>3.1 大佬们的文章</h3><p>更多如外挂一样的功能配置，就直接贴大佬的文章了，哪些功能自己喜欢，按照大佬的教程来配置就行。不过也有坑，比如有些功能（超链接样式、侧栏头像圆形并旋转）可以直接通过在custom.styl添加 CSS 代码实现，无需更改其它文件！</p>\n<ol>\n<li><a href=\"https://reuixiy.github.io/technology/computer/computer-aided-art/2017/06/09/hexo-next-optimization.html\" target=\"_blank\" rel=\"noopener\">打造个性超赞博客Hexo+NexT+GithubPages的超深度优化</a></li>\n<li><a href=\"http://cherryblog.site/Hexo-high-level-tutorialcloudmusic,bg-customthemes-statistical.html\" target=\"_blank\" rel=\"noopener\">hexo高阶教程next主题优化</a></li>\n<li><a href=\"http://shenzekun.cn/hexo%E7%9A%84next%E4%B8%BB%E9%A2%98%E4%B8%AA%E6%80%A7%E5%8C%96%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B.html\" target=\"_blank\" rel=\"noopener\">hexo的next主题个性化教程:打造炫酷网站</a></li>\n<li><a href=\"http://www.dingxuewen.com/categories/Site/\" target=\"_blank\" rel=\"noopener\">Hexo搭建博客的个性化设置</a></li>\n</ol>\n<h3 id=\"3-2-鼠标点击效果\"><a href=\"#3-2-鼠标点击效果\" class=\"headerlink\" title=\"3.2 鼠标点击效果\"></a>3.2 鼠标点击效果</h3><ol>\n<li>新建mouse.js，复制<a href=\"https://github.com/kevinXiao2016/kevinXiao2016.github.io/blob/hexo/source/love.js\" target=\"_blank\" rel=\"noopener\">love</a>或者<a href=\"https://github.com/kevinXiao2016/kevinXiao2016.github.io/blob/hexo/source/mouse.js\" target=\"_blank\" rel=\"noopener\">富强民主…</a>中的内容到js文件中。</li>\n<li>将mouse.js放到<strong>/themes/next/source/js/src</strong>路径下</li>\n<li><p>打开/themes/next/layout/layout.swig文件，添加如下代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;script type=<span class=\"string\">\"text/javascript\"</span> src=<span class=\"string\">\"/js/src/mouse.js\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"3-3-文章加密\"><a href=\"#3-3-文章加密\" class=\"headerlink\" title=\"3.3 文章加密\"></a>3.3 文章加密</h3><p>参考：<a href=\"https://github.com/MikeCoder/hexo-blog-encrypt/blob/master/ReadMe.zh.md\" target=\"_blank\" rel=\"noopener\">hexo-blog-encrypt</a></p>\n<ol>\n<li><p>在博客根目录下的package.json文件中添加一行代码</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">\"hexo-blog-encrypt\": \"2.0.*\"</div></pre></td></tr></table></figure>\n</li>\n<li><p>在博客根目录下：  <strong>npm install</strong></p>\n</li>\n<li><p>在站点配置文件中配置文章加密</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"># Security</div><div class=\"line\">encrypt:</div><div class=\"line\">    enable: true</div></pre></td></tr></table></figure>\n</li>\n<li><p>然后在你的文章的头部添加上对应的字段，如 password, abstract, message</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">title: hello world</div><div class=\"line\">date: 2016-03-30 21:18:02</div><div class=\"line\">tags:</div><div class=\"line\"><span class=\"code\">    - fdsafsdaf</span></div><div class=\"line\">password: Mike</div><div class=\"line\">abstract: 没点开文章前显示的类容，类似于<span class=\"xml\"><span class=\"comment\">&lt;!--more--&gt;</span></span>之前写的描述.</div><div class=\"line\">message: 点开文章后，提示输入密码的信息.</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"3-4-博客推广及SEO优化\"><a href=\"#3-4-博客推广及SEO优化\" class=\"headerlink\" title=\"3.4 博客推广及SEO优化\"></a>3.4 博客推广及SEO优化</h3><p>建站完成后百度和Google是没有收录我们的网站的，想要搜索到我们的博客非常困难。因此优化搜索非常有必要。</p>\n<p><strong>博客推广</strong></p>\n<p>博客推广第一步，手动推广。</p>\n<p>你可以多浏览别人的博客并留下你的爪印（博客地址），比如 评论 本文；你可以去 <a href=\"https://github.com/iissnan/hexo-theme-next#live-preview\" target=\"_blank\" rel=\"noopener\">README.md</a>中提到的 <a href=\"https://github.com/iissnan/hexo-theme-next/issues/119\" target=\"_blank\" rel=\"noopener\">这个issue</a> 留下你的爪印；你可以去 <a href=\"https://github.com/iissnan/hexo-theme-next/issuess://github.com/iissnan/hexo-theme-next/issues/119\" target=\"_blank\" rel=\"noopener\">Issues页面</a> 试着回答下大家的问题并留下你的爪印。</p>\n<p>博客推广第二步，<a href=\"https://baike.baidu.com/item/SEO\" target=\"_blank\" rel=\"noopener\">SEO</a>（Search Engine Optimization）。</p>\n<p><strong>搜索引擎</strong></p>\n<p>直接推荐大佬文章：<a href=\"http://www.ehcoo.com/seo.html\" target=\"_blank\" rel=\"noopener\">【搜索优化】Hexo-next百度和谷歌搜索优化</a></p>\n<h3 id=\"3-5-随机生成背景图\"><a href=\"#3-5-随机生成背景图\" class=\"headerlink\" title=\"3.5 随机生成背景图\"></a>3.5 随机生成背景图</h3><p>在主题下的/source/css/_custom/custom.style文件中，添加如下代码：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">body</span>&#123;   </div><div class=\"line\">\t<span class=\"attribute\">background</span>:<span class=\"built_in\">url</span>(https://source.unsplash.com/random/1920x1080);</div><div class=\"line\">\t<span class=\"attribute\">background-size</span>:cover;</div><div class=\"line\">\t<span class=\"attribute\">background-repeat</span>:no-repeat;</div><div class=\"line\">\t<span class=\"attribute\">background-attachment</span>:fixed;</div><div class=\"line\">\t<span class=\"attribute\">background-position</span>:<span class=\"number\">50%</span> <span class=\"number\">50%</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.main-inner</span> &#123; </div><div class=\"line\">    <span class=\"attribute\">margin-top</span>: <span class=\"number\">60px</span>;</div><div class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">60px</span> <span class=\"number\">60px</span> <span class=\"number\">60px</span> <span class=\"number\">60px</span>;</div><div class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"number\">#fff</span>;</div><div class=\"line\">    <span class=\"attribute\">opacity</span>: <span class=\"number\">0.8</span>;</div><div class=\"line\">    <span class=\"attribute\">min-height</span>: <span class=\"number\">500px</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"3-6-背景动画\"><a href=\"#3-6-背景动画\" class=\"headerlink\" title=\"3.6 背景动画\"></a>3.6 背景动画</h3><p>依赖于<a href=\"https://github.com/theme-next/theme-next-canvas-nest\" target=\"_blank\" rel=\"noopener\">theme-next-canvas-nest</a>,或者<a href=\"https://github.com/theme-next/theme-next-three\" target=\"_blank\" rel=\"noopener\">3D library</a>。</p>\n<ol>\n<li>进入到主题目录，如：cd themes/next</li>\n<li><p>下载插件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">git clone https://github.com/theme-next/theme-next-canvas-nest source/lib/canvas-nest</div><div class=\"line\">git clone https://github.com/theme-next/theme-next-three source/lib/three</div></pre></td></tr></table></figure>\n</li>\n<li><p>在主题配置文件中开启，一次只开启一个</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">canvas_nest: false</div><div class=\"line\"></div><div class=\"line\">three_waves: false</div><div class=\"line\">canvas_lines: true</div><div class=\"line\">canvas_sphere: false</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>插件更新</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ cd themes/next/source/lib/canvas-nest</div><div class=\"line\">$ git pull</div></pre></td></tr></table></figure>\n</li>\n</ol>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>本文主要对next主题导入后的基本及深度优化行为做了记录。其中基本配置直接贴出了配置文件，里面写上了中文注释。深度优化方面，既有总结，也有大量的链接推荐。</p>","more":"<h2 id=\"1-开始搭建博客\"><a href=\"#1-开始搭建博客\" class=\"headerlink\" title=\"1.开始搭建博客\"></a>1.开始搭建博客</h2><h2 id=\"2-优化：基本功能配置\"><a href=\"#2-优化：基本功能配置\" class=\"headerlink\" title=\"2.优化：基本功能配置\"></a>2.优化：基本功能配置</h2><p>接下来是配置和增强功能，如阅读统计、评论、插件之类的，这些基本配置建议在写文章之前配置好。</p>\n<p>基本功能配置大部分是修改两个文件，都叫_config.yml。一个是站点的，一个是主题的。</p>\n<p>与其将各个功能分散开来讲，不如直接贴出配置文件，打上注释，从头到尾看一遍就知道如何配置了。</p>\n<h3 id=\"2-1-选择主题\"><a href=\"#2-1-选择主题\" class=\"headerlink\" title=\"2.1 选择主题\"></a>2.1 选择主题</h3><p>我选择的是<a href=\"https://github.com/iissnan/hexo-theme-next\" target=\"_blank\" rel=\"noopener\">NexT</a>,是在Github上<a href=\"https://github.com/search?o=desc&amp;q=topic:hexo-theme&amp;s=stars&amp;type=Repositories\" target=\"_blank\" rel=\"noopener\">被Star最多</a>【2018.3.30】的一个Hexo主题。从V6.0.0开始next主仓库已从 <a href=\"https://github.com/iissnan/hexo-theme-next\" target=\"_blank\" rel=\"noopener\">iissnan</a> 名下 迁移至 <a href=\"https://github.com/theme-next\" target=\"_blank\" rel=\"noopener\">theme-next </a>。组织</p>\n<p>想要什么样的主题，去<a href=\"https://hexo.io/themes/\" target=\"_blank\" rel=\"noopener\">Hexo Themes</a>上慢慢找。</p>\n<p>至于更换主题，很简单，用NexT主题举个例子。</p>\n<ol>\n<li><p>首先，去主题所在仓库拷贝仓库地址，如下图：</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/blog/copyLink.png\" alt=\"拷贝仓库地址\">    </p>\n</li>\n<li><p>然后，到博客站点根目录下,打开 <strong>git bash</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">// next是自定义的主题名字，可以随意更改</div><div class=\"line\">git clone https://github.com/theme-next/hexo-theme-next.git themes/next</div></pre></td></tr></table></figure>\n</li>\n<li><p>最后，修改站点配置文件_config.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">## Themes: https://hexo.io/themes/</div><div class=\"line\">theme: next</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"2-2-站点配置文件\"><a href=\"#2-2-站点配置文件\" class=\"headerlink\" title=\"2.2 站点配置文件\"></a>2.2 站点配置文件</h3><p>请先查看 <a href=\"https://hexo.io/zh-cn/docs/configuration.html\" target=\"_blank\" rel=\"noopener\">Hexo官方文档</a> ，再查看下面我贴出的，如果这样后你还是对有些地方比较懵，可以自行 Google。</p>\n<p><strong>注意：文件中所有的 : 都是英文字符，且后面都有一个空格。</strong></p>\n<p>【2018.3.30更新】文件位置： ~/blog/_config.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div></pre></td><td class=\"code\"><pre><div class=\"line\"># Hexo Configuration</div><div class=\"line\">## Docs: https://hexo.io/docs/configuration.html</div><div class=\"line\">## Source: https://github.com/hexojs/hexo/</div><div class=\"line\"></div><div class=\"line\"># Site</div><div class=\"line\">title: 温故而知新</div><div class=\"line\">subtitle: </div><div class=\"line\">description: 天下事有难易乎？&lt;br/&gt;为之，则难者亦易矣；&lt;br/&gt;不为，则易者亦难矣。</div><div class=\"line\">author: 肖悦</div><div class=\"line\">language: zh-CN</div><div class=\"line\">timezone: </div><div class=\"line\"></div><div class=\"line\"># URL</div><div class=\"line\">## If your site is put in a subdirectory, set url as &apos;http://yoursite.com/child&apos; and root as &apos;/child/&apos;</div><div class=\"line\">url: http://kevinXiao2016.github.io</div><div class=\"line\">root: /</div><div class=\"line\"># 博客文章的 URL 结构，请务必写文章之前就想好！</div><div class=\"line\"># 详细参数请查看：https://hexo.io/docs/permalinks.html</div><div class=\"line\">permalink: :year/:month/:day/:title/</div><div class=\"line\">permalink_defaults:</div><div class=\"line\"></div><div class=\"line\"># Directory</div><div class=\"line\">source_dir: source</div><div class=\"line\">public_dir: public</div><div class=\"line\">tag_dir: tags</div><div class=\"line\">archive_dir: archives</div><div class=\"line\">category_dir: categories</div><div class=\"line\">code_dir: downloads/code</div><div class=\"line\">i18n_dir: :lang</div><div class=\"line\">skip_render:</div><div class=\"line\"></div><div class=\"line\"># Writing</div><div class=\"line\">new_post_name: :title.md # File name of new posts</div><div class=\"line\">default_layout: post</div><div class=\"line\">titlecase: false # Transform title into titlecase</div><div class=\"line\">external_link: true # Open external links in new tab</div><div class=\"line\">filename_case: 0</div><div class=\"line\">render_drafts: false</div><div class=\"line\">post_asset_folder: false</div><div class=\"line\">relative_link: false</div><div class=\"line\">future: true</div><div class=\"line\"># 代码高亮设置</div><div class=\"line\">highlight:</div><div class=\"line\">  enable: true</div><div class=\"line\">  line_number: true</div><div class=\"line\">  auto_detect: false</div><div class=\"line\">  tab_replace:</div><div class=\"line\"></div><div class=\"line\"># Category &amp; Tag</div><div class=\"line\">default_category: uncategorized</div><div class=\"line\">category_map:</div><div class=\"line\">tag_map:</div><div class=\"line\"></div><div class=\"line\"># Date / Time format</div><div class=\"line\">## Hexo uses Moment.js to parse and display date</div><div class=\"line\">## You can customize the date format as defined in</div><div class=\"line\">## http://momentjs.com/docs/#/displaying/format/</div><div class=\"line\">date_format: YYYY-MM-DD</div><div class=\"line\">time_format: HH:mm:ss</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># 扩展设置</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># 集成Local Search 支持站内搜索</div><div class=\"line\">search:</div><div class=\"line\">  path: search.xml</div><div class=\"line\">  field: post</div><div class=\"line\">  format: html</div><div class=\"line\">  limit: 10000</div><div class=\"line\"># Pagination</div><div class=\"line\">## Set per_page to 0 to disable pagination</div><div class=\"line\">per_page: 10</div><div class=\"line\">pagination_dir: page</div><div class=\"line\"></div><div class=\"line\">index_generator:</div><div class=\"line\">  per_page: 10 ##首页默认10篇文章标题 如果值为0不分页</div><div class=\"line\">## 修改归档页面、某一分类页面、某一标签页面的显示篇数</div><div class=\"line\">## 参考：http://theme-next.iissnan.com/faqs.html#setting-page-size</div><div class=\"line\">archive_generator:</div><div class=\"line\">\tper_page: 10 ##归档页面默认10篇文章标题</div><div class=\"line\">\tyearly: true  ##生成年视图</div><div class=\"line\">\tmonthly: true ##生成月视图</div><div class=\"line\">tag_generator:</div><div class=\"line\">\tper_page: 10 ##标签分类页面默认10篇文章</div><div class=\"line\">category_generator: </div><div class=\"line\">\tper_page: 10 ###分类页面默认10篇文章</div><div class=\"line\"></div><div class=\"line\"># Extensions</div><div class=\"line\">## Plugins: https://hexo.io/plugins/</div><div class=\"line\">## Themes: https://hexo.io/themes/</div><div class=\"line\">theme: next</div><div class=\"line\"></div><div class=\"line\"># Deployment</div><div class=\"line\">## Docs: https://hexo.io/docs/deployment.html</div><div class=\"line\">deploy:</div><div class=\"line\">  type: git</div><div class=\"line\">  # 没有做cdn映射前，请使用下面注释掉的配置</div><div class=\"line\">  repo: </div><div class=\"line\">        github: git@github.com:kevinXiao2016/kevinXiao2016.github.io.git,master</div><div class=\"line\">        coding: git@git.coding.net:kevinXiao2016/kevinXiao2016.git,master</div><div class=\"line\"></div><div class=\"line\">  #repository: https://github.com/kevinXiao2016/kevinXiao2016.github.io.git</div><div class=\"line\">  #branch: master</div></pre></td></tr></table></figure>\n<h3 id=\"2-3-主题配置文件\"><a href=\"#2-3-主题配置文件\" class=\"headerlink\" title=\"2.3 主题配置文件\"></a>2.3 主题配置文件</h3><p>如果使用的主题不是Next，那么请另 Google。建议先查看 <a href=\"http://theme-next.iissnan.com/getting-started.html\" target=\"_blank\" rel=\"noopener\">NexT 官方文档</a>。</p>\n<p>【2018.3.30更新】文件位置： ~/blog/themes/next/_config.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Theme Core Configuration Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># 更新相关，参考：https://github.com/iissnan/hexo-theme-next/issues/328</div><div class=\"line\"># 简单说：从V6.0.0开始支持以下功能，不更改主题设置，在站点中设置主题</div><div class=\"line\"># 1.在~/blog/source 目录下新建source目录，在里面新建 next.yml文件</div><div class=\"line\"># 2.将主题配置文件全部拷贝过去</div><div class=\"line\"># 3.设置此处override为true,表明此文件配置可被next.yml中的配置覆盖</div><div class=\"line\">override: true</div><div class=\"line\"></div><div class=\"line\"># Allow to cache content generation. Introduced in NexT v6.0.0.</div><div class=\"line\">cache:</div><div class=\"line\">  enable: true</div></pre></td></tr></table></figure>\n<p>【2018.3.30更新】文件位置： ~/blog/source/_data/next.yml<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div><div class=\"line\">183</div><div class=\"line\">184</div><div class=\"line\">185</div><div class=\"line\">186</div><div class=\"line\">187</div><div class=\"line\">188</div><div class=\"line\">189</div><div class=\"line\">190</div><div class=\"line\">191</div><div class=\"line\">192</div><div class=\"line\">193</div><div class=\"line\">194</div><div class=\"line\">195</div><div class=\"line\">196</div><div class=\"line\">197</div><div class=\"line\">198</div><div class=\"line\">199</div><div class=\"line\">200</div><div class=\"line\">201</div><div class=\"line\">202</div><div class=\"line\">203</div><div class=\"line\">204</div><div class=\"line\">205</div><div class=\"line\">206</div><div class=\"line\">207</div><div class=\"line\">208</div><div class=\"line\">209</div><div class=\"line\">210</div><div class=\"line\">211</div><div class=\"line\">212</div><div class=\"line\">213</div><div class=\"line\">214</div><div class=\"line\">215</div><div class=\"line\">216</div><div class=\"line\">217</div><div class=\"line\">218</div><div class=\"line\">219</div><div class=\"line\">220</div><div class=\"line\">221</div><div class=\"line\">222</div><div class=\"line\">223</div><div class=\"line\">224</div><div class=\"line\">225</div><div class=\"line\">226</div><div class=\"line\">227</div><div class=\"line\">228</div><div class=\"line\">229</div><div class=\"line\">230</div><div class=\"line\">231</div><div class=\"line\">232</div><div class=\"line\">233</div><div class=\"line\">234</div><div class=\"line\">235</div><div class=\"line\">236</div><div class=\"line\">237</div><div class=\"line\">238</div><div class=\"line\">239</div><div class=\"line\">240</div><div class=\"line\">241</div><div class=\"line\">242</div><div class=\"line\">243</div><div class=\"line\">244</div><div class=\"line\">245</div><div class=\"line\">246</div><div class=\"line\">247</div><div class=\"line\">248</div><div class=\"line\">249</div><div class=\"line\">250</div><div class=\"line\">251</div><div class=\"line\">252</div><div class=\"line\">253</div><div class=\"line\">254</div><div class=\"line\">255</div><div class=\"line\">256</div><div class=\"line\">257</div><div class=\"line\">258</div><div class=\"line\">259</div><div class=\"line\">260</div><div class=\"line\">261</div><div class=\"line\">262</div><div class=\"line\">263</div><div class=\"line\">264</div><div class=\"line\">265</div><div class=\"line\">266</div><div class=\"line\">267</div><div class=\"line\">268</div><div class=\"line\">269</div><div class=\"line\">270</div><div class=\"line\">271</div><div class=\"line\">272</div><div class=\"line\">273</div><div class=\"line\">274</div><div class=\"line\">275</div><div class=\"line\">276</div><div class=\"line\">277</div><div class=\"line\">278</div><div class=\"line\">279</div><div class=\"line\">280</div><div class=\"line\">281</div><div class=\"line\">282</div><div class=\"line\">283</div><div class=\"line\">284</div><div class=\"line\">285</div><div class=\"line\">286</div><div class=\"line\">287</div><div class=\"line\">288</div><div class=\"line\">289</div><div class=\"line\">290</div><div class=\"line\">291</div><div class=\"line\">292</div><div class=\"line\">293</div><div class=\"line\">294</div><div class=\"line\">295</div><div class=\"line\">296</div><div class=\"line\">297</div><div class=\"line\">298</div><div class=\"line\">299</div><div class=\"line\">300</div><div class=\"line\">301</div><div class=\"line\">302</div><div class=\"line\">303</div><div class=\"line\">304</div><div class=\"line\">305</div><div class=\"line\">306</div><div class=\"line\">307</div><div class=\"line\">308</div><div class=\"line\">309</div><div class=\"line\">310</div><div class=\"line\">311</div><div class=\"line\">312</div><div class=\"line\">313</div><div class=\"line\">314</div><div class=\"line\">315</div><div class=\"line\">316</div><div class=\"line\">317</div><div class=\"line\">318</div><div class=\"line\">319</div><div class=\"line\">320</div><div class=\"line\">321</div><div class=\"line\">322</div><div class=\"line\">323</div><div class=\"line\">324</div><div class=\"line\">325</div><div class=\"line\">326</div><div class=\"line\">327</div><div class=\"line\">328</div><div class=\"line\">329</div><div class=\"line\">330</div><div class=\"line\">331</div><div class=\"line\">332</div><div class=\"line\">333</div><div class=\"line\">334</div><div class=\"line\">335</div><div class=\"line\">336</div><div class=\"line\">337</div><div class=\"line\">338</div><div class=\"line\">339</div><div class=\"line\">340</div><div class=\"line\">341</div><div class=\"line\">342</div><div class=\"line\">343</div><div class=\"line\">344</div><div class=\"line\">345</div><div class=\"line\">346</div><div class=\"line\">347</div><div class=\"line\">348</div><div class=\"line\">349</div><div class=\"line\">350</div><div class=\"line\">351</div><div class=\"line\">352</div><div class=\"line\">353</div><div class=\"line\">354</div><div class=\"line\">355</div><div class=\"line\">356</div><div class=\"line\">357</div><div class=\"line\">358</div><div class=\"line\">359</div><div class=\"line\">360</div><div class=\"line\">361</div><div class=\"line\">362</div><div class=\"line\">363</div><div class=\"line\">364</div><div class=\"line\">365</div><div class=\"line\">366</div><div class=\"line\">367</div><div class=\"line\">368</div><div class=\"line\">369</div><div class=\"line\">370</div><div class=\"line\">371</div><div class=\"line\">372</div><div class=\"line\">373</div><div class=\"line\">374</div><div class=\"line\">375</div><div class=\"line\">376</div><div class=\"line\">377</div><div class=\"line\">378</div><div class=\"line\">379</div><div class=\"line\">380</div><div class=\"line\">381</div><div class=\"line\">382</div><div class=\"line\">383</div><div class=\"line\">384</div><div class=\"line\">385</div><div class=\"line\">386</div><div class=\"line\">387</div><div class=\"line\">388</div><div class=\"line\">389</div><div class=\"line\">390</div><div class=\"line\">391</div><div class=\"line\">392</div><div class=\"line\">393</div><div class=\"line\">394</div><div class=\"line\">395</div><div class=\"line\">396</div><div class=\"line\">397</div><div class=\"line\">398</div><div class=\"line\">399</div><div class=\"line\">400</div><div class=\"line\">401</div><div class=\"line\">402</div><div class=\"line\">403</div><div class=\"line\">404</div><div class=\"line\">405</div><div class=\"line\">406</div><div class=\"line\">407</div><div class=\"line\">408</div><div class=\"line\">409</div><div class=\"line\">410</div><div class=\"line\">411</div><div class=\"line\">412</div><div class=\"line\">413</div><div class=\"line\">414</div><div class=\"line\">415</div><div class=\"line\">416</div><div class=\"line\">417</div><div class=\"line\">418</div><div class=\"line\">419</div><div class=\"line\">420</div><div class=\"line\">421</div><div class=\"line\">422</div><div class=\"line\">423</div><div class=\"line\">424</div><div class=\"line\">425</div><div class=\"line\">426</div><div class=\"line\">427</div><div class=\"line\">428</div><div class=\"line\">429</div><div class=\"line\">430</div><div class=\"line\">431</div><div class=\"line\">432</div><div class=\"line\">433</div><div class=\"line\">434</div><div class=\"line\">435</div><div class=\"line\">436</div><div class=\"line\">437</div><div class=\"line\">438</div><div class=\"line\">439</div><div class=\"line\">440</div><div class=\"line\">441</div><div class=\"line\">442</div><div class=\"line\">443</div><div class=\"line\">444</div><div class=\"line\">445</div><div class=\"line\">446</div><div class=\"line\">447</div><div class=\"line\">448</div><div class=\"line\">449</div><div class=\"line\">450</div><div class=\"line\">451</div><div class=\"line\">452</div><div class=\"line\">453</div><div class=\"line\">454</div><div class=\"line\">455</div><div class=\"line\">456</div><div class=\"line\">457</div><div class=\"line\">458</div><div class=\"line\">459</div><div class=\"line\">460</div><div class=\"line\">461</div><div class=\"line\">462</div><div class=\"line\">463</div><div class=\"line\">464</div><div class=\"line\">465</div><div class=\"line\">466</div><div class=\"line\">467</div><div class=\"line\">468</div><div class=\"line\">469</div><div class=\"line\">470</div><div class=\"line\">471</div><div class=\"line\">472</div><div class=\"line\">473</div><div class=\"line\">474</div><div class=\"line\">475</div><div class=\"line\">476</div><div class=\"line\">477</div><div class=\"line\">478</div><div class=\"line\">479</div><div class=\"line\">480</div><div class=\"line\">481</div><div class=\"line\">482</div><div class=\"line\">483</div><div class=\"line\">484</div><div class=\"line\">485</div><div class=\"line\">486</div><div class=\"line\">487</div><div class=\"line\">488</div><div class=\"line\">489</div><div class=\"line\">490</div><div class=\"line\">491</div><div class=\"line\">492</div><div class=\"line\">493</div><div class=\"line\">494</div><div class=\"line\">495</div><div class=\"line\">496</div><div class=\"line\">497</div><div class=\"line\">498</div><div class=\"line\">499</div><div class=\"line\">500</div><div class=\"line\">501</div><div class=\"line\">502</div><div class=\"line\">503</div><div class=\"line\">504</div><div class=\"line\">505</div><div class=\"line\">506</div><div class=\"line\">507</div><div class=\"line\">508</div><div class=\"line\">509</div><div class=\"line\">510</div><div class=\"line\">511</div><div class=\"line\">512</div><div class=\"line\">513</div><div class=\"line\">514</div><div class=\"line\">515</div><div class=\"line\">516</div><div class=\"line\">517</div><div class=\"line\">518</div><div class=\"line\">519</div><div class=\"line\">520</div><div class=\"line\">521</div><div class=\"line\">522</div><div class=\"line\">523</div><div class=\"line\">524</div><div class=\"line\">525</div><div class=\"line\">526</div><div class=\"line\">527</div><div class=\"line\">528</div><div class=\"line\">529</div><div class=\"line\">530</div><div class=\"line\">531</div><div class=\"line\">532</div><div class=\"line\">533</div><div class=\"line\">534</div><div class=\"line\">535</div><div class=\"line\">536</div><div class=\"line\">537</div><div class=\"line\">538</div><div class=\"line\">539</div><div class=\"line\">540</div><div class=\"line\">541</div><div class=\"line\">542</div><div class=\"line\">543</div><div class=\"line\">544</div><div class=\"line\">545</div><div class=\"line\">546</div><div class=\"line\">547</div><div class=\"line\">548</div><div class=\"line\">549</div><div class=\"line\">550</div><div class=\"line\">551</div><div class=\"line\">552</div><div class=\"line\">553</div><div class=\"line\">554</div><div class=\"line\">555</div><div class=\"line\">556</div><div class=\"line\">557</div><div class=\"line\">558</div><div class=\"line\">559</div><div class=\"line\">560</div><div class=\"line\">561</div><div class=\"line\">562</div><div class=\"line\">563</div><div class=\"line\">564</div><div class=\"line\">565</div><div class=\"line\">566</div><div class=\"line\">567</div><div class=\"line\">568</div><div class=\"line\">569</div><div class=\"line\">570</div><div class=\"line\">571</div><div class=\"line\">572</div><div class=\"line\">573</div><div class=\"line\">574</div><div class=\"line\">575</div><div class=\"line\">576</div><div class=\"line\">577</div><div class=\"line\">578</div><div class=\"line\">579</div><div class=\"line\">580</div><div class=\"line\">581</div><div class=\"line\">582</div><div class=\"line\">583</div><div class=\"line\">584</div><div class=\"line\">585</div><div class=\"line\">586</div><div class=\"line\">587</div><div class=\"line\">588</div><div class=\"line\">589</div><div class=\"line\">590</div><div class=\"line\">591</div><div class=\"line\">592</div><div class=\"line\">593</div><div class=\"line\">594</div><div class=\"line\">595</div><div class=\"line\">596</div><div class=\"line\">597</div><div class=\"line\">598</div><div class=\"line\">599</div><div class=\"line\">600</div><div class=\"line\">601</div><div class=\"line\">602</div><div class=\"line\">603</div><div class=\"line\">604</div><div class=\"line\">605</div><div class=\"line\">606</div><div class=\"line\">607</div><div class=\"line\">608</div><div class=\"line\">609</div><div class=\"line\">610</div><div class=\"line\">611</div><div class=\"line\">612</div><div class=\"line\">613</div><div class=\"line\">614</div><div class=\"line\">615</div><div class=\"line\">616</div><div class=\"line\">617</div><div class=\"line\">618</div><div class=\"line\">619</div><div class=\"line\">620</div><div class=\"line\">621</div><div class=\"line\">622</div><div class=\"line\">623</div><div class=\"line\">624</div><div class=\"line\">625</div><div class=\"line\">626</div><div class=\"line\">627</div><div class=\"line\">628</div><div class=\"line\">629</div><div class=\"line\">630</div><div class=\"line\">631</div><div class=\"line\">632</div><div class=\"line\">633</div><div class=\"line\">634</div><div class=\"line\">635</div><div class=\"line\">636</div><div class=\"line\">637</div><div class=\"line\">638</div><div class=\"line\">639</div><div class=\"line\">640</div><div class=\"line\">641</div><div class=\"line\">642</div><div class=\"line\">643</div><div class=\"line\">644</div><div class=\"line\">645</div><div class=\"line\">646</div><div class=\"line\">647</div><div class=\"line\">648</div><div class=\"line\">649</div><div class=\"line\">650</div><div class=\"line\">651</div><div class=\"line\">652</div><div class=\"line\">653</div><div class=\"line\">654</div><div class=\"line\">655</div><div class=\"line\">656</div><div class=\"line\">657</div><div class=\"line\">658</div><div class=\"line\">659</div><div class=\"line\">660</div><div class=\"line\">661</div><div class=\"line\">662</div><div class=\"line\">663</div><div class=\"line\">664</div><div class=\"line\">665</div><div class=\"line\">666</div><div class=\"line\">667</div><div class=\"line\">668</div><div class=\"line\">669</div><div class=\"line\">670</div><div class=\"line\">671</div><div class=\"line\">672</div><div class=\"line\">673</div><div class=\"line\">674</div><div class=\"line\">675</div><div class=\"line\">676</div><div class=\"line\">677</div><div class=\"line\">678</div><div class=\"line\">679</div><div class=\"line\">680</div><div class=\"line\">681</div><div class=\"line\">682</div><div class=\"line\">683</div><div class=\"line\">684</div><div class=\"line\">685</div><div class=\"line\">686</div><div class=\"line\">687</div><div class=\"line\">688</div><div class=\"line\">689</div><div class=\"line\">690</div><div class=\"line\">691</div><div class=\"line\">692</div><div class=\"line\">693</div><div class=\"line\">694</div><div class=\"line\">695</div><div class=\"line\">696</div><div class=\"line\">697</div><div class=\"line\">698</div><div class=\"line\">699</div><div class=\"line\">700</div><div class=\"line\">701</div><div class=\"line\">702</div><div class=\"line\">703</div><div class=\"line\">704</div><div class=\"line\">705</div><div class=\"line\">706</div><div class=\"line\">707</div><div class=\"line\">708</div><div class=\"line\">709</div><div class=\"line\">710</div><div class=\"line\">711</div><div class=\"line\">712</div><div class=\"line\">713</div><div class=\"line\">714</div><div class=\"line\">715</div><div class=\"line\">716</div><div class=\"line\">717</div><div class=\"line\">718</div><div class=\"line\">719</div><div class=\"line\">720</div><div class=\"line\">721</div><div class=\"line\">722</div><div class=\"line\">723</div><div class=\"line\">724</div><div class=\"line\">725</div><div class=\"line\">726</div><div class=\"line\">727</div><div class=\"line\">728</div><div class=\"line\">729</div><div class=\"line\">730</div><div class=\"line\">731</div><div class=\"line\">732</div><div class=\"line\">733</div><div class=\"line\">734</div><div class=\"line\">735</div><div class=\"line\">736</div><div class=\"line\">737</div><div class=\"line\">738</div><div class=\"line\">739</div><div class=\"line\">740</div><div class=\"line\">741</div><div class=\"line\">742</div><div class=\"line\">743</div><div class=\"line\">744</div><div class=\"line\">745</div><div class=\"line\">746</div><div class=\"line\">747</div><div class=\"line\">748</div><div class=\"line\">749</div><div class=\"line\">750</div><div class=\"line\">751</div><div class=\"line\">752</div><div class=\"line\">753</div><div class=\"line\">754</div><div class=\"line\">755</div><div class=\"line\">756</div><div class=\"line\">757</div><div class=\"line\">758</div><div class=\"line\">759</div><div class=\"line\">760</div><div class=\"line\">761</div><div class=\"line\">762</div><div class=\"line\">763</div><div class=\"line\">764</div><div class=\"line\">765</div><div class=\"line\">766</div><div class=\"line\">767</div><div class=\"line\">768</div><div class=\"line\">769</div><div class=\"line\">770</div><div class=\"line\">771</div><div class=\"line\">772</div><div class=\"line\">773</div><div class=\"line\">774</div><div class=\"line\">775</div><div class=\"line\">776</div><div class=\"line\">777</div><div class=\"line\">778</div><div class=\"line\">779</div><div class=\"line\">780</div><div class=\"line\">781</div><div class=\"line\">782</div><div class=\"line\">783</div><div class=\"line\">784</div><div class=\"line\">785</div><div class=\"line\">786</div><div class=\"line\">787</div><div class=\"line\">788</div><div class=\"line\">789</div><div class=\"line\">790</div><div class=\"line\">791</div><div class=\"line\">792</div><div class=\"line\">793</div><div class=\"line\">794</div><div class=\"line\">795</div><div class=\"line\">796</div><div class=\"line\">797</div><div class=\"line\">798</div><div class=\"line\">799</div><div class=\"line\">800</div><div class=\"line\">801</div><div class=\"line\">802</div><div class=\"line\">803</div><div class=\"line\">804</div><div class=\"line\">805</div><div class=\"line\">806</div><div class=\"line\">807</div><div class=\"line\">808</div><div class=\"line\">809</div><div class=\"line\">810</div><div class=\"line\">811</div><div class=\"line\">812</div><div class=\"line\">813</div><div class=\"line\">814</div><div class=\"line\">815</div><div class=\"line\">816</div><div class=\"line\">817</div><div class=\"line\">818</div><div class=\"line\">819</div><div class=\"line\">820</div><div class=\"line\">821</div><div class=\"line\">822</div><div class=\"line\">823</div><div class=\"line\">824</div><div class=\"line\">825</div><div class=\"line\">826</div><div class=\"line\">827</div><div class=\"line\">828</div><div class=\"line\">829</div><div class=\"line\">830</div><div class=\"line\">831</div><div class=\"line\">832</div><div class=\"line\">833</div><div class=\"line\">834</div><div class=\"line\">835</div><div class=\"line\">836</div><div class=\"line\">837</div><div class=\"line\">838</div><div class=\"line\">839</div><div class=\"line\">840</div><div class=\"line\">841</div><div class=\"line\">842</div><div class=\"line\">843</div><div class=\"line\">844</div><div class=\"line\">845</div><div class=\"line\">846</div><div class=\"line\">847</div><div class=\"line\">848</div><div class=\"line\">849</div><div class=\"line\">850</div><div class=\"line\">851</div><div class=\"line\">852</div><div class=\"line\">853</div><div class=\"line\">854</div><div class=\"line\">855</div><div class=\"line\">856</div><div class=\"line\">857</div><div class=\"line\">858</div><div class=\"line\">859</div><div class=\"line\">860</div><div class=\"line\">861</div><div class=\"line\">862</div><div class=\"line\">863</div><div class=\"line\">864</div><div class=\"line\">865</div><div class=\"line\">866</div><div class=\"line\">867</div><div class=\"line\">868</div><div class=\"line\">869</div><div class=\"line\">870</div><div class=\"line\">871</div><div class=\"line\">872</div><div class=\"line\">873</div><div class=\"line\">874</div><div class=\"line\">875</div><div class=\"line\">876</div><div class=\"line\">877</div><div class=\"line\">878</div><div class=\"line\">879</div><div class=\"line\">880</div><div class=\"line\">881</div><div class=\"line\">882</div><div class=\"line\">883</div><div class=\"line\">884</div><div class=\"line\">885</div><div class=\"line\">886</div><div class=\"line\">887</div><div class=\"line\">888</div><div class=\"line\">889</div><div class=\"line\">890</div><div class=\"line\">891</div><div class=\"line\">892</div><div class=\"line\">893</div><div class=\"line\">894</div><div class=\"line\">895</div><div class=\"line\">896</div><div class=\"line\">897</div><div class=\"line\">898</div><div class=\"line\">899</div><div class=\"line\">900</div><div class=\"line\">901</div><div class=\"line\">902</div><div class=\"line\">903</div><div class=\"line\">904</div><div class=\"line\">905</div><div class=\"line\">906</div><div class=\"line\">907</div><div class=\"line\">908</div><div class=\"line\">909</div><div class=\"line\">910</div><div class=\"line\">911</div><div class=\"line\">912</div><div class=\"line\">913</div><div class=\"line\">914</div><div class=\"line\">915</div><div class=\"line\">916</div><div class=\"line\">917</div><div class=\"line\">918</div><div class=\"line\">919</div><div class=\"line\">920</div><div class=\"line\">921</div><div class=\"line\">922</div><div class=\"line\">923</div><div class=\"line\">924</div><div class=\"line\">925</div><div class=\"line\">926</div><div class=\"line\">927</div><div class=\"line\">928</div><div class=\"line\">929</div><div class=\"line\">930</div><div class=\"line\">931</div><div class=\"line\">932</div><div class=\"line\">933</div><div class=\"line\">934</div><div class=\"line\">935</div><div class=\"line\">936</div><div class=\"line\">937</div><div class=\"line\">938</div><div class=\"line\">939</div><div class=\"line\">940</div><div class=\"line\">941</div><div class=\"line\">942</div><div class=\"line\">943</div><div class=\"line\">944</div><div class=\"line\">945</div><div class=\"line\">946</div><div class=\"line\">947</div><div class=\"line\">948</div><div class=\"line\">949</div><div class=\"line\">950</div><div class=\"line\">951</div><div class=\"line\">952</div><div class=\"line\">953</div><div class=\"line\">954</div><div class=\"line\">955</div><div class=\"line\">956</div><div class=\"line\">957</div><div class=\"line\">958</div><div class=\"line\">959</div><div class=\"line\">960</div><div class=\"line\">961</div><div class=\"line\">962</div><div class=\"line\">963</div><div class=\"line\">964</div><div class=\"line\">965</div><div class=\"line\">966</div><div class=\"line\">967</div><div class=\"line\">968</div><div class=\"line\">969</div><div class=\"line\">970</div><div class=\"line\">971</div><div class=\"line\">972</div><div class=\"line\">973</div></pre></td><td class=\"code\"><pre><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Site Information Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># 站点图标啦，直接去 https://realfavicongenerator.net</div><div class=\"line\"># 选项弄好后，下载压缩包，解压复制粘贴</div><div class=\"line\"># 建议放在 hexo-site/source/images/ 里（没有自己建）</div><div class=\"line\"># 这样可以避免更新 NexT 主题的时候遇到麻烦</div><div class=\"line\"># 最后记得要稍微改下文件名，与下面的保持一致</div><div class=\"line\">favicon:</div><div class=\"line\">  small: /images/favicon-16x16</div><div class=\"line\">  medium: /images/favicon-32x32</div><div class=\"line\">  #apple_touch_icon: /images/apple-touch-icon-next.png</div><div class=\"line\">  #safari_pinned_tab: /images/logo.svg</div><div class=\"line\">  #android_manifest: /images/manifest.json</div><div class=\"line\">  #ms_browserconfig: /images/browserconfig.xml</div><div class=\"line\"></div><div class=\"line\"># Set rss to false to disable feed link.</div><div class=\"line\"># Leave rss as empty to use site&apos;s feed link.</div><div class=\"line\"># Set rss to specific value if you have burned your feed already.</div><div class=\"line\">rss:</div><div class=\"line\"></div><div class=\"line\"># 页脚配置</div><div class=\"line\">footer:</div><div class=\"line\">  # Specify the date when the site was setup.</div><div class=\"line\">  # If not defined, current year will be used.</div><div class=\"line\">  # 建站年份</div><div class=\"line\">  since: 2017</div><div class=\"line\"></div><div class=\"line\">  # Icon between year and copyright info.</div><div class=\"line\">  # 年份后面的图标，为 Font Awesome 图标</div><div class=\"line\">  icon: </div><div class=\"line\">    # Icon name in fontawesome, see: https://fontawesome.com/v4.7.0/icons</div><div class=\"line\">    # `heart` is recommended with animation in red (#ff0000).</div><div class=\"line\">    name: heart</div><div class=\"line\">    # If you want to animate the icon, set it to true.</div><div class=\"line\">    # 设置true时开启动画效果</div><div class=\"line\">    animated: true</div><div class=\"line\">    # Change the color of icon, using Hex Code.</div><div class=\"line\">    color: &quot;#ff0000&quot;</div><div class=\"line\"></div><div class=\"line\">  # If not defined, will be used `author` from Hexo main config.</div><div class=\"line\">  # 如果不定义，默认用站点配置文件的 author 名</div><div class=\"line\">  copyright:</div><div class=\"line\">  # -------------------------------------------------------------</div><div class=\"line\">  # Hexo link (Powered by Hexo).</div><div class=\"line\">  # Hexo 的链接</div><div class=\"line\">  powered: true</div><div class=\"line\"></div><div class=\"line\">  theme:</div><div class=\"line\">    # Theme &amp; scheme info link (Theme - NexT.scheme).</div><div class=\"line\">    # 是否支持主题</div><div class=\"line\">    enable: true</div><div class=\"line\">    # Version info of NexT after scheme info (vX.X.X).</div><div class=\"line\">    # 是否显示next的版本</div><div class=\"line\">    version: true</div><div class=\"line\">  # -------------------------------------------------------------</div><div class=\"line\">  # Any custom text can be defined here.</div><div class=\"line\">  # 自定义内容</div><div class=\"line\">  #custom_text: Hosted by &lt;a target=&quot;_blank&quot; rel=&quot;external nofollow&quot; href=&quot;https://pages.coding.me&quot;&gt;&lt;b&gt;Coding Pages&lt;/b&gt;&lt;/a&gt;</div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># SEO Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># Canonical, set a canonical link tag in your hexo, you could use it for your SEO of blog.</div><div class=\"line\"># See: https://support.google.com/webmasters/answer/139066</div><div class=\"line\"># Tips: Before you open this tag, remember set up your URL in hexo _config.yml ( ex. url: http://yourdomain.com )</div><div class=\"line\">canonical: true</div><div class=\"line\"></div><div class=\"line\"># Change headers hierarchy on site-subtitle (will be main site description) and on all post/pages titles for better SEO-optimization.</div><div class=\"line\">seo: false</div><div class=\"line\"></div><div class=\"line\"># If true, will add site-subtitle to index page, added in main hexo config.</div><div class=\"line\"># subtitle: Subtitle</div><div class=\"line\">index_with_subtitle: false</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Menu Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># When running the site in a subdirectory (e.g. domain.tld/blog), remove the leading slash from link value (/archives -&gt; archives).</div><div class=\"line\"># Usage: `Key: /link/ || icon`</div><div class=\"line\"># Key is the name of menu item. If translate for this menu will find in languages - this translate will be loaded; if not - Key name will be used. Key is case-senstive.</div><div class=\"line\"># Value before `||` delimeter is the target link.</div><div class=\"line\"># Value after `||` delimeter is the name of FontAwesome icon. If icon (with or without delimeter) is not specified, question icon will be loaded.</div><div class=\"line\"># 菜单设置 || 菜单图标设置</div><div class=\"line\"># 编辑 ~/blog/themes/next/languages 下的相应文件</div><div class=\"line\"># 比如添加一个“留言”菜单，站点配置文件的 language 是 zh-Hans</div><div class=\"line\"># 则编辑 zh-Hans.yml，在 menu: 项内添加一行 留言: 留言</div><div class=\"line\"># 注意空格，且符号 : 为英文字符！</div><div class=\"line\">menu:</div><div class=\"line\">  home: / || home</div><div class=\"line\">  about: /about/ || user</div><div class=\"line\">  tags: /tags/ || tags</div><div class=\"line\">  categories: /categories/ || th</div><div class=\"line\">  archives: /archives/ || archive</div><div class=\"line\">  #schedule: /schedule/ || calendar</div><div class=\"line\">  #sitemap: /sitemap.xml || sitemap</div><div class=\"line\">  #commonweal: /404/ || heartbeat</div><div class=\"line\"></div><div class=\"line\"># Enable/Disable menu icons / item badges.</div><div class=\"line\"># 是否开启菜单图标</div><div class=\"line\">menu_settings:</div><div class=\"line\">  icons: true</div><div class=\"line\">  badges: false</div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Scheme Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># Schemes</div><div class=\"line\"># 设计板式，都长啥样，去 README 里面的链接里看看</div><div class=\"line\">#scheme: Muse</div><div class=\"line\">scheme: Mist</div><div class=\"line\">#scheme: Pisces</div><div class=\"line\">#scheme: Gemini</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Sidebar Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># Posts / Categories / Tags in sidebar.</div><div class=\"line\">site_state: true</div><div class=\"line\"></div><div class=\"line\"># 侧栏社交链接设置，与上面菜单差不多，要生效记得把前面的 # 去掉</div><div class=\"line\"># Social Links.</div><div class=\"line\"># Usage: `Key: permalink || icon`</div><div class=\"line\"># Key is the link label showing to end users.</div><div class=\"line\"># Value before `||` delimeter is the target permalink.</div><div class=\"line\"># Value after `||` delimeter is the name of FontAwesome icon. If icon (with or without delimeter) is not specified, globe icon will be loaded.</div><div class=\"line\">social:</div><div class=\"line\">  #GitHub: https://github.com/kevinXiao2016 || github</div><div class=\"line\">  #E-Mail: mailto:yourname@gmail.com || envelope</div><div class=\"line\">  #Google: https://plus.google.com/yourname || google</div><div class=\"line\">  #Twitter: https://twitter.com/yourname || twitter</div><div class=\"line\">  #FB Page: https://www.facebook.com/yourname || facebook</div><div class=\"line\">  #VK Group: https://vk.com/yourname || vk</div><div class=\"line\">  #StackOverflow: https://stackoverflow.com/yourname || stack-overflow</div><div class=\"line\">  #YouTube: https://youtube.com/yourname || youtube</div><div class=\"line\">  #Instagram: https://instagram.com/yourname || instagram</div><div class=\"line\">  #Skype: skype:yourname?call|chat || skype</div><div class=\"line\"></div><div class=\"line\"># 侧栏社交链接图标设置</div><div class=\"line\">social_icons:</div><div class=\"line\">  enable: true</div><div class=\"line\">  icons_only: false</div><div class=\"line\">  transition: false</div><div class=\"line\">  # Dependencies: exturl: true in Tags Settings section below.</div><div class=\"line\">  # To encrypt links above use https://www.base64encode.org</div><div class=\"line\">  # Example encoded link: `GitHub: aHR0cHM6Ly9naXRodWIuY29tL3RoZW1lLW5leHQ= || github`</div><div class=\"line\">  exturl: false</div><div class=\"line\"></div><div class=\"line\"># Follow me on GitHub banner in right-top corner.</div><div class=\"line\"># Usage: `permalink || title`</div><div class=\"line\"># Value before `||` delimeter is the target permalink.</div><div class=\"line\"># Value after `||` delimeter is the title and aria-label name.</div><div class=\"line\">github_banner: https://github.com/kevinXiao2016 || Follow me on GitHub</div><div class=\"line\"></div><div class=\"line\"># Blog rolls</div><div class=\"line\"># 侧栏友链设置</div><div class=\"line\">links_icon: globe</div><div class=\"line\">links_title: 神奇的链接</div><div class=\"line\">links_layout: block</div><div class=\"line\">#links_layout: inline</div><div class=\"line\">links:</div><div class=\"line\">  EMS规范: http://ems.top-vision.cn:8110/dm/dm.html</div><div class=\"line\">  #网易云音乐 : https://music.163.com/#/user/home?id=86590096</div><div class=\"line\">  #Coldplay Official Website: http://coldplay.com/</div><div class=\"line\">  #获取 Elon Musk 的新闻: https://elonmusknews.org/</div><div class=\"line\">  #尼古拉·特斯拉：发明了现代世界的人: http://www.bilibili.com/video/av6211226/</div><div class=\"line\">  #关于此博客: https://reuixiy.github.io/about/</div><div class=\"line\"></div><div class=\"line\"># Sidebar Avatar</div><div class=\"line\"># in theme directory(source/images): /images/avatar.gif</div><div class=\"line\"># in site  directory(source/uploads): /uploads/avatar.gif</div><div class=\"line\"># 侧栏头像设置</div><div class=\"line\"># 建议放在 hexo-site/source/uploads/ 里（没有自己建）</div><div class=\"line\"># 这样可以避免更新 NexT 主题的时候遇到麻烦</div><div class=\"line\">avatar: /images/avatar.png</div><div class=\"line\"></div><div class=\"line\"># Table Of Contents in the Sidebar</div><div class=\"line\"># 侧栏文章目录设置（前提是 Markdown 书写正确）</div><div class=\"line\">toc:</div><div class=\"line\">  enable: true</div><div class=\"line\"></div><div class=\"line\">  # Automatically add list number to toc.</div><div class=\"line\">  # 自动加数字序号</div><div class=\"line\">  number: false</div><div class=\"line\"></div><div class=\"line\">  # If true, all words will placed on next lines if header width longer then sidebar width.</div><div class=\"line\">  # 如果标题太长，则放到下一行继续显示</div><div class=\"line\">  wrap: false</div><div class=\"line\"></div><div class=\"line\"># Creative Commons 4.0 International License.</div><div class=\"line\"># http://creativecommons.org/</div><div class=\"line\"># Available: by | by-nc | by-nc-nd | by-nc-sa | by-nd | by-sa | zero</div><div class=\"line\">#creative_commons: by-nc-sa</div><div class=\"line\">#creative_commons:</div><div class=\"line\"></div><div class=\"line\">sidebar:</div><div class=\"line\">  # Sidebar Position, available value: left | right (only for Pisces | Gemini).</div><div class=\"line\">  # 侧栏位置设置，可用值：左 | 右（只对 Pisces 和 Gemini 设计版式有效！）</div><div class=\"line\">  position: left</div><div class=\"line\">  #position: right</div><div class=\"line\">  </div><div class=\"line\">  # 侧栏显示方式</div><div class=\"line\">  # Sidebar Display, available value (only for Muse | Mist):</div><div class=\"line\">  #  - post    expand on posts automatically. Default.</div><div class=\"line\">  #  - always  expand for all pages automatically</div><div class=\"line\">  #  - hide    expand only when click on the sidebar toggle icon.</div><div class=\"line\">  #  - remove  Totally remove sidebar including sidebar toggle.</div><div class=\"line\">  display: post</div><div class=\"line\">  #display: always</div><div class=\"line\">  #display: hide</div><div class=\"line\">  #display: remove</div><div class=\"line\"></div><div class=\"line\">  # Sidebar offset from top menubar in pixels (only for Pisces | Gemini).</div><div class=\"line\">  # 只对 Pisces 和 Gemini 设计版式有效！</div><div class=\"line\">  offset: 12</div><div class=\"line\"></div><div class=\"line\">  # Back to top in sidebar (only for Pisces | Gemini).</div><div class=\"line\">  # 只对 Pisces 和 Gemini 设计版式有效！</div><div class=\"line\">  b2t: false</div><div class=\"line\"></div><div class=\"line\">  # Scroll percent label in b2t button.</div><div class=\"line\">  scrollpercent: true</div><div class=\"line\"></div><div class=\"line\">  # Enable sidebar on narrow view (only for Muse | Mist).</div><div class=\"line\">  # 移动端显示侧栏，只对 Muse 和 Mist 设计版式有效！</div><div class=\"line\">  onmobile: true</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Post Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># Automatically scroll page to section which is under &lt;!-- more --&gt; mark.</div><div class=\"line\"># 点击 [Read More]，页面自动滚动到 &lt;!-- more --&gt; 标记处</div><div class=\"line\">scroll_to_more: false</div><div class=\"line\"></div><div class=\"line\"># Automatically saving scroll position on each post/page in cookies.</div><div class=\"line\"># 用 cookies 保存浏览的位置信息，意味着重新打开这个页面后</div><div class=\"line\"># 页面就会自动滚动到上次的位置，除非读者清理浏览器 cookies</div><div class=\"line\">save_scroll: false</div><div class=\"line\"></div><div class=\"line\"># Automatically excerpt description in homepage as preamble text.</div><div class=\"line\"># 将每篇文章 Front-matter 里 description 的文字作为页面显示的文章摘要</div><div class=\"line\">excerpt_description: true</div><div class=\"line\"></div><div class=\"line\"># Automatically Excerpt. Not recommend.</div><div class=\"line\"># Please use &lt;!-- more --&gt; in the post to control excerpt accurately.</div><div class=\"line\"># 按字数自动加入 [Read More]，不建议！</div><div class=\"line\"># 建议在文章中加入 &lt;!-- more --&gt;</div><div class=\"line\"># 自定义 [Read More] 按钮之前要显示的内容！</div><div class=\"line\">auto_excerpt:</div><div class=\"line\">  enable: false</div><div class=\"line\">  length: 150</div><div class=\"line\"></div><div class=\"line\"># Post meta display settings</div><div class=\"line\"># 文章顶部显示的文章元数据设置</div><div class=\"line\">post_meta:</div><div class=\"line\">  item_text: true</div><div class=\"line\">  created_at: true</div><div class=\"line\">  updated_at: false</div><div class=\"line\">  # Only show &apos;updated&apos; if different from &apos;created&apos;.</div><div class=\"line\">  updated_diff: false</div><div class=\"line\">  categories: true</div><div class=\"line\"></div><div class=\"line\"># Post wordcount display settings</div><div class=\"line\"># Dependencies: https://github.com/theme-next/hexo-symbols-count-time</div><div class=\"line\"># 显示统计字数和估计阅读时长</div><div class=\"line\"># 注意：这个要安装插件，先进入站点文件夹根目录</div><div class=\"line\"># 然后：npm install hexo-symbols-count-time --save</div><div class=\"line\">symbols_count_time:</div><div class=\"line\">  separated_meta: true</div><div class=\"line\">  item_text_post: true</div><div class=\"line\">  item_text_total: false</div><div class=\"line\">  awl: 5</div><div class=\"line\">  wpm: 200</div><div class=\"line\"></div><div class=\"line\"># Manual define the border radius in codeblock</div><div class=\"line\"># Leave it empty for the default 1</div><div class=\"line\">codeblock:</div><div class=\"line\">  border_radius: </div><div class=\"line\"></div><div class=\"line\"># Wechat Subscriber</div><div class=\"line\">#wechat_subscriber:</div><div class=\"line\">  #enabled: true</div><div class=\"line\">  #qcode: /path/to/your/wechatqcode ex. /uploads/wechat-qcode.jpg</div><div class=\"line\">  #description: ex. subscribe to my blog by scanning my public wechat account</div><div class=\"line\"></div><div class=\"line\"># Reward</div><div class=\"line\">reward_comment: 坚持原创技术分享，您的支持将鼓励我继续创作！</div><div class=\"line\">wechatpay: /images/wechat-reward-image.jpg</div><div class=\"line\">alipay: /images/alipay-reward-image.jpg</div><div class=\"line\">#bitcoin: /images/bitcoin.png</div><div class=\"line\"></div><div class=\"line\"># Related popular posts</div><div class=\"line\"># Dependencies: https://github.com/tea3/hexo-related-popular-posts</div><div class=\"line\">related_posts:</div><div class=\"line\">  enable: false</div><div class=\"line\">  title: # custom header, leave empty to use the default one</div><div class=\"line\">  display_in_home: false</div><div class=\"line\">  params:</div><div class=\"line\">    maxCount: 5</div><div class=\"line\">    #PPMixingRate: 0.0</div><div class=\"line\">    #isDate: false</div><div class=\"line\">    #isImage: false</div><div class=\"line\">    #isExcerpt: false</div><div class=\"line\"></div><div class=\"line\"># Declare license on posts</div><div class=\"line\">post_copyright:</div><div class=\"line\">  enable: false</div><div class=\"line\">  license: &lt;a href=&quot;https://creativecommons.org/licenses/by-nc-sa/4.0/&quot; rel=&quot;external nofollow&quot; target=&quot;_blank&quot;&gt;CC BY-NC-SA 4.0&lt;/a&gt;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Misc Theme Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># Reduce padding / margin indents on devices with narrow width.</div><div class=\"line\"># 移动端把页面两边留白去除，个人不建议</div><div class=\"line\">mobile_layout_economy: false</div><div class=\"line\"></div><div class=\"line\"># Android Chrome header panel color ($brand-bg / $headband-bg =&gt; $black-deep).</div><div class=\"line\"># Android 上 Chrome 浏览器顶部颜色设置</div><div class=\"line\">android_chrome_color: &quot;#222&quot;</div><div class=\"line\"></div><div class=\"line\"># Custom Logo.</div><div class=\"line\"># !!Only available for Default Scheme currently.</div><div class=\"line\"># Options:</div><div class=\"line\">#   enabled: [true/false] - Replace with specific image</div><div class=\"line\">#   image: url-of-image   - Images&apos;s url</div><div class=\"line\">custom_logo:</div><div class=\"line\">  enabled: false</div><div class=\"line\">  image:</div><div class=\"line\"></div><div class=\"line\"># Code Highlight theme</div><div class=\"line\"># Available values: normal | night | night eighties | night blue | night bright</div><div class=\"line\"># https://github.com/chriskempson/tomorrow-theme</div><div class=\"line\"># 代码高亮主题设置</div><div class=\"line\"># 都长啥样自己点开上面的链接查看</div><div class=\"line\">highlight_theme: normal</div><div class=\"line\"></div><div class=\"line\"># Enable &quot;cheers&quot; for archive page.</div><div class=\"line\">cheers_enabled: true</div><div class=\"line\"></div><div class=\"line\"># Manual define the max content width</div><div class=\"line\"># !!Only available for Gemini Scheme currently</div><div class=\"line\"># Leave it empty for the default 75% (suggest not less than 1000px)</div><div class=\"line\">#max_content_width: 1000px</div><div class=\"line\"></div><div class=\"line\"># Manual define the sidebar width</div><div class=\"line\"># !!Only available for Gemini Scheme currently</div><div class=\"line\"># Leave it empty for the default 240</div><div class=\"line\">sidebar_width:</div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Font Settings</div><div class=\"line\"># - Find fonts on Google Fonts (https://www.google.com/fonts)</div><div class=\"line\"># - All fonts set here will have the following styles:</div><div class=\"line\">#     light, light italic, normal, normal italic, bold, bold italic</div><div class=\"line\"># - Be aware that setting too much fonts will cause site running slowly</div><div class=\"line\"># - Introduce in 5.0.1</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># CAUTION! Safari Version 10.1.2 bug: https://github.com/iissnan/hexo-theme-next/issues/1844</div><div class=\"line\"># To avoid space between header and sidebar in Pisces / Gemini themes recommended to use Web Safe fonts for `global` (and `logo`):</div><div class=\"line\"># Arial | Tahoma | Helvetica | Times New Roman | Courier New | Verdana | Georgia | Palatino | Garamond | Comic Sans MS | Trebuchet MS</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># 字体设置</div><div class=\"line\">font:</div><div class=\"line\">  enable: false</div><div class=\"line\"></div><div class=\"line\">  # Uri of fonts host. E.g. //fonts.googleapis.com (Default).</div><div class=\"line\">  host:</div><div class=\"line\"></div><div class=\"line\">  # Font options:</div><div class=\"line\">  # `external: true` will load this font family from `host` above.</div><div class=\"line\">  # `family: Times New Roman`. Without any quotes.</div><div class=\"line\">  # `size: xx`. Use `px` as unit.</div><div class=\"line\"></div><div class=\"line\">  # Global font settings used for all elements in &lt;body&gt;.</div><div class=\"line\">  global:</div><div class=\"line\">    external: true</div><div class=\"line\">    family: Lato</div><div class=\"line\">    size:</div><div class=\"line\"></div><div class=\"line\">  # Font settings for Headlines (H1, H2, H3, H4, H5, H6).</div><div class=\"line\">  # Fallback to `global` font settings.</div><div class=\"line\">  headings:</div><div class=\"line\">    external: true</div><div class=\"line\">    family:</div><div class=\"line\">    size:</div><div class=\"line\"></div><div class=\"line\">  # Font settings for posts.</div><div class=\"line\">  # Fallback to `global` font settings.</div><div class=\"line\">  posts:</div><div class=\"line\">    external: true</div><div class=\"line\">    family:</div><div class=\"line\"></div><div class=\"line\">  # Font settings for Logo.</div><div class=\"line\">  # Fallback to `global` font settings.</div><div class=\"line\">  logo:</div><div class=\"line\">    external: true</div><div class=\"line\">    family:</div><div class=\"line\">    size:</div><div class=\"line\"></div><div class=\"line\">  # Font settings for &lt;code&gt; and code blocks.</div><div class=\"line\">  codes:</div><div class=\"line\">    external: true</div><div class=\"line\">    family:</div><div class=\"line\">    size:</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Third Party Services Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># Math Equations Render Support</div><div class=\"line\">math:</div><div class=\"line\">  enable: false</div><div class=\"line\"></div><div class=\"line\">  # Default(true) will load mathjax/katex script on demand</div><div class=\"line\">  # That is it only render those page who has &apos;mathjax: true&apos; in Front Matter.</div><div class=\"line\">  # If you set it to false, it will load mathjax/katex srcipt EVERY PAGE.</div><div class=\"line\">  per_page: true</div><div class=\"line\"></div><div class=\"line\">  engine: mathjax</div><div class=\"line\">  #engine: katex</div><div class=\"line\"></div><div class=\"line\">  # hexo-rendering-pandoc (or hexo-renderer-kramed) needed to full MathJax support.</div><div class=\"line\">  mathjax:</div><div class=\"line\">    # Use 2.7.1 as default, jsdelivr as default CDN, works everywhere even in China</div><div class=\"line\">    cdn: //cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML</div><div class=\"line\">    # For newMathJax CDN (cdnjs.cloudflare.com) with fallback to oldMathJax (cdn.mathjax.org).</div><div class=\"line\">    #cdn: //cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML</div><div class=\"line\">    # For direct link to MathJax.js with CloudFlare CDN (cdnjs.cloudflare.com).</div><div class=\"line\">    #cdn: //cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML</div><div class=\"line\">    # For automatic detect latest version link to MathJax.js and get from Bootcss.</div><div class=\"line\">    #cdn: //cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML</div><div class=\"line\"></div><div class=\"line\">  # hexo-renderer-markdown-it-plus (or hexo-renderer-markdown-it with markdown-it-katex plugin)</div><div class=\"line\">  # needed to full Katex support.</div><div class=\"line\">  katex:</div><div class=\"line\">    # Use 0.7.1 as default, jsdelivr as default CDN, works everywhere even in China</div><div class=\"line\">    cdn: //cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css</div><div class=\"line\">    # CDNJS, provided by cloudflare, maybe the best CDN, but not works in China</div><div class=\"line\">    #cdn: //cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css</div><div class=\"line\">    # Bootcss, works great in China, but not so well in other region</div><div class=\"line\">    #cdn: //cdn.bootcss.com/KaTeX/0.7.1/katex.min.css</div><div class=\"line\"></div><div class=\"line\"># Han Support</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-han</div><div class=\"line\"># 汉字标准格式，没用过暂时不了解</div><div class=\"line\">han: false</div><div class=\"line\"></div><div class=\"line\"># Pangu Support</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-pangu</div><div class=\"line\"># For more information: https://github.com/vinta/pangu.js</div><div class=\"line\">pangu: false</div><div class=\"line\"></div><div class=\"line\"># Swiftype Search API Key</div><div class=\"line\">#swiftype_key:</div><div class=\"line\"></div><div class=\"line\"># Baidu Analytics ID</div><div class=\"line\">#baidu_analytics:</div><div class=\"line\"></div><div class=\"line\"># Disqus</div><div class=\"line\">disqus:</div><div class=\"line\">  enable: false</div><div class=\"line\">  shortname:</div><div class=\"line\">  count: true</div><div class=\"line\">  lazyload: false</div><div class=\"line\"></div><div class=\"line\"># Hypercomments</div><div class=\"line\">#hypercomments_id:</div><div class=\"line\"></div><div class=\"line\"># changyan</div><div class=\"line\">changyan:</div><div class=\"line\">  enable: false</div><div class=\"line\">  appid:</div><div class=\"line\">  appkey:</div><div class=\"line\"></div><div class=\"line\"># leanCloud支持的评论插件</div><div class=\"line\"># Valine. </div><div class=\"line\"># You can get your appid and appkey from https://leancloud.cn</div><div class=\"line\"># more info please open https://valine.js.org</div><div class=\"line\">valine:</div><div class=\"line\">  enable: false</div><div class=\"line\">  appid:  P08Jh3wwb2zPhfm9puCevcUa-*******</div><div class=\"line\">  appkey:  CnhNSWBKT3kwj52v********</div><div class=\"line\">  notify: false # mail notifier , https://github.com/xCss/Valine/wiki</div><div class=\"line\">  verify: false # Verification code</div><div class=\"line\">  placeholder: Just go go # comment box placeholder</div><div class=\"line\">  avatar: mm # gravatar style</div><div class=\"line\">  guest_info: nick,mail,link # custom comment header</div><div class=\"line\">  pageSize: 10 # pagination size</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># Support for youyan comments system.</div><div class=\"line\"># You can get your uid from http://www.uyan.cc</div><div class=\"line\">#youyan_uid: your uid</div><div class=\"line\"></div><div class=\"line\"># Support for LiveRe comments system.</div><div class=\"line\"># You can get your uid from https://livere.com/insight/myCode (General web site)</div><div class=\"line\">livere_uid: MTAyMC8yODQwNi******</div><div class=\"line\"></div><div class=\"line\"># Gitment</div><div class=\"line\"># Introduction: https://imsun.net/posts/gitment-introduction/</div><div class=\"line\">gitment:</div><div class=\"line\">  enable: false</div><div class=\"line\">  mint: true # RECOMMEND, A mint on Gitment, to support count, language and proxy_gateway</div><div class=\"line\">  count: true # Show comments count in post meta area</div><div class=\"line\">  lazy: false # Comments lazy loading with a button</div><div class=\"line\">  cleanly: false # Hide &apos;Powered by ...&apos; on footer, and more</div><div class=\"line\">  language: # Force language, or auto switch by theme</div><div class=\"line\">  github_user: # MUST HAVE, Your Github Username</div><div class=\"line\">  github_repo: # MUST HAVE, The name of the repo you use to store Gitment comments</div><div class=\"line\">  client_id: # MUST HAVE, Github client id for the Gitment</div><div class=\"line\">  client_secret: # EITHER this or proxy_gateway, Github access secret token for the Gitment</div><div class=\"line\">  proxy_gateway: # Address of api proxy, See: https://github.com/aimingoo/intersect</div><div class=\"line\">  redirect_protocol: # Protocol of redirect_uri with force_redirect_protocol when mint enabled</div><div class=\"line\"></div><div class=\"line\"># Baidu Share</div><div class=\"line\"># Available value:</div><div class=\"line\">#    button | slide</div><div class=\"line\"># Warning: Baidu Share does not support https.</div><div class=\"line\">#baidushare:</div><div class=\"line\">##  type: button</div><div class=\"line\"></div><div class=\"line\"># Share</div><div class=\"line\"># This plugin is more useful in China, make sure you known how to use it.</div><div class=\"line\"># And you can find the use guide at official webiste: http://www.jiathis.com/.</div><div class=\"line\"># Warning: JiaThis does not support https.</div><div class=\"line\">#jiathis:</div><div class=\"line\">  ##uid: Get this uid from http://www.jiathis.com/</div><div class=\"line\"></div><div class=\"line\">#add_this_id:</div><div class=\"line\"></div><div class=\"line\"># NeedMoreShare2</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-needmoreshare2</div><div class=\"line\"># See: https://github.com/revir/need-more-share2</div><div class=\"line\"># Also see: https://github.com/DzmVasileusky/needShareButton</div><div class=\"line\"># iconStyle: default | box</div><div class=\"line\"># boxForm: horizontal | vertical</div><div class=\"line\"># position: top / middle / bottom + Left / Center / Right</div><div class=\"line\"># networks: Weibo,Wechat,Douban,QQZone,Twitter,Linkedin,Mailto,Reddit,</div><div class=\"line\">#           Delicious,StumbleUpon,Pinterest,Facebook,GooglePlus,Slashdot,</div><div class=\"line\">#           Technorati,Posterous,Tumblr,GoogleBookmarks,Newsvine,</div><div class=\"line\">#           Evernote,Friendfeed,Vkontakte,Odnoklassniki,Mailru</div><div class=\"line\">needmoreshare2:</div><div class=\"line\">  enable: false</div><div class=\"line\">  postbottom:</div><div class=\"line\">    enable: false</div><div class=\"line\">    options:</div><div class=\"line\">      iconStyle: box</div><div class=\"line\">      boxForm: horizontal</div><div class=\"line\">      position: bottomCenter</div><div class=\"line\">      networks: Weibo,Wechat,Douban,QQZone,Twitter,Facebook</div><div class=\"line\">  float:</div><div class=\"line\">    enable: false</div><div class=\"line\">    options:</div><div class=\"line\">      iconStyle: box</div><div class=\"line\">      boxForm: horizontal</div><div class=\"line\">      position: middleRight</div><div class=\"line\">      networks: Weibo,Wechat,Douban,QQZone,Twitter,Facebook</div><div class=\"line\"></div><div class=\"line\"># Google Webmaster tools verification setting</div><div class=\"line\"># See: https://www.google.com/webmasters/</div><div class=\"line\">#google_site_verification:</div><div class=\"line\"></div><div class=\"line\"># Google Analytics</div><div class=\"line\">#google_analytics:</div><div class=\"line\"></div><div class=\"line\"># Bing Webmaster tools verification setting</div><div class=\"line\"># See: https://www.bing.com/webmaster/</div><div class=\"line\">#bing_site_verification:</div><div class=\"line\"></div><div class=\"line\"># Yandex Webmaster tools verification setting</div><div class=\"line\"># See: https://webmaster.yandex.ru/</div><div class=\"line\">#yandex_site_verification:</div><div class=\"line\"></div><div class=\"line\"># CNZZ count</div><div class=\"line\">#cnzz_siteid:</div><div class=\"line\"></div><div class=\"line\"># Application Insights</div><div class=\"line\"># See https://azure.microsoft.com/en-us/services/application-insights/</div><div class=\"line\"># application_insights:</div><div class=\"line\"></div><div class=\"line\"># Post widgets &amp; FB/VK comments settings.</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Facebook SDK Support.</div><div class=\"line\"># https://github.com/iissnan/hexo-theme-next/pull/410</div><div class=\"line\">facebook_sdk:</div><div class=\"line\">  enable:       false</div><div class=\"line\">  app_id:       #&lt;app_id&gt;</div><div class=\"line\">  fb_admin:     #&lt;user_id&gt;</div><div class=\"line\">  like_button:  #true</div><div class=\"line\">  webmaster:    #true</div><div class=\"line\"></div><div class=\"line\"># Facebook comments plugin</div><div class=\"line\"># This plugin depends on Facebook SDK.</div><div class=\"line\"># If facebook_sdk.enable is false, Facebook comments plugin is unavailable.</div><div class=\"line\">facebook_comments_plugin:</div><div class=\"line\">  enable:       false</div><div class=\"line\">  num_of_posts: 10    # min posts num is 1</div><div class=\"line\">  width:        100%  # default width is 550px</div><div class=\"line\">  scheme:       light # default scheme is light (light or dark)</div><div class=\"line\"></div><div class=\"line\"># VKontakte API Support.</div><div class=\"line\"># To get your AppID visit https://vk.com/editapp?act=create</div><div class=\"line\">vkontakte_api:</div><div class=\"line\">  enable:       false</div><div class=\"line\">  app_id:       #&lt;app_id&gt;</div><div class=\"line\">  like:         true</div><div class=\"line\">  comments:     true</div><div class=\"line\">  num_of_posts: 10</div><div class=\"line\"></div><div class=\"line\"># Star rating support to each article.</div><div class=\"line\"># To get your ID visit https://widgetpack.com</div><div class=\"line\">rating:</div><div class=\"line\">  enable: false</div><div class=\"line\">  id:     #&lt;app_id&gt;</div><div class=\"line\">  color:  fc6423</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># Show number of visitors to each article.</div><div class=\"line\"># You can visit https://leancloud.cn get AppID and AppKey.</div><div class=\"line\">leancloud_visitors:</div><div class=\"line\">  enable: false</div><div class=\"line\">  app_id: P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz</div><div class=\"line\">  app_key: CnhNSWBKT3kwj52vyJ36armb</div><div class=\"line\">  # Dependencies: https://github.com/theme-next/hexo-leancloud-counter-security</div><div class=\"line\">  # If you don&apos;t care about security in lc counter and just want to use it directly</div><div class=\"line\">  # (without hexo-leancloud-counter-security plugin), set the `security` to `false`.</div><div class=\"line\">  security: true</div><div class=\"line\">  betterPerformance: false</div><div class=\"line\"></div><div class=\"line\"># Another tool to show number of visitors to each article.</div><div class=\"line\"># visit https://console.firebase.google.com/u/0/ to get apiKey and projectId</div><div class=\"line\"># visit https://firebase.google.com/docs/firestore/ to get more information about firestore</div><div class=\"line\">firestore:</div><div class=\"line\">  enable: false</div><div class=\"line\">  collection: articles #required, a string collection name to access firestore database</div><div class=\"line\">  apiKey: #required</div><div class=\"line\">  projectId: #required</div><div class=\"line\">  bluebird: false #enable this if you want to include bluebird 3.5.1(core version) Promise polyfill</div><div class=\"line\"></div><div class=\"line\"># Show Views/Visitors of the website/page with busuanzi.</div><div class=\"line\"># Get more information on http://ibruce.info/2015/04/04/busuanzi/</div><div class=\"line\">busuanzi_count:</div><div class=\"line\">  enable: true</div><div class=\"line\">  total_visitors: true</div><div class=\"line\">  total_visitors_icon: user</div><div class=\"line\">  total_views: true</div><div class=\"line\">  total_views_icon: eye</div><div class=\"line\">  post_views: true</div><div class=\"line\">  post_views_icon: eye</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># Tencent analytics ID</div><div class=\"line\"># tencent_analytics:</div><div class=\"line\"></div><div class=\"line\"># Tencent MTA ID</div><div class=\"line\"># tencent_mta:</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># Enable baidu push so that the blog will push the url to baidu automatically which is very helpful for SEO</div><div class=\"line\">baidu_push: false</div><div class=\"line\"></div><div class=\"line\"># Google Calendar</div><div class=\"line\"># Share your recent schedule to others via calendar page</div><div class=\"line\">#</div><div class=\"line\"># API Documentation:</div><div class=\"line\"># https://developers.google.com/google-apps/calendar/v3/reference/events/list</div><div class=\"line\">calendar:</div><div class=\"line\">  enable: false</div><div class=\"line\">  calendar_id: &lt;required&gt;</div><div class=\"line\">  api_key: &lt;required&gt;</div><div class=\"line\">  orderBy: startTime</div><div class=\"line\">  offsetMax: 24</div><div class=\"line\">  offsetMin: 4</div><div class=\"line\">  timeZone:</div><div class=\"line\">  showDeleted: false</div><div class=\"line\">  singleEvents: true</div><div class=\"line\">  maxResults: 250</div><div class=\"line\"></div><div class=\"line\"># Algolia Search</div><div class=\"line\"># See: https://github.com/theme-next/hexo-theme-next/blob/master/docs/ALGOLIA-SEARCH.md</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-algolia-instant-search</div><div class=\"line\">algolia_search:</div><div class=\"line\">  enable: false</div><div class=\"line\">  hits:</div><div class=\"line\">    per_page: 10</div><div class=\"line\">  labels:</div><div class=\"line\">    input_placeholder: Search for Posts</div><div class=\"line\">    hits_empty: &quot;We didn&apos;t find any results for the search: $&#123;query&#125;&quot;</div><div class=\"line\">    hits_stats: &quot;$&#123;hits&#125; results found in $&#123;time&#125; ms&quot;</div><div class=\"line\"></div><div class=\"line\"># Local search</div><div class=\"line\"># Dependencies: https://github.com/theme-next/hexo-generator-searchdb</div><div class=\"line\"># 要安装插件才能使用，先进入站点文件夹根目录</div><div class=\"line\">#  然后：npm install hexo-generator-searchdb --save</div><div class=\"line\">local_search:</div><div class=\"line\">  enable: true</div><div class=\"line\">  # if auto, trigger search by changing input</div><div class=\"line\">  # if manual, trigger search by pressing enter key or search button</div><div class=\"line\">  trigger: auto</div><div class=\"line\">  # show top n results per article, show all results by setting to -1</div><div class=\"line\">  top_n_per_article: 1</div><div class=\"line\">  # unescape html strings to the readable one</div><div class=\"line\">  unescape: false</div><div class=\"line\"></div><div class=\"line\"># Bookmark Support</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-bookmark</div><div class=\"line\">bookmark:</div><div class=\"line\">  enable: false</div><div class=\"line\">  # if auto</div><div class=\"line\">  #   - save the reading position when closing the page</div><div class=\"line\">  #   - or clicking the bookmark-icon</div><div class=\"line\">  # if manual, only save it by clicking the bookmark-icon</div><div class=\"line\">  save: auto</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"># Tags Settings</div><div class=\"line\"># ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># External URL with BASE64 encrypt &amp; decrypt.</div><div class=\"line\"># Usage: &#123;% exturl text url &quot;title&quot; %&#125;</div><div class=\"line\"># Alias: &#123;% extlink text url &quot;title&quot; %&#125;</div><div class=\"line\"># 用法见：</div><div class=\"line\"># https://github.com/iissnan/hexo-theme-next/pull/1438</div><div class=\"line\">exturl: false</div><div class=\"line\"></div><div class=\"line\"># 主题的标签样式，有 note、label、tabs 三种</div><div class=\"line\"># Note tag (bs-callout).</div><div class=\"line\">note:</div><div class=\"line\">  # Note tag style values:</div><div class=\"line\">  #  - simple    bs-callout old alert style. Default.</div><div class=\"line\">  #  - modern    bs-callout new (v2-v3) alert style.</div><div class=\"line\">  #  - flat      flat callout style with background, like on Mozilla or StackOverflow.</div><div class=\"line\">  #  - disabled  disable all CSS styles import of note tag.</div><div class=\"line\">  style: simple</div><div class=\"line\">  icons: false</div><div class=\"line\">  border_radius: 3</div><div class=\"line\">  # Offset lighter of background in % for modern and flat styles (modern: -12 | 12; flat: -18 | 6).</div><div class=\"line\">  # Offset also applied to label tag variables. This option can work with disabled note tag.</div><div class=\"line\">  light_bg_offset: 0</div><div class=\"line\"></div><div class=\"line\"># Label tag.</div><div class=\"line\">label: true</div><div class=\"line\"></div><div class=\"line\"># Tabs tag.</div><div class=\"line\">tabs:</div><div class=\"line\">  enable: true</div><div class=\"line\">  transition:</div><div class=\"line\">    tabs: false</div><div class=\"line\">    labels: true</div><div class=\"line\">  border_radius: 0</div><div class=\"line\"></div><div class=\"line\"># Reading progress bar</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-reading-progress</div><div class=\"line\">reading_progress:</div><div class=\"line\">  enable: false</div><div class=\"line\">  color: &quot;#37c6c0&quot;</div><div class=\"line\">  height: 2px</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">#! ---------------------------------------------------------------</div><div class=\"line\">#! DO NOT EDIT THE FOLLOWING SETTINGS</div><div class=\"line\">#! UNLESS YOU KNOW WHAT YOU ARE DOING</div><div class=\"line\">#! ---------------------------------------------------------------</div><div class=\"line\"></div><div class=\"line\"># 动画</div><div class=\"line\"># Use velocity to animate everything.</div><div class=\"line\">motion:</div><div class=\"line\">  enable: true</div><div class=\"line\">  async: false</div><div class=\"line\">  transition:</div><div class=\"line\">    # Transition variants:</div><div class=\"line\">    # fadeIn | fadeOut | flipXIn | flipXOut | flipYIn | flipYOut | flipBounceXIn | flipBounceXOut | flipBounceYIn | flipBounceYOut</div><div class=\"line\">    # swoopIn | swoopOut | whirlIn | whirlOut | shrinkIn | shrinkOut | expandIn | expandOut</div><div class=\"line\">    # bounceIn | bounceOut | bounceUpIn | bounceUpOut | bounceDownIn | bounceDownOut | bounceLeftIn | bounceLeftOut | bounceRightIn | bounceRightOut</div><div class=\"line\">    # slideUpIn | slideUpOut | slideDownIn | slideDownOut | slideLeftIn | slideLeftOut | slideRightIn | slideRightOut</div><div class=\"line\">    # slideUpBigIn | slideUpBigOut | slideDownBigIn | slideDownBigOut | slideLeftBigIn | slideLeftBigOut | slideRightBigIn | slideRightBigOut</div><div class=\"line\">    # perspectiveUpIn | perspectiveUpOut | perspectiveDownIn | perspectiveDownOut | perspectiveLeftIn | perspectiveLeftOut | perspectiveRightIn | perspectiveRightOut</div><div class=\"line\">    post_block: fadeIn</div><div class=\"line\">    post_header: slideDownIn</div><div class=\"line\">    post_body: slideDownIn</div><div class=\"line\">    coll_header: slideLeftIn</div><div class=\"line\">    # Only for Pisces | Gemini.</div><div class=\"line\">    sidebar: slideUpIn</div><div class=\"line\"></div><div class=\"line\"># Fancybox. There is support for old version 2 and new version 3.</div><div class=\"line\"># Please, choose only any one variant, do not need to install both.</div><div class=\"line\"># For install 2.x: https://github.com/theme-next/theme-next-fancybox</div><div class=\"line\"># For install 3.x: https://github.com/theme-next/theme-next-fancybox3</div><div class=\"line\"># 查看图片的</div><div class=\"line\">fancybox: false</div><div class=\"line\"></div><div class=\"line\"># Added switch option for separated repo in 6.0.0.</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-fastclick</div><div class=\"line\">fastclick: false</div><div class=\"line\"></div><div class=\"line\"># Added switch option for separated repo in 6.0.0.</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-jquery-lazyload</div><div class=\"line\">lazyload: false</div><div class=\"line\"></div><div class=\"line\"># Progress bar in the top during page loading.</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-pace</div><div class=\"line\">pace: false</div><div class=\"line\"># Themes list:</div><div class=\"line\">#pace-theme-big-counter</div><div class=\"line\">#pace-theme-bounce</div><div class=\"line\">#pace-theme-barber-shop</div><div class=\"line\">#pace-theme-center-atom</div><div class=\"line\">#pace-theme-center-circle</div><div class=\"line\">#pace-theme-center-radar</div><div class=\"line\">#pace-theme-center-simple</div><div class=\"line\">#pace-theme-corner-indicator</div><div class=\"line\">#pace-theme-fill-left</div><div class=\"line\">#pace-theme-flash</div><div class=\"line\">#pace-theme-loading-bar</div><div class=\"line\">#pace-theme-mac-osx</div><div class=\"line\">#pace-theme-minimal</div><div class=\"line\"># For example</div><div class=\"line\"># pace_theme: pace-theme-center-simple</div><div class=\"line\">pace_theme: pace-theme-minimal</div><div class=\"line\"></div><div class=\"line\"># Canvas-nest</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-canvas-nest</div><div class=\"line\">canvas_nest: true</div><div class=\"line\"></div><div class=\"line\"># JavaScript 3D library.</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-three</div><div class=\"line\"># three_waves</div><div class=\"line\">three_waves: false</div><div class=\"line\"># canvas_lines</div><div class=\"line\">canvas_lines: false</div><div class=\"line\"># canvas_sphere</div><div class=\"line\">canvas_sphere: false</div><div class=\"line\"></div><div class=\"line\"># Only fit scheme Pisces</div><div class=\"line\"># Dependencies: https://github.com/theme-next/theme-next-canvas-ribbon</div><div class=\"line\"># Canvas-ribbon</div><div class=\"line\"># size: The width of the ribbon.</div><div class=\"line\"># alpha: The transparency of the ribbon.</div><div class=\"line\"># zIndex: The display level of the ribbon.</div><div class=\"line\">canvas_ribbon:</div><div class=\"line\">  enable: false</div><div class=\"line\">  size: 300</div><div class=\"line\">  alpha: 0.6</div><div class=\"line\">  zIndex: -1</div><div class=\"line\"></div><div class=\"line\"># Script Vendors.</div><div class=\"line\"># Set a CDN address for the vendor you want to customize.</div><div class=\"line\"># For example</div><div class=\"line\">#    jquery: https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js</div><div class=\"line\"># Be aware that you should use the same version as internal ones to avoid potential problems.</div><div class=\"line\"># Please use the https protocol of CDN files when you enable https on your site.</div><div class=\"line\"># 相关内容用 CDN 地址取代，加速网站访问，注意版本尽可能要一致</div><div class=\"line\">vendors:</div><div class=\"line\">  # Internal path prefix. Please do not edit it.</div><div class=\"line\">  _internal: lib</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 2.1.3</div><div class=\"line\">  jquery:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 2.1.5</div><div class=\"line\">  # See: http://fancyapps.com/fancybox/</div><div class=\"line\">  fancybox:</div><div class=\"line\">  fancybox_css:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 1.0.6</div><div class=\"line\">  # See: https://github.com/ftlabs/fastclick</div><div class=\"line\">  fastclick:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 1.9.7</div><div class=\"line\">  # See: https://github.com/tuupola/jquery_lazyload</div><div class=\"line\">  lazyload:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 1.2.1</div><div class=\"line\">  # See: http://VelocityJS.org</div><div class=\"line\">  velocity:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 1.2.1</div><div class=\"line\">  # See: http://VelocityJS.org</div><div class=\"line\">  velocity_ui:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 0.7.9</div><div class=\"line\">  # See: https://faisalman.github.io/ua-parser-js/</div><div class=\"line\">  ua_parser:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 4.6.2</div><div class=\"line\">  # See: http://fontawesome.io/</div><div class=\"line\">  fontawesome:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 1</div><div class=\"line\">  # https://www.algolia.com</div><div class=\"line\">  algolia_instant_js:</div><div class=\"line\">  algolia_instant_css:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 1.0.2</div><div class=\"line\">  # See: https://github.com/HubSpot/pace</div><div class=\"line\">  # Or use direct links below:</div><div class=\"line\">  # pace: //cdn.bootcss.com/pace/1.0.2/pace.min.js</div><div class=\"line\">  # pace_css: //cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-flash.min.css</div><div class=\"line\">  pace:</div><div class=\"line\">  pace_css:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 1.0.0</div><div class=\"line\">  # https://github.com/hustcc/canvas-nest.js</div><div class=\"line\">  canvas_nest: </div><div class=\"line\"></div><div class=\"line\">  # three</div><div class=\"line\">  three:</div><div class=\"line\"></div><div class=\"line\">  # three_waves</div><div class=\"line\">  # https://github.com/jjandxa/three_waves</div><div class=\"line\">  three_waves:</div><div class=\"line\"></div><div class=\"line\">  # three_waves</div><div class=\"line\">  # https://github.com/jjandxa/canvas_lines</div><div class=\"line\">  canvas_lines:</div><div class=\"line\"></div><div class=\"line\">  # three_waves</div><div class=\"line\">  # https://github.com/jjandxa/canvas_sphere</div><div class=\"line\">  canvas_sphere:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 1.0.0</div><div class=\"line\">  # https://github.com/zproo/canvas-ribbon</div><div class=\"line\">  canvas_ribbon:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 3.3.0</div><div class=\"line\">  # https://github.com/ethantw/Han</div><div class=\"line\">  han:</div><div class=\"line\"></div><div class=\"line\">  # Internal version: 3.3.0</div><div class=\"line\">  # https://github.com/vinta/pangu.js</div><div class=\"line\">  pangu:</div><div class=\"line\"></div><div class=\"line\">  # needMoreShare2</div><div class=\"line\">  # https://github.com/revir/need-more-share2</div><div class=\"line\">  needmoreshare2_js:</div><div class=\"line\">  needmoreshare2_css:</div><div class=\"line\"></div><div class=\"line\">  # bookmark</div><div class=\"line\">  # Internal version: 1.0.0</div><div class=\"line\">  # https://github.com/theme-next/theme-next-bookmark</div><div class=\"line\">  bookmark:</div><div class=\"line\"></div><div class=\"line\">  # reading_progress</div><div class=\"line\">  # Internal version: 1.0</div><div class=\"line\">  # https://github.com/theme-next/theme-next-reading-progress</div><div class=\"line\">  # Example: https://cdn.jsdelivr.net/gh/theme-next/theme-next-reading-progress@1.1/reading_progress.min.js</div><div class=\"line\">  reading_progress:</div><div class=\"line\"></div><div class=\"line\">  # valine comment</div><div class=\"line\">  # Example: https://cdn.jsdelivr.net/npm/valine@1.1.8/dist/Valine.min.js</div><div class=\"line\">  valine:</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"># Assets</div><div class=\"line\">css: css</div><div class=\"line\">js: js</div><div class=\"line\">images: images</div><div class=\"line\"></div><div class=\"line\"># Theme version</div><div class=\"line\">version: 6.0.6</div></pre></td></tr></table></figure></p>\n<h3 id=\"2-4-动态背景\"><a href=\"#2-4-动态背景\" class=\"headerlink\" title=\"2.4 动态背景\"></a>2.4 动态背景</h3><p>在主题配置文件中，靠后面，改canvas_nest: true，想要更改颜色和数量？修改文件：</p>\n<p>文件位置：~/blog/themes/next/source/lib/canvas-nest/canvas-nest.min.js</p>\n<p>怎么修改？参考<a href=\"https://github.com/hustcc/canvas-nest.js/blob/master/README-zh.md\" target=\"_blank\" rel=\"noopener\">canvas-nest.js</a>。</p>\n<h3 id=\"2-5-注脚\"><a href=\"#2-5-注脚\" class=\"headerlink\" title=\"2.5 注脚\"></a>2.5 注脚</h3><p>参考<a href=\"https://github.com/LouisBarranqueiro/hexo-footnotes\" target=\"_blank\" rel=\"noopener\">hexo-footnotes</a>。</p>\n<h2 id=\"3-优化-高级功能配置\"><a href=\"#3-优化-高级功能配置\" class=\"headerlink\" title=\"3.优化:高级功能配置\"></a>3.优化:高级功能配置</h2><h3 id=\"3-1-大佬们的文章\"><a href=\"#3-1-大佬们的文章\" class=\"headerlink\" title=\"3.1 大佬们的文章\"></a>3.1 大佬们的文章</h3><p>更多如外挂一样的功能配置，就直接贴大佬的文章了，哪些功能自己喜欢，按照大佬的教程来配置就行。不过也有坑，比如有些功能（超链接样式、侧栏头像圆形并旋转）可以直接通过在custom.styl添加 CSS 代码实现，无需更改其它文件！</p>\n<ol>\n<li><a href=\"https://reuixiy.github.io/technology/computer/computer-aided-art/2017/06/09/hexo-next-optimization.html\" target=\"_blank\" rel=\"noopener\">打造个性超赞博客Hexo+NexT+GithubPages的超深度优化</a></li>\n<li><a href=\"http://cherryblog.site/Hexo-high-level-tutorialcloudmusic,bg-customthemes-statistical.html\" target=\"_blank\" rel=\"noopener\">hexo高阶教程next主题优化</a></li>\n<li><a href=\"http://shenzekun.cn/hexo%E7%9A%84next%E4%B8%BB%E9%A2%98%E4%B8%AA%E6%80%A7%E5%8C%96%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B.html\" target=\"_blank\" rel=\"noopener\">hexo的next主题个性化教程:打造炫酷网站</a></li>\n<li><a href=\"http://www.dingxuewen.com/categories/Site/\" target=\"_blank\" rel=\"noopener\">Hexo搭建博客的个性化设置</a></li>\n</ol>\n<h3 id=\"3-2-鼠标点击效果\"><a href=\"#3-2-鼠标点击效果\" class=\"headerlink\" title=\"3.2 鼠标点击效果\"></a>3.2 鼠标点击效果</h3><ol>\n<li>新建mouse.js，复制<a href=\"https://github.com/kevinXiao2016/kevinXiao2016.github.io/blob/hexo/source/love.js\" target=\"_blank\" rel=\"noopener\">love</a>或者<a href=\"https://github.com/kevinXiao2016/kevinXiao2016.github.io/blob/hexo/source/mouse.js\" target=\"_blank\" rel=\"noopener\">富强民主…</a>中的内容到js文件中。</li>\n<li>将mouse.js放到<strong>/themes/next/source/js/src</strong>路径下</li>\n<li><p>打开/themes/next/layout/layout.swig文件，添加如下代码：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;script type=<span class=\"string\">\"text/javascript\"</span> src=<span class=\"string\">\"/js/src/mouse.js\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"3-3-文章加密\"><a href=\"#3-3-文章加密\" class=\"headerlink\" title=\"3.3 文章加密\"></a>3.3 文章加密</h3><p>参考：<a href=\"https://github.com/MikeCoder/hexo-blog-encrypt/blob/master/ReadMe.zh.md\" target=\"_blank\" rel=\"noopener\">hexo-blog-encrypt</a></p>\n<ol>\n<li><p>在博客根目录下的package.json文件中添加一行代码</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">\"hexo-blog-encrypt\": \"2.0.*\"</div></pre></td></tr></table></figure>\n</li>\n<li><p>在博客根目录下：  <strong>npm install</strong></p>\n</li>\n<li><p>在站点配置文件中配置文章加密</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"># Security</div><div class=\"line\">encrypt:</div><div class=\"line\">    enable: true</div></pre></td></tr></table></figure>\n</li>\n<li><p>然后在你的文章的头部添加上对应的字段，如 password, abstract, message</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">title: hello world</div><div class=\"line\">date: 2016-03-30 21:18:02</div><div class=\"line\">tags:</div><div class=\"line\"><span class=\"code\">    - fdsafsdaf</span></div><div class=\"line\">password: Mike</div><div class=\"line\">abstract: 没点开文章前显示的类容，类似于<span class=\"xml\"><span class=\"comment\">&lt;!--more--&gt;</span></span>之前写的描述.</div><div class=\"line\">message: 点开文章后，提示输入密码的信息.</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"3-4-博客推广及SEO优化\"><a href=\"#3-4-博客推广及SEO优化\" class=\"headerlink\" title=\"3.4 博客推广及SEO优化\"></a>3.4 博客推广及SEO优化</h3><p>建站完成后百度和Google是没有收录我们的网站的，想要搜索到我们的博客非常困难。因此优化搜索非常有必要。</p>\n<p><strong>博客推广</strong></p>\n<p>博客推广第一步，手动推广。</p>\n<p>你可以多浏览别人的博客并留下你的爪印（博客地址），比如 评论 本文；你可以去 <a href=\"https://github.com/iissnan/hexo-theme-next#live-preview\" target=\"_blank\" rel=\"noopener\">README.md</a>中提到的 <a href=\"https://github.com/iissnan/hexo-theme-next/issues/119\" target=\"_blank\" rel=\"noopener\">这个issue</a> 留下你的爪印；你可以去 <a href=\"https://github.com/iissnan/hexo-theme-next/issuess://github.com/iissnan/hexo-theme-next/issues/119\" target=\"_blank\" rel=\"noopener\">Issues页面</a> 试着回答下大家的问题并留下你的爪印。</p>\n<p>博客推广第二步，<a href=\"https://baike.baidu.com/item/SEO\" target=\"_blank\" rel=\"noopener\">SEO</a>（Search Engine Optimization）。</p>\n<p><strong>搜索引擎</strong></p>\n<p>直接推荐大佬文章：<a href=\"http://www.ehcoo.com/seo.html\" target=\"_blank\" rel=\"noopener\">【搜索优化】Hexo-next百度和谷歌搜索优化</a></p>\n<h3 id=\"3-5-随机生成背景图\"><a href=\"#3-5-随机生成背景图\" class=\"headerlink\" title=\"3.5 随机生成背景图\"></a>3.5 随机生成背景图</h3><p>在主题下的/source/css/_custom/custom.style文件中，添加如下代码：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-tag\">body</span>&#123;   </div><div class=\"line\">\t<span class=\"attribute\">background</span>:<span class=\"built_in\">url</span>(https://source.unsplash.com/random/1920x1080);</div><div class=\"line\">\t<span class=\"attribute\">background-size</span>:cover;</div><div class=\"line\">\t<span class=\"attribute\">background-repeat</span>:no-repeat;</div><div class=\"line\">\t<span class=\"attribute\">background-attachment</span>:fixed;</div><div class=\"line\">\t<span class=\"attribute\">background-position</span>:<span class=\"number\">50%</span> <span class=\"number\">50%</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"selector-class\">.main-inner</span> &#123; </div><div class=\"line\">    <span class=\"attribute\">margin-top</span>: <span class=\"number\">60px</span>;</div><div class=\"line\">    <span class=\"attribute\">padding</span>: <span class=\"number\">60px</span> <span class=\"number\">60px</span> <span class=\"number\">60px</span> <span class=\"number\">60px</span>;</div><div class=\"line\">    <span class=\"attribute\">background</span>: <span class=\"number\">#fff</span>;</div><div class=\"line\">    <span class=\"attribute\">opacity</span>: <span class=\"number\">0.8</span>;</div><div class=\"line\">    <span class=\"attribute\">min-height</span>: <span class=\"number\">500px</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"3-6-背景动画\"><a href=\"#3-6-背景动画\" class=\"headerlink\" title=\"3.6 背景动画\"></a>3.6 背景动画</h3><p>依赖于<a href=\"https://github.com/theme-next/theme-next-canvas-nest\" target=\"_blank\" rel=\"noopener\">theme-next-canvas-nest</a>,或者<a href=\"https://github.com/theme-next/theme-next-three\" target=\"_blank\" rel=\"noopener\">3D library</a>。</p>\n<ol>\n<li>进入到主题目录，如：cd themes/next</li>\n<li><p>下载插件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">git clone https://github.com/theme-next/theme-next-canvas-nest source/lib/canvas-nest</div><div class=\"line\">git clone https://github.com/theme-next/theme-next-three source/lib/three</div></pre></td></tr></table></figure>\n</li>\n<li><p>在主题配置文件中开启，一次只开启一个</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">canvas_nest: false</div><div class=\"line\"></div><div class=\"line\">three_waves: false</div><div class=\"line\">canvas_lines: true</div><div class=\"line\">canvas_sphere: false</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>插件更新</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ cd themes/next/source/lib/canvas-nest</div><div class=\"line\">$ git pull</div></pre></td></tr></table></figure>\n</li>\n</ol>"},{"title":"SNMP学习总结(3)——SNMP4J","date":"2017-05-25T00:42:50.000Z","_content":"这篇博客简要介绍了snmp4j协议栈的基本使用\n<!-- more -->\n## 1 snmp4j简介\n　　SNMP4J是一个用Java来实现SNMP(简单网络管理协议)协议的开源项目.它支持以命令行的形式进行管理与响应。SNMP4J是纯面向对象设计与SNMP++(用C++实现SNMPv1/v2c/v3)相类似。\n　　SNMP4J API 提供以下下特性：\n\n         - 支持MD5和SHA验证，DES，3DES,AES128、AES192和AES256加密的SNMPv3。\n         - 支持MPv1,MPv2C和MPv3，带执行的可阻塞的信息处理模块。\n         - 全部PDU格式。\n         - 可阻塞的传输拓扑。支持UPD、TCP、TLS 。\n         - 可阻塞的超时模块。\n         - 同步和异步请求。\n         - 命令发生器以及命令应答器的支持。\n         - 基于Apache license的开源免费。\n         - JAVA 1.4.1或更高版本(2.0或更高版本需要jdk1.6及以上的支持)。\n         - 基于LOG4J记录日志。\n         - 使用GETBULK实现Row-based的有效的异步表格获取。\n         - 支持多线程。\n         \n## 2 snmp4j重要的类及接口介绍\nSnmp4j包中最重要的三个概念，也是三个类：**Snmp**、**Target**、**PDU**\n### 2.1 Target类\n#### 2.1.1 共有方法\n　　Target表示被管理的设备。对于被管理的设备，我们关注它的Address,它所使用的的协议版本Version，访问它的用户名和密码，以及人为设置的跟他打交道的策略，比如超时时间、\n重传次数等。所以有如下方法：\n\n - 设置或获取IP地址\n```java\nvoid setAddress（Address address）   \nAddress getAddress（）\n```\n - 设置或获取协议版本\n```java\nvoid setVersion(int ver)\nint getVersion()\n```\n - 超时时间（单位：milliseconds）\n```java\nvoid   setTimeout(long out）\nlong getTimeout()\n```\n - 重传次数\n```java\nvoid setRetries(int retries)\nint getRetries()\n```\n - PUD最大值\n```java\nvoid setMaxSizeRequestPDU(int max)\nint getMaxSizeRequestPDU()\n```\n\n上面的方法对于snmp三个版本都是相同的，不同的在于安全方面。具体来说，Snmpv1，v2c采用共同体（community）方式，安全性很差；SnmpV3采用基于用户的安全（USM）方式，安全性能得到很大提高。\n\n#### 2.1.2 communityTarget\n对于Snmpv1，v2c，使用Target派生出一个子类CommunityTarget，增加了对Community的方法：\n```java\nvoid setMaxSizeRequestPDU(int max)\nint getMaxSizeRequestPDU()\n```\n#### 2.1.3 UserTarget\n对于SnmpV3，使用其子类UserTarget，增加了一些有关USM安全方面的设置，比如采用的安全模型、安全级别、访问该设备的用户名以及权威引擎ID（authoritative engine ID）：\n\n - 安全级别（支持三种安全级别）\n```java\nvoid setSecurityLevel(int level)\nint   getSecurityLevel()\n```\n - 访问用户名（该访问用户名称必须在设置USM的时候添加其相应的UsmUser）\n```java\nvoid setSecurityName(OctetString name)\nOctetString   getSecurityName()\n```\n - 安全模型（支持三种安全模型）\n```java\nvoid setSecurityModel(int model)\nint   getSecurityModel()\n```\n - 权威引擎ID（authoritative engine ID）\n```java\nvoid   setAuthoritativeEngineID(byte[] id)\nbyte[] getAuthoritativeEngineID（）\n```\n\n### 2.2 PDU类\n　　PDU（协议数据单元），用来表示管理站跟代理站点进行通信的数据。包括PDU的类型、传输的数据集合、错误说明等。\n　　该类是SNMP报文单元的抽象，其中PDU类适用于SNMPv1和SNMPv2c。ScopedPDU类继承于PDU类，适用于SNMPv3。\n　　Snmp4j针对Snmp的各个版本，开发了三个有关PDU的类。PDU（针对Snmpv2c）、PDUv1（针对Snmpv1）、ScopedPDU（针对Snmpv3），但三个类除各自特别的一些参数外，都基本相同。所以Snmp4j在设计的时候，将PDU设计成另外两个的超类，使他们能够共享大部分功能。\n　　\n### 2.3 Snmp类\n　　snmp类是SNMP4J的核心，它提供了发送和接收SNMP PDUs的方法，所有的SNMP PDU 类型都可以采用同步或者异步的方式被发送。\n　　Snmp采用独立的传输协议，通过`TransportMapping`接口调用`addTransportMapping(TransportMapping transportMapping)`方法或者采用默认的构造函数来实现传输映射，以此来实现信息的传输。\n　　\n\n\n\n\n","source":"_posts/SNMP学习笔记(3)——snmp4j.md","raw":"---\ntitle: SNMP学习总结(3)——SNMP4J\ndate: 2017-05-25 8:42:50\ncategories:\n  - SNMP\ntags:\n  - snmp\n  - network\n  - snmp4j\n---\n这篇博客简要介绍了snmp4j协议栈的基本使用\n<!-- more -->\n## 1 snmp4j简介\n　　SNMP4J是一个用Java来实现SNMP(简单网络管理协议)协议的开源项目.它支持以命令行的形式进行管理与响应。SNMP4J是纯面向对象设计与SNMP++(用C++实现SNMPv1/v2c/v3)相类似。\n　　SNMP4J API 提供以下下特性：\n\n         - 支持MD5和SHA验证，DES，3DES,AES128、AES192和AES256加密的SNMPv3。\n         - 支持MPv1,MPv2C和MPv3，带执行的可阻塞的信息处理模块。\n         - 全部PDU格式。\n         - 可阻塞的传输拓扑。支持UPD、TCP、TLS 。\n         - 可阻塞的超时模块。\n         - 同步和异步请求。\n         - 命令发生器以及命令应答器的支持。\n         - 基于Apache license的开源免费。\n         - JAVA 1.4.1或更高版本(2.0或更高版本需要jdk1.6及以上的支持)。\n         - 基于LOG4J记录日志。\n         - 使用GETBULK实现Row-based的有效的异步表格获取。\n         - 支持多线程。\n         \n## 2 snmp4j重要的类及接口介绍\nSnmp4j包中最重要的三个概念，也是三个类：**Snmp**、**Target**、**PDU**\n### 2.1 Target类\n#### 2.1.1 共有方法\n　　Target表示被管理的设备。对于被管理的设备，我们关注它的Address,它所使用的的协议版本Version，访问它的用户名和密码，以及人为设置的跟他打交道的策略，比如超时时间、\n重传次数等。所以有如下方法：\n\n - 设置或获取IP地址\n```java\nvoid setAddress（Address address）   \nAddress getAddress（）\n```\n - 设置或获取协议版本\n```java\nvoid setVersion(int ver)\nint getVersion()\n```\n - 超时时间（单位：milliseconds）\n```java\nvoid   setTimeout(long out）\nlong getTimeout()\n```\n - 重传次数\n```java\nvoid setRetries(int retries)\nint getRetries()\n```\n - PUD最大值\n```java\nvoid setMaxSizeRequestPDU(int max)\nint getMaxSizeRequestPDU()\n```\n\n上面的方法对于snmp三个版本都是相同的，不同的在于安全方面。具体来说，Snmpv1，v2c采用共同体（community）方式，安全性很差；SnmpV3采用基于用户的安全（USM）方式，安全性能得到很大提高。\n\n#### 2.1.2 communityTarget\n对于Snmpv1，v2c，使用Target派生出一个子类CommunityTarget，增加了对Community的方法：\n```java\nvoid setMaxSizeRequestPDU(int max)\nint getMaxSizeRequestPDU()\n```\n#### 2.1.3 UserTarget\n对于SnmpV3，使用其子类UserTarget，增加了一些有关USM安全方面的设置，比如采用的安全模型、安全级别、访问该设备的用户名以及权威引擎ID（authoritative engine ID）：\n\n - 安全级别（支持三种安全级别）\n```java\nvoid setSecurityLevel(int level)\nint   getSecurityLevel()\n```\n - 访问用户名（该访问用户名称必须在设置USM的时候添加其相应的UsmUser）\n```java\nvoid setSecurityName(OctetString name)\nOctetString   getSecurityName()\n```\n - 安全模型（支持三种安全模型）\n```java\nvoid setSecurityModel(int model)\nint   getSecurityModel()\n```\n - 权威引擎ID（authoritative engine ID）\n```java\nvoid   setAuthoritativeEngineID(byte[] id)\nbyte[] getAuthoritativeEngineID（）\n```\n\n### 2.2 PDU类\n　　PDU（协议数据单元），用来表示管理站跟代理站点进行通信的数据。包括PDU的类型、传输的数据集合、错误说明等。\n　　该类是SNMP报文单元的抽象，其中PDU类适用于SNMPv1和SNMPv2c。ScopedPDU类继承于PDU类，适用于SNMPv3。\n　　Snmp4j针对Snmp的各个版本，开发了三个有关PDU的类。PDU（针对Snmpv2c）、PDUv1（针对Snmpv1）、ScopedPDU（针对Snmpv3），但三个类除各自特别的一些参数外，都基本相同。所以Snmp4j在设计的时候，将PDU设计成另外两个的超类，使他们能够共享大部分功能。\n　　\n### 2.3 Snmp类\n　　snmp类是SNMP4J的核心，它提供了发送和接收SNMP PDUs的方法，所有的SNMP PDU 类型都可以采用同步或者异步的方式被发送。\n　　Snmp采用独立的传输协议，通过`TransportMapping`接口调用`addTransportMapping(TransportMapping transportMapping)`方法或者采用默认的构造函数来实现传输映射，以此来实现信息的传输。\n　　\n\n\n\n\n","slug":"SNMP学习笔记(3)——snmp4j","published":1,"updated":"2018-02-27T07:38:38.091Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfu7002fhwvf6pe5h09l","content":"<p>这篇博客简要介绍了snmp4j协议栈的基本使用<br><a id=\"more\"></a></p>\n<h2 id=\"1-snmp4j简介\"><a href=\"#1-snmp4j简介\" class=\"headerlink\" title=\"1 snmp4j简介\"></a>1 snmp4j简介</h2><p>　　SNMP4J是一个用Java来实现SNMP(简单网络管理协议)协议的开源项目.它支持以命令行的形式进行管理与响应。SNMP4J是纯面向对象设计与SNMP++(用C++实现SNMPv1/v2c/v3)相类似。<br>　　SNMP4J API 提供以下下特性：</p>\n<pre><code>- 支持MD5和SHA验证，DES，3DES,AES128、AES192和AES256加密的SNMPv3。\n- 支持MPv1,MPv2C和MPv3，带执行的可阻塞的信息处理模块。\n- 全部PDU格式。\n- 可阻塞的传输拓扑。支持UPD、TCP、TLS 。\n- 可阻塞的超时模块。\n- 同步和异步请求。\n- 命令发生器以及命令应答器的支持。\n- 基于Apache license的开源免费。\n- JAVA 1.4.1或更高版本(2.0或更高版本需要jdk1.6及以上的支持)。\n- 基于LOG4J记录日志。\n- 使用GETBULK实现Row-based的有效的异步表格获取。\n- 支持多线程。\n</code></pre><h2 id=\"2-snmp4j重要的类及接口介绍\"><a href=\"#2-snmp4j重要的类及接口介绍\" class=\"headerlink\" title=\"2 snmp4j重要的类及接口介绍\"></a>2 snmp4j重要的类及接口介绍</h2><p>Snmp4j包中最重要的三个概念，也是三个类：<strong>Snmp</strong>、<strong>Target</strong>、<strong>PDU</strong></p>\n<h3 id=\"2-1-Target类\"><a href=\"#2-1-Target类\" class=\"headerlink\" title=\"2.1 Target类\"></a>2.1 Target类</h3><h4 id=\"2-1-1-共有方法\"><a href=\"#2-1-1-共有方法\" class=\"headerlink\" title=\"2.1.1 共有方法\"></a>2.1.1 共有方法</h4><p>　　Target表示被管理的设备。对于被管理的设备，我们关注它的Address,它所使用的的协议版本Version，访问它的用户名和密码，以及人为设置的跟他打交道的策略，比如超时时间、<br>重传次数等。所以有如下方法：</p>\n<ul>\n<li><p>设置或获取IP地址</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> setAddress（Address address）   </div><div class=\"line\">Address getAddress（）</div></pre></td></tr></table></figure>\n</li>\n<li><p>设置或获取协议版本</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setVersion</span><span class=\"params\">(<span class=\"keyword\">int</span> ver)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span> <span class=\"title\">getVersion</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>超时时间（单位：milliseconds）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span>   <span class=\"title\">setTimeout</span><span class=\"params\">(<span class=\"keyword\">long</span> out）</span></span></div><div class=\"line\"><span class=\"keyword\">long</span> getTimeout()</div></pre></td></tr></table></figure>\n</li>\n<li><p>重传次数</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setRetries</span><span class=\"params\">(<span class=\"keyword\">int</span> retries)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span> <span class=\"title\">getRetries</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>PUD最大值</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setMaxSizeRequestPDU</span><span class=\"params\">(<span class=\"keyword\">int</span> max)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span> <span class=\"title\">getMaxSizeRequestPDU</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>上面的方法对于snmp三个版本都是相同的，不同的在于安全方面。具体来说，Snmpv1，v2c采用共同体（community）方式，安全性很差；SnmpV3采用基于用户的安全（USM）方式，安全性能得到很大提高。</p>\n<h4 id=\"2-1-2-communityTarget\"><a href=\"#2-1-2-communityTarget\" class=\"headerlink\" title=\"2.1.2 communityTarget\"></a>2.1.2 communityTarget</h4><p>对于Snmpv1，v2c，使用Target派生出一个子类CommunityTarget，增加了对Community的方法：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setMaxSizeRequestPDU</span><span class=\"params\">(<span class=\"keyword\">int</span> max)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span> <span class=\"title\">getMaxSizeRequestPDU</span><span class=\"params\">()</span></div></pre></td></tr></table></figure></p>\n<h4 id=\"2-1-3-UserTarget\"><a href=\"#2-1-3-UserTarget\" class=\"headerlink\" title=\"2.1.3 UserTarget\"></a>2.1.3 UserTarget</h4><p>对于SnmpV3，使用其子类UserTarget，增加了一些有关USM安全方面的设置，比如采用的安全模型、安全级别、访问该设备的用户名以及权威引擎ID（authoritative engine ID）：</p>\n<ul>\n<li><p>安全级别（支持三种安全级别）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setSecurityLevel</span><span class=\"params\">(<span class=\"keyword\">int</span> level)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span>   <span class=\"title\">getSecurityLevel</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>访问用户名（该访问用户名称必须在设置USM的时候添加其相应的UsmUser）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setSecurityName</span><span class=\"params\">(OctetString name)</span></span></div><div class=\"line\">OctetString   <span class=\"title\">getSecurityName</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>安全模型（支持三种安全模型）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setSecurityModel</span><span class=\"params\">(<span class=\"keyword\">int</span> model)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span>   <span class=\"title\">getSecurityModel</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>权威引擎ID（authoritative engine ID）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span>   <span class=\"title\">setAuthoritativeEngineID</span><span class=\"params\">(<span class=\"keyword\">byte</span>[] id)</span></span></div><div class=\"line\"><span class=\"keyword\">byte</span>[] getAuthoritativeEngineID（）</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"2-2-PDU类\"><a href=\"#2-2-PDU类\" class=\"headerlink\" title=\"2.2 PDU类\"></a>2.2 PDU类</h3><p>　　PDU（协议数据单元），用来表示管理站跟代理站点进行通信的数据。包括PDU的类型、传输的数据集合、错误说明等。<br>　　该类是SNMP报文单元的抽象，其中PDU类适用于SNMPv1和SNMPv2c。ScopedPDU类继承于PDU类，适用于SNMPv3。<br>　　Snmp4j针对Snmp的各个版本，开发了三个有关PDU的类。PDU（针对Snmpv2c）、PDUv1（针对Snmpv1）、ScopedPDU（针对Snmpv3），但三个类除各自特别的一些参数外，都基本相同。所以Snmp4j在设计的时候，将PDU设计成另外两个的超类，使他们能够共享大部分功能。\n　　</p>\n<h3 id=\"2-3-Snmp类\"><a href=\"#2-3-Snmp类\" class=\"headerlink\" title=\"2.3 Snmp类\"></a>2.3 Snmp类</h3><p>　　snmp类是SNMP4J的核心，它提供了发送和接收SNMP PDUs的方法，所有的SNMP PDU 类型都可以采用同步或者异步的方式被发送。<br>　　Snmp采用独立的传输协议，通过<code>TransportMapping</code>接口调用<code>addTransportMapping(TransportMapping transportMapping)</code>方法或者采用默认的构造函数来实现传输映射，以此来实现信息的传输。\n　　</p>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>这篇博客简要介绍了snmp4j协议栈的基本使用<br>","more":"</p>\n<h2 id=\"1-snmp4j简介\"><a href=\"#1-snmp4j简介\" class=\"headerlink\" title=\"1 snmp4j简介\"></a>1 snmp4j简介</h2><p>　　SNMP4J是一个用Java来实现SNMP(简单网络管理协议)协议的开源项目.它支持以命令行的形式进行管理与响应。SNMP4J是纯面向对象设计与SNMP++(用C++实现SNMPv1/v2c/v3)相类似。<br>　　SNMP4J API 提供以下下特性：</p>\n<pre><code>- 支持MD5和SHA验证，DES，3DES,AES128、AES192和AES256加密的SNMPv3。\n- 支持MPv1,MPv2C和MPv3，带执行的可阻塞的信息处理模块。\n- 全部PDU格式。\n- 可阻塞的传输拓扑。支持UPD、TCP、TLS 。\n- 可阻塞的超时模块。\n- 同步和异步请求。\n- 命令发生器以及命令应答器的支持。\n- 基于Apache license的开源免费。\n- JAVA 1.4.1或更高版本(2.0或更高版本需要jdk1.6及以上的支持)。\n- 基于LOG4J记录日志。\n- 使用GETBULK实现Row-based的有效的异步表格获取。\n- 支持多线程。\n</code></pre><h2 id=\"2-snmp4j重要的类及接口介绍\"><a href=\"#2-snmp4j重要的类及接口介绍\" class=\"headerlink\" title=\"2 snmp4j重要的类及接口介绍\"></a>2 snmp4j重要的类及接口介绍</h2><p>Snmp4j包中最重要的三个概念，也是三个类：<strong>Snmp</strong>、<strong>Target</strong>、<strong>PDU</strong></p>\n<h3 id=\"2-1-Target类\"><a href=\"#2-1-Target类\" class=\"headerlink\" title=\"2.1 Target类\"></a>2.1 Target类</h3><h4 id=\"2-1-1-共有方法\"><a href=\"#2-1-1-共有方法\" class=\"headerlink\" title=\"2.1.1 共有方法\"></a>2.1.1 共有方法</h4><p>　　Target表示被管理的设备。对于被管理的设备，我们关注它的Address,它所使用的的协议版本Version，访问它的用户名和密码，以及人为设置的跟他打交道的策略，比如超时时间、<br>重传次数等。所以有如下方法：</p>\n<ul>\n<li><p>设置或获取IP地址</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">void</span> setAddress（Address address）   </div><div class=\"line\">Address getAddress（）</div></pre></td></tr></table></figure>\n</li>\n<li><p>设置或获取协议版本</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setVersion</span><span class=\"params\">(<span class=\"keyword\">int</span> ver)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span> <span class=\"title\">getVersion</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>超时时间（单位：milliseconds）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span>   <span class=\"title\">setTimeout</span><span class=\"params\">(<span class=\"keyword\">long</span> out）</span></span></div><div class=\"line\"><span class=\"keyword\">long</span> getTimeout()</div></pre></td></tr></table></figure>\n</li>\n<li><p>重传次数</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setRetries</span><span class=\"params\">(<span class=\"keyword\">int</span> retries)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span> <span class=\"title\">getRetries</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>PUD最大值</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setMaxSizeRequestPDU</span><span class=\"params\">(<span class=\"keyword\">int</span> max)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span> <span class=\"title\">getMaxSizeRequestPDU</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>上面的方法对于snmp三个版本都是相同的，不同的在于安全方面。具体来说，Snmpv1，v2c采用共同体（community）方式，安全性很差；SnmpV3采用基于用户的安全（USM）方式，安全性能得到很大提高。</p>\n<h4 id=\"2-1-2-communityTarget\"><a href=\"#2-1-2-communityTarget\" class=\"headerlink\" title=\"2.1.2 communityTarget\"></a>2.1.2 communityTarget</h4><p>对于Snmpv1，v2c，使用Target派生出一个子类CommunityTarget，增加了对Community的方法：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setMaxSizeRequestPDU</span><span class=\"params\">(<span class=\"keyword\">int</span> max)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span> <span class=\"title\">getMaxSizeRequestPDU</span><span class=\"params\">()</span></div></pre></td></tr></table></figure></p>\n<h4 id=\"2-1-3-UserTarget\"><a href=\"#2-1-3-UserTarget\" class=\"headerlink\" title=\"2.1.3 UserTarget\"></a>2.1.3 UserTarget</h4><p>对于SnmpV3，使用其子类UserTarget，增加了一些有关USM安全方面的设置，比如采用的安全模型、安全级别、访问该设备的用户名以及权威引擎ID（authoritative engine ID）：</p>\n<ul>\n<li><p>安全级别（支持三种安全级别）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setSecurityLevel</span><span class=\"params\">(<span class=\"keyword\">int</span> level)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span>   <span class=\"title\">getSecurityLevel</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>访问用户名（该访问用户名称必须在设置USM的时候添加其相应的UsmUser）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setSecurityName</span><span class=\"params\">(OctetString name)</span></span></div><div class=\"line\">OctetString   <span class=\"title\">getSecurityName</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>安全模型（支持三种安全模型）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setSecurityModel</span><span class=\"params\">(<span class=\"keyword\">int</span> model)</span></span></div><div class=\"line\"><span class=\"keyword\">int</span>   <span class=\"title\">getSecurityModel</span><span class=\"params\">()</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>权威引擎ID（authoritative engine ID）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span>   <span class=\"title\">setAuthoritativeEngineID</span><span class=\"params\">(<span class=\"keyword\">byte</span>[] id)</span></span></div><div class=\"line\"><span class=\"keyword\">byte</span>[] getAuthoritativeEngineID（）</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"2-2-PDU类\"><a href=\"#2-2-PDU类\" class=\"headerlink\" title=\"2.2 PDU类\"></a>2.2 PDU类</h3><p>　　PDU（协议数据单元），用来表示管理站跟代理站点进行通信的数据。包括PDU的类型、传输的数据集合、错误说明等。<br>　　该类是SNMP报文单元的抽象，其中PDU类适用于SNMPv1和SNMPv2c。ScopedPDU类继承于PDU类，适用于SNMPv3。<br>　　Snmp4j针对Snmp的各个版本，开发了三个有关PDU的类。PDU（针对Snmpv2c）、PDUv1（针对Snmpv1）、ScopedPDU（针对Snmpv3），但三个类除各自特别的一些参数外，都基本相同。所以Snmp4j在设计的时候，将PDU设计成另外两个的超类，使他们能够共享大部分功能。\n　　</p>\n<h3 id=\"2-3-Snmp类\"><a href=\"#2-3-Snmp类\" class=\"headerlink\" title=\"2.3 Snmp类\"></a>2.3 Snmp类</h3><p>　　snmp类是SNMP4J的核心，它提供了发送和接收SNMP PDUs的方法，所有的SNMP PDU 类型都可以采用同步或者异步的方式被发送。<br>　　Snmp采用独立的传输协议，通过<code>TransportMapping</code>接口调用<code>addTransportMapping(TransportMapping transportMapping)</code>方法或者采用默认的构造函数来实现传输映射，以此来实现信息的传输。\n　　</p>"},{"title":"Spring MVC(3)——参数绑定","date":"2018-03-06T08:13:28.000Z","_content":"springmvc接收请求的key/value串（比如：id=2&type=101），经过类型转换，将转换后的值赋值给controller方法的形参，这个过程就叫参数绑定。\n\n<!--more-->\n\n## 1、默认支持的类型\n\n在controller方法形参中如下类型是可以直接绑定成功，springmvc框架给以下类型的参数直接赋值：\n\n - **HttpServletRequest**：通过request对象获取请求信息\n - **HttpServletResponse**：通过response处理响应信息\n - **HttpSession**：通过session对象得到session中存放的对象\n - **Model/ModelMap**：ModelMap是Model接口的实现类，通过Model或ModelMap向页面传递数据，如下：\n \n    ```java\n    //调用service查询商品信息\n    Items item = itemService.findItemById(id);\n    model.addAttribute(\"item\", item);\n    ```\n    页面通过${item.XXXX}获取item对象的属性值。\n    使用Model和ModelMap的效果一样，如果直接使用Model，springmvc会实例化ModelMap。\n\n## 2、基本类型\n\n基本类型类型：Integer、string、boolean、float。。。\n\n绑定规则：\n\n 1. 对于基本类型参数绑定，当请求的参数的名称和controller方法的形参名一致时可以绑定成功。\n 2. 如果请求的参数的名称和controller方法的形参名不一致时，如何绑定？\n    就要使用@RequestParam进行绑定：\n\n    使用方法如下：\n    @RequestParam(value=\"ids\") Integer id,将请求的参数名为ids的值绑定方法形参的id上。\n    **required**：是否必须，默认是true，表示请求中一定要有相应的参数，否则将报；TTP Status 400 - Required Integer parameter 'XXXX' is not present;\n    **defaultValue**：默认值，表示如果请求中没有同名参数时的默认值\n\n\n## 3、简单pojo\n\n简单pojo：pojo中都基本类型，没有包括自定义pojo属性。\n\n页面参数名称的定义：\n\n```html\n<tr>\n    <td>名称</td>\n    <td><input type=\"text\" name=\"name\" value=\"${item.name}\"/></td>\n</tr>\n<tr>\n    <td>价格</td>\n    <td><input type=\"text\" name=\"price\" value=\"${item.price}\"/></td>\n</tr>\n```\n\ncontroller方法的参数定义：\n\n```java\n@RequestMapping(\"editItem\")\npublic ModelAndView editItem(Item item) throws Exception {\n```\n当页面参数名称和controller方法的pojo的参数的属性名一致，可以将请求的参数绑定到pojo形参的属性中。\n\n## 4、包装类pojo\n\n包装类型pojo：pojo中属性也是一个pojo。\n\n页面请求参数名称定义：\n\n```html\n<tr>\n    <td>名称</td>\n    <td><input type=\"text\" name=\"item.name\"/></td>\n</tr>\n<tr>\n    <td><input type=\"submit\" value=\"查询\"/></td>\n</tr>\n```\n\ncontroller方法形参的定义：\n\n```java\n@RequestMapping(/queryItems)\npublic ModelAndView queryItems(ItemsQueryVo itemsQueryVo) throws Exception {\n```\n\n包装类型的pojo绑定规则：\nitem是包装pojo(ItemsQueryVo)的属性名。\nitem.name中name就是包装pojo(ItemsQueryVo)中属性item的一个属性。\n\n## 5、数组\n\n需求： 在商品查询列表页面批量选择商品进行删除。\n\n页面要提交多个商品id，controller方法使用数组接收页面提交的参数。\n页面参数名称定义：\n\n```html\n<c:forEach var=\"item\" items=\"${itemsList}\">\n    <tr>\n        <td><input type=\"checkbox\" name=\"delete_id\" value=\"${item.id}\"></td>\n        <td><input type=\"checkbox\" name=\"delete_id\" value=\"${item.id}\"></td>\n        <td><input type=\"checkbox\" name=\"delete_id\" value=\"${item.id}\"></td>\n        <td><input type=\"checkbox\" name=\"delete_id\" value=\"${item.id}\"></td>\n    </tr>\n</c:forEach>\n```\n\ncontroller方法形参数定义：\n\n```java\n@RequestMapping(/deleteItems)\npublic ModelAndView queryItems(Integer[] delete_id) throws Exception {\n```\n\n绑定规则：\n如果请求多个参数且名称一致，可以绑定到和请求参数名一致的数组中。\n\n## 6、List<pojo>\n\n需求：\n实现商品信息批量修改功能，类似功能有成绩录入，一次录入好多门成绩，执行批量提交。\n\n页面参数名称定义：\n\n```html\n<td><input type=\"text\" name=\"itemsList[${status.index}].name\"/></td>\n<td><input type=\"text\" name=\"itemsList[${status.index}].prive\"/></td>\n<td><input type=\"text\" name=\"itemsList[${status.index}].createtime\"/></td>\n```\n\ncontroller方法形参数定义:\n\n```java\n@RequestMapping(/queryItems)\npublic ModelAndView queryItems(ItemsQueryVo itemsQueryVo) throws Exception {\n```\n\nitemsQueryVo定义：\n\n```java\npublic class ItemsQueryVo {\n\n    private List<Item> itemsList;\n```\n\n## 7、自定义参数绑定\n\n问题：\n页面输入 2020-12-12 12:12:12(年月日时分秒)，springmvc默认提供年月日的绑定，没有对时分秒进行绑定。\n\n解决问题：\n需要自定义参数绑定器，实现将页面输入年月日 时分秒全部转成日期类型数据。\n\n自定义参数绑定器方法：\n自定义参数绑定器实现Conver<S,T>，S表示源类型，T表示目标类型，S是页面请求的参数类型，即string，目标类型是要绑定到pojo的属性的类型，上边的例子T目标类型就是：Items中createtime属性类型即java.util.Date\n\n开发自定义参数绑定器：\n\n```java\npublic class DateConver implements Converter<String, Date> {\n\n    @Override\n    public Date convert(String paramS) {\n        SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\");\n\n        try {\n            return sdf.parse(paramS);\n        } catch (ParseException e) {\n            e.printStackTrace();\n            return null;\n        }\n    }\n\n}\n```\n\n在springmvc.xml中在处理器适配器上配置参数绑定器：\n\n```xml\n<!-- 简写 -->\n<mvc:annotation-driven conversion-service=\"conversionService\"/>\n\n<bean id=\"conversionService\" class=\"org.springframework.format.support.FormattingConversionServiceFactoryBean\">\n\t<property name=\"converters\">\n\t\t<list>\n\t\t\t<bean class=\"com.topvision.ssm.DateConver\"></bean>\n\t\t</list>\n\t</property>\n</bean>\n```","source":"_posts/Spring-MVC-3-——参数绑定.md","raw":"---\ntitle: Spring MVC(3)——参数绑定\ncategories:\n  - Spring\ntags:\n  - SpringMVC\ndate: 2018-03-06 16:13:28\n---\nspringmvc接收请求的key/value串（比如：id=2&type=101），经过类型转换，将转换后的值赋值给controller方法的形参，这个过程就叫参数绑定。\n\n<!--more-->\n\n## 1、默认支持的类型\n\n在controller方法形参中如下类型是可以直接绑定成功，springmvc框架给以下类型的参数直接赋值：\n\n - **HttpServletRequest**：通过request对象获取请求信息\n - **HttpServletResponse**：通过response处理响应信息\n - **HttpSession**：通过session对象得到session中存放的对象\n - **Model/ModelMap**：ModelMap是Model接口的实现类，通过Model或ModelMap向页面传递数据，如下：\n \n    ```java\n    //调用service查询商品信息\n    Items item = itemService.findItemById(id);\n    model.addAttribute(\"item\", item);\n    ```\n    页面通过${item.XXXX}获取item对象的属性值。\n    使用Model和ModelMap的效果一样，如果直接使用Model，springmvc会实例化ModelMap。\n\n## 2、基本类型\n\n基本类型类型：Integer、string、boolean、float。。。\n\n绑定规则：\n\n 1. 对于基本类型参数绑定，当请求的参数的名称和controller方法的形参名一致时可以绑定成功。\n 2. 如果请求的参数的名称和controller方法的形参名不一致时，如何绑定？\n    就要使用@RequestParam进行绑定：\n\n    使用方法如下：\n    @RequestParam(value=\"ids\") Integer id,将请求的参数名为ids的值绑定方法形参的id上。\n    **required**：是否必须，默认是true，表示请求中一定要有相应的参数，否则将报；TTP Status 400 - Required Integer parameter 'XXXX' is not present;\n    **defaultValue**：默认值，表示如果请求中没有同名参数时的默认值\n\n\n## 3、简单pojo\n\n简单pojo：pojo中都基本类型，没有包括自定义pojo属性。\n\n页面参数名称的定义：\n\n```html\n<tr>\n    <td>名称</td>\n    <td><input type=\"text\" name=\"name\" value=\"${item.name}\"/></td>\n</tr>\n<tr>\n    <td>价格</td>\n    <td><input type=\"text\" name=\"price\" value=\"${item.price}\"/></td>\n</tr>\n```\n\ncontroller方法的参数定义：\n\n```java\n@RequestMapping(\"editItem\")\npublic ModelAndView editItem(Item item) throws Exception {\n```\n当页面参数名称和controller方法的pojo的参数的属性名一致，可以将请求的参数绑定到pojo形参的属性中。\n\n## 4、包装类pojo\n\n包装类型pojo：pojo中属性也是一个pojo。\n\n页面请求参数名称定义：\n\n```html\n<tr>\n    <td>名称</td>\n    <td><input type=\"text\" name=\"item.name\"/></td>\n</tr>\n<tr>\n    <td><input type=\"submit\" value=\"查询\"/></td>\n</tr>\n```\n\ncontroller方法形参的定义：\n\n```java\n@RequestMapping(/queryItems)\npublic ModelAndView queryItems(ItemsQueryVo itemsQueryVo) throws Exception {\n```\n\n包装类型的pojo绑定规则：\nitem是包装pojo(ItemsQueryVo)的属性名。\nitem.name中name就是包装pojo(ItemsQueryVo)中属性item的一个属性。\n\n## 5、数组\n\n需求： 在商品查询列表页面批量选择商品进行删除。\n\n页面要提交多个商品id，controller方法使用数组接收页面提交的参数。\n页面参数名称定义：\n\n```html\n<c:forEach var=\"item\" items=\"${itemsList}\">\n    <tr>\n        <td><input type=\"checkbox\" name=\"delete_id\" value=\"${item.id}\"></td>\n        <td><input type=\"checkbox\" name=\"delete_id\" value=\"${item.id}\"></td>\n        <td><input type=\"checkbox\" name=\"delete_id\" value=\"${item.id}\"></td>\n        <td><input type=\"checkbox\" name=\"delete_id\" value=\"${item.id}\"></td>\n    </tr>\n</c:forEach>\n```\n\ncontroller方法形参数定义：\n\n```java\n@RequestMapping(/deleteItems)\npublic ModelAndView queryItems(Integer[] delete_id) throws Exception {\n```\n\n绑定规则：\n如果请求多个参数且名称一致，可以绑定到和请求参数名一致的数组中。\n\n## 6、List<pojo>\n\n需求：\n实现商品信息批量修改功能，类似功能有成绩录入，一次录入好多门成绩，执行批量提交。\n\n页面参数名称定义：\n\n```html\n<td><input type=\"text\" name=\"itemsList[${status.index}].name\"/></td>\n<td><input type=\"text\" name=\"itemsList[${status.index}].prive\"/></td>\n<td><input type=\"text\" name=\"itemsList[${status.index}].createtime\"/></td>\n```\n\ncontroller方法形参数定义:\n\n```java\n@RequestMapping(/queryItems)\npublic ModelAndView queryItems(ItemsQueryVo itemsQueryVo) throws Exception {\n```\n\nitemsQueryVo定义：\n\n```java\npublic class ItemsQueryVo {\n\n    private List<Item> itemsList;\n```\n\n## 7、自定义参数绑定\n\n问题：\n页面输入 2020-12-12 12:12:12(年月日时分秒)，springmvc默认提供年月日的绑定，没有对时分秒进行绑定。\n\n解决问题：\n需要自定义参数绑定器，实现将页面输入年月日 时分秒全部转成日期类型数据。\n\n自定义参数绑定器方法：\n自定义参数绑定器实现Conver<S,T>，S表示源类型，T表示目标类型，S是页面请求的参数类型，即string，目标类型是要绑定到pojo的属性的类型，上边的例子T目标类型就是：Items中createtime属性类型即java.util.Date\n\n开发自定义参数绑定器：\n\n```java\npublic class DateConver implements Converter<String, Date> {\n\n    @Override\n    public Date convert(String paramS) {\n        SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\");\n\n        try {\n            return sdf.parse(paramS);\n        } catch (ParseException e) {\n            e.printStackTrace();\n            return null;\n        }\n    }\n\n}\n```\n\n在springmvc.xml中在处理器适配器上配置参数绑定器：\n\n```xml\n<!-- 简写 -->\n<mvc:annotation-driven conversion-service=\"conversionService\"/>\n\n<bean id=\"conversionService\" class=\"org.springframework.format.support.FormattingConversionServiceFactoryBean\">\n\t<property name=\"converters\">\n\t\t<list>\n\t\t\t<bean class=\"com.topvision.ssm.DateConver\"></bean>\n\t\t</list>\n\t</property>\n</bean>\n```","slug":"Spring-MVC-3-——参数绑定","published":1,"updated":"2018-03-06T08:13:50.083Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfub002jhwvfg83fmxgg","content":"<p>springmvc接收请求的key/value串（比如：id=2&amp;type=101），经过类型转换，将转换后的值赋值给controller方法的形参，这个过程就叫参数绑定。</p>\n<a id=\"more\"></a>\n<h2 id=\"1、默认支持的类型\"><a href=\"#1、默认支持的类型\" class=\"headerlink\" title=\"1、默认支持的类型\"></a>1、默认支持的类型</h2><p>在controller方法形参中如下类型是可以直接绑定成功，springmvc框架给以下类型的参数直接赋值：</p>\n<ul>\n<li><strong>HttpServletRequest</strong>：通过request对象获取请求信息</li>\n<li><strong>HttpServletResponse</strong>：通过response处理响应信息</li>\n<li><strong>HttpSession</strong>：通过session对象得到session中存放的对象</li>\n<li><p><strong>Model/ModelMap</strong>：ModelMap是Model接口的实现类，通过Model或ModelMap向页面传递数据，如下：</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//调用service查询商品信息</span></div><div class=\"line\">Items item = itemService.findItemById(id);</div><div class=\"line\">model.addAttribute(<span class=\"string\">\"item\"</span>, item);</div></pre></td></tr></table></figure>\n<p> 页面通过${item.XXXX}获取item对象的属性值。<br> 使用Model和ModelMap的效果一样，如果直接使用Model，springmvc会实例化ModelMap。</p>\n</li>\n</ul>\n<h2 id=\"2、基本类型\"><a href=\"#2、基本类型\" class=\"headerlink\" title=\"2、基本类型\"></a>2、基本类型</h2><p>基本类型类型：Integer、string、boolean、float。。。</p>\n<p>绑定规则：</p>\n<ol>\n<li>对于基本类型参数绑定，当请求的参数的名称和controller方法的形参名一致时可以绑定成功。</li>\n<li><p>如果请求的参数的名称和controller方法的形参名不一致时，如何绑定？<br>就要使用@RequestParam进行绑定：</p>\n<p>使用方法如下：<br>@RequestParam(value=”ids”) Integer id,将请求的参数名为ids的值绑定方法形参的id上。<br><strong>required</strong>：是否必须，默认是true，表示请求中一定要有相应的参数，否则将报；TTP Status 400 - Required Integer parameter ‘XXXX’ is not present;<br><strong>defaultValue</strong>：默认值，表示如果请求中没有同名参数时的默认值</p>\n</li>\n</ol>\n<h2 id=\"3、简单pojo\"><a href=\"#3、简单pojo\" class=\"headerlink\" title=\"3、简单pojo\"></a>3、简单pojo</h2><p>简单pojo：pojo中都基本类型，没有包括自定义pojo属性。</p>\n<p>页面参数名称的定义：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>名称<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"name\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;item.name&#125;\"</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>价格<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"price\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;item.price&#125;\"</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>controller方法的参数定义：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"editItem\"</span>)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">editItem</span><span class=\"params\">(Item item)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div></pre></td></tr></table></figure>\n<p>当页面参数名称和controller方法的pojo的参数的属性名一致，可以将请求的参数绑定到pojo形参的属性中。</p>\n<h2 id=\"4、包装类pojo\"><a href=\"#4、包装类pojo\" class=\"headerlink\" title=\"4、包装类pojo\"></a>4、包装类pojo</h2><p>包装类型pojo：pojo中属性也是一个pojo。</p>\n<p>页面请求参数名称定义：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>名称<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"item.name\"</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"submit\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"查询\"</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>controller方法形参的定义：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(/queryItems)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">queryItems</span><span class=\"params\">(ItemsQueryVo itemsQueryVo)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div></pre></td></tr></table></figure>\n<p>包装类型的pojo绑定规则：<br>item是包装pojo(ItemsQueryVo)的属性名。<br>item.name中name就是包装pojo(ItemsQueryVo)中属性item的一个属性。</p>\n<h2 id=\"5、数组\"><a href=\"#5、数组\" class=\"headerlink\" title=\"5、数组\"></a>5、数组</h2><p>需求： 在商品查询列表页面批量选择商品进行删除。</p>\n<p>页面要提交多个商品id，controller方法使用数组接收页面提交的参数。<br>页面参数名称定义：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">c:forEach</span> <span class=\"attr\">var</span>=<span class=\"string\">\"item\"</span> <span class=\"attr\">items</span>=<span class=\"string\">\"$&#123;itemsList&#125;\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"checkbox\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"delete_id\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;item.id&#125;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"checkbox\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"delete_id\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;item.id&#125;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"checkbox\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"delete_id\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;item.id&#125;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"checkbox\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"delete_id\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;item.id&#125;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">c:forEach</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>controller方法形参数定义：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(/deleteItems)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">queryItems</span><span class=\"params\">(Integer[] delete_id)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div></pre></td></tr></table></figure>\n<p>绑定规则：<br>如果请求多个参数且名称一致，可以绑定到和请求参数名一致的数组中。</p>\n<h2 id=\"6、List\"><a href=\"#6、List\" class=\"headerlink\" title=\"6、List\"></a>6、List<pojo></pojo></h2><p>需求：<br>实现商品信息批量修改功能，类似功能有成绩录入，一次录入好多门成绩，执行批量提交。</p>\n<p>页面参数名称定义：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"itemsList[$&#123;status.index&#125;].name\"</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"itemsList[$&#123;status.index&#125;].prive\"</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"itemsList[$&#123;status.index&#125;].createtime\"</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>controller方法形参数定义:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(/queryItems)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">queryItems</span><span class=\"params\">(ItemsQueryVo itemsQueryVo)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div></pre></td></tr></table></figure>\n<p>itemsQueryVo定义：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ItemsQueryVo</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> List&lt;Item&gt; itemsList;</div></pre></td></tr></table></figure>\n<h2 id=\"7、自定义参数绑定\"><a href=\"#7、自定义参数绑定\" class=\"headerlink\" title=\"7、自定义参数绑定\"></a>7、自定义参数绑定</h2><p>问题：<br>页面输入 2020-12-12 12:12:12(年月日时分秒)，springmvc默认提供年月日的绑定，没有对时分秒进行绑定。</p>\n<p>解决问题：<br>需要自定义参数绑定器，实现将页面输入年月日 时分秒全部转成日期类型数据。</p>\n<p>自定义参数绑定器方法：<br>自定义参数绑定器实现Conver<s,t>，S表示源类型，T表示目标类型，S是页面请求的参数类型，即string，目标类型是要绑定到pojo的属性的类型，上边的例子T目标类型就是：Items中createtime属性类型即java.util.Date</s,t></p>\n<p>开发自定义参数绑定器：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DateConver</span> <span class=\"keyword\">implements</span> <span class=\"title\">Converter</span>&lt;<span class=\"title\">String</span>, <span class=\"title\">Date</span>&gt; </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Date <span class=\"title\">convert</span><span class=\"params\">(String paramS)</span> </span>&#123;</div><div class=\"line\">        SimpleDateFormat sdf = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">\"yyyy-MM-dd HH:mm:ss\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> sdf.parse(paramS);</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (ParseException e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>在springmvc.xml中在处理器适配器上配置参数绑定器：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 简写 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mvc:annotation-driven</span> <span class=\"attr\">conversion-service</span>=<span class=\"string\">\"conversionService\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"conversionService\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.format.support.FormattingConversionServiceFactoryBean\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"converters\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.ssm.DateConver\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>springmvc接收请求的key/value串（比如：id=2&amp;type=101），经过类型转换，将转换后的值赋值给controller方法的形参，这个过程就叫参数绑定。</p>","more":"<h2 id=\"1、默认支持的类型\"><a href=\"#1、默认支持的类型\" class=\"headerlink\" title=\"1、默认支持的类型\"></a>1、默认支持的类型</h2><p>在controller方法形参中如下类型是可以直接绑定成功，springmvc框架给以下类型的参数直接赋值：</p>\n<ul>\n<li><strong>HttpServletRequest</strong>：通过request对象获取请求信息</li>\n<li><strong>HttpServletResponse</strong>：通过response处理响应信息</li>\n<li><strong>HttpSession</strong>：通过session对象得到session中存放的对象</li>\n<li><p><strong>Model/ModelMap</strong>：ModelMap是Model接口的实现类，通过Model或ModelMap向页面传递数据，如下：</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//调用service查询商品信息</span></div><div class=\"line\">Items item = itemService.findItemById(id);</div><div class=\"line\">model.addAttribute(<span class=\"string\">\"item\"</span>, item);</div></pre></td></tr></table></figure>\n<p> 页面通过${item.XXXX}获取item对象的属性值。<br> 使用Model和ModelMap的效果一样，如果直接使用Model，springmvc会实例化ModelMap。</p>\n</li>\n</ul>\n<h2 id=\"2、基本类型\"><a href=\"#2、基本类型\" class=\"headerlink\" title=\"2、基本类型\"></a>2、基本类型</h2><p>基本类型类型：Integer、string、boolean、float。。。</p>\n<p>绑定规则：</p>\n<ol>\n<li>对于基本类型参数绑定，当请求的参数的名称和controller方法的形参名一致时可以绑定成功。</li>\n<li><p>如果请求的参数的名称和controller方法的形参名不一致时，如何绑定？<br>就要使用@RequestParam进行绑定：</p>\n<p>使用方法如下：<br>@RequestParam(value=”ids”) Integer id,将请求的参数名为ids的值绑定方法形参的id上。<br><strong>required</strong>：是否必须，默认是true，表示请求中一定要有相应的参数，否则将报；TTP Status 400 - Required Integer parameter ‘XXXX’ is not present;<br><strong>defaultValue</strong>：默认值，表示如果请求中没有同名参数时的默认值</p>\n</li>\n</ol>\n<h2 id=\"3、简单pojo\"><a href=\"#3、简单pojo\" class=\"headerlink\" title=\"3、简单pojo\"></a>3、简单pojo</h2><p>简单pojo：pojo中都基本类型，没有包括自定义pojo属性。</p>\n<p>页面参数名称的定义：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>名称<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"name\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;item.name&#125;\"</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>价格<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"price\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;item.price&#125;\"</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>controller方法的参数定义：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"editItem\"</span>)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">editItem</span><span class=\"params\">(Item item)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div></pre></td></tr></table></figure>\n<p>当页面参数名称和controller方法的pojo的参数的属性名一致，可以将请求的参数绑定到pojo形参的属性中。</p>\n<h2 id=\"4、包装类pojo\"><a href=\"#4、包装类pojo\" class=\"headerlink\" title=\"4、包装类pojo\"></a>4、包装类pojo</h2><p>包装类型pojo：pojo中属性也是一个pojo。</p>\n<p>页面请求参数名称定义：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span>名称<span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"item.name\"</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"submit\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"查询\"</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>controller方法形参的定义：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(/queryItems)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">queryItems</span><span class=\"params\">(ItemsQueryVo itemsQueryVo)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div></pre></td></tr></table></figure>\n<p>包装类型的pojo绑定规则：<br>item是包装pojo(ItemsQueryVo)的属性名。<br>item.name中name就是包装pojo(ItemsQueryVo)中属性item的一个属性。</p>\n<h2 id=\"5、数组\"><a href=\"#5、数组\" class=\"headerlink\" title=\"5、数组\"></a>5、数组</h2><p>需求： 在商品查询列表页面批量选择商品进行删除。</p>\n<p>页面要提交多个商品id，controller方法使用数组接收页面提交的参数。<br>页面参数名称定义：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">c:forEach</span> <span class=\"attr\">var</span>=<span class=\"string\">\"item\"</span> <span class=\"attr\">items</span>=<span class=\"string\">\"$&#123;itemsList&#125;\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"checkbox\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"delete_id\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;item.id&#125;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"checkbox\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"delete_id\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;item.id&#125;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"checkbox\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"delete_id\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;item.id&#125;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"checkbox\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"delete_id\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;item.id&#125;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">tr</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">c:forEach</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>controller方法形参数定义：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(/deleteItems)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">queryItems</span><span class=\"params\">(Integer[] delete_id)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div></pre></td></tr></table></figure>\n<p>绑定规则：<br>如果请求多个参数且名称一致，可以绑定到和请求参数名一致的数组中。</p>\n<h2 id=\"6、List\"><a href=\"#6、List\" class=\"headerlink\" title=\"6、List\"></a>6、List<pojo></pojo></h2><p>需求：<br>实现商品信息批量修改功能，类似功能有成绩录入，一次录入好多门成绩，执行批量提交。</p>\n<p>页面参数名称定义：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"itemsList[$&#123;status.index&#125;].name\"</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"itemsList[$&#123;status.index&#125;].prive\"</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">td</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"itemsList[$&#123;status.index&#125;].createtime\"</span>/&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">td</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>controller方法形参数定义:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(/queryItems)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">queryItems</span><span class=\"params\">(ItemsQueryVo itemsQueryVo)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div></pre></td></tr></table></figure>\n<p>itemsQueryVo定义：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ItemsQueryVo</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> List&lt;Item&gt; itemsList;</div></pre></td></tr></table></figure>\n<h2 id=\"7、自定义参数绑定\"><a href=\"#7、自定义参数绑定\" class=\"headerlink\" title=\"7、自定义参数绑定\"></a>7、自定义参数绑定</h2><p>问题：<br>页面输入 2020-12-12 12:12:12(年月日时分秒)，springmvc默认提供年月日的绑定，没有对时分秒进行绑定。</p>\n<p>解决问题：<br>需要自定义参数绑定器，实现将页面输入年月日 时分秒全部转成日期类型数据。</p>\n<p>自定义参数绑定器方法：<br>自定义参数绑定器实现Conver<s,t>，S表示源类型，T表示目标类型，S是页面请求的参数类型，即string，目标类型是要绑定到pojo的属性的类型，上边的例子T目标类型就是：Items中createtime属性类型即java.util.Date</s,t></p>\n<p>开发自定义参数绑定器：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DateConver</span> <span class=\"keyword\">implements</span> <span class=\"title\">Converter</span>&lt;<span class=\"title\">String</span>, <span class=\"title\">Date</span>&gt; </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Date <span class=\"title\">convert</span><span class=\"params\">(String paramS)</span> </span>&#123;</div><div class=\"line\">        SimpleDateFormat sdf = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">\"yyyy-MM-dd HH:mm:ss\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> sdf.parse(paramS);</div><div class=\"line\">        &#125; <span class=\"keyword\">catch</span> (ParseException e) &#123;</div><div class=\"line\">            e.printStackTrace();</div><div class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>在springmvc.xml中在处理器适配器上配置参数绑定器：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 简写 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mvc:annotation-driven</span> <span class=\"attr\">conversion-service</span>=<span class=\"string\">\"conversionService\"</span>/&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"conversionService\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.format.support.FormattingConversionServiceFactoryBean\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"converters\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.ssm.DateConver\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>"},{"title":"Spring MVC(2)——整合spring-mybatis","date":"2018-03-06T07:46:58.000Z","_content":"\n这边博客介绍了springmvc与spring及mybatis的继承。\n<!--more-->\n\n## 1、整合思路\n\n**dao层：**\n\n    mybatis+spring\n    目标：\n    使用spring对sqlSessionFactory进行管理\n    使用spring和mybatis整合包中的mapper扫描器对mapper接口进行扫描生成代理对象。\n    \n**service层：**\n\t\n    spring\n    目标：\n    让spring管理service类，将mapper代理对象注入到service对象中。\n    spring要对service方法执行进行事务控制\n\n**controller层：**\n\t\n\tspringmvc+spring\n\t目标：\n\t使用注解处理器映射器和适配器进行开发Handler\n\tHandler使用组件扫描方式在spring容器中进行注册\n\t\n## 2、工程搭建\n\n### 2.1 创建maven web工程\n### 2.2 设置jar包依赖(pom设置)\n\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\t<groupId>com.topvision.maven</groupId>\n\t<artifactId>ssm</artifactId>\n\t<packaging>war</packaging>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<name>ssm Maven Webapp</name>\n\t<url>http://maven.apache.org</url>\n\n\t<!-- 属性 -->\n\t<properties>\n\t\t<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n\t\t<spring.version>4.3.12.RELEASE</spring.version>\n\t\t<mybatis.version>3.4.5</mybatis.version>\n\t</properties>\n\n\t<!-- 锁定版本 -->\n\t<dependencyManagement>\n\t\t<dependencies>\n\t\t\t<dependency>\n                <groupId>org.springframework</groupId>\n                <artifactId>spring-context</artifactId>\n                <version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-aspects</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-orm</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-test</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-web</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-webmvc</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n\t\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t\t<artifactId>mybatis</artifactId>\n\t\t\t\t<version>${mybatis.version}</version>\n\t\t\t</dependency>\n\t\t</dependencies>\n\t</dependencyManagement>\n\n\t<dependencies>\n\t\t<!-- Spring -->\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-test</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-context</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-aspects</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-orm</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-web</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-webmvc</artifactId>\n\t\t</dependency>\n\t\t<!-- mybatis -->\n\t\t<dependency>\n\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t<artifactId>mybatis</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t<artifactId>mybatis-spring</artifactId>\n\t\t\t<version>1.3.1</version>\n\t\t</dependency>\n\n\t\t<!-- mysql驱动 -->\n\t\t<dependency>\n\t\t\t<groupId>mysql</groupId>\n\t\t\t<artifactId>mysql-connector-java</artifactId>\n\t\t\t<version>5.1.6</version>\n\t\t\t<scope>runtime</scope>\n\t\t</dependency>\n\n\t\t<!-- c3p0 -->\n\t\t<dependency>\n\t\t\t<groupId>c3p0</groupId>\n\t\t\t<artifactId>c3p0</artifactId>\n\t\t\t<version>0.9.1.2</version>\n\t\t</dependency>\n\t\t<!-- slf4j -->\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-log4j12</artifactId>\n\t\t\t<version>1.7.2</version>\n\t\t</dependency>\n\t\t<!-- junit -->\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>4.12</version>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t\t<dependency>\n            <groupId>org.hamcrest</groupId>\n            <artifactId>hamcrest-library</artifactId>\n            <version>1.3</version>\n        </dependency>\n\t\t<!-- jstl -->\n\t\t<dependency>\n\t\t\t<groupId>javax.servlet</groupId>\n\t\t\t<artifactId>jstl</artifactId>\n\t\t\t<version>1.2</version>\n\t\t</dependency>\n\n\t\t<!-- servlet jsp -->\n\t\t<dependency>\n\t\t\t<groupId>javax.servlet</groupId>\n\t\t\t<artifactId>servlet-api</artifactId>\n\t\t\t<version>2.5</version>\n\t\t\t<scope>provided</scope>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>javax.servlet</groupId>\n\t\t\t<artifactId>jsp-api</artifactId>\n\t\t\t<version>2.0</version>\n\t\t\t<scope>provided</scope>\n\t\t</dependency>\n\t</dependencies>\n\n\t<build>\n\t\t<plugins>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n\t\t\t\t<artifactId>maven-compiler-plugin</artifactId>\n\t\t\t\t<configuration>\n\t\t\t\t\t<source>1.8</source>\n\t\t\t\t\t<target>1.8</target>\n\t\t\t\t\t<encoding>UTF-8</encoding>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t</plugins>\n\n\t\t<finalName>ssm</finalName>\n\t</build>\n\n\n</project>\n\n```\n\n### 2.3 配置service\n\n加入spring。\n\n#### 2.3.1 web.xml\n\n配置spring监听器，设置spring核心文件的位置。\n\n```xml\n<web-app xmlns=\"http://xmlns.jcp.org/xml/ns/javaee\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/javaee\n                      http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd\"\n\tversion=\"3.1\" metadata-complete=\"true\">\n\t\n\t<!-- applicationContext对象仅加载一次，在服务器器启动时加载 -->\n\t<listener>\n\t\t<listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>\n\t</listener>\n\t<context-param>\n\t\t<param-name>contextConfigLocation</param-name>\n\t\t<param-value>classpath:applicationContext.xml</param-value>\n\t</context-param>\n\t\n</web-app>\n```\n\n#### 2.3.2 spring核心文件\n\n依据上一步的设置，在classpath下新建applicationContext.xml\n\n设置spring约束的文件头\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:aop=\"http://www.springframework.org/schema/aop\"\n\txmlns:context=\"http://www.springframework.org/schema/context\"\n\txmlns:mvc=\"http://www.springframework.org/schema/mvc\" xmlns:tx=\"http://www.springframework.org/schema/tx\"\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd  \n        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.3.xsd  \n        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd  \n        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd  \n        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.3.xsd\">\n        \n</beans> \n```\n\n 1. 开启注解功能，并设置扫描路径\n \n ```xml\n <!-- 1、开启注解、自动扫描 -->\n <context:annotation-config />\n\n <context:component-scan base-package=\"com.topvision.ssm\">\n    <context:exclude-filter type=\"annotation\" expression=\"org.springframework.stereotype.Controller\" />\n </context:component-scan>\n ```\n \n <font color=\"red\">\n **注意：**\n 在配置扫描路径时，要避免对Controller注解的扫描，目的是将该注解所标识的bean交给springmvc管理而不是spring管理。\n </font>\n \n 2. 加载属性文件，如数据库配置文件\n \n ```xml\n <!-- 2、加载properties -->\n\t<!-- <context:property-placeholder location=\"classpath:jdbc.properties\"/> -->\n\t<bean id=\"propertyConfigurer\"\n\t\tclass=\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\">\n\t\t<property name=\"locations\">\n\t\t\t<list>\n\t\t\t\t<value>classpath:jdbc.properties</value>\n\t\t\t</list>\n\t\t</property>\n\t</bean>\n ```\n \n 依上在classpath下新建jdbc.properties文件。\n \n ```propertiies\n s2sm.jdbc.driverClass\t= com.mysql.jdbc.Driver\n s2sm.jdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb\n s2sm.jdbc.username\t\t= root\n s2sm.jdbc.password\t\t= 123\n ```\n \n 3. 设置数据源\n\n ```xml\n <!--3、 数据库C3P0 -->\n<bean id=\"dataSource\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\">\n\t<property name=\"driverClass\" value=\"${s2sm.jdbc.driverClass}\" />\n\t<property name=\"jdbcUrl\" value=\"${s2sm.jdbc.url}\" />\n\t<property name=\"user\" value=\"${s2sm.jdbc.username}\" />\n\t<property name=\"password\" value=\"${s2sm.jdbc.password}\" />\n\n\t<property name=\"initialPoolSize\" value=\"${s2sm.cpool.initialPoolSize}\" />\n\t<property name=\"minPoolSize\" value=\"${s2sm.cpool.minPoolSize}\" />\n\t<property name=\"maxPoolSize\" value=\"${s2sm.cpool.maxPoolSize}\" />\n\t<property name=\"acquireIncrement\" value=\"${s2sm.cpool.acquireIncrement}\" />\n\t<property name=\"maxIdleTime\" value=\"${s2sm.cpool.maxIdleTime}\" />\n\t<property name=\"acquireRetryAttempts\" value=\"${s2sm.cpool.acquireRetryAttempts}\" />\n\t<property name=\"acquireRetryDelay\" value=\"${s2sm.cpool.acquireRetryDelay}\" />\n</bean>\n ```\n \n 4. 设置SqlSessionFactory\n\n ```xml\n<!-- 4、配置SqlSessionFactory对象 -->\n<bean id=\"sqlSessionFactory\" class=\"org.mybatis.spring.SqlSessionFactoryBean\">\n\t<!-- 注入数据库连接池 -->\n\t<property name=\"dataSource\" ref=\"dataSource\" />\n\t<!-- 配置MyBaties全局配置文件:mybatis-config.xml -->\n\t<property name=\"configLocation\" value=\"classpath:sqlMapConfig.xml\" />\n\t<!-- 扫描entity包 使用别名 -->\n\t<property name=\"typeAliasesPackage\" value=\"com.topvision.ssm.domain\" />\n\t<!-- 扫描sql配置文件:mapper需要的xml文件 -->\n\t<!-- <property name=\"mapperLocations\" value=\"classpath:mapper/*.xml\" /> -->\n\t<property name=\"mapperLocations\"\n\t\tvalue=\"classpath*:com/topvision/ssm/dao/mapper/*.xml\" />\n</bean>\n ```\n\n 5. 扫描Dao层接口\n\n ```xml\n<!-- 5、配置扫描Dao接口包，动态实现Dao接口，注入到spring容器中 -->\n<bean class=\"org.mybatis.spring.mapper.MapperScannerConfigurer\">\n\t<!-- 注入sqlSessionFactory -->\n\t<property name=\"sqlSessionFactoryBeanName\" value=\"sqlSessionFactory\" />\n\t<!-- 给出需要扫描Dao接口包 -->\n\t<property name=\"basePackage\" value=\"com.topvision.ssm.dao\" />\n</bean>\n ```\n\n 6. Spring事务\n\n ```xml\n<!-- 5、事务,开启注解事务 -->\n<tx:annotation-driven transaction-manager=\"transactionManager\" />\n<!-- 事务管理器 -->\n<bean id=\"transactionManager\"\n\tclass=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\">\n\t<property name=\"dataSource\" ref=\"dataSource\"></property>\n</bean>\n ```\n \n ### 2.4 配置Dao\n \n 根据上面SqlSessionFactory的设置，在classpath下新建SqlMapConfig.xml。\n \n    ```xml\n    <?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n    <!DOCTYPE configuration\n    PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"\n    \"http://mybatis.org/dtd/mybatis-3-config.dtd\">\n    \n    <configuration>\n    \n    </configuration>\n    ```\n    \n### 2.5 整合Controller\n\n#### 2.5.1 配置springmvc前端控制器\n\n```xml\n<servlet>\n\t<servlet-name>springmvc</servlet-name>\n\t<servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>\n\t<!--设置springmvc核心文件路径-->\n\t<init-param>\n\t\t<param-name>contextConfigLocation</param-name>\n\t\t<param-value>classpath:spring-mvc.xml</param-value>\n\t</init-param>\n</servlet>\n<servlet-mapping>\n\t<servlet-name>springmvc</servlet-name>\n\t<!--\n\t*.action,*.do等，以其结尾的url交由springmvc管理\n\t/ 所有请求交由springmvc，但静态资源（css,js等）交由springmvc是不对的\n\t/* 此种配置不正确，当请求为jsp页面时，springmvc无法解析\n\t-->\n\t<url-pattern>*.do</url-pattern>\n</servlet-mapping>\n```\n\n#### 2.5.2 springmvc核心文件\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:mvc=\"http://www.springframework.org/schema/mvc\"\n\txmlns:context=\"http://www.springframework.org/schema/context\"\n\txmlns:aop=\"http://www.springframework.org/schema/aop\" xmlns:tx=\"http://www.springframework.org/schema/tx\"\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \n\t\thttp://www.springframework.org/schema/beans/spring-beans-3.0.xsd \n\t\thttp://www.springframework.org/schema/mvc \n\t\thttp://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd \n\t\thttp://www.springframework.org/schema/context \n\t\thttp://www.springframework.org/schema/context/spring-context-3.0.xsd \n\t\thttp://www.springframework.org/schema/aop \n\t\thttp://www.springframework.org/schema/aop/spring-aop-3.0.xsd \n\t\thttp://www.springframework.org/schema/tx \n\t\thttp://www.springframework.org/schema/tx/spring-tx-3.0.xsd\">\n\n\n\t<!-- 可以扫描标记有@controller、@service、@repository、@component的bean -->\n\t<context:component-scan base-package=\"com.topvision.ssm.controller\">\n\t\t<context:include-filter type=\"annotation\"\n\t\t\texpression=\"org.springframework.stereotype.Controller\" />\n\t</context:component-scan>\n\n\t<!-- 注解的处理器映射器和适配器 -->\n\t<!-- <bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping\"/> \n\t\t<bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter\" \n\t\t/> -->\n\t<!-- 简写 -->\n\t<mvc:annotation-driven />\n\n\t<!-- ViewResolver -->\n\t<bean\n\t\tclass=\"org.springframework.web.servlet.view.InternalResourceViewResolver\">\n\t\t<property name=\"prefix\" value=\"/WEB-INF/jsp/\" />\n\t\t<property name=\"suffix\" value=\".jsp\" />\n\t</bean>\n\n\t<!--静态资源默认servlet配置 (1)加入对静态资源的处理：js,gif,png (2)允许使用\"/\"做整体映射 -->\n\t<!-- <mvc:default-servlet-handler/> -->\n\n</beans>\n```\n\n#### 2.5.3 开发Controller\n\n```java\n<!--该注解标识handler-->\n@Controller\npublic class Controller1 {\n\n    @Autowired\n    private BookService bookService;\n    \n    <!--该注解标识请求路径-->\n    @RequestMapping(\"/queryBook\")\n    public ModelAndView getBookById() {\n\n        Book book = bookService.findById(1000l);\n        ModelAndView modelAndView = new ModelAndView();\n        modelAndView.addObject(\"book\", book);\n        modelAndView.setViewName(\"bookDetail\");\n        return modelAndView;\n    }\n\n}\n```\n","source":"_posts/Spring-MVC-2-——整合spring-mybatis.md","raw":"---\ntitle: Spring MVC(2)——整合spring-mybatis\ncategories:\n  - Spring\ntags:\n  - SpringMVC\ndate: 2018-03-06 15:46:58\n---\n\n这边博客介绍了springmvc与spring及mybatis的继承。\n<!--more-->\n\n## 1、整合思路\n\n**dao层：**\n\n    mybatis+spring\n    目标：\n    使用spring对sqlSessionFactory进行管理\n    使用spring和mybatis整合包中的mapper扫描器对mapper接口进行扫描生成代理对象。\n    \n**service层：**\n\t\n    spring\n    目标：\n    让spring管理service类，将mapper代理对象注入到service对象中。\n    spring要对service方法执行进行事务控制\n\n**controller层：**\n\t\n\tspringmvc+spring\n\t目标：\n\t使用注解处理器映射器和适配器进行开发Handler\n\tHandler使用组件扫描方式在spring容器中进行注册\n\t\n## 2、工程搭建\n\n### 2.1 创建maven web工程\n### 2.2 设置jar包依赖(pom设置)\n\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\t<groupId>com.topvision.maven</groupId>\n\t<artifactId>ssm</artifactId>\n\t<packaging>war</packaging>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<name>ssm Maven Webapp</name>\n\t<url>http://maven.apache.org</url>\n\n\t<!-- 属性 -->\n\t<properties>\n\t\t<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n\t\t<spring.version>4.3.12.RELEASE</spring.version>\n\t\t<mybatis.version>3.4.5</mybatis.version>\n\t</properties>\n\n\t<!-- 锁定版本 -->\n\t<dependencyManagement>\n\t\t<dependencies>\n\t\t\t<dependency>\n                <groupId>org.springframework</groupId>\n                <artifactId>spring-context</artifactId>\n                <version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-aspects</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-orm</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-test</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-web</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-webmvc</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n\t\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t\t<artifactId>mybatis</artifactId>\n\t\t\t\t<version>${mybatis.version}</version>\n\t\t\t</dependency>\n\t\t</dependencies>\n\t</dependencyManagement>\n\n\t<dependencies>\n\t\t<!-- Spring -->\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-test</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-context</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-aspects</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-orm</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-web</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-webmvc</artifactId>\n\t\t</dependency>\n\t\t<!-- mybatis -->\n\t\t<dependency>\n\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t<artifactId>mybatis</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t<artifactId>mybatis-spring</artifactId>\n\t\t\t<version>1.3.1</version>\n\t\t</dependency>\n\n\t\t<!-- mysql驱动 -->\n\t\t<dependency>\n\t\t\t<groupId>mysql</groupId>\n\t\t\t<artifactId>mysql-connector-java</artifactId>\n\t\t\t<version>5.1.6</version>\n\t\t\t<scope>runtime</scope>\n\t\t</dependency>\n\n\t\t<!-- c3p0 -->\n\t\t<dependency>\n\t\t\t<groupId>c3p0</groupId>\n\t\t\t<artifactId>c3p0</artifactId>\n\t\t\t<version>0.9.1.2</version>\n\t\t</dependency>\n\t\t<!-- slf4j -->\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-log4j12</artifactId>\n\t\t\t<version>1.7.2</version>\n\t\t</dependency>\n\t\t<!-- junit -->\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>4.12</version>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t\t<dependency>\n            <groupId>org.hamcrest</groupId>\n            <artifactId>hamcrest-library</artifactId>\n            <version>1.3</version>\n        </dependency>\n\t\t<!-- jstl -->\n\t\t<dependency>\n\t\t\t<groupId>javax.servlet</groupId>\n\t\t\t<artifactId>jstl</artifactId>\n\t\t\t<version>1.2</version>\n\t\t</dependency>\n\n\t\t<!-- servlet jsp -->\n\t\t<dependency>\n\t\t\t<groupId>javax.servlet</groupId>\n\t\t\t<artifactId>servlet-api</artifactId>\n\t\t\t<version>2.5</version>\n\t\t\t<scope>provided</scope>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>javax.servlet</groupId>\n\t\t\t<artifactId>jsp-api</artifactId>\n\t\t\t<version>2.0</version>\n\t\t\t<scope>provided</scope>\n\t\t</dependency>\n\t</dependencies>\n\n\t<build>\n\t\t<plugins>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n\t\t\t\t<artifactId>maven-compiler-plugin</artifactId>\n\t\t\t\t<configuration>\n\t\t\t\t\t<source>1.8</source>\n\t\t\t\t\t<target>1.8</target>\n\t\t\t\t\t<encoding>UTF-8</encoding>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t</plugins>\n\n\t\t<finalName>ssm</finalName>\n\t</build>\n\n\n</project>\n\n```\n\n### 2.3 配置service\n\n加入spring。\n\n#### 2.3.1 web.xml\n\n配置spring监听器，设置spring核心文件的位置。\n\n```xml\n<web-app xmlns=\"http://xmlns.jcp.org/xml/ns/javaee\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/javaee\n                      http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd\"\n\tversion=\"3.1\" metadata-complete=\"true\">\n\t\n\t<!-- applicationContext对象仅加载一次，在服务器器启动时加载 -->\n\t<listener>\n\t\t<listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>\n\t</listener>\n\t<context-param>\n\t\t<param-name>contextConfigLocation</param-name>\n\t\t<param-value>classpath:applicationContext.xml</param-value>\n\t</context-param>\n\t\n</web-app>\n```\n\n#### 2.3.2 spring核心文件\n\n依据上一步的设置，在classpath下新建applicationContext.xml\n\n设置spring约束的文件头\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:aop=\"http://www.springframework.org/schema/aop\"\n\txmlns:context=\"http://www.springframework.org/schema/context\"\n\txmlns:mvc=\"http://www.springframework.org/schema/mvc\" xmlns:tx=\"http://www.springframework.org/schema/tx\"\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd  \n        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.3.xsd  \n        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd  \n        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd  \n        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.3.xsd\">\n        \n</beans> \n```\n\n 1. 开启注解功能，并设置扫描路径\n \n ```xml\n <!-- 1、开启注解、自动扫描 -->\n <context:annotation-config />\n\n <context:component-scan base-package=\"com.topvision.ssm\">\n    <context:exclude-filter type=\"annotation\" expression=\"org.springframework.stereotype.Controller\" />\n </context:component-scan>\n ```\n \n <font color=\"red\">\n **注意：**\n 在配置扫描路径时，要避免对Controller注解的扫描，目的是将该注解所标识的bean交给springmvc管理而不是spring管理。\n </font>\n \n 2. 加载属性文件，如数据库配置文件\n \n ```xml\n <!-- 2、加载properties -->\n\t<!-- <context:property-placeholder location=\"classpath:jdbc.properties\"/> -->\n\t<bean id=\"propertyConfigurer\"\n\t\tclass=\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\">\n\t\t<property name=\"locations\">\n\t\t\t<list>\n\t\t\t\t<value>classpath:jdbc.properties</value>\n\t\t\t</list>\n\t\t</property>\n\t</bean>\n ```\n \n 依上在classpath下新建jdbc.properties文件。\n \n ```propertiies\n s2sm.jdbc.driverClass\t= com.mysql.jdbc.Driver\n s2sm.jdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb\n s2sm.jdbc.username\t\t= root\n s2sm.jdbc.password\t\t= 123\n ```\n \n 3. 设置数据源\n\n ```xml\n <!--3、 数据库C3P0 -->\n<bean id=\"dataSource\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\">\n\t<property name=\"driverClass\" value=\"${s2sm.jdbc.driverClass}\" />\n\t<property name=\"jdbcUrl\" value=\"${s2sm.jdbc.url}\" />\n\t<property name=\"user\" value=\"${s2sm.jdbc.username}\" />\n\t<property name=\"password\" value=\"${s2sm.jdbc.password}\" />\n\n\t<property name=\"initialPoolSize\" value=\"${s2sm.cpool.initialPoolSize}\" />\n\t<property name=\"minPoolSize\" value=\"${s2sm.cpool.minPoolSize}\" />\n\t<property name=\"maxPoolSize\" value=\"${s2sm.cpool.maxPoolSize}\" />\n\t<property name=\"acquireIncrement\" value=\"${s2sm.cpool.acquireIncrement}\" />\n\t<property name=\"maxIdleTime\" value=\"${s2sm.cpool.maxIdleTime}\" />\n\t<property name=\"acquireRetryAttempts\" value=\"${s2sm.cpool.acquireRetryAttempts}\" />\n\t<property name=\"acquireRetryDelay\" value=\"${s2sm.cpool.acquireRetryDelay}\" />\n</bean>\n ```\n \n 4. 设置SqlSessionFactory\n\n ```xml\n<!-- 4、配置SqlSessionFactory对象 -->\n<bean id=\"sqlSessionFactory\" class=\"org.mybatis.spring.SqlSessionFactoryBean\">\n\t<!-- 注入数据库连接池 -->\n\t<property name=\"dataSource\" ref=\"dataSource\" />\n\t<!-- 配置MyBaties全局配置文件:mybatis-config.xml -->\n\t<property name=\"configLocation\" value=\"classpath:sqlMapConfig.xml\" />\n\t<!-- 扫描entity包 使用别名 -->\n\t<property name=\"typeAliasesPackage\" value=\"com.topvision.ssm.domain\" />\n\t<!-- 扫描sql配置文件:mapper需要的xml文件 -->\n\t<!-- <property name=\"mapperLocations\" value=\"classpath:mapper/*.xml\" /> -->\n\t<property name=\"mapperLocations\"\n\t\tvalue=\"classpath*:com/topvision/ssm/dao/mapper/*.xml\" />\n</bean>\n ```\n\n 5. 扫描Dao层接口\n\n ```xml\n<!-- 5、配置扫描Dao接口包，动态实现Dao接口，注入到spring容器中 -->\n<bean class=\"org.mybatis.spring.mapper.MapperScannerConfigurer\">\n\t<!-- 注入sqlSessionFactory -->\n\t<property name=\"sqlSessionFactoryBeanName\" value=\"sqlSessionFactory\" />\n\t<!-- 给出需要扫描Dao接口包 -->\n\t<property name=\"basePackage\" value=\"com.topvision.ssm.dao\" />\n</bean>\n ```\n\n 6. Spring事务\n\n ```xml\n<!-- 5、事务,开启注解事务 -->\n<tx:annotation-driven transaction-manager=\"transactionManager\" />\n<!-- 事务管理器 -->\n<bean id=\"transactionManager\"\n\tclass=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\">\n\t<property name=\"dataSource\" ref=\"dataSource\"></property>\n</bean>\n ```\n \n ### 2.4 配置Dao\n \n 根据上面SqlSessionFactory的设置，在classpath下新建SqlMapConfig.xml。\n \n    ```xml\n    <?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n    <!DOCTYPE configuration\n    PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"\n    \"http://mybatis.org/dtd/mybatis-3-config.dtd\">\n    \n    <configuration>\n    \n    </configuration>\n    ```\n    \n### 2.5 整合Controller\n\n#### 2.5.1 配置springmvc前端控制器\n\n```xml\n<servlet>\n\t<servlet-name>springmvc</servlet-name>\n\t<servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>\n\t<!--设置springmvc核心文件路径-->\n\t<init-param>\n\t\t<param-name>contextConfigLocation</param-name>\n\t\t<param-value>classpath:spring-mvc.xml</param-value>\n\t</init-param>\n</servlet>\n<servlet-mapping>\n\t<servlet-name>springmvc</servlet-name>\n\t<!--\n\t*.action,*.do等，以其结尾的url交由springmvc管理\n\t/ 所有请求交由springmvc，但静态资源（css,js等）交由springmvc是不对的\n\t/* 此种配置不正确，当请求为jsp页面时，springmvc无法解析\n\t-->\n\t<url-pattern>*.do</url-pattern>\n</servlet-mapping>\n```\n\n#### 2.5.2 springmvc核心文件\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:mvc=\"http://www.springframework.org/schema/mvc\"\n\txmlns:context=\"http://www.springframework.org/schema/context\"\n\txmlns:aop=\"http://www.springframework.org/schema/aop\" xmlns:tx=\"http://www.springframework.org/schema/tx\"\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \n\t\thttp://www.springframework.org/schema/beans/spring-beans-3.0.xsd \n\t\thttp://www.springframework.org/schema/mvc \n\t\thttp://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd \n\t\thttp://www.springframework.org/schema/context \n\t\thttp://www.springframework.org/schema/context/spring-context-3.0.xsd \n\t\thttp://www.springframework.org/schema/aop \n\t\thttp://www.springframework.org/schema/aop/spring-aop-3.0.xsd \n\t\thttp://www.springframework.org/schema/tx \n\t\thttp://www.springframework.org/schema/tx/spring-tx-3.0.xsd\">\n\n\n\t<!-- 可以扫描标记有@controller、@service、@repository、@component的bean -->\n\t<context:component-scan base-package=\"com.topvision.ssm.controller\">\n\t\t<context:include-filter type=\"annotation\"\n\t\t\texpression=\"org.springframework.stereotype.Controller\" />\n\t</context:component-scan>\n\n\t<!-- 注解的处理器映射器和适配器 -->\n\t<!-- <bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping\"/> \n\t\t<bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter\" \n\t\t/> -->\n\t<!-- 简写 -->\n\t<mvc:annotation-driven />\n\n\t<!-- ViewResolver -->\n\t<bean\n\t\tclass=\"org.springframework.web.servlet.view.InternalResourceViewResolver\">\n\t\t<property name=\"prefix\" value=\"/WEB-INF/jsp/\" />\n\t\t<property name=\"suffix\" value=\".jsp\" />\n\t</bean>\n\n\t<!--静态资源默认servlet配置 (1)加入对静态资源的处理：js,gif,png (2)允许使用\"/\"做整体映射 -->\n\t<!-- <mvc:default-servlet-handler/> -->\n\n</beans>\n```\n\n#### 2.5.3 开发Controller\n\n```java\n<!--该注解标识handler-->\n@Controller\npublic class Controller1 {\n\n    @Autowired\n    private BookService bookService;\n    \n    <!--该注解标识请求路径-->\n    @RequestMapping(\"/queryBook\")\n    public ModelAndView getBookById() {\n\n        Book book = bookService.findById(1000l);\n        ModelAndView modelAndView = new ModelAndView();\n        modelAndView.addObject(\"book\", book);\n        modelAndView.setViewName(\"bookDetail\");\n        return modelAndView;\n    }\n\n}\n```\n","slug":"Spring-MVC-2-——整合spring-mybatis","published":1,"updated":"2018-03-06T07:51:49.748Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfud002lhwvfn5fmm000","content":"<p>这边博客介绍了springmvc与spring及mybatis的继承。<br><a id=\"more\"></a></p>\n<h2 id=\"1、整合思路\"><a href=\"#1、整合思路\" class=\"headerlink\" title=\"1、整合思路\"></a>1、整合思路</h2><p><strong>dao层：</strong></p>\n<pre><code>mybatis+spring\n目标：\n使用spring对sqlSessionFactory进行管理\n使用spring和mybatis整合包中的mapper扫描器对mapper接口进行扫描生成代理对象。\n</code></pre><p><strong>service层：</strong></p>\n<pre><code>spring\n目标：\n让spring管理service类，将mapper代理对象注入到service对象中。\nspring要对service方法执行进行事务控制\n</code></pre><p><strong>controller层：</strong></p>\n<pre><code>springmvc+spring\n目标：\n使用注解处理器映射器和适配器进行开发Handler\nHandler使用组件扫描方式在spring容器中进行注册\n</code></pre><h2 id=\"2、工程搭建\"><a href=\"#2、工程搭建\" class=\"headerlink\" title=\"2、工程搭建\"></a>2、工程搭建</h2><h3 id=\"2-1-创建maven-web工程\"><a href=\"#2-1-创建maven-web工程\" class=\"headerlink\" title=\"2.1 创建maven web工程\"></a>2.1 创建maven web工程</h3><h3 id=\"2-2-设置jar包依赖-pom设置\"><a href=\"#2-2-设置jar包依赖-pom设置\" class=\"headerlink\" title=\"2.2 设置jar包依赖(pom设置)\"></a>2.2 设置jar包依赖(pom设置)</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.topvision.maven<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>ssm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>war<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>ssm Maven Webapp<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.apache.org<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 属性 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">spring.version</span>&gt;</span>4.3.12.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">spring.version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">mybatis.version</span>&gt;</span>3.4.5<span class=\"tag\">&lt;/<span class=\"name\">mybatis.version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 锁定版本 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aspects<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-orm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-webmvc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- Spring --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aspects<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-orm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-webmvc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mybatis --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-spring<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mysql驱动 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- c3p0 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- slf4j --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-log4j12<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- junit --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.hamcrest<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>hamcrest-library<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- jstl --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jstl<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- servlet jsp --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>servlet-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jsp-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">encoding</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>ssm<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"2-3-配置service\"><a href=\"#2-3-配置service\" class=\"headerlink\" title=\"2.3 配置service\"></a>2.3 配置service</h3><p>加入spring。</p>\n<h4 id=\"2-3-1-web-xml\"><a href=\"#2-3-1-web-xml\" class=\"headerlink\" title=\"2.3.1 web.xml\"></a>2.3.1 web.xml</h4><p>配置spring监听器，设置spring核心文件的位置。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://xmlns.jcp.org/xml/ns/javaee\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://xmlns.jcp.org/xml/ns/javaee</span></div><div class=\"line\">                      http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd\"</div><div class=\"line\">\t<span class=\"attr\">version</span>=<span class=\"string\">\"3.1\"</span> <span class=\"attr\">metadata-complete</span>=<span class=\"string\">\"true\"</span>&gt;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- applicationContext对象仅加载一次，在服务器器启动时加载 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">listener</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class=\"tag\">&lt;/<span class=\"name\">listener-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">listener</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">context-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>contextConfigLocation<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:applicationContext.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">context-param</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-3-2-spring核心文件\"><a href=\"#2-3-2-spring核心文件\" class=\"headerlink\" title=\"2.3.2 spring核心文件\"></a>2.3.2 spring核心文件</h4><p>依据上一步的设置，在classpath下新建applicationContext.xml</p>\n<p>设置spring约束的文件头</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span> <span class=\"attr\">xmlns:aop</span>=<span class=\"string\">\"http://www.springframework.org/schema/aop\"</span></div><div class=\"line\">\t<span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></div><div class=\"line\">\t<span class=\"attr\">xmlns:mvc</span>=<span class=\"string\">\"http://www.springframework.org/schema/mvc\"</span> <span class=\"attr\">xmlns:tx</span>=<span class=\"string\">\"http://www.springframework.org/schema/tx\"</span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd  </span></div><div class=\"line\">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.3.xsd  </div><div class=\"line\">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd  </div><div class=\"line\">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd  </div><div class=\"line\">        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.3.xsd\"&gt;</div><div class=\"line\">        </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></div></pre></td></tr></table></figure>\n<ol>\n<li><p>开启注解功能，并设置扫描路径</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 1、开启注解、自动扫描 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:annotation-config</span> /&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.ssm\"</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">context:exclude-filter</span> <span class=\"attr\">type</span>=<span class=\"string\">\"annotation\"</span> <span class=\"attr\">expression</span>=<span class=\"string\">\"org.springframework.stereotype.Controller\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">context:component-scan</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n <font color=\"red\"><br> <strong>注意：</strong><br> 在配置扫描路径时，要避免对Controller注解的扫描，目的是将该注解所标识的bean交给springmvc管理而不是spring管理。<br> </font>\n\n<ol>\n<li><p>加载属性文件，如数据库配置文件</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 2、加载properties --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- &lt;context:property-placeholder location=\"classpath:jdbc.properties\"/&gt; --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"propertyConfigurer\"</span></span></div><div class=\"line\">\t<span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"locations\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>classpath:jdbc.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p> 依上在classpath下新建jdbc.properties文件。</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">s2sm.jdbc.driverClass\t= com.mysql.jdbc.Driver</div><div class=\"line\">s2sm.jdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb</div><div class=\"line\">s2sm.jdbc.username\t\t= root</div><div class=\"line\">s2sm.jdbc.password\t\t= 123</div></pre></td></tr></table></figure>\n<ol>\n<li><p>设置数据源</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"comment\">&lt;!--3、 数据库C3P0 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.mchange.v2.c3p0.ComboPooledDataSource\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.driverClass&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.url&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.username&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.password&#125;\"</span> /&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"initialPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.initialPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"minPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.minPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"maxPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.maxPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireIncrement\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireIncrement&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"maxIdleTime\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.maxIdleTime&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireRetryAttempts\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireRetryAttempts&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireRetryDelay\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireRetryDelay&#125;\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>设置SqlSessionFactory</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 4、配置SqlSessionFactory对象 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"sqlSessionFactory\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.mybatis.spring.SqlSessionFactoryBean\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 注入数据库连接池 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 配置MyBaties全局配置文件:mybatis-config.xml --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"configLocation\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"classpath:sqlMapConfig.xml\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 扫描entity包 使用别名 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"typeAliasesPackage\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.topvision.ssm.domain\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 扫描sql配置文件:mapper需要的xml文件 --&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- &lt;property name=\"mapperLocations\" value=\"classpath:mapper/*.xml\" /&gt; --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"mapperLocations\"</span></span></div><div class=\"line\">\t\t<span class=\"attr\">value</span>=<span class=\"string\">\"classpath*:com/topvision/ssm/dao/mapper/*.xml\"</span> /&gt;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>扫描Dao层接口</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 5、配置扫描Dao接口包，动态实现Dao接口，注入到spring容器中 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.mybatis.spring.mapper.MapperScannerConfigurer\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 注入sqlSessionFactory --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"sqlSessionFactoryBeanName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"sqlSessionFactory\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 给出需要扫描Dao接口包 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"basePackage\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.topvision.ssm.dao\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>Spring事务</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 5、事务,开启注解事务 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tx:annotation-driven</span> <span class=\"attr\">transaction-manager</span>=<span class=\"string\">\"transactionManager\"</span> /&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 事务管理器 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"transactionManager\"</span></span></div><div class=\"line\">\t<span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DataSourceTransactionManager\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"2-4-配置Dao\"><a href=\"#2-4-配置Dao\" class=\"headerlink\" title=\"2.4 配置Dao\"></a>2.4 配置Dao</h3><p> 根据上面SqlSessionFactory的设置，在classpath下新建SqlMapConfig.xml。</p>\n<pre><code><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE configuration</span></div><div class=\"line\">PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"</div><div class=\"line\">\"http://mybatis.org/dtd/mybatis-3-config.dtd\"&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div></pre></td></tr></table></figure>\n</code></pre><h3 id=\"2-5-整合Controller\"><a href=\"#2-5-整合Controller\" class=\"headerlink\" title=\"2.5 整合Controller\"></a>2.5 整合Controller</h3><h4 id=\"2-5-1-配置springmvc前端控制器\"><a href=\"#2-5-1-配置springmvc前端控制器\" class=\"headerlink\" title=\"2.5.1 配置springmvc前端控制器\"></a>2.5.1 配置springmvc前端控制器</h4><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>springmvc<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!--设置springmvc核心文件路径--&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>contextConfigLocation<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>springmvc<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!--</span></div><div class=\"line\">\t*.action,*.do等，以其结尾的url交由springmvc管理</div><div class=\"line\">\t/ 所有请求交由springmvc，但静态资源（css,js等）交由springmvc是不对的</div><div class=\"line\">\t/* 此种配置不正确，当请求为jsp页面时，springmvc无法解析</div><div class=\"line\">\t--&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>*.do<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-5-2-springmvc核心文件\"><a href=\"#2-5-2-springmvc核心文件\" class=\"headerlink\" title=\"2.5.2 springmvc核心文件\"></a>2.5.2 springmvc核心文件</h4><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span> <span class=\"attr\">xmlns:mvc</span>=<span class=\"string\">\"http://www.springframework.org/schema/mvc\"</span></div><div class=\"line\">\t<span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></div><div class=\"line\">\t<span class=\"attr\">xmlns:aop</span>=<span class=\"string\">\"http://www.springframework.org/schema/aop\"</span> <span class=\"attr\">xmlns:tx</span>=<span class=\"string\">\"http://www.springframework.org/schema/tx\"</span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans </span></div><div class=\"line\">\t\thttp://www.springframework.org/schema/beans/spring-beans-3.0.xsd </div><div class=\"line\">\t\thttp://www.springframework.org/schema/mvc </div><div class=\"line\">\t\thttp://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd </div><div class=\"line\">\t\thttp://www.springframework.org/schema/context </div><div class=\"line\">\t\thttp://www.springframework.org/schema/context/spring-context-3.0.xsd </div><div class=\"line\">\t\thttp://www.springframework.org/schema/aop </div><div class=\"line\">\t\thttp://www.springframework.org/schema/aop/spring-aop-3.0.xsd </div><div class=\"line\">\t\thttp://www.springframework.org/schema/tx </div><div class=\"line\">\t\thttp://www.springframework.org/schema/tx/spring-tx-3.0.xsd\"&gt;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 可以扫描标记有@controller、@service、@repository、@component的bean --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.ssm.controller\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">context:include-filter</span> <span class=\"attr\">type</span>=<span class=\"string\">\"annotation\"</span></span></div><div class=\"line\">\t\t\t<span class=\"attr\">expression</span>=<span class=\"string\">\"org.springframework.stereotype.Controller\"</span> /&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">context:component-scan</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 注解的处理器映射器和适配器 --&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- &lt;bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping\"/&gt; </span></div><div class=\"line\">\t\t&lt;bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter\" </div><div class=\"line\">\t\t/&gt; --&gt;</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 简写 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">mvc:annotation-driven</span> /&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- ViewResolver --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span></span></div><div class=\"line\">\t\t<span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.web.servlet.view.InternalResourceViewResolver\"</span>&gt;</div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"prefix\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"/WEB-INF/jsp/\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"suffix\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\".jsp\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!--静态资源默认servlet配置 (1)加入对静态资源的处理：js,gif,png (2)允许使用\"/\"做整体映射 --&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- &lt;mvc:default-servlet-handler/&gt; --&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-5-3-开发Controller\"><a href=\"#2-5-3-开发Controller\" class=\"headerlink\" title=\"2.5.3 开发Controller\"></a>2.5.3 开发Controller</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;!--该注解标识handler--&gt;</div><div class=\"line\"><span class=\"meta\">@Controller</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Controller1</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Autowired</span></div><div class=\"line\">    <span class=\"keyword\">private</span> BookService bookService;</div><div class=\"line\">    </div><div class=\"line\">    &lt;!--该注解标识请求路径--&gt;</div><div class=\"line\">    <span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/queryBook\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">getBookById</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">        Book book = bookService.findById(<span class=\"number\">1000l</span>);</div><div class=\"line\">        ModelAndView modelAndView = <span class=\"keyword\">new</span> ModelAndView();</div><div class=\"line\">        modelAndView.addObject(<span class=\"string\">\"book\"</span>, book);</div><div class=\"line\">        modelAndView.setViewName(<span class=\"string\">\"bookDetail\"</span>);</div><div class=\"line\">        <span class=\"keyword\">return</span> modelAndView;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>这边博客介绍了springmvc与spring及mybatis的继承。<br>","more":"</p>\n<h2 id=\"1、整合思路\"><a href=\"#1、整合思路\" class=\"headerlink\" title=\"1、整合思路\"></a>1、整合思路</h2><p><strong>dao层：</strong></p>\n<pre><code>mybatis+spring\n目标：\n使用spring对sqlSessionFactory进行管理\n使用spring和mybatis整合包中的mapper扫描器对mapper接口进行扫描生成代理对象。\n</code></pre><p><strong>service层：</strong></p>\n<pre><code>spring\n目标：\n让spring管理service类，将mapper代理对象注入到service对象中。\nspring要对service方法执行进行事务控制\n</code></pre><p><strong>controller层：</strong></p>\n<pre><code>springmvc+spring\n目标：\n使用注解处理器映射器和适配器进行开发Handler\nHandler使用组件扫描方式在spring容器中进行注册\n</code></pre><h2 id=\"2、工程搭建\"><a href=\"#2、工程搭建\" class=\"headerlink\" title=\"2、工程搭建\"></a>2、工程搭建</h2><h3 id=\"2-1-创建maven-web工程\"><a href=\"#2-1-创建maven-web工程\" class=\"headerlink\" title=\"2.1 创建maven web工程\"></a>2.1 创建maven web工程</h3><h3 id=\"2-2-设置jar包依赖-pom设置\"><a href=\"#2-2-设置jar包依赖-pom设置\" class=\"headerlink\" title=\"2.2 设置jar包依赖(pom设置)\"></a>2.2 设置jar包依赖(pom设置)</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.topvision.maven<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>ssm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>war<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>ssm Maven Webapp<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.apache.org<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 属性 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">spring.version</span>&gt;</span>4.3.12.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">spring.version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">mybatis.version</span>&gt;</span>3.4.5<span class=\"tag\">&lt;/<span class=\"name\">mybatis.version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 锁定版本 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aspects<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-orm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-webmvc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- Spring --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aspects<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-orm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-webmvc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mybatis --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-spring<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mysql驱动 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- c3p0 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- slf4j --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-log4j12<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- junit --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.12<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.hamcrest<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>hamcrest-library<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- jstl --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jstl<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- servlet jsp --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>servlet-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jsp-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">encoding</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>ssm<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"2-3-配置service\"><a href=\"#2-3-配置service\" class=\"headerlink\" title=\"2.3 配置service\"></a>2.3 配置service</h3><p>加入spring。</p>\n<h4 id=\"2-3-1-web-xml\"><a href=\"#2-3-1-web-xml\" class=\"headerlink\" title=\"2.3.1 web.xml\"></a>2.3.1 web.xml</h4><p>配置spring监听器，设置spring核心文件的位置。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://xmlns.jcp.org/xml/ns/javaee\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://xmlns.jcp.org/xml/ns/javaee</span></div><div class=\"line\">                      http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd\"</div><div class=\"line\">\t<span class=\"attr\">version</span>=<span class=\"string\">\"3.1\"</span> <span class=\"attr\">metadata-complete</span>=<span class=\"string\">\"true\"</span>&gt;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- applicationContext对象仅加载一次，在服务器器启动时加载 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">listener</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class=\"tag\">&lt;/<span class=\"name\">listener-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">listener</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">context-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>contextConfigLocation<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:applicationContext.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">context-param</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-3-2-spring核心文件\"><a href=\"#2-3-2-spring核心文件\" class=\"headerlink\" title=\"2.3.2 spring核心文件\"></a>2.3.2 spring核心文件</h4><p>依据上一步的设置，在classpath下新建applicationContext.xml</p>\n<p>设置spring约束的文件头</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span> <span class=\"attr\">xmlns:aop</span>=<span class=\"string\">\"http://www.springframework.org/schema/aop\"</span></div><div class=\"line\">\t<span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></div><div class=\"line\">\t<span class=\"attr\">xmlns:mvc</span>=<span class=\"string\">\"http://www.springframework.org/schema/mvc\"</span> <span class=\"attr\">xmlns:tx</span>=<span class=\"string\">\"http://www.springframework.org/schema/tx\"</span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd  </span></div><div class=\"line\">        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.3.xsd  </div><div class=\"line\">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd  </div><div class=\"line\">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd  </div><div class=\"line\">        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.3.xsd\"&gt;</div><div class=\"line\">        </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></div></pre></td></tr></table></figure>\n<ol>\n<li><p>开启注解功能，并设置扫描路径</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 1、开启注解、自动扫描 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:annotation-config</span> /&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.ssm\"</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">context:exclude-filter</span> <span class=\"attr\">type</span>=<span class=\"string\">\"annotation\"</span> <span class=\"attr\">expression</span>=<span class=\"string\">\"org.springframework.stereotype.Controller\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">context:component-scan</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n <font color=\"red\"><br> <strong>注意：</strong><br> 在配置扫描路径时，要避免对Controller注解的扫描，目的是将该注解所标识的bean交给springmvc管理而不是spring管理。<br> </font>\n\n<ol>\n<li><p>加载属性文件，如数据库配置文件</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 2、加载properties --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- &lt;context:property-placeholder location=\"classpath:jdbc.properties\"/&gt; --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"propertyConfigurer\"</span></span></div><div class=\"line\">\t<span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"locations\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>classpath:jdbc.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p> 依上在classpath下新建jdbc.properties文件。</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">s2sm.jdbc.driverClass\t= com.mysql.jdbc.Driver</div><div class=\"line\">s2sm.jdbc.url\t\t \t= jdbc:mysql://localhost:3306/springdb</div><div class=\"line\">s2sm.jdbc.username\t\t= root</div><div class=\"line\">s2sm.jdbc.password\t\t= 123</div></pre></td></tr></table></figure>\n<ol>\n<li><p>设置数据源</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"comment\">&lt;!--3、 数据库C3P0 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.mchange.v2.c3p0.ComboPooledDataSource\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.driverClass&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.url&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.username&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.password&#125;\"</span> /&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"initialPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.initialPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"minPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.minPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"maxPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.maxPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireIncrement\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireIncrement&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"maxIdleTime\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.maxIdleTime&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireRetryAttempts\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireRetryAttempts&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireRetryDelay\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireRetryDelay&#125;\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>设置SqlSessionFactory</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 4、配置SqlSessionFactory对象 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"sqlSessionFactory\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.mybatis.spring.SqlSessionFactoryBean\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 注入数据库连接池 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 配置MyBaties全局配置文件:mybatis-config.xml --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"configLocation\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"classpath:sqlMapConfig.xml\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 扫描entity包 使用别名 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"typeAliasesPackage\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.topvision.ssm.domain\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 扫描sql配置文件:mapper需要的xml文件 --&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- &lt;property name=\"mapperLocations\" value=\"classpath:mapper/*.xml\" /&gt; --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"mapperLocations\"</span></span></div><div class=\"line\">\t\t<span class=\"attr\">value</span>=<span class=\"string\">\"classpath*:com/topvision/ssm/dao/mapper/*.xml\"</span> /&gt;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>扫描Dao层接口</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 5、配置扫描Dao接口包，动态实现Dao接口，注入到spring容器中 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.mybatis.spring.mapper.MapperScannerConfigurer\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 注入sqlSessionFactory --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"sqlSessionFactoryBeanName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"sqlSessionFactory\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 给出需要扫描Dao接口包 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"basePackage\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.topvision.ssm.dao\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>Spring事务</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 5、事务,开启注解事务 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">tx:annotation-driven</span> <span class=\"attr\">transaction-manager</span>=<span class=\"string\">\"transactionManager\"</span> /&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 事务管理器 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"transactionManager\"</span></span></div><div class=\"line\">\t<span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DataSourceTransactionManager\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"2-4-配置Dao\"><a href=\"#2-4-配置Dao\" class=\"headerlink\" title=\"2.4 配置Dao\"></a>2.4 配置Dao</h3><p> 根据上面SqlSessionFactory的设置，在classpath下新建SqlMapConfig.xml。</p>\n<pre><code><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE configuration</span></div><div class=\"line\">PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\"</div><div class=\"line\">\"http://mybatis.org/dtd/mybatis-3-config.dtd\"&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div></pre></td></tr></table></figure>\n</code></pre><h3 id=\"2-5-整合Controller\"><a href=\"#2-5-整合Controller\" class=\"headerlink\" title=\"2.5 整合Controller\"></a>2.5 整合Controller</h3><h4 id=\"2-5-1-配置springmvc前端控制器\"><a href=\"#2-5-1-配置springmvc前端控制器\" class=\"headerlink\" title=\"2.5.1 配置springmvc前端控制器\"></a>2.5.1 配置springmvc前端控制器</h4><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>springmvc<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!--设置springmvc核心文件路径--&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>contextConfigLocation<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>springmvc<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!--</span></div><div class=\"line\">\t*.action,*.do等，以其结尾的url交由springmvc管理</div><div class=\"line\">\t/ 所有请求交由springmvc，但静态资源（css,js等）交由springmvc是不对的</div><div class=\"line\">\t/* 此种配置不正确，当请求为jsp页面时，springmvc无法解析</div><div class=\"line\">\t--&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>*.do<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-5-2-springmvc核心文件\"><a href=\"#2-5-2-springmvc核心文件\" class=\"headerlink\" title=\"2.5.2 springmvc核心文件\"></a>2.5.2 springmvc核心文件</h4><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span> <span class=\"attr\">xmlns:mvc</span>=<span class=\"string\">\"http://www.springframework.org/schema/mvc\"</span></div><div class=\"line\">\t<span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></div><div class=\"line\">\t<span class=\"attr\">xmlns:aop</span>=<span class=\"string\">\"http://www.springframework.org/schema/aop\"</span> <span class=\"attr\">xmlns:tx</span>=<span class=\"string\">\"http://www.springframework.org/schema/tx\"</span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans </span></div><div class=\"line\">\t\thttp://www.springframework.org/schema/beans/spring-beans-3.0.xsd </div><div class=\"line\">\t\thttp://www.springframework.org/schema/mvc </div><div class=\"line\">\t\thttp://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd </div><div class=\"line\">\t\thttp://www.springframework.org/schema/context </div><div class=\"line\">\t\thttp://www.springframework.org/schema/context/spring-context-3.0.xsd </div><div class=\"line\">\t\thttp://www.springframework.org/schema/aop </div><div class=\"line\">\t\thttp://www.springframework.org/schema/aop/spring-aop-3.0.xsd </div><div class=\"line\">\t\thttp://www.springframework.org/schema/tx </div><div class=\"line\">\t\thttp://www.springframework.org/schema/tx/spring-tx-3.0.xsd\"&gt;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 可以扫描标记有@controller、@service、@repository、@component的bean --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.ssm.controller\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">context:include-filter</span> <span class=\"attr\">type</span>=<span class=\"string\">\"annotation\"</span></span></div><div class=\"line\">\t\t\t<span class=\"attr\">expression</span>=<span class=\"string\">\"org.springframework.stereotype.Controller\"</span> /&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">context:component-scan</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 注解的处理器映射器和适配器 --&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- &lt;bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping\"/&gt; </span></div><div class=\"line\">\t\t&lt;bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter\" </div><div class=\"line\">\t\t/&gt; --&gt;</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 简写 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">mvc:annotation-driven</span> /&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- ViewResolver --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span></span></div><div class=\"line\">\t\t<span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.web.servlet.view.InternalResourceViewResolver\"</span>&gt;</div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"prefix\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"/WEB-INF/jsp/\"</span> /&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"suffix\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\".jsp\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!--静态资源默认servlet配置 (1)加入对静态资源的处理：js,gif,png (2)允许使用\"/\"做整体映射 --&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- &lt;mvc:default-servlet-handler/&gt; --&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></div></pre></td></tr></table></figure>\n<h4 id=\"2-5-3-开发Controller\"><a href=\"#2-5-3-开发Controller\" class=\"headerlink\" title=\"2.5.3 开发Controller\"></a>2.5.3 开发Controller</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;!--该注解标识handler--&gt;</div><div class=\"line\"><span class=\"meta\">@Controller</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Controller1</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Autowired</span></div><div class=\"line\">    <span class=\"keyword\">private</span> BookService bookService;</div><div class=\"line\">    </div><div class=\"line\">    &lt;!--该注解标识请求路径--&gt;</div><div class=\"line\">    <span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/queryBook\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">getBookById</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">        Book book = bookService.findById(<span class=\"number\">1000l</span>);</div><div class=\"line\">        ModelAndView modelAndView = <span class=\"keyword\">new</span> ModelAndView();</div><div class=\"line\">        modelAndView.addObject(<span class=\"string\">\"book\"</span>, book);</div><div class=\"line\">        modelAndView.setViewName(<span class=\"string\">\"bookDetail\"</span>);</div><div class=\"line\">        <span class=\"keyword\">return</span> modelAndView;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>"},{"title":"Mysql视图的简单使用","keyword":["Mysql","视图"],"date":"2018-04-10T13:07:20.000Z","_content":"\n视图是指计算机数据库中的视图，是一个虚拟表，其内容由查询定义。同真实的表一样，视图包含一系列带有名称的列和行数据。但是，视图并不在数据库中以存储的数据值集形式存在。行和列数据来自由定义视图的查询所引用的表，并且在引用视图时动态生成。——百度百科\n\n<!--more-->\n\n## 1、创建\n\n要在MySQL中创建一个新视图，可以使用CREATE VIEW语句。 在MySQL中创建视图的语法如下：\n\n```sql\nCREATE \n   [ALGORITHM = {MERGE  | TEMPTABLE | UNDEFINED}]\nVIEW [database_name].[view_name] \nAS\n[SELECT  statement]\n```\n\n下面我们来详细的查看上面的语法。\n\n### 1.1、查看处理算法:\n\n算法属性允许您控制MySQL在创建视图时使用的机制，MySQL提供了三种算法：MERGE，TEMPTABLE和UNDEFINED。\n\n - 使用MERGE算法，MySQL首先将输入查询与定义视图的SELECT语句组合成单个查询。 然后MySQL执行组合查询返回结果集。 如果SELECT语句包含集合函数(如MIN，MAX，SUM，COUNT，AVG等)或DISTINCT，GROUP BY，HAVING，LIMIT，UNION，UNION ALL，子查询，则不允许使用MERGE算法。 如果SELECT语句无引用表，则也不允许使用MERGE算法。 如果不允许MERGE算法，MySQL将算法更改为UNDEFINED。请注意，将视图定义中的输入查询和查询组合成一个查询称为视图分辨率。\n - 使用TEMPTABLE算法，MySQL首先根据定义视图的SELECT语句创建一个临时表，然后针对该临时表执行输入查询。因为MySQL必须创建临时表来存储结果集并将数据从基表移动到临时表，所以TEMPTABLE算法的效率比MERGE算法效率低。 另外，使用TEMPTABLE算法的视图是不可更新的。\n - 当您创建视图而不指定显式算法时，UNDEFINED是默认算法。UNDEFINED算法使MySQL可以选择使用MERGE或TEMPTABLE算法。MySQL优先使用MERGE算法进行TEMPTABLE算法，因为MERGE算法效率更高。\n\n### 1.2、查看名称\n\n在数据库中，视图和表共享相同的命名空间，因此视图和表不能具有相同的名称。 另外，视图的名称必须遵循表的命名规则。\n\n### 1.3、SELECT语句\n\n在SELECT语句中，可以从数据库中存在的任何表或视图查询数据。SELECT语句必须遵循以下几个规则：\n\n - SELECT语句可以在WHERE子句中包含子查询，但FROM子句中的不能包含子查询。\n - SELECT语句不能引用任何变量，包括局部变量，用户变量和会话变量。\n - SELECT语句不能引用准备语句的参数。\n \n\n \n\n\n\n\n","source":"_posts/Mysql视图的简单使用.md","raw":"---\ntitle: Mysql视图的简单使用\ncategories:\n  - Mysql\ntags:\n  - Mysql\n  - 数据库\nkeyword:\n  - Mysql\n  - 视图\ndate: 2018-04-10 21:07:20\n---\n\n视图是指计算机数据库中的视图，是一个虚拟表，其内容由查询定义。同真实的表一样，视图包含一系列带有名称的列和行数据。但是，视图并不在数据库中以存储的数据值集形式存在。行和列数据来自由定义视图的查询所引用的表，并且在引用视图时动态生成。——百度百科\n\n<!--more-->\n\n## 1、创建\n\n要在MySQL中创建一个新视图，可以使用CREATE VIEW语句。 在MySQL中创建视图的语法如下：\n\n```sql\nCREATE \n   [ALGORITHM = {MERGE  | TEMPTABLE | UNDEFINED}]\nVIEW [database_name].[view_name] \nAS\n[SELECT  statement]\n```\n\n下面我们来详细的查看上面的语法。\n\n### 1.1、查看处理算法:\n\n算法属性允许您控制MySQL在创建视图时使用的机制，MySQL提供了三种算法：MERGE，TEMPTABLE和UNDEFINED。\n\n - 使用MERGE算法，MySQL首先将输入查询与定义视图的SELECT语句组合成单个查询。 然后MySQL执行组合查询返回结果集。 如果SELECT语句包含集合函数(如MIN，MAX，SUM，COUNT，AVG等)或DISTINCT，GROUP BY，HAVING，LIMIT，UNION，UNION ALL，子查询，则不允许使用MERGE算法。 如果SELECT语句无引用表，则也不允许使用MERGE算法。 如果不允许MERGE算法，MySQL将算法更改为UNDEFINED。请注意，将视图定义中的输入查询和查询组合成一个查询称为视图分辨率。\n - 使用TEMPTABLE算法，MySQL首先根据定义视图的SELECT语句创建一个临时表，然后针对该临时表执行输入查询。因为MySQL必须创建临时表来存储结果集并将数据从基表移动到临时表，所以TEMPTABLE算法的效率比MERGE算法效率低。 另外，使用TEMPTABLE算法的视图是不可更新的。\n - 当您创建视图而不指定显式算法时，UNDEFINED是默认算法。UNDEFINED算法使MySQL可以选择使用MERGE或TEMPTABLE算法。MySQL优先使用MERGE算法进行TEMPTABLE算法，因为MERGE算法效率更高。\n\n### 1.2、查看名称\n\n在数据库中，视图和表共享相同的命名空间，因此视图和表不能具有相同的名称。 另外，视图的名称必须遵循表的命名规则。\n\n### 1.3、SELECT语句\n\n在SELECT语句中，可以从数据库中存在的任何表或视图查询数据。SELECT语句必须遵循以下几个规则：\n\n - SELECT语句可以在WHERE子句中包含子查询，但FROM子句中的不能包含子查询。\n - SELECT语句不能引用任何变量，包括局部变量，用户变量和会话变量。\n - SELECT语句不能引用准备语句的参数。\n \n\n \n\n\n\n\n","slug":"Mysql视图的简单使用","published":1,"updated":"2018-04-11T06:17:55.052Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfug002qhwvfwaiz3dal","content":"<p>视图是指计算机数据库中的视图，是一个虚拟表，其内容由查询定义。同真实的表一样，视图包含一系列带有名称的列和行数据。但是，视图并不在数据库中以存储的数据值集形式存在。行和列数据来自由定义视图的查询所引用的表，并且在引用视图时动态生成。——百度百科</p>\n<a id=\"more\"></a>\n<h2 id=\"1、创建\"><a href=\"#1、创建\" class=\"headerlink\" title=\"1、创建\"></a>1、创建</h2><p>要在MySQL中创建一个新视图，可以使用CREATE VIEW语句。 在MySQL中创建视图的语法如下：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> </div><div class=\"line\">   [ALGORITHM = &#123;<span class=\"keyword\">MERGE</span>  | TEMPTABLE | UNDEFINED&#125;]</div><div class=\"line\"><span class=\"keyword\">VIEW</span> [database_name].[view_name] </div><div class=\"line\"><span class=\"keyword\">AS</span></div><div class=\"line\">[<span class=\"keyword\">SELECT</span>  <span class=\"keyword\">statement</span>]</div></pre></td></tr></table></figure>\n<p>下面我们来详细的查看上面的语法。</p>\n<h3 id=\"1-1、查看处理算法\"><a href=\"#1-1、查看处理算法\" class=\"headerlink\" title=\"1.1、查看处理算法:\"></a>1.1、查看处理算法:</h3><p>算法属性允许您控制MySQL在创建视图时使用的机制，MySQL提供了三种算法：MERGE，TEMPTABLE和UNDEFINED。</p>\n<ul>\n<li>使用MERGE算法，MySQL首先将输入查询与定义视图的SELECT语句组合成单个查询。 然后MySQL执行组合查询返回结果集。 如果SELECT语句包含集合函数(如MIN，MAX，SUM，COUNT，AVG等)或DISTINCT，GROUP BY，HAVING，LIMIT，UNION，UNION ALL，子查询，则不允许使用MERGE算法。 如果SELECT语句无引用表，则也不允许使用MERGE算法。 如果不允许MERGE算法，MySQL将算法更改为UNDEFINED。请注意，将视图定义中的输入查询和查询组合成一个查询称为视图分辨率。</li>\n<li>使用TEMPTABLE算法，MySQL首先根据定义视图的SELECT语句创建一个临时表，然后针对该临时表执行输入查询。因为MySQL必须创建临时表来存储结果集并将数据从基表移动到临时表，所以TEMPTABLE算法的效率比MERGE算法效率低。 另外，使用TEMPTABLE算法的视图是不可更新的。</li>\n<li>当您创建视图而不指定显式算法时，UNDEFINED是默认算法。UNDEFINED算法使MySQL可以选择使用MERGE或TEMPTABLE算法。MySQL优先使用MERGE算法进行TEMPTABLE算法，因为MERGE算法效率更高。</li>\n</ul>\n<h3 id=\"1-2、查看名称\"><a href=\"#1-2、查看名称\" class=\"headerlink\" title=\"1.2、查看名称\"></a>1.2、查看名称</h3><p>在数据库中，视图和表共享相同的命名空间，因此视图和表不能具有相同的名称。 另外，视图的名称必须遵循表的命名规则。</p>\n<h3 id=\"1-3、SELECT语句\"><a href=\"#1-3、SELECT语句\" class=\"headerlink\" title=\"1.3、SELECT语句\"></a>1.3、SELECT语句</h3><p>在SELECT语句中，可以从数据库中存在的任何表或视图查询数据。SELECT语句必须遵循以下几个规则：</p>\n<ul>\n<li>SELECT语句可以在WHERE子句中包含子查询，但FROM子句中的不能包含子查询。</li>\n<li>SELECT语句不能引用任何变量，包括局部变量，用户变量和会话变量。</li>\n<li>SELECT语句不能引用准备语句的参数。</li>\n</ul>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>视图是指计算机数据库中的视图，是一个虚拟表，其内容由查询定义。同真实的表一样，视图包含一系列带有名称的列和行数据。但是，视图并不在数据库中以存储的数据值集形式存在。行和列数据来自由定义视图的查询所引用的表，并且在引用视图时动态生成。——百度百科</p>","more":"<h2 id=\"1、创建\"><a href=\"#1、创建\" class=\"headerlink\" title=\"1、创建\"></a>1、创建</h2><p>要在MySQL中创建一个新视图，可以使用CREATE VIEW语句。 在MySQL中创建视图的语法如下：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">CREATE</span> </div><div class=\"line\">   [ALGORITHM = &#123;<span class=\"keyword\">MERGE</span>  | TEMPTABLE | UNDEFINED&#125;]</div><div class=\"line\"><span class=\"keyword\">VIEW</span> [database_name].[view_name] </div><div class=\"line\"><span class=\"keyword\">AS</span></div><div class=\"line\">[<span class=\"keyword\">SELECT</span>  <span class=\"keyword\">statement</span>]</div></pre></td></tr></table></figure>\n<p>下面我们来详细的查看上面的语法。</p>\n<h3 id=\"1-1、查看处理算法\"><a href=\"#1-1、查看处理算法\" class=\"headerlink\" title=\"1.1、查看处理算法:\"></a>1.1、查看处理算法:</h3><p>算法属性允许您控制MySQL在创建视图时使用的机制，MySQL提供了三种算法：MERGE，TEMPTABLE和UNDEFINED。</p>\n<ul>\n<li>使用MERGE算法，MySQL首先将输入查询与定义视图的SELECT语句组合成单个查询。 然后MySQL执行组合查询返回结果集。 如果SELECT语句包含集合函数(如MIN，MAX，SUM，COUNT，AVG等)或DISTINCT，GROUP BY，HAVING，LIMIT，UNION，UNION ALL，子查询，则不允许使用MERGE算法。 如果SELECT语句无引用表，则也不允许使用MERGE算法。 如果不允许MERGE算法，MySQL将算法更改为UNDEFINED。请注意，将视图定义中的输入查询和查询组合成一个查询称为视图分辨率。</li>\n<li>使用TEMPTABLE算法，MySQL首先根据定义视图的SELECT语句创建一个临时表，然后针对该临时表执行输入查询。因为MySQL必须创建临时表来存储结果集并将数据从基表移动到临时表，所以TEMPTABLE算法的效率比MERGE算法效率低。 另外，使用TEMPTABLE算法的视图是不可更新的。</li>\n<li>当您创建视图而不指定显式算法时，UNDEFINED是默认算法。UNDEFINED算法使MySQL可以选择使用MERGE或TEMPTABLE算法。MySQL优先使用MERGE算法进行TEMPTABLE算法，因为MERGE算法效率更高。</li>\n</ul>\n<h3 id=\"1-2、查看名称\"><a href=\"#1-2、查看名称\" class=\"headerlink\" title=\"1.2、查看名称\"></a>1.2、查看名称</h3><p>在数据库中，视图和表共享相同的命名空间，因此视图和表不能具有相同的名称。 另外，视图的名称必须遵循表的命名规则。</p>\n<h3 id=\"1-3、SELECT语句\"><a href=\"#1-3、SELECT语句\" class=\"headerlink\" title=\"1.3、SELECT语句\"></a>1.3、SELECT语句</h3><p>在SELECT语句中，可以从数据库中存在的任何表或视图查询数据。SELECT语句必须遵循以下几个规则：</p>\n<ul>\n<li>SELECT语句可以在WHERE子句中包含子查询，但FROM子句中的不能包含子查询。</li>\n<li>SELECT语句不能引用任何变量，包括局部变量，用户变量和会话变量。</li>\n<li>SELECT语句不能引用准备语句的参数。</li>\n</ul>"},{"title":"Struts2(1)——基本认识","date":"2017-12-20T02:46:08.000Z","_content":"Struts2就是一个web层框架，并且是使用MVC设计模式实现的的一个框架，之前使用的是Serlvet+JSP来开发web项目，现在用Struts2框架来替代他，那Struts2到底有哪些优点呢？那就需要我们自己来研究它了.\n请求    -----------　　Servlet      --------------  JSP　　　　serlvet+JSP\n\n请求    -----------    Action 　　  --------------  JSP　　　　Struts\n\n<!-- more -->\n\n## 1.工作原理\n\n![struts2][1]\n\n请求在struts2框架中的处理流程大概可以分为以下几步：\n\n 1. 客户端初始化一个指向servlet容器(例如Tomcat)的请求\n 2. 该请求经过一系列的过滤器（Filter）（这些过滤器中有一个叫做ActionContextCleanUp的可选过滤器，这个过滤器对于Struts2和其他框架的集成很有帮助，例如：SiteMesh Plugin）\n 3. 然后FilterDispather(StrutsPrepareAndExecuteFilter)被调用，询问ActionMapper来决定这个请是否需要调用某个Action。\n 4. 如果ActionMapper决定需要调用某个Action，FilterDispatcher把请求的处理交给ActionProxy.\n 5. ActionProxy通过ConfigurationManager询问框架的配置文件，找到需要调用的Action类 ,这里，我们一般是从struts.xml配置中读取。\n 6. ActionProxy创建一个ActionInvocation的实例\n 7. ActionInvocation实例使用命名模式来调用，在调用Action的过程前后，涉及到相关拦截器（Intercepter）的调用。\n 8. 一旦Action执行完毕，ActionInvocation负责根据struts.xml中的配置找到对应的返回结果。返回结果通常是（但不总是，也可能是另外的一个Action链）一个需要被表示的JSP或者FreeMarker的模版。在表示的过程中可以使用Struts2 框架中继承的标签。在这个过程中需要涉及到ActionMapper\n\n**在上述过程中所有的对象（Action，Results，Interceptors等）都是通过ObjectFactory来创建的。**\n \n \n## 2.配置文件\n\n|配置文件的名称|位置|主要内容|说明|\n| -------------|----|--------|----|\n|default.properties|struts2-core-2.3.15.3.jar/org/apache/struts2/default.properties|一些参数配置|程序员不能直接修改的|\n|struts-default.xml|struts2-core-2.3.15.3.jar/struts-default.xml|一些参数配置|程序员不能直接修改的|\n|struts.xml|应用的classpath中|struts的配置文件|程序员使用的|\n|struts.properties|应用的classpath中|struts的参数配置文件|程序员使用的|\n|web.xml|WEB-INF/web.xml|应用的配置文件|给过滤器配置参数|\n\n以上配置文件在应用被启动的时候就完成了加载；而且有加载的顺序要求。<font color=\"red\">后面的配置会覆盖掉前面配置文件中相同的信息。</font>\n\n### 2.1 default.properties\n\n|参数名称|参数的默认值|说明|\n|---|---|---|\n|struts.i18n.encoding|UTF-8|框架使用的默认编码|\n|struts.action.extension|action|进入框架核心的uri的后缀。多个值用逗号分隔|\n|struts.serve.static.browserCache|true|告诉客户端要不要缓存静态的资源|\n|struts.configuration.xml.reload|被注释掉了：建议true|每当xml配置文件被修改后，不需要重新加载应用就能够使配置生效。适合开发阶段|\n|struts.devMode|false|是否是开发模式。开发阶段应该设置为true|\n\n如何修改他们的默认值呢？\nstruts.xml:通过该文件来进行修改\n```XML\n<!--通过constant元素覆盖掉之前配置文件参数的默认值-->\n<constant name=\"struts.devMode\" value=\"true\" />\n```\n\n### 2.2 struts-default.xml\n\n![struts-default.xml][2]\n\n 这个文件定义了action返回结果类型，struts的拦截器，以及一些其他默认配置。\n\n### 2.3 struts.xml\n\n - 作用：希望程序员能够按照分包的思想管理你的动作配置\n - 属性：\n \n    - name:必须要的，给包取一个名字。唯一。\n    - extends：当前包需要继承的父包的名称。框架希望程序员能够用面向对象的方式管理你的包。子包能够继承父包中的所有配置。自己写的包一般情况下要继承一个name=struts-default的包（它在struts-default.xml中）\n    - abstract：把包声明成抽象包。没有任何<action>子元素的package就可以声明为抽象的包。\n    - namespace：名称空间。默认值是\"\"（空字符串）。名称空间+动作名称：构成了动作的访问路径。\n\n### 2.4 struts.properties\n\n这个文件是struts2框架的全局属性文件，也是自动加载的文件。该文件包含了系列的key-value对。该文件完全可以配置在struts.xml文件中，使用constant元素。下面是这个文件中一些常见的配置项及说明。\n\n```xml\n### 指定加载struts2配置文件管理器，默认为org.apache.struts2.config.DefaultConfiguration\n### 开发者可以自定义配置文件管理器，该类要实现Configuration接口，可以自动加载struts2配置文件。\n# struts.configuration=org.apache.struts2.config.DefaultConfiguration\n\n### 设置默认的locale和字符编码\n# struts.locale=en_US\nstruts.i18n.encoding=UTF-8\n\n\n### 指定struts的工厂类\n# struts.objectFactory = spring\n\n### 指定spring框架的装配模式\n### 装配方式有: name, type, auto, and constructor (name 是默认装配模式)\nstruts.objectFactory.spring.autoWire = name\n\n### 该属性指定整合spring时，是否对bean进行缓存，值为true or false,默认为true.\nstruts.objectFactory.spring.useClassCache = true\n\n### 指定类型检查\n#struts.objectTypeDeterminer = tiger\n#struts.objectTypeDeterminer = notiger\n\n### 该属性指定处理 MIME-type multipart/form-data，文件上传\n# struts.multipart.parser=cos\n# struts.multipart.parser=pell\nstruts.multipart.parser=jakarta\n# 指定上传文件时的临时目录，默认使用 javax.servlet.context.tempdir \nstruts.multipart.saveDir=\nstruts.multipart.maxSize=2097152\n\n### 加载自定义属性文件 (不要改写struts.properties!)\n# struts.custom.properties=application,org/apache/struts2/extension/custom\n\n### 指定请求url与action映射器，默认为org.apache.struts2.dispatcher.mapper.DefaultActionMapper\n#struts.mapper.class=org.apache.struts2.dispatcher.mapper.DefaultActionMapper\n\n### 指定action的后缀，默认为action\nstruts.action.extension=action\n\n### 被 FilterDispatcher使用\n### 如果为 true 则通过jar文件提供静态内容服务. \n### 如果为 false 则静态内容必须位于 <context_path>/struts\nstruts.serve.static=true\n\n### 被 FilterDispatcher使用\n### 指定浏览器是否缓存静态内容，测试阶段设置为false，发布阶段设置为true.\nstruts.serve.static.browserCache=true\n\n### 设置是否支持动态方法调用，true为支持，false不支持.\nstruts.enable.DynamicMethodInvocation = true\n\n### 设置是否可以在action中使用斜线，默认为false不可以，想使用需设置为true.\nstruts.enable.SlashesInActionNames = false\n\n### 是否允许使用表达式语法，默认为true.\nstruts.tag.altSyntax=true\n\n\n### 设置当struts.xml文件改动时，是否重新加载.\n### - struts.configuration.xml.reload = true\n### 设置struts是否为开发模式，默认为false,测试阶段一般设为true.\nstruts.devMode = false\n\n### 设置是否每次请求，都重新加载资源文件，默认值为false.\nstruts.i18n.reload=false\n\n###标准的UI主题\n### 默认的UI主题为xhtml,可以为simple,xhtml或ajax\nstruts.ui.theme=xhtml\n###模板目录\nstruts.ui.templateDir=template\n#设置模板类型. 可以为 ftl, vm, or jsp\nstruts.ui.templateSuffix=ftl\n\n###定位velocity.properties 文件.  默认 velocity.properties\nstruts.velocity.configfile = velocity.properties\n\n### 设置velocity的context.\nstruts.velocity.contexts =\n\n### 定位toolbox.\nstruts.velocity.toolboxlocation=\n\n### 指定web应用的端口.\nstruts.url.http.port = 80\n### 指定加密端口\nstruts.url.https.port = 443\n### 设置生成url时，是否包含参数.值可以为: none, get or all\nstruts.url.includeParams = get\n\n### 设置要加载的国际化资源文件，以逗号分隔.\n# struts.custom.i18n.resources=testmessages,testmessages2\n\n### 对于一些web应用服务器不能处理HttpServletRequest.getParameterMap()\n### 像 WebLogic, Orion, and OC4J等，须设置成true,默认为false.\nstruts.dispatcher.parametersWorkaround = false\n\n### 指定freemarker管理器\n#struts.freemarker.manager.classname=org.apache.struts2.views.freemarker.FreemarkerManager\n\n### 设置是否对freemarker的模板设置缓存\n### 效果相当于把template拷贝到 WEB_APP/templates.\nstruts.freemarker.templatesCache=false\n\n### 通常不需要修改此属性.\nstruts.freemarker.wrapper.altMap=true\n\n### 指定xslt result是否使用样式表缓存.开发阶段设为true,发布阶段设为false.\nstruts.xslt.nocache=false\n\n### 设置struts自动加载的文件列表.\nstruts.configuration.files=struts-default.xml,struts-plugin.xml,struts.xml\n\n### 设定是否一直在最后一个slash之前的任何位置选定namespace.\nstruts.mapper.alwaysSelectFullNamespace=false\n```\n\n### 2.5 web.xml\n\n配置struts2的核心过滤器和spring的加载器。\n这里针对struts2相关配置作介绍。\n\n```xml\n<!-- Struts2核心过滤器 -->\n<filter>\n\t<filter-name>struts2</filter-name>\n\t<filter-class>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter</filter-class>\n\t<!-- 指定action所在包路径 -->\n\t<init-param>  \n       \t<param-name>actionPackages</param-name>  \n       \t<param-value>com.topvision</param-value>  \n   \t</init-param>\n   \t<!-- 指定struts.xml文件路径，默认classpath下 -->\n   \t<init-param>\n   \t\t<param-name>filterConfig</param-name>\n   \t\t<param-value>classpath:struts.xml</param-value>\n   \t</init-param>\n</filter>\n<!-- 设置url过滤 -->\n<filter-mapping>\n\t<filter-name>struts2</filter-name>\n\t<url-pattern>/*</url-pattern>\n</filter-mapping>\n\n<!-- 编码 -->\n<filter>\n\t<filter-name>encodingFilter</filter-name>\n\t<filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>\n\t<init-param>\n\t\t<param-name>encoding</param-name>\n\t\t<param-value>UTF-8</param-value>\n\t</init-param>\n</filter>\n<filter-mapping>\n\t<filter-name>encodingFilter</filter-name>\n\t<url-pattern>/*</url-pattern>\n</filter-mapping>\n<!-- 404错误跳转 -->\n<error-page>\n\t<error-code>404</error-code>\n\t<location>/error.jsp?code=404</location>\n</error-page>\n<!-- 首页设置 -->\n<welcome-file-list>\n\t<welcome-file>index.html</welcome-file>\n\t<welcome-file>index.htm</welcome-file>\n\t<welcome-file>index.jsp</welcome-file>\n\t<welcome-file>default.html</welcome-file>\n\t<welcome-file>default.htm</welcome-file>\n\t<welcome-file>default.jsp</welcome-file>\n</welcome-file-list>\n```\n\n\n    \n\n\n\n \n \n \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts2.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts-default.xml.png","source":"_posts/Struts2-1-——基本认识.md","raw":"---\ntitle: Struts2(1)——基本认识\ncategories:\n  - Struts2\ntags:\n  - Struts2\ndate: 2017-12-20 10:46:08\n---\nStruts2就是一个web层框架，并且是使用MVC设计模式实现的的一个框架，之前使用的是Serlvet+JSP来开发web项目，现在用Struts2框架来替代他，那Struts2到底有哪些优点呢？那就需要我们自己来研究它了.\n请求    -----------　　Servlet      --------------  JSP　　　　serlvet+JSP\n\n请求    -----------    Action 　　  --------------  JSP　　　　Struts\n\n<!-- more -->\n\n## 1.工作原理\n\n![struts2][1]\n\n请求在struts2框架中的处理流程大概可以分为以下几步：\n\n 1. 客户端初始化一个指向servlet容器(例如Tomcat)的请求\n 2. 该请求经过一系列的过滤器（Filter）（这些过滤器中有一个叫做ActionContextCleanUp的可选过滤器，这个过滤器对于Struts2和其他框架的集成很有帮助，例如：SiteMesh Plugin）\n 3. 然后FilterDispather(StrutsPrepareAndExecuteFilter)被调用，询问ActionMapper来决定这个请是否需要调用某个Action。\n 4. 如果ActionMapper决定需要调用某个Action，FilterDispatcher把请求的处理交给ActionProxy.\n 5. ActionProxy通过ConfigurationManager询问框架的配置文件，找到需要调用的Action类 ,这里，我们一般是从struts.xml配置中读取。\n 6. ActionProxy创建一个ActionInvocation的实例\n 7. ActionInvocation实例使用命名模式来调用，在调用Action的过程前后，涉及到相关拦截器（Intercepter）的调用。\n 8. 一旦Action执行完毕，ActionInvocation负责根据struts.xml中的配置找到对应的返回结果。返回结果通常是（但不总是，也可能是另外的一个Action链）一个需要被表示的JSP或者FreeMarker的模版。在表示的过程中可以使用Struts2 框架中继承的标签。在这个过程中需要涉及到ActionMapper\n\n**在上述过程中所有的对象（Action，Results，Interceptors等）都是通过ObjectFactory来创建的。**\n \n \n## 2.配置文件\n\n|配置文件的名称|位置|主要内容|说明|\n| -------------|----|--------|----|\n|default.properties|struts2-core-2.3.15.3.jar/org/apache/struts2/default.properties|一些参数配置|程序员不能直接修改的|\n|struts-default.xml|struts2-core-2.3.15.3.jar/struts-default.xml|一些参数配置|程序员不能直接修改的|\n|struts.xml|应用的classpath中|struts的配置文件|程序员使用的|\n|struts.properties|应用的classpath中|struts的参数配置文件|程序员使用的|\n|web.xml|WEB-INF/web.xml|应用的配置文件|给过滤器配置参数|\n\n以上配置文件在应用被启动的时候就完成了加载；而且有加载的顺序要求。<font color=\"red\">后面的配置会覆盖掉前面配置文件中相同的信息。</font>\n\n### 2.1 default.properties\n\n|参数名称|参数的默认值|说明|\n|---|---|---|\n|struts.i18n.encoding|UTF-8|框架使用的默认编码|\n|struts.action.extension|action|进入框架核心的uri的后缀。多个值用逗号分隔|\n|struts.serve.static.browserCache|true|告诉客户端要不要缓存静态的资源|\n|struts.configuration.xml.reload|被注释掉了：建议true|每当xml配置文件被修改后，不需要重新加载应用就能够使配置生效。适合开发阶段|\n|struts.devMode|false|是否是开发模式。开发阶段应该设置为true|\n\n如何修改他们的默认值呢？\nstruts.xml:通过该文件来进行修改\n```XML\n<!--通过constant元素覆盖掉之前配置文件参数的默认值-->\n<constant name=\"struts.devMode\" value=\"true\" />\n```\n\n### 2.2 struts-default.xml\n\n![struts-default.xml][2]\n\n 这个文件定义了action返回结果类型，struts的拦截器，以及一些其他默认配置。\n\n### 2.3 struts.xml\n\n - 作用：希望程序员能够按照分包的思想管理你的动作配置\n - 属性：\n \n    - name:必须要的，给包取一个名字。唯一。\n    - extends：当前包需要继承的父包的名称。框架希望程序员能够用面向对象的方式管理你的包。子包能够继承父包中的所有配置。自己写的包一般情况下要继承一个name=struts-default的包（它在struts-default.xml中）\n    - abstract：把包声明成抽象包。没有任何<action>子元素的package就可以声明为抽象的包。\n    - namespace：名称空间。默认值是\"\"（空字符串）。名称空间+动作名称：构成了动作的访问路径。\n\n### 2.4 struts.properties\n\n这个文件是struts2框架的全局属性文件，也是自动加载的文件。该文件包含了系列的key-value对。该文件完全可以配置在struts.xml文件中，使用constant元素。下面是这个文件中一些常见的配置项及说明。\n\n```xml\n### 指定加载struts2配置文件管理器，默认为org.apache.struts2.config.DefaultConfiguration\n### 开发者可以自定义配置文件管理器，该类要实现Configuration接口，可以自动加载struts2配置文件。\n# struts.configuration=org.apache.struts2.config.DefaultConfiguration\n\n### 设置默认的locale和字符编码\n# struts.locale=en_US\nstruts.i18n.encoding=UTF-8\n\n\n### 指定struts的工厂类\n# struts.objectFactory = spring\n\n### 指定spring框架的装配模式\n### 装配方式有: name, type, auto, and constructor (name 是默认装配模式)\nstruts.objectFactory.spring.autoWire = name\n\n### 该属性指定整合spring时，是否对bean进行缓存，值为true or false,默认为true.\nstruts.objectFactory.spring.useClassCache = true\n\n### 指定类型检查\n#struts.objectTypeDeterminer = tiger\n#struts.objectTypeDeterminer = notiger\n\n### 该属性指定处理 MIME-type multipart/form-data，文件上传\n# struts.multipart.parser=cos\n# struts.multipart.parser=pell\nstruts.multipart.parser=jakarta\n# 指定上传文件时的临时目录，默认使用 javax.servlet.context.tempdir \nstruts.multipart.saveDir=\nstruts.multipart.maxSize=2097152\n\n### 加载自定义属性文件 (不要改写struts.properties!)\n# struts.custom.properties=application,org/apache/struts2/extension/custom\n\n### 指定请求url与action映射器，默认为org.apache.struts2.dispatcher.mapper.DefaultActionMapper\n#struts.mapper.class=org.apache.struts2.dispatcher.mapper.DefaultActionMapper\n\n### 指定action的后缀，默认为action\nstruts.action.extension=action\n\n### 被 FilterDispatcher使用\n### 如果为 true 则通过jar文件提供静态内容服务. \n### 如果为 false 则静态内容必须位于 <context_path>/struts\nstruts.serve.static=true\n\n### 被 FilterDispatcher使用\n### 指定浏览器是否缓存静态内容，测试阶段设置为false，发布阶段设置为true.\nstruts.serve.static.browserCache=true\n\n### 设置是否支持动态方法调用，true为支持，false不支持.\nstruts.enable.DynamicMethodInvocation = true\n\n### 设置是否可以在action中使用斜线，默认为false不可以，想使用需设置为true.\nstruts.enable.SlashesInActionNames = false\n\n### 是否允许使用表达式语法，默认为true.\nstruts.tag.altSyntax=true\n\n\n### 设置当struts.xml文件改动时，是否重新加载.\n### - struts.configuration.xml.reload = true\n### 设置struts是否为开发模式，默认为false,测试阶段一般设为true.\nstruts.devMode = false\n\n### 设置是否每次请求，都重新加载资源文件，默认值为false.\nstruts.i18n.reload=false\n\n###标准的UI主题\n### 默认的UI主题为xhtml,可以为simple,xhtml或ajax\nstruts.ui.theme=xhtml\n###模板目录\nstruts.ui.templateDir=template\n#设置模板类型. 可以为 ftl, vm, or jsp\nstruts.ui.templateSuffix=ftl\n\n###定位velocity.properties 文件.  默认 velocity.properties\nstruts.velocity.configfile = velocity.properties\n\n### 设置velocity的context.\nstruts.velocity.contexts =\n\n### 定位toolbox.\nstruts.velocity.toolboxlocation=\n\n### 指定web应用的端口.\nstruts.url.http.port = 80\n### 指定加密端口\nstruts.url.https.port = 443\n### 设置生成url时，是否包含参数.值可以为: none, get or all\nstruts.url.includeParams = get\n\n### 设置要加载的国际化资源文件，以逗号分隔.\n# struts.custom.i18n.resources=testmessages,testmessages2\n\n### 对于一些web应用服务器不能处理HttpServletRequest.getParameterMap()\n### 像 WebLogic, Orion, and OC4J等，须设置成true,默认为false.\nstruts.dispatcher.parametersWorkaround = false\n\n### 指定freemarker管理器\n#struts.freemarker.manager.classname=org.apache.struts2.views.freemarker.FreemarkerManager\n\n### 设置是否对freemarker的模板设置缓存\n### 效果相当于把template拷贝到 WEB_APP/templates.\nstruts.freemarker.templatesCache=false\n\n### 通常不需要修改此属性.\nstruts.freemarker.wrapper.altMap=true\n\n### 指定xslt result是否使用样式表缓存.开发阶段设为true,发布阶段设为false.\nstruts.xslt.nocache=false\n\n### 设置struts自动加载的文件列表.\nstruts.configuration.files=struts-default.xml,struts-plugin.xml,struts.xml\n\n### 设定是否一直在最后一个slash之前的任何位置选定namespace.\nstruts.mapper.alwaysSelectFullNamespace=false\n```\n\n### 2.5 web.xml\n\n配置struts2的核心过滤器和spring的加载器。\n这里针对struts2相关配置作介绍。\n\n```xml\n<!-- Struts2核心过滤器 -->\n<filter>\n\t<filter-name>struts2</filter-name>\n\t<filter-class>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter</filter-class>\n\t<!-- 指定action所在包路径 -->\n\t<init-param>  \n       \t<param-name>actionPackages</param-name>  \n       \t<param-value>com.topvision</param-value>  \n   \t</init-param>\n   \t<!-- 指定struts.xml文件路径，默认classpath下 -->\n   \t<init-param>\n   \t\t<param-name>filterConfig</param-name>\n   \t\t<param-value>classpath:struts.xml</param-value>\n   \t</init-param>\n</filter>\n<!-- 设置url过滤 -->\n<filter-mapping>\n\t<filter-name>struts2</filter-name>\n\t<url-pattern>/*</url-pattern>\n</filter-mapping>\n\n<!-- 编码 -->\n<filter>\n\t<filter-name>encodingFilter</filter-name>\n\t<filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>\n\t<init-param>\n\t\t<param-name>encoding</param-name>\n\t\t<param-value>UTF-8</param-value>\n\t</init-param>\n</filter>\n<filter-mapping>\n\t<filter-name>encodingFilter</filter-name>\n\t<url-pattern>/*</url-pattern>\n</filter-mapping>\n<!-- 404错误跳转 -->\n<error-page>\n\t<error-code>404</error-code>\n\t<location>/error.jsp?code=404</location>\n</error-page>\n<!-- 首页设置 -->\n<welcome-file-list>\n\t<welcome-file>index.html</welcome-file>\n\t<welcome-file>index.htm</welcome-file>\n\t<welcome-file>index.jsp</welcome-file>\n\t<welcome-file>default.html</welcome-file>\n\t<welcome-file>default.htm</welcome-file>\n\t<welcome-file>default.jsp</welcome-file>\n</welcome-file-list>\n```\n\n\n    \n\n\n\n \n \n \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts2.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts-default.xml.png","slug":"Struts2-1-——基本认识","published":1,"updated":"2018-02-27T07:38:38.092Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfui002rhwvf10t5nurf","content":"<p>Struts2就是一个web层框架，并且是使用MVC设计模式实现的的一个框架，之前使用的是Serlvet+JSP来开发web项目，现在用Struts2框架来替代他，那Struts2到底有哪些优点呢？那就需要我们自己来研究它了.<br>请求    ———–　　Servlet      ————–  JSP　　　　serlvet+JSP</p>\n<p>请求    ———–    Action 　　  ————–  JSP　　　　Struts</p>\n<a id=\"more\"></a>\n<h2 id=\"1-工作原理\"><a href=\"#1-工作原理\" class=\"headerlink\" title=\"1.工作原理\"></a>1.工作原理</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts2.png\" alt=\"struts2\"></p>\n<p>请求在struts2框架中的处理流程大概可以分为以下几步：</p>\n<ol>\n<li>客户端初始化一个指向servlet容器(例如Tomcat)的请求</li>\n<li>该请求经过一系列的过滤器（Filter）（这些过滤器中有一个叫做ActionContextCleanUp的可选过滤器，这个过滤器对于Struts2和其他框架的集成很有帮助，例如：SiteMesh Plugin）</li>\n<li>然后FilterDispather(StrutsPrepareAndExecuteFilter)被调用，询问ActionMapper来决定这个请是否需要调用某个Action。</li>\n<li>如果ActionMapper决定需要调用某个Action，FilterDispatcher把请求的处理交给ActionProxy.</li>\n<li>ActionProxy通过ConfigurationManager询问框架的配置文件，找到需要调用的Action类 ,这里，我们一般是从struts.xml配置中读取。</li>\n<li>ActionProxy创建一个ActionInvocation的实例</li>\n<li>ActionInvocation实例使用命名模式来调用，在调用Action的过程前后，涉及到相关拦截器（Intercepter）的调用。</li>\n<li>一旦Action执行完毕，ActionInvocation负责根据struts.xml中的配置找到对应的返回结果。返回结果通常是（但不总是，也可能是另外的一个Action链）一个需要被表示的JSP或者FreeMarker的模版。在表示的过程中可以使用Struts2 框架中继承的标签。在这个过程中需要涉及到ActionMapper</li>\n</ol>\n<p><strong>在上述过程中所有的对象（Action，Results，Interceptors等）都是通过ObjectFactory来创建的。</strong></p>\n<h2 id=\"2-配置文件\"><a href=\"#2-配置文件\" class=\"headerlink\" title=\"2.配置文件\"></a>2.配置文件</h2><table>\n<thead>\n<tr>\n<th>配置文件的名称</th>\n<th>位置</th>\n<th>主要内容</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>default.properties</td>\n<td>struts2-core-2.3.15.3.jar/org/apache/struts2/default.properties</td>\n<td>一些参数配置</td>\n<td>程序员不能直接修改的</td>\n</tr>\n<tr>\n<td>struts-default.xml</td>\n<td>struts2-core-2.3.15.3.jar/struts-default.xml</td>\n<td>一些参数配置</td>\n<td>程序员不能直接修改的</td>\n</tr>\n<tr>\n<td>struts.xml</td>\n<td>应用的classpath中</td>\n<td>struts的配置文件</td>\n<td>程序员使用的</td>\n</tr>\n<tr>\n<td>struts.properties</td>\n<td>应用的classpath中</td>\n<td>struts的参数配置文件</td>\n<td>程序员使用的</td>\n</tr>\n<tr>\n<td>web.xml</td>\n<td>WEB-INF/web.xml</td>\n<td>应用的配置文件</td>\n<td>给过滤器配置参数</td>\n</tr>\n</tbody>\n</table>\n<p>以上配置文件在应用被启动的时候就完成了加载；而且有加载的顺序要求。<font color=\"red\">后面的配置会覆盖掉前面配置文件中相同的信息。</font></p>\n<h3 id=\"2-1-default-properties\"><a href=\"#2-1-default-properties\" class=\"headerlink\" title=\"2.1 default.properties\"></a>2.1 default.properties</h3><table>\n<thead>\n<tr>\n<th>参数名称</th>\n<th>参数的默认值</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>struts.i18n.encoding</td>\n<td>UTF-8</td>\n<td>框架使用的默认编码</td>\n</tr>\n<tr>\n<td>struts.action.extension</td>\n<td>action</td>\n<td>进入框架核心的uri的后缀。多个值用逗号分隔</td>\n</tr>\n<tr>\n<td>struts.serve.static.browserCache</td>\n<td>true</td>\n<td>告诉客户端要不要缓存静态的资源</td>\n</tr>\n<tr>\n<td>struts.configuration.xml.reload</td>\n<td>被注释掉了：建议true</td>\n<td>每当xml配置文件被修改后，不需要重新加载应用就能够使配置生效。适合开发阶段</td>\n</tr>\n<tr>\n<td>struts.devMode</td>\n<td>false</td>\n<td>是否是开发模式。开发阶段应该设置为true</td>\n</tr>\n</tbody>\n</table>\n<p>如何修改他们的默认值呢？<br>struts.xml:通过该文件来进行修改<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--通过constant元素覆盖掉之前配置文件参数的默认值--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.devMode\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div></pre></td></tr></table></figure></p>\n<h3 id=\"2-2-struts-default-xml\"><a href=\"#2-2-struts-default-xml\" class=\"headerlink\" title=\"2.2 struts-default.xml\"></a>2.2 struts-default.xml</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts-default.xml.png\" alt=\"struts-default.xml\"></p>\n<p> 这个文件定义了action返回结果类型，struts的拦截器，以及一些其他默认配置。</p>\n<h3 id=\"2-3-struts-xml\"><a href=\"#2-3-struts-xml\" class=\"headerlink\" title=\"2.3 struts.xml\"></a>2.3 struts.xml</h3><ul>\n<li>作用：希望程序员能够按照分包的思想管理你的动作配置</li>\n<li><p>属性：</p>\n<ul>\n<li>name:必须要的，给包取一个名字。唯一。</li>\n<li>extends：当前包需要继承的父包的名称。框架希望程序员能够用面向对象的方式管理你的包。子包能够继承父包中的所有配置。自己写的包一般情况下要继承一个name=struts-default的包（它在struts-default.xml中）</li>\n<li>abstract：把包声明成抽象包。没有任何<action>子元素的package就可以声明为抽象的包。</action></li>\n<li>namespace：名称空间。默认值是””（空字符串）。名称空间+动作名称：构成了动作的访问路径。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2-4-struts-properties\"><a href=\"#2-4-struts-properties\" class=\"headerlink\" title=\"2.4 struts.properties\"></a>2.4 struts.properties</h3><p>这个文件是struts2框架的全局属性文件，也是自动加载的文件。该文件包含了系列的key-value对。该文件完全可以配置在struts.xml文件中，使用constant元素。下面是这个文件中一些常见的配置项及说明。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div></pre></td><td class=\"code\"><pre><div class=\"line\">### 指定加载struts2配置文件管理器，默认为org.apache.struts2.config.DefaultConfiguration</div><div class=\"line\">### 开发者可以自定义配置文件管理器，该类要实现Configuration接口，可以自动加载struts2配置文件。</div><div class=\"line\"># struts.configuration=org.apache.struts2.config.DefaultConfiguration</div><div class=\"line\"></div><div class=\"line\">### 设置默认的locale和字符编码</div><div class=\"line\"># struts.locale=en_US</div><div class=\"line\">struts.i18n.encoding=UTF-8</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">### 指定struts的工厂类</div><div class=\"line\"># struts.objectFactory = spring</div><div class=\"line\"></div><div class=\"line\">### 指定spring框架的装配模式</div><div class=\"line\">### 装配方式有: name, type, auto, and constructor (name 是默认装配模式)</div><div class=\"line\">struts.objectFactory.spring.autoWire = name</div><div class=\"line\"></div><div class=\"line\">### 该属性指定整合spring时，是否对bean进行缓存，值为true or false,默认为true.</div><div class=\"line\">struts.objectFactory.spring.useClassCache = true</div><div class=\"line\"></div><div class=\"line\">### 指定类型检查</div><div class=\"line\">#struts.objectTypeDeterminer = tiger</div><div class=\"line\">#struts.objectTypeDeterminer = notiger</div><div class=\"line\"></div><div class=\"line\">### 该属性指定处理 MIME-type multipart/form-data，文件上传</div><div class=\"line\"># struts.multipart.parser=cos</div><div class=\"line\"># struts.multipart.parser=pell</div><div class=\"line\">struts.multipart.parser=jakarta</div><div class=\"line\"># 指定上传文件时的临时目录，默认使用 javax.servlet.context.tempdir </div><div class=\"line\">struts.multipart.saveDir=</div><div class=\"line\">struts.multipart.maxSize=2097152</div><div class=\"line\"></div><div class=\"line\">### 加载自定义属性文件 (不要改写struts.properties!)</div><div class=\"line\"># struts.custom.properties=application,org/apache/struts2/extension/custom</div><div class=\"line\"></div><div class=\"line\">### 指定请求url与action映射器，默认为org.apache.struts2.dispatcher.mapper.DefaultActionMapper</div><div class=\"line\">#struts.mapper.class=org.apache.struts2.dispatcher.mapper.DefaultActionMapper</div><div class=\"line\"></div><div class=\"line\">### 指定action的后缀，默认为action</div><div class=\"line\">struts.action.extension=action</div><div class=\"line\"></div><div class=\"line\">### 被 FilterDispatcher使用</div><div class=\"line\">### 如果为 true 则通过jar文件提供静态内容服务. </div><div class=\"line\">### 如果为 false 则静态内容必须位于 <span class=\"tag\">&lt;<span class=\"name\">context_path</span>&gt;</span>/struts</div><div class=\"line\">struts.serve.static=true</div><div class=\"line\"></div><div class=\"line\">### 被 FilterDispatcher使用</div><div class=\"line\">### 指定浏览器是否缓存静态内容，测试阶段设置为false，发布阶段设置为true.</div><div class=\"line\">struts.serve.static.browserCache=true</div><div class=\"line\"></div><div class=\"line\">### 设置是否支持动态方法调用，true为支持，false不支持.</div><div class=\"line\">struts.enable.DynamicMethodInvocation = true</div><div class=\"line\"></div><div class=\"line\">### 设置是否可以在action中使用斜线，默认为false不可以，想使用需设置为true.</div><div class=\"line\">struts.enable.SlashesInActionNames = false</div><div class=\"line\"></div><div class=\"line\">### 是否允许使用表达式语法，默认为true.</div><div class=\"line\">struts.tag.altSyntax=true</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">### 设置当struts.xml文件改动时，是否重新加载.</div><div class=\"line\">### - struts.configuration.xml.reload = true</div><div class=\"line\">### 设置struts是否为开发模式，默认为false,测试阶段一般设为true.</div><div class=\"line\">struts.devMode = false</div><div class=\"line\"></div><div class=\"line\">### 设置是否每次请求，都重新加载资源文件，默认值为false.</div><div class=\"line\">struts.i18n.reload=false</div><div class=\"line\"></div><div class=\"line\">###标准的UI主题</div><div class=\"line\">### 默认的UI主题为xhtml,可以为simple,xhtml或ajax</div><div class=\"line\">struts.ui.theme=xhtml</div><div class=\"line\">###模板目录</div><div class=\"line\">struts.ui.templateDir=template</div><div class=\"line\">#设置模板类型. 可以为 ftl, vm, or jsp</div><div class=\"line\">struts.ui.templateSuffix=ftl</div><div class=\"line\"></div><div class=\"line\">###定位velocity.properties 文件.  默认 velocity.properties</div><div class=\"line\">struts.velocity.configfile = velocity.properties</div><div class=\"line\"></div><div class=\"line\">### 设置velocity的context.</div><div class=\"line\">struts.velocity.contexts =</div><div class=\"line\"></div><div class=\"line\">### 定位toolbox.</div><div class=\"line\">struts.velocity.toolboxlocation=</div><div class=\"line\"></div><div class=\"line\">### 指定web应用的端口.</div><div class=\"line\">struts.url.http.port = 80</div><div class=\"line\">### 指定加密端口</div><div class=\"line\">struts.url.https.port = 443</div><div class=\"line\">### 设置生成url时，是否包含参数.值可以为: none, get or all</div><div class=\"line\">struts.url.includeParams = get</div><div class=\"line\"></div><div class=\"line\">### 设置要加载的国际化资源文件，以逗号分隔.</div><div class=\"line\"># struts.custom.i18n.resources=testmessages,testmessages2</div><div class=\"line\"></div><div class=\"line\">### 对于一些web应用服务器不能处理HttpServletRequest.getParameterMap()</div><div class=\"line\">### 像 WebLogic, Orion, and OC4J等，须设置成true,默认为false.</div><div class=\"line\">struts.dispatcher.parametersWorkaround = false</div><div class=\"line\"></div><div class=\"line\">### 指定freemarker管理器</div><div class=\"line\">#struts.freemarker.manager.classname=org.apache.struts2.views.freemarker.FreemarkerManager</div><div class=\"line\"></div><div class=\"line\">### 设置是否对freemarker的模板设置缓存</div><div class=\"line\">### 效果相当于把template拷贝到 WEB_APP/templates.</div><div class=\"line\">struts.freemarker.templatesCache=false</div><div class=\"line\"></div><div class=\"line\">### 通常不需要修改此属性.</div><div class=\"line\">struts.freemarker.wrapper.altMap=true</div><div class=\"line\"></div><div class=\"line\">### 指定xslt result是否使用样式表缓存.开发阶段设为true,发布阶段设为false.</div><div class=\"line\">struts.xslt.nocache=false</div><div class=\"line\"></div><div class=\"line\">### 设置struts自动加载的文件列表.</div><div class=\"line\">struts.configuration.files=struts-default.xml,struts-plugin.xml,struts.xml</div><div class=\"line\"></div><div class=\"line\">### 设定是否一直在最后一个slash之前的任何位置选定namespace.</div><div class=\"line\">struts.mapper.alwaysSelectFullNamespace=false</div></pre></td></tr></table></figure>\n<h3 id=\"2-5-web-xml\"><a href=\"#2-5-web-xml\" class=\"headerlink\" title=\"2.5 web.xml\"></a>2.5 web.xml</h3><p>配置struts2的核心过滤器和spring的加载器。<br>这里针对struts2相关配置作介绍。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- Struts2核心过滤器 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>struts2<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 指定action所在包路径 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span>  </div><div class=\"line\">       \t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>actionPackages<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span>  </div><div class=\"line\">       \t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>com.topvision<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span>  </div><div class=\"line\">   \t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">   \t<span class=\"comment\">&lt;!-- 指定struts.xml文件路径，默认classpath下 --&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">   \t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>filterConfig<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">   \t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:struts.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 设置url过滤 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>struts2<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">&lt;!-- 编码 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>encodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>encoding<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>encodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 404错误跳转 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">error-page</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">error-code</span>&gt;</span>404<span class=\"tag\">&lt;/<span class=\"name\">error-code</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">location</span>&gt;</span>/error.jsp?code=404<span class=\"tag\">&lt;/<span class=\"name\">location</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">error-page</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 首页设置 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">welcome-file-list</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.html<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.htm<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.jsp<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.html<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.htm<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.jsp<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">welcome-file-list</span>&gt;</span></div></pre></td></tr></table></figure>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>Struts2就是一个web层框架，并且是使用MVC设计模式实现的的一个框架，之前使用的是Serlvet+JSP来开发web项目，现在用Struts2框架来替代他，那Struts2到底有哪些优点呢？那就需要我们自己来研究它了.<br>请求    ———–　　Servlet      ————–  JSP　　　　serlvet+JSP</p>\n<p>请求    ———–    Action 　　  ————–  JSP　　　　Struts</p>","more":"<h2 id=\"1-工作原理\"><a href=\"#1-工作原理\" class=\"headerlink\" title=\"1.工作原理\"></a>1.工作原理</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts2.png\" alt=\"struts2\"></p>\n<p>请求在struts2框架中的处理流程大概可以分为以下几步：</p>\n<ol>\n<li>客户端初始化一个指向servlet容器(例如Tomcat)的请求</li>\n<li>该请求经过一系列的过滤器（Filter）（这些过滤器中有一个叫做ActionContextCleanUp的可选过滤器，这个过滤器对于Struts2和其他框架的集成很有帮助，例如：SiteMesh Plugin）</li>\n<li>然后FilterDispather(StrutsPrepareAndExecuteFilter)被调用，询问ActionMapper来决定这个请是否需要调用某个Action。</li>\n<li>如果ActionMapper决定需要调用某个Action，FilterDispatcher把请求的处理交给ActionProxy.</li>\n<li>ActionProxy通过ConfigurationManager询问框架的配置文件，找到需要调用的Action类 ,这里，我们一般是从struts.xml配置中读取。</li>\n<li>ActionProxy创建一个ActionInvocation的实例</li>\n<li>ActionInvocation实例使用命名模式来调用，在调用Action的过程前后，涉及到相关拦截器（Intercepter）的调用。</li>\n<li>一旦Action执行完毕，ActionInvocation负责根据struts.xml中的配置找到对应的返回结果。返回结果通常是（但不总是，也可能是另外的一个Action链）一个需要被表示的JSP或者FreeMarker的模版。在表示的过程中可以使用Struts2 框架中继承的标签。在这个过程中需要涉及到ActionMapper</li>\n</ol>\n<p><strong>在上述过程中所有的对象（Action，Results，Interceptors等）都是通过ObjectFactory来创建的。</strong></p>\n<h2 id=\"2-配置文件\"><a href=\"#2-配置文件\" class=\"headerlink\" title=\"2.配置文件\"></a>2.配置文件</h2><table>\n<thead>\n<tr>\n<th>配置文件的名称</th>\n<th>位置</th>\n<th>主要内容</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>default.properties</td>\n<td>struts2-core-2.3.15.3.jar/org/apache/struts2/default.properties</td>\n<td>一些参数配置</td>\n<td>程序员不能直接修改的</td>\n</tr>\n<tr>\n<td>struts-default.xml</td>\n<td>struts2-core-2.3.15.3.jar/struts-default.xml</td>\n<td>一些参数配置</td>\n<td>程序员不能直接修改的</td>\n</tr>\n<tr>\n<td>struts.xml</td>\n<td>应用的classpath中</td>\n<td>struts的配置文件</td>\n<td>程序员使用的</td>\n</tr>\n<tr>\n<td>struts.properties</td>\n<td>应用的classpath中</td>\n<td>struts的参数配置文件</td>\n<td>程序员使用的</td>\n</tr>\n<tr>\n<td>web.xml</td>\n<td>WEB-INF/web.xml</td>\n<td>应用的配置文件</td>\n<td>给过滤器配置参数</td>\n</tr>\n</tbody>\n</table>\n<p>以上配置文件在应用被启动的时候就完成了加载；而且有加载的顺序要求。<font color=\"red\">后面的配置会覆盖掉前面配置文件中相同的信息。</font></p>\n<h3 id=\"2-1-default-properties\"><a href=\"#2-1-default-properties\" class=\"headerlink\" title=\"2.1 default.properties\"></a>2.1 default.properties</h3><table>\n<thead>\n<tr>\n<th>参数名称</th>\n<th>参数的默认值</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>struts.i18n.encoding</td>\n<td>UTF-8</td>\n<td>框架使用的默认编码</td>\n</tr>\n<tr>\n<td>struts.action.extension</td>\n<td>action</td>\n<td>进入框架核心的uri的后缀。多个值用逗号分隔</td>\n</tr>\n<tr>\n<td>struts.serve.static.browserCache</td>\n<td>true</td>\n<td>告诉客户端要不要缓存静态的资源</td>\n</tr>\n<tr>\n<td>struts.configuration.xml.reload</td>\n<td>被注释掉了：建议true</td>\n<td>每当xml配置文件被修改后，不需要重新加载应用就能够使配置生效。适合开发阶段</td>\n</tr>\n<tr>\n<td>struts.devMode</td>\n<td>false</td>\n<td>是否是开发模式。开发阶段应该设置为true</td>\n</tr>\n</tbody>\n</table>\n<p>如何修改他们的默认值呢？<br>struts.xml:通过该文件来进行修改<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--通过constant元素覆盖掉之前配置文件参数的默认值--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.devMode\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div></pre></td></tr></table></figure></p>\n<h3 id=\"2-2-struts-default-xml\"><a href=\"#2-2-struts-default-xml\" class=\"headerlink\" title=\"2.2 struts-default.xml\"></a>2.2 struts-default.xml</h3><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts-default.xml.png\" alt=\"struts-default.xml\"></p>\n<p> 这个文件定义了action返回结果类型，struts的拦截器，以及一些其他默认配置。</p>\n<h3 id=\"2-3-struts-xml\"><a href=\"#2-3-struts-xml\" class=\"headerlink\" title=\"2.3 struts.xml\"></a>2.3 struts.xml</h3><ul>\n<li>作用：希望程序员能够按照分包的思想管理你的动作配置</li>\n<li><p>属性：</p>\n<ul>\n<li>name:必须要的，给包取一个名字。唯一。</li>\n<li>extends：当前包需要继承的父包的名称。框架希望程序员能够用面向对象的方式管理你的包。子包能够继承父包中的所有配置。自己写的包一般情况下要继承一个name=struts-default的包（它在struts-default.xml中）</li>\n<li>abstract：把包声明成抽象包。没有任何<action>子元素的package就可以声明为抽象的包。</action></li>\n<li>namespace：名称空间。默认值是””（空字符串）。名称空间+动作名称：构成了动作的访问路径。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2-4-struts-properties\"><a href=\"#2-4-struts-properties\" class=\"headerlink\" title=\"2.4 struts.properties\"></a>2.4 struts.properties</h3><p>这个文件是struts2框架的全局属性文件，也是自动加载的文件。该文件包含了系列的key-value对。该文件完全可以配置在struts.xml文件中，使用constant元素。下面是这个文件中一些常见的配置项及说明。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div></pre></td><td class=\"code\"><pre><div class=\"line\">### 指定加载struts2配置文件管理器，默认为org.apache.struts2.config.DefaultConfiguration</div><div class=\"line\">### 开发者可以自定义配置文件管理器，该类要实现Configuration接口，可以自动加载struts2配置文件。</div><div class=\"line\"># struts.configuration=org.apache.struts2.config.DefaultConfiguration</div><div class=\"line\"></div><div class=\"line\">### 设置默认的locale和字符编码</div><div class=\"line\"># struts.locale=en_US</div><div class=\"line\">struts.i18n.encoding=UTF-8</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">### 指定struts的工厂类</div><div class=\"line\"># struts.objectFactory = spring</div><div class=\"line\"></div><div class=\"line\">### 指定spring框架的装配模式</div><div class=\"line\">### 装配方式有: name, type, auto, and constructor (name 是默认装配模式)</div><div class=\"line\">struts.objectFactory.spring.autoWire = name</div><div class=\"line\"></div><div class=\"line\">### 该属性指定整合spring时，是否对bean进行缓存，值为true or false,默认为true.</div><div class=\"line\">struts.objectFactory.spring.useClassCache = true</div><div class=\"line\"></div><div class=\"line\">### 指定类型检查</div><div class=\"line\">#struts.objectTypeDeterminer = tiger</div><div class=\"line\">#struts.objectTypeDeterminer = notiger</div><div class=\"line\"></div><div class=\"line\">### 该属性指定处理 MIME-type multipart/form-data，文件上传</div><div class=\"line\"># struts.multipart.parser=cos</div><div class=\"line\"># struts.multipart.parser=pell</div><div class=\"line\">struts.multipart.parser=jakarta</div><div class=\"line\"># 指定上传文件时的临时目录，默认使用 javax.servlet.context.tempdir </div><div class=\"line\">struts.multipart.saveDir=</div><div class=\"line\">struts.multipart.maxSize=2097152</div><div class=\"line\"></div><div class=\"line\">### 加载自定义属性文件 (不要改写struts.properties!)</div><div class=\"line\"># struts.custom.properties=application,org/apache/struts2/extension/custom</div><div class=\"line\"></div><div class=\"line\">### 指定请求url与action映射器，默认为org.apache.struts2.dispatcher.mapper.DefaultActionMapper</div><div class=\"line\">#struts.mapper.class=org.apache.struts2.dispatcher.mapper.DefaultActionMapper</div><div class=\"line\"></div><div class=\"line\">### 指定action的后缀，默认为action</div><div class=\"line\">struts.action.extension=action</div><div class=\"line\"></div><div class=\"line\">### 被 FilterDispatcher使用</div><div class=\"line\">### 如果为 true 则通过jar文件提供静态内容服务. </div><div class=\"line\">### 如果为 false 则静态内容必须位于 <span class=\"tag\">&lt;<span class=\"name\">context_path</span>&gt;</span>/struts</div><div class=\"line\">struts.serve.static=true</div><div class=\"line\"></div><div class=\"line\">### 被 FilterDispatcher使用</div><div class=\"line\">### 指定浏览器是否缓存静态内容，测试阶段设置为false，发布阶段设置为true.</div><div class=\"line\">struts.serve.static.browserCache=true</div><div class=\"line\"></div><div class=\"line\">### 设置是否支持动态方法调用，true为支持，false不支持.</div><div class=\"line\">struts.enable.DynamicMethodInvocation = true</div><div class=\"line\"></div><div class=\"line\">### 设置是否可以在action中使用斜线，默认为false不可以，想使用需设置为true.</div><div class=\"line\">struts.enable.SlashesInActionNames = false</div><div class=\"line\"></div><div class=\"line\">### 是否允许使用表达式语法，默认为true.</div><div class=\"line\">struts.tag.altSyntax=true</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\">### 设置当struts.xml文件改动时，是否重新加载.</div><div class=\"line\">### - struts.configuration.xml.reload = true</div><div class=\"line\">### 设置struts是否为开发模式，默认为false,测试阶段一般设为true.</div><div class=\"line\">struts.devMode = false</div><div class=\"line\"></div><div class=\"line\">### 设置是否每次请求，都重新加载资源文件，默认值为false.</div><div class=\"line\">struts.i18n.reload=false</div><div class=\"line\"></div><div class=\"line\">###标准的UI主题</div><div class=\"line\">### 默认的UI主题为xhtml,可以为simple,xhtml或ajax</div><div class=\"line\">struts.ui.theme=xhtml</div><div class=\"line\">###模板目录</div><div class=\"line\">struts.ui.templateDir=template</div><div class=\"line\">#设置模板类型. 可以为 ftl, vm, or jsp</div><div class=\"line\">struts.ui.templateSuffix=ftl</div><div class=\"line\"></div><div class=\"line\">###定位velocity.properties 文件.  默认 velocity.properties</div><div class=\"line\">struts.velocity.configfile = velocity.properties</div><div class=\"line\"></div><div class=\"line\">### 设置velocity的context.</div><div class=\"line\">struts.velocity.contexts =</div><div class=\"line\"></div><div class=\"line\">### 定位toolbox.</div><div class=\"line\">struts.velocity.toolboxlocation=</div><div class=\"line\"></div><div class=\"line\">### 指定web应用的端口.</div><div class=\"line\">struts.url.http.port = 80</div><div class=\"line\">### 指定加密端口</div><div class=\"line\">struts.url.https.port = 443</div><div class=\"line\">### 设置生成url时，是否包含参数.值可以为: none, get or all</div><div class=\"line\">struts.url.includeParams = get</div><div class=\"line\"></div><div class=\"line\">### 设置要加载的国际化资源文件，以逗号分隔.</div><div class=\"line\"># struts.custom.i18n.resources=testmessages,testmessages2</div><div class=\"line\"></div><div class=\"line\">### 对于一些web应用服务器不能处理HttpServletRequest.getParameterMap()</div><div class=\"line\">### 像 WebLogic, Orion, and OC4J等，须设置成true,默认为false.</div><div class=\"line\">struts.dispatcher.parametersWorkaround = false</div><div class=\"line\"></div><div class=\"line\">### 指定freemarker管理器</div><div class=\"line\">#struts.freemarker.manager.classname=org.apache.struts2.views.freemarker.FreemarkerManager</div><div class=\"line\"></div><div class=\"line\">### 设置是否对freemarker的模板设置缓存</div><div class=\"line\">### 效果相当于把template拷贝到 WEB_APP/templates.</div><div class=\"line\">struts.freemarker.templatesCache=false</div><div class=\"line\"></div><div class=\"line\">### 通常不需要修改此属性.</div><div class=\"line\">struts.freemarker.wrapper.altMap=true</div><div class=\"line\"></div><div class=\"line\">### 指定xslt result是否使用样式表缓存.开发阶段设为true,发布阶段设为false.</div><div class=\"line\">struts.xslt.nocache=false</div><div class=\"line\"></div><div class=\"line\">### 设置struts自动加载的文件列表.</div><div class=\"line\">struts.configuration.files=struts-default.xml,struts-plugin.xml,struts.xml</div><div class=\"line\"></div><div class=\"line\">### 设定是否一直在最后一个slash之前的任何位置选定namespace.</div><div class=\"line\">struts.mapper.alwaysSelectFullNamespace=false</div></pre></td></tr></table></figure>\n<h3 id=\"2-5-web-xml\"><a href=\"#2-5-web-xml\" class=\"headerlink\" title=\"2.5 web.xml\"></a>2.5 web.xml</h3><p>配置struts2的核心过滤器和spring的加载器。<br>这里针对struts2相关配置作介绍。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- Struts2核心过滤器 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>struts2<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 指定action所在包路径 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span>  </div><div class=\"line\">       \t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>actionPackages<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span>  </div><div class=\"line\">       \t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>com.topvision<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span>  </div><div class=\"line\">   \t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">   \t<span class=\"comment\">&lt;!-- 指定struts.xml文件路径，默认classpath下 --&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">   \t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>filterConfig<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">   \t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:struts.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 设置url过滤 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>struts2<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">&lt;!-- 编码 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>encodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>encoding<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>encodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 404错误跳转 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">error-page</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">error-code</span>&gt;</span>404<span class=\"tag\">&lt;/<span class=\"name\">error-code</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">location</span>&gt;</span>/error.jsp?code=404<span class=\"tag\">&lt;/<span class=\"name\">location</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">error-page</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 首页设置 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">welcome-file-list</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.html<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.htm<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.jsp<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.html<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.htm<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.jsp<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">welcome-file-list</span>&gt;</span></div></pre></td></tr></table></figure>"},{"title":"Struts2(3)——Action配置及访问方式","date":"2017-12-21T01:51:14.000Z","_content":"Action类构建及访问方式。\n<!-- more -->\n## 1、如何编写动作类\n\n 1. 普通POJO类做action(不推荐)\n 2. 实现Action接口，重写excute方法(不推荐)\n 3. 继承ActionSupport，写自己需要的方法。\n\n## 2、如何访问动作类\nstruts.xml中action的配置。\n```xml\n<package name=\"login\" namespace=\"/\" extends=\"struts-default\">\n\t<action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t</action>\n</package>\n```\n - package.name:包名，不能和其他package重复，唯一标识\n - package.namespace:命名空间，默认“”，优化访问路径\n - package.extends：自己写的package要继承struts-default这个包\n - action.name：动作的名称。让用户访问用的。\n - action.class：动作类的全名。\n    有默认值的，这个默认值是：com.opensymphony.xwork2.ActionSupport,在struts-default.xml中有配置：<default-class-ref class=\"com.opensymphony.xwork2.ActionSupport\" />\n - action.method：要执行的动作类中的动作方法。\n    有默认值的，这个默认值是：public String execute()方法\n\n\n如上会有一个缺点，就是每个方法都要在xml中配置一个action，较为麻烦。如何优化呢？有两个办法：动态方法调用和通配符。\n\n 1. 通配符\n\n    通配符使用的比较多，是人为的设置编码规则，体现出约定大于编码的规范。即action.name可以使用通配符星号(*)，在action.class、aciton.method、result.name处可以使用{n}方式匹配星号，举个例子就明白了。\n    ```xml\n    <action name=\"*_*\" class=\"{1}\" method=\"{2}\">\n        <result></result>\n    </action>\n    ```\n    请求路径：..../userAction_add，{1}匹配第一个*,为userAction, {2}匹配第二个*，为add。\n\n 2. 动态方法调用\n\n    在struts.xml中开启动态方法的使用。struts.enable.DynamicMethodInvocation = true。\n    ```xml\n    <!-- 让struts2支持动态方法调用,可以使用通配符 -->\n    <constant name=\"struts.enable.DynamicMethodInvocation\" value=\"true\" />\n    ```\n    那么就可以直接使用http://localhost:8080/xxx/xxxAction!add,直接调用xxxAction中的add方法了，并且在struts.xml中的action配置中，就不需要配置method属性的值了。这样做就解决了写死method值的问题\n\n## 3、动作类生命周期\n\n诞生：每次用户访问时。\n活着：动作没有响应结束。\n死亡：响应结束。\n\n多例的；没有线程安全问题。（与struts1所不同的）。\n因为动作类是一个非常普通的Java类，创建它需要消耗的资源可以省略不计。\n\n## 4、动作类访问Servlet的API\n\n 1. 实现xxxAware接口\n\n    ServletContextAware, ServletRequestAware,ServletResponseAware,SessionAware.\n    \n    struts2提供了这四个Aware接口用于Action类的实现，从而注入对应的application、request、response，session。这和ActionContext一样是解耦的，即没有引入servlet相关的包，是在struts2内部的。\n    \n    通过XxxAware接口的实现，可以方便的获取web资源。\n    \n    ```java\n    public class BaseAction extends ActionSupport implements SessionAware,ServletRequestAware, ServletResponseAware, ServletContextAware {\n        private static final long serialVersionUID = -6318930077865937364L;\n        protected Logger logger = LoggerFactory.getLogger(getClass());\n        protected Map<String, Object> session;\n        protected HttpServletRequest request;\n        protected HttpServletResponse response;\n        protected ServletContext context;\n    \n        @Override\n        public void setSession(Map<String, Object> session) {\n            this.session = session;\n        }\n    \n        @Override\n        public void setServletRequest(HttpServletRequest request) {\n            this.request = request;\n        }\n    \n        @Override\n        public void setServletResponse(HttpServletResponse response) {\n            this.response = response;\n        }\n    \n        @Override\n        public void setServletContext(ServletContext context) {\n            this.context = context;\n        }\n    }\n    ```\n\n 2. 直接耦合构造\n\n    ```java\n    ServletContext servletContext = ServletActionContext.getServletContext();\n    HttpServletRequest request = ServletActionContext.getRequest();\n    HttpSession session = request.getSession();\n    ```\n \n\n\n","source":"_posts/Struts2-3-——Action配置及访问方式.md","raw":"---\ntitle: Struts2(3)——Action配置及访问方式\ncategories:\n  - Struts2\ntags:\n  - Struts2\ndate: 2017-12-21 09:51:14\n---\nAction类构建及访问方式。\n<!-- more -->\n## 1、如何编写动作类\n\n 1. 普通POJO类做action(不推荐)\n 2. 实现Action接口，重写excute方法(不推荐)\n 3. 继承ActionSupport，写自己需要的方法。\n\n## 2、如何访问动作类\nstruts.xml中action的配置。\n```xml\n<package name=\"login\" namespace=\"/\" extends=\"struts-default\">\n\t<action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t</action>\n</package>\n```\n - package.name:包名，不能和其他package重复，唯一标识\n - package.namespace:命名空间，默认“”，优化访问路径\n - package.extends：自己写的package要继承struts-default这个包\n - action.name：动作的名称。让用户访问用的。\n - action.class：动作类的全名。\n    有默认值的，这个默认值是：com.opensymphony.xwork2.ActionSupport,在struts-default.xml中有配置：<default-class-ref class=\"com.opensymphony.xwork2.ActionSupport\" />\n - action.method：要执行的动作类中的动作方法。\n    有默认值的，这个默认值是：public String execute()方法\n\n\n如上会有一个缺点，就是每个方法都要在xml中配置一个action，较为麻烦。如何优化呢？有两个办法：动态方法调用和通配符。\n\n 1. 通配符\n\n    通配符使用的比较多，是人为的设置编码规则，体现出约定大于编码的规范。即action.name可以使用通配符星号(*)，在action.class、aciton.method、result.name处可以使用{n}方式匹配星号，举个例子就明白了。\n    ```xml\n    <action name=\"*_*\" class=\"{1}\" method=\"{2}\">\n        <result></result>\n    </action>\n    ```\n    请求路径：..../userAction_add，{1}匹配第一个*,为userAction, {2}匹配第二个*，为add。\n\n 2. 动态方法调用\n\n    在struts.xml中开启动态方法的使用。struts.enable.DynamicMethodInvocation = true。\n    ```xml\n    <!-- 让struts2支持动态方法调用,可以使用通配符 -->\n    <constant name=\"struts.enable.DynamicMethodInvocation\" value=\"true\" />\n    ```\n    那么就可以直接使用http://localhost:8080/xxx/xxxAction!add,直接调用xxxAction中的add方法了，并且在struts.xml中的action配置中，就不需要配置method属性的值了。这样做就解决了写死method值的问题\n\n## 3、动作类生命周期\n\n诞生：每次用户访问时。\n活着：动作没有响应结束。\n死亡：响应结束。\n\n多例的；没有线程安全问题。（与struts1所不同的）。\n因为动作类是一个非常普通的Java类，创建它需要消耗的资源可以省略不计。\n\n## 4、动作类访问Servlet的API\n\n 1. 实现xxxAware接口\n\n    ServletContextAware, ServletRequestAware,ServletResponseAware,SessionAware.\n    \n    struts2提供了这四个Aware接口用于Action类的实现，从而注入对应的application、request、response，session。这和ActionContext一样是解耦的，即没有引入servlet相关的包，是在struts2内部的。\n    \n    通过XxxAware接口的实现，可以方便的获取web资源。\n    \n    ```java\n    public class BaseAction extends ActionSupport implements SessionAware,ServletRequestAware, ServletResponseAware, ServletContextAware {\n        private static final long serialVersionUID = -6318930077865937364L;\n        protected Logger logger = LoggerFactory.getLogger(getClass());\n        protected Map<String, Object> session;\n        protected HttpServletRequest request;\n        protected HttpServletResponse response;\n        protected ServletContext context;\n    \n        @Override\n        public void setSession(Map<String, Object> session) {\n            this.session = session;\n        }\n    \n        @Override\n        public void setServletRequest(HttpServletRequest request) {\n            this.request = request;\n        }\n    \n        @Override\n        public void setServletResponse(HttpServletResponse response) {\n            this.response = response;\n        }\n    \n        @Override\n        public void setServletContext(ServletContext context) {\n            this.context = context;\n        }\n    }\n    ```\n\n 2. 直接耦合构造\n\n    ```java\n    ServletContext servletContext = ServletActionContext.getServletContext();\n    HttpServletRequest request = ServletActionContext.getRequest();\n    HttpSession session = request.getSession();\n    ```\n \n\n\n","slug":"Struts2-3-——Action配置及访问方式","published":1,"updated":"2018-02-27T07:38:38.093Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfum002whwvfsyaxynkm","content":"<p>Action类构建及访问方式。<br><a id=\"more\"></a></p>\n<h2 id=\"1、如何编写动作类\"><a href=\"#1、如何编写动作类\" class=\"headerlink\" title=\"1、如何编写动作类\"></a>1、如何编写动作类</h2><ol>\n<li>普通POJO类做action(不推荐)</li>\n<li>实现Action接口，重写excute方法(不推荐)</li>\n<li>继承ActionSupport，写自己需要的方法。</li>\n</ol>\n<h2 id=\"2、如何访问动作类\"><a href=\"#2、如何访问动作类\" class=\"headerlink\" title=\"2、如何访问动作类\"></a>2、如何访问动作类</h2><p>struts.xml中action的配置。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"login\"</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"/\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<ul>\n<li>package.name:包名，不能和其他package重复，唯一标识</li>\n<li>package.namespace:命名空间，默认“”，优化访问路径</li>\n<li>package.extends：自己写的package要继承struts-default这个包</li>\n<li>action.name：动作的名称。让用户访问用的。</li>\n<li>action.class：动作类的全名。<br> 有默认值的，这个默认值是：com.opensymphony.xwork2.ActionSupport,在struts-default.xml中有配置：<default-class-ref class=\"com.opensymphony.xwork2.ActionSupport\"></default-class-ref></li>\n<li>action.method：要执行的动作类中的动作方法。<br> 有默认值的，这个默认值是：public String execute()方法</li>\n</ul>\n<p>如上会有一个缺点，就是每个方法都要在xml中配置一个action，较为麻烦。如何优化呢？有两个办法：动态方法调用和通配符。</p>\n<ol>\n<li><p>通配符</p>\n<p>通配符使用的比较多，是人为的设置编码规则，体现出约定大于编码的规范。即action.name可以使用通配符星号(*)，在action.class、aciton.method、result.name处可以使用{n}方式匹配星号，举个例子就明白了。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"*_*\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"&#123;1&#125;\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"&#123;2&#125;\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>请求路径：…./userAction_add，{1}匹配第一个<em>,为userAction, {2}匹配第二个</em>，为add。</p>\n</li>\n<li><p>动态方法调用</p>\n<p>在struts.xml中开启动态方法的使用。struts.enable.DynamicMethodInvocation = true。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 让struts2支持动态方法调用,可以使用通配符 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.enable.DynamicMethodInvocation\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div></pre></td></tr></table></figure>\n<p>那么就可以直接使用<a href=\"http://localhost:8080/xxx/xxxAction!add,直接调用xxxAction中的add方法了，并且在struts.xml中的action配置中，就不需要配置method属性的值了。这样做就解决了写死method值的问题\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/xxx/xxxAction!add,直接调用xxxAction中的add方法了，并且在struts.xml中的action配置中，就不需要配置method属性的值了。这样做就解决了写死method值的问题</a></p>\n</li>\n</ol>\n<h2 id=\"3、动作类生命周期\"><a href=\"#3、动作类生命周期\" class=\"headerlink\" title=\"3、动作类生命周期\"></a>3、动作类生命周期</h2><p>诞生：每次用户访问时。<br>活着：动作没有响应结束。<br>死亡：响应结束。</p>\n<p>多例的；没有线程安全问题。（与struts1所不同的）。<br>因为动作类是一个非常普通的Java类，创建它需要消耗的资源可以省略不计。</p>\n<h2 id=\"4、动作类访问Servlet的API\"><a href=\"#4、动作类访问Servlet的API\" class=\"headerlink\" title=\"4、动作类访问Servlet的API\"></a>4、动作类访问Servlet的API</h2><ol>\n<li><p>实现xxxAware接口</p>\n<p>ServletContextAware, ServletRequestAware,ServletResponseAware,SessionAware.</p>\n<p>struts2提供了这四个Aware接口用于Action类的实现，从而注入对应的application、request、response，session。这和ActionContext一样是解耦的，即没有引入servlet相关的包，是在struts2内部的。</p>\n<p>通过XxxAware接口的实现，可以方便的获取web资源。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BaseAction</span> <span class=\"keyword\">extends</span> <span class=\"title\">ActionSupport</span> <span class=\"keyword\">implements</span> <span class=\"title\">SessionAware</span>,<span class=\"title\">ServletRequestAware</span>, <span class=\"title\">ServletResponseAware</span>, <span class=\"title\">ServletContextAware</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">6318930077865937364L</span>;</div><div class=\"line\">    <span class=\"keyword\">protected</span> Logger logger = LoggerFactory.getLogger(getClass());</div><div class=\"line\">    <span class=\"keyword\">protected</span> Map&lt;String, Object&gt; session;</div><div class=\"line\">    <span class=\"keyword\">protected</span> HttpServletRequest request;</div><div class=\"line\">    <span class=\"keyword\">protected</span> HttpServletResponse response;</div><div class=\"line\">    <span class=\"keyword\">protected</span> ServletContext context;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setSession</span><span class=\"params\">(Map&lt;String, Object&gt; session)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.session = session;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setServletRequest</span><span class=\"params\">(HttpServletRequest request)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.request = request;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setServletResponse</span><span class=\"params\">(HttpServletResponse response)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.response = response;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setServletContext</span><span class=\"params\">(ServletContext context)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.context = context;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>直接耦合构造</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">ServletContext servletContext = ServletActionContext.getServletContext();</div><div class=\"line\">HttpServletRequest request = ServletActionContext.getRequest();</div><div class=\"line\">HttpSession session = request.getSession();</div></pre></td></tr></table></figure>\n</li>\n</ol>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>Action类构建及访问方式。<br>","more":"</p>\n<h2 id=\"1、如何编写动作类\"><a href=\"#1、如何编写动作类\" class=\"headerlink\" title=\"1、如何编写动作类\"></a>1、如何编写动作类</h2><ol>\n<li>普通POJO类做action(不推荐)</li>\n<li>实现Action接口，重写excute方法(不推荐)</li>\n<li>继承ActionSupport，写自己需要的方法。</li>\n</ol>\n<h2 id=\"2、如何访问动作类\"><a href=\"#2、如何访问动作类\" class=\"headerlink\" title=\"2、如何访问动作类\"></a>2、如何访问动作类</h2><p>struts.xml中action的配置。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"login\"</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"/\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<ul>\n<li>package.name:包名，不能和其他package重复，唯一标识</li>\n<li>package.namespace:命名空间，默认“”，优化访问路径</li>\n<li>package.extends：自己写的package要继承struts-default这个包</li>\n<li>action.name：动作的名称。让用户访问用的。</li>\n<li>action.class：动作类的全名。<br> 有默认值的，这个默认值是：com.opensymphony.xwork2.ActionSupport,在struts-default.xml中有配置：<default-class-ref class=\"com.opensymphony.xwork2.ActionSupport\"></default-class-ref></li>\n<li>action.method：要执行的动作类中的动作方法。<br> 有默认值的，这个默认值是：public String execute()方法</li>\n</ul>\n<p>如上会有一个缺点，就是每个方法都要在xml中配置一个action，较为麻烦。如何优化呢？有两个办法：动态方法调用和通配符。</p>\n<ol>\n<li><p>通配符</p>\n<p>通配符使用的比较多，是人为的设置编码规则，体现出约定大于编码的规范。即action.name可以使用通配符星号(*)，在action.class、aciton.method、result.name处可以使用{n}方式匹配星号，举个例子就明白了。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"*_*\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"&#123;1&#125;\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"&#123;2&#125;\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>请求路径：…./userAction_add，{1}匹配第一个<em>,为userAction, {2}匹配第二个</em>，为add。</p>\n</li>\n<li><p>动态方法调用</p>\n<p>在struts.xml中开启动态方法的使用。struts.enable.DynamicMethodInvocation = true。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 让struts2支持动态方法调用,可以使用通配符 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.enable.DynamicMethodInvocation\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div></pre></td></tr></table></figure>\n<p>那么就可以直接使用<a href=\"http://localhost:8080/xxx/xxxAction!add,直接调用xxxAction中的add方法了，并且在struts.xml中的action配置中，就不需要配置method属性的值了。这样做就解决了写死method值的问题\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/xxx/xxxAction!add,直接调用xxxAction中的add方法了，并且在struts.xml中的action配置中，就不需要配置method属性的值了。这样做就解决了写死method值的问题</a></p>\n</li>\n</ol>\n<h2 id=\"3、动作类生命周期\"><a href=\"#3、动作类生命周期\" class=\"headerlink\" title=\"3、动作类生命周期\"></a>3、动作类生命周期</h2><p>诞生：每次用户访问时。<br>活着：动作没有响应结束。<br>死亡：响应结束。</p>\n<p>多例的；没有线程安全问题。（与struts1所不同的）。<br>因为动作类是一个非常普通的Java类，创建它需要消耗的资源可以省略不计。</p>\n<h2 id=\"4、动作类访问Servlet的API\"><a href=\"#4、动作类访问Servlet的API\" class=\"headerlink\" title=\"4、动作类访问Servlet的API\"></a>4、动作类访问Servlet的API</h2><ol>\n<li><p>实现xxxAware接口</p>\n<p>ServletContextAware, ServletRequestAware,ServletResponseAware,SessionAware.</p>\n<p>struts2提供了这四个Aware接口用于Action类的实现，从而注入对应的application、request、response，session。这和ActionContext一样是解耦的，即没有引入servlet相关的包，是在struts2内部的。</p>\n<p>通过XxxAware接口的实现，可以方便的获取web资源。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BaseAction</span> <span class=\"keyword\">extends</span> <span class=\"title\">ActionSupport</span> <span class=\"keyword\">implements</span> <span class=\"title\">SessionAware</span>,<span class=\"title\">ServletRequestAware</span>, <span class=\"title\">ServletResponseAware</span>, <span class=\"title\">ServletContextAware</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">6318930077865937364L</span>;</div><div class=\"line\">    <span class=\"keyword\">protected</span> Logger logger = LoggerFactory.getLogger(getClass());</div><div class=\"line\">    <span class=\"keyword\">protected</span> Map&lt;String, Object&gt; session;</div><div class=\"line\">    <span class=\"keyword\">protected</span> HttpServletRequest request;</div><div class=\"line\">    <span class=\"keyword\">protected</span> HttpServletResponse response;</div><div class=\"line\">    <span class=\"keyword\">protected</span> ServletContext context;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setSession</span><span class=\"params\">(Map&lt;String, Object&gt; session)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.session = session;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setServletRequest</span><span class=\"params\">(HttpServletRequest request)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.request = request;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setServletResponse</span><span class=\"params\">(HttpServletResponse response)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.response = response;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setServletContext</span><span class=\"params\">(ServletContext context)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.context = context;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>直接耦合构造</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">ServletContext servletContext = ServletActionContext.getServletContext();</div><div class=\"line\">HttpServletRequest request = ServletActionContext.getRequest();</div><div class=\"line\">HttpSession session = request.getSession();</div></pre></td></tr></table></figure>\n</li>\n</ol>"},{"title":"Spring MVC(1)——入门","date":"2018-03-06T07:11:40.000Z","_content":"Spring MVC全称是Spring Web MVC,是spring框架中的一部分，与struts一样是一个表现层框架。\n\nSpring MVC是当前最优秀的MVC框架，自从Spring2.5版本发布后，由于支持注解配置，易用性有了大幅度的提高。Spring3.0更加完善，实现了对Struts2的超越。现在越来越多的开发团队选择了Spring MVC。\n<!--more-->\n\n![此处输入图片的描述][2]\n## 1、Spring MVC与Struts2对比!\n\n 1. 加载机制：SpringMVC入口是servlet,Struts2入口是filter;[servlet与filter区别][3]\n 2. 性能：SpringMVC优于Struts2\n    Struts2基于类设计，每次请求实例化一个action对象，对应一个request上下文；\n    SpringMVC基于方法设计，每次请求实例化一个方法对象，每个方法独享request上下文。\n 3. 参数传递：\n    Struts2使用类变量接收参数，多个方法共享；\n    SpringMVC使用请求参数获取，方法独享\n 4. 框架继承：spring MVC和Spring是无缝(无缝：无须数据格式转换，直接访问来自数据源数据格式)的。从这个项目的管理和安全上也比Struts2高。\n 5. 拦截机制：spring mvc用的是独立的AOP方式实现，而struts2有自己的interceptor机制，这样导致了struts2的配置文件量又比spring mvc大。\n 6. Restful架构实现：\n    spring mvc用的是独立的AOP方式实现，而struts2有自己的interceptor机制，这样导致了struts2的配置文件量又比spring mvc大；\n    spring mvc用的是独立的AOP方式实现，而struts2有自己的interceptor机制，这样导致了struts2的配置文件量又比spring mvc大。\n\n## 2、SpringMVC运行流程\n![此处输入图片的描述][4]\n\n 1. 用户发送请求至前端控制器DispatcherServlet\n 2. DispatcherServlet收到请求调用HandlerMapping处理器映射器查找Handler。\n 3. 处理器映射器根据请求url找到具体的处理器，生成处理器对象及处理器拦截器(如果有则生成)一并返回给DispatcherServlet。\n 4. DispatcherServlet通过HandlerAdapter处理器适配器调用处理器\n 5. HandlerAdapter调用处理器Handler\n 6. Handler执行完成返回ModelAndView\n 7. HandlerAdapter将Handler执行结果ModelAndView返回给DispatcherServlet\n 8. DispatcherServlet将ModelAndView传给ViewReslover视图解析器，ViewReslover根据逻辑视图名解析View\n 9. ViewReslover返回View\n 10. DispatcherServlet对View进行渲染视图（即将模型数据填充至request域）。\n 11. DispatcherServlet响应用户\n\n从以上流程可以看出几个主要的部件：\n\n 1. 前端控制器DispatcherServlet(SpringMVC提供)\n    作用：接收请求，相应结果\n    有了前端控制器减少各各组件之间的耦合性，前端控制器相关于中央调度器\n 2. 处理器映射器HandlerMapping(SpringMVC提供)\n    作用：根据url查找Handler，比如：根据xml配置、注解方式查找Handler\n 3. 处理器适配器HandlerAdapter(SpringMVC提供)\n    作用：执行Handler\n    不同类型的Handler有不同的HandlerAdapter，好处可以通过扩展HandlerAdapter支持更多类型的Handler。\n 4. 处理器Handler（<span style=\"color:red\">由程序员开发</span>）\n    作用：业务处理\n    实现开发中又称为controller即后端控制器\n    Handler的开发按照HandlerAdapter的接口规则去开发。\n    Handler处理后的结果是ModelAndView，是springmvc的底层对象，包括Model和view两个部分。view中只包括一个逻辑视图名（为了方便开发起一个简单的视图名称）。\n 5. ViewReslover视图解析（springmvc框架提供）\n    作用：根据逻辑视图名创建一个View对象（包括真实视图物理地址）\n    针对不同类型的view有不同类型的ViewReslover，常用的有jsp视图解析器即jstlView\n 6. View视图（<span style=\"color:red\">由程序员开发</span>）\n    作用：将模型数据填充进来(将model数据填充到request域)显示给用户\n    view是一个接口，实现类包括：jstlView、freemarkerView，pdfView\n\n## 3、案例搭建\n\n使用maven构建基本工程结构\n\n### 3.1 创建web项目\n\n### 3.2 设置jdk版本及servlet环境\n细节参见[Maven学习与基本使用][5]\n\n### 3.3 导入jar包,设置pom\n\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\t<groupId>com.topvision.maven</groupId>\n\t<artifactId>ssm</artifactId>\n\t<packaging>war</packaging>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<name>ssm Maven Webapp</name>\n\t<url>http://maven.apache.org</url>\n\n\t<!-- 属性 -->\n\t<properties>\n\t\t<spring.version>4.3.12.RELEASE</spring.version>\n\t\t<mybatis.version>3.4.5</mybatis.version>\n\t</properties>\n\n\t<!-- 锁定版本 -->\n\t<dependencyManagement>\n\t\t<dependencies>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-context</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-aspects</artifactId>\n            \t<version>${spring.version}</version>\n\t\t\t</dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-orm</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-test</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-web</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-webmvc</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.mybatis</groupId>\n            \t<artifactId>mybatis</artifactId>\n\t\t\t\t<version>${mybatis.version}</version>\n\t\t\t</dependency>\n\t\t</dependencies>\n\t</dependencyManagement>\n\n\t<dependencies>\n\t\t<!-- Spring -->\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-test</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-context</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-aspects</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-orm</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-web</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-webmvc</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>3.8.1</version>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\n\t\t<!-- mybatis -->\n\t\t<dependency>\n\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t<artifactId>mybatis</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t<artifactId>mybatis-spring</artifactId>\n\t\t\t<version>1.3.1</version>\n\t\t</dependency>\n\n\t\t<!-- mysql驱动 -->\n\t\t<dependency>\n\t\t\t<groupId>mysql</groupId>\n\t\t\t<artifactId>mysql-connector-java</artifactId>\n\t\t\t<version>5.1.6</version>\n\t\t\t<scope>runtime</scope>\n\t\t</dependency>\n\n\t\t<!-- c3p0 -->\n\t\t<dependency>\n\t\t\t<groupId>c3p0</groupId>\n\t\t\t<artifactId>c3p0</artifactId>\n\t\t\t<version>0.9.1.2</version>\n\t\t</dependency>\n\t\t<!-- slf4j -->\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-log4j12</artifactId>\n\t\t\t<version>1.7.2</version>\n\t\t</dependency>\n\t\t<!-- junit -->\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>4.9</version>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t\t<!-- jstl -->\n\t\t<dependency>\n\t\t\t<groupId>javax.servlet</groupId>\n\t\t\t<artifactId>jstl</artifactId>\n\t\t\t<version>1.2</version>\n\t\t</dependency>\n\n\t\t<!-- servlet jsp -->\n\t\t<dependency>\n\t\t\t<groupId>javax.servlet</groupId>\n\t\t\t<artifactId>servlet-api</artifactId>\n\t\t\t<version>2.5</version>\n\t\t\t<scope>provided</scope>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>javax.servlet</groupId>\n\t\t\t<artifactId>jsp-api</artifactId>\n\t\t\t<version>2.0</version>\n\t\t\t<scope>provided</scope>\n\t\t</dependency>\n\t</dependencies>\n\n\t<build>\n\t\t<plugins>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n\t\t\t\t<artifactId>maven-compiler-plugin</artifactId>\n\t\t\t\t<configuration>\n\t\t\t\t\t<source>1.8</source>\n\t\t\t\t\t<target>1.8</target>\n\t\t\t\t\t<encoding>UTF-8</encoding>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t</plugins>\n\n\t\t<finalName>ssm</finalName>\n\t</build>\n</project>\n```\n\n### 3.4 配置前端控制器\n\n关键：在web.xml配置springmvc的前端控制器\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<web-app xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txmlns=\"http://java.sun.com/xml/ns/javaee\" xmlns:web=\"http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\"\n\txsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\"\n\tid=\"WebApp_ID\" version=\"2.5\">\n\t\n\t\n\t<servlet>\n\t\t<servlet-name>springDispatcherServlet</servlet-name>\n\t\t<servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>\n\t\t<init-param>\n\t\t    <!--若不配置此项，默认加载/WEB-INF/[servlet的名字]-servlet.xml-->\n\t\t\t<param-name>contextConfigLocation</param-name>\n\t\t\t<param-value>classpath:springmvc.xml</param-value>\n\t\t</init-param>\n\t\t<load-on-startup>1</load-on-startup>\n\t</servlet>\n\t<servlet-mapping>\n\t\t<servlet-name>springDispatcherServlet</servlet-name>\n\t\t<!--\n\t\t*.action或*.do等等，以其结尾的url由springmvc来解析\n\t\t/ 所有请求都由springmvc解析，单静态资源的请求（html,css,js）由其解析是不对的\n\t\t/* 此种配置方式不对，当转到jsp页面，springmvc会去解析jsp页面路径地址，无法解析成功\n\t\t-->\n\t\t<url-pattern>*.action</url-pattern>\n\t</servlet-mapping>\n</web-app>\n```\n\n### 3.5 配置处理器映射器\n\n在3.4设置的地址下新建对应的xml文件，一般在classpath下新建springmvc.xml\n\n在springmvc.xml中配置处理器映射器。（有多种）\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:mvc=\"http://www.springframework.org/schema/mvc\"\n\txmlns:context=\"http://www.springframework.org/schema/context\"\n\txmlns:aop=\"http://www.springframework.org/schema/aop\" xmlns:tx=\"http://www.springframework.org/schema/tx\"\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \n\t\thttp://www.springframework.org/schema/beans/spring-beans-3.0.xsd \n\t\thttp://www.springframework.org/schema/mvc \n\t\thttp://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd \n\t\thttp://www.springframework.org/schema/context \n\t\thttp://www.springframework.org/schema/context/spring-context-3.0.xsd \n\t\thttp://www.springframework.org/schema/aop \n\t\thttp://www.springframework.org/schema/aop/spring-aop-3.0.xsd \n\t\thttp://www.springframework.org/schema/tx \n\t\thttp://www.springframework.org/schema/tx/spring-tx-3.0.xsd\">\n\t\t\n\t\t<!-- 处理器映射器,选择其中之一即可-->\n\t\t<!--根据handel的名字来匹配url-->\n\t    <bean class=\"org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping\"/>\n\t    \n\t    <!--升级版-->\n\t    <!--根据handel的id来匹配url-->\n\t    <bean class=\"org.springframework.web.servlet.handler.SimpleUrlHandlerMapping\">\n\t\t<property name=\"mappings\">\n\t\t\t<props>\n\t\t\t\t<prop key=\"/ItemsList2.action\">itemsController</prop>\n\t\t\t\t<prop key=\"/ItemsList3.action\">itemsController</prop>\n\t\t\t</props>\n\t\t</property>\n\t</bean>\n</beans>\n```\n\n### 3.6 配置处理器适配器\n\n开发Handel必须按照处理器适配器接口规则去开发，先要确定使用哪个处理器适配器。\n此处使用SimpleControllerHandlerAdapter。\n\n```xml\n<!-- 处理器适配器 -->\n<bean class=\"org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter\"/>\n```\n通过源码分析得出：\n```java\npublic boolean supports(Object handler) {\n\treturn (handler instanceof Controller);\n}\n```\n只要实现了Controller接口的bean，SimpleControllerHandlerAdapter都可以去执行。\n\n还有一个非注解适配器***HttpRequestHandlerAdapter***，只要实现***HttpRequestHandler***接口即可。\n\n### 3.7 开发及配置Handel\n\n```java\npublic class ItemsController1 implements Controller {\n\n    @Override\n    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception {\n        // 调用service查询商品信息\n        // 这里不调用service使用静态数据模拟\n        List<Items> itemsList = new ArrayList<Items>();\n\n        Items items_2 = new Items();\n        items_2.setName(\"苹果手机\");\n        items_2.setPrice(9688f);\n        items_2.setDetail(\"iphoneX苹果手机！\");\n\n        itemsList.add(items_1);\n        itemsList.add(items_2);\n        \n        ModelAndView modelAndView = new ModelAndView();\n        //此方法相当于request.setAttribute(arg0, arg1)\n        modelAndView.addObject(itemsList);\n        //指定视图地址\n        modelAndView.setViewName(\"/WEB-INF/jsp/itemsList.jsp\");\n\n        return modelAndView;\n    }\n}\n```\n\n### 3.8 配置视图解析器\n\n使用jsp视图解析器，在springmvc.xml中配置如下：\n\n```xml\n<!-- ViewResolver -->\n<bean class=\"org.springframework.web.servlet.view.InternalResourceViewResolver\">\n\t<!--设置统一的前后缀-->\n\t<property name=\"prefix\" value=\"/WEB-INF/jsp/\"/>\n\t<property name=\"suffix\" value=\".jsp\"/>\n</bean>\n```\n\n更改Handle代码，使用逻辑视图名:\n\n```java\n//指定视图地址\n//modelAndView.setViewName(\"/WEB-INF/jsp/itemsList.jsp\");\nmodelAndView.setViewName(\"itemList\");\n```\n\n### 3.9 配置jsp视图\n\n在web-inf/jsp下，创建itemList.jsp\n\n## 4、注解开发\n\n### 4.1 注解的处理器映射器和适配器\n\n注解的处理器映射器：\nspring3.1之前使用org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping\nspring3.1之后使用org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;\n\n注解的处理器适配器：\nspring3.1之前使用\norg.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter\n3.1之后使用\norg.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter\n\n在springmvc.xml中配置：\n\n```xml\n<!-- 注解的处理器映射器和适配器 -->\n<!-- \n<bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping\"/>\n<bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter\" />\n-->\n<!-- 简写 -->\n<mvc:annotation-driven/>\n```\n\n### 4.2 注解开发Handle\n\n注解处理器映射器和注解处理器适配器要配对使用，对标记@controller注解类中的标记有@RequestMapping方法进行映射和执行。\n@controller标记此类是一个控制器\n@RequestMapping：对url和Handler中的方法进行映射。\n\n```java\n@Controller\npublic class ItemsController2 {\n\n    @RequestMapping(\"/itemsList4\")\n    public ModelAndView itemList4() {\n        // 调用service查询商品信息\n        // 这里不调用service使用静态数据模拟\n        List<Items> itemsList = new ArrayList<Items>();\n\n        Items items_1 = new Items();\n        items_1.setName(\"联想笔记本\");\n        items_1.setPrice(6000f);\n        items_1.setDetail(\"ThinkPad T430 联想笔记本电脑！\");\n\n        Items items_2 = new Items();\n        items_2.setName(\"苹果手机\");\n        items_2.setPrice(5000f);\n        items_2.setDetail(\"iphone6苹果手机！\");\n\n        itemsList.add(items_1);\n        itemsList.add(items_2);\n\n        ModelAndView modelAndView = new ModelAndView();\n        // 此方法相当于request.setAttribute(arg0, arg1)\n        modelAndView.addObject(itemsList);\n        // 指定视图地址\n        // modelAndView.setViewName(\"/WEB-INF/jsp/itemsList.jsp\");\n        modelAndView.setViewName(\"itemsList\");\n\n        return modelAndView;\n    }\n}\n```\n\n### 4.3 在spring容器中配置Handle\n\n为方便配置，采用注解扫描的方式。\n\n```xml\n<!-- 可以扫描标记有@controller、@service、@repository、@component的bean -->\n<context:component-scan base-package=\"com.topvision.ssm\"></context:component-scan>\n```\n\n\n  [1]: https://kevinxiao2016.github.io/2018/02/24/Spring-MVC-1-%E2%80%94%E2%80%94%E5%85%A5%E9%97%A8/\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/SpringMVC/springFramework.png\n  [3]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/SpringMVC/flow.png\n  [4]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/SpringMVC/flow.png\n  [5]: https://www.zybuluo.com/MrXiao/note/772562","source":"_posts/Spring-MVC-1-——入门.md","raw":"---\ntitle: Spring MVC(1)——入门\ncategories:\n  - Spring\ntags:\n  - SpringMVC\ndate: 2018-03-06 15:11:40\n---\nSpring MVC全称是Spring Web MVC,是spring框架中的一部分，与struts一样是一个表现层框架。\n\nSpring MVC是当前最优秀的MVC框架，自从Spring2.5版本发布后，由于支持注解配置，易用性有了大幅度的提高。Spring3.0更加完善，实现了对Struts2的超越。现在越来越多的开发团队选择了Spring MVC。\n<!--more-->\n\n![此处输入图片的描述][2]\n## 1、Spring MVC与Struts2对比!\n\n 1. 加载机制：SpringMVC入口是servlet,Struts2入口是filter;[servlet与filter区别][3]\n 2. 性能：SpringMVC优于Struts2\n    Struts2基于类设计，每次请求实例化一个action对象，对应一个request上下文；\n    SpringMVC基于方法设计，每次请求实例化一个方法对象，每个方法独享request上下文。\n 3. 参数传递：\n    Struts2使用类变量接收参数，多个方法共享；\n    SpringMVC使用请求参数获取，方法独享\n 4. 框架继承：spring MVC和Spring是无缝(无缝：无须数据格式转换，直接访问来自数据源数据格式)的。从这个项目的管理和安全上也比Struts2高。\n 5. 拦截机制：spring mvc用的是独立的AOP方式实现，而struts2有自己的interceptor机制，这样导致了struts2的配置文件量又比spring mvc大。\n 6. Restful架构实现：\n    spring mvc用的是独立的AOP方式实现，而struts2有自己的interceptor机制，这样导致了struts2的配置文件量又比spring mvc大；\n    spring mvc用的是独立的AOP方式实现，而struts2有自己的interceptor机制，这样导致了struts2的配置文件量又比spring mvc大。\n\n## 2、SpringMVC运行流程\n![此处输入图片的描述][4]\n\n 1. 用户发送请求至前端控制器DispatcherServlet\n 2. DispatcherServlet收到请求调用HandlerMapping处理器映射器查找Handler。\n 3. 处理器映射器根据请求url找到具体的处理器，生成处理器对象及处理器拦截器(如果有则生成)一并返回给DispatcherServlet。\n 4. DispatcherServlet通过HandlerAdapter处理器适配器调用处理器\n 5. HandlerAdapter调用处理器Handler\n 6. Handler执行完成返回ModelAndView\n 7. HandlerAdapter将Handler执行结果ModelAndView返回给DispatcherServlet\n 8. DispatcherServlet将ModelAndView传给ViewReslover视图解析器，ViewReslover根据逻辑视图名解析View\n 9. ViewReslover返回View\n 10. DispatcherServlet对View进行渲染视图（即将模型数据填充至request域）。\n 11. DispatcherServlet响应用户\n\n从以上流程可以看出几个主要的部件：\n\n 1. 前端控制器DispatcherServlet(SpringMVC提供)\n    作用：接收请求，相应结果\n    有了前端控制器减少各各组件之间的耦合性，前端控制器相关于中央调度器\n 2. 处理器映射器HandlerMapping(SpringMVC提供)\n    作用：根据url查找Handler，比如：根据xml配置、注解方式查找Handler\n 3. 处理器适配器HandlerAdapter(SpringMVC提供)\n    作用：执行Handler\n    不同类型的Handler有不同的HandlerAdapter，好处可以通过扩展HandlerAdapter支持更多类型的Handler。\n 4. 处理器Handler（<span style=\"color:red\">由程序员开发</span>）\n    作用：业务处理\n    实现开发中又称为controller即后端控制器\n    Handler的开发按照HandlerAdapter的接口规则去开发。\n    Handler处理后的结果是ModelAndView，是springmvc的底层对象，包括Model和view两个部分。view中只包括一个逻辑视图名（为了方便开发起一个简单的视图名称）。\n 5. ViewReslover视图解析（springmvc框架提供）\n    作用：根据逻辑视图名创建一个View对象（包括真实视图物理地址）\n    针对不同类型的view有不同类型的ViewReslover，常用的有jsp视图解析器即jstlView\n 6. View视图（<span style=\"color:red\">由程序员开发</span>）\n    作用：将模型数据填充进来(将model数据填充到request域)显示给用户\n    view是一个接口，实现类包括：jstlView、freemarkerView，pdfView\n\n## 3、案例搭建\n\n使用maven构建基本工程结构\n\n### 3.1 创建web项目\n\n### 3.2 设置jdk版本及servlet环境\n细节参见[Maven学习与基本使用][5]\n\n### 3.3 导入jar包,设置pom\n\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\t<groupId>com.topvision.maven</groupId>\n\t<artifactId>ssm</artifactId>\n\t<packaging>war</packaging>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<name>ssm Maven Webapp</name>\n\t<url>http://maven.apache.org</url>\n\n\t<!-- 属性 -->\n\t<properties>\n\t\t<spring.version>4.3.12.RELEASE</spring.version>\n\t\t<mybatis.version>3.4.5</mybatis.version>\n\t</properties>\n\n\t<!-- 锁定版本 -->\n\t<dependencyManagement>\n\t\t<dependencies>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-context</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-aspects</artifactId>\n            \t<version>${spring.version}</version>\n\t\t\t</dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-orm</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-test</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-web</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.springframework</groupId>\n            \t<artifactId>spring-webmvc</artifactId>\n            \t<version>${spring.version}</version>\n            </dependency>\n            <dependency>\n            \t<groupId>org.mybatis</groupId>\n            \t<artifactId>mybatis</artifactId>\n\t\t\t\t<version>${mybatis.version}</version>\n\t\t\t</dependency>\n\t\t</dependencies>\n\t</dependencyManagement>\n\n\t<dependencies>\n\t\t<!-- Spring -->\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-test</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-context</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-aspects</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-orm</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-web</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-webmvc</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>3.8.1</version>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\n\t\t<!-- mybatis -->\n\t\t<dependency>\n\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t<artifactId>mybatis</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.mybatis</groupId>\n\t\t\t<artifactId>mybatis-spring</artifactId>\n\t\t\t<version>1.3.1</version>\n\t\t</dependency>\n\n\t\t<!-- mysql驱动 -->\n\t\t<dependency>\n\t\t\t<groupId>mysql</groupId>\n\t\t\t<artifactId>mysql-connector-java</artifactId>\n\t\t\t<version>5.1.6</version>\n\t\t\t<scope>runtime</scope>\n\t\t</dependency>\n\n\t\t<!-- c3p0 -->\n\t\t<dependency>\n\t\t\t<groupId>c3p0</groupId>\n\t\t\t<artifactId>c3p0</artifactId>\n\t\t\t<version>0.9.1.2</version>\n\t\t</dependency>\n\t\t<!-- slf4j -->\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-log4j12</artifactId>\n\t\t\t<version>1.7.2</version>\n\t\t</dependency>\n\t\t<!-- junit -->\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>4.9</version>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t\t<!-- jstl -->\n\t\t<dependency>\n\t\t\t<groupId>javax.servlet</groupId>\n\t\t\t<artifactId>jstl</artifactId>\n\t\t\t<version>1.2</version>\n\t\t</dependency>\n\n\t\t<!-- servlet jsp -->\n\t\t<dependency>\n\t\t\t<groupId>javax.servlet</groupId>\n\t\t\t<artifactId>servlet-api</artifactId>\n\t\t\t<version>2.5</version>\n\t\t\t<scope>provided</scope>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>javax.servlet</groupId>\n\t\t\t<artifactId>jsp-api</artifactId>\n\t\t\t<version>2.0</version>\n\t\t\t<scope>provided</scope>\n\t\t</dependency>\n\t</dependencies>\n\n\t<build>\n\t\t<plugins>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n\t\t\t\t<artifactId>maven-compiler-plugin</artifactId>\n\t\t\t\t<configuration>\n\t\t\t\t\t<source>1.8</source>\n\t\t\t\t\t<target>1.8</target>\n\t\t\t\t\t<encoding>UTF-8</encoding>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t</plugins>\n\n\t\t<finalName>ssm</finalName>\n\t</build>\n</project>\n```\n\n### 3.4 配置前端控制器\n\n关键：在web.xml配置springmvc的前端控制器\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<web-app xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txmlns=\"http://java.sun.com/xml/ns/javaee\" xmlns:web=\"http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\"\n\txsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\"\n\tid=\"WebApp_ID\" version=\"2.5\">\n\t\n\t\n\t<servlet>\n\t\t<servlet-name>springDispatcherServlet</servlet-name>\n\t\t<servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>\n\t\t<init-param>\n\t\t    <!--若不配置此项，默认加载/WEB-INF/[servlet的名字]-servlet.xml-->\n\t\t\t<param-name>contextConfigLocation</param-name>\n\t\t\t<param-value>classpath:springmvc.xml</param-value>\n\t\t</init-param>\n\t\t<load-on-startup>1</load-on-startup>\n\t</servlet>\n\t<servlet-mapping>\n\t\t<servlet-name>springDispatcherServlet</servlet-name>\n\t\t<!--\n\t\t*.action或*.do等等，以其结尾的url由springmvc来解析\n\t\t/ 所有请求都由springmvc解析，单静态资源的请求（html,css,js）由其解析是不对的\n\t\t/* 此种配置方式不对，当转到jsp页面，springmvc会去解析jsp页面路径地址，无法解析成功\n\t\t-->\n\t\t<url-pattern>*.action</url-pattern>\n\t</servlet-mapping>\n</web-app>\n```\n\n### 3.5 配置处理器映射器\n\n在3.4设置的地址下新建对应的xml文件，一般在classpath下新建springmvc.xml\n\n在springmvc.xml中配置处理器映射器。（有多种）\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:mvc=\"http://www.springframework.org/schema/mvc\"\n\txmlns:context=\"http://www.springframework.org/schema/context\"\n\txmlns:aop=\"http://www.springframework.org/schema/aop\" xmlns:tx=\"http://www.springframework.org/schema/tx\"\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans \n\t\thttp://www.springframework.org/schema/beans/spring-beans-3.0.xsd \n\t\thttp://www.springframework.org/schema/mvc \n\t\thttp://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd \n\t\thttp://www.springframework.org/schema/context \n\t\thttp://www.springframework.org/schema/context/spring-context-3.0.xsd \n\t\thttp://www.springframework.org/schema/aop \n\t\thttp://www.springframework.org/schema/aop/spring-aop-3.0.xsd \n\t\thttp://www.springframework.org/schema/tx \n\t\thttp://www.springframework.org/schema/tx/spring-tx-3.0.xsd\">\n\t\t\n\t\t<!-- 处理器映射器,选择其中之一即可-->\n\t\t<!--根据handel的名字来匹配url-->\n\t    <bean class=\"org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping\"/>\n\t    \n\t    <!--升级版-->\n\t    <!--根据handel的id来匹配url-->\n\t    <bean class=\"org.springframework.web.servlet.handler.SimpleUrlHandlerMapping\">\n\t\t<property name=\"mappings\">\n\t\t\t<props>\n\t\t\t\t<prop key=\"/ItemsList2.action\">itemsController</prop>\n\t\t\t\t<prop key=\"/ItemsList3.action\">itemsController</prop>\n\t\t\t</props>\n\t\t</property>\n\t</bean>\n</beans>\n```\n\n### 3.6 配置处理器适配器\n\n开发Handel必须按照处理器适配器接口规则去开发，先要确定使用哪个处理器适配器。\n此处使用SimpleControllerHandlerAdapter。\n\n```xml\n<!-- 处理器适配器 -->\n<bean class=\"org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter\"/>\n```\n通过源码分析得出：\n```java\npublic boolean supports(Object handler) {\n\treturn (handler instanceof Controller);\n}\n```\n只要实现了Controller接口的bean，SimpleControllerHandlerAdapter都可以去执行。\n\n还有一个非注解适配器***HttpRequestHandlerAdapter***，只要实现***HttpRequestHandler***接口即可。\n\n### 3.7 开发及配置Handel\n\n```java\npublic class ItemsController1 implements Controller {\n\n    @Override\n    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception {\n        // 调用service查询商品信息\n        // 这里不调用service使用静态数据模拟\n        List<Items> itemsList = new ArrayList<Items>();\n\n        Items items_2 = new Items();\n        items_2.setName(\"苹果手机\");\n        items_2.setPrice(9688f);\n        items_2.setDetail(\"iphoneX苹果手机！\");\n\n        itemsList.add(items_1);\n        itemsList.add(items_2);\n        \n        ModelAndView modelAndView = new ModelAndView();\n        //此方法相当于request.setAttribute(arg0, arg1)\n        modelAndView.addObject(itemsList);\n        //指定视图地址\n        modelAndView.setViewName(\"/WEB-INF/jsp/itemsList.jsp\");\n\n        return modelAndView;\n    }\n}\n```\n\n### 3.8 配置视图解析器\n\n使用jsp视图解析器，在springmvc.xml中配置如下：\n\n```xml\n<!-- ViewResolver -->\n<bean class=\"org.springframework.web.servlet.view.InternalResourceViewResolver\">\n\t<!--设置统一的前后缀-->\n\t<property name=\"prefix\" value=\"/WEB-INF/jsp/\"/>\n\t<property name=\"suffix\" value=\".jsp\"/>\n</bean>\n```\n\n更改Handle代码，使用逻辑视图名:\n\n```java\n//指定视图地址\n//modelAndView.setViewName(\"/WEB-INF/jsp/itemsList.jsp\");\nmodelAndView.setViewName(\"itemList\");\n```\n\n### 3.9 配置jsp视图\n\n在web-inf/jsp下，创建itemList.jsp\n\n## 4、注解开发\n\n### 4.1 注解的处理器映射器和适配器\n\n注解的处理器映射器：\nspring3.1之前使用org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping\nspring3.1之后使用org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;\n\n注解的处理器适配器：\nspring3.1之前使用\norg.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter\n3.1之后使用\norg.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter\n\n在springmvc.xml中配置：\n\n```xml\n<!-- 注解的处理器映射器和适配器 -->\n<!-- \n<bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping\"/>\n<bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter\" />\n-->\n<!-- 简写 -->\n<mvc:annotation-driven/>\n```\n\n### 4.2 注解开发Handle\n\n注解处理器映射器和注解处理器适配器要配对使用，对标记@controller注解类中的标记有@RequestMapping方法进行映射和执行。\n@controller标记此类是一个控制器\n@RequestMapping：对url和Handler中的方法进行映射。\n\n```java\n@Controller\npublic class ItemsController2 {\n\n    @RequestMapping(\"/itemsList4\")\n    public ModelAndView itemList4() {\n        // 调用service查询商品信息\n        // 这里不调用service使用静态数据模拟\n        List<Items> itemsList = new ArrayList<Items>();\n\n        Items items_1 = new Items();\n        items_1.setName(\"联想笔记本\");\n        items_1.setPrice(6000f);\n        items_1.setDetail(\"ThinkPad T430 联想笔记本电脑！\");\n\n        Items items_2 = new Items();\n        items_2.setName(\"苹果手机\");\n        items_2.setPrice(5000f);\n        items_2.setDetail(\"iphone6苹果手机！\");\n\n        itemsList.add(items_1);\n        itemsList.add(items_2);\n\n        ModelAndView modelAndView = new ModelAndView();\n        // 此方法相当于request.setAttribute(arg0, arg1)\n        modelAndView.addObject(itemsList);\n        // 指定视图地址\n        // modelAndView.setViewName(\"/WEB-INF/jsp/itemsList.jsp\");\n        modelAndView.setViewName(\"itemsList\");\n\n        return modelAndView;\n    }\n}\n```\n\n### 4.3 在spring容器中配置Handle\n\n为方便配置，采用注解扫描的方式。\n\n```xml\n<!-- 可以扫描标记有@controller、@service、@repository、@component的bean -->\n<context:component-scan base-package=\"com.topvision.ssm\"></context:component-scan>\n```\n\n\n  [1]: https://kevinxiao2016.github.io/2018/02/24/Spring-MVC-1-%E2%80%94%E2%80%94%E5%85%A5%E9%97%A8/\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/SpringMVC/springFramework.png\n  [3]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/SpringMVC/flow.png\n  [4]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/SpringMVC/flow.png\n  [5]: https://www.zybuluo.com/MrXiao/note/772562","slug":"Spring-MVC-1-——入门","published":1,"updated":"2018-03-06T08:20:52.227Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfur002zhwvfb34iftst","content":"<p>Spring MVC全称是Spring Web MVC,是spring框架中的一部分，与struts一样是一个表现层框架。</p>\n<p>Spring MVC是当前最优秀的MVC框架，自从Spring2.5版本发布后，由于支持注解配置，易用性有了大幅度的提高。Spring3.0更加完善，实现了对Struts2的超越。现在越来越多的开发团队选择了Spring MVC。<br><a id=\"more\"></a></p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/SpringMVC/springFramework.png\" alt=\"此处输入图片的描述\"></p>\n<h2 id=\"1、Spring-MVC与Struts2对比\"><a href=\"#1、Spring-MVC与Struts2对比\" class=\"headerlink\" title=\"1、Spring MVC与Struts2对比!\"></a>1、Spring MVC与Struts2对比!</h2><ol>\n<li>加载机制：SpringMVC入口是servlet,Struts2入口是filter;<a href=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/SpringMVC/flow.png\" target=\"_blank\" rel=\"noopener\">servlet与filter区别</a></li>\n<li>性能：SpringMVC优于Struts2<br>Struts2基于类设计，每次请求实例化一个action对象，对应一个request上下文；<br>SpringMVC基于方法设计，每次请求实例化一个方法对象，每个方法独享request上下文。</li>\n<li>参数传递：<br>Struts2使用类变量接收参数，多个方法共享；<br>SpringMVC使用请求参数获取，方法独享</li>\n<li>框架继承：spring MVC和Spring是无缝(无缝：无须数据格式转换，直接访问来自数据源数据格式)的。从这个项目的管理和安全上也比Struts2高。</li>\n<li>拦截机制：spring mvc用的是独立的AOP方式实现，而struts2有自己的interceptor机制，这样导致了struts2的配置文件量又比spring mvc大。</li>\n<li>Restful架构实现：<br>spring mvc用的是独立的AOP方式实现，而struts2有自己的interceptor机制，这样导致了struts2的配置文件量又比spring mvc大；<br>spring mvc用的是独立的AOP方式实现，而struts2有自己的interceptor机制，这样导致了struts2的配置文件量又比spring mvc大。</li>\n</ol>\n<h2 id=\"2、SpringMVC运行流程\"><a href=\"#2、SpringMVC运行流程\" class=\"headerlink\" title=\"2、SpringMVC运行流程\"></a>2、SpringMVC运行流程</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/SpringMVC/flow.png\" alt=\"此处输入图片的描述\"></p>\n<ol>\n<li>用户发送请求至前端控制器DispatcherServlet</li>\n<li>DispatcherServlet收到请求调用HandlerMapping处理器映射器查找Handler。</li>\n<li>处理器映射器根据请求url找到具体的处理器，生成处理器对象及处理器拦截器(如果有则生成)一并返回给DispatcherServlet。</li>\n<li>DispatcherServlet通过HandlerAdapter处理器适配器调用处理器</li>\n<li>HandlerAdapter调用处理器Handler</li>\n<li>Handler执行完成返回ModelAndView</li>\n<li>HandlerAdapter将Handler执行结果ModelAndView返回给DispatcherServlet</li>\n<li>DispatcherServlet将ModelAndView传给ViewReslover视图解析器，ViewReslover根据逻辑视图名解析View</li>\n<li>ViewReslover返回View</li>\n<li>DispatcherServlet对View进行渲染视图（即将模型数据填充至request域）。</li>\n<li>DispatcherServlet响应用户</li>\n</ol>\n<p>从以上流程可以看出几个主要的部件：</p>\n<ol>\n<li>前端控制器DispatcherServlet(SpringMVC提供)<br>作用：接收请求，相应结果<br>有了前端控制器减少各各组件之间的耦合性，前端控制器相关于中央调度器</li>\n<li>处理器映射器HandlerMapping(SpringMVC提供)<br>作用：根据url查找Handler，比如：根据xml配置、注解方式查找Handler</li>\n<li>处理器适配器HandlerAdapter(SpringMVC提供)<br>作用：执行Handler<br>不同类型的Handler有不同的HandlerAdapter，好处可以通过扩展HandlerAdapter支持更多类型的Handler。</li>\n<li>处理器Handler（<span style=\"color:red\">由程序员开发</span>）<br>作用：业务处理<br>实现开发中又称为controller即后端控制器<br>Handler的开发按照HandlerAdapter的接口规则去开发。<br>Handler处理后的结果是ModelAndView，是springmvc的底层对象，包括Model和view两个部分。view中只包括一个逻辑视图名（为了方便开发起一个简单的视图名称）。</li>\n<li>ViewReslover视图解析（springmvc框架提供）<br>作用：根据逻辑视图名创建一个View对象（包括真实视图物理地址）<br>针对不同类型的view有不同类型的ViewReslover，常用的有jsp视图解析器即jstlView</li>\n<li>View视图（<span style=\"color:red\">由程序员开发</span>）<br>作用：将模型数据填充进来(将model数据填充到request域)显示给用户<br>view是一个接口，实现类包括：jstlView、freemarkerView，pdfView</li>\n</ol>\n<h2 id=\"3、案例搭建\"><a href=\"#3、案例搭建\" class=\"headerlink\" title=\"3、案例搭建\"></a>3、案例搭建</h2><p>使用maven构建基本工程结构</p>\n<h3 id=\"3-1-创建web项目\"><a href=\"#3-1-创建web项目\" class=\"headerlink\" title=\"3.1 创建web项目\"></a>3.1 创建web项目</h3><h3 id=\"3-2-设置jdk版本及servlet环境\"><a href=\"#3-2-设置jdk版本及servlet环境\" class=\"headerlink\" title=\"3.2 设置jdk版本及servlet环境\"></a>3.2 设置jdk版本及servlet环境</h3><p>细节参见<a href=\"https://www.zybuluo.com/MrXiao/note/772562\" target=\"_blank\" rel=\"noopener\">Maven学习与基本使用</a></p>\n<h3 id=\"3-3-导入jar包-设置pom\"><a href=\"#3-3-导入jar包-设置pom\" class=\"headerlink\" title=\"3.3 导入jar包,设置pom\"></a>3.3 导入jar包,设置pom</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.topvision.maven<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>ssm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>war<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>ssm Maven Webapp<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.apache.org<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 属性 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">spring.version</span>&gt;</span>4.3.12.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">spring.version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">mybatis.version</span>&gt;</span>3.4.5<span class=\"tag\">&lt;/<span class=\"name\">mybatis.version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 锁定版本 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aspects<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-orm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-webmvc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- Spring --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aspects<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-orm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-webmvc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.8.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mybatis --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-spring<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mysql驱动 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- c3p0 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- slf4j --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-log4j12<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- junit --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.9<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- jstl --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jstl<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- servlet jsp --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>servlet-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jsp-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">encoding</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>ssm<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"3-4-配置前端控制器\"><a href=\"#3-4-配置前端控制器\" class=\"headerlink\" title=\"3.4 配置前端控制器\"></a>3.4 配置前端控制器</h3><p>关键：在web.xml配置springmvc的前端控制器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://java.sun.com/xml/ns/javaee\"</span> <span class=\"attr\">xmlns:web</span>=<span class=\"string\">\"http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\"</span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\"</span></div><div class=\"line\">\t<span class=\"attr\">id</span>=<span class=\"string\">\"WebApp_ID\"</span> <span class=\"attr\">version</span>=<span class=\"string\">\"2.5\"</span>&gt;</div><div class=\"line\">\t</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>springDispatcherServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"comment\">&lt;!--若不配置此项，默认加载/WEB-INF/[servlet的名字]-servlet.xml--&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>contextConfigLocation<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:springmvc.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">load-on-startup</span>&gt;</span>1<span class=\"tag\">&lt;/<span class=\"name\">load-on-startup</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>springDispatcherServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!--</span></div><div class=\"line\">\t\t*.action或*.do等等，以其结尾的url由springmvc来解析</div><div class=\"line\">\t\t/ 所有请求都由springmvc解析，单静态资源的请求（html,css,js）由其解析是不对的</div><div class=\"line\">\t\t/* 此种配置方式不对，当转到jsp页面，springmvc会去解析jsp页面路径地址，无法解析成功</div><div class=\"line\">\t\t--&gt;</div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>*.action<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"3-5-配置处理器映射器\"><a href=\"#3-5-配置处理器映射器\" class=\"headerlink\" title=\"3.5 配置处理器映射器\"></a>3.5 配置处理器映射器</h3><p>在3.4设置的地址下新建对应的xml文件，一般在classpath下新建springmvc.xml</p>\n<p>在springmvc.xml中配置处理器映射器。（有多种）</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span> <span class=\"attr\">xmlns:mvc</span>=<span class=\"string\">\"http://www.springframework.org/schema/mvc\"</span></div><div class=\"line\">\t<span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></div><div class=\"line\">\t<span class=\"attr\">xmlns:aop</span>=<span class=\"string\">\"http://www.springframework.org/schema/aop\"</span> <span class=\"attr\">xmlns:tx</span>=<span class=\"string\">\"http://www.springframework.org/schema/tx\"</span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans </span></div><div class=\"line\">\t\thttp://www.springframework.org/schema/beans/spring-beans-3.0.xsd </div><div class=\"line\">\t\thttp://www.springframework.org/schema/mvc </div><div class=\"line\">\t\thttp://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd </div><div class=\"line\">\t\thttp://www.springframework.org/schema/context </div><div class=\"line\">\t\thttp://www.springframework.org/schema/context/spring-context-3.0.xsd </div><div class=\"line\">\t\thttp://www.springframework.org/schema/aop </div><div class=\"line\">\t\thttp://www.springframework.org/schema/aop/spring-aop-3.0.xsd </div><div class=\"line\">\t\thttp://www.springframework.org/schema/tx </div><div class=\"line\">\t\thttp://www.springframework.org/schema/tx/spring-tx-3.0.xsd\"&gt;</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 处理器映射器,选择其中之一即可--&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!--根据handel的名字来匹配url--&gt;</span></div><div class=\"line\">\t    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping\"</span>/&gt;</span></div><div class=\"line\">\t    </div><div class=\"line\">\t    <span class=\"comment\">&lt;!--升级版--&gt;</span></div><div class=\"line\">\t    <span class=\"comment\">&lt;!--根据handel的id来匹配url--&gt;</span></div><div class=\"line\">\t    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.web.servlet.handler.SimpleUrlHandlerMapping\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"mappings\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">props</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">prop</span> <span class=\"attr\">key</span>=<span class=\"string\">\"/ItemsList2.action\"</span>&gt;</span>itemsController<span class=\"tag\">&lt;/<span class=\"name\">prop</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">prop</span> <span class=\"attr\">key</span>=<span class=\"string\">\"/ItemsList3.action\"</span>&gt;</span>itemsController<span class=\"tag\">&lt;/<span class=\"name\">prop</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">props</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"3-6-配置处理器适配器\"><a href=\"#3-6-配置处理器适配器\" class=\"headerlink\" title=\"3.6 配置处理器适配器\"></a>3.6 配置处理器适配器</h3><p>开发Handel必须按照处理器适配器接口规则去开发，先要确定使用哪个处理器适配器。<br>此处使用SimpleControllerHandlerAdapter。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 处理器适配器 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>通过源码分析得出：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">supports</span><span class=\"params\">(Object handler)</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">return</span> (handler <span class=\"keyword\">instanceof</span> Controller);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>只要实现了Controller接口的bean，SimpleControllerHandlerAdapter都可以去执行。</p>\n<p>还有一个非注解适配器<strong><em>HttpRequestHandlerAdapter</em></strong>，只要实现<strong><em>HttpRequestHandler</em></strong>接口即可。</p>\n<h3 id=\"3-7-开发及配置Handel\"><a href=\"#3-7-开发及配置Handel\" class=\"headerlink\" title=\"3.7 开发及配置Handel\"></a>3.7 开发及配置Handel</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ItemsController1</span> <span class=\"keyword\">implements</span> <span class=\"title\">Controller</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">handleRequest</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// 调用service查询商品信息</span></div><div class=\"line\">        <span class=\"comment\">// 这里不调用service使用静态数据模拟</span></div><div class=\"line\">        List&lt;Items&gt; itemsList = <span class=\"keyword\">new</span> ArrayList&lt;Items&gt;();</div><div class=\"line\"></div><div class=\"line\">        Items items_2 = <span class=\"keyword\">new</span> Items();</div><div class=\"line\">        items_2.setName(<span class=\"string\">\"苹果手机\"</span>);</div><div class=\"line\">        items_2.setPrice(<span class=\"number\">9688f</span>);</div><div class=\"line\">        items_2.setDetail(<span class=\"string\">\"iphoneX苹果手机！\"</span>);</div><div class=\"line\"></div><div class=\"line\">        itemsList.add(items_1);</div><div class=\"line\">        itemsList.add(items_2);</div><div class=\"line\">        </div><div class=\"line\">        ModelAndView modelAndView = <span class=\"keyword\">new</span> ModelAndView();</div><div class=\"line\">        <span class=\"comment\">//此方法相当于request.setAttribute(arg0, arg1)</span></div><div class=\"line\">        modelAndView.addObject(itemsList);</div><div class=\"line\">        <span class=\"comment\">//指定视图地址</span></div><div class=\"line\">        modelAndView.setViewName(<span class=\"string\">\"/WEB-INF/jsp/itemsList.jsp\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> modelAndView;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"3-8-配置视图解析器\"><a href=\"#3-8-配置视图解析器\" class=\"headerlink\" title=\"3.8 配置视图解析器\"></a>3.8 配置视图解析器</h3><p>使用jsp视图解析器，在springmvc.xml中配置如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- ViewResolver --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.web.servlet.view.InternalResourceViewResolver\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!--设置统一的前后缀--&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"prefix\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"/WEB-INF/jsp/\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"suffix\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\".jsp\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>更改Handle代码，使用逻辑视图名:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//指定视图地址</span></div><div class=\"line\"><span class=\"comment\">//modelAndView.setViewName(\"/WEB-INF/jsp/itemsList.jsp\");</span></div><div class=\"line\">modelAndView.setViewName(<span class=\"string\">\"itemList\"</span>);</div></pre></td></tr></table></figure>\n<h3 id=\"3-9-配置jsp视图\"><a href=\"#3-9-配置jsp视图\" class=\"headerlink\" title=\"3.9 配置jsp视图\"></a>3.9 配置jsp视图</h3><p>在web-inf/jsp下，创建itemList.jsp</p>\n<h2 id=\"4、注解开发\"><a href=\"#4、注解开发\" class=\"headerlink\" title=\"4、注解开发\"></a>4、注解开发</h2><h3 id=\"4-1-注解的处理器映射器和适配器\"><a href=\"#4-1-注解的处理器映射器和适配器\" class=\"headerlink\" title=\"4.1 注解的处理器映射器和适配器\"></a>4.1 注解的处理器映射器和适配器</h3><p>注解的处理器映射器：<br>spring3.1之前使用org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping<br>spring3.1之后使用org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;</p>\n<p>注解的处理器适配器：<br>spring3.1之前使用<br>org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter<br>3.1之后使用<br>org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter</p>\n<p>在springmvc.xml中配置：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 注解的处理器映射器和适配器 --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- </span></div><div class=\"line\">&lt;bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping\"/&gt;</div><div class=\"line\">&lt;bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter\" /&gt;</div><div class=\"line\">--&gt;</div><div class=\"line\"><span class=\"comment\">&lt;!-- 简写 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mvc:annotation-driven</span>/&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"4-2-注解开发Handle\"><a href=\"#4-2-注解开发Handle\" class=\"headerlink\" title=\"4.2 注解开发Handle\"></a>4.2 注解开发Handle</h3><p>注解处理器映射器和注解处理器适配器要配对使用，对标记@controller注解类中的标记有@RequestMapping方法进行映射和执行。<br>@controller标记此类是一个控制器<br>@RequestMapping：对url和Handler中的方法进行映射。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Controller</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ItemsController2</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/itemsList4\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">itemList4</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// 调用service查询商品信息</span></div><div class=\"line\">        <span class=\"comment\">// 这里不调用service使用静态数据模拟</span></div><div class=\"line\">        List&lt;Items&gt; itemsList = <span class=\"keyword\">new</span> ArrayList&lt;Items&gt;();</div><div class=\"line\"></div><div class=\"line\">        Items items_1 = <span class=\"keyword\">new</span> Items();</div><div class=\"line\">        items_1.setName(<span class=\"string\">\"联想笔记本\"</span>);</div><div class=\"line\">        items_1.setPrice(<span class=\"number\">6000f</span>);</div><div class=\"line\">        items_1.setDetail(<span class=\"string\">\"ThinkPad T430 联想笔记本电脑！\"</span>);</div><div class=\"line\"></div><div class=\"line\">        Items items_2 = <span class=\"keyword\">new</span> Items();</div><div class=\"line\">        items_2.setName(<span class=\"string\">\"苹果手机\"</span>);</div><div class=\"line\">        items_2.setPrice(<span class=\"number\">5000f</span>);</div><div class=\"line\">        items_2.setDetail(<span class=\"string\">\"iphone6苹果手机！\"</span>);</div><div class=\"line\"></div><div class=\"line\">        itemsList.add(items_1);</div><div class=\"line\">        itemsList.add(items_2);</div><div class=\"line\"></div><div class=\"line\">        ModelAndView modelAndView = <span class=\"keyword\">new</span> ModelAndView();</div><div class=\"line\">        <span class=\"comment\">// 此方法相当于request.setAttribute(arg0, arg1)</span></div><div class=\"line\">        modelAndView.addObject(itemsList);</div><div class=\"line\">        <span class=\"comment\">// 指定视图地址</span></div><div class=\"line\">        <span class=\"comment\">// modelAndView.setViewName(\"/WEB-INF/jsp/itemsList.jsp\");</span></div><div class=\"line\">        modelAndView.setViewName(<span class=\"string\">\"itemsList\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> modelAndView;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"4-3-在spring容器中配置Handle\"><a href=\"#4-3-在spring容器中配置Handle\" class=\"headerlink\" title=\"4.3 在spring容器中配置Handle\"></a>4.3 在spring容器中配置Handle</h3><p>为方便配置，采用注解扫描的方式。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 可以扫描标记有@controller、@service、@repository、@component的bean --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.ssm\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">context:component-scan</span>&gt;</span></div></pre></td></tr></table></figure>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>Spring MVC全称是Spring Web MVC,是spring框架中的一部分，与struts一样是一个表现层框架。</p>\n<p>Spring MVC是当前最优秀的MVC框架，自从Spring2.5版本发布后，由于支持注解配置，易用性有了大幅度的提高。Spring3.0更加完善，实现了对Struts2的超越。现在越来越多的开发团队选择了Spring MVC。<br>","more":"</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/SpringMVC/springFramework.png\" alt=\"此处输入图片的描述\"></p>\n<h2 id=\"1、Spring-MVC与Struts2对比\"><a href=\"#1、Spring-MVC与Struts2对比\" class=\"headerlink\" title=\"1、Spring MVC与Struts2对比!\"></a>1、Spring MVC与Struts2对比!</h2><ol>\n<li>加载机制：SpringMVC入口是servlet,Struts2入口是filter;<a href=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/SpringMVC/flow.png\" target=\"_blank\" rel=\"noopener\">servlet与filter区别</a></li>\n<li>性能：SpringMVC优于Struts2<br>Struts2基于类设计，每次请求实例化一个action对象，对应一个request上下文；<br>SpringMVC基于方法设计，每次请求实例化一个方法对象，每个方法独享request上下文。</li>\n<li>参数传递：<br>Struts2使用类变量接收参数，多个方法共享；<br>SpringMVC使用请求参数获取，方法独享</li>\n<li>框架继承：spring MVC和Spring是无缝(无缝：无须数据格式转换，直接访问来自数据源数据格式)的。从这个项目的管理和安全上也比Struts2高。</li>\n<li>拦截机制：spring mvc用的是独立的AOP方式实现，而struts2有自己的interceptor机制，这样导致了struts2的配置文件量又比spring mvc大。</li>\n<li>Restful架构实现：<br>spring mvc用的是独立的AOP方式实现，而struts2有自己的interceptor机制，这样导致了struts2的配置文件量又比spring mvc大；<br>spring mvc用的是独立的AOP方式实现，而struts2有自己的interceptor机制，这样导致了struts2的配置文件量又比spring mvc大。</li>\n</ol>\n<h2 id=\"2、SpringMVC运行流程\"><a href=\"#2、SpringMVC运行流程\" class=\"headerlink\" title=\"2、SpringMVC运行流程\"></a>2、SpringMVC运行流程</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/SpringMVC/flow.png\" alt=\"此处输入图片的描述\"></p>\n<ol>\n<li>用户发送请求至前端控制器DispatcherServlet</li>\n<li>DispatcherServlet收到请求调用HandlerMapping处理器映射器查找Handler。</li>\n<li>处理器映射器根据请求url找到具体的处理器，生成处理器对象及处理器拦截器(如果有则生成)一并返回给DispatcherServlet。</li>\n<li>DispatcherServlet通过HandlerAdapter处理器适配器调用处理器</li>\n<li>HandlerAdapter调用处理器Handler</li>\n<li>Handler执行完成返回ModelAndView</li>\n<li>HandlerAdapter将Handler执行结果ModelAndView返回给DispatcherServlet</li>\n<li>DispatcherServlet将ModelAndView传给ViewReslover视图解析器，ViewReslover根据逻辑视图名解析View</li>\n<li>ViewReslover返回View</li>\n<li>DispatcherServlet对View进行渲染视图（即将模型数据填充至request域）。</li>\n<li>DispatcherServlet响应用户</li>\n</ol>\n<p>从以上流程可以看出几个主要的部件：</p>\n<ol>\n<li>前端控制器DispatcherServlet(SpringMVC提供)<br>作用：接收请求，相应结果<br>有了前端控制器减少各各组件之间的耦合性，前端控制器相关于中央调度器</li>\n<li>处理器映射器HandlerMapping(SpringMVC提供)<br>作用：根据url查找Handler，比如：根据xml配置、注解方式查找Handler</li>\n<li>处理器适配器HandlerAdapter(SpringMVC提供)<br>作用：执行Handler<br>不同类型的Handler有不同的HandlerAdapter，好处可以通过扩展HandlerAdapter支持更多类型的Handler。</li>\n<li>处理器Handler（<span style=\"color:red\">由程序员开发</span>）<br>作用：业务处理<br>实现开发中又称为controller即后端控制器<br>Handler的开发按照HandlerAdapter的接口规则去开发。<br>Handler处理后的结果是ModelAndView，是springmvc的底层对象，包括Model和view两个部分。view中只包括一个逻辑视图名（为了方便开发起一个简单的视图名称）。</li>\n<li>ViewReslover视图解析（springmvc框架提供）<br>作用：根据逻辑视图名创建一个View对象（包括真实视图物理地址）<br>针对不同类型的view有不同类型的ViewReslover，常用的有jsp视图解析器即jstlView</li>\n<li>View视图（<span style=\"color:red\">由程序员开发</span>）<br>作用：将模型数据填充进来(将model数据填充到request域)显示给用户<br>view是一个接口，实现类包括：jstlView、freemarkerView，pdfView</li>\n</ol>\n<h2 id=\"3、案例搭建\"><a href=\"#3、案例搭建\" class=\"headerlink\" title=\"3、案例搭建\"></a>3、案例搭建</h2><p>使用maven构建基本工程结构</p>\n<h3 id=\"3-1-创建web项目\"><a href=\"#3-1-创建web项目\" class=\"headerlink\" title=\"3.1 创建web项目\"></a>3.1 创建web项目</h3><h3 id=\"3-2-设置jdk版本及servlet环境\"><a href=\"#3-2-设置jdk版本及servlet环境\" class=\"headerlink\" title=\"3.2 设置jdk版本及servlet环境\"></a>3.2 设置jdk版本及servlet环境</h3><p>细节参见<a href=\"https://www.zybuluo.com/MrXiao/note/772562\" target=\"_blank\" rel=\"noopener\">Maven学习与基本使用</a></p>\n<h3 id=\"3-3-导入jar包-设置pom\"><a href=\"#3-3-导入jar包-设置pom\" class=\"headerlink\" title=\"3.3 导入jar包,设置pom\"></a>3.3 导入jar包,设置pom</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.topvision.maven<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>ssm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>war<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>ssm Maven Webapp<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.apache.org<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 属性 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">spring.version</span>&gt;</span>4.3.12.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">spring.version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">mybatis.version</span>&gt;</span>3.4.5<span class=\"tag\">&lt;/<span class=\"name\">mybatis.version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 锁定版本 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aspects<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-orm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-webmvc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">            \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- Spring --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aspects<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-orm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-webmvc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>3.8.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mybatis --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-spring<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mysql驱动 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- c3p0 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- slf4j --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-log4j12<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- junit --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.9<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- jstl --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jstl<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- servlet jsp --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>servlet-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jsp-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">encoding</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>ssm<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"3-4-配置前端控制器\"><a href=\"#3-4-配置前端控制器\" class=\"headerlink\" title=\"3.4 配置前端控制器\"></a>3.4 配置前端控制器</h3><p>关键：在web.xml配置springmvc的前端控制器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://java.sun.com/xml/ns/javaee\"</span> <span class=\"attr\">xmlns:web</span>=<span class=\"string\">\"http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\"</span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\"</span></div><div class=\"line\">\t<span class=\"attr\">id</span>=<span class=\"string\">\"WebApp_ID\"</span> <span class=\"attr\">version</span>=<span class=\"string\">\"2.5\"</span>&gt;</div><div class=\"line\">\t</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">servlet</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>springDispatcherServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-class</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"comment\">&lt;!--若不配置此项，默认加载/WEB-INF/[servlet的名字]-servlet.xml--&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>contextConfigLocation<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:springmvc.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">load-on-startup</span>&gt;</span>1<span class=\"tag\">&lt;/<span class=\"name\">load-on-startup</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">servlet</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">servlet-mapping</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">servlet-name</span>&gt;</span>springDispatcherServlet<span class=\"tag\">&lt;/<span class=\"name\">servlet-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!--</span></div><div class=\"line\">\t\t*.action或*.do等等，以其结尾的url由springmvc来解析</div><div class=\"line\">\t\t/ 所有请求都由springmvc解析，单静态资源的请求（html,css,js）由其解析是不对的</div><div class=\"line\">\t\t/* 此种配置方式不对，当转到jsp页面，springmvc会去解析jsp页面路径地址，无法解析成功</div><div class=\"line\">\t\t--&gt;</div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>*.action<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">servlet-mapping</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"3-5-配置处理器映射器\"><a href=\"#3-5-配置处理器映射器\" class=\"headerlink\" title=\"3.5 配置处理器映射器\"></a>3.5 配置处理器映射器</h3><p>在3.4设置的地址下新建对应的xml文件，一般在classpath下新建springmvc.xml</p>\n<p>在springmvc.xml中配置处理器映射器。（有多种）</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span> <span class=\"attr\">xmlns:mvc</span>=<span class=\"string\">\"http://www.springframework.org/schema/mvc\"</span></div><div class=\"line\">\t<span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></div><div class=\"line\">\t<span class=\"attr\">xmlns:aop</span>=<span class=\"string\">\"http://www.springframework.org/schema/aop\"</span> <span class=\"attr\">xmlns:tx</span>=<span class=\"string\">\"http://www.springframework.org/schema/tx\"</span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans </span></div><div class=\"line\">\t\thttp://www.springframework.org/schema/beans/spring-beans-3.0.xsd </div><div class=\"line\">\t\thttp://www.springframework.org/schema/mvc </div><div class=\"line\">\t\thttp://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd </div><div class=\"line\">\t\thttp://www.springframework.org/schema/context </div><div class=\"line\">\t\thttp://www.springframework.org/schema/context/spring-context-3.0.xsd </div><div class=\"line\">\t\thttp://www.springframework.org/schema/aop </div><div class=\"line\">\t\thttp://www.springframework.org/schema/aop/spring-aop-3.0.xsd </div><div class=\"line\">\t\thttp://www.springframework.org/schema/tx </div><div class=\"line\">\t\thttp://www.springframework.org/schema/tx/spring-tx-3.0.xsd\"&gt;</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 处理器映射器,选择其中之一即可--&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!--根据handel的名字来匹配url--&gt;</span></div><div class=\"line\">\t    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping\"</span>/&gt;</span></div><div class=\"line\">\t    </div><div class=\"line\">\t    <span class=\"comment\">&lt;!--升级版--&gt;</span></div><div class=\"line\">\t    <span class=\"comment\">&lt;!--根据handel的id来匹配url--&gt;</span></div><div class=\"line\">\t    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.web.servlet.handler.SimpleUrlHandlerMapping\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"mappings\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">props</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">prop</span> <span class=\"attr\">key</span>=<span class=\"string\">\"/ItemsList2.action\"</span>&gt;</span>itemsController<span class=\"tag\">&lt;/<span class=\"name\">prop</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">prop</span> <span class=\"attr\">key</span>=<span class=\"string\">\"/ItemsList3.action\"</span>&gt;</span>itemsController<span class=\"tag\">&lt;/<span class=\"name\">prop</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">props</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"3-6-配置处理器适配器\"><a href=\"#3-6-配置处理器适配器\" class=\"headerlink\" title=\"3.6 配置处理器适配器\"></a>3.6 配置处理器适配器</h3><p>开发Handel必须按照处理器适配器接口规则去开发，先要确定使用哪个处理器适配器。<br>此处使用SimpleControllerHandlerAdapter。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 处理器适配器 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>通过源码分析得出：<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">supports</span><span class=\"params\">(Object handler)</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">return</span> (handler <span class=\"keyword\">instanceof</span> Controller);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>只要实现了Controller接口的bean，SimpleControllerHandlerAdapter都可以去执行。</p>\n<p>还有一个非注解适配器<strong><em>HttpRequestHandlerAdapter</em></strong>，只要实现<strong><em>HttpRequestHandler</em></strong>接口即可。</p>\n<h3 id=\"3-7-开发及配置Handel\"><a href=\"#3-7-开发及配置Handel\" class=\"headerlink\" title=\"3.7 开发及配置Handel\"></a>3.7 开发及配置Handel</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ItemsController1</span> <span class=\"keyword\">implements</span> <span class=\"title\">Controller</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">handleRequest</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// 调用service查询商品信息</span></div><div class=\"line\">        <span class=\"comment\">// 这里不调用service使用静态数据模拟</span></div><div class=\"line\">        List&lt;Items&gt; itemsList = <span class=\"keyword\">new</span> ArrayList&lt;Items&gt;();</div><div class=\"line\"></div><div class=\"line\">        Items items_2 = <span class=\"keyword\">new</span> Items();</div><div class=\"line\">        items_2.setName(<span class=\"string\">\"苹果手机\"</span>);</div><div class=\"line\">        items_2.setPrice(<span class=\"number\">9688f</span>);</div><div class=\"line\">        items_2.setDetail(<span class=\"string\">\"iphoneX苹果手机！\"</span>);</div><div class=\"line\"></div><div class=\"line\">        itemsList.add(items_1);</div><div class=\"line\">        itemsList.add(items_2);</div><div class=\"line\">        </div><div class=\"line\">        ModelAndView modelAndView = <span class=\"keyword\">new</span> ModelAndView();</div><div class=\"line\">        <span class=\"comment\">//此方法相当于request.setAttribute(arg0, arg1)</span></div><div class=\"line\">        modelAndView.addObject(itemsList);</div><div class=\"line\">        <span class=\"comment\">//指定视图地址</span></div><div class=\"line\">        modelAndView.setViewName(<span class=\"string\">\"/WEB-INF/jsp/itemsList.jsp\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> modelAndView;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"3-8-配置视图解析器\"><a href=\"#3-8-配置视图解析器\" class=\"headerlink\" title=\"3.8 配置视图解析器\"></a>3.8 配置视图解析器</h3><p>使用jsp视图解析器，在springmvc.xml中配置如下：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- ViewResolver --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.web.servlet.view.InternalResourceViewResolver\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!--设置统一的前后缀--&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"prefix\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"/WEB-INF/jsp/\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"suffix\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\".jsp\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>更改Handle代码，使用逻辑视图名:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//指定视图地址</span></div><div class=\"line\"><span class=\"comment\">//modelAndView.setViewName(\"/WEB-INF/jsp/itemsList.jsp\");</span></div><div class=\"line\">modelAndView.setViewName(<span class=\"string\">\"itemList\"</span>);</div></pre></td></tr></table></figure>\n<h3 id=\"3-9-配置jsp视图\"><a href=\"#3-9-配置jsp视图\" class=\"headerlink\" title=\"3.9 配置jsp视图\"></a>3.9 配置jsp视图</h3><p>在web-inf/jsp下，创建itemList.jsp</p>\n<h2 id=\"4、注解开发\"><a href=\"#4、注解开发\" class=\"headerlink\" title=\"4、注解开发\"></a>4、注解开发</h2><h3 id=\"4-1-注解的处理器映射器和适配器\"><a href=\"#4-1-注解的处理器映射器和适配器\" class=\"headerlink\" title=\"4.1 注解的处理器映射器和适配器\"></a>4.1 注解的处理器映射器和适配器</h3><p>注解的处理器映射器：<br>spring3.1之前使用org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping<br>spring3.1之后使用org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;</p>\n<p>注解的处理器适配器：<br>spring3.1之前使用<br>org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter<br>3.1之后使用<br>org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter</p>\n<p>在springmvc.xml中配置：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 注解的处理器映射器和适配器 --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- </span></div><div class=\"line\">&lt;bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping\"/&gt;</div><div class=\"line\">&lt;bean class=\"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter\" /&gt;</div><div class=\"line\">--&gt;</div><div class=\"line\"><span class=\"comment\">&lt;!-- 简写 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mvc:annotation-driven</span>/&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"4-2-注解开发Handle\"><a href=\"#4-2-注解开发Handle\" class=\"headerlink\" title=\"4.2 注解开发Handle\"></a>4.2 注解开发Handle</h3><p>注解处理器映射器和注解处理器适配器要配对使用，对标记@controller注解类中的标记有@RequestMapping方法进行映射和执行。<br>@controller标记此类是一个控制器<br>@RequestMapping：对url和Handler中的方法进行映射。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Controller</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ItemsController2</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/itemsList4\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">itemList4</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// 调用service查询商品信息</span></div><div class=\"line\">        <span class=\"comment\">// 这里不调用service使用静态数据模拟</span></div><div class=\"line\">        List&lt;Items&gt; itemsList = <span class=\"keyword\">new</span> ArrayList&lt;Items&gt;();</div><div class=\"line\"></div><div class=\"line\">        Items items_1 = <span class=\"keyword\">new</span> Items();</div><div class=\"line\">        items_1.setName(<span class=\"string\">\"联想笔记本\"</span>);</div><div class=\"line\">        items_1.setPrice(<span class=\"number\">6000f</span>);</div><div class=\"line\">        items_1.setDetail(<span class=\"string\">\"ThinkPad T430 联想笔记本电脑！\"</span>);</div><div class=\"line\"></div><div class=\"line\">        Items items_2 = <span class=\"keyword\">new</span> Items();</div><div class=\"line\">        items_2.setName(<span class=\"string\">\"苹果手机\"</span>);</div><div class=\"line\">        items_2.setPrice(<span class=\"number\">5000f</span>);</div><div class=\"line\">        items_2.setDetail(<span class=\"string\">\"iphone6苹果手机！\"</span>);</div><div class=\"line\"></div><div class=\"line\">        itemsList.add(items_1);</div><div class=\"line\">        itemsList.add(items_2);</div><div class=\"line\"></div><div class=\"line\">        ModelAndView modelAndView = <span class=\"keyword\">new</span> ModelAndView();</div><div class=\"line\">        <span class=\"comment\">// 此方法相当于request.setAttribute(arg0, arg1)</span></div><div class=\"line\">        modelAndView.addObject(itemsList);</div><div class=\"line\">        <span class=\"comment\">// 指定视图地址</span></div><div class=\"line\">        <span class=\"comment\">// modelAndView.setViewName(\"/WEB-INF/jsp/itemsList.jsp\");</span></div><div class=\"line\">        modelAndView.setViewName(<span class=\"string\">\"itemsList\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> modelAndView;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"4-3-在spring容器中配置Handle\"><a href=\"#4-3-在spring容器中配置Handle\" class=\"headerlink\" title=\"4.3 在spring容器中配置Handle\"></a>4.3 在spring容器中配置Handle</h3><p>为方便配置，采用注解扫描的方式。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 可以扫描标记有@controller、@service、@repository、@component的bean --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.ssm\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">context:component-scan</span>&gt;</span></div></pre></td></tr></table></figure>"},{"title":"Struts2(5)——拦截器","date":"2017-12-21T07:41:25.000Z","_content":"\n## 1、简介\n\nstruts2中很多的核心功能都是拦截器完成的。比如：params(封装动态参数)、staticParams（静态参数封装）、i18n(国际化)、modelDrivern（模型驱动）、servletConfig（注入servletAPI）等。\n<font color=\"red\">作用：在执行动作前或后进行拦截</font>\n<!-- more -->\n\n```xml\n<default-interceptor-ref name=\"defaultStack\"/>\n```\n```xml\n<interceptor-stack name=\"defaultStack\">\n    <interceptor-ref name=\"exception\"/>\n    <interceptor-ref name=\"alias\"/>\n    <interceptor-ref name=\"servletConfig\"/>\n    <interceptor-ref name=\"i18n\"/>\n    <interceptor-ref name=\"prepare\"/>\n    <interceptor-ref name=\"chain\"/>\n    <interceptor-ref name=\"scopedModelDriven\"/>\n    <interceptor-ref name=\"modelDriven\"/>\n    <interceptor-ref name=\"fileUpload\"/>\n    <interceptor-ref name=\"checkbox\"/>\n    <interceptor-ref name=\"datetime\"/>\n    <interceptor-ref name=\"multiselect\"/>\n    <interceptor-ref name=\"staticParams\"/>\n    <interceptor-ref name=\"actionMappingParams\"/>\n    <interceptor-ref name=\"params\"/>\n    <interceptor-ref name=\"conversionError\"/>\n    <interceptor-ref name=\"validation\">\n        <param name=\"excludeMethods\">input,back,cancel,browse</param>\n    </interceptor-ref>\n    <interceptor-ref name=\"workflow\">\n        <param name=\"excludeMethods\">input,back,cancel,browse</param>\n    </interceptor-ref>\n    <interceptor-ref name=\"debugging\"/>\n    <interceptor-ref name=\"deprecation\"/>\n</interceptor-stack>\n```\n\n## 2、运作图\n![此处输入图片的描述][1]\n\n结论：\n    动作方法执行前：拦截器会按照顺序依次进行拦截\n    执行动作方法\n    返回结果视图\n拦截器会按照原来的顺序的相反顺序再次进行拦截\n\n执行过程中：ActionInvocation保存了需要用到的数据\n\n\n## 3、自定义拦截器\n熟悉拦截器的体系：所有的拦截器都直接或间接的实现了Interceptor接口\n\n![此处输入图片的描述][2]\n\n### 3.1 创建拦截器类，继承AbstractInterceptor或实现Interceotor\n\n```java\npublic class MyInterceptor extends AbstractInterceptor {\n\n    private static final long serialVersionUID = -828084112876621948L;\n\n    @Override\n    public String intercept(ActionInvocation invocation) throws Exception {\n        System.out.println(\"MyInterceptor拦截前\");\n        String invoke = invocation.invoke();//放行\n        System.out.println(\"MyInterceptor拦截后\");\n        return invoke;\n    }\n}\n```\n    \n### 3.2 注册拦截器\n\n在struts.xml中注册拦截器，可以针对单个action配置，也可全局配置\n    \n\n 1. 针对单个action配置\n\n    首先在package中声明拦截器\n    ```xml\n    <interceptors>\n    \t\t<interceptor name=\"myInterceptor\" class=\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"></interceptor>\n    </interceptors>\n    ```\n    然后在action中声明引用该拦截器\n    ```xml\n    <action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n\t\t<!-- \n\t\t\t如果没有声明拦截器，默认使用struts-default.xml中的defaultStack\n\t\t\t如果声明了，则defaultStack失效\n\t\t -->\n\t\t<interceptor-ref name=\"myInterceptor\"></interceptor-ref>\n\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t\t<result name=\"input\">/error.jsp</result>\n\t</action>\n    ```\n    但是一般不用这种，因为Struts2有这么一种机制，一旦为Action指定了拦截器，那么就不会再为这个Action执行默认拦截器了，即defaultStack这个拦截器栈中的拦截器都不会执行，也就是说，这个Action没有输入校验、没有参数注入、没有国际化、没有…，这是不行的，所以我们需要在这个<action>元素中再引用defaultStack拦截器栈。\n    \n 2. 全局配置（常用）\n\n    创建一个拦截器栈，包含默认拦截器栈和自定义拦截器。\n\n    ```xml\n    <package name=\"default\" extends=\"struts-default\">\n    \t<interceptors>\n\t    \t<!-- 自定义拦截器 -->\n    \t\t<interceptor name=\"myInterceptor\" class=\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"></interceptor>\n    \t\t<!-- 自定义拦截器栈 -->\n    \t\t<interceptor-stack name=\"myStack\">\n    \t\t\t<interceptor-ref name=\"defaultStack\"/>\n    \t\t\t<interceptor-ref name=\"myInterceptor\"/>\n    \t\t</interceptor-stack>\n    \t</interceptors>\n    \t<!-- 指定默认拦截器 -->\n    \t<default-interceptor-ref name=\"myStack\"></default-interceptor-ref>\n    ```\n\n## 4、MethodFilterInterceptor\n\n是AbstractInterceptor的子类：\nsetIncludeMethods(String includeMethods):设置需要拦截的方法，多个方法用逗号分隔\nsetExcludeMethods(String excludeMethods):设置不需要拦截的方法，多个方法用逗号分隔\n\n \n```java\npublic class MethodInterDemo extends MethodFilterInterceptor{\n\n    private static final long serialVersionUID = -9060068603523571867L;\n    \n    @Override\n    protected String doIntercept(ActionInvocation invocation) throws Exception {\n        //拦截前操作\n        String invoke = invocation.invoke();\n        //拦截后操作\n        return invoke;\n    }\n\n}\n```\n\n配置xml\n```xml\n<package name=\"default\" extends=\"struts-default\">\n\t<interceptors>\n    \t<!-- 自定义拦截器 -->\n\t\t<interceptor name=\"myInterceptor\" class=\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"></interceptor>\n\t\t<interceptor name=\"methodInterceptor\" class=\"com.topvision.s2sm.plantform.interceptor.MethodInterDemo\"></interceptor>\n\t\t\n\t\t<!-- 自定义拦截器栈 -->\n\t\t<interceptor-stack name=\"myStack\">\n\t\t\t<interceptor-ref name=\"defaultStack\"/>\n\t\t\t<interceptor-ref name=\"myInterceptor\"/>\n\t\t\t<interceptor-ref name=\"methodInterceptor\"/>\n\t\t</interceptor-stack>\n\t</interceptors>\n\t<!-- 指定默认拦截器 -->\n\t<default-interceptor-ref name=\"myStack\"></default-interceptor-ref>\n\n</package>\n```\n\n设置指定action\n\n```xml\n<package name=\"login\" namespace=\"/\" extends=\"default\">\n\t<action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n\t\t<interceptor-ref name=\"myStack\">\n\t\t\t<!-- 设置不需要methodInterDemo拦截的方法 -->\n\t\t\t<param name=\"methodInterDemo.excludeMethods\">loginTest</param>\n\t\t\t<!-- 设置需要methodInterDemo拦截的方法 -->\n\t\t\t<param name=\"methodInterDemo.includeMethods\">aaa</param>\n\t\t</interceptor-ref>\n\t\t\n\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t\t<result name=\"input\">/error.jsp</result>\n\t</action>\n</package>\n```\n\n \n\n \n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts2.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/Interceptor.png","source":"_posts/Struts2-5-——拦截器.md","raw":"---\ntitle: Struts2(5)——拦截器\ncategories:\n  - Struts2\ntags:\n  - Struts2\ndate: 2017-12-21 15:41:25\n---\n\n## 1、简介\n\nstruts2中很多的核心功能都是拦截器完成的。比如：params(封装动态参数)、staticParams（静态参数封装）、i18n(国际化)、modelDrivern（模型驱动）、servletConfig（注入servletAPI）等。\n<font color=\"red\">作用：在执行动作前或后进行拦截</font>\n<!-- more -->\n\n```xml\n<default-interceptor-ref name=\"defaultStack\"/>\n```\n```xml\n<interceptor-stack name=\"defaultStack\">\n    <interceptor-ref name=\"exception\"/>\n    <interceptor-ref name=\"alias\"/>\n    <interceptor-ref name=\"servletConfig\"/>\n    <interceptor-ref name=\"i18n\"/>\n    <interceptor-ref name=\"prepare\"/>\n    <interceptor-ref name=\"chain\"/>\n    <interceptor-ref name=\"scopedModelDriven\"/>\n    <interceptor-ref name=\"modelDriven\"/>\n    <interceptor-ref name=\"fileUpload\"/>\n    <interceptor-ref name=\"checkbox\"/>\n    <interceptor-ref name=\"datetime\"/>\n    <interceptor-ref name=\"multiselect\"/>\n    <interceptor-ref name=\"staticParams\"/>\n    <interceptor-ref name=\"actionMappingParams\"/>\n    <interceptor-ref name=\"params\"/>\n    <interceptor-ref name=\"conversionError\"/>\n    <interceptor-ref name=\"validation\">\n        <param name=\"excludeMethods\">input,back,cancel,browse</param>\n    </interceptor-ref>\n    <interceptor-ref name=\"workflow\">\n        <param name=\"excludeMethods\">input,back,cancel,browse</param>\n    </interceptor-ref>\n    <interceptor-ref name=\"debugging\"/>\n    <interceptor-ref name=\"deprecation\"/>\n</interceptor-stack>\n```\n\n## 2、运作图\n![此处输入图片的描述][1]\n\n结论：\n    动作方法执行前：拦截器会按照顺序依次进行拦截\n    执行动作方法\n    返回结果视图\n拦截器会按照原来的顺序的相反顺序再次进行拦截\n\n执行过程中：ActionInvocation保存了需要用到的数据\n\n\n## 3、自定义拦截器\n熟悉拦截器的体系：所有的拦截器都直接或间接的实现了Interceptor接口\n\n![此处输入图片的描述][2]\n\n### 3.1 创建拦截器类，继承AbstractInterceptor或实现Interceotor\n\n```java\npublic class MyInterceptor extends AbstractInterceptor {\n\n    private static final long serialVersionUID = -828084112876621948L;\n\n    @Override\n    public String intercept(ActionInvocation invocation) throws Exception {\n        System.out.println(\"MyInterceptor拦截前\");\n        String invoke = invocation.invoke();//放行\n        System.out.println(\"MyInterceptor拦截后\");\n        return invoke;\n    }\n}\n```\n    \n### 3.2 注册拦截器\n\n在struts.xml中注册拦截器，可以针对单个action配置，也可全局配置\n    \n\n 1. 针对单个action配置\n\n    首先在package中声明拦截器\n    ```xml\n    <interceptors>\n    \t\t<interceptor name=\"myInterceptor\" class=\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"></interceptor>\n    </interceptors>\n    ```\n    然后在action中声明引用该拦截器\n    ```xml\n    <action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n\t\t<!-- \n\t\t\t如果没有声明拦截器，默认使用struts-default.xml中的defaultStack\n\t\t\t如果声明了，则defaultStack失效\n\t\t -->\n\t\t<interceptor-ref name=\"myInterceptor\"></interceptor-ref>\n\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t\t<result name=\"input\">/error.jsp</result>\n\t</action>\n    ```\n    但是一般不用这种，因为Struts2有这么一种机制，一旦为Action指定了拦截器，那么就不会再为这个Action执行默认拦截器了，即defaultStack这个拦截器栈中的拦截器都不会执行，也就是说，这个Action没有输入校验、没有参数注入、没有国际化、没有…，这是不行的，所以我们需要在这个<action>元素中再引用defaultStack拦截器栈。\n    \n 2. 全局配置（常用）\n\n    创建一个拦截器栈，包含默认拦截器栈和自定义拦截器。\n\n    ```xml\n    <package name=\"default\" extends=\"struts-default\">\n    \t<interceptors>\n\t    \t<!-- 自定义拦截器 -->\n    \t\t<interceptor name=\"myInterceptor\" class=\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"></interceptor>\n    \t\t<!-- 自定义拦截器栈 -->\n    \t\t<interceptor-stack name=\"myStack\">\n    \t\t\t<interceptor-ref name=\"defaultStack\"/>\n    \t\t\t<interceptor-ref name=\"myInterceptor\"/>\n    \t\t</interceptor-stack>\n    \t</interceptors>\n    \t<!-- 指定默认拦截器 -->\n    \t<default-interceptor-ref name=\"myStack\"></default-interceptor-ref>\n    ```\n\n## 4、MethodFilterInterceptor\n\n是AbstractInterceptor的子类：\nsetIncludeMethods(String includeMethods):设置需要拦截的方法，多个方法用逗号分隔\nsetExcludeMethods(String excludeMethods):设置不需要拦截的方法，多个方法用逗号分隔\n\n \n```java\npublic class MethodInterDemo extends MethodFilterInterceptor{\n\n    private static final long serialVersionUID = -9060068603523571867L;\n    \n    @Override\n    protected String doIntercept(ActionInvocation invocation) throws Exception {\n        //拦截前操作\n        String invoke = invocation.invoke();\n        //拦截后操作\n        return invoke;\n    }\n\n}\n```\n\n配置xml\n```xml\n<package name=\"default\" extends=\"struts-default\">\n\t<interceptors>\n    \t<!-- 自定义拦截器 -->\n\t\t<interceptor name=\"myInterceptor\" class=\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"></interceptor>\n\t\t<interceptor name=\"methodInterceptor\" class=\"com.topvision.s2sm.plantform.interceptor.MethodInterDemo\"></interceptor>\n\t\t\n\t\t<!-- 自定义拦截器栈 -->\n\t\t<interceptor-stack name=\"myStack\">\n\t\t\t<interceptor-ref name=\"defaultStack\"/>\n\t\t\t<interceptor-ref name=\"myInterceptor\"/>\n\t\t\t<interceptor-ref name=\"methodInterceptor\"/>\n\t\t</interceptor-stack>\n\t</interceptors>\n\t<!-- 指定默认拦截器 -->\n\t<default-interceptor-ref name=\"myStack\"></default-interceptor-ref>\n\n</package>\n```\n\n设置指定action\n\n```xml\n<package name=\"login\" namespace=\"/\" extends=\"default\">\n\t<action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n\t\t<interceptor-ref name=\"myStack\">\n\t\t\t<!-- 设置不需要methodInterDemo拦截的方法 -->\n\t\t\t<param name=\"methodInterDemo.excludeMethods\">loginTest</param>\n\t\t\t<!-- 设置需要methodInterDemo拦截的方法 -->\n\t\t\t<param name=\"methodInterDemo.includeMethods\">aaa</param>\n\t\t</interceptor-ref>\n\t\t\n\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t\t<result name=\"input\">/error.jsp</result>\n\t</action>\n</package>\n```\n\n \n\n \n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts2.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/Interceptor.png","slug":"Struts2-5-——拦截器","published":1,"updated":"2018-02-27T07:38:38.095Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfuu0034hwvfncgz38xd","content":"<h2 id=\"1、简介\"><a href=\"#1、简介\" class=\"headerlink\" title=\"1、简介\"></a>1、简介</h2><p>struts2中很多的核心功能都是拦截器完成的。比如：params(封装动态参数)、staticParams（静态参数封装）、i18n(国际化)、modelDrivern（模型驱动）、servletConfig（注入servletAPI）等。</p>\n<p><font color=\"red\">作用：在执行动作前或后进行拦截</font><br><a id=\"more\"></a></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">default-interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"defaultStack\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">interceptor-stack</span> <span class=\"attr\">name</span>=<span class=\"string\">\"defaultStack\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"exception\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"alias\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"servletConfig\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"i18n\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"prepare\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"chain\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"scopedModelDriven\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"modelDriven\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"fileUpload\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"checkbox\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"datetime\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"multiselect\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"staticParams\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"actionMappingParams\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"params\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"conversionError\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"validation\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"excludeMethods\"</span>&gt;</span>input,back,cancel,browse<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">interceptor-ref</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"workflow\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"excludeMethods\"</span>&gt;</span>input,back,cancel,browse<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">interceptor-ref</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"debugging\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"deprecation\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">interceptor-stack</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"2、运作图\"><a href=\"#2、运作图\" class=\"headerlink\" title=\"2、运作图\"></a>2、运作图</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts2.png\" alt=\"此处输入图片的描述\"></p>\n<p>结论：<br>    动作方法执行前：拦截器会按照顺序依次进行拦截<br>    执行动作方法<br>    返回结果视图<br>拦截器会按照原来的顺序的相反顺序再次进行拦截</p>\n<p>执行过程中：ActionInvocation保存了需要用到的数据</p>\n<h2 id=\"3、自定义拦截器\"><a href=\"#3、自定义拦截器\" class=\"headerlink\" title=\"3、自定义拦截器\"></a>3、自定义拦截器</h2><p>熟悉拦截器的体系：所有的拦截器都直接或间接的实现了Interceptor接口</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/Interceptor.png\" alt=\"此处输入图片的描述\"></p>\n<h3 id=\"3-1-创建拦截器类，继承AbstractInterceptor或实现Interceotor\"><a href=\"#3-1-创建拦截器类，继承AbstractInterceptor或实现Interceotor\" class=\"headerlink\" title=\"3.1 创建拦截器类，继承AbstractInterceptor或实现Interceotor\"></a>3.1 创建拦截器类，继承AbstractInterceptor或实现Interceotor</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyInterceptor</span> <span class=\"keyword\">extends</span> <span class=\"title\">AbstractInterceptor</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">828084112876621948L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">intercept</span><span class=\"params\">(ActionInvocation invocation)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"MyInterceptor拦截前\"</span>);</div><div class=\"line\">        String invoke = invocation.invoke();<span class=\"comment\">//放行</span></div><div class=\"line\">        System.out.println(<span class=\"string\">\"MyInterceptor拦截后\"</span>);</div><div class=\"line\">        <span class=\"keyword\">return</span> invoke;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"3-2-注册拦截器\"><a href=\"#3-2-注册拦截器\" class=\"headerlink\" title=\"3.2 注册拦截器\"></a>3.2 注册拦截器</h3><p>在struts.xml中注册拦截器，可以针对单个action配置，也可全局配置</p>\n<ol>\n<li><p>针对单个action配置</p>\n<p>首先在package中声明拦截器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">interceptors</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>然后在action中声明引用该拦截器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- </span></div><div class=\"line\">\t\t如果没有声明拦截器，默认使用struts-default.xml中的defaultStack</div><div class=\"line\">\t\t如果声明了，则defaultStack失效</div><div class=\"line\">\t --&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor-ref</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">name</span>=<span class=\"string\">\"input\"</span>&gt;</span>/error.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>但是一般不用这种，因为Struts2有这么一种机制，一旦为Action指定了拦截器，那么就不会再为这个Action执行默认拦截器了，即defaultStack这个拦截器栈中的拦截器都不会执行，也就是说，这个Action没有输入校验、没有参数注入、没有国际化、没有…，这是不行的，所以我们需要在这个<action>元素中再引用defaultStack拦截器栈。</action></p>\n</li>\n<li><p>全局配置（常用）</p>\n<p>创建一个拦截器栈，包含默认拦截器栈和自定义拦截器。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"default\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\"> \t<span class=\"comment\">&lt;!-- 自定义拦截器 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 自定义拦截器栈 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-stack</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"defaultStack\"</span>/&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">interceptor-stack</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 指定默认拦截器 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">default-interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">default-interceptor-ref</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"4、MethodFilterInterceptor\"><a href=\"#4、MethodFilterInterceptor\" class=\"headerlink\" title=\"4、MethodFilterInterceptor\"></a>4、MethodFilterInterceptor</h2><p>是AbstractInterceptor的子类：<br>setIncludeMethods(String includeMethods):设置需要拦截的方法，多个方法用逗号分隔<br>setExcludeMethods(String excludeMethods):设置不需要拦截的方法，多个方法用逗号分隔</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MethodInterDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">MethodFilterInterceptor</span></span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">9060068603523571867L</span>;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> String <span class=\"title\">doIntercept</span><span class=\"params\">(ActionInvocation invocation)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//拦截前操作</span></div><div class=\"line\">        String invoke = invocation.invoke();</div><div class=\"line\">        <span class=\"comment\">//拦截后操作</span></div><div class=\"line\">        <span class=\"keyword\">return</span> invoke;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>配置xml<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"default\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\">    \t<span class=\"comment\">&lt;!-- 自定义拦截器 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor</span> <span class=\"attr\">name</span>=<span class=\"string\">\"methodInterceptor\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.plantform.interceptor.MethodInterDemo\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 自定义拦截器栈 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-stack</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"defaultStack\"</span>/&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span>/&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"methodInterceptor\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">interceptor-stack</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 指定默认拦截器 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">default-interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">default-interceptor-ref</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>设置指定action</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"login\"</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"/\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 设置不需要methodInterDemo拦截的方法 --&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"methodInterDemo.excludeMethods\"</span>&gt;</span>loginTest<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 设置需要methodInterDemo拦截的方法 --&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"methodInterDemo.includeMethods\"</span>&gt;</span>aaa<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">interceptor-ref</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">name</span>=<span class=\"string\">\"input\"</span>&gt;</span>/error.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div></pre></td></tr></table></figure>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<h2 id=\"1、简介\"><a href=\"#1、简介\" class=\"headerlink\" title=\"1、简介\"></a>1、简介</h2><p>struts2中很多的核心功能都是拦截器完成的。比如：params(封装动态参数)、staticParams（静态参数封装）、i18n(国际化)、modelDrivern（模型驱动）、servletConfig（注入servletAPI）等。</p>\n<p><font color=\"red\">作用：在执行动作前或后进行拦截</font><br>","more":"</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">default-interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"defaultStack\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">interceptor-stack</span> <span class=\"attr\">name</span>=<span class=\"string\">\"defaultStack\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"exception\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"alias\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"servletConfig\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"i18n\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"prepare\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"chain\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"scopedModelDriven\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"modelDriven\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"fileUpload\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"checkbox\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"datetime\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"multiselect\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"staticParams\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"actionMappingParams\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"params\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"conversionError\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"validation\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"excludeMethods\"</span>&gt;</span>input,back,cancel,browse<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">interceptor-ref</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"workflow\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"excludeMethods\"</span>&gt;</span>input,back,cancel,browse<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">interceptor-ref</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"debugging\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"deprecation\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">interceptor-stack</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"2、运作图\"><a href=\"#2、运作图\" class=\"headerlink\" title=\"2、运作图\"></a>2、运作图</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/struts2.png\" alt=\"此处输入图片的描述\"></p>\n<p>结论：<br>    动作方法执行前：拦截器会按照顺序依次进行拦截<br>    执行动作方法<br>    返回结果视图<br>拦截器会按照原来的顺序的相反顺序再次进行拦截</p>\n<p>执行过程中：ActionInvocation保存了需要用到的数据</p>\n<h2 id=\"3、自定义拦截器\"><a href=\"#3、自定义拦截器\" class=\"headerlink\" title=\"3、自定义拦截器\"></a>3、自定义拦截器</h2><p>熟悉拦截器的体系：所有的拦截器都直接或间接的实现了Interceptor接口</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/Interceptor.png\" alt=\"此处输入图片的描述\"></p>\n<h3 id=\"3-1-创建拦截器类，继承AbstractInterceptor或实现Interceotor\"><a href=\"#3-1-创建拦截器类，继承AbstractInterceptor或实现Interceotor\" class=\"headerlink\" title=\"3.1 创建拦截器类，继承AbstractInterceptor或实现Interceotor\"></a>3.1 创建拦截器类，继承AbstractInterceptor或实现Interceotor</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyInterceptor</span> <span class=\"keyword\">extends</span> <span class=\"title\">AbstractInterceptor</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">828084112876621948L</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">intercept</span><span class=\"params\">(ActionInvocation invocation)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"MyInterceptor拦截前\"</span>);</div><div class=\"line\">        String invoke = invocation.invoke();<span class=\"comment\">//放行</span></div><div class=\"line\">        System.out.println(<span class=\"string\">\"MyInterceptor拦截后\"</span>);</div><div class=\"line\">        <span class=\"keyword\">return</span> invoke;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"3-2-注册拦截器\"><a href=\"#3-2-注册拦截器\" class=\"headerlink\" title=\"3.2 注册拦截器\"></a>3.2 注册拦截器</h3><p>在struts.xml中注册拦截器，可以针对单个action配置，也可全局配置</p>\n<ol>\n<li><p>针对单个action配置</p>\n<p>首先在package中声明拦截器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">interceptors</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>然后在action中声明引用该拦截器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- </span></div><div class=\"line\">\t\t如果没有声明拦截器，默认使用struts-default.xml中的defaultStack</div><div class=\"line\">\t\t如果声明了，则defaultStack失效</div><div class=\"line\">\t --&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor-ref</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">name</span>=<span class=\"string\">\"input\"</span>&gt;</span>/error.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>但是一般不用这种，因为Struts2有这么一种机制，一旦为Action指定了拦截器，那么就不会再为这个Action执行默认拦截器了，即defaultStack这个拦截器栈中的拦截器都不会执行，也就是说，这个Action没有输入校验、没有参数注入、没有国际化、没有…，这是不行的，所以我们需要在这个<action>元素中再引用defaultStack拦截器栈。</action></p>\n</li>\n<li><p>全局配置（常用）</p>\n<p>创建一个拦截器栈，包含默认拦截器栈和自定义拦截器。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"default\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\"> \t<span class=\"comment\">&lt;!-- 自定义拦截器 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 自定义拦截器栈 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-stack</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"defaultStack\"</span>/&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">interceptor-stack</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 指定默认拦截器 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">default-interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">default-interceptor-ref</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"4、MethodFilterInterceptor\"><a href=\"#4、MethodFilterInterceptor\" class=\"headerlink\" title=\"4、MethodFilterInterceptor\"></a>4、MethodFilterInterceptor</h2><p>是AbstractInterceptor的子类：<br>setIncludeMethods(String includeMethods):设置需要拦截的方法，多个方法用逗号分隔<br>setExcludeMethods(String excludeMethods):设置不需要拦截的方法，多个方法用逗号分隔</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MethodInterDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">MethodFilterInterceptor</span></span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">9060068603523571867L</span>;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">protected</span> String <span class=\"title\">doIntercept</span><span class=\"params\">(ActionInvocation invocation)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//拦截前操作</span></div><div class=\"line\">        String invoke = invocation.invoke();</div><div class=\"line\">        <span class=\"comment\">//拦截后操作</span></div><div class=\"line\">        <span class=\"keyword\">return</span> invoke;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>配置xml<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"default\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\">    \t<span class=\"comment\">&lt;!-- 自定义拦截器 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.plantform.interceptor.MyInterceptor\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor</span> <span class=\"attr\">name</span>=<span class=\"string\">\"methodInterceptor\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.plantform.interceptor.MethodInterDemo\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">interceptor</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 自定义拦截器栈 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-stack</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"defaultStack\"</span>/&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myInterceptor\"</span>/&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"methodInterceptor\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">interceptor-stack</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">interceptors</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 指定默认拦截器 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">default-interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">default-interceptor-ref</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<p>设置指定action</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"login\"</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"/\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">interceptor-ref</span> <span class=\"attr\">name</span>=<span class=\"string\">\"myStack\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 设置不需要methodInterDemo拦截的方法 --&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"methodInterDemo.excludeMethods\"</span>&gt;</span>loginTest<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- 设置需要methodInterDemo拦截的方法 --&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"methodInterDemo.includeMethods\"</span>&gt;</span>aaa<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">interceptor-ref</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">name</span>=<span class=\"string\">\"input\"</span>&gt;</span>/error.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div></pre></td></tr></table></figure>"},{"title":"Struts2(6)——Struts标签、国际化、文件上传下载","date":"2017-12-21T12:35:45.000Z","_content":"\nstruts2标签的使用，国际化及文件上传下载。\n<!-- more -->\n## 1、struts标签\n\n[Struts2标签库常用标签][1]\n\n## 2、国际化 \n\nStruts2在ActionSupport中为我们提供了getText()来获取国际化value.\n\n### 2.1 定义资源包\n\n 1. 全局资源\n \n    创建资源文件\n\n        格式：基本名称_语言_国家.properties　\n        例如：resources_zh_CN.properties\n              resources_en_US.properties\n    \n    指定文在所在位置及文件名\n    ```xml\n     <!-- 国际化资源文件路径及名称 -->\n    <constant name=\"struts.custom.i18n.resources\"\n        value=\"com/topvision/s2sm/resources\" />\n    ```\n    \n 2. 包范围\n\n    在包下创建资源文件，不用在xml中指定文件路径\n    \n        文件名：package_zh_CN.properties\n                package_zh_CN.properties\n    \n  3. Action范围\n    \n    在Action同级目录创建资源文件，不用在xml中指定文件路径。\n\n        文件名：ActionName_zh_CN.properties\n        ActionName是对应action的名字\n        \n### 2.2 获取资源包内容\n\n获取国际化\n    \n   \n\n -  Action： this.getText(key)\n -  Jsp: 使用<s:text/>标签， <s:text name=\"key\" />\n -  配置文件:key(直接使用国际化配置文件中的key值即可获得)\n\n自由选择消息资源包\n\n```xml\n<!--自己随意指定消息资源包-->\n<s:i18n name=\"com/topvision/package\">\n    <s:text name=\"key\"></s:text>\n</s:i18n>\n```\n\n## 3、文件上传下载\n\n### 3.1 上传\n\nStruts2上传对表单有要求：\n\n 1. post提交\n 2. 表单的enctype必须为multipart/form-data\n 3. 表单提供如下类型的input\n \n    ```jsp\n    <input type=\"file\" name=\"name\"/>\n    ```\n\nStruts2中如何实现文件上传的：\n\n 1. 借助一个fileUpload拦截器完成的；\n 2. 最底层的还是借助的commons-fileupload这个组件；\n\n\n单文件上传\n\n 1. 准备表单\n\n    ```jsp\n    <form action=\"aaa/upload.tv\" method=\"post\" enctype=\"multipart/form-data\">\n    \t<input type=\"file\" name=\"upload\">\n    \t<button type=\"submit\">上传</button>\n    </form>\n    ```\n    \n 2. action\n\n    ```java\n    private File upload;//input标签的name属性\n    private String uploadFileName; //name属性+FileName\n    private String uploadContentType;//name属性+ContentType\n    \n    public String upload() throws IOException {\n        ServletContext servletContext = ServletActionContext.getServletContext();\n        String realPath = servletContext.getRealPath(\"/WEB-INF/file\");\n        File file = new File(realPath);\n        if (!file.exists()) {\n            file.mkdirs();\n        }\n        \n        /*InputStream is = new FileInputStream(upload);\n        OutputStream os = new FileOutputStream(new File(file, uploadFileName));\n        \n        int len = -1;\n        byte b[] = new byte[1024];\n        while ((len = is.read(b)) != -1) {\n            os.write(b, 0, len);\n        }*/\n        \n        FileUtils.moveFile(upload, new File(file, uploadFileName));\n        \n        is.close();\n        os.close();\n        \n        return SUCCESS;\n    }\n    ```\n\n  3. 配置xml\n\n    ```xml\n    <action name=\"upload\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"upload2\">\n\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t</action>\n    ```\n      \n \n    \n\n\n多文件上传\n\n第一种，比较煞笔的，多写几个上传框\n第二种:使用　uploadify 插件\n \n### 3.2 下载\n\naction配置\n\n```java\nprivate InputStream inputStream;\npublic String download() throws FileNotFoundException {\n    ServletContext servletContext = ServletActionContext.getServletContext();\n    String realPath = servletContext.getRealPath(\"/WEB-INF/web.xml\");\n    inputStream = new FileInputStream(realPath);\n    return SUCCESS;\n}\n\npublic InputStream getInputStream() {\n    return inputStream;\n}\npublic void setInputStream(InputStream inputStream) {\n    this.inputStream = inputStream;\n}\n```\n\nxml配置\n\n```xml\n<result name=\"success\" type=\"stream\">\n\t<!-- 设置输入流来源 -->\n\t<param name=\"inputstream\">inputstream</param>\n\t<!-- 响应头 -->\n\t<param name=\"contentDisposition\">attachment;filename=web.xml</param>\n\t<!-- 传的什么类型数据，在tomcat的web.xml中有定义 -->\n\t<param name=\"contentType\">application/xml</param>\t\n\t<!-- 下载缓存 ,默认1024-->\t\t\t\n\t<param name=\"bufferSize\">10240</param>\n\t<!-- 下载文件大小 -->\n\t<param name=\"contentLength\">10240</param>\n</result>\n```\n\n   \n \n  [1]: http://blog.csdn.net/q547550831/article/details/53326042\n\n\n\n\n","source":"_posts/Struts2-6-——Struts标签、国际化、文件上传下载.md","raw":"---\ntitle: Struts2(6)——Struts标签、国际化、文件上传下载\ncategories:\n  - Struts2\ntags:\n  - Struts2\ndate: 2017-12-21 20:35:45\n---\n\nstruts2标签的使用，国际化及文件上传下载。\n<!-- more -->\n## 1、struts标签\n\n[Struts2标签库常用标签][1]\n\n## 2、国际化 \n\nStruts2在ActionSupport中为我们提供了getText()来获取国际化value.\n\n### 2.1 定义资源包\n\n 1. 全局资源\n \n    创建资源文件\n\n        格式：基本名称_语言_国家.properties　\n        例如：resources_zh_CN.properties\n              resources_en_US.properties\n    \n    指定文在所在位置及文件名\n    ```xml\n     <!-- 国际化资源文件路径及名称 -->\n    <constant name=\"struts.custom.i18n.resources\"\n        value=\"com/topvision/s2sm/resources\" />\n    ```\n    \n 2. 包范围\n\n    在包下创建资源文件，不用在xml中指定文件路径\n    \n        文件名：package_zh_CN.properties\n                package_zh_CN.properties\n    \n  3. Action范围\n    \n    在Action同级目录创建资源文件，不用在xml中指定文件路径。\n\n        文件名：ActionName_zh_CN.properties\n        ActionName是对应action的名字\n        \n### 2.2 获取资源包内容\n\n获取国际化\n    \n   \n\n -  Action： this.getText(key)\n -  Jsp: 使用<s:text/>标签， <s:text name=\"key\" />\n -  配置文件:key(直接使用国际化配置文件中的key值即可获得)\n\n自由选择消息资源包\n\n```xml\n<!--自己随意指定消息资源包-->\n<s:i18n name=\"com/topvision/package\">\n    <s:text name=\"key\"></s:text>\n</s:i18n>\n```\n\n## 3、文件上传下载\n\n### 3.1 上传\n\nStruts2上传对表单有要求：\n\n 1. post提交\n 2. 表单的enctype必须为multipart/form-data\n 3. 表单提供如下类型的input\n \n    ```jsp\n    <input type=\"file\" name=\"name\"/>\n    ```\n\nStruts2中如何实现文件上传的：\n\n 1. 借助一个fileUpload拦截器完成的；\n 2. 最底层的还是借助的commons-fileupload这个组件；\n\n\n单文件上传\n\n 1. 准备表单\n\n    ```jsp\n    <form action=\"aaa/upload.tv\" method=\"post\" enctype=\"multipart/form-data\">\n    \t<input type=\"file\" name=\"upload\">\n    \t<button type=\"submit\">上传</button>\n    </form>\n    ```\n    \n 2. action\n\n    ```java\n    private File upload;//input标签的name属性\n    private String uploadFileName; //name属性+FileName\n    private String uploadContentType;//name属性+ContentType\n    \n    public String upload() throws IOException {\n        ServletContext servletContext = ServletActionContext.getServletContext();\n        String realPath = servletContext.getRealPath(\"/WEB-INF/file\");\n        File file = new File(realPath);\n        if (!file.exists()) {\n            file.mkdirs();\n        }\n        \n        /*InputStream is = new FileInputStream(upload);\n        OutputStream os = new FileOutputStream(new File(file, uploadFileName));\n        \n        int len = -1;\n        byte b[] = new byte[1024];\n        while ((len = is.read(b)) != -1) {\n            os.write(b, 0, len);\n        }*/\n        \n        FileUtils.moveFile(upload, new File(file, uploadFileName));\n        \n        is.close();\n        os.close();\n        \n        return SUCCESS;\n    }\n    ```\n\n  3. 配置xml\n\n    ```xml\n    <action name=\"upload\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"upload2\">\n\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t</action>\n    ```\n      \n \n    \n\n\n多文件上传\n\n第一种，比较煞笔的，多写几个上传框\n第二种:使用　uploadify 插件\n \n### 3.2 下载\n\naction配置\n\n```java\nprivate InputStream inputStream;\npublic String download() throws FileNotFoundException {\n    ServletContext servletContext = ServletActionContext.getServletContext();\n    String realPath = servletContext.getRealPath(\"/WEB-INF/web.xml\");\n    inputStream = new FileInputStream(realPath);\n    return SUCCESS;\n}\n\npublic InputStream getInputStream() {\n    return inputStream;\n}\npublic void setInputStream(InputStream inputStream) {\n    this.inputStream = inputStream;\n}\n```\n\nxml配置\n\n```xml\n<result name=\"success\" type=\"stream\">\n\t<!-- 设置输入流来源 -->\n\t<param name=\"inputstream\">inputstream</param>\n\t<!-- 响应头 -->\n\t<param name=\"contentDisposition\">attachment;filename=web.xml</param>\n\t<!-- 传的什么类型数据，在tomcat的web.xml中有定义 -->\n\t<param name=\"contentType\">application/xml</param>\t\n\t<!-- 下载缓存 ,默认1024-->\t\t\t\n\t<param name=\"bufferSize\">10240</param>\n\t<!-- 下载文件大小 -->\n\t<param name=\"contentLength\">10240</param>\n</result>\n```\n\n   \n \n  [1]: http://blog.csdn.net/q547550831/article/details/53326042\n\n\n\n\n","slug":"Struts2-6-——Struts标签、国际化、文件上传下载","published":1,"updated":"2018-02-27T07:38:38.096Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfuv0037hwvfhhcwa5a5","content":"<p>struts2标签的使用，国际化及文件上传下载。<br><a id=\"more\"></a></p>\n<h2 id=\"1、struts标签\"><a href=\"#1、struts标签\" class=\"headerlink\" title=\"1、struts标签\"></a>1、struts标签</h2><p><a href=\"http://blog.csdn.net/q547550831/article/details/53326042\" target=\"_blank\" rel=\"noopener\">Struts2标签库常用标签</a></p>\n<h2 id=\"2、国际化\"><a href=\"#2、国际化\" class=\"headerlink\" title=\"2、国际化\"></a>2、国际化</h2><p>Struts2在ActionSupport中为我们提供了getText()来获取国际化value.</p>\n<h3 id=\"2-1-定义资源包\"><a href=\"#2-1-定义资源包\" class=\"headerlink\" title=\"2.1 定义资源包\"></a>2.1 定义资源包</h3><ol>\n<li><p>全局资源</p>\n<p>创建资源文件</p>\n<pre><code>格式：基本名称_语言_国家.properties　\n例如：resources_zh_CN.properties\n      resources_en_US.properties\n</code></pre><p>指定文在所在位置及文件名</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"comment\">&lt;!-- 国际化资源文件路径及名称 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.custom.i18n.resources\"</span></span></div><div class=\"line\">    <span class=\"attr\">value</span>=<span class=\"string\">\"com/topvision/s2sm/resources\"</span> /&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>包范围</p>\n<p>在包下创建资源文件，不用在xml中指定文件路径</p>\n<pre><code>文件名：package_zh_CN.properties\n        package_zh_CN.properties\n</code></pre><ol>\n<li>Action范围</li>\n</ol>\n<p>在Action同级目录创建资源文件，不用在xml中指定文件路径。</p>\n<pre><code>文件名：ActionName_zh_CN.properties\nActionName是对应action的名字\n</code></pre></li>\n</ol>\n<h3 id=\"2-2-获取资源包内容\"><a href=\"#2-2-获取资源包内容\" class=\"headerlink\" title=\"2.2 获取资源包内容\"></a>2.2 获取资源包内容</h3><p>获取国际化</p>\n<ul>\n<li>Action： this.getText(key)</li>\n<li>Jsp: 使用<s:text>标签， <s:text name=\"key\"></s:text></s:text></li>\n<li>配置文件:key(直接使用国际化配置文件中的key值即可获得)</li>\n</ul>\n<p>自由选择消息资源包</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--自己随意指定消息资源包--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">s:i18n</span> <span class=\"attr\">name</span>=<span class=\"string\">\"com/topvision/package\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">s:text</span> <span class=\"attr\">name</span>=<span class=\"string\">\"key\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">s:text</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">s:i18n</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"3、文件上传下载\"><a href=\"#3、文件上传下载\" class=\"headerlink\" title=\"3、文件上传下载\"></a>3、文件上传下载</h2><h3 id=\"3-1-上传\"><a href=\"#3-1-上传\" class=\"headerlink\" title=\"3.1 上传\"></a>3.1 上传</h3><p>Struts2上传对表单有要求：</p>\n<ol>\n<li>post提交</li>\n<li>表单的enctype必须为multipart/form-data</li>\n<li><p>表单提供如下类型的input</p>\n<figure class=\"highlight jsp\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;input type=<span class=\"string\">\"file\"</span> name=<span class=\"string\">\"name\"</span>/&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>Struts2中如何实现文件上传的：</p>\n<ol>\n<li>借助一个fileUpload拦截器完成的；</li>\n<li>最底层的还是借助的commons-fileupload这个组件；</li>\n</ol>\n<p>单文件上传</p>\n<ol>\n<li><p>准备表单</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;form action=\"aaa/upload.tv\" method=\"post\" enctype=\"multipart/form-data\"&gt;</div><div class=\"line\">\t&lt;input type=\"file\" name=\"upload\"&gt;</div><div class=\"line\">\t&lt;button type=\"submit\"&gt;上传&lt;/button&gt;</div><div class=\"line\">&lt;/form&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>action</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> File upload;<span class=\"comment\">//input标签的name属性</span></div><div class=\"line\"><span class=\"keyword\">private</span> String uploadFileName; <span class=\"comment\">//name属性+FileName</span></div><div class=\"line\"><span class=\"keyword\">private</span> String uploadContentType;<span class=\"comment\">//name属性+ContentType</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">upload</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</div><div class=\"line\">    ServletContext servletContext = ServletActionContext.getServletContext();</div><div class=\"line\">    String realPath = servletContext.getRealPath(<span class=\"string\">\"/WEB-INF/file\"</span>);</div><div class=\"line\">    File file = <span class=\"keyword\">new</span> File(realPath);</div><div class=\"line\">    <span class=\"keyword\">if</span> (!file.exists()) &#123;</div><div class=\"line\">        file.mkdirs();</div><div class=\"line\">    &#125;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"comment\">/*InputStream is = new FileInputStream(upload);</span></div><div class=\"line\">    OutputStream os = new FileOutputStream(new File(file, uploadFileName));</div><div class=\"line\">    </div><div class=\"line\">    int len = -1;</div><div class=\"line\">    byte b[] = new byte[1024];</div><div class=\"line\">    while ((len = is.read(b)) != -1) &#123;</div><div class=\"line\">        os.write(b, 0, len);</div><div class=\"line\">    &#125;*/</div><div class=\"line\">    </div><div class=\"line\">    FileUtils.moveFile(upload, <span class=\"keyword\">new</span> File(file, uploadFileName));</div><div class=\"line\">    </div><div class=\"line\">    is.close();</div><div class=\"line\">    os.close();</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">return</span> SUCCESS;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<ol>\n<li>配置xml</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"upload\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"upload2\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>多文件上传</p>\n<p>第一种，比较煞笔的，多写几个上传框<br>第二种:使用　uploadify 插件</p>\n<h3 id=\"3-2-下载\"><a href=\"#3-2-下载\" class=\"headerlink\" title=\"3.2 下载\"></a>3.2 下载</h3><p>action配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> InputStream inputStream;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">download</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> FileNotFoundException </span>&#123;</div><div class=\"line\">    ServletContext servletContext = ServletActionContext.getServletContext();</div><div class=\"line\">    String realPath = servletContext.getRealPath(<span class=\"string\">\"/WEB-INF/web.xml\"</span>);</div><div class=\"line\">    inputStream = <span class=\"keyword\">new</span> FileInputStream(realPath);</div><div class=\"line\">    <span class=\"keyword\">return</span> SUCCESS;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> InputStream <span class=\"title\">getInputStream</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> inputStream;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setInputStream</span><span class=\"params\">(InputStream inputStream)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.inputStream = inputStream;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>xml配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">name</span>=<span class=\"string\">\"success\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"stream\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 设置输入流来源 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"inputstream\"</span>&gt;</span>inputstream<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 响应头 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"contentDisposition\"</span>&gt;</span>attachment;filename=web.xml<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 传的什么类型数据，在tomcat的web.xml中有定义 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"contentType\"</span>&gt;</span>application/xml<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span>\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 下载缓存 ,默认1024--&gt;</span>\t\t\t</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"bufferSize\"</span>&gt;</span>10240<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 下载文件大小 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"contentLength\"</span>&gt;</span>10240<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div></pre></td></tr></table></figure>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>struts2标签的使用，国际化及文件上传下载。<br>","more":"</p>\n<h2 id=\"1、struts标签\"><a href=\"#1、struts标签\" class=\"headerlink\" title=\"1、struts标签\"></a>1、struts标签</h2><p><a href=\"http://blog.csdn.net/q547550831/article/details/53326042\" target=\"_blank\" rel=\"noopener\">Struts2标签库常用标签</a></p>\n<h2 id=\"2、国际化\"><a href=\"#2、国际化\" class=\"headerlink\" title=\"2、国际化\"></a>2、国际化</h2><p>Struts2在ActionSupport中为我们提供了getText()来获取国际化value.</p>\n<h3 id=\"2-1-定义资源包\"><a href=\"#2-1-定义资源包\" class=\"headerlink\" title=\"2.1 定义资源包\"></a>2.1 定义资源包</h3><ol>\n<li><p>全局资源</p>\n<p>创建资源文件</p>\n<pre><code>格式：基本名称_语言_国家.properties　\n例如：resources_zh_CN.properties\n      resources_en_US.properties\n</code></pre><p>指定文在所在位置及文件名</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"comment\">&lt;!-- 国际化资源文件路径及名称 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.custom.i18n.resources\"</span></span></div><div class=\"line\">    <span class=\"attr\">value</span>=<span class=\"string\">\"com/topvision/s2sm/resources\"</span> /&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>包范围</p>\n<p>在包下创建资源文件，不用在xml中指定文件路径</p>\n<pre><code>文件名：package_zh_CN.properties\n        package_zh_CN.properties\n</code></pre><ol>\n<li>Action范围</li>\n</ol>\n<p>在Action同级目录创建资源文件，不用在xml中指定文件路径。</p>\n<pre><code>文件名：ActionName_zh_CN.properties\nActionName是对应action的名字\n</code></pre></li>\n</ol>\n<h3 id=\"2-2-获取资源包内容\"><a href=\"#2-2-获取资源包内容\" class=\"headerlink\" title=\"2.2 获取资源包内容\"></a>2.2 获取资源包内容</h3><p>获取国际化</p>\n<ul>\n<li>Action： this.getText(key)</li>\n<li>Jsp: 使用<s:text>标签， <s:text name=\"key\"></s:text></s:text></li>\n<li>配置文件:key(直接使用国际化配置文件中的key值即可获得)</li>\n</ul>\n<p>自由选择消息资源包</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--自己随意指定消息资源包--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">s:i18n</span> <span class=\"attr\">name</span>=<span class=\"string\">\"com/topvision/package\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">s:text</span> <span class=\"attr\">name</span>=<span class=\"string\">\"key\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">s:text</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">s:i18n</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"3、文件上传下载\"><a href=\"#3、文件上传下载\" class=\"headerlink\" title=\"3、文件上传下载\"></a>3、文件上传下载</h2><h3 id=\"3-1-上传\"><a href=\"#3-1-上传\" class=\"headerlink\" title=\"3.1 上传\"></a>3.1 上传</h3><p>Struts2上传对表单有要求：</p>\n<ol>\n<li>post提交</li>\n<li>表单的enctype必须为multipart/form-data</li>\n<li><p>表单提供如下类型的input</p>\n<figure class=\"highlight jsp\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;input type=<span class=\"string\">\"file\"</span> name=<span class=\"string\">\"name\"</span>/&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>Struts2中如何实现文件上传的：</p>\n<ol>\n<li>借助一个fileUpload拦截器完成的；</li>\n<li>最底层的还是借助的commons-fileupload这个组件；</li>\n</ol>\n<p>单文件上传</p>\n<ol>\n<li><p>准备表单</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;form action=\"aaa/upload.tv\" method=\"post\" enctype=\"multipart/form-data\"&gt;</div><div class=\"line\">\t&lt;input type=\"file\" name=\"upload\"&gt;</div><div class=\"line\">\t&lt;button type=\"submit\"&gt;上传&lt;/button&gt;</div><div class=\"line\">&lt;/form&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>action</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> File upload;<span class=\"comment\">//input标签的name属性</span></div><div class=\"line\"><span class=\"keyword\">private</span> String uploadFileName; <span class=\"comment\">//name属性+FileName</span></div><div class=\"line\"><span class=\"keyword\">private</span> String uploadContentType;<span class=\"comment\">//name属性+ContentType</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">upload</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</div><div class=\"line\">    ServletContext servletContext = ServletActionContext.getServletContext();</div><div class=\"line\">    String realPath = servletContext.getRealPath(<span class=\"string\">\"/WEB-INF/file\"</span>);</div><div class=\"line\">    File file = <span class=\"keyword\">new</span> File(realPath);</div><div class=\"line\">    <span class=\"keyword\">if</span> (!file.exists()) &#123;</div><div class=\"line\">        file.mkdirs();</div><div class=\"line\">    &#125;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"comment\">/*InputStream is = new FileInputStream(upload);</span></div><div class=\"line\">    OutputStream os = new FileOutputStream(new File(file, uploadFileName));</div><div class=\"line\">    </div><div class=\"line\">    int len = -1;</div><div class=\"line\">    byte b[] = new byte[1024];</div><div class=\"line\">    while ((len = is.read(b)) != -1) &#123;</div><div class=\"line\">        os.write(b, 0, len);</div><div class=\"line\">    &#125;*/</div><div class=\"line\">    </div><div class=\"line\">    FileUtils.moveFile(upload, <span class=\"keyword\">new</span> File(file, uploadFileName));</div><div class=\"line\">    </div><div class=\"line\">    is.close();</div><div class=\"line\">    os.close();</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">return</span> SUCCESS;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<ol>\n<li>配置xml</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"upload\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"upload2\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>多文件上传</p>\n<p>第一种，比较煞笔的，多写几个上传框<br>第二种:使用　uploadify 插件</p>\n<h3 id=\"3-2-下载\"><a href=\"#3-2-下载\" class=\"headerlink\" title=\"3.2 下载\"></a>3.2 下载</h3><p>action配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> InputStream inputStream;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">download</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> FileNotFoundException </span>&#123;</div><div class=\"line\">    ServletContext servletContext = ServletActionContext.getServletContext();</div><div class=\"line\">    String realPath = servletContext.getRealPath(<span class=\"string\">\"/WEB-INF/web.xml\"</span>);</div><div class=\"line\">    inputStream = <span class=\"keyword\">new</span> FileInputStream(realPath);</div><div class=\"line\">    <span class=\"keyword\">return</span> SUCCESS;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> InputStream <span class=\"title\">getInputStream</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> inputStream;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setInputStream</span><span class=\"params\">(InputStream inputStream)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.inputStream = inputStream;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>xml配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">name</span>=<span class=\"string\">\"success\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"stream\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 设置输入流来源 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"inputstream\"</span>&gt;</span>inputstream<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 响应头 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"contentDisposition\"</span>&gt;</span>attachment;filename=web.xml<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 传的什么类型数据，在tomcat的web.xml中有定义 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"contentType\"</span>&gt;</span>application/xml<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span>\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 下载缓存 ,默认1024--&gt;</span>\t\t\t</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"bufferSize\"</span>&gt;</span>10240<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 下载文件大小 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"contentLength\"</span>&gt;</span>10240<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div></pre></td></tr></table></figure>"},{"title":"Spring MVC(4)——requestMapping及controller返回值","date":"2018-03-06T08:14:21.000Z","_content":"\n集中参数绑定方式及返回值类型。\n<!--more-->\n\n## 1、RequestMapping\n\nrequestMapping注解的作用：对controller方法进行映射。\n\n### 1.1 URL路径映射\n\nrequestMapping指定url，对controller方法进行映射。\n\n```java\n@RequestMapping(\"/queryBook\")\npublic ModelAndView getBookById() {\n```\n\n### 1.2 窄化请求路径\n\n为了更好的管理url，为了避免url冲突，可以在class上使用requestMapping指定根url。\n\n```java\n@Controller\n@RequestMapping(\"/books\")//指定请求根路径\npublic class Controller1 {\n```\n\n在开发时候，需要提前进行url规划，以避免后期修改url后，需要大量修改页面上的url地址。\n\n### 1.3 请求方法限定\n\n通过requestMapping限制http的请求方法，可以提高系统安全性。\n\n```java\n@RequestMapping(value=\"/queryBook\",method={RequestMethod.GET,RequestMethod.POST})\npublic ModelAndView getBookById() {\n```\n\n## 2、Controller方法的返回值\n\n### 2.1 返回ModelAndView\n\ncontroller方法中定义ModelAndView对象并返回，对象中可添加model数据、指定逻辑视图名。\n\n### 2.2 返回void\n\n类似于原始servlet开发。\n\n```java\n@RequestMapping(\"/queryItemsReturnVoid\")\npublic void queryItemsReturnVoid(HttpServletRequest request,HttpServletResponse response,Integer[] ids){\n    List<Item> itemsList = itemService.findItemsList(ids);\n    request.setAttribute(\"itemsList\", itemsList);\n    request.getRequestDispatcher(\"/WEB-INF/jsp/itemsList.jsp\").forward(request, response);\n}\n```\n\n响应结果的三种方法：\n\n 1. 使用request转发页面，如下\n \n    ```java\n    request.getRequestDispatcher(\"页面路径\").forward(request, response);\n    ```\n\n 2. 使用response页面重定向\n \n    ```java\n    response.sendRedirect(\"url\")\n    ```\n    \n 3. 通过response指定响应结果，如响应json数据\n\n    ```java\n    response.setCharacterEncoding(\"utf-8\");\n    response.setContentType(\"application/json;charset=utf-8\");\n    response.getWriter().write(\"json串\");\n    ```\n    \n### 2.3 返回String(推荐)\n\n#### 2.3.1 页面转发方式\n\n格式：forward:转发地址（不能写http://，只能写action的地址）\n特点：转发的上一个请求request和要转发的地址共用request，转发后浏览器的地址是不变化。\n\n```java\n@RequestMapping(value=\"/queryBook\",method={RequestMethod.GET,RequestMethod.POST})\npublic String getBookById() {\n\n    Book book = bookService.findById(1000l);\n    ModelAndView modelAndView = new ModelAndView();\n    modelAndView.addObject(\"book\", book);\n    modelAndView.setViewName(\"bookDetail\");\n    return \"forward:/books/queryItemsReturnVoid.do\";\n}\n\n@RequestMapping(\"/queryItemsReturnVoid\")\npublic void queryItemsReturnVoid(HttpServletRequest request,HttpServletResponse response,Integer[] ids) throws ServletException, IOException{\n    //List<Item> itemsList = itemService.findItemsList(ids);\n    request.setAttribute(\"itemsList\", 111);\n    request.getRequestDispatcher(\"/WEB-INF/jsp/itemsList.jsp\").forward(request, response);\n}\n```\n\n#### 2.3.2 页面重定向方式\n\n格式是：redirect:重定向地址（比如：http://.....）\n特点：重定的上一个请求request和要重定的地址不公用request，重定后浏览器的地址是变化的。\n\n```java\n@RequestMapping(value=\"/queryBook\",method={RequestMethod.GET,RequestMethod.POST})\npublic String getBookById() {\n\n    Book book = bookService.findById(1000l);\n    ModelAndView modelAndView = new ModelAndView();\n    modelAndView.addObject(\"book\", book);\n    modelAndView.setViewName(\"bookDetail\");\n    return \"redirect:/books/queryItemsReturnVoid.do\";\n}\n\n@RequestMapping(\"/queryItemsReturnVoid\")\npublic void queryItemsReturnVoid(HttpServletRequest request,HttpServletResponse response,Integer[] ids) throws ServletException, IOException{\n    //List<Item> itemsList = itemService.findItemsList(ids);\n    request.setAttribute(\"itemsList\", 111);\n    request.getRequestDispatcher(\"/WEB-INF/jsp/itemsList.jsp\").forward(request, response);\n}\n```\n\n#### 2.3.3 表示逻辑视图名\n\n返回一个string如果即不是转发格式，也不是重定向的格式，就表示一个逻辑视图名。\n\n```java\n@RequestMapping(value=\"/queryBook\",method={RequestMethod.GET,RequestMethod.POST})\npublic String getBookById() {\n\n    return \"bookDetail\";\n}\n```\n","source":"_posts/Spring-MVC-4-——requestMapping及controller返回值.md","raw":"---\ntitle: Spring MVC(4)——requestMapping及controller返回值\ncategories:\n  - Spring\ntags:\n  - SpringMVC\ndate: 2018-03-06 16:14:21\n---\n\n集中参数绑定方式及返回值类型。\n<!--more-->\n\n## 1、RequestMapping\n\nrequestMapping注解的作用：对controller方法进行映射。\n\n### 1.1 URL路径映射\n\nrequestMapping指定url，对controller方法进行映射。\n\n```java\n@RequestMapping(\"/queryBook\")\npublic ModelAndView getBookById() {\n```\n\n### 1.2 窄化请求路径\n\n为了更好的管理url，为了避免url冲突，可以在class上使用requestMapping指定根url。\n\n```java\n@Controller\n@RequestMapping(\"/books\")//指定请求根路径\npublic class Controller1 {\n```\n\n在开发时候，需要提前进行url规划，以避免后期修改url后，需要大量修改页面上的url地址。\n\n### 1.3 请求方法限定\n\n通过requestMapping限制http的请求方法，可以提高系统安全性。\n\n```java\n@RequestMapping(value=\"/queryBook\",method={RequestMethod.GET,RequestMethod.POST})\npublic ModelAndView getBookById() {\n```\n\n## 2、Controller方法的返回值\n\n### 2.1 返回ModelAndView\n\ncontroller方法中定义ModelAndView对象并返回，对象中可添加model数据、指定逻辑视图名。\n\n### 2.2 返回void\n\n类似于原始servlet开发。\n\n```java\n@RequestMapping(\"/queryItemsReturnVoid\")\npublic void queryItemsReturnVoid(HttpServletRequest request,HttpServletResponse response,Integer[] ids){\n    List<Item> itemsList = itemService.findItemsList(ids);\n    request.setAttribute(\"itemsList\", itemsList);\n    request.getRequestDispatcher(\"/WEB-INF/jsp/itemsList.jsp\").forward(request, response);\n}\n```\n\n响应结果的三种方法：\n\n 1. 使用request转发页面，如下\n \n    ```java\n    request.getRequestDispatcher(\"页面路径\").forward(request, response);\n    ```\n\n 2. 使用response页面重定向\n \n    ```java\n    response.sendRedirect(\"url\")\n    ```\n    \n 3. 通过response指定响应结果，如响应json数据\n\n    ```java\n    response.setCharacterEncoding(\"utf-8\");\n    response.setContentType(\"application/json;charset=utf-8\");\n    response.getWriter().write(\"json串\");\n    ```\n    \n### 2.3 返回String(推荐)\n\n#### 2.3.1 页面转发方式\n\n格式：forward:转发地址（不能写http://，只能写action的地址）\n特点：转发的上一个请求request和要转发的地址共用request，转发后浏览器的地址是不变化。\n\n```java\n@RequestMapping(value=\"/queryBook\",method={RequestMethod.GET,RequestMethod.POST})\npublic String getBookById() {\n\n    Book book = bookService.findById(1000l);\n    ModelAndView modelAndView = new ModelAndView();\n    modelAndView.addObject(\"book\", book);\n    modelAndView.setViewName(\"bookDetail\");\n    return \"forward:/books/queryItemsReturnVoid.do\";\n}\n\n@RequestMapping(\"/queryItemsReturnVoid\")\npublic void queryItemsReturnVoid(HttpServletRequest request,HttpServletResponse response,Integer[] ids) throws ServletException, IOException{\n    //List<Item> itemsList = itemService.findItemsList(ids);\n    request.setAttribute(\"itemsList\", 111);\n    request.getRequestDispatcher(\"/WEB-INF/jsp/itemsList.jsp\").forward(request, response);\n}\n```\n\n#### 2.3.2 页面重定向方式\n\n格式是：redirect:重定向地址（比如：http://.....）\n特点：重定的上一个请求request和要重定的地址不公用request，重定后浏览器的地址是变化的。\n\n```java\n@RequestMapping(value=\"/queryBook\",method={RequestMethod.GET,RequestMethod.POST})\npublic String getBookById() {\n\n    Book book = bookService.findById(1000l);\n    ModelAndView modelAndView = new ModelAndView();\n    modelAndView.addObject(\"book\", book);\n    modelAndView.setViewName(\"bookDetail\");\n    return \"redirect:/books/queryItemsReturnVoid.do\";\n}\n\n@RequestMapping(\"/queryItemsReturnVoid\")\npublic void queryItemsReturnVoid(HttpServletRequest request,HttpServletResponse response,Integer[] ids) throws ServletException, IOException{\n    //List<Item> itemsList = itemService.findItemsList(ids);\n    request.setAttribute(\"itemsList\", 111);\n    request.getRequestDispatcher(\"/WEB-INF/jsp/itemsList.jsp\").forward(request, response);\n}\n```\n\n#### 2.3.3 表示逻辑视图名\n\n返回一个string如果即不是转发格式，也不是重定向的格式，就表示一个逻辑视图名。\n\n```java\n@RequestMapping(value=\"/queryBook\",method={RequestMethod.GET,RequestMethod.POST})\npublic String getBookById() {\n\n    return \"bookDetail\";\n}\n```\n","slug":"Spring-MVC-4-——requestMapping及controller返回值","published":1,"updated":"2018-03-06T08:18:16.715Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfuy003bhwvfb1t5t0b3","content":"<p>集中参数绑定方式及返回值类型。<br><a id=\"more\"></a></p>\n<h2 id=\"1、RequestMapping\"><a href=\"#1、RequestMapping\" class=\"headerlink\" title=\"1、RequestMapping\"></a>1、RequestMapping</h2><p>requestMapping注解的作用：对controller方法进行映射。</p>\n<h3 id=\"1-1-URL路径映射\"><a href=\"#1-1-URL路径映射\" class=\"headerlink\" title=\"1.1 URL路径映射\"></a>1.1 URL路径映射</h3><p>requestMapping指定url，对controller方法进行映射。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/queryBook\"</span>)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">getBookById</span><span class=\"params\">()</span> </span>&#123;</div></pre></td></tr></table></figure>\n<h3 id=\"1-2-窄化请求路径\"><a href=\"#1-2-窄化请求路径\" class=\"headerlink\" title=\"1.2 窄化请求路径\"></a>1.2 窄化请求路径</h3><p>为了更好的管理url，为了避免url冲突，可以在class上使用requestMapping指定根url。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Controller</span></div><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/books\"</span>)<span class=\"comment\">//指定请求根路径</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Controller1</span> </span>&#123;</div></pre></td></tr></table></figure>\n<p>在开发时候，需要提前进行url规划，以避免后期修改url后，需要大量修改页面上的url地址。</p>\n<h3 id=\"1-3-请求方法限定\"><a href=\"#1-3-请求方法限定\" class=\"headerlink\" title=\"1.3 请求方法限定\"></a>1.3 请求方法限定</h3><p>通过requestMapping限制http的请求方法，可以提高系统安全性。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(value=<span class=\"string\">\"/queryBook\"</span>,method=&#123;RequestMethod.GET,RequestMethod.POST&#125;)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">getBookById</span><span class=\"params\">()</span> </span>&#123;</div></pre></td></tr></table></figure>\n<h2 id=\"2、Controller方法的返回值\"><a href=\"#2、Controller方法的返回值\" class=\"headerlink\" title=\"2、Controller方法的返回值\"></a>2、Controller方法的返回值</h2><h3 id=\"2-1-返回ModelAndView\"><a href=\"#2-1-返回ModelAndView\" class=\"headerlink\" title=\"2.1 返回ModelAndView\"></a>2.1 返回ModelAndView</h3><p>controller方法中定义ModelAndView对象并返回，对象中可添加model数据、指定逻辑视图名。</p>\n<h3 id=\"2-2-返回void\"><a href=\"#2-2-返回void\" class=\"headerlink\" title=\"2.2 返回void\"></a>2.2 返回void</h3><p>类似于原始servlet开发。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/queryItemsReturnVoid\"</span>)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">queryItemsReturnVoid</span><span class=\"params\">(HttpServletRequest request,HttpServletResponse response,Integer[] ids)</span></span>&#123;</div><div class=\"line\">    List&lt;Item&gt; itemsList = itemService.findItemsList(ids);</div><div class=\"line\">    request.setAttribute(<span class=\"string\">\"itemsList\"</span>, itemsList);</div><div class=\"line\">    request.getRequestDispatcher(<span class=\"string\">\"/WEB-INF/jsp/itemsList.jsp\"</span>).forward(request, response);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>响应结果的三种方法：</p>\n<ol>\n<li><p>使用request转发页面，如下</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">request.getRequestDispatcher(<span class=\"string\">\"页面路径\"</span>).forward(request, response);</div></pre></td></tr></table></figure>\n</li>\n<li><p>使用response页面重定向</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">response.sendRedirect(<span class=\"string\">\"url\"</span>)</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>通过response指定响应结果，如响应json数据</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">response.setCharacterEncoding(<span class=\"string\">\"utf-8\"</span>);</div><div class=\"line\">response.setContentType(<span class=\"string\">\"application/json;charset=utf-8\"</span>);</div><div class=\"line\">response.getWriter().write(<span class=\"string\">\"json串\"</span>);</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"2-3-返回String-推荐\"><a href=\"#2-3-返回String-推荐\" class=\"headerlink\" title=\"2.3 返回String(推荐)\"></a>2.3 返回String(推荐)</h3><h4 id=\"2-3-1-页面转发方式\"><a href=\"#2-3-1-页面转发方式\" class=\"headerlink\" title=\"2.3.1 页面转发方式\"></a>2.3.1 页面转发方式</h4><p>格式：forward:转发地址（不能写<a href=\"http://，只能写action的地址）\" target=\"_blank\" rel=\"noopener\">http://，只能写action的地址）</a><br>特点：转发的上一个请求request和要转发的地址共用request，转发后浏览器的地址是不变化。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(value=<span class=\"string\">\"/queryBook\"</span>,method=&#123;RequestMethod.GET,RequestMethod.POST&#125;)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getBookById</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    Book book = bookService.findById(<span class=\"number\">1000l</span>);</div><div class=\"line\">    ModelAndView modelAndView = <span class=\"keyword\">new</span> ModelAndView();</div><div class=\"line\">    modelAndView.addObject(<span class=\"string\">\"book\"</span>, book);</div><div class=\"line\">    modelAndView.setViewName(<span class=\"string\">\"bookDetail\"</span>);</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"forward:/books/queryItemsReturnVoid.do\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/queryItemsReturnVoid\"</span>)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">queryItemsReturnVoid</span><span class=\"params\">(HttpServletRequest request,HttpServletResponse response,Integer[] ids)</span> <span class=\"keyword\">throws</span> ServletException, IOException</span>&#123;</div><div class=\"line\">    <span class=\"comment\">//List&lt;Item&gt; itemsList = itemService.findItemsList(ids);</span></div><div class=\"line\">    request.setAttribute(<span class=\"string\">\"itemsList\"</span>, <span class=\"number\">111</span>);</div><div class=\"line\">    request.getRequestDispatcher(<span class=\"string\">\"/WEB-INF/jsp/itemsList.jsp\"</span>).forward(request, response);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"2-3-2-页面重定向方式\"><a href=\"#2-3-2-页面重定向方式\" class=\"headerlink\" title=\"2.3.2 页面重定向方式\"></a>2.3.2 页面重定向方式</h4><p>格式是：redirect:重定向地址（比如：<a href=\"http://.....）\" target=\"_blank\" rel=\"noopener\">http://.....）</a><br>特点：重定的上一个请求request和要重定的地址不公用request，重定后浏览器的地址是变化的。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(value=<span class=\"string\">\"/queryBook\"</span>,method=&#123;RequestMethod.GET,RequestMethod.POST&#125;)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getBookById</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    Book book = bookService.findById(<span class=\"number\">1000l</span>);</div><div class=\"line\">    ModelAndView modelAndView = <span class=\"keyword\">new</span> ModelAndView();</div><div class=\"line\">    modelAndView.addObject(<span class=\"string\">\"book\"</span>, book);</div><div class=\"line\">    modelAndView.setViewName(<span class=\"string\">\"bookDetail\"</span>);</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"redirect:/books/queryItemsReturnVoid.do\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/queryItemsReturnVoid\"</span>)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">queryItemsReturnVoid</span><span class=\"params\">(HttpServletRequest request,HttpServletResponse response,Integer[] ids)</span> <span class=\"keyword\">throws</span> ServletException, IOException</span>&#123;</div><div class=\"line\">    <span class=\"comment\">//List&lt;Item&gt; itemsList = itemService.findItemsList(ids);</span></div><div class=\"line\">    request.setAttribute(<span class=\"string\">\"itemsList\"</span>, <span class=\"number\">111</span>);</div><div class=\"line\">    request.getRequestDispatcher(<span class=\"string\">\"/WEB-INF/jsp/itemsList.jsp\"</span>).forward(request, response);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"2-3-3-表示逻辑视图名\"><a href=\"#2-3-3-表示逻辑视图名\" class=\"headerlink\" title=\"2.3.3 表示逻辑视图名\"></a>2.3.3 表示逻辑视图名</h4><p>返回一个string如果即不是转发格式，也不是重定向的格式，就表示一个逻辑视图名。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(value=<span class=\"string\">\"/queryBook\"</span>,method=&#123;RequestMethod.GET,RequestMethod.POST&#125;)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getBookById</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"bookDetail\"</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>集中参数绑定方式及返回值类型。<br>","more":"</p>\n<h2 id=\"1、RequestMapping\"><a href=\"#1、RequestMapping\" class=\"headerlink\" title=\"1、RequestMapping\"></a>1、RequestMapping</h2><p>requestMapping注解的作用：对controller方法进行映射。</p>\n<h3 id=\"1-1-URL路径映射\"><a href=\"#1-1-URL路径映射\" class=\"headerlink\" title=\"1.1 URL路径映射\"></a>1.1 URL路径映射</h3><p>requestMapping指定url，对controller方法进行映射。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/queryBook\"</span>)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">getBookById</span><span class=\"params\">()</span> </span>&#123;</div></pre></td></tr></table></figure>\n<h3 id=\"1-2-窄化请求路径\"><a href=\"#1-2-窄化请求路径\" class=\"headerlink\" title=\"1.2 窄化请求路径\"></a>1.2 窄化请求路径</h3><p>为了更好的管理url，为了避免url冲突，可以在class上使用requestMapping指定根url。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Controller</span></div><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/books\"</span>)<span class=\"comment\">//指定请求根路径</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Controller1</span> </span>&#123;</div></pre></td></tr></table></figure>\n<p>在开发时候，需要提前进行url规划，以避免后期修改url后，需要大量修改页面上的url地址。</p>\n<h3 id=\"1-3-请求方法限定\"><a href=\"#1-3-请求方法限定\" class=\"headerlink\" title=\"1.3 请求方法限定\"></a>1.3 请求方法限定</h3><p>通过requestMapping限制http的请求方法，可以提高系统安全性。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(value=<span class=\"string\">\"/queryBook\"</span>,method=&#123;RequestMethod.GET,RequestMethod.POST&#125;)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> ModelAndView <span class=\"title\">getBookById</span><span class=\"params\">()</span> </span>&#123;</div></pre></td></tr></table></figure>\n<h2 id=\"2、Controller方法的返回值\"><a href=\"#2、Controller方法的返回值\" class=\"headerlink\" title=\"2、Controller方法的返回值\"></a>2、Controller方法的返回值</h2><h3 id=\"2-1-返回ModelAndView\"><a href=\"#2-1-返回ModelAndView\" class=\"headerlink\" title=\"2.1 返回ModelAndView\"></a>2.1 返回ModelAndView</h3><p>controller方法中定义ModelAndView对象并返回，对象中可添加model数据、指定逻辑视图名。</p>\n<h3 id=\"2-2-返回void\"><a href=\"#2-2-返回void\" class=\"headerlink\" title=\"2.2 返回void\"></a>2.2 返回void</h3><p>类似于原始servlet开发。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/queryItemsReturnVoid\"</span>)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">queryItemsReturnVoid</span><span class=\"params\">(HttpServletRequest request,HttpServletResponse response,Integer[] ids)</span></span>&#123;</div><div class=\"line\">    List&lt;Item&gt; itemsList = itemService.findItemsList(ids);</div><div class=\"line\">    request.setAttribute(<span class=\"string\">\"itemsList\"</span>, itemsList);</div><div class=\"line\">    request.getRequestDispatcher(<span class=\"string\">\"/WEB-INF/jsp/itemsList.jsp\"</span>).forward(request, response);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>响应结果的三种方法：</p>\n<ol>\n<li><p>使用request转发页面，如下</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">request.getRequestDispatcher(<span class=\"string\">\"页面路径\"</span>).forward(request, response);</div></pre></td></tr></table></figure>\n</li>\n<li><p>使用response页面重定向</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">response.sendRedirect(<span class=\"string\">\"url\"</span>)</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>通过response指定响应结果，如响应json数据</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">response.setCharacterEncoding(<span class=\"string\">\"utf-8\"</span>);</div><div class=\"line\">response.setContentType(<span class=\"string\">\"application/json;charset=utf-8\"</span>);</div><div class=\"line\">response.getWriter().write(<span class=\"string\">\"json串\"</span>);</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"2-3-返回String-推荐\"><a href=\"#2-3-返回String-推荐\" class=\"headerlink\" title=\"2.3 返回String(推荐)\"></a>2.3 返回String(推荐)</h3><h4 id=\"2-3-1-页面转发方式\"><a href=\"#2-3-1-页面转发方式\" class=\"headerlink\" title=\"2.3.1 页面转发方式\"></a>2.3.1 页面转发方式</h4><p>格式：forward:转发地址（不能写<a href=\"http://，只能写action的地址）\" target=\"_blank\" rel=\"noopener\">http://，只能写action的地址）</a><br>特点：转发的上一个请求request和要转发的地址共用request，转发后浏览器的地址是不变化。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(value=<span class=\"string\">\"/queryBook\"</span>,method=&#123;RequestMethod.GET,RequestMethod.POST&#125;)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getBookById</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    Book book = bookService.findById(<span class=\"number\">1000l</span>);</div><div class=\"line\">    ModelAndView modelAndView = <span class=\"keyword\">new</span> ModelAndView();</div><div class=\"line\">    modelAndView.addObject(<span class=\"string\">\"book\"</span>, book);</div><div class=\"line\">    modelAndView.setViewName(<span class=\"string\">\"bookDetail\"</span>);</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"forward:/books/queryItemsReturnVoid.do\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/queryItemsReturnVoid\"</span>)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">queryItemsReturnVoid</span><span class=\"params\">(HttpServletRequest request,HttpServletResponse response,Integer[] ids)</span> <span class=\"keyword\">throws</span> ServletException, IOException</span>&#123;</div><div class=\"line\">    <span class=\"comment\">//List&lt;Item&gt; itemsList = itemService.findItemsList(ids);</span></div><div class=\"line\">    request.setAttribute(<span class=\"string\">\"itemsList\"</span>, <span class=\"number\">111</span>);</div><div class=\"line\">    request.getRequestDispatcher(<span class=\"string\">\"/WEB-INF/jsp/itemsList.jsp\"</span>).forward(request, response);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"2-3-2-页面重定向方式\"><a href=\"#2-3-2-页面重定向方式\" class=\"headerlink\" title=\"2.3.2 页面重定向方式\"></a>2.3.2 页面重定向方式</h4><p>格式是：redirect:重定向地址（比如：<a href=\"http://.....）\" target=\"_blank\" rel=\"noopener\">http://.....）</a><br>特点：重定的上一个请求request和要重定的地址不公用request，重定后浏览器的地址是变化的。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(value=<span class=\"string\">\"/queryBook\"</span>,method=&#123;RequestMethod.GET,RequestMethod.POST&#125;)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getBookById</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    Book book = bookService.findById(<span class=\"number\">1000l</span>);</div><div class=\"line\">    ModelAndView modelAndView = <span class=\"keyword\">new</span> ModelAndView();</div><div class=\"line\">    modelAndView.addObject(<span class=\"string\">\"book\"</span>, book);</div><div class=\"line\">    modelAndView.setViewName(<span class=\"string\">\"bookDetail\"</span>);</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"redirect:/books/queryItemsReturnVoid.do\"</span>;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(<span class=\"string\">\"/queryItemsReturnVoid\"</span>)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">queryItemsReturnVoid</span><span class=\"params\">(HttpServletRequest request,HttpServletResponse response,Integer[] ids)</span> <span class=\"keyword\">throws</span> ServletException, IOException</span>&#123;</div><div class=\"line\">    <span class=\"comment\">//List&lt;Item&gt; itemsList = itemService.findItemsList(ids);</span></div><div class=\"line\">    request.setAttribute(<span class=\"string\">\"itemsList\"</span>, <span class=\"number\">111</span>);</div><div class=\"line\">    request.getRequestDispatcher(<span class=\"string\">\"/WEB-INF/jsp/itemsList.jsp\"</span>).forward(request, response);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h4 id=\"2-3-3-表示逻辑视图名\"><a href=\"#2-3-3-表示逻辑视图名\" class=\"headerlink\" title=\"2.3.3 表示逻辑视图名\"></a>2.3.3 表示逻辑视图名</h4><p>返回一个string如果即不是转发格式，也不是重定向的格式，就表示一个逻辑视图名。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RequestMapping</span>(value=<span class=\"string\">\"/queryBook\"</span>,method=&#123;RequestMethod.GET,RequestMethod.POST&#125;)</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getBookById</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"bookDetail\"</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>"},{"title":"hexo+github搭建个人博客","date":"2017-04-27T10:54:43.000Z","keyword":["hexo","next"],"_content":"## 1.前言\n使用github pages服务搭建博客的好处有：\n1.全是静态文件，访问速度快；\n2.免费方便，不用花一分钱就可以搭建一个自由的个人博客，不需要服务器不需要后台；\n3.可以随意绑定自己的域名，不仔细看的话根本看不出来你的网站是基于github的；\n4.数据绝对安全，基于github的版本管理，想恢复到哪个历史版本都行；\n5.博客内容可以轻松打包、转移、发布到其它平台；\n<!-- more -->\n6.等等；\n\n### 1.1准备工作\n\n - 创建github账号       [github注册地址](https://github.com/)\n - 安装node.js、npm     [node.js下载地址](https://nodejs.org/en/download/)\n - 安装git for windows  [git下载地址](https://git-scm.com/downloads)\n \n**本文所使用的环境**\n - windows10\n - git@1.9.5\n - node.js@6.10.2\n - hexo@\n\n## 2.搭建github博客\n### 2.1创建仓库\n登陆github,打开新建页面，如图![步骤一](/images/blog/newRepository.png)\n![步骤二](/images/blog/step2.png)\n新建仓库名必须为**你的用户名.github.io**,假如说你的用户名是test,那仓库名为test.github.io,将来的博客访问地址就是http://test.github.io 了，是不是很方便？\n由此可见，每一个github账户最多只能创建一个这样可以直接使用域名访问的仓库。\n**几个注意的地方：**\n1.注册的邮箱一定要验证，否则不会成功；\n2.仓库名字必须是：username.github.io，其中username是你的用户名；\n3.仓库创建成功不会立即生效，需要过一段时间，大概10-30分钟，或者更久\n###2.2绑定域名\n这一步不是必须，若不绑定则可用默认的http://xxx.github.io来访问，若想自己拥有一个域名，则需要注册，这一步留待以后再将，直接下一步。\n## 3.配置SSH key\n为什么要配置这个呢？因为你提交代码肯定要拥有你的github权限才可以，但是直接使用用户名和密码太不安全了，所以我们使用ssh key来解决本地和服务器的连接问题。\n在电脑任意位置进入**git bash**\n`$ cd ~/. ssh #检查本机已存在的ssh密钥` \n如果提示：No such file or directory 说明你是第一次使用git\n`ssh-keygen -t rsa -C \"邮件地址\"`\n然后连续3次回车，最终会生成一个文件在用户目录下，打开用户目录，找到**.ssh\\id_rsa.pub**文件，文本编辑器打开并复制里面的内容，打开你的github主页，进入个人设置 -> SSH and GPG keys -> New SSH key：将刚复制的内容粘贴到key那里，title随便填，保存。\n![步骤三](/images/blog/step3.png)\n**测试是否设置成功**\n`$ ssh -T git@github.com # 注意邮箱地址不用改`\n如果提示Are you sure you want to continue connecting (yes/no)?，输入yes，然后会看到：\n\nHi xiaoyue! You've successfully authenticated, but GitHub does not provide shell access.\n\n看到这个信息说明SSH已配置成功！\n此时你还需要配置：\n```bash\n$ git config --global user.name \"liuxianan\"// 你的github用户名，非昵称\n$ git config --global user.email  \"xxx@qq.com\"// 填写你的github注册邮箱\n```\n\n## 4.使用hexo写博客\n### 4.1hexo简介\nHexo是一个简单、快速、强大的基于 Github Pages 的博客发布工具，支持Markdown格式，有众多优秀插件和主题。\n\n官网： http://hexo.io\ngithub: https://github.com/hexojs/hexo\n###4.2原理\n由于github pages存放的都是静态文件，博客存放的不只是文章内容，还有文章列表、分类、标签、翻页等动态内容，假如每次写完一篇文章都要手动更新博文目录和相关链接信息，相信谁都会疯掉，所以hexo所做的就是将这些md文件都放在本地，每次写完文章后调用写好的命令来批量完成相关页面的生成，然后再将有改动的页面提交到github。\n\n**注意事项**\n\n 1. 很多命令既可以用Windows的cmd来完成，也可以使用git bash来完成，但是部分命令会有一些问题，为避免不必要的问题，建议全部使用git bash来执行；\n 2. hexo不同版本差别比较大，网上很多文章的配置信息都是基于2.x的，所以注意不要被误导；\n 3. hexo有2种_config.yml文件，一个是根目录下的全局的_config.yml，一个是各个theme下的；\n\n**安装hexo**\n`$ npm install -g hexo`\n若上面的命令失败，建议使用下面的代理命令\n`此处输入代码`\n\n**初始化**\n在电脑的某个地方新建一个名为hexo的文件夹（名字可以随便取），比如我的是*F:\\Workspaces\\hexo*，由于这个文件夹将来就作为你存放代码的地方，所以最好不要随便放。\n`$ cd /f/Workspaces/hexo/`\n`$ hexo init`\nhexo会自动下载一些文件到这个目录，包括node_modules。继续执行下面两条命令\n`$ hexo g # 生成`\n`$ hexo s # 启动服务`\n执行以上命令之后，hexo就会在public文件夹生成相关html文件，这些文件将来都是要提交到github去的。\n\n**hexo s**是开启本地预览服务，打开浏览器访问 http://localhost:4000 即可看到内容，很多人会碰到浏览器一直在转圈但是就是加载不出来的问题，一般情况下是因为端口占用的缘故，因为4000这个端口太常见了，解决端口冲突问题请参考这篇文章：\n\nhttp://blog.liuxianan.com/windows-port-bind.html\n\n第一次初始化的时候hexo已经帮我们写了一篇名为 Hello World 的文章，默认的主题比较丑。\n\n## 5.配置主题\n### 5.1更换主题\n既然默认主题很丑，那我们别的不做，首先来替换一个好看点的主题。这是 [官方主题](https://hexo.io/themes/)。\n个人比较喜欢的主题：[hexo-theme-next](https://github.com/iissnan/hexo-theme-next) 和[hexo-theme-yilia](https://github.com/litten/hexo-theme-yilia)\n以next主题为例，首先clone这个主题：\n\n进入之前建立的hexo目录，在git bash中执行clone命令\n\n`$ git clone https://github.com/iissnan/hexo-theme-next.git themes/next`\n\n下载的主题到了hexo>theme文件夹下。\n修改##hexo##根目录下的**_config.yml**文件中的**theme: landscape**改为**theme: yilia**，然后重新执行**hexo g**来重新生成静态文件，**hexo s**部署到本地，**localhost:4000**预览博客效果。\n\n如果出现一些莫名其妙的问题，可以先执行**hexo clean**来清理一下public的内容，然后再来重新生成和发布。\n\n","source":"_posts/hexo+github搭建个人博客.md","raw":"---\ntitle: hexo+github搭建个人博客\ndate: 2017-04-27 18:54:43\ncategories:\n\t- Blog\ntags:\n\t- Blog\nkeyword:\n\t- hexo\n\t- next\n---\n## 1.前言\n使用github pages服务搭建博客的好处有：\n1.全是静态文件，访问速度快；\n2.免费方便，不用花一分钱就可以搭建一个自由的个人博客，不需要服务器不需要后台；\n3.可以随意绑定自己的域名，不仔细看的话根本看不出来你的网站是基于github的；\n4.数据绝对安全，基于github的版本管理，想恢复到哪个历史版本都行；\n5.博客内容可以轻松打包、转移、发布到其它平台；\n<!-- more -->\n6.等等；\n\n### 1.1准备工作\n\n - 创建github账号       [github注册地址](https://github.com/)\n - 安装node.js、npm     [node.js下载地址](https://nodejs.org/en/download/)\n - 安装git for windows  [git下载地址](https://git-scm.com/downloads)\n \n**本文所使用的环境**\n - windows10\n - git@1.9.5\n - node.js@6.10.2\n - hexo@\n\n## 2.搭建github博客\n### 2.1创建仓库\n登陆github,打开新建页面，如图![步骤一](/images/blog/newRepository.png)\n![步骤二](/images/blog/step2.png)\n新建仓库名必须为**你的用户名.github.io**,假如说你的用户名是test,那仓库名为test.github.io,将来的博客访问地址就是http://test.github.io 了，是不是很方便？\n由此可见，每一个github账户最多只能创建一个这样可以直接使用域名访问的仓库。\n**几个注意的地方：**\n1.注册的邮箱一定要验证，否则不会成功；\n2.仓库名字必须是：username.github.io，其中username是你的用户名；\n3.仓库创建成功不会立即生效，需要过一段时间，大概10-30分钟，或者更久\n###2.2绑定域名\n这一步不是必须，若不绑定则可用默认的http://xxx.github.io来访问，若想自己拥有一个域名，则需要注册，这一步留待以后再将，直接下一步。\n## 3.配置SSH key\n为什么要配置这个呢？因为你提交代码肯定要拥有你的github权限才可以，但是直接使用用户名和密码太不安全了，所以我们使用ssh key来解决本地和服务器的连接问题。\n在电脑任意位置进入**git bash**\n`$ cd ~/. ssh #检查本机已存在的ssh密钥` \n如果提示：No such file or directory 说明你是第一次使用git\n`ssh-keygen -t rsa -C \"邮件地址\"`\n然后连续3次回车，最终会生成一个文件在用户目录下，打开用户目录，找到**.ssh\\id_rsa.pub**文件，文本编辑器打开并复制里面的内容，打开你的github主页，进入个人设置 -> SSH and GPG keys -> New SSH key：将刚复制的内容粘贴到key那里，title随便填，保存。\n![步骤三](/images/blog/step3.png)\n**测试是否设置成功**\n`$ ssh -T git@github.com # 注意邮箱地址不用改`\n如果提示Are you sure you want to continue connecting (yes/no)?，输入yes，然后会看到：\n\nHi xiaoyue! You've successfully authenticated, but GitHub does not provide shell access.\n\n看到这个信息说明SSH已配置成功！\n此时你还需要配置：\n```bash\n$ git config --global user.name \"liuxianan\"// 你的github用户名，非昵称\n$ git config --global user.email  \"xxx@qq.com\"// 填写你的github注册邮箱\n```\n\n## 4.使用hexo写博客\n### 4.1hexo简介\nHexo是一个简单、快速、强大的基于 Github Pages 的博客发布工具，支持Markdown格式，有众多优秀插件和主题。\n\n官网： http://hexo.io\ngithub: https://github.com/hexojs/hexo\n###4.2原理\n由于github pages存放的都是静态文件，博客存放的不只是文章内容，还有文章列表、分类、标签、翻页等动态内容，假如每次写完一篇文章都要手动更新博文目录和相关链接信息，相信谁都会疯掉，所以hexo所做的就是将这些md文件都放在本地，每次写完文章后调用写好的命令来批量完成相关页面的生成，然后再将有改动的页面提交到github。\n\n**注意事项**\n\n 1. 很多命令既可以用Windows的cmd来完成，也可以使用git bash来完成，但是部分命令会有一些问题，为避免不必要的问题，建议全部使用git bash来执行；\n 2. hexo不同版本差别比较大，网上很多文章的配置信息都是基于2.x的，所以注意不要被误导；\n 3. hexo有2种_config.yml文件，一个是根目录下的全局的_config.yml，一个是各个theme下的；\n\n**安装hexo**\n`$ npm install -g hexo`\n若上面的命令失败，建议使用下面的代理命令\n`此处输入代码`\n\n**初始化**\n在电脑的某个地方新建一个名为hexo的文件夹（名字可以随便取），比如我的是*F:\\Workspaces\\hexo*，由于这个文件夹将来就作为你存放代码的地方，所以最好不要随便放。\n`$ cd /f/Workspaces/hexo/`\n`$ hexo init`\nhexo会自动下载一些文件到这个目录，包括node_modules。继续执行下面两条命令\n`$ hexo g # 生成`\n`$ hexo s # 启动服务`\n执行以上命令之后，hexo就会在public文件夹生成相关html文件，这些文件将来都是要提交到github去的。\n\n**hexo s**是开启本地预览服务，打开浏览器访问 http://localhost:4000 即可看到内容，很多人会碰到浏览器一直在转圈但是就是加载不出来的问题，一般情况下是因为端口占用的缘故，因为4000这个端口太常见了，解决端口冲突问题请参考这篇文章：\n\nhttp://blog.liuxianan.com/windows-port-bind.html\n\n第一次初始化的时候hexo已经帮我们写了一篇名为 Hello World 的文章，默认的主题比较丑。\n\n## 5.配置主题\n### 5.1更换主题\n既然默认主题很丑，那我们别的不做，首先来替换一个好看点的主题。这是 [官方主题](https://hexo.io/themes/)。\n个人比较喜欢的主题：[hexo-theme-next](https://github.com/iissnan/hexo-theme-next) 和[hexo-theme-yilia](https://github.com/litten/hexo-theme-yilia)\n以next主题为例，首先clone这个主题：\n\n进入之前建立的hexo目录，在git bash中执行clone命令\n\n`$ git clone https://github.com/iissnan/hexo-theme-next.git themes/next`\n\n下载的主题到了hexo>theme文件夹下。\n修改##hexo##根目录下的**_config.yml**文件中的**theme: landscape**改为**theme: yilia**，然后重新执行**hexo g**来重新生成静态文件，**hexo s**部署到本地，**localhost:4000**预览博客效果。\n\n如果出现一些莫名其妙的问题，可以先执行**hexo clean**来清理一下public的内容，然后再来重新生成和发布。\n\n","slug":"hexo+github搭建个人博客","published":1,"updated":"2018-04-04T09:28:10.451Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfv1003ehwvfdf2m7yco","content":"<h2 id=\"1-前言\"><a href=\"#1-前言\" class=\"headerlink\" title=\"1.前言\"></a>1.前言</h2><p>使用github pages服务搭建博客的好处有：<br>1.全是静态文件，访问速度快；<br>2.免费方便，不用花一分钱就可以搭建一个自由的个人博客，不需要服务器不需要后台；<br>3.可以随意绑定自己的域名，不仔细看的话根本看不出来你的网站是基于github的；<br>4.数据绝对安全，基于github的版本管理，想恢复到哪个历史版本都行；<br>5.博客内容可以轻松打包、转移、发布到其它平台；<br><a id=\"more\"></a><br>6.等等；</p>\n<h3 id=\"1-1准备工作\"><a href=\"#1-1准备工作\" class=\"headerlink\" title=\"1.1准备工作\"></a>1.1准备工作</h3><ul>\n<li>创建github账号       <a href=\"https://github.com/\" target=\"_blank\" rel=\"noopener\">github注册地址</a></li>\n<li>安装node.js、npm     <a href=\"https://nodejs.org/en/download/\" target=\"_blank\" rel=\"noopener\">node.js下载地址</a></li>\n<li>安装git for windows  <a href=\"https://git-scm.com/downloads\" target=\"_blank\" rel=\"noopener\">git下载地址</a></li>\n</ul>\n<p><strong>本文所使用的环境</strong></p>\n<ul>\n<li>windows10</li>\n<li>git@1.9.5</li>\n<li>node.js@6.10.2</li>\n<li>hexo@</li>\n</ul>\n<h2 id=\"2-搭建github博客\"><a href=\"#2-搭建github博客\" class=\"headerlink\" title=\"2.搭建github博客\"></a>2.搭建github博客</h2><h3 id=\"2-1创建仓库\"><a href=\"#2-1创建仓库\" class=\"headerlink\" title=\"2.1创建仓库\"></a>2.1创建仓库</h3><p>登陆github,打开新建页面，如图<img src=\"/images/blog/newRepository.png\" alt=\"步骤一\"><br><img src=\"/images/blog/step2.png\" alt=\"步骤二\"><br>新建仓库名必须为<strong>你的用户名.github.io</strong>,假如说你的用户名是test,那仓库名为test.github.io,将来的博客访问地址就是<a href=\"http://test.github.io\" target=\"_blank\" rel=\"noopener\">http://test.github.io</a> 了，是不是很方便？<br>由此可见，每一个github账户最多只能创建一个这样可以直接使用域名访问的仓库。<br><strong>几个注意的地方：</strong><br>1.注册的邮箱一定要验证，否则不会成功；<br>2.仓库名字必须是：username.github.io，其中username是你的用户名；<br>3.仓库创建成功不会立即生效，需要过一段时间，大概10-30分钟，或者更久</p>\n<p>###2.2绑定域名<br>这一步不是必须，若不绑定则可用默认的<a href=\"http://xxx.github.io来访问，若想自己拥有一个域名，则需要注册，这一步留待以后再将，直接下一步。\" target=\"_blank\" rel=\"noopener\">http://xxx.github.io来访问，若想自己拥有一个域名，则需要注册，这一步留待以后再将，直接下一步。</a></p>\n<h2 id=\"3-配置SSH-key\"><a href=\"#3-配置SSH-key\" class=\"headerlink\" title=\"3.配置SSH key\"></a>3.配置SSH key</h2><p>为什么要配置这个呢？因为你提交代码肯定要拥有你的github权限才可以，但是直接使用用户名和密码太不安全了，所以我们使用ssh key来解决本地和服务器的连接问题。<br>在电脑任意位置进入<strong>git bash</strong><br><code>$ cd ~/. ssh #检查本机已存在的ssh密钥</code><br>如果提示：No such file or directory 说明你是第一次使用git<br><code>ssh-keygen -t rsa -C &quot;邮件地址&quot;</code><br>然后连续3次回车，最终会生成一个文件在用户目录下，打开用户目录，找到<strong>.ssh\\id_rsa.pub</strong>文件，文本编辑器打开并复制里面的内容，打开你的github主页，进入个人设置 -&gt; SSH and GPG keys -&gt; New SSH key：将刚复制的内容粘贴到key那里，title随便填，保存。<br><img src=\"/images/blog/step3.png\" alt=\"步骤三\"><br><strong>测试是否设置成功</strong><br><code>$ ssh -T git@github.com # 注意邮箱地址不用改</code><br>如果提示Are you sure you want to continue connecting (yes/no)?，输入yes，然后会看到：</p>\n<p>Hi xiaoyue! You’ve successfully authenticated, but GitHub does not provide shell access.</p>\n<p>看到这个信息说明SSH已配置成功！<br>此时你还需要配置：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ git config --global user.name <span class=\"string\">\"liuxianan\"</span>// 你的github用户名，非昵称</div><div class=\"line\">$ git config --global user.email  <span class=\"string\">\"xxx@qq.com\"</span>// 填写你的github注册邮箱</div></pre></td></tr></table></figure></p>\n<h2 id=\"4-使用hexo写博客\"><a href=\"#4-使用hexo写博客\" class=\"headerlink\" title=\"4.使用hexo写博客\"></a>4.使用hexo写博客</h2><h3 id=\"4-1hexo简介\"><a href=\"#4-1hexo简介\" class=\"headerlink\" title=\"4.1hexo简介\"></a>4.1hexo简介</h3><p>Hexo是一个简单、快速、强大的基于 Github Pages 的博客发布工具，支持Markdown格式，有众多优秀插件和主题。</p>\n<p>官网： <a href=\"http://hexo.io\" target=\"_blank\" rel=\"noopener\">http://hexo.io</a><br>github: <a href=\"https://github.com/hexojs/hexo\" target=\"_blank\" rel=\"noopener\">https://github.com/hexojs/hexo</a></p>\n<p>###4.2原理<br>由于github pages存放的都是静态文件，博客存放的不只是文章内容，还有文章列表、分类、标签、翻页等动态内容，假如每次写完一篇文章都要手动更新博文目录和相关链接信息，相信谁都会疯掉，所以hexo所做的就是将这些md文件都放在本地，每次写完文章后调用写好的命令来批量完成相关页面的生成，然后再将有改动的页面提交到github。</p>\n<p><strong>注意事项</strong></p>\n<ol>\n<li>很多命令既可以用Windows的cmd来完成，也可以使用git bash来完成，但是部分命令会有一些问题，为避免不必要的问题，建议全部使用git bash来执行；</li>\n<li>hexo不同版本差别比较大，网上很多文章的配置信息都是基于2.x的，所以注意不要被误导；</li>\n<li>hexo有2种_config.yml文件，一个是根目录下的全局的_config.yml，一个是各个theme下的；</li>\n</ol>\n<p><strong>安装hexo</strong><br><code>$ npm install -g hexo</code><br>若上面的命令失败，建议使用下面的代理命令<br><code>此处输入代码</code></p>\n<p><strong>初始化</strong><br>在电脑的某个地方新建一个名为hexo的文件夹（名字可以随便取），比如我的是<em>F:\\Workspaces\\hexo</em>，由于这个文件夹将来就作为你存放代码的地方，所以最好不要随便放。<br><code>$ cd /f/Workspaces/hexo/</code><br><code>$ hexo init</code><br>hexo会自动下载一些文件到这个目录，包括node_modules。继续执行下面两条命令<br><code>$ hexo g # 生成</code><br><code>$ hexo s # 启动服务</code><br>执行以上命令之后，hexo就会在public文件夹生成相关html文件，这些文件将来都是要提交到github去的。</p>\n<p><strong>hexo s</strong>是开启本地预览服务，打开浏览器访问 <a href=\"http://localhost:4000\" target=\"_blank\" rel=\"noopener\">http://localhost:4000</a> 即可看到内容，很多人会碰到浏览器一直在转圈但是就是加载不出来的问题，一般情况下是因为端口占用的缘故，因为4000这个端口太常见了，解决端口冲突问题请参考这篇文章：</p>\n<p><a href=\"http://blog.liuxianan.com/windows-port-bind.html\" target=\"_blank\" rel=\"noopener\">http://blog.liuxianan.com/windows-port-bind.html</a></p>\n<p>第一次初始化的时候hexo已经帮我们写了一篇名为 Hello World 的文章，默认的主题比较丑。</p>\n<h2 id=\"5-配置主题\"><a href=\"#5-配置主题\" class=\"headerlink\" title=\"5.配置主题\"></a>5.配置主题</h2><h3 id=\"5-1更换主题\"><a href=\"#5-1更换主题\" class=\"headerlink\" title=\"5.1更换主题\"></a>5.1更换主题</h3><p>既然默认主题很丑，那我们别的不做，首先来替换一个好看点的主题。这是 <a href=\"https://hexo.io/themes/\" target=\"_blank\" rel=\"noopener\">官方主题</a>。<br>个人比较喜欢的主题：<a href=\"https://github.com/iissnan/hexo-theme-next\" target=\"_blank\" rel=\"noopener\">hexo-theme-next</a> 和<a href=\"https://github.com/litten/hexo-theme-yilia\" target=\"_blank\" rel=\"noopener\">hexo-theme-yilia</a><br>以next主题为例，首先clone这个主题：</p>\n<p>进入之前建立的hexo目录，在git bash中执行clone命令</p>\n<p><code>$ git clone https://github.com/iissnan/hexo-theme-next.git themes/next</code></p>\n<p>下载的主题到了hexo&gt;theme文件夹下。<br>修改##hexo##根目录下的<strong>_config.yml</strong>文件中的<strong>theme: landscape</strong>改为<strong>theme: yilia</strong>，然后重新执行<strong>hexo g</strong>来重新生成静态文件，<strong>hexo s</strong>部署到本地，<strong>localhost:4000</strong>预览博客效果。</p>\n<p>如果出现一些莫名其妙的问题，可以先执行<strong>hexo clean</strong>来清理一下public的内容，然后再来重新生成和发布。</p>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<h2 id=\"1-前言\"><a href=\"#1-前言\" class=\"headerlink\" title=\"1.前言\"></a>1.前言</h2><p>使用github pages服务搭建博客的好处有：<br>1.全是静态文件，访问速度快；<br>2.免费方便，不用花一分钱就可以搭建一个自由的个人博客，不需要服务器不需要后台；<br>3.可以随意绑定自己的域名，不仔细看的话根本看不出来你的网站是基于github的；<br>4.数据绝对安全，基于github的版本管理，想恢复到哪个历史版本都行；<br>5.博客内容可以轻松打包、转移、发布到其它平台；<br>","more":"<br>6.等等；</p>\n<h3 id=\"1-1准备工作\"><a href=\"#1-1准备工作\" class=\"headerlink\" title=\"1.1准备工作\"></a>1.1准备工作</h3><ul>\n<li>创建github账号       <a href=\"https://github.com/\" target=\"_blank\" rel=\"noopener\">github注册地址</a></li>\n<li>安装node.js、npm     <a href=\"https://nodejs.org/en/download/\" target=\"_blank\" rel=\"noopener\">node.js下载地址</a></li>\n<li>安装git for windows  <a href=\"https://git-scm.com/downloads\" target=\"_blank\" rel=\"noopener\">git下载地址</a></li>\n</ul>\n<p><strong>本文所使用的环境</strong></p>\n<ul>\n<li>windows10</li>\n<li>git@1.9.5</li>\n<li>node.js@6.10.2</li>\n<li>hexo@</li>\n</ul>\n<h2 id=\"2-搭建github博客\"><a href=\"#2-搭建github博客\" class=\"headerlink\" title=\"2.搭建github博客\"></a>2.搭建github博客</h2><h3 id=\"2-1创建仓库\"><a href=\"#2-1创建仓库\" class=\"headerlink\" title=\"2.1创建仓库\"></a>2.1创建仓库</h3><p>登陆github,打开新建页面，如图<img src=\"/images/blog/newRepository.png\" alt=\"步骤一\"><br><img src=\"/images/blog/step2.png\" alt=\"步骤二\"><br>新建仓库名必须为<strong>你的用户名.github.io</strong>,假如说你的用户名是test,那仓库名为test.github.io,将来的博客访问地址就是<a href=\"http://test.github.io\" target=\"_blank\" rel=\"noopener\">http://test.github.io</a> 了，是不是很方便？<br>由此可见，每一个github账户最多只能创建一个这样可以直接使用域名访问的仓库。<br><strong>几个注意的地方：</strong><br>1.注册的邮箱一定要验证，否则不会成功；<br>2.仓库名字必须是：username.github.io，其中username是你的用户名；<br>3.仓库创建成功不会立即生效，需要过一段时间，大概10-30分钟，或者更久</p>\n<p>###2.2绑定域名<br>这一步不是必须，若不绑定则可用默认的<a href=\"http://xxx.github.io来访问，若想自己拥有一个域名，则需要注册，这一步留待以后再将，直接下一步。\" target=\"_blank\" rel=\"noopener\">http://xxx.github.io来访问，若想自己拥有一个域名，则需要注册，这一步留待以后再将，直接下一步。</a></p>\n<h2 id=\"3-配置SSH-key\"><a href=\"#3-配置SSH-key\" class=\"headerlink\" title=\"3.配置SSH key\"></a>3.配置SSH key</h2><p>为什么要配置这个呢？因为你提交代码肯定要拥有你的github权限才可以，但是直接使用用户名和密码太不安全了，所以我们使用ssh key来解决本地和服务器的连接问题。<br>在电脑任意位置进入<strong>git bash</strong><br><code>$ cd ~/. ssh #检查本机已存在的ssh密钥</code><br>如果提示：No such file or directory 说明你是第一次使用git<br><code>ssh-keygen -t rsa -C &quot;邮件地址&quot;</code><br>然后连续3次回车，最终会生成一个文件在用户目录下，打开用户目录，找到<strong>.ssh\\id_rsa.pub</strong>文件，文本编辑器打开并复制里面的内容，打开你的github主页，进入个人设置 -&gt; SSH and GPG keys -&gt; New SSH key：将刚复制的内容粘贴到key那里，title随便填，保存。<br><img src=\"/images/blog/step3.png\" alt=\"步骤三\"><br><strong>测试是否设置成功</strong><br><code>$ ssh -T git@github.com # 注意邮箱地址不用改</code><br>如果提示Are you sure you want to continue connecting (yes/no)?，输入yes，然后会看到：</p>\n<p>Hi xiaoyue! You’ve successfully authenticated, but GitHub does not provide shell access.</p>\n<p>看到这个信息说明SSH已配置成功！<br>此时你还需要配置：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">$ git config --global user.name <span class=\"string\">\"liuxianan\"</span>// 你的github用户名，非昵称</div><div class=\"line\">$ git config --global user.email  <span class=\"string\">\"xxx@qq.com\"</span>// 填写你的github注册邮箱</div></pre></td></tr></table></figure></p>\n<h2 id=\"4-使用hexo写博客\"><a href=\"#4-使用hexo写博客\" class=\"headerlink\" title=\"4.使用hexo写博客\"></a>4.使用hexo写博客</h2><h3 id=\"4-1hexo简介\"><a href=\"#4-1hexo简介\" class=\"headerlink\" title=\"4.1hexo简介\"></a>4.1hexo简介</h3><p>Hexo是一个简单、快速、强大的基于 Github Pages 的博客发布工具，支持Markdown格式，有众多优秀插件和主题。</p>\n<p>官网： <a href=\"http://hexo.io\" target=\"_blank\" rel=\"noopener\">http://hexo.io</a><br>github: <a href=\"https://github.com/hexojs/hexo\" target=\"_blank\" rel=\"noopener\">https://github.com/hexojs/hexo</a></p>\n<p>###4.2原理<br>由于github pages存放的都是静态文件，博客存放的不只是文章内容，还有文章列表、分类、标签、翻页等动态内容，假如每次写完一篇文章都要手动更新博文目录和相关链接信息，相信谁都会疯掉，所以hexo所做的就是将这些md文件都放在本地，每次写完文章后调用写好的命令来批量完成相关页面的生成，然后再将有改动的页面提交到github。</p>\n<p><strong>注意事项</strong></p>\n<ol>\n<li>很多命令既可以用Windows的cmd来完成，也可以使用git bash来完成，但是部分命令会有一些问题，为避免不必要的问题，建议全部使用git bash来执行；</li>\n<li>hexo不同版本差别比较大，网上很多文章的配置信息都是基于2.x的，所以注意不要被误导；</li>\n<li>hexo有2种_config.yml文件，一个是根目录下的全局的_config.yml，一个是各个theme下的；</li>\n</ol>\n<p><strong>安装hexo</strong><br><code>$ npm install -g hexo</code><br>若上面的命令失败，建议使用下面的代理命令<br><code>此处输入代码</code></p>\n<p><strong>初始化</strong><br>在电脑的某个地方新建一个名为hexo的文件夹（名字可以随便取），比如我的是<em>F:\\Workspaces\\hexo</em>，由于这个文件夹将来就作为你存放代码的地方，所以最好不要随便放。<br><code>$ cd /f/Workspaces/hexo/</code><br><code>$ hexo init</code><br>hexo会自动下载一些文件到这个目录，包括node_modules。继续执行下面两条命令<br><code>$ hexo g # 生成</code><br><code>$ hexo s # 启动服务</code><br>执行以上命令之后，hexo就会在public文件夹生成相关html文件，这些文件将来都是要提交到github去的。</p>\n<p><strong>hexo s</strong>是开启本地预览服务，打开浏览器访问 <a href=\"http://localhost:4000\" target=\"_blank\" rel=\"noopener\">http://localhost:4000</a> 即可看到内容，很多人会碰到浏览器一直在转圈但是就是加载不出来的问题，一般情况下是因为端口占用的缘故，因为4000这个端口太常见了，解决端口冲突问题请参考这篇文章：</p>\n<p><a href=\"http://blog.liuxianan.com/windows-port-bind.html\" target=\"_blank\" rel=\"noopener\">http://blog.liuxianan.com/windows-port-bind.html</a></p>\n<p>第一次初始化的时候hexo已经帮我们写了一篇名为 Hello World 的文章，默认的主题比较丑。</p>\n<h2 id=\"5-配置主题\"><a href=\"#5-配置主题\" class=\"headerlink\" title=\"5.配置主题\"></a>5.配置主题</h2><h3 id=\"5-1更换主题\"><a href=\"#5-1更换主题\" class=\"headerlink\" title=\"5.1更换主题\"></a>5.1更换主题</h3><p>既然默认主题很丑，那我们别的不做，首先来替换一个好看点的主题。这是 <a href=\"https://hexo.io/themes/\" target=\"_blank\" rel=\"noopener\">官方主题</a>。<br>个人比较喜欢的主题：<a href=\"https://github.com/iissnan/hexo-theme-next\" target=\"_blank\" rel=\"noopener\">hexo-theme-next</a> 和<a href=\"https://github.com/litten/hexo-theme-yilia\" target=\"_blank\" rel=\"noopener\">hexo-theme-yilia</a><br>以next主题为例，首先clone这个主题：</p>\n<p>进入之前建立的hexo目录，在git bash中执行clone命令</p>\n<p><code>$ git clone https://github.com/iissnan/hexo-theme-next.git themes/next</code></p>\n<p>下载的主题到了hexo&gt;theme文件夹下。<br>修改##hexo##根目录下的<strong>_config.yml</strong>文件中的<strong>theme: landscape</strong>改为<strong>theme: yilia</strong>，然后重新执行<strong>hexo g</strong>来重新生成静态文件，<strong>hexo s</strong>部署到本地，<strong>localhost:4000</strong>预览博客效果。</p>\n<p>如果出现一些莫名其妙的问题，可以先执行<strong>hexo clean</strong>来清理一下public的内容，然后再来重新生成和发布。</p>"},{"title":"Struts2(4)——数据封装和类型转换","date":"2017-12-21T02:10:28.000Z","_content":"\n![数据封装][1]\n<!--more-->\n\n## 数据封装\n\n### 静态参数封装\n\n 1. 静态参数即在action中固定不变的参数，在struts.xml中配置action时赋值。\n\n    ```xml\n    <package name=\"login\" namespace=\"/\" extends=\"struts-default\">\n    \t<action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n    \t\t<param name=\"username\">xiaoyue</param>\n    \t\t<param name=\"password\">123456</param>\n    \t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n    \t</action>\n    </package>\n    ```\n\n 2. 在action中创建对应属性，提供getter和setter方法。\n\n    ```java\n    @Controller\n    @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n    public class LoginAction extends BaseAction{\n        private static final long serialVersionUID = -4442251270114214406L;\n        private String username;\n        private String password;\n        \n        public String loginTest() {\n            System.out.println(username);\n            System.out.println(password);\n            return SUCCESS;\n        }\n        \n        public String getUsername() {\n            return username;\n        }\n        public void setUsername(String username) {\n            this.username = username;\n        }\n        public String getPassword() {\n            return password;\n        }\n        public void setPassword(String password) {\n            this.password = password;\n        }\n    }\n    ```\n输出结果\n    ```java\n    xiaoyue\n    123456\n    ```\n    \n静态参数封装依赖的是静态参数拦截器staticParams。\n![staticParams][2]\n该拦截器会将静态参数放入值栈中，而action就在值栈中的栈顶，自然就会找到该action中的对应属性，然后进行赋值了。想查看源码，参考该篇博文：[struts2 18拦截器详解(十四) --- StaticParametersInterceptor][3]\n\n### 动态参数封装\n\n属性驱动和模型驱动都非常重要，都需要掌握，如果还不会ognl表达式，那么可以在学完ognl表达后在回过头来看即可。\n\n#### 属性驱动\n\n 1. 基本属性驱动\n\n    表单：\n    ```jsp\n    <form action=\"aaa/loginTest.tv\" method=\"post\">\n    \t<input type=\"text\" name=\"username\">\n    \t<button type=\"submit\">提交</button>\n    </form>  \n    ```\n    action：提供对应属性及getter和setter方法\n    ```java\n    private String username;\n    public String getUsername() {\n        return username;\n    }\n    public void setUsername(String username) {\n        this.username = username;\n    }\n    ```\n    \n    依赖params拦截器注入数据\n    ![params][4]\n    该拦截器做的事有两件，一是对提交的参数进行数据校验，判断是否合法，判断是否合法的标准就是拦截器中的excludeParams参数的正则表达式的值。二是将其封装到值栈中的栈顶元素中去，而当前action就在栈顶，所以能够将参数放入action中。通过查看[struts2 18拦截器详解(十五) --- ParametersInterceptor][5]来了解其源码 。\n    \n 2. ognl属性驱动\n\n    表单，封装对象\n    ```jsp\n    <form action=\"aaa/loginTest.tv\" method=\"post\">\n    \t姓名：<input type=\"text\" name=\"user.username\"><br>\n    \t年龄：<input type=\"text\" name=\"user.age\"><br>\n    \t<button type=\"submit\">提交</button>\n    </form>\n    ```\n    创建JavaBean对象\n    ```java\n    public class User implements Serializable {\n        private static final long serialVersionUID = 4340332295972232437L;\n        private String username;\n        private int age;\n        public String getUsername() {\n            return username;\n        }\n        public void setUsername(String username) {\n            this.username = username;\n        }\n        public int getAge() {\n            return age;\n        }\n        public void setAge(int age) {\n            this.age = age;\n        }\n    }\n    ```\n    Action接收：创建对象，提供getter和setter\n    ```java\n    private User user = new User();\n    \n    public User getUser() {\n        return user;\n    }\n\n    public void setUser(User user) {\n        this.user = user;\n    }\n    ```\n    \n    在jsp页面中的user.username和user.age其实就是ognl表达式，代表着往根(root，值栈valueStack)中存放值，而值栈中的栈顶元素也就是为当前action，我们在action中设置user的get、set属性，即可以让存进来的值匹配到，进而将对应属性赋值成功。\n \n#### 模型驱动\n\n 实现ModelDriven接口，提供一个方法getModel()，编写对象实例。\n \n jsp表单：\n```jsp\n<form action=\"aaa/loginTest.tv\" method=\"post\">\n    姓名：<input type=\"text\" name=\"user.username\"><br>\n    年龄：<input type=\"text\" name=\"user.age\"><br>\n    <button type=\"submit\">提交</button>\n</form> \n```\n\nAction类实现ModelDriven接口，提供getModel()方法\n```java\nprivate User user = new User();\n    \n@Override\npublic User getModel() {\n    return null;\n}\n```\n\n分析：这有一个专门的拦截器，叫做modelDriven。\n![modelDriven][6]\n源码分析：[struts2 18拦截器详解(十) --- ModelDrivenInterceptor][7]\n其实原理就是，该拦截器将getModel方法返回的结果压入值栈，而我们的表单参数会从值栈中从上往下进行查找，自然就直接将参数封装到User对象中了。\n\n\n## 类型转换\n\n从表单元素提交过来的都是String类型的，而我们在servlet中获取到表单元素后，得到的是Object类型，也就是需要我们自己手动转型，但是在struts2中，我们却不需要，是因为有这么一个机制，参数类型自动转型，获取过来的参数都是String类型的，但是如果我们需要int型，double型等，都会帮我们自己转换。\n\n这里需要注意一点，在使用struts2中的日期自动转型时，表单中的日期字符串的格式是固定的，必须是2014-12-06，也就是yyyy-mm-dd这样的格式，其他格式的话，不能够转型成功，这对有些人来说，就有些不舒服，使用习惯不一样，但是没关系，struts2能够让我们自定义类型转换器，格式让我们自己来决定。\n\n例如：表单输入**2013-12-23**，接收date为**Tue Dec 23 00:00:00 CST 2014**\n\n### 自定义类型转换器\n\n 1. 编写转换器类继承StrutsTypeConverter,实现两个抽象方法\n\n    ```java\n    public class DateConverter extends StrutsTypeConverter{\n        \n        SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");\n        /* \n         * context:struts2的数据中心\n         * values:输入的数据\n         * toClass:要转换成的类型\n         */\n        @Override\n        public Object convertFromString(Map context, String[] values, Class toClass) {\n            if (values != null && values.length > 0) {\n                String value = values[0];\n                if (toClass == Date.class) {\n                    try {\n                        return sdf.parse(value);\n                    } catch (ParseException e) {\n                        e.printStackTrace();\n                    }\n                }\n            }\n            return null;\n        }\n    \n        @Override\n        public String convertToString(Map context, Object o) {\n            if (o != null && o.getClass() == Date.class) {\n                return sdf.format(o);\n            }\n            return null;\n        }\n    \n    }\n    ```\n\n 2. 注册类型转换器\n \n    ![转换器位置说明][8]\n\n    2.1 注册局部转换器\n    \n    在需要转换的Action同级目录，创建一个properties.\n    位置：action类同包\n    名称：actionClass-conversion.properties\n    actionClass:action类的类名\n    conversion.properties：固定名\n    \n    文件内容：\n    ```properties\n    date = com.topvision.s2sm.plantform.converter.DateConverter\n    ```\n    \n    2.2 注册全局转换\n    \n    在src下创建一个properties。\n    位置：src\n    名称：xwork-conversion.properties 固定写法\n    文件内容：\n    ```properties\n    java.util.date = com.topvision.s2sm.plantform.converter.DateConverter\n    ```\n    \n\n \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/dataTransform.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/staticParam.png\n  [3]: http://blog.csdn.net/xtayfjpk/article/details/14133589\n  [4]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/params.png\n  [5]: http://blog.csdn.net/xtayfjpk/article/details/14180981\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/modelDriven.png\n  [7]: http://blog.csdn.net/xtayfjpk/article/details/14004457\n  [8]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/conversion.png","source":"_posts/Struts2-4-——数据封装和类型转换.md","raw":"---\ntitle: Struts2(4)——数据封装和类型转换\ncategories:\n  - Struts2\ntags:\n  - Struts2\ndate: 2017-12-21 10:10:28\n---\n\n![数据封装][1]\n<!--more-->\n\n## 数据封装\n\n### 静态参数封装\n\n 1. 静态参数即在action中固定不变的参数，在struts.xml中配置action时赋值。\n\n    ```xml\n    <package name=\"login\" namespace=\"/\" extends=\"struts-default\">\n    \t<action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n    \t\t<param name=\"username\">xiaoyue</param>\n    \t\t<param name=\"password\">123456</param>\n    \t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n    \t</action>\n    </package>\n    ```\n\n 2. 在action中创建对应属性，提供getter和setter方法。\n\n    ```java\n    @Controller\n    @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n    public class LoginAction extends BaseAction{\n        private static final long serialVersionUID = -4442251270114214406L;\n        private String username;\n        private String password;\n        \n        public String loginTest() {\n            System.out.println(username);\n            System.out.println(password);\n            return SUCCESS;\n        }\n        \n        public String getUsername() {\n            return username;\n        }\n        public void setUsername(String username) {\n            this.username = username;\n        }\n        public String getPassword() {\n            return password;\n        }\n        public void setPassword(String password) {\n            this.password = password;\n        }\n    }\n    ```\n输出结果\n    ```java\n    xiaoyue\n    123456\n    ```\n    \n静态参数封装依赖的是静态参数拦截器staticParams。\n![staticParams][2]\n该拦截器会将静态参数放入值栈中，而action就在值栈中的栈顶，自然就会找到该action中的对应属性，然后进行赋值了。想查看源码，参考该篇博文：[struts2 18拦截器详解(十四) --- StaticParametersInterceptor][3]\n\n### 动态参数封装\n\n属性驱动和模型驱动都非常重要，都需要掌握，如果还不会ognl表达式，那么可以在学完ognl表达后在回过头来看即可。\n\n#### 属性驱动\n\n 1. 基本属性驱动\n\n    表单：\n    ```jsp\n    <form action=\"aaa/loginTest.tv\" method=\"post\">\n    \t<input type=\"text\" name=\"username\">\n    \t<button type=\"submit\">提交</button>\n    </form>  \n    ```\n    action：提供对应属性及getter和setter方法\n    ```java\n    private String username;\n    public String getUsername() {\n        return username;\n    }\n    public void setUsername(String username) {\n        this.username = username;\n    }\n    ```\n    \n    依赖params拦截器注入数据\n    ![params][4]\n    该拦截器做的事有两件，一是对提交的参数进行数据校验，判断是否合法，判断是否合法的标准就是拦截器中的excludeParams参数的正则表达式的值。二是将其封装到值栈中的栈顶元素中去，而当前action就在栈顶，所以能够将参数放入action中。通过查看[struts2 18拦截器详解(十五) --- ParametersInterceptor][5]来了解其源码 。\n    \n 2. ognl属性驱动\n\n    表单，封装对象\n    ```jsp\n    <form action=\"aaa/loginTest.tv\" method=\"post\">\n    \t姓名：<input type=\"text\" name=\"user.username\"><br>\n    \t年龄：<input type=\"text\" name=\"user.age\"><br>\n    \t<button type=\"submit\">提交</button>\n    </form>\n    ```\n    创建JavaBean对象\n    ```java\n    public class User implements Serializable {\n        private static final long serialVersionUID = 4340332295972232437L;\n        private String username;\n        private int age;\n        public String getUsername() {\n            return username;\n        }\n        public void setUsername(String username) {\n            this.username = username;\n        }\n        public int getAge() {\n            return age;\n        }\n        public void setAge(int age) {\n            this.age = age;\n        }\n    }\n    ```\n    Action接收：创建对象，提供getter和setter\n    ```java\n    private User user = new User();\n    \n    public User getUser() {\n        return user;\n    }\n\n    public void setUser(User user) {\n        this.user = user;\n    }\n    ```\n    \n    在jsp页面中的user.username和user.age其实就是ognl表达式，代表着往根(root，值栈valueStack)中存放值，而值栈中的栈顶元素也就是为当前action，我们在action中设置user的get、set属性，即可以让存进来的值匹配到，进而将对应属性赋值成功。\n \n#### 模型驱动\n\n 实现ModelDriven接口，提供一个方法getModel()，编写对象实例。\n \n jsp表单：\n```jsp\n<form action=\"aaa/loginTest.tv\" method=\"post\">\n    姓名：<input type=\"text\" name=\"user.username\"><br>\n    年龄：<input type=\"text\" name=\"user.age\"><br>\n    <button type=\"submit\">提交</button>\n</form> \n```\n\nAction类实现ModelDriven接口，提供getModel()方法\n```java\nprivate User user = new User();\n    \n@Override\npublic User getModel() {\n    return null;\n}\n```\n\n分析：这有一个专门的拦截器，叫做modelDriven。\n![modelDriven][6]\n源码分析：[struts2 18拦截器详解(十) --- ModelDrivenInterceptor][7]\n其实原理就是，该拦截器将getModel方法返回的结果压入值栈，而我们的表单参数会从值栈中从上往下进行查找，自然就直接将参数封装到User对象中了。\n\n\n## 类型转换\n\n从表单元素提交过来的都是String类型的，而我们在servlet中获取到表单元素后，得到的是Object类型，也就是需要我们自己手动转型，但是在struts2中，我们却不需要，是因为有这么一个机制，参数类型自动转型，获取过来的参数都是String类型的，但是如果我们需要int型，double型等，都会帮我们自己转换。\n\n这里需要注意一点，在使用struts2中的日期自动转型时，表单中的日期字符串的格式是固定的，必须是2014-12-06，也就是yyyy-mm-dd这样的格式，其他格式的话，不能够转型成功，这对有些人来说，就有些不舒服，使用习惯不一样，但是没关系，struts2能够让我们自定义类型转换器，格式让我们自己来决定。\n\n例如：表单输入**2013-12-23**，接收date为**Tue Dec 23 00:00:00 CST 2014**\n\n### 自定义类型转换器\n\n 1. 编写转换器类继承StrutsTypeConverter,实现两个抽象方法\n\n    ```java\n    public class DateConverter extends StrutsTypeConverter{\n        \n        SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");\n        /* \n         * context:struts2的数据中心\n         * values:输入的数据\n         * toClass:要转换成的类型\n         */\n        @Override\n        public Object convertFromString(Map context, String[] values, Class toClass) {\n            if (values != null && values.length > 0) {\n                String value = values[0];\n                if (toClass == Date.class) {\n                    try {\n                        return sdf.parse(value);\n                    } catch (ParseException e) {\n                        e.printStackTrace();\n                    }\n                }\n            }\n            return null;\n        }\n    \n        @Override\n        public String convertToString(Map context, Object o) {\n            if (o != null && o.getClass() == Date.class) {\n                return sdf.format(o);\n            }\n            return null;\n        }\n    \n    }\n    ```\n\n 2. 注册类型转换器\n \n    ![转换器位置说明][8]\n\n    2.1 注册局部转换器\n    \n    在需要转换的Action同级目录，创建一个properties.\n    位置：action类同包\n    名称：actionClass-conversion.properties\n    actionClass:action类的类名\n    conversion.properties：固定名\n    \n    文件内容：\n    ```properties\n    date = com.topvision.s2sm.plantform.converter.DateConverter\n    ```\n    \n    2.2 注册全局转换\n    \n    在src下创建一个properties。\n    位置：src\n    名称：xwork-conversion.properties 固定写法\n    文件内容：\n    ```properties\n    java.util.date = com.topvision.s2sm.plantform.converter.DateConverter\n    ```\n    \n\n \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/dataTransform.png\n  [2]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/staticParam.png\n  [3]: http://blog.csdn.net/xtayfjpk/article/details/14133589\n  [4]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/params.png\n  [5]: http://blog.csdn.net/xtayfjpk/article/details/14180981\n  [6]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/modelDriven.png\n  [7]: http://blog.csdn.net/xtayfjpk/article/details/14004457\n  [8]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/conversion.png","slug":"Struts2-4-——数据封装和类型转换","published":1,"updated":"2018-02-27T07:38:38.094Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfv4003hhwvfewdqh7zn","content":"<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/dataTransform.png\" alt=\"数据封装\"><br><a id=\"more\"></a></p>\n<h2 id=\"数据封装\"><a href=\"#数据封装\" class=\"headerlink\" title=\"数据封装\"></a>数据封装</h2><h3 id=\"静态参数封装\"><a href=\"#静态参数封装\" class=\"headerlink\" title=\"静态参数封装\"></a>静态参数封装</h3><ol>\n<li><p>静态参数即在action中固定不变的参数，在struts.xml中配置action时赋值。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"login\"</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"/\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span>&gt;</span>xiaoyue<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span>&gt;</span>123456<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>在action中创建对应属性，提供getter和setter方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Controller</span></div><div class=\"line\"><span class=\"meta\">@Scope</span>(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LoginAction</span> <span class=\"keyword\">extends</span> <span class=\"title\">BaseAction</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">4442251270114214406L</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String username;</div><div class=\"line\">    <span class=\"keyword\">private</span> String password;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">loginTest</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        System.out.println(username);</div><div class=\"line\">        System.out.println(password);</div><div class=\"line\">        <span class=\"keyword\">return</span> SUCCESS;</div><div class=\"line\">    &#125;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUsername</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> username;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUsername</span><span class=\"params\">(String username)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.username = username;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getPassword</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> password;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setPassword</span><span class=\"params\">(String password)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.password = password;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>输出结果<br>    <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">xiaoyue</div><div class=\"line\"><span class=\"number\">123456</span></div></pre></td></tr></table></figure></p>\n<p>静态参数封装依赖的是静态参数拦截器staticParams。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/staticParam.png\" alt=\"staticParams\"><br>该拦截器会将静态参数放入值栈中，而action就在值栈中的栈顶，自然就会找到该action中的对应属性，然后进行赋值了。想查看源码，参考该篇博文：<a href=\"http://blog.csdn.net/xtayfjpk/article/details/14133589\" target=\"_blank\" rel=\"noopener\">struts2 18拦截器详解(十四) — StaticParametersInterceptor</a></p>\n<h3 id=\"动态参数封装\"><a href=\"#动态参数封装\" class=\"headerlink\" title=\"动态参数封装\"></a>动态参数封装</h3><p>属性驱动和模型驱动都非常重要，都需要掌握，如果还不会ognl表达式，那么可以在学完ognl表达后在回过头来看即可。</p>\n<h4 id=\"属性驱动\"><a href=\"#属性驱动\" class=\"headerlink\" title=\"属性驱动\"></a>属性驱动</h4><ol>\n<li><p>基本属性驱动</p>\n<p>表单：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;form action=\"aaa/loginTest.tv\" method=\"post\"&gt;</div><div class=\"line\">\t&lt;input type=\"text\" name=\"username\"&gt;</div><div class=\"line\">\t&lt;button type=\"submit\"&gt;提交&lt;/button&gt;</div><div class=\"line\">&lt;/form&gt;</div></pre></td></tr></table></figure>\n<p>action：提供对应属性及getter和setter方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> String username;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUsername</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> username;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUsername</span><span class=\"params\">(String username)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.username = username;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>依赖params拦截器注入数据\n![params][4]\n该拦截器做的事有两件，一是对提交的参数进行数据校验，判断是否合法，判断是否合法的标准就是拦截器中的excludeParams参数的正则表达式的值。二是将其封装到值栈中的栈顶元素中去，而当前action就在栈顶，所以能够将参数放入action中。通过查看[struts2 18拦截器详解(十五) --- ParametersInterceptor][5]来了解其源码 。\n</code></pre><ol>\n<li><p>ognl属性驱动</p>\n<p>表单，封装对象</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;form action=\"aaa/loginTest.tv\" method=\"post\"&gt;</div><div class=\"line\">\t姓名：&lt;input type=\"text\" name=\"user.username\"&gt;&lt;br&gt;</div><div class=\"line\">\t年龄：&lt;input type=\"text\" name=\"user.age\"&gt;&lt;br&gt;</div><div class=\"line\">\t&lt;button type=\"submit\"&gt;提交&lt;/button&gt;</div><div class=\"line\">&lt;/form&gt;</div></pre></td></tr></table></figure>\n<p>创建JavaBean对象</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> <span class=\"keyword\">implements</span> <span class=\"title\">Serializable</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">4340332295972232437L</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String username;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> age;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUsername</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> username;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUsername</span><span class=\"params\">(String username)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.username = username;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getAge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> age;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setAge</span><span class=\"params\">(<span class=\"keyword\">int</span> age)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.age = age;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Action接收：创建对象，提供getter和setter</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> User user = <span class=\"keyword\">new</span> User();</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">getUser</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> user;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUser</span><span class=\"params\">(User user)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.user = user;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>在jsp页面中的user.username和user.age其实就是ognl表达式，代表着往根(root，值栈valueStack)中存放值，而值栈中的栈顶元素也就是为当前action，我们在action中设置user的get、set属性，即可以让存进来的值匹配到，进而将对应属性赋值成功。\n</code></pre><h4 id=\"模型驱动\"><a href=\"#模型驱动\" class=\"headerlink\" title=\"模型驱动\"></a>模型驱动</h4><p> 实现ModelDriven接口，提供一个方法getModel()，编写对象实例。</p>\n<p> jsp表单：<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;form action=\"aaa/loginTest.tv\" method=\"post\"&gt;</div><div class=\"line\">    姓名：&lt;input type=\"text\" name=\"user.username\"&gt;&lt;br&gt;</div><div class=\"line\">    年龄：&lt;input type=\"text\" name=\"user.age\"&gt;&lt;br&gt;</div><div class=\"line\">    &lt;button type=\"submit\"&gt;提交&lt;/button&gt;</div><div class=\"line\">&lt;/form&gt;</div></pre></td></tr></table></figure></p>\n<p>Action类实现ModelDriven接口，提供getModel()方法<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> User user = <span class=\"keyword\">new</span> User();</div><div class=\"line\">    </div><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">getModel</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>分析：这有一个专门的拦截器，叫做modelDriven。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/modelDriven.png\" alt=\"modelDriven\"><br>源码分析：<a href=\"http://blog.csdn.net/xtayfjpk/article/details/14004457\" target=\"_blank\" rel=\"noopener\">struts2 18拦截器详解(十) — ModelDrivenInterceptor</a><br>其实原理就是，该拦截器将getModel方法返回的结果压入值栈，而我们的表单参数会从值栈中从上往下进行查找，自然就直接将参数封装到User对象中了。</p>\n<h2 id=\"类型转换\"><a href=\"#类型转换\" class=\"headerlink\" title=\"类型转换\"></a>类型转换</h2><p>从表单元素提交过来的都是String类型的，而我们在servlet中获取到表单元素后，得到的是Object类型，也就是需要我们自己手动转型，但是在struts2中，我们却不需要，是因为有这么一个机制，参数类型自动转型，获取过来的参数都是String类型的，但是如果我们需要int型，double型等，都会帮我们自己转换。</p>\n<p>这里需要注意一点，在使用struts2中的日期自动转型时，表单中的日期字符串的格式是固定的，必须是2014-12-06，也就是yyyy-mm-dd这样的格式，其他格式的话，不能够转型成功，这对有些人来说，就有些不舒服，使用习惯不一样，但是没关系，struts2能够让我们自定义类型转换器，格式让我们自己来决定。</p>\n<p>例如：表单输入<strong>2013-12-23</strong>，接收date为<strong>Tue Dec 23 00:00:00 CST 2014</strong></p>\n<h3 id=\"自定义类型转换器\"><a href=\"#自定义类型转换器\" class=\"headerlink\" title=\"自定义类型转换器\"></a>自定义类型转换器</h3><ol>\n<li><p>编写转换器类继承StrutsTypeConverter,实现两个抽象方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DateConverter</span> <span class=\"keyword\">extends</span> <span class=\"title\">StrutsTypeConverter</span></span>&#123;</div><div class=\"line\">    </div><div class=\"line\">    SimpleDateFormat sdf = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">\"yyyy-MM-dd\"</span>);</div><div class=\"line\">    <span class=\"comment\">/* </span></div><div class=\"line\">     * context:struts2的数据中心</div><div class=\"line\">     * values:输入的数据</div><div class=\"line\">     * toClass:要转换成的类型</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">convertFromString</span><span class=\"params\">(Map context, String[] values, Class toClass)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (values != <span class=\"keyword\">null</span> &amp;&amp; values.length &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            String value = values[<span class=\"number\">0</span>];</div><div class=\"line\">            <span class=\"keyword\">if</span> (toClass == Date.class) &#123;</div><div class=\"line\">                <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                    <span class=\"keyword\">return</span> sdf.parse(value);</div><div class=\"line\">                &#125; <span class=\"keyword\">catch</span> (ParseException e) &#123;</div><div class=\"line\">                    e.printStackTrace();</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">convertToString</span><span class=\"params\">(Map context, Object o)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (o != <span class=\"keyword\">null</span> &amp;&amp; o.getClass() == Date.class) &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> sdf.format(o);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>注册类型转换器</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/conversion.png\" alt=\"转换器位置说明\"></p>\n<p>2.1 注册局部转换器</p>\n<p>在需要转换的Action同级目录，创建一个properties.<br>位置：action类同包<br>名称：actionClass-conversion.properties<br>actionClass:action类的类名<br>conversion.properties：固定名</p>\n<p>文件内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">date = com.topvision.s2sm.plantform.converter.DateConverter</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>2.2 注册全局转换\n\n在src下创建一个properties。\n位置：src\n名称：xwork-conversion.properties 固定写法\n文件内容：\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">java.util.date = com.topvision.s2sm.plantform.converter.DateConverter</div></pre></td></tr></table></figure>\n</code></pre>","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/dataTransform.png\" alt=\"数据封装\"><br>","more":"</p>\n<h2 id=\"数据封装\"><a href=\"#数据封装\" class=\"headerlink\" title=\"数据封装\"></a>数据封装</h2><h3 id=\"静态参数封装\"><a href=\"#静态参数封装\" class=\"headerlink\" title=\"静态参数封装\"></a>静态参数封装</h3><ol>\n<li><p>静态参数即在action中固定不变的参数，在struts.xml中配置action时赋值。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"login\"</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"/\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span>&gt;</span>xiaoyue<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span>&gt;</span>123456<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>在action中创建对应属性，提供getter和setter方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Controller</span></div><div class=\"line\"><span class=\"meta\">@Scope</span>(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LoginAction</span> <span class=\"keyword\">extends</span> <span class=\"title\">BaseAction</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">4442251270114214406L</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String username;</div><div class=\"line\">    <span class=\"keyword\">private</span> String password;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">loginTest</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        System.out.println(username);</div><div class=\"line\">        System.out.println(password);</div><div class=\"line\">        <span class=\"keyword\">return</span> SUCCESS;</div><div class=\"line\">    &#125;</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUsername</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> username;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUsername</span><span class=\"params\">(String username)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.username = username;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getPassword</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> password;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setPassword</span><span class=\"params\">(String password)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.password = password;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>输出结果<br>    <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">xiaoyue</div><div class=\"line\"><span class=\"number\">123456</span></div></pre></td></tr></table></figure></p>\n<p>静态参数封装依赖的是静态参数拦截器staticParams。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/staticParam.png\" alt=\"staticParams\"><br>该拦截器会将静态参数放入值栈中，而action就在值栈中的栈顶，自然就会找到该action中的对应属性，然后进行赋值了。想查看源码，参考该篇博文：<a href=\"http://blog.csdn.net/xtayfjpk/article/details/14133589\" target=\"_blank\" rel=\"noopener\">struts2 18拦截器详解(十四) — StaticParametersInterceptor</a></p>\n<h3 id=\"动态参数封装\"><a href=\"#动态参数封装\" class=\"headerlink\" title=\"动态参数封装\"></a>动态参数封装</h3><p>属性驱动和模型驱动都非常重要，都需要掌握，如果还不会ognl表达式，那么可以在学完ognl表达后在回过头来看即可。</p>\n<h4 id=\"属性驱动\"><a href=\"#属性驱动\" class=\"headerlink\" title=\"属性驱动\"></a>属性驱动</h4><ol>\n<li><p>基本属性驱动</p>\n<p>表单：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;form action=\"aaa/loginTest.tv\" method=\"post\"&gt;</div><div class=\"line\">\t&lt;input type=\"text\" name=\"username\"&gt;</div><div class=\"line\">\t&lt;button type=\"submit\"&gt;提交&lt;/button&gt;</div><div class=\"line\">&lt;/form&gt;</div></pre></td></tr></table></figure>\n<p>action：提供对应属性及getter和setter方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> String username;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUsername</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> username;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUsername</span><span class=\"params\">(String username)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.username = username;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>依赖params拦截器注入数据\n![params][4]\n该拦截器做的事有两件，一是对提交的参数进行数据校验，判断是否合法，判断是否合法的标准就是拦截器中的excludeParams参数的正则表达式的值。二是将其封装到值栈中的栈顶元素中去，而当前action就在栈顶，所以能够将参数放入action中。通过查看[struts2 18拦截器详解(十五) --- ParametersInterceptor][5]来了解其源码 。\n</code></pre><ol>\n<li><p>ognl属性驱动</p>\n<p>表单，封装对象</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;form action=\"aaa/loginTest.tv\" method=\"post\"&gt;</div><div class=\"line\">\t姓名：&lt;input type=\"text\" name=\"user.username\"&gt;&lt;br&gt;</div><div class=\"line\">\t年龄：&lt;input type=\"text\" name=\"user.age\"&gt;&lt;br&gt;</div><div class=\"line\">\t&lt;button type=\"submit\"&gt;提交&lt;/button&gt;</div><div class=\"line\">&lt;/form&gt;</div></pre></td></tr></table></figure>\n<p>创建JavaBean对象</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> <span class=\"keyword\">implements</span> <span class=\"title\">Serializable</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">4340332295972232437L</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String username;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> age;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUsername</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> username;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUsername</span><span class=\"params\">(String username)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.username = username;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">int</span> <span class=\"title\">getAge</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> age;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setAge</span><span class=\"params\">(<span class=\"keyword\">int</span> age)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.age = age;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>Action接收：创建对象，提供getter和setter</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> User user = <span class=\"keyword\">new</span> User();</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">getUser</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> user;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUser</span><span class=\"params\">(User user)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">this</span>.user = user;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>在jsp页面中的user.username和user.age其实就是ognl表达式，代表着往根(root，值栈valueStack)中存放值，而值栈中的栈顶元素也就是为当前action，我们在action中设置user的get、set属性，即可以让存进来的值匹配到，进而将对应属性赋值成功。\n</code></pre><h4 id=\"模型驱动\"><a href=\"#模型驱动\" class=\"headerlink\" title=\"模型驱动\"></a>模型驱动</h4><p> 实现ModelDriven接口，提供一个方法getModel()，编写对象实例。</p>\n<p> jsp表单：<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;form action=\"aaa/loginTest.tv\" method=\"post\"&gt;</div><div class=\"line\">    姓名：&lt;input type=\"text\" name=\"user.username\"&gt;&lt;br&gt;</div><div class=\"line\">    年龄：&lt;input type=\"text\" name=\"user.age\"&gt;&lt;br&gt;</div><div class=\"line\">    &lt;button type=\"submit\"&gt;提交&lt;/button&gt;</div><div class=\"line\">&lt;/form&gt;</div></pre></td></tr></table></figure></p>\n<p>Action类实现ModelDriven接口，提供getModel()方法<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">private</span> User user = <span class=\"keyword\">new</span> User();</div><div class=\"line\">    </div><div class=\"line\"><span class=\"meta\">@Override</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">getModel</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>分析：这有一个专门的拦截器，叫做modelDriven。<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/modelDriven.png\" alt=\"modelDriven\"><br>源码分析：<a href=\"http://blog.csdn.net/xtayfjpk/article/details/14004457\" target=\"_blank\" rel=\"noopener\">struts2 18拦截器详解(十) — ModelDrivenInterceptor</a><br>其实原理就是，该拦截器将getModel方法返回的结果压入值栈，而我们的表单参数会从值栈中从上往下进行查找，自然就直接将参数封装到User对象中了。</p>\n<h2 id=\"类型转换\"><a href=\"#类型转换\" class=\"headerlink\" title=\"类型转换\"></a>类型转换</h2><p>从表单元素提交过来的都是String类型的，而我们在servlet中获取到表单元素后，得到的是Object类型，也就是需要我们自己手动转型，但是在struts2中，我们却不需要，是因为有这么一个机制，参数类型自动转型，获取过来的参数都是String类型的，但是如果我们需要int型，double型等，都会帮我们自己转换。</p>\n<p>这里需要注意一点，在使用struts2中的日期自动转型时，表单中的日期字符串的格式是固定的，必须是2014-12-06，也就是yyyy-mm-dd这样的格式，其他格式的话，不能够转型成功，这对有些人来说，就有些不舒服，使用习惯不一样，但是没关系，struts2能够让我们自定义类型转换器，格式让我们自己来决定。</p>\n<p>例如：表单输入<strong>2013-12-23</strong>，接收date为<strong>Tue Dec 23 00:00:00 CST 2014</strong></p>\n<h3 id=\"自定义类型转换器\"><a href=\"#自定义类型转换器\" class=\"headerlink\" title=\"自定义类型转换器\"></a>自定义类型转换器</h3><ol>\n<li><p>编写转换器类继承StrutsTypeConverter,实现两个抽象方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DateConverter</span> <span class=\"keyword\">extends</span> <span class=\"title\">StrutsTypeConverter</span></span>&#123;</div><div class=\"line\">    </div><div class=\"line\">    SimpleDateFormat sdf = <span class=\"keyword\">new</span> SimpleDateFormat(<span class=\"string\">\"yyyy-MM-dd\"</span>);</div><div class=\"line\">    <span class=\"comment\">/* </span></div><div class=\"line\">     * context:struts2的数据中心</div><div class=\"line\">     * values:输入的数据</div><div class=\"line\">     * toClass:要转换成的类型</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">convertFromString</span><span class=\"params\">(Map context, String[] values, Class toClass)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (values != <span class=\"keyword\">null</span> &amp;&amp; values.length &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            String value = values[<span class=\"number\">0</span>];</div><div class=\"line\">            <span class=\"keyword\">if</span> (toClass == Date.class) &#123;</div><div class=\"line\">                <span class=\"keyword\">try</span> &#123;</div><div class=\"line\">                    <span class=\"keyword\">return</span> sdf.parse(value);</div><div class=\"line\">                &#125; <span class=\"keyword\">catch</span> (ParseException e) &#123;</div><div class=\"line\">                    e.printStackTrace();</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"meta\">@Override</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">convertToString</span><span class=\"params\">(Map context, Object o)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (o != <span class=\"keyword\">null</span> &amp;&amp; o.getClass() == Date.class) &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> sdf.format(o);</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>注册类型转换器</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/conversion.png\" alt=\"转换器位置说明\"></p>\n<p>2.1 注册局部转换器</p>\n<p>在需要转换的Action同级目录，创建一个properties.<br>位置：action类同包<br>名称：actionClass-conversion.properties<br>actionClass:action类的类名<br>conversion.properties：固定名</p>\n<p>文件内容：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">date = com.topvision.s2sm.plantform.converter.DateConverter</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>2.2 注册全局转换\n\n在src下创建一个properties。\n位置：src\n名称：xwork-conversion.properties 固定写法\n文件内容：\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">java.util.date = com.topvision.s2sm.plantform.converter.DateConverter</div></pre></td></tr></table></figure>\n</code></pre>"},{"title":"html5+常用功能","date":"2017-05-19T10:09:53.000Z","_content":"这篇博文介绍了html5+在webApp开发中经常使用的功能模块\n<!--more-->\n## 获取wifi信息 ##\n\n 1. 获取wifi的IP\n``` javascript\nfunction getOnuIp() {\n    if(mui.os.android) {\n        var Context = plus.android.importClass(\"android.content.Context\");\n        var WifiManager = plus.android.importClass(\"android.net.wifi.WifiManager\");\n        var WifiInfo = plus.android.importClass(\"android.net.wifi.WifiInfo\");\n\n        var wifiManager = plus.android.runtimeMainActivity().getSystemService(Context.WIFI_SERVICE);\n        var wifiInfo = wifiManager.getConnectionInfo();\n        var ipAddress = wifiInfo.getIpAddress();\n        if(ipAddress == 0) return \"未连接wifi\";\n        return((ipAddress & 0xff) + \".\" + (ipAddress >> 8 & 0xff) + \".\" + (ipAddress >> 16 & 0xff) + \".\" + (ipAddress >> 24 & 0xff));\n    } else if(mui.os.ios) {\n        mui.toast(\"ios暂未获\");\n    }\n}\n```\n\n 2. 获取wifi的网关\n```javascript\nfunction getOnuIp() {\n    if(mui.os.android) {\n        var Context = plus.android.importClass(\"android.content.Context\");\n        var WifiManager = plus.android.importClass(\"android.net.wifi.WifiManager\");\n        var WifiInfo = plus.android.importClass(\"android.net.wifi.WifiInfo\");\n        var DhcpInfo=plus.android.importClass(\"android.net.DhcpInfo\");\n        var wifiManager = plus.android.runtimeMainActivity().getSystemService(Context.WIFI_SERVICE);\n        var dhcpInfo = wifiManager.getDhcpInfo()\n        var begin=dhcpInfo.toString().indexOf(\"gateway\");\n        var end=dhcpInfo.toString().indexOf(\"netmask\");\n        var ipAddress = dhcpInfo.toString().substring(begin+7,end).trim();  \n        if(ipAddress == 0) return \"未连接wifi\";\n        return ipAddress;\n//        return((ipAddress & 0xff) + \".\" + (ipAddress >> 8 & 0xff) + \".\" + (ipAddress >> 16 & 0xff) + \".\" + (ipAddress >> 24 & 0xff));\n    } else if(mui.os.ios) {\n        var WifiManager = plus.ios.importClass(\"WifiManager\");\n        var wifiManager = new WifiManager();\n        var gateWay = wifiManager.defaultGateWay();\n        return gateWay;\n    }\n}\n```\n\n## 软键盘 ##\n\n 1. 强制打开全键盘\n```javascript\n//弹出软键盘，搜索框获得焦点\nvar nativeWebview, imm, InputMethodManager;\nvar initNativeObjects = function() {\n    if(mui.os.android) {\n        var main = plus.android.runtimeMainActivity();\n        var Context = plus.android.importClass(\"android.content.Context\");\n        InputMethodManager = plus.android.importClass(\"android.view.inputmethod.InputMethodManager\");\n        imm = main.getSystemService(Context.INPUT_METHOD_SERVICE);\n    } else {\n        nativeWebview = plus.webview.currentWebview().nativeInstanceObject();\n    }\n};\nvar showSoftInput = function() {\n    if(mui.os.android) {\n        imm.toggleSoftInput(0, InputMethodManager.SHOW_FORCED);\n    } else {\n        nativeWebview.plusCallMethod({\n            \"setKeyboardDisplayRequiresUserAction\": false\n        });\n    }\n    setTimeout(function() {\n        //此处可写具体逻辑设置获取焦点的input\n        var inputElem = document.querySelector('input');\n        inputElem.focus();\n    }, 200);\n};\nvar showSoftInput2 = function() {\n    var nativeWebview = plus.webview.currentWebview().nativeInstanceObject();\n    if(mui.os.android) {\n        //强制当前webview获得焦点\n        plus.android.importClass(nativeWebview);\n        nativeWebview.requestFocus();\n        imm.toggleSoftInput(0, InputMethodManager.SHOW_FORCED);\n    } else {\n        nativeWebview.plusCallMethod({\n            \"setKeyboardDisplayRequiresUserAction\": false\n        });\n    }\n    setTimeout(function() {\n        //此处可写具体逻辑设置获取焦点的input\n        var inputElem = document.querySelector('input');\n        inputElem.select();\n    }, 200);\n};\n```\n 2. 关闭软键盘\n```javascript\ndocument.activeElement.blur(); //隐藏软键盘 \n```\n## 两次点击退出 ##\n```javascript\n//首页返回键处理  \n//处理逻辑：2秒内，连续两次按返回键，则退出应用  \n//首次按键，提示‘再按一次退出应用’  \nif(!first) {\n    first = new Date().getTime();\n    mui.toast('再按一次退出应用');\n    setTimeout(function() {\n        first = null;\n    }, 2000);\n    return false;\n} else {\n    if(new Date().getTime() - first < 2000) {\n        plus.runtime.quit();\n    }\n}\n```\n## 注销关闭其他窗口 ##\n```javascript\n/*监听注销按钮*/\ndocument.getElementById(\"logoutBtn\").addEventListener(\"tap\", function() {\n    var btnArray = ['是', '否'];\n    mui.confirm('您确定退出?', '', btnArray, function(e) {\n        if(e.index == 0) {\n            // 获取所有Webview窗口\n            var launchWebview = plus.webview.getLaunchWebview();\n            var curr = plus.webview.currentWebview();\n            var wvs = plus.webview.all();\n            for(var i = 0, len = wvs.length; i < len; i++) {\n                //关闭除setting页面和首页外的其他页面\n                if(wvs[i].getURL() == curr.getURL() || wvs[i].getURL() == launchWebview.getURL())\n                    continue;\n                plus.webview.close(wvs[i]);\n            }\n            //清除已存储的账号信息\n            myStorage.removeItem('ONU.token.username');\n            myStorage.removeItem('ONU.token.password');\n            myStorage.removeItem('ONU.token.autoLogin');\n            myStorage.removeItem('isLogin');\n            //注销静默登录的定时器\n            //clearInterval('backLoading()');\n            //打开login页面后再关闭setting页面\n            launchWebview.show();\n            curr.close();\n        }\n    })\n});\n```\n","source":"_posts/html5-常用功能.md","raw":"---\ntitle: html5+常用功能\ndate: 2017-05-19 18:09:53\ncategories:\n\t- DCloud\ntags:\n\t- html5+\n\t- native.js\n---\n这篇博文介绍了html5+在webApp开发中经常使用的功能模块\n<!--more-->\n## 获取wifi信息 ##\n\n 1. 获取wifi的IP\n``` javascript\nfunction getOnuIp() {\n    if(mui.os.android) {\n        var Context = plus.android.importClass(\"android.content.Context\");\n        var WifiManager = plus.android.importClass(\"android.net.wifi.WifiManager\");\n        var WifiInfo = plus.android.importClass(\"android.net.wifi.WifiInfo\");\n\n        var wifiManager = plus.android.runtimeMainActivity().getSystemService(Context.WIFI_SERVICE);\n        var wifiInfo = wifiManager.getConnectionInfo();\n        var ipAddress = wifiInfo.getIpAddress();\n        if(ipAddress == 0) return \"未连接wifi\";\n        return((ipAddress & 0xff) + \".\" + (ipAddress >> 8 & 0xff) + \".\" + (ipAddress >> 16 & 0xff) + \".\" + (ipAddress >> 24 & 0xff));\n    } else if(mui.os.ios) {\n        mui.toast(\"ios暂未获\");\n    }\n}\n```\n\n 2. 获取wifi的网关\n```javascript\nfunction getOnuIp() {\n    if(mui.os.android) {\n        var Context = plus.android.importClass(\"android.content.Context\");\n        var WifiManager = plus.android.importClass(\"android.net.wifi.WifiManager\");\n        var WifiInfo = plus.android.importClass(\"android.net.wifi.WifiInfo\");\n        var DhcpInfo=plus.android.importClass(\"android.net.DhcpInfo\");\n        var wifiManager = plus.android.runtimeMainActivity().getSystemService(Context.WIFI_SERVICE);\n        var dhcpInfo = wifiManager.getDhcpInfo()\n        var begin=dhcpInfo.toString().indexOf(\"gateway\");\n        var end=dhcpInfo.toString().indexOf(\"netmask\");\n        var ipAddress = dhcpInfo.toString().substring(begin+7,end).trim();  \n        if(ipAddress == 0) return \"未连接wifi\";\n        return ipAddress;\n//        return((ipAddress & 0xff) + \".\" + (ipAddress >> 8 & 0xff) + \".\" + (ipAddress >> 16 & 0xff) + \".\" + (ipAddress >> 24 & 0xff));\n    } else if(mui.os.ios) {\n        var WifiManager = plus.ios.importClass(\"WifiManager\");\n        var wifiManager = new WifiManager();\n        var gateWay = wifiManager.defaultGateWay();\n        return gateWay;\n    }\n}\n```\n\n## 软键盘 ##\n\n 1. 强制打开全键盘\n```javascript\n//弹出软键盘，搜索框获得焦点\nvar nativeWebview, imm, InputMethodManager;\nvar initNativeObjects = function() {\n    if(mui.os.android) {\n        var main = plus.android.runtimeMainActivity();\n        var Context = plus.android.importClass(\"android.content.Context\");\n        InputMethodManager = plus.android.importClass(\"android.view.inputmethod.InputMethodManager\");\n        imm = main.getSystemService(Context.INPUT_METHOD_SERVICE);\n    } else {\n        nativeWebview = plus.webview.currentWebview().nativeInstanceObject();\n    }\n};\nvar showSoftInput = function() {\n    if(mui.os.android) {\n        imm.toggleSoftInput(0, InputMethodManager.SHOW_FORCED);\n    } else {\n        nativeWebview.plusCallMethod({\n            \"setKeyboardDisplayRequiresUserAction\": false\n        });\n    }\n    setTimeout(function() {\n        //此处可写具体逻辑设置获取焦点的input\n        var inputElem = document.querySelector('input');\n        inputElem.focus();\n    }, 200);\n};\nvar showSoftInput2 = function() {\n    var nativeWebview = plus.webview.currentWebview().nativeInstanceObject();\n    if(mui.os.android) {\n        //强制当前webview获得焦点\n        plus.android.importClass(nativeWebview);\n        nativeWebview.requestFocus();\n        imm.toggleSoftInput(0, InputMethodManager.SHOW_FORCED);\n    } else {\n        nativeWebview.plusCallMethod({\n            \"setKeyboardDisplayRequiresUserAction\": false\n        });\n    }\n    setTimeout(function() {\n        //此处可写具体逻辑设置获取焦点的input\n        var inputElem = document.querySelector('input');\n        inputElem.select();\n    }, 200);\n};\n```\n 2. 关闭软键盘\n```javascript\ndocument.activeElement.blur(); //隐藏软键盘 \n```\n## 两次点击退出 ##\n```javascript\n//首页返回键处理  \n//处理逻辑：2秒内，连续两次按返回键，则退出应用  \n//首次按键，提示‘再按一次退出应用’  \nif(!first) {\n    first = new Date().getTime();\n    mui.toast('再按一次退出应用');\n    setTimeout(function() {\n        first = null;\n    }, 2000);\n    return false;\n} else {\n    if(new Date().getTime() - first < 2000) {\n        plus.runtime.quit();\n    }\n}\n```\n## 注销关闭其他窗口 ##\n```javascript\n/*监听注销按钮*/\ndocument.getElementById(\"logoutBtn\").addEventListener(\"tap\", function() {\n    var btnArray = ['是', '否'];\n    mui.confirm('您确定退出?', '', btnArray, function(e) {\n        if(e.index == 0) {\n            // 获取所有Webview窗口\n            var launchWebview = plus.webview.getLaunchWebview();\n            var curr = plus.webview.currentWebview();\n            var wvs = plus.webview.all();\n            for(var i = 0, len = wvs.length; i < len; i++) {\n                //关闭除setting页面和首页外的其他页面\n                if(wvs[i].getURL() == curr.getURL() || wvs[i].getURL() == launchWebview.getURL())\n                    continue;\n                plus.webview.close(wvs[i]);\n            }\n            //清除已存储的账号信息\n            myStorage.removeItem('ONU.token.username');\n            myStorage.removeItem('ONU.token.password');\n            myStorage.removeItem('ONU.token.autoLogin');\n            myStorage.removeItem('isLogin');\n            //注销静默登录的定时器\n            //clearInterval('backLoading()');\n            //打开login页面后再关闭setting页面\n            launchWebview.show();\n            curr.close();\n        }\n    })\n});\n```\n","slug":"html5-常用功能","published":1,"updated":"2018-02-27T07:38:38.097Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfv7003mhwvfbmutchbc","content":"<p>这篇博文介绍了html5+在webApp开发中经常使用的功能模块<br><a id=\"more\"></a></p>\n<h2 id=\"获取wifi信息\"><a href=\"#获取wifi信息\" class=\"headerlink\" title=\"获取wifi信息\"></a>获取wifi信息</h2><ol>\n<li><p>获取wifi的IP</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getOnuIp</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> Context = plus.android.importClass(<span class=\"string\">\"android.content.Context\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiManager = plus.android.importClass(<span class=\"string\">\"android.net.wifi.WifiManager\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiInfo = plus.android.importClass(<span class=\"string\">\"android.net.wifi.WifiInfo\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">var</span> wifiManager = plus.android.runtimeMainActivity().getSystemService(Context.WIFI_SERVICE);</div><div class=\"line\">        <span class=\"keyword\">var</span> wifiInfo = wifiManager.getConnectionInfo();</div><div class=\"line\">        <span class=\"keyword\">var</span> ipAddress = wifiInfo.getIpAddress();</div><div class=\"line\">        <span class=\"keyword\">if</span>(ipAddress == <span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"string\">\"未连接wifi\"</span>;</div><div class=\"line\">        <span class=\"keyword\">return</span>((ipAddress &amp; <span class=\"number\">0xff</span>) + <span class=\"string\">\".\"</span> + (ipAddress &gt;&gt; <span class=\"number\">8</span> &amp; <span class=\"number\">0xff</span>) + <span class=\"string\">\".\"</span> + (ipAddress &gt;&gt; <span class=\"number\">16</span> &amp; <span class=\"number\">0xff</span>) + <span class=\"string\">\".\"</span> + (ipAddress &gt;&gt; <span class=\"number\">24</span> &amp; <span class=\"number\">0xff</span>));</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(mui.os.ios) &#123;</div><div class=\"line\">        mui.toast(<span class=\"string\">\"ios暂未获\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>获取wifi的网关</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getOnuIp</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> Context = plus.android.importClass(<span class=\"string\">\"android.content.Context\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiManager = plus.android.importClass(<span class=\"string\">\"android.net.wifi.WifiManager\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiInfo = plus.android.importClass(<span class=\"string\">\"android.net.wifi.WifiInfo\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> DhcpInfo=plus.android.importClass(<span class=\"string\">\"android.net.DhcpInfo\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> wifiManager = plus.android.runtimeMainActivity().getSystemService(Context.WIFI_SERVICE);</div><div class=\"line\">        <span class=\"keyword\">var</span> dhcpInfo = wifiManager.getDhcpInfo()</div><div class=\"line\">        <span class=\"keyword\">var</span> begin=dhcpInfo.toString().indexOf(<span class=\"string\">\"gateway\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> end=dhcpInfo.toString().indexOf(<span class=\"string\">\"netmask\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> ipAddress = dhcpInfo.toString().substring(begin+<span class=\"number\">7</span>,end).trim();  </div><div class=\"line\">        <span class=\"keyword\">if</span>(ipAddress == <span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"string\">\"未连接wifi\"</span>;</div><div class=\"line\">        <span class=\"keyword\">return</span> ipAddress;</div><div class=\"line\"><span class=\"comment\">//        return((ipAddress &amp; 0xff) + \".\" + (ipAddress &gt;&gt; 8 &amp; 0xff) + \".\" + (ipAddress &gt;&gt; 16 &amp; 0xff) + \".\" + (ipAddress &gt;&gt; 24 &amp; 0xff));</span></div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(mui.os.ios) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiManager = plus.ios.importClass(<span class=\"string\">\"WifiManager\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> wifiManager = <span class=\"keyword\">new</span> WifiManager();</div><div class=\"line\">        <span class=\"keyword\">var</span> gateWay = wifiManager.defaultGateWay();</div><div class=\"line\">        <span class=\"keyword\">return</span> gateWay;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"软键盘\"><a href=\"#软键盘\" class=\"headerlink\" title=\"软键盘\"></a>软键盘</h2><ol>\n<li><p>强制打开全键盘</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//弹出软键盘，搜索框获得焦点</span></div><div class=\"line\"><span class=\"keyword\">var</span> nativeWebview, imm, InputMethodManager;</div><div class=\"line\"><span class=\"keyword\">var</span> initNativeObjects = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> main = plus.android.runtimeMainActivity();</div><div class=\"line\">        <span class=\"keyword\">var</span> Context = plus.android.importClass(<span class=\"string\">\"android.content.Context\"</span>);</div><div class=\"line\">        InputMethodManager = plus.android.importClass(<span class=\"string\">\"android.view.inputmethod.InputMethodManager\"</span>);</div><div class=\"line\">        imm = main.getSystemService(Context.INPUT_METHOD_SERVICE);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        nativeWebview = plus.webview.currentWebview().nativeInstanceObject();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;;</div><div class=\"line\"><span class=\"keyword\">var</span> showSoftInput = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        imm.toggleSoftInput(<span class=\"number\">0</span>, InputMethodManager.SHOW_FORCED);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        nativeWebview.plusCallMethod(&#123;</div><div class=\"line\">            <span class=\"string\">\"setKeyboardDisplayRequiresUserAction\"</span>: <span class=\"literal\">false</span></div><div class=\"line\">        &#125;);</div><div class=\"line\">    &#125;</div><div class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//此处可写具体逻辑设置获取焦点的input</span></div><div class=\"line\">        <span class=\"keyword\">var</span> inputElem = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'input'</span>);</div><div class=\"line\">        inputElem.focus();</div><div class=\"line\">    &#125;, <span class=\"number\">200</span>);</div><div class=\"line\">&#125;;</div><div class=\"line\"><span class=\"keyword\">var</span> showSoftInput2 = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> nativeWebview = plus.webview.currentWebview().nativeInstanceObject();</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        <span class=\"comment\">//强制当前webview获得焦点</span></div><div class=\"line\">        plus.android.importClass(nativeWebview);</div><div class=\"line\">        nativeWebview.requestFocus();</div><div class=\"line\">        imm.toggleSoftInput(<span class=\"number\">0</span>, InputMethodManager.SHOW_FORCED);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        nativeWebview.plusCallMethod(&#123;</div><div class=\"line\">            <span class=\"string\">\"setKeyboardDisplayRequiresUserAction\"</span>: <span class=\"literal\">false</span></div><div class=\"line\">        &#125;);</div><div class=\"line\">    &#125;</div><div class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//此处可写具体逻辑设置获取焦点的input</span></div><div class=\"line\">        <span class=\"keyword\">var</span> inputElem = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'input'</span>);</div><div class=\"line\">        inputElem.select();</div><div class=\"line\">    &#125;, <span class=\"number\">200</span>);</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure>\n</li>\n<li><p>关闭软键盘</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">document</span>.activeElement.blur(); <span class=\"comment\">//隐藏软键盘</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"两次点击退出\"><a href=\"#两次点击退出\" class=\"headerlink\" title=\"两次点击退出\"></a>两次点击退出</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//首页返回键处理  </span></div><div class=\"line\"><span class=\"comment\">//处理逻辑：2秒内，连续两次按返回键，则退出应用  </span></div><div class=\"line\"><span class=\"comment\">//首次按键，提示‘再按一次退出应用’  </span></div><div class=\"line\"><span class=\"keyword\">if</span>(!first) &#123;</div><div class=\"line\">    first = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime();</div><div class=\"line\">    mui.toast(<span class=\"string\">'再按一次退出应用'</span>);</div><div class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        first = <span class=\"literal\">null</span>;</div><div class=\"line\">    &#125;, <span class=\"number\">2000</span>);</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime() - first &lt; <span class=\"number\">2000</span>) &#123;</div><div class=\"line\">        plus.runtime.quit();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"注销关闭其他窗口\"><a href=\"#注销关闭其他窗口\" class=\"headerlink\" title=\"注销关闭其他窗口\"></a>注销关闭其他窗口</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/*监听注销按钮*/</span></div><div class=\"line\"><span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"logoutBtn\"</span>).addEventListener(<span class=\"string\">\"tap\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> btnArray = [<span class=\"string\">'是'</span>, <span class=\"string\">'否'</span>];</div><div class=\"line\">    mui.confirm(<span class=\"string\">'您确定退出?'</span>, <span class=\"string\">''</span>, btnArray, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span>(e.index == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            <span class=\"comment\">// 获取所有Webview窗口</span></div><div class=\"line\">            <span class=\"keyword\">var</span> launchWebview = plus.webview.getLaunchWebview();</div><div class=\"line\">            <span class=\"keyword\">var</span> curr = plus.webview.currentWebview();</div><div class=\"line\">            <span class=\"keyword\">var</span> wvs = plus.webview.all();</div><div class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = wvs.length; i &lt; len; i++) &#123;</div><div class=\"line\">                <span class=\"comment\">//关闭除setting页面和首页外的其他页面</span></div><div class=\"line\">                <span class=\"keyword\">if</span>(wvs[i].getURL() == curr.getURL() || wvs[i].getURL() == launchWebview.getURL())</div><div class=\"line\">                    <span class=\"keyword\">continue</span>;</div><div class=\"line\">                plus.webview.close(wvs[i]);</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"comment\">//清除已存储的账号信息</span></div><div class=\"line\">            myStorage.removeItem(<span class=\"string\">'ONU.token.username'</span>);</div><div class=\"line\">            myStorage.removeItem(<span class=\"string\">'ONU.token.password'</span>);</div><div class=\"line\">            myStorage.removeItem(<span class=\"string\">'ONU.token.autoLogin'</span>);</div><div class=\"line\">            myStorage.removeItem(<span class=\"string\">'isLogin'</span>);</div><div class=\"line\">            <span class=\"comment\">//注销静默登录的定时器</span></div><div class=\"line\">            <span class=\"comment\">//clearInterval('backLoading()');</span></div><div class=\"line\">            <span class=\"comment\">//打开login页面后再关闭setting页面</span></div><div class=\"line\">            launchWebview.show();</div><div class=\"line\">            curr.close();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;)</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>这篇博文介绍了html5+在webApp开发中经常使用的功能模块<br>","more":"</p>\n<h2 id=\"获取wifi信息\"><a href=\"#获取wifi信息\" class=\"headerlink\" title=\"获取wifi信息\"></a>获取wifi信息</h2><ol>\n<li><p>获取wifi的IP</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getOnuIp</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> Context = plus.android.importClass(<span class=\"string\">\"android.content.Context\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiManager = plus.android.importClass(<span class=\"string\">\"android.net.wifi.WifiManager\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiInfo = plus.android.importClass(<span class=\"string\">\"android.net.wifi.WifiInfo\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">var</span> wifiManager = plus.android.runtimeMainActivity().getSystemService(Context.WIFI_SERVICE);</div><div class=\"line\">        <span class=\"keyword\">var</span> wifiInfo = wifiManager.getConnectionInfo();</div><div class=\"line\">        <span class=\"keyword\">var</span> ipAddress = wifiInfo.getIpAddress();</div><div class=\"line\">        <span class=\"keyword\">if</span>(ipAddress == <span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"string\">\"未连接wifi\"</span>;</div><div class=\"line\">        <span class=\"keyword\">return</span>((ipAddress &amp; <span class=\"number\">0xff</span>) + <span class=\"string\">\".\"</span> + (ipAddress &gt;&gt; <span class=\"number\">8</span> &amp; <span class=\"number\">0xff</span>) + <span class=\"string\">\".\"</span> + (ipAddress &gt;&gt; <span class=\"number\">16</span> &amp; <span class=\"number\">0xff</span>) + <span class=\"string\">\".\"</span> + (ipAddress &gt;&gt; <span class=\"number\">24</span> &amp; <span class=\"number\">0xff</span>));</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(mui.os.ios) &#123;</div><div class=\"line\">        mui.toast(<span class=\"string\">\"ios暂未获\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>获取wifi的网关</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getOnuIp</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> Context = plus.android.importClass(<span class=\"string\">\"android.content.Context\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiManager = plus.android.importClass(<span class=\"string\">\"android.net.wifi.WifiManager\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiInfo = plus.android.importClass(<span class=\"string\">\"android.net.wifi.WifiInfo\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> DhcpInfo=plus.android.importClass(<span class=\"string\">\"android.net.DhcpInfo\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> wifiManager = plus.android.runtimeMainActivity().getSystemService(Context.WIFI_SERVICE);</div><div class=\"line\">        <span class=\"keyword\">var</span> dhcpInfo = wifiManager.getDhcpInfo()</div><div class=\"line\">        <span class=\"keyword\">var</span> begin=dhcpInfo.toString().indexOf(<span class=\"string\">\"gateway\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> end=dhcpInfo.toString().indexOf(<span class=\"string\">\"netmask\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> ipAddress = dhcpInfo.toString().substring(begin+<span class=\"number\">7</span>,end).trim();  </div><div class=\"line\">        <span class=\"keyword\">if</span>(ipAddress == <span class=\"number\">0</span>) <span class=\"keyword\">return</span> <span class=\"string\">\"未连接wifi\"</span>;</div><div class=\"line\">        <span class=\"keyword\">return</span> ipAddress;</div><div class=\"line\"><span class=\"comment\">//        return((ipAddress &amp; 0xff) + \".\" + (ipAddress &gt;&gt; 8 &amp; 0xff) + \".\" + (ipAddress &gt;&gt; 16 &amp; 0xff) + \".\" + (ipAddress &gt;&gt; 24 &amp; 0xff));</span></div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(mui.os.ios) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> WifiManager = plus.ios.importClass(<span class=\"string\">\"WifiManager\"</span>);</div><div class=\"line\">        <span class=\"keyword\">var</span> wifiManager = <span class=\"keyword\">new</span> WifiManager();</div><div class=\"line\">        <span class=\"keyword\">var</span> gateWay = wifiManager.defaultGateWay();</div><div class=\"line\">        <span class=\"keyword\">return</span> gateWay;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"软键盘\"><a href=\"#软键盘\" class=\"headerlink\" title=\"软键盘\"></a>软键盘</h2><ol>\n<li><p>强制打开全键盘</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//弹出软键盘，搜索框获得焦点</span></div><div class=\"line\"><span class=\"keyword\">var</span> nativeWebview, imm, InputMethodManager;</div><div class=\"line\"><span class=\"keyword\">var</span> initNativeObjects = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        <span class=\"keyword\">var</span> main = plus.android.runtimeMainActivity();</div><div class=\"line\">        <span class=\"keyword\">var</span> Context = plus.android.importClass(<span class=\"string\">\"android.content.Context\"</span>);</div><div class=\"line\">        InputMethodManager = plus.android.importClass(<span class=\"string\">\"android.view.inputmethod.InputMethodManager\"</span>);</div><div class=\"line\">        imm = main.getSystemService(Context.INPUT_METHOD_SERVICE);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        nativeWebview = plus.webview.currentWebview().nativeInstanceObject();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;;</div><div class=\"line\"><span class=\"keyword\">var</span> showSoftInput = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        imm.toggleSoftInput(<span class=\"number\">0</span>, InputMethodManager.SHOW_FORCED);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        nativeWebview.plusCallMethod(&#123;</div><div class=\"line\">            <span class=\"string\">\"setKeyboardDisplayRequiresUserAction\"</span>: <span class=\"literal\">false</span></div><div class=\"line\">        &#125;);</div><div class=\"line\">    &#125;</div><div class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//此处可写具体逻辑设置获取焦点的input</span></div><div class=\"line\">        <span class=\"keyword\">var</span> inputElem = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'input'</span>);</div><div class=\"line\">        inputElem.focus();</div><div class=\"line\">    &#125;, <span class=\"number\">200</span>);</div><div class=\"line\">&#125;;</div><div class=\"line\"><span class=\"keyword\">var</span> showSoftInput2 = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> nativeWebview = plus.webview.currentWebview().nativeInstanceObject();</div><div class=\"line\">    <span class=\"keyword\">if</span>(mui.os.android) &#123;</div><div class=\"line\">        <span class=\"comment\">//强制当前webview获得焦点</span></div><div class=\"line\">        plus.android.importClass(nativeWebview);</div><div class=\"line\">        nativeWebview.requestFocus();</div><div class=\"line\">        imm.toggleSoftInput(<span class=\"number\">0</span>, InputMethodManager.SHOW_FORCED);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        nativeWebview.plusCallMethod(&#123;</div><div class=\"line\">            <span class=\"string\">\"setKeyboardDisplayRequiresUserAction\"</span>: <span class=\"literal\">false</span></div><div class=\"line\">        &#125;);</div><div class=\"line\">    &#125;</div><div class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">//此处可写具体逻辑设置获取焦点的input</span></div><div class=\"line\">        <span class=\"keyword\">var</span> inputElem = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'input'</span>);</div><div class=\"line\">        inputElem.select();</div><div class=\"line\">    &#125;, <span class=\"number\">200</span>);</div><div class=\"line\">&#125;;</div></pre></td></tr></table></figure>\n</li>\n<li><p>关闭软键盘</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"built_in\">document</span>.activeElement.blur(); <span class=\"comment\">//隐藏软键盘</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"两次点击退出\"><a href=\"#两次点击退出\" class=\"headerlink\" title=\"两次点击退出\"></a>两次点击退出</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//首页返回键处理  </span></div><div class=\"line\"><span class=\"comment\">//处理逻辑：2秒内，连续两次按返回键，则退出应用  </span></div><div class=\"line\"><span class=\"comment\">//首次按键，提示‘再按一次退出应用’  </span></div><div class=\"line\"><span class=\"keyword\">if</span>(!first) &#123;</div><div class=\"line\">    first = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime();</div><div class=\"line\">    mui.toast(<span class=\"string\">'再按一次退出应用'</span>);</div><div class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">        first = <span class=\"literal\">null</span>;</div><div class=\"line\">    &#125;, <span class=\"number\">2000</span>);</div><div class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</div><div class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime() - first &lt; <span class=\"number\">2000</span>) &#123;</div><div class=\"line\">        plus.runtime.quit();</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"注销关闭其他窗口\"><a href=\"#注销关闭其他窗口\" class=\"headerlink\" title=\"注销关闭其他窗口\"></a>注销关闭其他窗口</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/*监听注销按钮*/</span></div><div class=\"line\"><span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"logoutBtn\"</span>).addEventListener(<span class=\"string\">\"tap\"</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">var</span> btnArray = [<span class=\"string\">'是'</span>, <span class=\"string\">'否'</span>];</div><div class=\"line\">    mui.confirm(<span class=\"string\">'您确定退出?'</span>, <span class=\"string\">''</span>, btnArray, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span>(e.index == <span class=\"number\">0</span>) &#123;</div><div class=\"line\">            <span class=\"comment\">// 获取所有Webview窗口</span></div><div class=\"line\">            <span class=\"keyword\">var</span> launchWebview = plus.webview.getLaunchWebview();</div><div class=\"line\">            <span class=\"keyword\">var</span> curr = plus.webview.currentWebview();</div><div class=\"line\">            <span class=\"keyword\">var</span> wvs = plus.webview.all();</div><div class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = wvs.length; i &lt; len; i++) &#123;</div><div class=\"line\">                <span class=\"comment\">//关闭除setting页面和首页外的其他页面</span></div><div class=\"line\">                <span class=\"keyword\">if</span>(wvs[i].getURL() == curr.getURL() || wvs[i].getURL() == launchWebview.getURL())</div><div class=\"line\">                    <span class=\"keyword\">continue</span>;</div><div class=\"line\">                plus.webview.close(wvs[i]);</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"comment\">//清除已存储的账号信息</span></div><div class=\"line\">            myStorage.removeItem(<span class=\"string\">'ONU.token.username'</span>);</div><div class=\"line\">            myStorage.removeItem(<span class=\"string\">'ONU.token.password'</span>);</div><div class=\"line\">            myStorage.removeItem(<span class=\"string\">'ONU.token.autoLogin'</span>);</div><div class=\"line\">            myStorage.removeItem(<span class=\"string\">'isLogin'</span>);</div><div class=\"line\">            <span class=\"comment\">//注销静默登录的定时器</span></div><div class=\"line\">            <span class=\"comment\">//clearInterval('backLoading()');</span></div><div class=\"line\">            <span class=\"comment\">//打开login页面后再关闭setting页面</span></div><div class=\"line\">            launchWebview.show();</div><div class=\"line\">            curr.close();</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;)</div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>"},{"title":"Struts2(2)——搭建struts及spring整合Demo","date":"2017-12-20T08:51:15.000Z","_content":"简单介绍struts2整合spring项目的搭建。\n<!--more-->\n\n![工程结构图][1]\n\n## 1、创建maven工程，引入jar依赖\n\npom.xml文件如下，maven相关知识请参看[maven学习][2]。\n属性：设置版本等信息\n依赖管理：锁定依赖jar包的具体版本\n依赖：\n\n 1. spring:\n 2. struts2\n 3. mybatis\n 4. mysql驱动\n 5. c3p0\n 6. slf4j\n 7. junit、jstl\n 8. servlet jsp\n\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\t<groupId>com.topvision</groupId>\n\t<artifactId>s2sm</artifactId>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<name>s2sm Maven Webapp</name>\n\t<url>http://maven.apache.org</url>\n\t\n\t<!-- 属性 -->\n\t<properties>\n\t\t<spring.version>4.3.12.RELEASE</spring.version>\n\t\t<mybatis.version>3.4.5</mybatis.version>\n\t\t<struts.version>2.3.24.1</struts.version>\n\t</properties>\n\t\n\t<!-- 锁定版本 -->\n\t<dependencyManagement>\n\t\t<dependencies>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-context</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-aspects</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-orm</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-test</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-web</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t\t<artifactId>struts2-core</artifactId>\n\t\t\t\t<version>${struts.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t\t<artifactId>struts2-spring-plugin</artifactId>\n\t\t\t\t<version>${struts.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t\t<artifactId>struts2-json-plugin</artifactId>\n\t\t\t\t<version>${struts.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t    <groupId>org.mybatis</groupId>\n\t\t\t    <artifactId>mybatis</artifactId>\n\t\t\t    <version>${mybatis.version}</version>\n\t\t\t</dependency>\n\t\t\t\n\t\t</dependencies>\n\t</dependencyManagement>\n\n\t<dependencies>\n\t\t<!-- Spring -->\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-test</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-context</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-aspects</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-orm</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-web</artifactId>\n\t\t</dependency>\n\t\t\n\t\t<!-- Struts -->\n\t\t<dependency>\n\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t<artifactId>struts2-core</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t<artifactId>struts2-spring-plugin</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t<artifactId>struts2-json-plugin</artifactId>\n\t\t</dependency>\n\t\t\n\t\t<!-- mybatis -->\n\t\t<dependency>\n\t\t    <groupId>org.mybatis</groupId>\n\t\t    <artifactId>mybatis</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t    <groupId>org.mybatis</groupId>\n\t\t    <artifactId>mybatis-spring</artifactId>\n\t\t    <version>1.3.1</version>\n\t\t</dependency>\n\t\t\n\t\t<!-- mysql驱动 -->\n\t\t<dependency>\n\t\t\t<groupId>mysql</groupId>\n\t\t\t<artifactId>mysql-connector-java</artifactId>\n\t\t\t<version>5.1.6</version>\n\t\t\t<scope>runtime</scope>\n\t\t</dependency>\n\t\t\n\t\t<!-- c3p0 -->\n\t\t<dependency>\n\t\t\t<groupId>c3p0</groupId>\n\t\t\t<artifactId>c3p0</artifactId>\n\t\t\t<version>0.9.1.2</version>\n\t\t</dependency>\n\t\t\n\t\t<!-- slf4j -->\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-log4j12</artifactId>\n\t\t\t<version>1.7.2</version>\n\t\t</dependency>\n\t\t<!-- junit -->\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>4.9</version>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t\t<!-- jstl -->\n\t\t<dependency>\n\t\t\t<groupId>javax.servlet</groupId>\n\t\t\t<artifactId>jstl</artifactId>\n\t\t\t<version>1.2</version>\n\t\t</dependency>\n\t  \t<!-- servlet jsp -->\n\t  \t<dependency>\n\t  \t\t<groupId>javax.servlet</groupId>\n\t  \t\t<artifactId>servlet-api</artifactId>\n\t  \t\t<version>2.5</version>\n\t  \t\t<scope>provided</scope>\n\t  \t</dependency>\n\t  \t<dependency>\n\t  \t\t<groupId>javax.servlet</groupId>\n\t  \t\t<artifactId>jsp-api</artifactId>\n\t  \t\t<version>2.0</version>\n\t  \t\t<scope>provided</scope>\n\t  \t</dependency>\n\t</dependencies>\n\t\n\t<build>\n\t\t<plugins>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n\t\t\t\t<artifactId>maven-compiler-plugin</artifactId>\n    \t\t\t<version>2.5</version>\n\t\t\t\t<configuration>\n\t\t\t\t\t<source>1.8</source>\n\t\t\t\t\t<target>1.8</target>\n\t\t\t\t\t<encoding>UTF-8</encoding>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t</plugins>\n\n\t\t<finalName>s2sm</finalName>\n\t</build>\n</project>\n\n```\n\n## 2、配置web.xml\n\n 1. 配置spring监听器\n\n    ```xml\n    <!-- applicationContext对象仅加载一次，在服务器器启动时加载 -->\n    <listener>\n    \t<listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>\n    </listener>\n    <context-param>\n    \t<param-name>contextConfigLocation</param-name>\n    \t<param-value>classpath:/config/applicationContext*.xml</param-value>\n    </context-param>\n    ```\n\n 2. 配置struts2核心过滤器\n\n    ```xml\n    <!-- Struts2核心过滤器 -->\n\t<filter>\n\t\t<filter-name>struts2</filter-name>\n\t\t<filter-class>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter</filter-class>\n\t\t<!-- 指定action所在包路径 -->\n\t\t<init-param>  \n        \t<param-name>actionPackages</param-name>  \n        \t<param-value>com.topvision</param-value>  \n    \t</init-param>\n    \t<!-- 指定struts.xml文件路径，默认classpath下 -->\n    \t<init-param>\n    \t\t<param-name>filterConfig</param-name>\n    \t\t<param-value>classpath:struts.xml</param-value>\n    \t</init-param>\n\t</filter>\n\t<!-- 设置url过滤 -->\n\t<filter-mapping>\n\t\t<filter-name>struts2</filter-name>\n\t\t<url-pattern>/*</url-pattern>\n\t</filter-mapping>\n    ```\n\n 3. 设置编码，防止乱码\n\n    ```xml\n    <!-- 编码 -->\n\t<filter>\n\t\t<filter-name>encodingFilter</filter-name>\n\t\t<filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>\n\t\t<init-param>\n\t\t\t<param-name>encoding</param-name>\n\t\t\t<param-value>UTF-8</param-value>\n\t\t</init-param>\n\t</filter>\n\t<filter-mapping>\n\t\t<filter-name>encodingFilter</filter-name>\n\t\t<url-pattern>/*</url-pattern>\n\t</filter-mapping>\n    ```\n\n 4. 设置首页\n\n    ```xml\n    <!-- 首页设置 -->\n    <welcome-file-list>\n    \t<welcome-file>index.html</welcome-file>\n    \t<welcome-file>index.htm</welcome-file>\n    \t<welcome-file>index.jsp</welcome-file>\n    \t<welcome-file>default.html</welcome-file>\n    \t<welcome-file>default.htm</welcome-file>\n    \t<welcome-file>default.jsp</welcome-file>\n    </welcome-file-list>\n    ```\n\n## 3、applicationContext.xml\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:context=\"http://www.springframework.org/schema/context\"\n       xmlns:tool=\"http://www.springframework.org/schema/tool\"\n       xmlns:tx=\"http://www.springframework.org/schema/tx\"\n       xmlns:aop=\"http://www.springframework.org/schema/aop\"\n       xsi:schemaLocation=\"\n\t\thttp://www.springframework.org/schema/beans \n\t\thttp://www.springframework.org/schema/beans/spring-beans-3.2.xsd\n\t\thttp://www.springframework.org/schema/context \n\t\thttp://www.springframework.org/schema/context/spring-context.xsd\n\t\thttp://www.springframework.org/schema/tx \n\t\thttp://www.springframework.org/schema/tx/spring-tx.xsd\n\t\thttp://www.springframework.org/schema/aop \n\t\thttp://www.springframework.org/schema/aop/spring-aop.xsd\n\t\thttp://www.springframework.org/schema/tool\n\t\thttp://www.springframework.org/schema/tool/spring-tool-3.2.xsd\n\t\t\">\n\t<!-- 开启注解配置Bean -->\n\t<!-- 设置扫描包路径 -->\n\t<context:annotation-config/>\n\t<context:component-scan base-package=\"com.topvision\"/>\n\t\n\t<!-- 开启注解事务 -->\n\t<tx:annotation-driven transaction-manager=\"transactionManager\"/>\n\t<!-- 事务管理器 -->\n\t<bean id=\"transactionManager\" class=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\">\n\t\t<property name=\"dataSource\" ref=\"dataSource\"></property>\n\t</bean>\t\n\t<!-- 数据库C3P0 -->\n\t<bean id=\"dataSource\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\">\n\t\t<property name=\"driverClass\" value=\"${s2sm.jdbc.driverClass}\"/>\n\t\t<property name=\"jdbcUrl\" value=\"${s2sm.jdbc.url}\"/>\n\t\t<property name=\"user\" value=\"${s2sm.jdbc.username}\"/>\n\t\t<property name=\"password\" value=\"${s2sm.jdbc.password}\"/>\n\t\t\n        <property name=\"initialPoolSize\" value=\"${s2sm.cpool.initialPoolSize}\" />\n        <property name=\"minPoolSize\" value=\"${s2sm.cpool.minPoolSize}\" />\n        <property name=\"maxPoolSize\" value=\"${s2sm.cpool.maxPoolSize}\" />\n        <property name=\"acquireIncrement\" value=\"${s2sm.cpool.acquireIncrement}\" />\n        <property name=\"maxIdleTime\" value=\"${s2sm.cpool.maxIdleTime}\"/>\n        <property name=\"acquireRetryAttempts\" value=\"${s2sm.cpool.acquireRetryAttempts}\"/>\n        <property name=\"acquireRetryDelay\" value=\"${s2sm.cpool.acquireRetryDelay}\"/>\n\t</bean>\n\t\n\t<!-- 加载properties -->\n\t<!-- <context:property-placeholder location=\"classpath:jdbc.properties\"/> -->\n\t<bean id=\"propertyConfigurer\" class=\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\">\n\t\t<property name=\"locations\">\n\t\t\t<list>\n\t\t\t\t<value>classpath:/config/*.properties</value>\n\t\t\t</list>\n\t\t</property>\n\t</bean>\n\t\n</beans>\n```\n\n## 4、Action编写\n\n```java\n@Controller\n@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\npublic class LoginAction extends BaseAction{\n    private static final long serialVersionUID = -4442251270114214406L;\n    private String username;\n    private String password;\n\n    public String loginTest() {\n        String key = username + \":\" + password;\n        ActionContext context2 = ActionContext.getContext(); \n        context2.put(\"key\", key);\n        return SUCCESS;\n    }\n\n    public String getUsername() {\n        return username;\n    }\n\n    public void setUsername(String username) {\n        this.username = username;\n    }\n\n    public String getPassword() {\n        return password;\n    }\n\n    public void setPassword(String password) {\n        this.password = password;\n    }\n\n}\n```\n\n## 5、配置struts.xml\n\nstruts.xml文件路径要与struts2核心过滤器中配置的路径一致，默认在classpath下即可。\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE struts PUBLIC\n\t\"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN\"\n\t\"http://struts.apache.org/dtds/struts-2.3.dtd\">\n\n<struts>\n    <!-- 所有匹配*.action的请求都由struts2处理 -->\n    <constant name=\"struts.action.extension\" value=\"tv,mb\" />\n    <!-- 主题  simple,xhtml,css_xhtml和ajax-->\n\t<constant name=\"struts.ui.theme\" value=\"simple\"/>\n\t\n    <!-- 是否启用开发模式 -->\n    <constant name=\"struts.devMode\" value=\"true\" />\n    <!-- struts配置文件改动后，是否重新加载，有助于开发 -->\n    <constant name=\"struts.configuration.xml.reload\" value=\"true\" />\n    <!-- 每次HTTP请求系统都重新加载资源文件，有助于开发 -->\n    <constant name=\"struts.i18n.reload\" value=\"true\" />\n    <!-- 设置浏览器是否缓存静态内容,开发是设为false,部署后true -->\n    <constant name=\"struts.serve.static.browserCache\" value=\"false\" />\n\t<!-- Content Model : ((package | include | bean | constant)*, unknown-handler-stack?) -->\n    \n\t<package name=\"login\" namespace=\"/aaa\" extends=\"struts-default\">\n\t\t<action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n\t\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t\t</action>\n\t\n\t</package>\n\n</struts>\n```\n\n## 6、测试\n\n 1. 首页设置\n    \n    ```jsp\n    <%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%>\n    <!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n    <html>\n    <head>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n    <title>Insert title here</title>\n    </head>\n    <body>\n    <a href=\"aaa/loginTest.tv?username=中文&password=123\">请点击这个链接</a><br>  \n    </body>\n    </html>\n    ```\n 2. login.jsp\n\n    ```jsp\n    <%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%>\n    <%@ taglib prefix=\"s\" uri=\"/struts-tags\" %>\n    <!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n    <html>\n    <head>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n    <title>成功</title>\n    </head>\n    <body>\n    <h2>跳转成功</h2>\n    <s:property value=\"@java.lang.Integer@MAX_VALUE\"/>\n    <s:property value=\"username\"/>\n    <s:property value=\"password\"/>\n    <s:debug></s:debug>\n    </body>\n    </html>\n    ```\n    \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/s2sm.png\n  [2]: https://www.zybuluo.com/mdeditor#772562","source":"_posts/Struts2-2-——搭建struts及spring整合Demo.md","raw":"---\ntitle: Struts2(2)——搭建struts及spring整合Demo\ncategories:\n  - Struts2\ntags:\n  - Struts2\ndate: 2017-12-20 16:51:15\n---\n简单介绍struts2整合spring项目的搭建。\n<!--more-->\n\n![工程结构图][1]\n\n## 1、创建maven工程，引入jar依赖\n\npom.xml文件如下，maven相关知识请参看[maven学习][2]。\n属性：设置版本等信息\n依赖管理：锁定依赖jar包的具体版本\n依赖：\n\n 1. spring:\n 2. struts2\n 3. mybatis\n 4. mysql驱动\n 5. c3p0\n 6. slf4j\n 7. junit、jstl\n 8. servlet jsp\n\n```xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\t<groupId>com.topvision</groupId>\n\t<artifactId>s2sm</artifactId>\n\t<version>0.0.1-SNAPSHOT</version>\n\t<name>s2sm Maven Webapp</name>\n\t<url>http://maven.apache.org</url>\n\t\n\t<!-- 属性 -->\n\t<properties>\n\t\t<spring.version>4.3.12.RELEASE</spring.version>\n\t\t<mybatis.version>3.4.5</mybatis.version>\n\t\t<struts.version>2.3.24.1</struts.version>\n\t</properties>\n\t\n\t<!-- 锁定版本 -->\n\t<dependencyManagement>\n\t\t<dependencies>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-context</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-aspects</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-orm</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-test</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.springframework</groupId>\n\t\t\t\t<artifactId>spring-web</artifactId>\n\t\t\t\t<version>${spring.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t\t<artifactId>struts2-core</artifactId>\n\t\t\t\t<version>${struts.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t\t<artifactId>struts2-spring-plugin</artifactId>\n\t\t\t\t<version>${struts.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t\t<artifactId>struts2-json-plugin</artifactId>\n\t\t\t\t<version>${struts.version}</version>\n\t\t\t</dependency>\n\t\t\t<dependency>\n\t\t\t    <groupId>org.mybatis</groupId>\n\t\t\t    <artifactId>mybatis</artifactId>\n\t\t\t    <version>${mybatis.version}</version>\n\t\t\t</dependency>\n\t\t\t\n\t\t</dependencies>\n\t</dependencyManagement>\n\n\t<dependencies>\n\t\t<!-- Spring -->\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-test</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-context</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-aspects</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-orm</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.springframework</groupId>\n\t\t\t<artifactId>spring-web</artifactId>\n\t\t</dependency>\n\t\t\n\t\t<!-- Struts -->\n\t\t<dependency>\n\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t<artifactId>struts2-core</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t<artifactId>struts2-spring-plugin</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.struts</groupId>\n\t\t\t<artifactId>struts2-json-plugin</artifactId>\n\t\t</dependency>\n\t\t\n\t\t<!-- mybatis -->\n\t\t<dependency>\n\t\t    <groupId>org.mybatis</groupId>\n\t\t    <artifactId>mybatis</artifactId>\n\t\t</dependency>\n\t\t<dependency>\n\t\t    <groupId>org.mybatis</groupId>\n\t\t    <artifactId>mybatis-spring</artifactId>\n\t\t    <version>1.3.1</version>\n\t\t</dependency>\n\t\t\n\t\t<!-- mysql驱动 -->\n\t\t<dependency>\n\t\t\t<groupId>mysql</groupId>\n\t\t\t<artifactId>mysql-connector-java</artifactId>\n\t\t\t<version>5.1.6</version>\n\t\t\t<scope>runtime</scope>\n\t\t</dependency>\n\t\t\n\t\t<!-- c3p0 -->\n\t\t<dependency>\n\t\t\t<groupId>c3p0</groupId>\n\t\t\t<artifactId>c3p0</artifactId>\n\t\t\t<version>0.9.1.2</version>\n\t\t</dependency>\n\t\t\n\t\t<!-- slf4j -->\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-log4j12</artifactId>\n\t\t\t<version>1.7.2</version>\n\t\t</dependency>\n\t\t<!-- junit -->\n\t\t<dependency>\n\t\t\t<groupId>junit</groupId>\n\t\t\t<artifactId>junit</artifactId>\n\t\t\t<version>4.9</version>\n\t\t\t<scope>test</scope>\n\t\t</dependency>\n\t\t<!-- jstl -->\n\t\t<dependency>\n\t\t\t<groupId>javax.servlet</groupId>\n\t\t\t<artifactId>jstl</artifactId>\n\t\t\t<version>1.2</version>\n\t\t</dependency>\n\t  \t<!-- servlet jsp -->\n\t  \t<dependency>\n\t  \t\t<groupId>javax.servlet</groupId>\n\t  \t\t<artifactId>servlet-api</artifactId>\n\t  \t\t<version>2.5</version>\n\t  \t\t<scope>provided</scope>\n\t  \t</dependency>\n\t  \t<dependency>\n\t  \t\t<groupId>javax.servlet</groupId>\n\t  \t\t<artifactId>jsp-api</artifactId>\n\t  \t\t<version>2.0</version>\n\t  \t\t<scope>provided</scope>\n\t  \t</dependency>\n\t</dependencies>\n\t\n\t<build>\n\t\t<plugins>\n\t\t\t<plugin>\n\t\t\t\t<groupId>org.apache.maven.plugins</groupId>\n\t\t\t\t<artifactId>maven-compiler-plugin</artifactId>\n    \t\t\t<version>2.5</version>\n\t\t\t\t<configuration>\n\t\t\t\t\t<source>1.8</source>\n\t\t\t\t\t<target>1.8</target>\n\t\t\t\t\t<encoding>UTF-8</encoding>\n\t\t\t\t</configuration>\n\t\t\t</plugin>\n\t\t</plugins>\n\n\t\t<finalName>s2sm</finalName>\n\t</build>\n</project>\n\n```\n\n## 2、配置web.xml\n\n 1. 配置spring监听器\n\n    ```xml\n    <!-- applicationContext对象仅加载一次，在服务器器启动时加载 -->\n    <listener>\n    \t<listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>\n    </listener>\n    <context-param>\n    \t<param-name>contextConfigLocation</param-name>\n    \t<param-value>classpath:/config/applicationContext*.xml</param-value>\n    </context-param>\n    ```\n\n 2. 配置struts2核心过滤器\n\n    ```xml\n    <!-- Struts2核心过滤器 -->\n\t<filter>\n\t\t<filter-name>struts2</filter-name>\n\t\t<filter-class>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter</filter-class>\n\t\t<!-- 指定action所在包路径 -->\n\t\t<init-param>  \n        \t<param-name>actionPackages</param-name>  \n        \t<param-value>com.topvision</param-value>  \n    \t</init-param>\n    \t<!-- 指定struts.xml文件路径，默认classpath下 -->\n    \t<init-param>\n    \t\t<param-name>filterConfig</param-name>\n    \t\t<param-value>classpath:struts.xml</param-value>\n    \t</init-param>\n\t</filter>\n\t<!-- 设置url过滤 -->\n\t<filter-mapping>\n\t\t<filter-name>struts2</filter-name>\n\t\t<url-pattern>/*</url-pattern>\n\t</filter-mapping>\n    ```\n\n 3. 设置编码，防止乱码\n\n    ```xml\n    <!-- 编码 -->\n\t<filter>\n\t\t<filter-name>encodingFilter</filter-name>\n\t\t<filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>\n\t\t<init-param>\n\t\t\t<param-name>encoding</param-name>\n\t\t\t<param-value>UTF-8</param-value>\n\t\t</init-param>\n\t</filter>\n\t<filter-mapping>\n\t\t<filter-name>encodingFilter</filter-name>\n\t\t<url-pattern>/*</url-pattern>\n\t</filter-mapping>\n    ```\n\n 4. 设置首页\n\n    ```xml\n    <!-- 首页设置 -->\n    <welcome-file-list>\n    \t<welcome-file>index.html</welcome-file>\n    \t<welcome-file>index.htm</welcome-file>\n    \t<welcome-file>index.jsp</welcome-file>\n    \t<welcome-file>default.html</welcome-file>\n    \t<welcome-file>default.htm</welcome-file>\n    \t<welcome-file>default.jsp</welcome-file>\n    </welcome-file-list>\n    ```\n\n## 3、applicationContext.xml\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n       xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n       xmlns:context=\"http://www.springframework.org/schema/context\"\n       xmlns:tool=\"http://www.springframework.org/schema/tool\"\n       xmlns:tx=\"http://www.springframework.org/schema/tx\"\n       xmlns:aop=\"http://www.springframework.org/schema/aop\"\n       xsi:schemaLocation=\"\n\t\thttp://www.springframework.org/schema/beans \n\t\thttp://www.springframework.org/schema/beans/spring-beans-3.2.xsd\n\t\thttp://www.springframework.org/schema/context \n\t\thttp://www.springframework.org/schema/context/spring-context.xsd\n\t\thttp://www.springframework.org/schema/tx \n\t\thttp://www.springframework.org/schema/tx/spring-tx.xsd\n\t\thttp://www.springframework.org/schema/aop \n\t\thttp://www.springframework.org/schema/aop/spring-aop.xsd\n\t\thttp://www.springframework.org/schema/tool\n\t\thttp://www.springframework.org/schema/tool/spring-tool-3.2.xsd\n\t\t\">\n\t<!-- 开启注解配置Bean -->\n\t<!-- 设置扫描包路径 -->\n\t<context:annotation-config/>\n\t<context:component-scan base-package=\"com.topvision\"/>\n\t\n\t<!-- 开启注解事务 -->\n\t<tx:annotation-driven transaction-manager=\"transactionManager\"/>\n\t<!-- 事务管理器 -->\n\t<bean id=\"transactionManager\" class=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\">\n\t\t<property name=\"dataSource\" ref=\"dataSource\"></property>\n\t</bean>\t\n\t<!-- 数据库C3P0 -->\n\t<bean id=\"dataSource\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\">\n\t\t<property name=\"driverClass\" value=\"${s2sm.jdbc.driverClass}\"/>\n\t\t<property name=\"jdbcUrl\" value=\"${s2sm.jdbc.url}\"/>\n\t\t<property name=\"user\" value=\"${s2sm.jdbc.username}\"/>\n\t\t<property name=\"password\" value=\"${s2sm.jdbc.password}\"/>\n\t\t\n        <property name=\"initialPoolSize\" value=\"${s2sm.cpool.initialPoolSize}\" />\n        <property name=\"minPoolSize\" value=\"${s2sm.cpool.minPoolSize}\" />\n        <property name=\"maxPoolSize\" value=\"${s2sm.cpool.maxPoolSize}\" />\n        <property name=\"acquireIncrement\" value=\"${s2sm.cpool.acquireIncrement}\" />\n        <property name=\"maxIdleTime\" value=\"${s2sm.cpool.maxIdleTime}\"/>\n        <property name=\"acquireRetryAttempts\" value=\"${s2sm.cpool.acquireRetryAttempts}\"/>\n        <property name=\"acquireRetryDelay\" value=\"${s2sm.cpool.acquireRetryDelay}\"/>\n\t</bean>\n\t\n\t<!-- 加载properties -->\n\t<!-- <context:property-placeholder location=\"classpath:jdbc.properties\"/> -->\n\t<bean id=\"propertyConfigurer\" class=\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\">\n\t\t<property name=\"locations\">\n\t\t\t<list>\n\t\t\t\t<value>classpath:/config/*.properties</value>\n\t\t\t</list>\n\t\t</property>\n\t</bean>\n\t\n</beans>\n```\n\n## 4、Action编写\n\n```java\n@Controller\n@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\npublic class LoginAction extends BaseAction{\n    private static final long serialVersionUID = -4442251270114214406L;\n    private String username;\n    private String password;\n\n    public String loginTest() {\n        String key = username + \":\" + password;\n        ActionContext context2 = ActionContext.getContext(); \n        context2.put(\"key\", key);\n        return SUCCESS;\n    }\n\n    public String getUsername() {\n        return username;\n    }\n\n    public void setUsername(String username) {\n        this.username = username;\n    }\n\n    public String getPassword() {\n        return password;\n    }\n\n    public void setPassword(String password) {\n        this.password = password;\n    }\n\n}\n```\n\n## 5、配置struts.xml\n\nstruts.xml文件路径要与struts2核心过滤器中配置的路径一致，默认在classpath下即可。\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE struts PUBLIC\n\t\"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN\"\n\t\"http://struts.apache.org/dtds/struts-2.3.dtd\">\n\n<struts>\n    <!-- 所有匹配*.action的请求都由struts2处理 -->\n    <constant name=\"struts.action.extension\" value=\"tv,mb\" />\n    <!-- 主题  simple,xhtml,css_xhtml和ajax-->\n\t<constant name=\"struts.ui.theme\" value=\"simple\"/>\n\t\n    <!-- 是否启用开发模式 -->\n    <constant name=\"struts.devMode\" value=\"true\" />\n    <!-- struts配置文件改动后，是否重新加载，有助于开发 -->\n    <constant name=\"struts.configuration.xml.reload\" value=\"true\" />\n    <!-- 每次HTTP请求系统都重新加载资源文件，有助于开发 -->\n    <constant name=\"struts.i18n.reload\" value=\"true\" />\n    <!-- 设置浏览器是否缓存静态内容,开发是设为false,部署后true -->\n    <constant name=\"struts.serve.static.browserCache\" value=\"false\" />\n\t<!-- Content Model : ((package | include | bean | constant)*, unknown-handler-stack?) -->\n    \n\t<package name=\"login\" namespace=\"/aaa\" extends=\"struts-default\">\n\t\t<action name=\"loginTest\" class=\"com.topvision.s2sm.login.action.LoginAction\" method=\"loginTest\">\n\t\t\t<result>/WEB-INF/jsp/login/login.jsp</result>\n\t\t</action>\n\t\n\t</package>\n\n</struts>\n```\n\n## 6、测试\n\n 1. 首页设置\n    \n    ```jsp\n    <%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%>\n    <!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n    <html>\n    <head>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n    <title>Insert title here</title>\n    </head>\n    <body>\n    <a href=\"aaa/loginTest.tv?username=中文&password=123\">请点击这个链接</a><br>  \n    </body>\n    </html>\n    ```\n 2. login.jsp\n\n    ```jsp\n    <%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%>\n    <%@ taglib prefix=\"s\" uri=\"/struts-tags\" %>\n    <!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n    <html>\n    <head>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n    <title>成功</title>\n    </head>\n    <body>\n    <h2>跳转成功</h2>\n    <s:property value=\"@java.lang.Integer@MAX_VALUE\"/>\n    <s:property value=\"username\"/>\n    <s:property value=\"password\"/>\n    <s:debug></s:debug>\n    </body>\n    </html>\n    ```\n    \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/s2sm.png\n  [2]: https://www.zybuluo.com/mdeditor#772562","slug":"Struts2-2-——搭建struts及spring整合Demo","published":1,"updated":"2018-02-27T07:38:38.093Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfvb003ohwvfn3590ocm","content":"<p>简单介绍struts2整合spring项目的搭建。<br><a id=\"more\"></a></p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/s2sm.png\" alt=\"工程结构图\"></p>\n<h2 id=\"1、创建maven工程，引入jar依赖\"><a href=\"#1、创建maven工程，引入jar依赖\" class=\"headerlink\" title=\"1、创建maven工程，引入jar依赖\"></a>1、创建maven工程，引入jar依赖</h2><p>pom.xml文件如下，maven相关知识请参看<a href=\"https://www.zybuluo.com/mdeditor#772562\" target=\"_blank\" rel=\"noopener\">maven学习</a>。<br>属性：设置版本等信息<br>依赖管理：锁定依赖jar包的具体版本<br>依赖：</p>\n<ol>\n<li>spring:</li>\n<li>struts2</li>\n<li>mybatis</li>\n<li>mysql驱动</li>\n<li>c3p0</li>\n<li>slf4j</li>\n<li>junit、jstl</li>\n<li>servlet jsp</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.topvision<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>s2sm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>s2sm Maven Webapp<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.apache.org<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 属性 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">spring.version</span>&gt;</span>4.3.12.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">spring.version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">mybatis.version</span>&gt;</span>3.4.5<span class=\"tag\">&lt;/<span class=\"name\">mybatis.version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">struts.version</span>&gt;</span>2.3.24.1<span class=\"tag\">&lt;/<span class=\"name\">struts.version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 锁定版本 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aspects<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-orm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;struts.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-spring-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;struts.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-json-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;struts.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t</div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- Spring --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aspects<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-orm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- Struts --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-spring-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-json-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mybatis --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-spring<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mysql驱动 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- c3p0 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- slf4j --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-log4j12<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- junit --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.9<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- jstl --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jstl<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t  \t<span class=\"comment\">&lt;!-- servlet jsp --&gt;</span></div><div class=\"line\">\t  \t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>servlet-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t  \t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t  \t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jsp-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t  \t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    \t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">encoding</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>s2sm<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"2、配置web-xml\"><a href=\"#2、配置web-xml\" class=\"headerlink\" title=\"2、配置web.xml\"></a>2、配置web.xml</h2><ol>\n<li><p>配置spring监听器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- applicationContext对象仅加载一次，在服务器器启动时加载 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">listener</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class=\"tag\">&lt;/<span class=\"name\">listener-class</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">listener</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context-param</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>contextConfigLocation<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:/config/applicationContext*.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">context-param</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>配置struts2核心过滤器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"comment\">&lt;!-- Struts2核心过滤器 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>struts2<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 指定action所在包路径 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span>  </div><div class=\"line\">       \t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>actionPackages<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span>  </div><div class=\"line\">       \t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>com.topvision<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span>  </div><div class=\"line\">   \t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">   \t<span class=\"comment\">&lt;!-- 指定struts.xml文件路径，默认classpath下 --&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">   \t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>filterConfig<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">   \t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:struts.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 设置url过滤 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>struts2<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>设置编码，防止乱码</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"comment\">&lt;!-- 编码 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>encodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>encoding<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>encodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>设置首页</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 首页设置 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">welcome-file-list</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.html<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.htm<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.jsp<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.html<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.htm<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.jsp<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">welcome-file-list</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"3、applicationContext-xml\"><a href=\"#3、applicationContext-xml\" class=\"headerlink\" title=\"3、applicationContext.xml\"></a>3、applicationContext.xml</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:tool</span>=<span class=\"string\">\"http://www.springframework.org/schema/tool\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:tx</span>=<span class=\"string\">\"http://www.springframework.org/schema/tx\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:aop</span>=<span class=\"string\">\"http://www.springframework.org/schema/aop\"</span></div><div class=\"line\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"</span></div><div class=\"line\">\t\thttp://www.springframework.org/schema/beans </div><div class=\"line\">\t\thttp://www.springframework.org/schema/beans/spring-beans-3.2.xsd</div><div class=\"line\">\t\thttp://www.springframework.org/schema/context </div><div class=\"line\">\t\thttp://www.springframework.org/schema/context/spring-context.xsd</div><div class=\"line\">\t\thttp://www.springframework.org/schema/tx </div><div class=\"line\">\t\thttp://www.springframework.org/schema/tx/spring-tx.xsd</div><div class=\"line\">\t\thttp://www.springframework.org/schema/aop </div><div class=\"line\">\t\thttp://www.springframework.org/schema/aop/spring-aop.xsd</div><div class=\"line\">\t\thttp://www.springframework.org/schema/tool</div><div class=\"line\">\t\thttp://www.springframework.org/schema/tool/spring-tool-3.2.xsd</div><div class=\"line\">\t\t\"&gt;</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 开启注解配置Bean --&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 设置扫描包路径 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">context:annotation-config</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision\"</span>/&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 开启注解事务 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">tx:annotation-driven</span> <span class=\"attr\">transaction-manager</span>=<span class=\"string\">\"transactionManager\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 事务管理器 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"transactionManager\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DataSourceTransactionManager\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span>\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 数据库C3P0 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.mchange.v2.c3p0.ComboPooledDataSource\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.driverClass&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.url&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.username&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.password&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"initialPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.initialPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"minPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.minPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"maxPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.maxPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireIncrement\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireIncrement&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"maxIdleTime\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.maxIdleTime&#125;\"</span>/&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireRetryAttempts\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireRetryAttempts&#125;\"</span>/&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireRetryDelay\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireRetryDelay&#125;\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 加载properties --&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- &lt;context:property-placeholder location=\"classpath:jdbc.properties\"/&gt; --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"propertyConfigurer\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"locations\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>classpath:/config/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"4、Action编写\"><a href=\"#4、Action编写\" class=\"headerlink\" title=\"4、Action编写\"></a>4、Action编写</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Controller</span></div><div class=\"line\"><span class=\"meta\">@Scope</span>(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LoginAction</span> <span class=\"keyword\">extends</span> <span class=\"title\">BaseAction</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">4442251270114214406L</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String username;</div><div class=\"line\">    <span class=\"keyword\">private</span> String password;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">loginTest</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        String key = username + <span class=\"string\">\":\"</span> + password;</div><div class=\"line\">        ActionContext context2 = ActionContext.getContext(); </div><div class=\"line\">        context2.put(<span class=\"string\">\"key\"</span>, key);</div><div class=\"line\">        <span class=\"keyword\">return</span> SUCCESS;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUsername</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> username;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUsername</span><span class=\"params\">(String username)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.username = username;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getPassword</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> password;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setPassword</span><span class=\"params\">(String password)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.password = password;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"5、配置struts-xml\"><a href=\"#5、配置struts-xml\" class=\"headerlink\" title=\"5、配置struts.xml\"></a>5、配置struts.xml</h2><p>struts.xml文件路径要与struts2核心过滤器中配置的路径一致，默认在classpath下即可。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE struts PUBLIC</span></div><div class=\"line\">\t\"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN\"</div><div class=\"line\">\t\"http://struts.apache.org/dtds/struts-2.3.dtd\"&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">struts</span>&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 所有匹配*.action的请求都由struts2处理 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.action.extension\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"tv,mb\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 主题  simple,xhtml,css_xhtml和ajax--&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.ui.theme\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"simple\"</span>/&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">    <span class=\"comment\">&lt;!-- 是否启用开发模式 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.devMode\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- struts配置文件改动后，是否重新加载，有助于开发 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.configuration.xml.reload\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 每次HTTP请求系统都重新加载资源文件，有助于开发 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.i18n.reload\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 设置浏览器是否缓存静态内容,开发是设为false,部署后true --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.serve.static.browserCache\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"false\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- Content Model : ((package | include | bean | constant)*, unknown-handler-stack?) --&gt;</span></div><div class=\"line\">    </div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"login\"</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"/aaa\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">struts</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"6、测试\"><a href=\"#6、测试\" class=\"headerlink\" title=\"6、测试\"></a>6、测试</h2><ol>\n<li><p>首页设置</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%&gt;</div><div class=\"line\">&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\"&gt;</div><div class=\"line\">&lt;html&gt;</div><div class=\"line\">&lt;head&gt;</div><div class=\"line\">&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"&gt;</div><div class=\"line\">&lt;title&gt;Insert title here&lt;/title&gt;</div><div class=\"line\">&lt;/head&gt;</div><div class=\"line\">&lt;body&gt;</div><div class=\"line\">&lt;a href=\"aaa/loginTest.tv?username=中文&amp;password=123\"&gt;请点击这个链接&lt;/a&gt;&lt;br&gt;  </div><div class=\"line\">&lt;/body&gt;</div><div class=\"line\">&lt;/html&gt;</div></pre></td></tr></table></figure>\n</li>\n<li><p>login.jsp</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%&gt;</div><div class=\"line\">&lt;%@ taglib prefix=\"s\" uri=\"/struts-tags\" %&gt;</div><div class=\"line\">&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\"&gt;</div><div class=\"line\">&lt;html&gt;</div><div class=\"line\">&lt;head&gt;</div><div class=\"line\">&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"&gt;</div><div class=\"line\">&lt;title&gt;成功&lt;/title&gt;</div><div class=\"line\">&lt;/head&gt;</div><div class=\"line\">&lt;body&gt;</div><div class=\"line\">&lt;h2&gt;跳转成功&lt;/h2&gt;</div><div class=\"line\">&lt;s:property value=\"@java.lang.Integer@MAX_VALUE\"/&gt;</div><div class=\"line\">&lt;s:property value=\"username\"/&gt;</div><div class=\"line\">&lt;s:property value=\"password\"/&gt;</div><div class=\"line\">&lt;s:debug&gt;&lt;/s:debug&gt;</div><div class=\"line\">&lt;/body&gt;</div><div class=\"line\">&lt;/html&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>简单介绍struts2整合spring项目的搭建。<br>","more":"</p>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/struts/s2sm.png\" alt=\"工程结构图\"></p>\n<h2 id=\"1、创建maven工程，引入jar依赖\"><a href=\"#1、创建maven工程，引入jar依赖\" class=\"headerlink\" title=\"1、创建maven工程，引入jar依赖\"></a>1、创建maven工程，引入jar依赖</h2><p>pom.xml文件如下，maven相关知识请参看<a href=\"https://www.zybuluo.com/mdeditor#772562\" target=\"_blank\" rel=\"noopener\">maven学习</a>。<br>属性：设置版本等信息<br>依赖管理：锁定依赖jar包的具体版本<br>依赖：</p>\n<ol>\n<li>spring:</li>\n<li>struts2</li>\n<li>mybatis</li>\n<li>mysql驱动</li>\n<li>c3p0</li>\n<li>slf4j</li>\n<li>junit、jstl</li>\n<li>servlet jsp</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div><div class=\"line\">178</div><div class=\"line\">179</div><div class=\"line\">180</div><div class=\"line\">181</div><div class=\"line\">182</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span></div><div class=\"line\">\t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.topvision<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>s2sm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>s2sm Maven Webapp<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url</span>&gt;</span>http://maven.apache.org<span class=\"tag\">&lt;/<span class=\"name\">url</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 属性 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">spring.version</span>&gt;</span>4.3.12.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">spring.version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">mybatis.version</span>&gt;</span>3.4.5<span class=\"tag\">&lt;/<span class=\"name\">mybatis.version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">struts.version</span>&gt;</span>2.3.24.1<span class=\"tag\">&lt;/<span class=\"name\">struts.version</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 锁定版本 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aspects<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-orm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spring.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;struts.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-spring-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;struts.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-json-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;struts.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t</div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencyManagement</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- Spring --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-context<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-aspects<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-orm<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- Struts --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-spring-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.struts<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>struts2-json-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mybatis --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-spring<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- mysql驱动 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.1.6<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>runtime<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- c3p0 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- slf4j --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.slf4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>slf4j-log4j12<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.7.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- junit --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.9<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- jstl --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jstl<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t  \t<span class=\"comment\">&lt;!-- servlet jsp --&gt;</span></div><div class=\"line\">\t  \t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>servlet-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t  \t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t  \t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.servlet<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jsp-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t  \t\t<span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></div><div class=\"line\">\t  \t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">    \t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></div><div class=\"line\">\t\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">encoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">encoding</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>s2sm<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"2、配置web-xml\"><a href=\"#2、配置web-xml\" class=\"headerlink\" title=\"2、配置web.xml\"></a>2、配置web.xml</h2><ol>\n<li><p>配置spring监听器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- applicationContext对象仅加载一次，在服务器器启动时加载 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">listener</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class=\"tag\">&lt;/<span class=\"name\">listener-class</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">listener</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context-param</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>contextConfigLocation<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:/config/applicationContext*.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">context-param</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>配置struts2核心过滤器</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"comment\">&lt;!-- Struts2核心过滤器 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>struts2<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 指定action所在包路径 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span>  </div><div class=\"line\">       \t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>actionPackages<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span>  </div><div class=\"line\">       \t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>com.topvision<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span>  </div><div class=\"line\">   \t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">   \t<span class=\"comment\">&lt;!-- 指定struts.xml文件路径，默认classpath下 --&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">   \t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>filterConfig<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">   \t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>classpath:struts.xml<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- 设置url过滤 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>struts2<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>设置编码，防止乱码</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"comment\">&lt;!-- 编码 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>encodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-class</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-name</span>&gt;</span>encoding<span class=\"tag\">&lt;/<span class=\"name\">param-name</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">param-value</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">param-value</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">init-param</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">filter-mapping</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">filter-name</span>&gt;</span>encodingFilter<span class=\"tag\">&lt;/<span class=\"name\">filter-name</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">url-pattern</span>&gt;</span>/*<span class=\"tag\">&lt;/<span class=\"name\">url-pattern</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">filter-mapping</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>设置首页</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 首页设置 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">welcome-file-list</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.html<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.htm<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>index.jsp<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.html<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.htm<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">welcome-file</span>&gt;</span>default.jsp<span class=\"tag\">&lt;/<span class=\"name\">welcome-file</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">welcome-file-list</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"3、applicationContext-xml\"><a href=\"#3、applicationContext-xml\" class=\"headerlink\" title=\"3、applicationContext.xml\"></a>3、applicationContext.xml</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:tool</span>=<span class=\"string\">\"http://www.springframework.org/schema/tool\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:tx</span>=<span class=\"string\">\"http://www.springframework.org/schema/tx\"</span></div><div class=\"line\">       <span class=\"attr\">xmlns:aop</span>=<span class=\"string\">\"http://www.springframework.org/schema/aop\"</span></div><div class=\"line\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"</span></div><div class=\"line\">\t\thttp://www.springframework.org/schema/beans </div><div class=\"line\">\t\thttp://www.springframework.org/schema/beans/spring-beans-3.2.xsd</div><div class=\"line\">\t\thttp://www.springframework.org/schema/context </div><div class=\"line\">\t\thttp://www.springframework.org/schema/context/spring-context.xsd</div><div class=\"line\">\t\thttp://www.springframework.org/schema/tx </div><div class=\"line\">\t\thttp://www.springframework.org/schema/tx/spring-tx.xsd</div><div class=\"line\">\t\thttp://www.springframework.org/schema/aop </div><div class=\"line\">\t\thttp://www.springframework.org/schema/aop/spring-aop.xsd</div><div class=\"line\">\t\thttp://www.springframework.org/schema/tool</div><div class=\"line\">\t\thttp://www.springframework.org/schema/tool/spring-tool-3.2.xsd</div><div class=\"line\">\t\t\"&gt;</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 开启注解配置Bean --&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 设置扫描包路径 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">context:annotation-config</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision\"</span>/&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 开启注解事务 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">tx:annotation-driven</span> <span class=\"attr\">transaction-manager</span>=<span class=\"string\">\"transactionManager\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 事务管理器 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"transactionManager\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DataSourceTransactionManager\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span>\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 数据库C3P0 --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.mchange.v2.c3p0.ComboPooledDataSource\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.driverClass&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.url&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.username&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.jdbc.password&#125;\"</span>/&gt;</span></div><div class=\"line\">\t\t</div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"initialPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.initialPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"minPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.minPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"maxPoolSize\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.maxPoolSize&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireIncrement\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireIncrement&#125;\"</span> /&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"maxIdleTime\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.maxIdleTime&#125;\"</span>/&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireRetryAttempts\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireRetryAttempts&#125;\"</span>/&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"acquireRetryDelay\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;s2sm.cpool.acquireRetryDelay&#125;\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">&lt;!-- 加载properties --&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- &lt;context:property-placeholder location=\"classpath:jdbc.properties\"/&gt; --&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"propertyConfigurer\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"locations\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>classpath:/config/*.properties<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">list</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"4、Action编写\"><a href=\"#4、Action编写\" class=\"headerlink\" title=\"4、Action编写\"></a>4、Action编写</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Controller</span></div><div class=\"line\"><span class=\"meta\">@Scope</span>(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LoginAction</span> <span class=\"keyword\">extends</span> <span class=\"title\">BaseAction</span></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = -<span class=\"number\">4442251270114214406L</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> String username;</div><div class=\"line\">    <span class=\"keyword\">private</span> String password;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">loginTest</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        String key = username + <span class=\"string\">\":\"</span> + password;</div><div class=\"line\">        ActionContext context2 = ActionContext.getContext(); </div><div class=\"line\">        context2.put(<span class=\"string\">\"key\"</span>, key);</div><div class=\"line\">        <span class=\"keyword\">return</span> SUCCESS;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getUsername</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> username;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setUsername</span><span class=\"params\">(String username)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.username = username;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getPassword</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> password;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setPassword</span><span class=\"params\">(String password)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">this</span>.password = password;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"5、配置struts-xml\"><a href=\"#5、配置struts-xml\" class=\"headerlink\" title=\"5、配置struts.xml\"></a>5、配置struts.xml</h2><p>struts.xml文件路径要与struts2核心过滤器中配置的路径一致，默认在classpath下即可。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</div><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE struts PUBLIC</span></div><div class=\"line\">\t\"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN\"</div><div class=\"line\">\t\"http://struts.apache.org/dtds/struts-2.3.dtd\"&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">struts</span>&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 所有匹配*.action的请求都由struts2处理 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.action.extension\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"tv,mb\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 主题  simple,xhtml,css_xhtml和ajax--&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.ui.theme\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"simple\"</span>/&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">    <span class=\"comment\">&lt;!-- 是否启用开发模式 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.devMode\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- struts配置文件改动后，是否重新加载，有助于开发 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.configuration.xml.reload\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 每次HTTP请求系统都重新加载资源文件，有助于开发 --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.i18n.reload\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"true\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"comment\">&lt;!-- 设置浏览器是否缓存静态内容,开发是设为false,部署后true --&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constant</span> <span class=\"attr\">name</span>=<span class=\"string\">\"struts.serve.static.browserCache\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"false\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"comment\">&lt;!-- Content Model : ((package | include | bean | constant)*, unknown-handler-stack?) --&gt;</span></div><div class=\"line\">    </div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">package</span> <span class=\"attr\">name</span>=<span class=\"string\">\"login\"</span> <span class=\"attr\">namespace</span>=<span class=\"string\">\"/aaa\"</span> <span class=\"attr\">extends</span>=<span class=\"string\">\"struts-default\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">action</span> <span class=\"attr\">name</span>=<span class=\"string\">\"loginTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.s2sm.login.action.LoginAction\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"loginTest\"</span>&gt;</span></div><div class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">result</span>&gt;</span>/WEB-INF/jsp/login/login.jsp<span class=\"tag\">&lt;/<span class=\"name\">result</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">action</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">package</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">struts</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"6、测试\"><a href=\"#6、测试\" class=\"headerlink\" title=\"6、测试\"></a>6、测试</h2><ol>\n<li><p>首页设置</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%&gt;</div><div class=\"line\">&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\"&gt;</div><div class=\"line\">&lt;html&gt;</div><div class=\"line\">&lt;head&gt;</div><div class=\"line\">&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"&gt;</div><div class=\"line\">&lt;title&gt;Insert title here&lt;/title&gt;</div><div class=\"line\">&lt;/head&gt;</div><div class=\"line\">&lt;body&gt;</div><div class=\"line\">&lt;a href=\"aaa/loginTest.tv?username=中文&amp;password=123\"&gt;请点击这个链接&lt;/a&gt;&lt;br&gt;  </div><div class=\"line\">&lt;/body&gt;</div><div class=\"line\">&lt;/html&gt;</div></pre></td></tr></table></figure>\n</li>\n<li><p>login.jsp</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;%@ page language=\"java\" contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%&gt;</div><div class=\"line\">&lt;%@ taglib prefix=\"s\" uri=\"/struts-tags\" %&gt;</div><div class=\"line\">&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\"&gt;</div><div class=\"line\">&lt;html&gt;</div><div class=\"line\">&lt;head&gt;</div><div class=\"line\">&lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"&gt;</div><div class=\"line\">&lt;title&gt;成功&lt;/title&gt;</div><div class=\"line\">&lt;/head&gt;</div><div class=\"line\">&lt;body&gt;</div><div class=\"line\">&lt;h2&gt;跳转成功&lt;/h2&gt;</div><div class=\"line\">&lt;s:property value=\"@java.lang.Integer@MAX_VALUE\"/&gt;</div><div class=\"line\">&lt;s:property value=\"username\"/&gt;</div><div class=\"line\">&lt;s:property value=\"password\"/&gt;</div><div class=\"line\">&lt;s:debug&gt;&lt;/s:debug&gt;</div><div class=\"line\">&lt;/body&gt;</div><div class=\"line\">&lt;/html&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>"},{"title":"spring(1)——框架简介","date":"2017-06-12T05:19:16.000Z","_content":"\n这篇博客介绍了spring框架的组成及应用\n<!--more-->\n## 1.什么是spring框架？\nspring是一个轻量级的JAVA开发框架，由Rod Johnson创建。spring对应用对象（如javaBean）的生命周期进行管理，它是一个“粘合平台”，将很多技术粘合在一起，形成一个整体，使每个组件发挥最大功效。\n\n## 2.架构概述\n![spring架构][1]\n\n -  核心容器\n    - spring-bean是整个核心，Bean的定义、Bean 的创建以及对Bean的解析。\n    - spring-context是bean关系集合，也就是IOC容器\n    - spring-core发现、维护和管理变之间的关系\n    - spring-expression是EL遍地是语言的扩展，支持设置和获取对象属性，调用对象方法，操作数组、集合等。\n - 面向切面编程（AOP）和工具（Instruementation）\n    - Spring AOP模块提供了满足AOP Alliance规范的实现，还整合了AspectJ这种AOP语言级的框架。通过AOP能降低耦合。\n - 消息\n    - spring-messaging模块为集成messaging api和消息协议提供支持。\n - 数据访问集成\n    - 事务模块：该模块用于Spring管理事务，只要是Spring管理对象都能得到Spring管理事务的好处，无需在代码中进行事务控制了，而且支持编程和声明性的事务管理。\n    - JDBC模块：提供了一个JBDC的样例模板，使用这些模板能消除传统冗长的JDBC编码还有必须的事务控制，而且能享受到Spring管理事务的好处。\n    - ORM模块：提供与流行的“对象-关系”映射框架的无缝集成，包括hibernate、JPA、MyBatis等。而且可以使用Spring事务管理，无需额外控制事务。\n    - OXM模块：提供了一个对Object/XML映射实现，将Java对象映射成XML数据，或者将XML数据映射成java对象，Object/XML映射实现包括JAXB、Castor、XMLBeans和XStream。\n    - JMS模块：用于JMS(Java Messaging Service)，提供一套 “消息生产者、消息消费者”模板用于更加简单的使用JMS，JMS用于用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。\n - web集成\n    - 该模块建立在AoolicationContext模块之上，提供了Web应用的功能。如文件上传、FreeMarker等。\n    - Spring可以整合Struts2等MVC框架。Spring自己提供了MVC框架Spring MVC。\n - Test\n    - Spring可以用非容器依赖的编程方式进行几乎所有的测试工作，支持JUnit和TestNG等测试框架。\n\n## 3.资源包整理\n[spring资源下载链接][2]\n\n- 核心\n    - spring-beans-4.2.5.RELEASE.jar\n    - spring-context-4.2.5.RELEASE.jar\n    - spring-context-support-4.2.5.RELEASE.jar\n    - spring-core-4.2.5.RELEASE.jar\n    - spring-expression-4.2.5.RELEASE.jar\n- AOP\n    - spring-aop-4.2.5.RELEASE.jar\n    - spring-aspects-4.2.5.RELEASE.jar\n    - spring-instrument-4.2.5.RELEASE.jar\n    - spring-instrument-tomcat-4.2.5.RELEASE.jar\n    - spring-messaging-4.2.5.RELEASE.jar\n- WEB\n    - spring-web-4.2.5.RELEASE.jar\n    - spring-websocket-4.2.5.RELEASE.jar\n    - spring-webmvc-4.2.5.RELEASE.jar\n    - spring-webmvc-portlet-4.2.5.RELEASE.jar\n- DATA\n    - spring-jdbc-4.2.5.RELEASE.jar\n    - spring-jms-4.2.5.RELEASE.jar\n    - spring-orm-4.2.5.RELEASE.jar\n    - spring-oxm-4.2.5.RELEASE.jar\n    - spring-tx-4.2.5.RELEASE.jar\n- TEST\n    - spring-test-4.2.5.RELEASE.jar\n- LOG\n    - commons-logging-1.1.1.jar\n    - commons-logging\n    - log4j-1.2.15.jar\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/Spring/spring.png\n  [2]: http://maven.springframework.org/release/org/springframework/spring","source":"_posts/spring-1——框架简介.md","raw":"---\ntitle: spring(1)——框架简介\ncategories:\n  - Spring\ntags:\n  - Spring\ndate: 2017-06-12 13:19:16\n---\n\n这篇博客介绍了spring框架的组成及应用\n<!--more-->\n## 1.什么是spring框架？\nspring是一个轻量级的JAVA开发框架，由Rod Johnson创建。spring对应用对象（如javaBean）的生命周期进行管理，它是一个“粘合平台”，将很多技术粘合在一起，形成一个整体，使每个组件发挥最大功效。\n\n## 2.架构概述\n![spring架构][1]\n\n -  核心容器\n    - spring-bean是整个核心，Bean的定义、Bean 的创建以及对Bean的解析。\n    - spring-context是bean关系集合，也就是IOC容器\n    - spring-core发现、维护和管理变之间的关系\n    - spring-expression是EL遍地是语言的扩展，支持设置和获取对象属性，调用对象方法，操作数组、集合等。\n - 面向切面编程（AOP）和工具（Instruementation）\n    - Spring AOP模块提供了满足AOP Alliance规范的实现，还整合了AspectJ这种AOP语言级的框架。通过AOP能降低耦合。\n - 消息\n    - spring-messaging模块为集成messaging api和消息协议提供支持。\n - 数据访问集成\n    - 事务模块：该模块用于Spring管理事务，只要是Spring管理对象都能得到Spring管理事务的好处，无需在代码中进行事务控制了，而且支持编程和声明性的事务管理。\n    - JDBC模块：提供了一个JBDC的样例模板，使用这些模板能消除传统冗长的JDBC编码还有必须的事务控制，而且能享受到Spring管理事务的好处。\n    - ORM模块：提供与流行的“对象-关系”映射框架的无缝集成，包括hibernate、JPA、MyBatis等。而且可以使用Spring事务管理，无需额外控制事务。\n    - OXM模块：提供了一个对Object/XML映射实现，将Java对象映射成XML数据，或者将XML数据映射成java对象，Object/XML映射实现包括JAXB、Castor、XMLBeans和XStream。\n    - JMS模块：用于JMS(Java Messaging Service)，提供一套 “消息生产者、消息消费者”模板用于更加简单的使用JMS，JMS用于用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。\n - web集成\n    - 该模块建立在AoolicationContext模块之上，提供了Web应用的功能。如文件上传、FreeMarker等。\n    - Spring可以整合Struts2等MVC框架。Spring自己提供了MVC框架Spring MVC。\n - Test\n    - Spring可以用非容器依赖的编程方式进行几乎所有的测试工作，支持JUnit和TestNG等测试框架。\n\n## 3.资源包整理\n[spring资源下载链接][2]\n\n- 核心\n    - spring-beans-4.2.5.RELEASE.jar\n    - spring-context-4.2.5.RELEASE.jar\n    - spring-context-support-4.2.5.RELEASE.jar\n    - spring-core-4.2.5.RELEASE.jar\n    - spring-expression-4.2.5.RELEASE.jar\n- AOP\n    - spring-aop-4.2.5.RELEASE.jar\n    - spring-aspects-4.2.5.RELEASE.jar\n    - spring-instrument-4.2.5.RELEASE.jar\n    - spring-instrument-tomcat-4.2.5.RELEASE.jar\n    - spring-messaging-4.2.5.RELEASE.jar\n- WEB\n    - spring-web-4.2.5.RELEASE.jar\n    - spring-websocket-4.2.5.RELEASE.jar\n    - spring-webmvc-4.2.5.RELEASE.jar\n    - spring-webmvc-portlet-4.2.5.RELEASE.jar\n- DATA\n    - spring-jdbc-4.2.5.RELEASE.jar\n    - spring-jms-4.2.5.RELEASE.jar\n    - spring-orm-4.2.5.RELEASE.jar\n    - spring-oxm-4.2.5.RELEASE.jar\n    - spring-tx-4.2.5.RELEASE.jar\n- TEST\n    - spring-test-4.2.5.RELEASE.jar\n- LOG\n    - commons-logging-1.1.1.jar\n    - commons-logging\n    - log4j-1.2.15.jar\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/Spring/spring.png\n  [2]: http://maven.springframework.org/release/org/springframework/spring","slug":"spring-1——框架简介","published":1,"updated":"2018-02-27T07:38:38.099Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfvd003thwvf3xd3nix8","content":"<p>这篇博客介绍了spring框架的组成及应用<br><a id=\"more\"></a></p>\n<h2 id=\"1-什么是spring框架？\"><a href=\"#1-什么是spring框架？\" class=\"headerlink\" title=\"1.什么是spring框架？\"></a>1.什么是spring框架？</h2><p>spring是一个轻量级的JAVA开发框架，由Rod Johnson创建。spring对应用对象（如javaBean）的生命周期进行管理，它是一个“粘合平台”，将很多技术粘合在一起，形成一个整体，使每个组件发挥最大功效。</p>\n<h2 id=\"2-架构概述\"><a href=\"#2-架构概述\" class=\"headerlink\" title=\"2.架构概述\"></a>2.架构概述</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/Spring/spring.png\" alt=\"spring架构\"></p>\n<ul>\n<li>核心容器<ul>\n<li>spring-bean是整个核心，Bean的定义、Bean 的创建以及对Bean的解析。</li>\n<li>spring-context是bean关系集合，也就是IOC容器</li>\n<li>spring-core发现、维护和管理变之间的关系</li>\n<li>spring-expression是EL遍地是语言的扩展，支持设置和获取对象属性，调用对象方法，操作数组、集合等。</li>\n</ul>\n</li>\n<li>面向切面编程（AOP）和工具（Instruementation）<ul>\n<li>Spring AOP模块提供了满足AOP Alliance规范的实现，还整合了AspectJ这种AOP语言级的框架。通过AOP能降低耦合。</li>\n</ul>\n</li>\n<li>消息<ul>\n<li>spring-messaging模块为集成messaging api和消息协议提供支持。</li>\n</ul>\n</li>\n<li>数据访问集成<ul>\n<li>事务模块：该模块用于Spring管理事务，只要是Spring管理对象都能得到Spring管理事务的好处，无需在代码中进行事务控制了，而且支持编程和声明性的事务管理。</li>\n<li>JDBC模块：提供了一个JBDC的样例模板，使用这些模板能消除传统冗长的JDBC编码还有必须的事务控制，而且能享受到Spring管理事务的好处。</li>\n<li>ORM模块：提供与流行的“对象-关系”映射框架的无缝集成，包括hibernate、JPA、MyBatis等。而且可以使用Spring事务管理，无需额外控制事务。</li>\n<li>OXM模块：提供了一个对Object/XML映射实现，将Java对象映射成XML数据，或者将XML数据映射成java对象，Object/XML映射实现包括JAXB、Castor、XMLBeans和XStream。</li>\n<li>JMS模块：用于JMS(Java Messaging Service)，提供一套 “消息生产者、消息消费者”模板用于更加简单的使用JMS，JMS用于用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。</li>\n</ul>\n</li>\n<li>web集成<ul>\n<li>该模块建立在AoolicationContext模块之上，提供了Web应用的功能。如文件上传、FreeMarker等。</li>\n<li>Spring可以整合Struts2等MVC框架。Spring自己提供了MVC框架Spring MVC。</li>\n</ul>\n</li>\n<li>Test<ul>\n<li>Spring可以用非容器依赖的编程方式进行几乎所有的测试工作，支持JUnit和TestNG等测试框架。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"3-资源包整理\"><a href=\"#3-资源包整理\" class=\"headerlink\" title=\"3.资源包整理\"></a>3.资源包整理</h2><p><a href=\"http://maven.springframework.org/release/org/springframework/spring\" target=\"_blank\" rel=\"noopener\">spring资源下载链接</a></p>\n<ul>\n<li>核心<ul>\n<li>spring-beans-4.2.5.RELEASE.jar</li>\n<li>spring-context-4.2.5.RELEASE.jar</li>\n<li>spring-context-support-4.2.5.RELEASE.jar</li>\n<li>spring-core-4.2.5.RELEASE.jar</li>\n<li>spring-expression-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>AOP<ul>\n<li>spring-aop-4.2.5.RELEASE.jar</li>\n<li>spring-aspects-4.2.5.RELEASE.jar</li>\n<li>spring-instrument-4.2.5.RELEASE.jar</li>\n<li>spring-instrument-tomcat-4.2.5.RELEASE.jar</li>\n<li>spring-messaging-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>WEB<ul>\n<li>spring-web-4.2.5.RELEASE.jar</li>\n<li>spring-websocket-4.2.5.RELEASE.jar</li>\n<li>spring-webmvc-4.2.5.RELEASE.jar</li>\n<li>spring-webmvc-portlet-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>DATA<ul>\n<li>spring-jdbc-4.2.5.RELEASE.jar</li>\n<li>spring-jms-4.2.5.RELEASE.jar</li>\n<li>spring-orm-4.2.5.RELEASE.jar</li>\n<li>spring-oxm-4.2.5.RELEASE.jar</li>\n<li>spring-tx-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>TEST<ul>\n<li>spring-test-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>LOG<ul>\n<li>commons-logging-1.1.1.jar</li>\n<li>commons-logging</li>\n<li>log4j-1.2.15.jar</li>\n</ul>\n</li>\n</ul>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>这篇博客介绍了spring框架的组成及应用<br>","more":"</p>\n<h2 id=\"1-什么是spring框架？\"><a href=\"#1-什么是spring框架？\" class=\"headerlink\" title=\"1.什么是spring框架？\"></a>1.什么是spring框架？</h2><p>spring是一个轻量级的JAVA开发框架，由Rod Johnson创建。spring对应用对象（如javaBean）的生命周期进行管理，它是一个“粘合平台”，将很多技术粘合在一起，形成一个整体，使每个组件发挥最大功效。</p>\n<h2 id=\"2-架构概述\"><a href=\"#2-架构概述\" class=\"headerlink\" title=\"2.架构概述\"></a>2.架构概述</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/Spring/spring.png\" alt=\"spring架构\"></p>\n<ul>\n<li>核心容器<ul>\n<li>spring-bean是整个核心，Bean的定义、Bean 的创建以及对Bean的解析。</li>\n<li>spring-context是bean关系集合，也就是IOC容器</li>\n<li>spring-core发现、维护和管理变之间的关系</li>\n<li>spring-expression是EL遍地是语言的扩展，支持设置和获取对象属性，调用对象方法，操作数组、集合等。</li>\n</ul>\n</li>\n<li>面向切面编程（AOP）和工具（Instruementation）<ul>\n<li>Spring AOP模块提供了满足AOP Alliance规范的实现，还整合了AspectJ这种AOP语言级的框架。通过AOP能降低耦合。</li>\n</ul>\n</li>\n<li>消息<ul>\n<li>spring-messaging模块为集成messaging api和消息协议提供支持。</li>\n</ul>\n</li>\n<li>数据访问集成<ul>\n<li>事务模块：该模块用于Spring管理事务，只要是Spring管理对象都能得到Spring管理事务的好处，无需在代码中进行事务控制了，而且支持编程和声明性的事务管理。</li>\n<li>JDBC模块：提供了一个JBDC的样例模板，使用这些模板能消除传统冗长的JDBC编码还有必须的事务控制，而且能享受到Spring管理事务的好处。</li>\n<li>ORM模块：提供与流行的“对象-关系”映射框架的无缝集成，包括hibernate、JPA、MyBatis等。而且可以使用Spring事务管理，无需额外控制事务。</li>\n<li>OXM模块：提供了一个对Object/XML映射实现，将Java对象映射成XML数据，或者将XML数据映射成java对象，Object/XML映射实现包括JAXB、Castor、XMLBeans和XStream。</li>\n<li>JMS模块：用于JMS(Java Messaging Service)，提供一套 “消息生产者、消息消费者”模板用于更加简单的使用JMS，JMS用于用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。</li>\n</ul>\n</li>\n<li>web集成<ul>\n<li>该模块建立在AoolicationContext模块之上，提供了Web应用的功能。如文件上传、FreeMarker等。</li>\n<li>Spring可以整合Struts2等MVC框架。Spring自己提供了MVC框架Spring MVC。</li>\n</ul>\n</li>\n<li>Test<ul>\n<li>Spring可以用非容器依赖的编程方式进行几乎所有的测试工作，支持JUnit和TestNG等测试框架。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"3-资源包整理\"><a href=\"#3-资源包整理\" class=\"headerlink\" title=\"3.资源包整理\"></a>3.资源包整理</h2><p><a href=\"http://maven.springframework.org/release/org/springframework/spring\" target=\"_blank\" rel=\"noopener\">spring资源下载链接</a></p>\n<ul>\n<li>核心<ul>\n<li>spring-beans-4.2.5.RELEASE.jar</li>\n<li>spring-context-4.2.5.RELEASE.jar</li>\n<li>spring-context-support-4.2.5.RELEASE.jar</li>\n<li>spring-core-4.2.5.RELEASE.jar</li>\n<li>spring-expression-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>AOP<ul>\n<li>spring-aop-4.2.5.RELEASE.jar</li>\n<li>spring-aspects-4.2.5.RELEASE.jar</li>\n<li>spring-instrument-4.2.5.RELEASE.jar</li>\n<li>spring-instrument-tomcat-4.2.5.RELEASE.jar</li>\n<li>spring-messaging-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>WEB<ul>\n<li>spring-web-4.2.5.RELEASE.jar</li>\n<li>spring-websocket-4.2.5.RELEASE.jar</li>\n<li>spring-webmvc-4.2.5.RELEASE.jar</li>\n<li>spring-webmvc-portlet-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>DATA<ul>\n<li>spring-jdbc-4.2.5.RELEASE.jar</li>\n<li>spring-jms-4.2.5.RELEASE.jar</li>\n<li>spring-orm-4.2.5.RELEASE.jar</li>\n<li>spring-oxm-4.2.5.RELEASE.jar</li>\n<li>spring-tx-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>TEST<ul>\n<li>spring-test-4.2.5.RELEASE.jar</li>\n</ul>\n</li>\n<li>LOG<ul>\n<li>commons-logging-1.1.1.jar</li>\n<li>commons-logging</li>\n<li>log4j-1.2.15.jar</li>\n</ul>\n</li>\n</ul>"},{"title":"spring(3)——AOP浅析","date":"2017-06-14T09:05:36.000Z","_content":"这篇博客简要介绍了Spring AOP的执行过程及实现。\n<!--more-->\n## 1. AOP简介\nAOP（Aspect Oriented Programming），即面向切面编程，可以说是OOP（Object Oriented Programming，面向对象编程）的补充和完善。OOP引入封装、继承、多态等概念来建立一种对象层次结构，用于模拟公共行为的一个集合。不过OOP允许开发者定义纵向的关系，但并不适合定义横向的关系，例如日志功能。日志代码往往横向地散布在所有对象层次中，而与它对应的对象的核心功能毫无关系对于其他类型的代码，如安全性、异常处理和透明的持续性也都是如此，这种散布在各处的无关的代码被称为横切（cross cutting），在OOP设计中，它导致了大量代码的重复，而不利于各个模块的重用。\n\nAOP技术恰恰相反，它利用一种称为\"横切\"的技术，剖解开封装的对象内部，并将那些影响了多个类的公共行为封装到一个可重用模块，并将其命名为\"Aspect\"，即切面。所谓\"切面\"，简单说就是那些与业务无关，却为业务模块所共同调用的逻辑或责任封装起来，便于减少系统的重复代码，降低模块之间的耦合度，并有利于未来的可操作性和可维护性。\n\n使用\"横切\"技术，AOP把软件系统分为两个部分：核心关注点和横切关注点。业务处理的主要流程是核心关注点，与之关系不大的部分是横切关注点。横切关注点的一个特点是，他们经常发生在核心关注点的多处，而各处基本相似，比如权限认证、日志、事物。AOP的作用在于分离系统中的各种关注点，将核心关注点和横切关注点分离开来。\n\n## 2. AOP核心概念\n\n - **连接点(Joinpoint)**:被拦截到的点，因为Spring只支持方法类型的连接点，所以在Spring中连接点指的就是被拦截到的方法，实际上连接点还可以是字段或者构造器\n - **切入点(Pointcut**):要被增强的方法，定义了切入发生的地点\n - **通知(advice)**:要执行的增强方法，定义了切入的时机和执行的动作\n - **切面(Aspect)**:切入点和通知的对应关系，也就是两者结合的称呼\n - **目标对象(Target Object)**:包含切入点的运行时对象，也就是被代理的对象\n - **AOP代理(aop proxy)**:代理对象\n - **织入(Weaving)**:是一个将通知功能加入原始字节码的动态过程，共有三种方法，Spring使用的是运行时织入。\n\n## 3. AOP运行环境\n\n - Spring核心包（4个）\n - 日志包（两个）\n - AOP包（4个）\n    - Spring进行AOP开发(1个)spring-aop-4.2.5.RELEASE.jar\n    - Spring整合AspectJ框架spring-aspects-4.2.5.RELEASE.jar\n    - AOP联盟规范(1个)com.springsource.org.aopalliance-1.0.0.jar\n    - aspectJ支持(1个)com.springsource.org.aspectj.weaver-1.7.2.RELEASE.jar\n\n## 4. XML实现\n\n### 4.1 在配置文件中开启AOP空间\n### 4.2 编写连接点类，即需要增强的业务类\n    业务类可以有上层接口(JDK代理)，也可以没有(cglib代理)\n    \n - 业务类接口\n\n    ```java\n    public interface ImSleep {\n\t    public void sleep();\n    }\n    ```\n    \n - 业务类实现\n    \n    ```java\n\tpublic class HumanSleep implements ImSleep{\n\t\n    \t@Override\n    \tpublic void sleep() {\n    \t\tSystem.out.println(\"我要睡觉了\");\n    \t}\n    }\n    ```\n### 4.3 编写通知类，即增强方法所在的类\n\n```java\npublic class TimeHandler {\n    //通知方法\n\tpublic void printTime() {\n\t\tSystem.out.println(\"CurrentTime=\" + System.currentTimeMillis());\n\t}\n}\n```\n\n### 4.4 在xml中配置切面，即关联切入点和通知\n \n```xml\n<bean id=\"humanSleep\" class=\"com.topvision.ssm.domian.HumanSleep\"/>\n<bean id=\"timeHandler\" class=\"com.topvision.ssm.domian.TimeHandler\"/>\n\t\n<aop:config>\n    //配置切面，ref关联通知类\n\t<aop:aspect id=\"time\" ref=\"timeHandler\">\n\t    //切入点，匹配要切入的业务类\n\t\t<aop:pointcut expression=\"execution(*com.topvision.ssm.domian.HumanSleep.sleep())\" id=\"addTime\"/>\n\t\t//通知类型，执行通知类中的那个方法，关联的切入点\n\t\t<aop:before method=\"printTime\" pointcut-ref=\"addTime\"/>\n\t\t<aop:after method=\"printTime\" pointcut-ref=\"addTime\"/>\n\t</aop:aspect>\n</aop:config>\n```\n\n### 4.5 测试类\n\n```java\nApplicationContext ctx = new ClassPathXmlApplicationContext(\"applicationContext.xml\");\nImSleep human = (ImSleep) ctx.getBean(\"humanSleep\");\nhuman.sleep();\n```\n\n## 5. 注解实现\n### 5.1 开启aop注解\n核心配置文件中添加以下配置，功能等同于注解配置Bean的自动扫描路径\n```xml\n//开启bean扫描\n<context:component-scan base-package=\"com.topvision.ssm.*\"/> \n//开启aop注解扫描\n<aop:aspectj-autoproxy/>\n```\n### 5.2 配置业务类\n```java\n@Component\npublic class Bussiness {\n\t\n\t/**\n\t * 切入点\n\t */\n\tpublic String delete(String obj) {\n\t\tSystem.out.println(\"==========调用切入点：\" + obj + \"说：你敢删除我！===========\\n\");\n\t\treturn obj + \"：瞄～\";\n\t}\n\n\tpublic String add(String obj) {\n\t\tSystem.out.println(\"================这个方法不能被切。。。============== \\n\");\n\t\treturn obj + \"：瞄～ 嘿嘿！\";\n\t}\n\n\tpublic String modify(String obj) {\n\t\tSystem.out.println(\"=================这个也设置加入切吧====================\\n\");\n\t\treturn obj + \"：瞄改瞄啊！\";\n\t}\n}\n```\n### 5.3 配置通知类\n```java\n/**\n * 定义切面\n * \n * @Aspect : 标记为切面类\n * @Pointcut : 指定匹配切点\n * @Before : 指定前置通知，value中指定切入点匹配\n * @AfterReturning ：后置通知，具有可以指定返回值\n * @AfterThrowing ：异常通知\n * \n * @author yanbin\n * \n */\n@Component\n@Aspect\npublic class AspectAdvice {\n\n    /**\n     * 指定切入点匹配表达式，注意它是以方法的形式进行声明的。\n     */\n    @Pointcut(\"execution(* com.topvision.*..*.*(..))\")\n    public void anyMethod() {\n    }\n\n    /**\n     * 前置通知\n     * \n     * @param jp\n     */\n    @Before(value = \"execution(* com.topvision.ssm.domian.Bussiness.delete(..))\")\n    public void doBefore(JoinPoint jp) {\n        System.out.println(\"===========进入before advice============ \\n\");\n\n        System.out.print(\"准备在\" + jp.getTarget().getClass() + \"对象上用\");\n        System.out.print(jp.getSignature().getName() + \"方法进行对 '\");\n        System.out.print(jp.getArgs()[0] + \"'进行删除！\\n\\n\");\n\n        System.out.println(\"要进入切入点方法了 \\n\");\n    }\n\n    /**\n     * 后置通知\n     * \n     * @param jp\n     *            连接点\n     * @param result\n     *            返回值\n     */\n    @AfterReturning(value = \"anyMethod()\", returning = \"result\")\n    public void doAfter(JoinPoint jp, String result) {\n        System.out.println(\"==========进入after advice=========== \\n\");\n        System.out.println(\"切入点方法执行完了 \\n\");\n\n        System.out.print(jp.getArgs()[0] + \"在\");\n        System.out.print(jp.getTarget().getClass() + \"对象上被\");\n        System.out.print(jp.getSignature().getName() + \"方法删除了\");\n        System.out.print(\"只留下：\" + result + \"\\n\\n\");\n    }\n\n    /**\n     * 环绕通知\n     * \n     * @param pjp\n     *            连接点\n     */\n    @Around(value = \"anyMethod()\")\n    public void doAround(ProceedingJoinPoint pjp) throws Throwable {\n        System.out.println(\"===========进入around环绕方法！=========== \\n\");\n\n        // 调用目标方法之前执行的动作\n        System.out.println(\"调用方法之前: 执行！\\n\");\n\n        // 调用方法的参数\n        Object[] args = pjp.getArgs();\n        // 调用的方法名\n        String method = pjp.getSignature().getName();\n        // 获取目标对象\n        Object target = pjp.getTarget();\n        // 执行完方法的返回值：调用proceed()方法，就会触发切入点方法执行\n        Object result = pjp.proceed();\n\n        System.out.println(\"输出：\" + args[0] + \";\" + method + \";\" + target + \";\" + result + \"\\n\");\n        System.out.println(\"调用方法结束：之后执行！\\n\");\n    }\n\n    /**\n     * 异常通知\n     * \n     * @param jp\n     * @param e\n     */\n    @AfterThrowing(value = \"anyMethod())\", throwing = \"e\")\n    public void doThrow(JoinPoint jp, Throwable e) {\n        System.out.println(\"删除出错啦\");\n    }\n\n}\n```\n### 5.4 测试类（集成junit）\n\n```java\n@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations=\"classpath:applicationContext.xml\")\npublic class Test01{\n\t\n\t@Autowired\n\tprivate Bussiness bs;\n\t\n\t@Test\n\tpublic void BSTest() {\n\t\tbs.delete(\"qwe\");\n\t}\n}\n```\n## 6. 切入点表达式及通知\n### 6.1 切入点表达式\n格式：execution(切入点表达式)\nexecution([方法的访问控制修饰符] 方法的返回值 包名.类名/接口名.方法名(参数)) \n注意：方法的访问控制修饰符可以省略\n```xml\ncom.topvision.*.dao.UserDAO.add() com包下的topvision包下的任意包下的dao包下的...\n *..*.*()      任意包下的任意类中的任意方法\n```\n\t\t\t\t\t\t\n**方法参数**\n\n - add()\t\t无参数\n - add(*)\t\t一个参数\n - add(int)\t\t一个int型参数\n - add(*,*)\t\t两个参数\n - add(*,int)\t\t两个参数，第一个任意，第二个int\n - add(..)\t\t任意参数\n - add(*,..)\t\t至少一个参数\n\n### 6.2 通知类型\n\n 1. 类型\nbefore:在原始操作前运行\n\tafter: 在原始操作后运行，无论方法是否抛出异常\n\tafterReturning:在原始操作后运行，只有方法正常结束才运行，抛出异常则不运行\n\tafterThrowing:在原始操作中如果抛出异常，运行\n\taround: 在原始操作前后运行，通过ProceedingJoinPoint对象调用procee()方法完成对原始操作的调用\n\n 2. 格式\n    ```xml\n    <aop:before pointcut-ref=\"pt2\" method=\"before\"/> \n    <aop:after pointcut-ref=\"pt2\" method=\"after\"/> \n    <aop:after-returning pointcut-ref=\"pt2\" method=\"afterReturning\"/> \n    <aop:after-throwing pointcut-ref=\"pt2\" method=\"afterThrowing\"/> \n    <aop:around pointcut-ref=\"pt2\" method=\"around\"/>\n    ```\n\n### 6.3 获取通知参数\n为环绕通知之外的通知方法定义形参**JoinPoint**，该参数必须是通知方法的第一个参数。\n获取参数：Obejct[] args = jp.getArgs();\t\n范例：\n\n```java\npublic void before(JoinPoint jp){\t\n\tObject[] objs = jp.getArgs();\n\tSystem.out.println(\"before......\"+objs[0]+\",\"+objs[1]);\n}\n```\n为环绕通知方法定义形参**ProceedingJoinPoint**对象\n获取参数：Obejct[] args = pjp.getArgs();\n\n \n\n### 6.4 获取通知返回值\nafterReturning 与 around可以获取方法的返回值\n    \n- around通知获取返回值\n**ProceedingJoinPoint**对象执行调用原始操作的返回值就是原始方法的运行返回值。\n\n```java\nObject res = pt.proceed(args);\n```\n注意：如果原始方法返回值为void类型，则around方法返回值设置为Object。如果原始方法返回值为非void类型，则around方法内必须将原始方法调用的结果返回。\n原始方法返回值为void类型的，通知内获取的返回值统一为null。\n\n```java\npublic Object around(ProceedingJoinPoint pjp) throws Throwable{\n\tObject res = pjp.proceed(args);\n\treturn res;\n}\n```\n\n- afterReturning通知获取返回值\n在通知方法的参数中，声明一个Object类型的参数，用于保存方法的返回值\n\n```java\npublic void afterReturning(JoinPoint jp,Object abc){\n    System.out.println(\"afterReturning......\"+ abc);\n}\n```\n在配置文件中，为afterReturning声明保存返回值的变量名\n\n### 6.5 获取异常值\n异常对象的获取方式与返回值很相似，声明变量，在配置中声明保存异常对象的变量名。\n```xml\n<aop:after-throwing pointcut-ref=\"pt\" method=\"afterThrowing\" throwing=\"e\"/>\n```\n```java\npublic void afterThrowing (Throwable e){\n\tSystem.out.println(\"afterThrowing.......\"+ e);\n}\n```\n\n \n## 7. JDK代理与cglib代理\n\n\n\n\n\n","source":"_posts/spring-3——AOP浅析.md","raw":"---\ntitle: spring(3)——AOP浅析\ncategories:\n  - Spring\ntags:\n  - Spring\n  - AOP\ndate: 2017-06-14 17:05:36\n---\n这篇博客简要介绍了Spring AOP的执行过程及实现。\n<!--more-->\n## 1. AOP简介\nAOP（Aspect Oriented Programming），即面向切面编程，可以说是OOP（Object Oriented Programming，面向对象编程）的补充和完善。OOP引入封装、继承、多态等概念来建立一种对象层次结构，用于模拟公共行为的一个集合。不过OOP允许开发者定义纵向的关系，但并不适合定义横向的关系，例如日志功能。日志代码往往横向地散布在所有对象层次中，而与它对应的对象的核心功能毫无关系对于其他类型的代码，如安全性、异常处理和透明的持续性也都是如此，这种散布在各处的无关的代码被称为横切（cross cutting），在OOP设计中，它导致了大量代码的重复，而不利于各个模块的重用。\n\nAOP技术恰恰相反，它利用一种称为\"横切\"的技术，剖解开封装的对象内部，并将那些影响了多个类的公共行为封装到一个可重用模块，并将其命名为\"Aspect\"，即切面。所谓\"切面\"，简单说就是那些与业务无关，却为业务模块所共同调用的逻辑或责任封装起来，便于减少系统的重复代码，降低模块之间的耦合度，并有利于未来的可操作性和可维护性。\n\n使用\"横切\"技术，AOP把软件系统分为两个部分：核心关注点和横切关注点。业务处理的主要流程是核心关注点，与之关系不大的部分是横切关注点。横切关注点的一个特点是，他们经常发生在核心关注点的多处，而各处基本相似，比如权限认证、日志、事物。AOP的作用在于分离系统中的各种关注点，将核心关注点和横切关注点分离开来。\n\n## 2. AOP核心概念\n\n - **连接点(Joinpoint)**:被拦截到的点，因为Spring只支持方法类型的连接点，所以在Spring中连接点指的就是被拦截到的方法，实际上连接点还可以是字段或者构造器\n - **切入点(Pointcut**):要被增强的方法，定义了切入发生的地点\n - **通知(advice)**:要执行的增强方法，定义了切入的时机和执行的动作\n - **切面(Aspect)**:切入点和通知的对应关系，也就是两者结合的称呼\n - **目标对象(Target Object)**:包含切入点的运行时对象，也就是被代理的对象\n - **AOP代理(aop proxy)**:代理对象\n - **织入(Weaving)**:是一个将通知功能加入原始字节码的动态过程，共有三种方法，Spring使用的是运行时织入。\n\n## 3. AOP运行环境\n\n - Spring核心包（4个）\n - 日志包（两个）\n - AOP包（4个）\n    - Spring进行AOP开发(1个)spring-aop-4.2.5.RELEASE.jar\n    - Spring整合AspectJ框架spring-aspects-4.2.5.RELEASE.jar\n    - AOP联盟规范(1个)com.springsource.org.aopalliance-1.0.0.jar\n    - aspectJ支持(1个)com.springsource.org.aspectj.weaver-1.7.2.RELEASE.jar\n\n## 4. XML实现\n\n### 4.1 在配置文件中开启AOP空间\n### 4.2 编写连接点类，即需要增强的业务类\n    业务类可以有上层接口(JDK代理)，也可以没有(cglib代理)\n    \n - 业务类接口\n\n    ```java\n    public interface ImSleep {\n\t    public void sleep();\n    }\n    ```\n    \n - 业务类实现\n    \n    ```java\n\tpublic class HumanSleep implements ImSleep{\n\t\n    \t@Override\n    \tpublic void sleep() {\n    \t\tSystem.out.println(\"我要睡觉了\");\n    \t}\n    }\n    ```\n### 4.3 编写通知类，即增强方法所在的类\n\n```java\npublic class TimeHandler {\n    //通知方法\n\tpublic void printTime() {\n\t\tSystem.out.println(\"CurrentTime=\" + System.currentTimeMillis());\n\t}\n}\n```\n\n### 4.4 在xml中配置切面，即关联切入点和通知\n \n```xml\n<bean id=\"humanSleep\" class=\"com.topvision.ssm.domian.HumanSleep\"/>\n<bean id=\"timeHandler\" class=\"com.topvision.ssm.domian.TimeHandler\"/>\n\t\n<aop:config>\n    //配置切面，ref关联通知类\n\t<aop:aspect id=\"time\" ref=\"timeHandler\">\n\t    //切入点，匹配要切入的业务类\n\t\t<aop:pointcut expression=\"execution(*com.topvision.ssm.domian.HumanSleep.sleep())\" id=\"addTime\"/>\n\t\t//通知类型，执行通知类中的那个方法，关联的切入点\n\t\t<aop:before method=\"printTime\" pointcut-ref=\"addTime\"/>\n\t\t<aop:after method=\"printTime\" pointcut-ref=\"addTime\"/>\n\t</aop:aspect>\n</aop:config>\n```\n\n### 4.5 测试类\n\n```java\nApplicationContext ctx = new ClassPathXmlApplicationContext(\"applicationContext.xml\");\nImSleep human = (ImSleep) ctx.getBean(\"humanSleep\");\nhuman.sleep();\n```\n\n## 5. 注解实现\n### 5.1 开启aop注解\n核心配置文件中添加以下配置，功能等同于注解配置Bean的自动扫描路径\n```xml\n//开启bean扫描\n<context:component-scan base-package=\"com.topvision.ssm.*\"/> \n//开启aop注解扫描\n<aop:aspectj-autoproxy/>\n```\n### 5.2 配置业务类\n```java\n@Component\npublic class Bussiness {\n\t\n\t/**\n\t * 切入点\n\t */\n\tpublic String delete(String obj) {\n\t\tSystem.out.println(\"==========调用切入点：\" + obj + \"说：你敢删除我！===========\\n\");\n\t\treturn obj + \"：瞄～\";\n\t}\n\n\tpublic String add(String obj) {\n\t\tSystem.out.println(\"================这个方法不能被切。。。============== \\n\");\n\t\treturn obj + \"：瞄～ 嘿嘿！\";\n\t}\n\n\tpublic String modify(String obj) {\n\t\tSystem.out.println(\"=================这个也设置加入切吧====================\\n\");\n\t\treturn obj + \"：瞄改瞄啊！\";\n\t}\n}\n```\n### 5.3 配置通知类\n```java\n/**\n * 定义切面\n * \n * @Aspect : 标记为切面类\n * @Pointcut : 指定匹配切点\n * @Before : 指定前置通知，value中指定切入点匹配\n * @AfterReturning ：后置通知，具有可以指定返回值\n * @AfterThrowing ：异常通知\n * \n * @author yanbin\n * \n */\n@Component\n@Aspect\npublic class AspectAdvice {\n\n    /**\n     * 指定切入点匹配表达式，注意它是以方法的形式进行声明的。\n     */\n    @Pointcut(\"execution(* com.topvision.*..*.*(..))\")\n    public void anyMethod() {\n    }\n\n    /**\n     * 前置通知\n     * \n     * @param jp\n     */\n    @Before(value = \"execution(* com.topvision.ssm.domian.Bussiness.delete(..))\")\n    public void doBefore(JoinPoint jp) {\n        System.out.println(\"===========进入before advice============ \\n\");\n\n        System.out.print(\"准备在\" + jp.getTarget().getClass() + \"对象上用\");\n        System.out.print(jp.getSignature().getName() + \"方法进行对 '\");\n        System.out.print(jp.getArgs()[0] + \"'进行删除！\\n\\n\");\n\n        System.out.println(\"要进入切入点方法了 \\n\");\n    }\n\n    /**\n     * 后置通知\n     * \n     * @param jp\n     *            连接点\n     * @param result\n     *            返回值\n     */\n    @AfterReturning(value = \"anyMethod()\", returning = \"result\")\n    public void doAfter(JoinPoint jp, String result) {\n        System.out.println(\"==========进入after advice=========== \\n\");\n        System.out.println(\"切入点方法执行完了 \\n\");\n\n        System.out.print(jp.getArgs()[0] + \"在\");\n        System.out.print(jp.getTarget().getClass() + \"对象上被\");\n        System.out.print(jp.getSignature().getName() + \"方法删除了\");\n        System.out.print(\"只留下：\" + result + \"\\n\\n\");\n    }\n\n    /**\n     * 环绕通知\n     * \n     * @param pjp\n     *            连接点\n     */\n    @Around(value = \"anyMethod()\")\n    public void doAround(ProceedingJoinPoint pjp) throws Throwable {\n        System.out.println(\"===========进入around环绕方法！=========== \\n\");\n\n        // 调用目标方法之前执行的动作\n        System.out.println(\"调用方法之前: 执行！\\n\");\n\n        // 调用方法的参数\n        Object[] args = pjp.getArgs();\n        // 调用的方法名\n        String method = pjp.getSignature().getName();\n        // 获取目标对象\n        Object target = pjp.getTarget();\n        // 执行完方法的返回值：调用proceed()方法，就会触发切入点方法执行\n        Object result = pjp.proceed();\n\n        System.out.println(\"输出：\" + args[0] + \";\" + method + \";\" + target + \";\" + result + \"\\n\");\n        System.out.println(\"调用方法结束：之后执行！\\n\");\n    }\n\n    /**\n     * 异常通知\n     * \n     * @param jp\n     * @param e\n     */\n    @AfterThrowing(value = \"anyMethod())\", throwing = \"e\")\n    public void doThrow(JoinPoint jp, Throwable e) {\n        System.out.println(\"删除出错啦\");\n    }\n\n}\n```\n### 5.4 测试类（集成junit）\n\n```java\n@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations=\"classpath:applicationContext.xml\")\npublic class Test01{\n\t\n\t@Autowired\n\tprivate Bussiness bs;\n\t\n\t@Test\n\tpublic void BSTest() {\n\t\tbs.delete(\"qwe\");\n\t}\n}\n```\n## 6. 切入点表达式及通知\n### 6.1 切入点表达式\n格式：execution(切入点表达式)\nexecution([方法的访问控制修饰符] 方法的返回值 包名.类名/接口名.方法名(参数)) \n注意：方法的访问控制修饰符可以省略\n```xml\ncom.topvision.*.dao.UserDAO.add() com包下的topvision包下的任意包下的dao包下的...\n *..*.*()      任意包下的任意类中的任意方法\n```\n\t\t\t\t\t\t\n**方法参数**\n\n - add()\t\t无参数\n - add(*)\t\t一个参数\n - add(int)\t\t一个int型参数\n - add(*,*)\t\t两个参数\n - add(*,int)\t\t两个参数，第一个任意，第二个int\n - add(..)\t\t任意参数\n - add(*,..)\t\t至少一个参数\n\n### 6.2 通知类型\n\n 1. 类型\nbefore:在原始操作前运行\n\tafter: 在原始操作后运行，无论方法是否抛出异常\n\tafterReturning:在原始操作后运行，只有方法正常结束才运行，抛出异常则不运行\n\tafterThrowing:在原始操作中如果抛出异常，运行\n\taround: 在原始操作前后运行，通过ProceedingJoinPoint对象调用procee()方法完成对原始操作的调用\n\n 2. 格式\n    ```xml\n    <aop:before pointcut-ref=\"pt2\" method=\"before\"/> \n    <aop:after pointcut-ref=\"pt2\" method=\"after\"/> \n    <aop:after-returning pointcut-ref=\"pt2\" method=\"afterReturning\"/> \n    <aop:after-throwing pointcut-ref=\"pt2\" method=\"afterThrowing\"/> \n    <aop:around pointcut-ref=\"pt2\" method=\"around\"/>\n    ```\n\n### 6.3 获取通知参数\n为环绕通知之外的通知方法定义形参**JoinPoint**，该参数必须是通知方法的第一个参数。\n获取参数：Obejct[] args = jp.getArgs();\t\n范例：\n\n```java\npublic void before(JoinPoint jp){\t\n\tObject[] objs = jp.getArgs();\n\tSystem.out.println(\"before......\"+objs[0]+\",\"+objs[1]);\n}\n```\n为环绕通知方法定义形参**ProceedingJoinPoint**对象\n获取参数：Obejct[] args = pjp.getArgs();\n\n \n\n### 6.4 获取通知返回值\nafterReturning 与 around可以获取方法的返回值\n    \n- around通知获取返回值\n**ProceedingJoinPoint**对象执行调用原始操作的返回值就是原始方法的运行返回值。\n\n```java\nObject res = pt.proceed(args);\n```\n注意：如果原始方法返回值为void类型，则around方法返回值设置为Object。如果原始方法返回值为非void类型，则around方法内必须将原始方法调用的结果返回。\n原始方法返回值为void类型的，通知内获取的返回值统一为null。\n\n```java\npublic Object around(ProceedingJoinPoint pjp) throws Throwable{\n\tObject res = pjp.proceed(args);\n\treturn res;\n}\n```\n\n- afterReturning通知获取返回值\n在通知方法的参数中，声明一个Object类型的参数，用于保存方法的返回值\n\n```java\npublic void afterReturning(JoinPoint jp,Object abc){\n    System.out.println(\"afterReturning......\"+ abc);\n}\n```\n在配置文件中，为afterReturning声明保存返回值的变量名\n\n### 6.5 获取异常值\n异常对象的获取方式与返回值很相似，声明变量，在配置中声明保存异常对象的变量名。\n```xml\n<aop:after-throwing pointcut-ref=\"pt\" method=\"afterThrowing\" throwing=\"e\"/>\n```\n```java\npublic void afterThrowing (Throwable e){\n\tSystem.out.println(\"afterThrowing.......\"+ e);\n}\n```\n\n \n## 7. JDK代理与cglib代理\n\n\n\n\n\n","slug":"spring-3——AOP浅析","published":1,"updated":"2018-02-27T07:38:38.100Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfvg003uhwvfeuqu52g0","content":"<p>这篇博客简要介绍了Spring AOP的执行过程及实现。<br><a id=\"more\"></a></p>\n<h2 id=\"1-AOP简介\"><a href=\"#1-AOP简介\" class=\"headerlink\" title=\"1. AOP简介\"></a>1. AOP简介</h2><p>AOP（Aspect Oriented Programming），即面向切面编程，可以说是OOP（Object Oriented Programming，面向对象编程）的补充和完善。OOP引入封装、继承、多态等概念来建立一种对象层次结构，用于模拟公共行为的一个集合。不过OOP允许开发者定义纵向的关系，但并不适合定义横向的关系，例如日志功能。日志代码往往横向地散布在所有对象层次中，而与它对应的对象的核心功能毫无关系对于其他类型的代码，如安全性、异常处理和透明的持续性也都是如此，这种散布在各处的无关的代码被称为横切（cross cutting），在OOP设计中，它导致了大量代码的重复，而不利于各个模块的重用。</p>\n<p>AOP技术恰恰相反，它利用一种称为”横切”的技术，剖解开封装的对象内部，并将那些影响了多个类的公共行为封装到一个可重用模块，并将其命名为”Aspect”，即切面。所谓”切面”，简单说就是那些与业务无关，却为业务模块所共同调用的逻辑或责任封装起来，便于减少系统的重复代码，降低模块之间的耦合度，并有利于未来的可操作性和可维护性。</p>\n<p>使用”横切”技术，AOP把软件系统分为两个部分：核心关注点和横切关注点。业务处理的主要流程是核心关注点，与之关系不大的部分是横切关注点。横切关注点的一个特点是，他们经常发生在核心关注点的多处，而各处基本相似，比如权限认证、日志、事物。AOP的作用在于分离系统中的各种关注点，将核心关注点和横切关注点分离开来。</p>\n<h2 id=\"2-AOP核心概念\"><a href=\"#2-AOP核心概念\" class=\"headerlink\" title=\"2. AOP核心概念\"></a>2. AOP核心概念</h2><ul>\n<li><strong>连接点(Joinpoint)</strong>:被拦截到的点，因为Spring只支持方法类型的连接点，所以在Spring中连接点指的就是被拦截到的方法，实际上连接点还可以是字段或者构造器</li>\n<li><strong>切入点(Pointcut</strong>):要被增强的方法，定义了切入发生的地点</li>\n<li><strong>通知(advice)</strong>:要执行的增强方法，定义了切入的时机和执行的动作</li>\n<li><strong>切面(Aspect)</strong>:切入点和通知的对应关系，也就是两者结合的称呼</li>\n<li><strong>目标对象(Target Object)</strong>:包含切入点的运行时对象，也就是被代理的对象</li>\n<li><strong>AOP代理(aop proxy)</strong>:代理对象</li>\n<li><strong>织入(Weaving)</strong>:是一个将通知功能加入原始字节码的动态过程，共有三种方法，Spring使用的是运行时织入。</li>\n</ul>\n<h2 id=\"3-AOP运行环境\"><a href=\"#3-AOP运行环境\" class=\"headerlink\" title=\"3. AOP运行环境\"></a>3. AOP运行环境</h2><ul>\n<li>Spring核心包（4个）</li>\n<li>日志包（两个）</li>\n<li>AOP包（4个）<ul>\n<li>Spring进行AOP开发(1个)spring-aop-4.2.5.RELEASE.jar</li>\n<li>Spring整合AspectJ框架spring-aspects-4.2.5.RELEASE.jar</li>\n<li>AOP联盟规范(1个)com.springsource.org.aopalliance-1.0.0.jar</li>\n<li>aspectJ支持(1个)com.springsource.org.aspectj.weaver-1.7.2.RELEASE.jar</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"4-XML实现\"><a href=\"#4-XML实现\" class=\"headerlink\" title=\"4. XML实现\"></a>4. XML实现</h2><h3 id=\"4-1-在配置文件中开启AOP空间\"><a href=\"#4-1-在配置文件中开启AOP空间\" class=\"headerlink\" title=\"4.1 在配置文件中开启AOP空间\"></a>4.1 在配置文件中开启AOP空间</h3><h3 id=\"4-2-编写连接点类，即需要增强的业务类\"><a href=\"#4-2-编写连接点类，即需要增强的业务类\" class=\"headerlink\" title=\"4.2 编写连接点类，即需要增强的业务类\"></a>4.2 编写连接点类，即需要增强的业务类</h3><pre><code>业务类可以有上层接口(JDK代理)，也可以没有(cglib代理)\n</code></pre><ul>\n<li><p>业务类接口</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ImSleep</span> </span>&#123;</div><div class=\"line\"> <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sleep</span><span class=\"params\">()</span></span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul>\n<li><p>业务类实现</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HumanSleep</span> <span class=\"keyword\">implements</span> <span class=\"title\">ImSleep</span></span>&#123;</div><div class=\"line\"></div><div class=\"line\">   \t<span class=\"meta\">@Override</span></div><div class=\"line\">   \t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sleep</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">   \t\tSystem.out.println(<span class=\"string\">\"我要睡觉了\"</span>);</div><div class=\"line\">   \t&#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"4-3-编写通知类，即增强方法所在的类\"><a href=\"#4-3-编写通知类，即增强方法所在的类\" class=\"headerlink\" title=\"4.3 编写通知类，即增强方法所在的类\"></a>4.3 编写通知类，即增强方法所在的类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TimeHandler</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//通知方法</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">printTime</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"CurrentTime=\"</span> + System.currentTimeMillis());</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"4-4-在xml中配置切面，即关联切入点和通知\"><a href=\"#4-4-在xml中配置切面，即关联切入点和通知\" class=\"headerlink\" title=\"4.4 在xml中配置切面，即关联切入点和通知\"></a>4.4 在xml中配置切面，即关联切入点和通知</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"humanSleep\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.ssm.domian.HumanSleep\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"timeHandler\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.ssm.domian.TimeHandler\"</span>/&gt;</span></div><div class=\"line\">\t</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:config</span>&gt;</span></div><div class=\"line\">    //配置切面，ref关联通知类</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">aop:aspect</span> <span class=\"attr\">id</span>=<span class=\"string\">\"time\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"timeHandler\"</span>&gt;</span></div><div class=\"line\">\t    //切入点，匹配要切入的业务类</div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">aop:pointcut</span> <span class=\"attr\">expression</span>=<span class=\"string\">\"execution(*com.topvision.ssm.domian.HumanSleep.sleep())\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"addTime\"</span>/&gt;</span></div><div class=\"line\">\t\t//通知类型，执行通知类中的那个方法，关联的切入点</div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">aop:before</span> <span class=\"attr\">method</span>=<span class=\"string\">\"printTime\"</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"addTime\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">aop:after</span> <span class=\"attr\">method</span>=<span class=\"string\">\"printTime\"</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"addTime\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">aop:aspect</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">aop:config</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"4-5-测试类\"><a href=\"#4-5-测试类\" class=\"headerlink\" title=\"4.5 测试类\"></a>4.5 测试类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">ApplicationContext ctx = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(<span class=\"string\">\"applicationContext.xml\"</span>);</div><div class=\"line\">ImSleep human = (ImSleep) ctx.getBean(<span class=\"string\">\"humanSleep\"</span>);</div><div class=\"line\">human.sleep();</div></pre></td></tr></table></figure>\n<h2 id=\"5-注解实现\"><a href=\"#5-注解实现\" class=\"headerlink\" title=\"5. 注解实现\"></a>5. 注解实现</h2><h3 id=\"5-1-开启aop注解\"><a href=\"#5-1-开启aop注解\" class=\"headerlink\" title=\"5.1 开启aop注解\"></a>5.1 开启aop注解</h3><p>核心配置文件中添加以下配置，功能等同于注解配置Bean的自动扫描路径<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">//开启bean扫描</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.ssm.*\"</span>/&gt;</span> </div><div class=\"line\">//开启aop注解扫描</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:aspectj-autoproxy</span>/&gt;</span></div></pre></td></tr></table></figure></p>\n<h3 id=\"5-2-配置业务类\"><a href=\"#5-2-配置业务类\" class=\"headerlink\" title=\"5.2 配置业务类\"></a>5.2 配置业务类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Component</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Bussiness</span> </span>&#123;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * 切入点</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">delete</span><span class=\"params\">(String obj)</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"==========调用切入点：\"</span> + obj + <span class=\"string\">\"说：你敢删除我！===========\\n\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> obj + <span class=\"string\">\"：瞄～\"</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">add</span><span class=\"params\">(String obj)</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"================这个方法不能被切。。。============== \\n\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> obj + <span class=\"string\">\"：瞄～ 嘿嘿！\"</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">modify</span><span class=\"params\">(String obj)</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"=================这个也设置加入切吧====================\\n\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> obj + <span class=\"string\">\"：瞄改瞄啊！\"</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"5-3-配置通知类\"><a href=\"#5-3-配置通知类\" class=\"headerlink\" title=\"5.3 配置通知类\"></a>5.3 配置通知类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 定义切面</div><div class=\"line\"> * </div><div class=\"line\"> * <span class=\"doctag\">@Aspect</span> : 标记为切面类</div><div class=\"line\"> * <span class=\"doctag\">@Pointcut</span> : 指定匹配切点</div><div class=\"line\"> * <span class=\"doctag\">@Before</span> : 指定前置通知，value中指定切入点匹配</div><div class=\"line\"> * <span class=\"doctag\">@AfterReturning</span> ：后置通知，具有可以指定返回值</div><div class=\"line\"> * <span class=\"doctag\">@AfterThrowing</span> ：异常通知</div><div class=\"line\"> * </div><div class=\"line\"> * <span class=\"doctag\">@author</span> yanbin</div><div class=\"line\"> * </div><div class=\"line\"> */</div><div class=\"line\"><span class=\"meta\">@Component</span></div><div class=\"line\"><span class=\"meta\">@Aspect</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AspectAdvice</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 指定切入点匹配表达式，注意它是以方法的形式进行声明的。</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Pointcut</span>(<span class=\"string\">\"execution(* com.topvision.*..*.*(..))\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">anyMethod</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 前置通知</div><div class=\"line\">     * </div><div class=\"line\">     * <span class=\"doctag\">@param</span> jp</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Before</span>(value = <span class=\"string\">\"execution(* com.topvision.ssm.domian.Bussiness.delete(..))\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doBefore</span><span class=\"params\">(JoinPoint jp)</span> </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"===========进入before advice============ \\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        System.out.print(<span class=\"string\">\"准备在\"</span> + jp.getTarget().getClass() + <span class=\"string\">\"对象上用\"</span>);</div><div class=\"line\">        System.out.print(jp.getSignature().getName() + <span class=\"string\">\"方法进行对 '\"</span>);</div><div class=\"line\">        System.out.print(jp.getArgs()[<span class=\"number\">0</span>] + <span class=\"string\">\"'进行删除！\\n\\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        System.out.println(<span class=\"string\">\"要进入切入点方法了 \\n\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 后置通知</div><div class=\"line\">     * </div><div class=\"line\">     * <span class=\"doctag\">@param</span> jp</div><div class=\"line\">     *            连接点</div><div class=\"line\">     * <span class=\"doctag\">@param</span> result</div><div class=\"line\">     *            返回值</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@AfterReturning</span>(value = <span class=\"string\">\"anyMethod()\"</span>, returning = <span class=\"string\">\"result\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doAfter</span><span class=\"params\">(JoinPoint jp, String result)</span> </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"==========进入after advice=========== \\n\"</span>);</div><div class=\"line\">        System.out.println(<span class=\"string\">\"切入点方法执行完了 \\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        System.out.print(jp.getArgs()[<span class=\"number\">0</span>] + <span class=\"string\">\"在\"</span>);</div><div class=\"line\">        System.out.print(jp.getTarget().getClass() + <span class=\"string\">\"对象上被\"</span>);</div><div class=\"line\">        System.out.print(jp.getSignature().getName() + <span class=\"string\">\"方法删除了\"</span>);</div><div class=\"line\">        System.out.print(<span class=\"string\">\"只留下：\"</span> + result + <span class=\"string\">\"\\n\\n\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 环绕通知</div><div class=\"line\">     * </div><div class=\"line\">     * <span class=\"doctag\">@param</span> pjp</div><div class=\"line\">     *            连接点</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Around</span>(value = <span class=\"string\">\"anyMethod()\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doAround</span><span class=\"params\">(ProceedingJoinPoint pjp)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"===========进入around环绕方法！=========== \\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">// 调用目标方法之前执行的动作</span></div><div class=\"line\">        System.out.println(<span class=\"string\">\"调用方法之前: 执行！\\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">// 调用方法的参数</span></div><div class=\"line\">        Object[] args = pjp.getArgs();</div><div class=\"line\">        <span class=\"comment\">// 调用的方法名</span></div><div class=\"line\">        String method = pjp.getSignature().getName();</div><div class=\"line\">        <span class=\"comment\">// 获取目标对象</span></div><div class=\"line\">        Object target = pjp.getTarget();</div><div class=\"line\">        <span class=\"comment\">// 执行完方法的返回值：调用proceed()方法，就会触发切入点方法执行</span></div><div class=\"line\">        Object result = pjp.proceed();</div><div class=\"line\"></div><div class=\"line\">        System.out.println(<span class=\"string\">\"输出：\"</span> + args[<span class=\"number\">0</span>] + <span class=\"string\">\";\"</span> + method + <span class=\"string\">\";\"</span> + target + <span class=\"string\">\";\"</span> + result + <span class=\"string\">\"\\n\"</span>);</div><div class=\"line\">        System.out.println(<span class=\"string\">\"调用方法结束：之后执行！\\n\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 异常通知</div><div class=\"line\">     * </div><div class=\"line\">     * <span class=\"doctag\">@param</span> jp</div><div class=\"line\">     * <span class=\"doctag\">@param</span> e</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@AfterThrowing</span>(value = <span class=\"string\">\"anyMethod())\"</span>, throwing = <span class=\"string\">\"e\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doThrow</span><span class=\"params\">(JoinPoint jp, Throwable e)</span> </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"删除出错啦\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"5-4-测试类（集成junit）\"><a href=\"#5-4-测试类（集成junit）\" class=\"headerlink\" title=\"5.4 测试类（集成junit）\"></a>5.4 测试类（集成junit）</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class=\"line\"><span class=\"meta\">@ContextConfiguration</span>(locations=<span class=\"string\">\"classpath:applicationContext.xml\"</span>)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Test01</span></span>&#123;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"meta\">@Autowired</span></div><div class=\"line\">\t<span class=\"keyword\">private</span> Bussiness bs;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">BSTest</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tbs.delete(<span class=\"string\">\"qwe\"</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"6-切入点表达式及通知\"><a href=\"#6-切入点表达式及通知\" class=\"headerlink\" title=\"6. 切入点表达式及通知\"></a>6. 切入点表达式及通知</h2><h3 id=\"6-1-切入点表达式\"><a href=\"#6-1-切入点表达式\" class=\"headerlink\" title=\"6.1 切入点表达式\"></a>6.1 切入点表达式</h3><p>格式：execution(切入点表达式)<br>execution([方法的访问控制修饰符] 方法的返回值 包名.类名/接口名.方法名(参数))<br>注意：方法的访问控制修饰符可以省略<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">com.topvision.*.dao.UserDAO.add() com包下的topvision包下的任意包下的dao包下的...</div><div class=\"line\"> *..*.*()      任意包下的任意类中的任意方法</div></pre></td></tr></table></figure></p>\n<p><strong>方法参数</strong></p>\n<ul>\n<li>add()        无参数</li>\n<li>add(*)        一个参数</li>\n<li>add(int)        一个int型参数</li>\n<li>add(<em>,</em>)        两个参数</li>\n<li>add(*,int)        两个参数，第一个任意，第二个int</li>\n<li>add(..)        任意参数</li>\n<li>add(*,..)        至少一个参数</li>\n</ul>\n<h3 id=\"6-2-通知类型\"><a href=\"#6-2-通知类型\" class=\"headerlink\" title=\"6.2 通知类型\"></a>6.2 通知类型</h3><ol>\n<li><p>类型<br>before:在原始操作前运行<br>after: 在原始操作后运行，无论方法是否抛出异常<br>afterReturning:在原始操作后运行，只有方法正常结束才运行，抛出异常则不运行<br>afterThrowing:在原始操作中如果抛出异常，运行<br>around: 在原始操作前后运行，通过ProceedingJoinPoint对象调用procee()方法完成对原始操作的调用</p>\n</li>\n<li><p>格式</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:before</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"before\"</span>/&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:after</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"after\"</span>/&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:after-returning</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"afterReturning\"</span>/&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:after-throwing</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"afterThrowing\"</span>/&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:around</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"around\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"6-3-获取通知参数\"><a href=\"#6-3-获取通知参数\" class=\"headerlink\" title=\"6.3 获取通知参数\"></a>6.3 获取通知参数</h3><p>为环绕通知之外的通知方法定义形参<strong>JoinPoint</strong>，该参数必须是通知方法的第一个参数。<br>获取参数：Obejct[] args = jp.getArgs();<br>范例：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">before</span><span class=\"params\">(JoinPoint jp)</span></span>&#123;\t</div><div class=\"line\">\tObject[] objs = jp.getArgs();</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"before......\"</span>+objs[<span class=\"number\">0</span>]+<span class=\"string\">\",\"</span>+objs[<span class=\"number\">1</span>]);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>为环绕通知方法定义形参<strong>ProceedingJoinPoint</strong>对象<br>获取参数：Obejct[] args = pjp.getArgs();</p>\n<h3 id=\"6-4-获取通知返回值\"><a href=\"#6-4-获取通知返回值\" class=\"headerlink\" title=\"6.4 获取通知返回值\"></a>6.4 获取通知返回值</h3><p>afterReturning 与 around可以获取方法的返回值</p>\n<ul>\n<li>around通知获取返回值<br><strong>ProceedingJoinPoint</strong>对象执行调用原始操作的返回值就是原始方法的运行返回值。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">Object res = pt.proceed(args);</div></pre></td></tr></table></figure>\n<p>注意：如果原始方法返回值为void类型，则around方法返回值设置为Object。如果原始方法返回值为非void类型，则around方法内必须将原始方法调用的结果返回。<br>原始方法返回值为void类型的，通知内获取的返回值统一为null。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">around</span><span class=\"params\">(ProceedingJoinPoint pjp)</span> <span class=\"keyword\">throws</span> Throwable</span>&#123;</div><div class=\"line\">\tObject res = pjp.proceed(args);</div><div class=\"line\">\t<span class=\"keyword\">return</span> res;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<ul>\n<li>afterReturning通知获取返回值<br>在通知方法的参数中，声明一个Object类型的参数，用于保存方法的返回值</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterReturning</span><span class=\"params\">(JoinPoint jp,Object abc)</span></span>&#123;</div><div class=\"line\">    System.out.println(<span class=\"string\">\"afterReturning......\"</span>+ abc);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>在配置文件中，为afterReturning声明保存返回值的变量名</p>\n<h3 id=\"6-5-获取异常值\"><a href=\"#6-5-获取异常值\" class=\"headerlink\" title=\"6.5 获取异常值\"></a>6.5 获取异常值</h3><p>异常对象的获取方式与返回值很相似，声明变量，在配置中声明保存异常对象的变量名。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:after-throwing</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"afterThrowing\"</span> <span class=\"attr\">throwing</span>=<span class=\"string\">\"e\"</span>/&gt;</span></div></pre></td></tr></table></figure></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterThrowing</span> <span class=\"params\">(Throwable e)</span></span>&#123;</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"afterThrowing.......\"</span>+ e);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"7-JDK代理与cglib代理\"><a href=\"#7-JDK代理与cglib代理\" class=\"headerlink\" title=\"7. JDK代理与cglib代理\"></a>7. JDK代理与cglib代理</h2>","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>这篇博客简要介绍了Spring AOP的执行过程及实现。<br>","more":"</p>\n<h2 id=\"1-AOP简介\"><a href=\"#1-AOP简介\" class=\"headerlink\" title=\"1. AOP简介\"></a>1. AOP简介</h2><p>AOP（Aspect Oriented Programming），即面向切面编程，可以说是OOP（Object Oriented Programming，面向对象编程）的补充和完善。OOP引入封装、继承、多态等概念来建立一种对象层次结构，用于模拟公共行为的一个集合。不过OOP允许开发者定义纵向的关系，但并不适合定义横向的关系，例如日志功能。日志代码往往横向地散布在所有对象层次中，而与它对应的对象的核心功能毫无关系对于其他类型的代码，如安全性、异常处理和透明的持续性也都是如此，这种散布在各处的无关的代码被称为横切（cross cutting），在OOP设计中，它导致了大量代码的重复，而不利于各个模块的重用。</p>\n<p>AOP技术恰恰相反，它利用一种称为”横切”的技术，剖解开封装的对象内部，并将那些影响了多个类的公共行为封装到一个可重用模块，并将其命名为”Aspect”，即切面。所谓”切面”，简单说就是那些与业务无关，却为业务模块所共同调用的逻辑或责任封装起来，便于减少系统的重复代码，降低模块之间的耦合度，并有利于未来的可操作性和可维护性。</p>\n<p>使用”横切”技术，AOP把软件系统分为两个部分：核心关注点和横切关注点。业务处理的主要流程是核心关注点，与之关系不大的部分是横切关注点。横切关注点的一个特点是，他们经常发生在核心关注点的多处，而各处基本相似，比如权限认证、日志、事物。AOP的作用在于分离系统中的各种关注点，将核心关注点和横切关注点分离开来。</p>\n<h2 id=\"2-AOP核心概念\"><a href=\"#2-AOP核心概念\" class=\"headerlink\" title=\"2. AOP核心概念\"></a>2. AOP核心概念</h2><ul>\n<li><strong>连接点(Joinpoint)</strong>:被拦截到的点，因为Spring只支持方法类型的连接点，所以在Spring中连接点指的就是被拦截到的方法，实际上连接点还可以是字段或者构造器</li>\n<li><strong>切入点(Pointcut</strong>):要被增强的方法，定义了切入发生的地点</li>\n<li><strong>通知(advice)</strong>:要执行的增强方法，定义了切入的时机和执行的动作</li>\n<li><strong>切面(Aspect)</strong>:切入点和通知的对应关系，也就是两者结合的称呼</li>\n<li><strong>目标对象(Target Object)</strong>:包含切入点的运行时对象，也就是被代理的对象</li>\n<li><strong>AOP代理(aop proxy)</strong>:代理对象</li>\n<li><strong>织入(Weaving)</strong>:是一个将通知功能加入原始字节码的动态过程，共有三种方法，Spring使用的是运行时织入。</li>\n</ul>\n<h2 id=\"3-AOP运行环境\"><a href=\"#3-AOP运行环境\" class=\"headerlink\" title=\"3. AOP运行环境\"></a>3. AOP运行环境</h2><ul>\n<li>Spring核心包（4个）</li>\n<li>日志包（两个）</li>\n<li>AOP包（4个）<ul>\n<li>Spring进行AOP开发(1个)spring-aop-4.2.5.RELEASE.jar</li>\n<li>Spring整合AspectJ框架spring-aspects-4.2.5.RELEASE.jar</li>\n<li>AOP联盟规范(1个)com.springsource.org.aopalliance-1.0.0.jar</li>\n<li>aspectJ支持(1个)com.springsource.org.aspectj.weaver-1.7.2.RELEASE.jar</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"4-XML实现\"><a href=\"#4-XML实现\" class=\"headerlink\" title=\"4. XML实现\"></a>4. XML实现</h2><h3 id=\"4-1-在配置文件中开启AOP空间\"><a href=\"#4-1-在配置文件中开启AOP空间\" class=\"headerlink\" title=\"4.1 在配置文件中开启AOP空间\"></a>4.1 在配置文件中开启AOP空间</h3><h3 id=\"4-2-编写连接点类，即需要增强的业务类\"><a href=\"#4-2-编写连接点类，即需要增强的业务类\" class=\"headerlink\" title=\"4.2 编写连接点类，即需要增强的业务类\"></a>4.2 编写连接点类，即需要增强的业务类</h3><pre><code>业务类可以有上层接口(JDK代理)，也可以没有(cglib代理)\n</code></pre><ul>\n<li><p>业务类接口</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">ImSleep</span> </span>&#123;</div><div class=\"line\"> <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sleep</span><span class=\"params\">()</span></span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<ul>\n<li><p>业务类实现</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HumanSleep</span> <span class=\"keyword\">implements</span> <span class=\"title\">ImSleep</span></span>&#123;</div><div class=\"line\"></div><div class=\"line\">   \t<span class=\"meta\">@Override</span></div><div class=\"line\">   \t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sleep</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">   \t\tSystem.out.println(<span class=\"string\">\"我要睡觉了\"</span>);</div><div class=\"line\">   \t&#125;</div><div class=\"line\">   &#125;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"4-3-编写通知类，即增强方法所在的类\"><a href=\"#4-3-编写通知类，即增强方法所在的类\" class=\"headerlink\" title=\"4.3 编写通知类，即增强方法所在的类\"></a>4.3 编写通知类，即增强方法所在的类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TimeHandler</span> </span>&#123;</div><div class=\"line\">    <span class=\"comment\">//通知方法</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">printTime</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"CurrentTime=\"</span> + System.currentTimeMillis());</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"4-4-在xml中配置切面，即关联切入点和通知\"><a href=\"#4-4-在xml中配置切面，即关联切入点和通知\" class=\"headerlink\" title=\"4.4 在xml中配置切面，即关联切入点和通知\"></a>4.4 在xml中配置切面，即关联切入点和通知</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"humanSleep\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.ssm.domian.HumanSleep\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"timeHandler\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.ssm.domian.TimeHandler\"</span>/&gt;</span></div><div class=\"line\">\t</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:config</span>&gt;</span></div><div class=\"line\">    //配置切面，ref关联通知类</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">aop:aspect</span> <span class=\"attr\">id</span>=<span class=\"string\">\"time\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"timeHandler\"</span>&gt;</span></div><div class=\"line\">\t    //切入点，匹配要切入的业务类</div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">aop:pointcut</span> <span class=\"attr\">expression</span>=<span class=\"string\">\"execution(*com.topvision.ssm.domian.HumanSleep.sleep())\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"addTime\"</span>/&gt;</span></div><div class=\"line\">\t\t//通知类型，执行通知类中的那个方法，关联的切入点</div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">aop:before</span> <span class=\"attr\">method</span>=<span class=\"string\">\"printTime\"</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"addTime\"</span>/&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">aop:after</span> <span class=\"attr\">method</span>=<span class=\"string\">\"printTime\"</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"addTime\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">aop:aspect</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">aop:config</span>&gt;</span></div></pre></td></tr></table></figure>\n<h3 id=\"4-5-测试类\"><a href=\"#4-5-测试类\" class=\"headerlink\" title=\"4.5 测试类\"></a>4.5 测试类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">ApplicationContext ctx = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(<span class=\"string\">\"applicationContext.xml\"</span>);</div><div class=\"line\">ImSleep human = (ImSleep) ctx.getBean(<span class=\"string\">\"humanSleep\"</span>);</div><div class=\"line\">human.sleep();</div></pre></td></tr></table></figure>\n<h2 id=\"5-注解实现\"><a href=\"#5-注解实现\" class=\"headerlink\" title=\"5. 注解实现\"></a>5. 注解实现</h2><h3 id=\"5-1-开启aop注解\"><a href=\"#5-1-开启aop注解\" class=\"headerlink\" title=\"5.1 开启aop注解\"></a>5.1 开启aop注解</h3><p>核心配置文件中添加以下配置，功能等同于注解配置Bean的自动扫描路径<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">//开启bean扫描</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.ssm.*\"</span>/&gt;</span> </div><div class=\"line\">//开启aop注解扫描</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:aspectj-autoproxy</span>/&gt;</span></div></pre></td></tr></table></figure></p>\n<h3 id=\"5-2-配置业务类\"><a href=\"#5-2-配置业务类\" class=\"headerlink\" title=\"5.2 配置业务类\"></a>5.2 配置业务类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Component</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Bussiness</span> </span>&#123;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * 切入点</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">delete</span><span class=\"params\">(String obj)</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"==========调用切入点：\"</span> + obj + <span class=\"string\">\"说：你敢删除我！===========\\n\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> obj + <span class=\"string\">\"：瞄～\"</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">add</span><span class=\"params\">(String obj)</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"================这个方法不能被切。。。============== \\n\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> obj + <span class=\"string\">\"：瞄～ 嘿嘿！\"</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">modify</span><span class=\"params\">(String obj)</span> </span>&#123;</div><div class=\"line\">\t\tSystem.out.println(<span class=\"string\">\"=================这个也设置加入切吧====================\\n\"</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> obj + <span class=\"string\">\"：瞄改瞄啊！\"</span>;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"5-3-配置通知类\"><a href=\"#5-3-配置通知类\" class=\"headerlink\" title=\"5.3 配置通知类\"></a>5.3 配置通知类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 定义切面</div><div class=\"line\"> * </div><div class=\"line\"> * <span class=\"doctag\">@Aspect</span> : 标记为切面类</div><div class=\"line\"> * <span class=\"doctag\">@Pointcut</span> : 指定匹配切点</div><div class=\"line\"> * <span class=\"doctag\">@Before</span> : 指定前置通知，value中指定切入点匹配</div><div class=\"line\"> * <span class=\"doctag\">@AfterReturning</span> ：后置通知，具有可以指定返回值</div><div class=\"line\"> * <span class=\"doctag\">@AfterThrowing</span> ：异常通知</div><div class=\"line\"> * </div><div class=\"line\"> * <span class=\"doctag\">@author</span> yanbin</div><div class=\"line\"> * </div><div class=\"line\"> */</div><div class=\"line\"><span class=\"meta\">@Component</span></div><div class=\"line\"><span class=\"meta\">@Aspect</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AspectAdvice</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 指定切入点匹配表达式，注意它是以方法的形式进行声明的。</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Pointcut</span>(<span class=\"string\">\"execution(* com.topvision.*..*.*(..))\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">anyMethod</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 前置通知</div><div class=\"line\">     * </div><div class=\"line\">     * <span class=\"doctag\">@param</span> jp</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Before</span>(value = <span class=\"string\">\"execution(* com.topvision.ssm.domian.Bussiness.delete(..))\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doBefore</span><span class=\"params\">(JoinPoint jp)</span> </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"===========进入before advice============ \\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        System.out.print(<span class=\"string\">\"准备在\"</span> + jp.getTarget().getClass() + <span class=\"string\">\"对象上用\"</span>);</div><div class=\"line\">        System.out.print(jp.getSignature().getName() + <span class=\"string\">\"方法进行对 '\"</span>);</div><div class=\"line\">        System.out.print(jp.getArgs()[<span class=\"number\">0</span>] + <span class=\"string\">\"'进行删除！\\n\\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        System.out.println(<span class=\"string\">\"要进入切入点方法了 \\n\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 后置通知</div><div class=\"line\">     * </div><div class=\"line\">     * <span class=\"doctag\">@param</span> jp</div><div class=\"line\">     *            连接点</div><div class=\"line\">     * <span class=\"doctag\">@param</span> result</div><div class=\"line\">     *            返回值</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@AfterReturning</span>(value = <span class=\"string\">\"anyMethod()\"</span>, returning = <span class=\"string\">\"result\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doAfter</span><span class=\"params\">(JoinPoint jp, String result)</span> </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"==========进入after advice=========== \\n\"</span>);</div><div class=\"line\">        System.out.println(<span class=\"string\">\"切入点方法执行完了 \\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        System.out.print(jp.getArgs()[<span class=\"number\">0</span>] + <span class=\"string\">\"在\"</span>);</div><div class=\"line\">        System.out.print(jp.getTarget().getClass() + <span class=\"string\">\"对象上被\"</span>);</div><div class=\"line\">        System.out.print(jp.getSignature().getName() + <span class=\"string\">\"方法删除了\"</span>);</div><div class=\"line\">        System.out.print(<span class=\"string\">\"只留下：\"</span> + result + <span class=\"string\">\"\\n\\n\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 环绕通知</div><div class=\"line\">     * </div><div class=\"line\">     * <span class=\"doctag\">@param</span> pjp</div><div class=\"line\">     *            连接点</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@Around</span>(value = <span class=\"string\">\"anyMethod()\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doAround</span><span class=\"params\">(ProceedingJoinPoint pjp)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"===========进入around环绕方法！=========== \\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">// 调用目标方法之前执行的动作</span></div><div class=\"line\">        System.out.println(<span class=\"string\">\"调用方法之前: 执行！\\n\"</span>);</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">// 调用方法的参数</span></div><div class=\"line\">        Object[] args = pjp.getArgs();</div><div class=\"line\">        <span class=\"comment\">// 调用的方法名</span></div><div class=\"line\">        String method = pjp.getSignature().getName();</div><div class=\"line\">        <span class=\"comment\">// 获取目标对象</span></div><div class=\"line\">        Object target = pjp.getTarget();</div><div class=\"line\">        <span class=\"comment\">// 执行完方法的返回值：调用proceed()方法，就会触发切入点方法执行</span></div><div class=\"line\">        Object result = pjp.proceed();</div><div class=\"line\"></div><div class=\"line\">        System.out.println(<span class=\"string\">\"输出：\"</span> + args[<span class=\"number\">0</span>] + <span class=\"string\">\";\"</span> + method + <span class=\"string\">\";\"</span> + target + <span class=\"string\">\";\"</span> + result + <span class=\"string\">\"\\n\"</span>);</div><div class=\"line\">        System.out.println(<span class=\"string\">\"调用方法结束：之后执行！\\n\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">/**</span></div><div class=\"line\">     * 异常通知</div><div class=\"line\">     * </div><div class=\"line\">     * <span class=\"doctag\">@param</span> jp</div><div class=\"line\">     * <span class=\"doctag\">@param</span> e</div><div class=\"line\">     */</div><div class=\"line\">    <span class=\"meta\">@AfterThrowing</span>(value = <span class=\"string\">\"anyMethod())\"</span>, throwing = <span class=\"string\">\"e\"</span>)</div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">doThrow</span><span class=\"params\">(JoinPoint jp, Throwable e)</span> </span>&#123;</div><div class=\"line\">        System.out.println(<span class=\"string\">\"删除出错啦\"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"5-4-测试类（集成junit）\"><a href=\"#5-4-测试类（集成junit）\" class=\"headerlink\" title=\"5.4 测试类（集成junit）\"></a>5.4 测试类（集成junit）</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class=\"line\"><span class=\"meta\">@ContextConfiguration</span>(locations=<span class=\"string\">\"classpath:applicationContext.xml\"</span>)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Test01</span></span>&#123;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"meta\">@Autowired</span></div><div class=\"line\">\t<span class=\"keyword\">private</span> Bussiness bs;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">BSTest</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tbs.delete(<span class=\"string\">\"qwe\"</span>);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"6-切入点表达式及通知\"><a href=\"#6-切入点表达式及通知\" class=\"headerlink\" title=\"6. 切入点表达式及通知\"></a>6. 切入点表达式及通知</h2><h3 id=\"6-1-切入点表达式\"><a href=\"#6-1-切入点表达式\" class=\"headerlink\" title=\"6.1 切入点表达式\"></a>6.1 切入点表达式</h3><p>格式：execution(切入点表达式)<br>execution([方法的访问控制修饰符] 方法的返回值 包名.类名/接口名.方法名(参数))<br>注意：方法的访问控制修饰符可以省略<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">com.topvision.*.dao.UserDAO.add() com包下的topvision包下的任意包下的dao包下的...</div><div class=\"line\"> *..*.*()      任意包下的任意类中的任意方法</div></pre></td></tr></table></figure></p>\n<p><strong>方法参数</strong></p>\n<ul>\n<li>add()        无参数</li>\n<li>add(*)        一个参数</li>\n<li>add(int)        一个int型参数</li>\n<li>add(<em>,</em>)        两个参数</li>\n<li>add(*,int)        两个参数，第一个任意，第二个int</li>\n<li>add(..)        任意参数</li>\n<li>add(*,..)        至少一个参数</li>\n</ul>\n<h3 id=\"6-2-通知类型\"><a href=\"#6-2-通知类型\" class=\"headerlink\" title=\"6.2 通知类型\"></a>6.2 通知类型</h3><ol>\n<li><p>类型<br>before:在原始操作前运行<br>after: 在原始操作后运行，无论方法是否抛出异常<br>afterReturning:在原始操作后运行，只有方法正常结束才运行，抛出异常则不运行<br>afterThrowing:在原始操作中如果抛出异常，运行<br>around: 在原始操作前后运行，通过ProceedingJoinPoint对象调用procee()方法完成对原始操作的调用</p>\n</li>\n<li><p>格式</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:before</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"before\"</span>/&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:after</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"after\"</span>/&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:after-returning</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"afterReturning\"</span>/&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:after-throwing</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"afterThrowing\"</span>/&gt;</span> </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:around</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt2\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"around\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"6-3-获取通知参数\"><a href=\"#6-3-获取通知参数\" class=\"headerlink\" title=\"6.3 获取通知参数\"></a>6.3 获取通知参数</h3><p>为环绕通知之外的通知方法定义形参<strong>JoinPoint</strong>，该参数必须是通知方法的第一个参数。<br>获取参数：Obejct[] args = jp.getArgs();<br>范例：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">before</span><span class=\"params\">(JoinPoint jp)</span></span>&#123;\t</div><div class=\"line\">\tObject[] objs = jp.getArgs();</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"before......\"</span>+objs[<span class=\"number\">0</span>]+<span class=\"string\">\",\"</span>+objs[<span class=\"number\">1</span>]);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>为环绕通知方法定义形参<strong>ProceedingJoinPoint</strong>对象<br>获取参数：Obejct[] args = pjp.getArgs();</p>\n<h3 id=\"6-4-获取通知返回值\"><a href=\"#6-4-获取通知返回值\" class=\"headerlink\" title=\"6.4 获取通知返回值\"></a>6.4 获取通知返回值</h3><p>afterReturning 与 around可以获取方法的返回值</p>\n<ul>\n<li>around通知获取返回值<br><strong>ProceedingJoinPoint</strong>对象执行调用原始操作的返回值就是原始方法的运行返回值。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">Object res = pt.proceed(args);</div></pre></td></tr></table></figure>\n<p>注意：如果原始方法返回值为void类型，则around方法返回值设置为Object。如果原始方法返回值为非void类型，则around方法内必须将原始方法调用的结果返回。<br>原始方法返回值为void类型的，通知内获取的返回值统一为null。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">around</span><span class=\"params\">(ProceedingJoinPoint pjp)</span> <span class=\"keyword\">throws</span> Throwable</span>&#123;</div><div class=\"line\">\tObject res = pjp.proceed(args);</div><div class=\"line\">\t<span class=\"keyword\">return</span> res;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<ul>\n<li>afterReturning通知获取返回值<br>在通知方法的参数中，声明一个Object类型的参数，用于保存方法的返回值</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterReturning</span><span class=\"params\">(JoinPoint jp,Object abc)</span></span>&#123;</div><div class=\"line\">    System.out.println(<span class=\"string\">\"afterReturning......\"</span>+ abc);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>在配置文件中，为afterReturning声明保存返回值的变量名</p>\n<h3 id=\"6-5-获取异常值\"><a href=\"#6-5-获取异常值\" class=\"headerlink\" title=\"6.5 获取异常值\"></a>6.5 获取异常值</h3><p>异常对象的获取方式与返回值很相似，声明变量，在配置中声明保存异常对象的变量名。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">aop:after-throwing</span> <span class=\"attr\">pointcut-ref</span>=<span class=\"string\">\"pt\"</span> <span class=\"attr\">method</span>=<span class=\"string\">\"afterThrowing\"</span> <span class=\"attr\">throwing</span>=<span class=\"string\">\"e\"</span>/&gt;</span></div></pre></td></tr></table></figure></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">afterThrowing</span> <span class=\"params\">(Throwable e)</span></span>&#123;</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"afterThrowing.......\"</span>+ e);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"7-JDK代理与cglib代理\"><a href=\"#7-JDK代理与cglib代理\" class=\"headerlink\" title=\"7. JDK代理与cglib代理\"></a>7. JDK代理与cglib代理</h2>"},{"title":"spring(2)——IOC浅析","date":"2017-06-14T01:59:11.000Z","_content":"\n这篇博客简单分析了IOC和DI的原理及区别，并介绍了基于xml和注解的Bean配置方式。\n<!--more-->\n## 1. 什么是IOC?\n\n### 1.1 IoC(Inversion of Control)控制反转\n - 控制:控制的双方是什么？谁控制谁？\n    -  主控方：Spring\n    -  被控方：应用程序所使用的资源\n    -  (原始)应用程序控制自己执行操作需要使用的外部资源\n    -  (Spring)Spring控制整个程序中所需要使用的外部资源\n - 反转:什么是反转？反转什么？\n    -  正向：应用程序直接调用资源\n    -  反向：应用程序依赖Spring为其提供资源\n    -  反转的是资源的控制权\n    -  应用程序由主动调用资源，变为被动的等待Spring提供资源\n - 有什么好处？\n    -  正向缺点：应用程序控制的资源分布在程序的每一个地方\n    -  反向的优点：所有的资源都在Spring中，便于管理\n    -  总结：Spring反向控制应用程序所需要使用的外部资源。资源受Spring管理，利用率最大化。\n\n### 1.2 spring演进模式\n\tA.基于分层设计\n\t\tUserAction\t\t\t使用UserService,new UserService()\n\t\tUserService\t\t\t使用UserDAO,new UserDAO()\n\t\tUserDAO\n\tB.工厂模式，使用面向接口编程设计，解决层与层之间的紧耦合\n\t\t制作接口，制作实现类，制作对象工厂\n```java\nA a = AFactory.createA();  \nB b = BFactory.createB();  \na.setB(b);\n```\n\tC.工厂模式+配置\n\t\t制作XML文件，将实现类配置到XML文件中\n\t\t读取XML文件中的配置信息，得到实现类的类名\n\t\t使用反射思想，获取实现类对象 class.newInstance();\n```java\nA a = Factory.create(“a”);  \nB b = Factory.create(“b”);  \na.setB(b);  \n```\n```xml\n<!--配置xml-->\na=AImpl  \nb=BImpl\n```\n\tD.自动的工厂+配置\n```java\n//返回装配好的a   \nA a = Factory.create(“a”);  \n```\n```xml\n<!--xml配置-->\n<bean id=“a” class=“AImpl”>  \n    <property name=“b” ref=“b”/>  \n</bean>  \n<bean id=“b” class=“BImpl”/>  \n```\n    E.工厂由Spring提供，实现类使用XML格式配置\n        工厂由Spring提供，实现类使用XML格式配置\n```java\n//返回装配好的a   \nA a = ApplicationContext.getBean(“a”);  \n```\n```xml\n<!--xml配置-->\n<bean id=“a” class=“AImpl”>  \n    <property name=“b” ref=“b”/>  \n</bean>  \n<bean id=“b” class=“BImpl”/>  \n```\n## 2. 什么是DI？\n### 2.1 DI的概念\nDI(Dependency Injection)依赖注入，指应用程序依赖Spring为其提供运行时所需的资源.\n\n- 谁依赖于谁？            -------   应用程序依赖于IoC容器\n- 为什么需要依赖？        -------   应用程序依赖于IoC容器装配类之间的关系\n- 依赖什么东西？          -------   依赖了IoC容器的装配功能\n- 谁注入于谁？            -------   IoC容器注入应用程序\n- 注入什么东西？          -------   注入应用程序需要的资源（类之间的关系）\n\n更能描述容器其特点的名字——“依赖注入”（Dependency Injection）\nIoC容器应该具有依赖注入功能，因此也可以叫DI容器 \n\n### 2.2 DI实现方式\n\n 1. 构造器注入\n 2. setter注入\n 3. 接口注入\n\n## 3. IOC和DI的关系？\nIOC和DI其实是同一概念的两种说法，两者站立的角度不一样。\nIOC：从spring的角度看，资源的控制权限被反转了\nDI：从应用程序的角度看，应用程序要依赖spring为其注入资源。\n\n## 4. BeanFactory\n\n 1. BeanFactory是ApplicationContext的顶层父接口，使用BeanFactory接口也可以完成获取Bean的操作.\n 2. 操作步骤:\n    ```java\n    //初始化Resource对象\n    Resource res = new ClassPathResource(\"applicationContext.xml\");\n    //初始化BeanFactory对象\n    BeanFactory bf = new XmlBeanFactory(res);\n    //根据id名称获取Bean\n    UserService service = (UserService) bf.getBean(\"userService\");\n    ```\n    \n 3. AppplicationContext与BeanFactory的区别\n   A. 加载方式不同\n\n        AppplicationContext：立即加载，加载配置文件时即加载\n\t\tBeanFactory:延迟加载，获取Bean实例时才加载\n   B. AppplicationContext具有更多的功能\n   \n        国际化处理\n        事件传递\n        Bean自动装配\n        各种不同应用层的Context实现\n        注意：实际开发中，优先选择ApplicationContext对象，避免使用BeanFactory\n\n 4. Schema风格离线约束配置方式\n        A.拷贝访问路径\n\t\tB.打开MyEclipse设置中的XML catalog选项\n\t\tC.创建新的映射\n\t\tD.选择对应的schema风格的约束文件\n\t\tE.将key type修改为schema location\n\t\tF.将要配置的路径复制到key中\n\n## 5. Bean配置（XML）\n### 5.1 Bean初始化\n\n 1. 构造器初始化（重点）\n    **Bean对应的类必须提供一个默认无参可访问的构造方法**\n 2. 静态工厂初始化\n \n    ```xml\n    <bean id=\"userService2\" \n        <!--配置中所配置的class配置成工厂类的类名-->\n        class=\"com.topvision.bean.UserStataicFactory\"\n        <!--配置工厂类中的创建实例的静态方法-->\n        factory-method=\"getInst\">\n    </bean>\n    ```\n 3. 实例工厂初始化\n    提供一个实例工厂类，使用其中的实例方法获取对象。由于该工厂类本身需要创建对象，因此该对象必须受Spring控制，所以必须配置该工厂类为Bean.\n\n    ```xml\n    <!—实例化工厂Bean -->\n    <bean id=\"uf\" class=\"com.topvision.bean.UserFactory\"></bean>\n    <!--使用实例工厂创建Bean -->\n    <!--factory-bean: 配置实例工厂在Spring范围内对应的Bean的id名称-->\n    <!--factory-method：配置工厂类中的创建实例的实例方法-->\n    <bean id=\"userService3\"  factory-bean=\"uf\" factory-method=\"getInst2\"></bean>\n    ```\n    \n### 5.2 Bean的作用域\n\nSpring初始化的Bean默认为单例模式，如果想修改成非单例模式需要修改Bean的作用范围。\n```xml   \n<bean id=”beanId” class=”BeanClassName” scope=”prototype”></bean>\n```\n\t\tscope属性：\n\t\t\tsingleton：单例\n\t\t\tprototype：非单例\n\t\t\trequest：请求对象范围request.setAttribute(\"beanId\",obj);\n\t\t\tsession：会话Session范围request.getSession().setAttribute(\"beanId\",obj);\n\t\t\tglobalSession：全局会话,分布式服务器\n\t\t\t\n### 5.3 Bean的生命周期\n定义Bean初始化与销毁时的动作，属于回调方法配置\n定义bean时指定两个回调方法，控制bean的初始化与销毁操作时执行的动作\n\n- init-method：初始化回调方法名，配置的方法必须由bean对象提供\n- destroy-method：销毁回调方法名，配置的方法必须由bean对象提供\n\n```xml\n<bean id=\"user\" class=\"com.topvision.lifecycle.User\" init-method=\"init\" destroy-method=\"destroy\" scope=\"prototype\"></bean>\n```\n\n- 销毁操作只针对scope=\"singletion\"的对象，对于非单例对象无效\n- 单例对象的销毁是在IoC容器关闭时发生，使用ClassPathXmlApplicationContext对象close方法完成\n- 非单例Bean对象的内存回收交由JVM完成——GC\n\n### 5.4 Bean属性注入\n\n 1. 构造器注入（了解）\n    A.在domain中提供对象的构造方法\n    B.xml配置中设置构造方法的参数\n    ```xml\n    <!-- constructor-arg:使用构造器传递参数  -->\n    <!-- value:赋值 -->\n    <bean id=\"bean6\" class=\"com.topvision.bean.xml.Bean6\">\n        <constructor-arg value=\"topvision\"/>\n        <constructor-arg value=\"2017\"/>\n    </bean>\n    ```\n    注意：如果类型匹配不成功，可以为配置中指定index索引属性，对应构造器中参数的位置.\n    ```xml\n\t<bean id=\"bean6\" class=\"com.topvision.bean.xml.Bean6\">\n\t\t<constructor-arg index=\"0\" value=\"2014\" type=\"java.lang.Integer\"></constructor-arg>\n\t    <constructor-arg index=\"1\" value=\"topvision\" type=\"java.lang.String\"></constructor-arg>\n\t</bean>\n\t```\n\t说明：构造器传参受构造器参数位置和类型的限定，因此不常使用\n\t\n 2. setter注入\n **前提：setter注入要求Bean必须提供无参可访问构造方法**\n\n    A.注入简单类型\n        \n        1.提供对应要注入的属性\n        2.为每个要注入的属性提供对应的标准封装setter方法\n        3.在配置中为Bean指定要注入的属性，使用property元素 name=“属性名” value=”值”\n    ```xml\n    <property name=\"属性名\" value=\"值\"/>\n    ```\n    B.注入引用类型\n         \n        1.为某个Bean注入引用类型的值，首先在Bean对应的类中声明对应的属性\n    ```java\n    private TeacherDAO dao;\n    ``` \n\n\t\t2.为每个要注入的属性提供对应的标准封装setter方法 (访问器)\n    ```xml\n \tpublic void setDao(TeacherDAO dao) {\n\t\tthis.dao = dao;\n\t}\n    ```\n        3.必须保障引入的对象是Spring控制的Bean\n    ```xml\n    <!-- 声明引用类型的资源为Bean -->\n    <bean id=\"teacherDao\" class=\"com.topvision.di.setter.TeacherDAO\">\t</bean>\n    ```\n        4.在Bean的属性注入中，使用ref引用对应的资源 ref=”beanId/beanName”\n    ```xml\n    <!-- setter注入 -->\n\t<!-- name:属性名 -->\n\t<!-- value:简单类型的值 -->\n\t<!-- ref:引用别的Bean，beanId/beanName -->\n\t<bean id=\"bean7\" class=\"com.topvision.bean.xml.Bean7\">\n\t\t<property name=\"name\" value=\"topvision\"/>\n\t\t<property name=\"age\" value=\"8\"/>\n\t\t<property name=\"dao\" ref=\"teacherDao\"></property>\n\t</bean>\n    ```\n    \n## 6. Bean配置（注解）\n从Spring2.5开始提供使用注解的形式配置Bean。\n\n### 6.1 配置Bean使用@Component注解\n如需为Bean定义名称，在参数中添加Bean名称@Component(\"beanName\")\n\n### 6.2 设定Spring的自动扫描路径\n用于检测对应的Bean是否配置了注解，并加载配置了注解的类\n\n - 开启context空间的支持\n```xml\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n  \txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n   \txmlns:context=\"http://www.springframework.org/schema/context\" \n   \txsi:schemaLocation=\"\n\thttp://www.springframework.org/schema/beans \n\thttp://www.springframework.org/schema/beans/spring-beans.xsd\n\thttp://www.springframework.org/schema/context \t\t\t\t\t\n\thttp://www.springframework.org/schema/context/spring-context.xsd\">\n\t\n```\n - 开启自动扫描功能，并指定扫描的路径\n```xml\n<context:component-scan base-package=\"com.topvision.annotation\"></context:component-scan>\n```\n说明：扫描路径可以设置多个，中间使用,隔开，扫描路径包含指定包和子包内所有的类,通常使用*号通配符匹配路径\n\n### 6.3 Spring提供的三个注解\n\n 1. @Repository 用于数据层实现类标注\n 2. @Service 用于业务逻辑层实现类标注\n 3. @Controller 用于控制层实现类进行标注\n\n### 6.4 注入简单类型\n\n 1. 在属性名上方声明该属性自动装配@Autowired\n 2. 在属性名上方声明该属性注入的值@Value(value)\n```java\n@Autowired\n@Value(\"topvision\")\nprivate String msg;\n```\n注意：注解自动装配属性值无需提供对应属性的setter方法\n\n### 6.5 注入引用类型\n\n - 在属性名上方声明该属性自动装配@Autowired\n - 在属性名上方声明该属性注入的值@Qualifier(bean引用名称)\n```java\n@Autowired\n@Qualifier(\"anno2\")\nprivate AnnotationOther other;\n```\n\n### 6.6 Autowired\nAutowired的required属性用用于声明自动装配的数据是必须的。\n\n 1. 如果required=true，必须为其装配数据，如果没有值，抛出异常\n 2. 如果required=false，自动装配数据失败，则注入值为null\n\n### 6.7 Resource\n\n 1. 格式一：@Resource(name=\"myImpl\")\n 2. 格式二：@Autowired(required=false)\n　　　　@Qualifier(\"myImpl\")\n以上两种格式效果相同\n\n### 6.8 Bean声明周期注解\n\n 1. @PostConstruct\n    功能：为当前Bean指定init-method参数\n\t格式：定义在成员方法的上方，兼容静态方法\n 2. @PreDestroy\n    功能：为当前Bean指定destory-method参数\n\t格式：定义在成员方法的上方，兼容静态方法\n\t注意：要求当前类被注册为Bean，否则无效果\n\n### 6.9 Bean作用域注解\n\n在类的定义上方添加@Scope指定Bean的作用域\n常用：@Scope(\"prototype\")\n默认：@Scope(\"singleton\")\n\n### 6.10 配置类注解\n**@Configuration**配置当前类为配置类，用于加载其中配置的Bean，与静态工厂初始化Bean很相似\n**@Bean(name=\"b1\")**将配置类中的某个方法的返回值声明为Bean，该方法必须返回一个对象\n```java\n@Configuration\t\t\t//设定该类参与自动扫描\npublic class MyBeanFactory {\n\t@Bean(name={\"aa\",\"bb\",\"cc\"})//设定该方法的返回值是一个Bean\n\tpublic static BookService getInst(){\n\t\treturn new BookService();\n\t}\n}\n```\n以上操作必须基于自动扫描功能，如不开启自动扫描，Spring将无法查找到对应的注解配置\n\n### 6.11 AnnotationConfigApplicationContext不使用自动扫描\n\nAnnotationConfigApplicationContext对象可以手工加载基于注解配置的Bean\n```java\n//用于手工添加注解开发Bean的上下文对象\nAnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext();\n//加载配置管理类\nctx.register(MyConfiguration.class);\n//刷新上下文对象\nctx.refresh();\n```\n\n注意：注册完成后一定要进行刷新，否则加载的Bean将无法被使用\n\n## 博客链接\n\n 1. [源码解读Spring IOC原理][1]\n 2. [Spring源代码解析][2]\n\n\n    \n\n\n  [1]: http://www.cnblogs.com/ITtangtang/p/3978349.html\n  [2]: http://www.cnblogs.com/dazhaxie/archive/2012/06/18/2553300.html","source":"_posts/spring-2——IOC浅析.md","raw":"---\ntitle: spring(2)——IOC浅析\ncategories:\n  - Spring\ntags:\n  - Spring\n  - IOC\ndate: 2017-06-14 09:59:11\n---\n\n这篇博客简单分析了IOC和DI的原理及区别，并介绍了基于xml和注解的Bean配置方式。\n<!--more-->\n## 1. 什么是IOC?\n\n### 1.1 IoC(Inversion of Control)控制反转\n - 控制:控制的双方是什么？谁控制谁？\n    -  主控方：Spring\n    -  被控方：应用程序所使用的资源\n    -  (原始)应用程序控制自己执行操作需要使用的外部资源\n    -  (Spring)Spring控制整个程序中所需要使用的外部资源\n - 反转:什么是反转？反转什么？\n    -  正向：应用程序直接调用资源\n    -  反向：应用程序依赖Spring为其提供资源\n    -  反转的是资源的控制权\n    -  应用程序由主动调用资源，变为被动的等待Spring提供资源\n - 有什么好处？\n    -  正向缺点：应用程序控制的资源分布在程序的每一个地方\n    -  反向的优点：所有的资源都在Spring中，便于管理\n    -  总结：Spring反向控制应用程序所需要使用的外部资源。资源受Spring管理，利用率最大化。\n\n### 1.2 spring演进模式\n\tA.基于分层设计\n\t\tUserAction\t\t\t使用UserService,new UserService()\n\t\tUserService\t\t\t使用UserDAO,new UserDAO()\n\t\tUserDAO\n\tB.工厂模式，使用面向接口编程设计，解决层与层之间的紧耦合\n\t\t制作接口，制作实现类，制作对象工厂\n```java\nA a = AFactory.createA();  \nB b = BFactory.createB();  \na.setB(b);\n```\n\tC.工厂模式+配置\n\t\t制作XML文件，将实现类配置到XML文件中\n\t\t读取XML文件中的配置信息，得到实现类的类名\n\t\t使用反射思想，获取实现类对象 class.newInstance();\n```java\nA a = Factory.create(“a”);  \nB b = Factory.create(“b”);  \na.setB(b);  \n```\n```xml\n<!--配置xml-->\na=AImpl  \nb=BImpl\n```\n\tD.自动的工厂+配置\n```java\n//返回装配好的a   \nA a = Factory.create(“a”);  \n```\n```xml\n<!--xml配置-->\n<bean id=“a” class=“AImpl”>  \n    <property name=“b” ref=“b”/>  \n</bean>  \n<bean id=“b” class=“BImpl”/>  \n```\n    E.工厂由Spring提供，实现类使用XML格式配置\n        工厂由Spring提供，实现类使用XML格式配置\n```java\n//返回装配好的a   \nA a = ApplicationContext.getBean(“a”);  \n```\n```xml\n<!--xml配置-->\n<bean id=“a” class=“AImpl”>  \n    <property name=“b” ref=“b”/>  \n</bean>  \n<bean id=“b” class=“BImpl”/>  \n```\n## 2. 什么是DI？\n### 2.1 DI的概念\nDI(Dependency Injection)依赖注入，指应用程序依赖Spring为其提供运行时所需的资源.\n\n- 谁依赖于谁？            -------   应用程序依赖于IoC容器\n- 为什么需要依赖？        -------   应用程序依赖于IoC容器装配类之间的关系\n- 依赖什么东西？          -------   依赖了IoC容器的装配功能\n- 谁注入于谁？            -------   IoC容器注入应用程序\n- 注入什么东西？          -------   注入应用程序需要的资源（类之间的关系）\n\n更能描述容器其特点的名字——“依赖注入”（Dependency Injection）\nIoC容器应该具有依赖注入功能，因此也可以叫DI容器 \n\n### 2.2 DI实现方式\n\n 1. 构造器注入\n 2. setter注入\n 3. 接口注入\n\n## 3. IOC和DI的关系？\nIOC和DI其实是同一概念的两种说法，两者站立的角度不一样。\nIOC：从spring的角度看，资源的控制权限被反转了\nDI：从应用程序的角度看，应用程序要依赖spring为其注入资源。\n\n## 4. BeanFactory\n\n 1. BeanFactory是ApplicationContext的顶层父接口，使用BeanFactory接口也可以完成获取Bean的操作.\n 2. 操作步骤:\n    ```java\n    //初始化Resource对象\n    Resource res = new ClassPathResource(\"applicationContext.xml\");\n    //初始化BeanFactory对象\n    BeanFactory bf = new XmlBeanFactory(res);\n    //根据id名称获取Bean\n    UserService service = (UserService) bf.getBean(\"userService\");\n    ```\n    \n 3. AppplicationContext与BeanFactory的区别\n   A. 加载方式不同\n\n        AppplicationContext：立即加载，加载配置文件时即加载\n\t\tBeanFactory:延迟加载，获取Bean实例时才加载\n   B. AppplicationContext具有更多的功能\n   \n        国际化处理\n        事件传递\n        Bean自动装配\n        各种不同应用层的Context实现\n        注意：实际开发中，优先选择ApplicationContext对象，避免使用BeanFactory\n\n 4. Schema风格离线约束配置方式\n        A.拷贝访问路径\n\t\tB.打开MyEclipse设置中的XML catalog选项\n\t\tC.创建新的映射\n\t\tD.选择对应的schema风格的约束文件\n\t\tE.将key type修改为schema location\n\t\tF.将要配置的路径复制到key中\n\n## 5. Bean配置（XML）\n### 5.1 Bean初始化\n\n 1. 构造器初始化（重点）\n    **Bean对应的类必须提供一个默认无参可访问的构造方法**\n 2. 静态工厂初始化\n \n    ```xml\n    <bean id=\"userService2\" \n        <!--配置中所配置的class配置成工厂类的类名-->\n        class=\"com.topvision.bean.UserStataicFactory\"\n        <!--配置工厂类中的创建实例的静态方法-->\n        factory-method=\"getInst\">\n    </bean>\n    ```\n 3. 实例工厂初始化\n    提供一个实例工厂类，使用其中的实例方法获取对象。由于该工厂类本身需要创建对象，因此该对象必须受Spring控制，所以必须配置该工厂类为Bean.\n\n    ```xml\n    <!—实例化工厂Bean -->\n    <bean id=\"uf\" class=\"com.topvision.bean.UserFactory\"></bean>\n    <!--使用实例工厂创建Bean -->\n    <!--factory-bean: 配置实例工厂在Spring范围内对应的Bean的id名称-->\n    <!--factory-method：配置工厂类中的创建实例的实例方法-->\n    <bean id=\"userService3\"  factory-bean=\"uf\" factory-method=\"getInst2\"></bean>\n    ```\n    \n### 5.2 Bean的作用域\n\nSpring初始化的Bean默认为单例模式，如果想修改成非单例模式需要修改Bean的作用范围。\n```xml   \n<bean id=”beanId” class=”BeanClassName” scope=”prototype”></bean>\n```\n\t\tscope属性：\n\t\t\tsingleton：单例\n\t\t\tprototype：非单例\n\t\t\trequest：请求对象范围request.setAttribute(\"beanId\",obj);\n\t\t\tsession：会话Session范围request.getSession().setAttribute(\"beanId\",obj);\n\t\t\tglobalSession：全局会话,分布式服务器\n\t\t\t\n### 5.3 Bean的生命周期\n定义Bean初始化与销毁时的动作，属于回调方法配置\n定义bean时指定两个回调方法，控制bean的初始化与销毁操作时执行的动作\n\n- init-method：初始化回调方法名，配置的方法必须由bean对象提供\n- destroy-method：销毁回调方法名，配置的方法必须由bean对象提供\n\n```xml\n<bean id=\"user\" class=\"com.topvision.lifecycle.User\" init-method=\"init\" destroy-method=\"destroy\" scope=\"prototype\"></bean>\n```\n\n- 销毁操作只针对scope=\"singletion\"的对象，对于非单例对象无效\n- 单例对象的销毁是在IoC容器关闭时发生，使用ClassPathXmlApplicationContext对象close方法完成\n- 非单例Bean对象的内存回收交由JVM完成——GC\n\n### 5.4 Bean属性注入\n\n 1. 构造器注入（了解）\n    A.在domain中提供对象的构造方法\n    B.xml配置中设置构造方法的参数\n    ```xml\n    <!-- constructor-arg:使用构造器传递参数  -->\n    <!-- value:赋值 -->\n    <bean id=\"bean6\" class=\"com.topvision.bean.xml.Bean6\">\n        <constructor-arg value=\"topvision\"/>\n        <constructor-arg value=\"2017\"/>\n    </bean>\n    ```\n    注意：如果类型匹配不成功，可以为配置中指定index索引属性，对应构造器中参数的位置.\n    ```xml\n\t<bean id=\"bean6\" class=\"com.topvision.bean.xml.Bean6\">\n\t\t<constructor-arg index=\"0\" value=\"2014\" type=\"java.lang.Integer\"></constructor-arg>\n\t    <constructor-arg index=\"1\" value=\"topvision\" type=\"java.lang.String\"></constructor-arg>\n\t</bean>\n\t```\n\t说明：构造器传参受构造器参数位置和类型的限定，因此不常使用\n\t\n 2. setter注入\n **前提：setter注入要求Bean必须提供无参可访问构造方法**\n\n    A.注入简单类型\n        \n        1.提供对应要注入的属性\n        2.为每个要注入的属性提供对应的标准封装setter方法\n        3.在配置中为Bean指定要注入的属性，使用property元素 name=“属性名” value=”值”\n    ```xml\n    <property name=\"属性名\" value=\"值\"/>\n    ```\n    B.注入引用类型\n         \n        1.为某个Bean注入引用类型的值，首先在Bean对应的类中声明对应的属性\n    ```java\n    private TeacherDAO dao;\n    ``` \n\n\t\t2.为每个要注入的属性提供对应的标准封装setter方法 (访问器)\n    ```xml\n \tpublic void setDao(TeacherDAO dao) {\n\t\tthis.dao = dao;\n\t}\n    ```\n        3.必须保障引入的对象是Spring控制的Bean\n    ```xml\n    <!-- 声明引用类型的资源为Bean -->\n    <bean id=\"teacherDao\" class=\"com.topvision.di.setter.TeacherDAO\">\t</bean>\n    ```\n        4.在Bean的属性注入中，使用ref引用对应的资源 ref=”beanId/beanName”\n    ```xml\n    <!-- setter注入 -->\n\t<!-- name:属性名 -->\n\t<!-- value:简单类型的值 -->\n\t<!-- ref:引用别的Bean，beanId/beanName -->\n\t<bean id=\"bean7\" class=\"com.topvision.bean.xml.Bean7\">\n\t\t<property name=\"name\" value=\"topvision\"/>\n\t\t<property name=\"age\" value=\"8\"/>\n\t\t<property name=\"dao\" ref=\"teacherDao\"></property>\n\t</bean>\n    ```\n    \n## 6. Bean配置（注解）\n从Spring2.5开始提供使用注解的形式配置Bean。\n\n### 6.1 配置Bean使用@Component注解\n如需为Bean定义名称，在参数中添加Bean名称@Component(\"beanName\")\n\n### 6.2 设定Spring的自动扫描路径\n用于检测对应的Bean是否配置了注解，并加载配置了注解的类\n\n - 开启context空间的支持\n```xml\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n  \txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n   \txmlns:context=\"http://www.springframework.org/schema/context\" \n   \txsi:schemaLocation=\"\n\thttp://www.springframework.org/schema/beans \n\thttp://www.springframework.org/schema/beans/spring-beans.xsd\n\thttp://www.springframework.org/schema/context \t\t\t\t\t\n\thttp://www.springframework.org/schema/context/spring-context.xsd\">\n\t\n```\n - 开启自动扫描功能，并指定扫描的路径\n```xml\n<context:component-scan base-package=\"com.topvision.annotation\"></context:component-scan>\n```\n说明：扫描路径可以设置多个，中间使用,隔开，扫描路径包含指定包和子包内所有的类,通常使用*号通配符匹配路径\n\n### 6.3 Spring提供的三个注解\n\n 1. @Repository 用于数据层实现类标注\n 2. @Service 用于业务逻辑层实现类标注\n 3. @Controller 用于控制层实现类进行标注\n\n### 6.4 注入简单类型\n\n 1. 在属性名上方声明该属性自动装配@Autowired\n 2. 在属性名上方声明该属性注入的值@Value(value)\n```java\n@Autowired\n@Value(\"topvision\")\nprivate String msg;\n```\n注意：注解自动装配属性值无需提供对应属性的setter方法\n\n### 6.5 注入引用类型\n\n - 在属性名上方声明该属性自动装配@Autowired\n - 在属性名上方声明该属性注入的值@Qualifier(bean引用名称)\n```java\n@Autowired\n@Qualifier(\"anno2\")\nprivate AnnotationOther other;\n```\n\n### 6.6 Autowired\nAutowired的required属性用用于声明自动装配的数据是必须的。\n\n 1. 如果required=true，必须为其装配数据，如果没有值，抛出异常\n 2. 如果required=false，自动装配数据失败，则注入值为null\n\n### 6.7 Resource\n\n 1. 格式一：@Resource(name=\"myImpl\")\n 2. 格式二：@Autowired(required=false)\n　　　　@Qualifier(\"myImpl\")\n以上两种格式效果相同\n\n### 6.8 Bean声明周期注解\n\n 1. @PostConstruct\n    功能：为当前Bean指定init-method参数\n\t格式：定义在成员方法的上方，兼容静态方法\n 2. @PreDestroy\n    功能：为当前Bean指定destory-method参数\n\t格式：定义在成员方法的上方，兼容静态方法\n\t注意：要求当前类被注册为Bean，否则无效果\n\n### 6.9 Bean作用域注解\n\n在类的定义上方添加@Scope指定Bean的作用域\n常用：@Scope(\"prototype\")\n默认：@Scope(\"singleton\")\n\n### 6.10 配置类注解\n**@Configuration**配置当前类为配置类，用于加载其中配置的Bean，与静态工厂初始化Bean很相似\n**@Bean(name=\"b1\")**将配置类中的某个方法的返回值声明为Bean，该方法必须返回一个对象\n```java\n@Configuration\t\t\t//设定该类参与自动扫描\npublic class MyBeanFactory {\n\t@Bean(name={\"aa\",\"bb\",\"cc\"})//设定该方法的返回值是一个Bean\n\tpublic static BookService getInst(){\n\t\treturn new BookService();\n\t}\n}\n```\n以上操作必须基于自动扫描功能，如不开启自动扫描，Spring将无法查找到对应的注解配置\n\n### 6.11 AnnotationConfigApplicationContext不使用自动扫描\n\nAnnotationConfigApplicationContext对象可以手工加载基于注解配置的Bean\n```java\n//用于手工添加注解开发Bean的上下文对象\nAnnotationConfigApplicationContext ctx = new AnnotationConfigApplicationContext();\n//加载配置管理类\nctx.register(MyConfiguration.class);\n//刷新上下文对象\nctx.refresh();\n```\n\n注意：注册完成后一定要进行刷新，否则加载的Bean将无法被使用\n\n## 博客链接\n\n 1. [源码解读Spring IOC原理][1]\n 2. [Spring源代码解析][2]\n\n\n    \n\n\n  [1]: http://www.cnblogs.com/ITtangtang/p/3978349.html\n  [2]: http://www.cnblogs.com/dazhaxie/archive/2012/06/18/2553300.html","slug":"spring-2——IOC浅析","published":1,"updated":"2018-02-27T07:38:38.100Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfvl003yhwvfjvan7gso","content":"<p>这篇博客简单分析了IOC和DI的原理及区别，并介绍了基于xml和注解的Bean配置方式。<br><a id=\"more\"></a></p>\n<h2 id=\"1-什么是IOC\"><a href=\"#1-什么是IOC\" class=\"headerlink\" title=\"1. 什么是IOC?\"></a>1. 什么是IOC?</h2><h3 id=\"1-1-IoC-Inversion-of-Control-控制反转\"><a href=\"#1-1-IoC-Inversion-of-Control-控制反转\" class=\"headerlink\" title=\"1.1 IoC(Inversion of Control)控制反转\"></a>1.1 IoC(Inversion of Control)控制反转</h3><ul>\n<li>控制:控制的双方是什么？谁控制谁？<ul>\n<li>主控方：Spring</li>\n<li>被控方：应用程序所使用的资源</li>\n<li>(原始)应用程序控制自己执行操作需要使用的外部资源</li>\n<li>(Spring)Spring控制整个程序中所需要使用的外部资源</li>\n</ul>\n</li>\n<li>反转:什么是反转？反转什么？<ul>\n<li>正向：应用程序直接调用资源</li>\n<li>反向：应用程序依赖Spring为其提供资源</li>\n<li>反转的是资源的控制权</li>\n<li>应用程序由主动调用资源，变为被动的等待Spring提供资源</li>\n</ul>\n</li>\n<li>有什么好处？<ul>\n<li>正向缺点：应用程序控制的资源分布在程序的每一个地方</li>\n<li>反向的优点：所有的资源都在Spring中，便于管理</li>\n<li>总结：Spring反向控制应用程序所需要使用的外部资源。资源受Spring管理，利用率最大化。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"1-2-spring演进模式\"><a href=\"#1-2-spring演进模式\" class=\"headerlink\" title=\"1.2 spring演进模式\"></a>1.2 spring演进模式</h3><pre><code>A.基于分层设计\n    UserAction            使用UserService,new UserService()\n    UserService            使用UserDAO,new UserDAO()\n    UserDAO\nB.工厂模式，使用面向接口编程设计，解决层与层之间的紧耦合\n    制作接口，制作实现类，制作对象工厂\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">A a = AFactory.createA();  </div><div class=\"line\">B b = BFactory.createB();  </div><div class=\"line\">a.setB(b);</div></pre></td></tr></table></figure>\n<pre><code>C.工厂模式+配置\n    制作XML文件，将实现类配置到XML文件中\n    读取XML文件中的配置信息，得到实现类的类名\n    使用反射思想，获取实现类对象 class.newInstance();\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">A a = Factory.create(“a”);  </div><div class=\"line\">B b = Factory.create(“b”);  </div><div class=\"line\">a.setB(b);</div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--配置xml--&gt;</span></div><div class=\"line\">a=AImpl  </div><div class=\"line\">b=BImpl</div></pre></td></tr></table></figure>\n<pre><code>D.自动的工厂+配置\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//返回装配好的a   </span></div><div class=\"line\">A a = Factory.create(“a”);</div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--xml配置--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">“a”</span> <span class=\"attr\">class</span>=<span class=\"string\">“AImpl”</span>&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">“b”</span> <span class=\"attr\">ref</span>=<span class=\"string\">“b”/</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">“b”</span> <span class=\"attr\">class</span>=<span class=\"string\">“BImpl”/</span>&gt;</span></div></pre></td></tr></table></figure>\n<pre><code>E.工厂由Spring提供，实现类使用XML格式配置\n    工厂由Spring提供，实现类使用XML格式配置\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//返回装配好的a   </span></div><div class=\"line\">A a = ApplicationContext.getBean(“a”);</div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--xml配置--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">“a”</span> <span class=\"attr\">class</span>=<span class=\"string\">“AImpl”</span>&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">“b”</span> <span class=\"attr\">ref</span>=<span class=\"string\">“b”/</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">“b”</span> <span class=\"attr\">class</span>=<span class=\"string\">“BImpl”/</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"2-什么是DI？\"><a href=\"#2-什么是DI？\" class=\"headerlink\" title=\"2. 什么是DI？\"></a>2. 什么是DI？</h2><h3 id=\"2-1-DI的概念\"><a href=\"#2-1-DI的概念\" class=\"headerlink\" title=\"2.1 DI的概念\"></a>2.1 DI的概念</h3><p>DI(Dependency Injection)依赖注入，指应用程序依赖Spring为其提供运行时所需的资源.</p>\n<ul>\n<li>谁依赖于谁？            ——-   应用程序依赖于IoC容器</li>\n<li>为什么需要依赖？        ——-   应用程序依赖于IoC容器装配类之间的关系</li>\n<li>依赖什么东西？          ——-   依赖了IoC容器的装配功能</li>\n<li>谁注入于谁？            ——-   IoC容器注入应用程序</li>\n<li>注入什么东西？          ——-   注入应用程序需要的资源（类之间的关系）</li>\n</ul>\n<p>更能描述容器其特点的名字——“依赖注入”（Dependency Injection）<br>IoC容器应该具有依赖注入功能，因此也可以叫DI容器 </p>\n<h3 id=\"2-2-DI实现方式\"><a href=\"#2-2-DI实现方式\" class=\"headerlink\" title=\"2.2 DI实现方式\"></a>2.2 DI实现方式</h3><ol>\n<li>构造器注入</li>\n<li>setter注入</li>\n<li>接口注入</li>\n</ol>\n<h2 id=\"3-IOC和DI的关系？\"><a href=\"#3-IOC和DI的关系？\" class=\"headerlink\" title=\"3. IOC和DI的关系？\"></a>3. IOC和DI的关系？</h2><p>IOC和DI其实是同一概念的两种说法，两者站立的角度不一样。<br>IOC：从spring的角度看，资源的控制权限被反转了<br>DI：从应用程序的角度看，应用程序要依赖spring为其注入资源。</p>\n<h2 id=\"4-BeanFactory\"><a href=\"#4-BeanFactory\" class=\"headerlink\" title=\"4. BeanFactory\"></a>4. BeanFactory</h2><ol>\n<li>BeanFactory是ApplicationContext的顶层父接口，使用BeanFactory接口也可以完成获取Bean的操作.</li>\n<li>操作步骤:<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//初始化Resource对象</span></div><div class=\"line\">Resource res = <span class=\"keyword\">new</span> ClassPathResource(<span class=\"string\">\"applicationContext.xml\"</span>);</div><div class=\"line\"><span class=\"comment\">//初始化BeanFactory对象</span></div><div class=\"line\">BeanFactory bf = <span class=\"keyword\">new</span> XmlBeanFactory(res);</div><div class=\"line\"><span class=\"comment\">//根据id名称获取Bean</span></div><div class=\"line\">UserService service = (UserService) bf.getBean(<span class=\"string\">\"userService\"</span>);</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>AppplicationContext与BeanFactory的区别<br>A. 加载方式不同</p>\n<pre><code>AppplicationContext：立即加载，加载配置文件时即加载\nBeanFactory:延迟加载，获取Bean实例时才加载\n</code></pre><p>B. AppplicationContext具有更多的功能</p>\n<pre><code>国际化处理\n事件传递\nBean自动装配\n各种不同应用层的Context实现\n注意：实际开发中，优先选择ApplicationContext对象，避免使用BeanFactory\n</code></pre></li>\n<li><p>Schema风格离线约束配置方式</p>\n<pre><code>A.拷贝访问路径\nB.打开MyEclipse设置中的XML catalog选项\nC.创建新的映射\nD.选择对应的schema风格的约束文件\nE.将key type修改为schema location\nF.将要配置的路径复制到key中\n</code></pre></li>\n</ol>\n<h2 id=\"5-Bean配置（XML）\"><a href=\"#5-Bean配置（XML）\" class=\"headerlink\" title=\"5. Bean配置（XML）\"></a>5. Bean配置（XML）</h2><h3 id=\"5-1-Bean初始化\"><a href=\"#5-1-Bean初始化\" class=\"headerlink\" title=\"5.1 Bean初始化\"></a>5.1 Bean初始化</h3><ol>\n<li>构造器初始化（重点）<br><strong>Bean对应的类必须提供一个默认无参可访问的构造方法</strong></li>\n<li><p>静态工厂初始化</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;bean id=\"userService2\" </div><div class=\"line\">    &lt;!--配置中所配置的class配置成工厂类的类名--&gt;</div><div class=\"line\">    class=\"com.topvision.bean.UserStataicFactory\"</div><div class=\"line\">    &lt;!--配置工厂类中的创建实例的静态方法--&gt;</div><div class=\"line\">    factory-method=\"getInst\"&gt;</div><div class=\"line\">&lt;/bean&gt;</div></pre></td></tr></table></figure>\n</li>\n<li><p>实例工厂初始化<br>提供一个实例工厂类，使用其中的实例方法获取对象。由于该工厂类本身需要创建对象，因此该对象必须受Spring控制，所以必须配置该工厂类为Bean.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">!—实例化工厂Bean</span> <span class=\"attr\">--</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"uf\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.bean.UserFactory\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!--使用实例工厂创建Bean --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!--factory-bean: 配置实例工厂在Spring范围内对应的Bean的id名称--&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!--factory-method：配置工厂类中的创建实例的实例方法--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"userService3\"</span>  <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"uf\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getInst2\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"5-2-Bean的作用域\"><a href=\"#5-2-Bean的作用域\" class=\"headerlink\" title=\"5.2 Bean的作用域\"></a>5.2 Bean的作用域</h3><p>Spring初始化的Bean默认为单例模式，如果想修改成非单例模式需要修改Bean的作用范围。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">”beanId”</span> <span class=\"attr\">class</span>=<span class=\"string\">”BeanClassName”</span> <span class=\"attr\">scope</span>=<span class=\"string\">”prototype”</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<pre><code>scope属性：\n    singleton：单例\n    prototype：非单例\n    request：请求对象范围request.setAttribute(&quot;beanId&quot;,obj);\n    session：会话Session范围request.getSession().setAttribute(&quot;beanId&quot;,obj);\n    globalSession：全局会话,分布式服务器\n</code></pre><h3 id=\"5-3-Bean的生命周期\"><a href=\"#5-3-Bean的生命周期\" class=\"headerlink\" title=\"5.3 Bean的生命周期\"></a>5.3 Bean的生命周期</h3><p>定义Bean初始化与销毁时的动作，属于回调方法配置<br>定义bean时指定两个回调方法，控制bean的初始化与销毁操作时执行的动作</p>\n<ul>\n<li>init-method：初始化回调方法名，配置的方法必须由bean对象提供</li>\n<li>destroy-method：销毁回调方法名，配置的方法必须由bean对象提供</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.lifecycle.User\"</span> <span class=\"attr\">init-method</span>=<span class=\"string\">\"init\"</span> <span class=\"attr\">destroy-method</span>=<span class=\"string\">\"destroy\"</span> <span class=\"attr\">scope</span>=<span class=\"string\">\"prototype\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<ul>\n<li>销毁操作只针对scope=”singletion”的对象，对于非单例对象无效</li>\n<li>单例对象的销毁是在IoC容器关闭时发生，使用ClassPathXmlApplicationContext对象close方法完成</li>\n<li>非单例Bean对象的内存回收交由JVM完成——GC</li>\n</ul>\n<h3 id=\"5-4-Bean属性注入\"><a href=\"#5-4-Bean属性注入\" class=\"headerlink\" title=\"5.4 Bean属性注入\"></a>5.4 Bean属性注入</h3><ol>\n<li><p>构造器注入（了解）<br>A.在domain中提供对象的构造方法<br>B.xml配置中设置构造方法的参数</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- constructor-arg:使用构造器传递参数  --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- value:赋值 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"bean6\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.bean.xml.Bean6\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">value</span>=<span class=\"string\">\"topvision\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">value</span>=<span class=\"string\">\"2017\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>注意：如果类型匹配不成功，可以为配置中指定index索引属性，对应构造器中参数的位置.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"bean6\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.bean.xml.Bean6\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">index</span>=<span class=\"string\">\"0\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"2014\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"java.lang.Integer\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">constructor-arg</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">index</span>=<span class=\"string\">\"1\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"topvision\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"java.lang.String\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">constructor-arg</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>说明：构造器传参受构造器参数位置和类型的限定，因此不常使用</p>\n</li>\n<li><p>setter注入<br><strong>前提：setter注入要求Bean必须提供无参可访问构造方法</strong></p>\n<p>A.注入简单类型</p>\n<pre><code>1.提供对应要注入的属性\n2.为每个要注入的属性提供对应的标准封装setter方法\n3.在配置中为Bean指定要注入的属性，使用property元素 name=“属性名” value=”值”\n</code></pre><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"属性名\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"值\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>B.注入引用类型</p>\n<pre><code>1.为某个Bean注入引用类型的值，首先在Bean对应的类中声明对应的属性\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"keyword\">private</span> TeacherDAO dao;</div><div class=\"line\">   ``` </div><div class=\"line\"></div><div class=\"line\">\t<span class=\"number\">2</span>.为每个要注入的属性提供对应的标准封装setter方法 (访问器)</div><div class=\"line\">   ```<span class=\"function\">xml</span></div><div class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setDao</span><span class=\"params\">(TeacherDAO dao)</span> &#123;</div><div class=\"line\">\t<span class=\"keyword\">this</span>.dao = dao;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<pre><code>3.必须保障引入的对象是Spring控制的Bean\n</code></pre><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 声明引用类型的资源为Bean --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"teacherDao\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.di.setter.TeacherDAO\"</span>&gt;</span>\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<pre><code>4.在Bean的属性注入中，使用ref引用对应的资源 ref=”beanId/beanName”\n</code></pre><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"comment\">&lt;!-- setter注入 --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- name:属性名 --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- value:简单类型的值 --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- ref:引用别的Bean，beanId/beanName --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"bean7\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.bean.xml.Bean7\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"name\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"topvision\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"age\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"8\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dao\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"teacherDao\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"6-Bean配置（注解）\"><a href=\"#6-Bean配置（注解）\" class=\"headerlink\" title=\"6. Bean配置（注解）\"></a>6. Bean配置（注解）</h2><p>从Spring2.5开始提供使用注解的形式配置Bean。</p>\n<h3 id=\"6-1-配置Bean使用-Component注解\"><a href=\"#6-1-配置Bean使用-Component注解\" class=\"headerlink\" title=\"6.1 配置Bean使用@Component注解\"></a>6.1 配置Bean使用@Component注解</h3><p>如需为Bean定义名称，在参数中添加Bean名称@Component(“beanName”)</p>\n<h3 id=\"6-2-设定Spring的自动扫描路径\"><a href=\"#6-2-设定Spring的自动扫描路径\" class=\"headerlink\" title=\"6.2 设定Spring的自动扫描路径\"></a>6.2 设定Spring的自动扫描路径</h3><p>用于检测对应的Bean是否配置了注解，并加载配置了注解的类</p>\n<ul>\n<li><p>开启context空间的支持</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">  \t<span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">   \t<span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span> </div><div class=\"line\">   \t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"</span></div><div class=\"line\">\thttp://www.springframework.org/schema/beans </div><div class=\"line\">\thttp://www.springframework.org/schema/beans/spring-beans.xsd</div><div class=\"line\">\thttp://www.springframework.org/schema/context \t\t\t\t\t</div><div class=\"line\">\thttp://www.springframework.org/schema/context/spring-context.xsd\"&gt;</div></pre></td></tr></table></figure>\n</li>\n<li><p>开启自动扫描功能，并指定扫描的路径</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.annotation\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">context:component-scan</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>说明：扫描路径可以设置多个，中间使用,隔开，扫描路径包含指定包和子包内所有的类,通常使用*号通配符匹配路径</p>\n<h3 id=\"6-3-Spring提供的三个注解\"><a href=\"#6-3-Spring提供的三个注解\" class=\"headerlink\" title=\"6.3 Spring提供的三个注解\"></a>6.3 Spring提供的三个注解</h3><ol>\n<li>@Repository 用于数据层实现类标注</li>\n<li>@Service 用于业务逻辑层实现类标注</li>\n<li>@Controller 用于控制层实现类进行标注</li>\n</ol>\n<h3 id=\"6-4-注入简单类型\"><a href=\"#6-4-注入简单类型\" class=\"headerlink\" title=\"6.4 注入简单类型\"></a>6.4 注入简单类型</h3><ol>\n<li>在属性名上方声明该属性自动装配@Autowired</li>\n<li>在属性名上方声明该属性注入的值@Value(value)<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Autowired</span></div><div class=\"line\"><span class=\"meta\">@Value</span>(<span class=\"string\">\"topvision\"</span>)</div><div class=\"line\"><span class=\"keyword\">private</span> String msg;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>注意：注解自动装配属性值无需提供对应属性的setter方法</p>\n<h3 id=\"6-5-注入引用类型\"><a href=\"#6-5-注入引用类型\" class=\"headerlink\" title=\"6.5 注入引用类型\"></a>6.5 注入引用类型</h3><ul>\n<li>在属性名上方声明该属性自动装配@Autowired</li>\n<li>在属性名上方声明该属性注入的值@Qualifier(bean引用名称)<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Autowired</span></div><div class=\"line\"><span class=\"meta\">@Qualifier</span>(<span class=\"string\">\"anno2\"</span>)</div><div class=\"line\"><span class=\"keyword\">private</span> AnnotationOther other;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"6-6-Autowired\"><a href=\"#6-6-Autowired\" class=\"headerlink\" title=\"6.6 Autowired\"></a>6.6 Autowired</h3><p>Autowired的required属性用用于声明自动装配的数据是必须的。</p>\n<ol>\n<li>如果required=true，必须为其装配数据，如果没有值，抛出异常</li>\n<li>如果required=false，自动装配数据失败，则注入值为null</li>\n</ol>\n<h3 id=\"6-7-Resource\"><a href=\"#6-7-Resource\" class=\"headerlink\" title=\"6.7 Resource\"></a>6.7 Resource</h3><ol>\n<li>格式一：@Resource(name=”myImpl”)</li>\n<li>格式二：@Autowired(required=false)<br>　　　　@Qualifier(“myImpl”)<br>以上两种格式效果相同</li>\n</ol>\n<h3 id=\"6-8-Bean声明周期注解\"><a href=\"#6-8-Bean声明周期注解\" class=\"headerlink\" title=\"6.8 Bean声明周期注解\"></a>6.8 Bean声明周期注解</h3><ol>\n<li>@PostConstruct<br>功能：为当前Bean指定init-method参数<br>格式：定义在成员方法的上方，兼容静态方法</li>\n<li>@PreDestroy<br>功能：为当前Bean指定destory-method参数<br>格式：定义在成员方法的上方，兼容静态方法<br>注意：要求当前类被注册为Bean，否则无效果</li>\n</ol>\n<h3 id=\"6-9-Bean作用域注解\"><a href=\"#6-9-Bean作用域注解\" class=\"headerlink\" title=\"6.9 Bean作用域注解\"></a>6.9 Bean作用域注解</h3><p>在类的定义上方添加@Scope指定Bean的作用域<br>常用：@Scope(“prototype”)<br>默认：@Scope(“singleton”)</p>\n<h3 id=\"6-10-配置类注解\"><a href=\"#6-10-配置类注解\" class=\"headerlink\" title=\"6.10 配置类注解\"></a>6.10 配置类注解</h3><p><strong>@Configuration</strong>配置当前类为配置类，用于加载其中配置的Bean，与静态工厂初始化Bean很相似<br><strong>@Bean(name=”b1”)</strong>将配置类中的某个方法的返回值声明为Bean，该方法必须返回一个对象<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Configuration</span>\t\t\t<span class=\"comment\">//设定该类参与自动扫描</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyBeanFactory</span> </span>&#123;</div><div class=\"line\">\t<span class=\"meta\">@Bean</span>(name=&#123;<span class=\"string\">\"aa\"</span>,<span class=\"string\">\"bb\"</span>,<span class=\"string\">\"cc\"</span>&#125;)<span class=\"comment\">//设定该方法的返回值是一个Bean</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> BookService <span class=\"title\">getInst</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> BookService();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>以上操作必须基于自动扫描功能，如不开启自动扫描，Spring将无法查找到对应的注解配置</p>\n<h3 id=\"6-11-AnnotationConfigApplicationContext不使用自动扫描\"><a href=\"#6-11-AnnotationConfigApplicationContext不使用自动扫描\" class=\"headerlink\" title=\"6.11 AnnotationConfigApplicationContext不使用自动扫描\"></a>6.11 AnnotationConfigApplicationContext不使用自动扫描</h3><p>AnnotationConfigApplicationContext对象可以手工加载基于注解配置的Bean<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//用于手工添加注解开发Bean的上下文对象</span></div><div class=\"line\">AnnotationConfigApplicationContext ctx = <span class=\"keyword\">new</span> AnnotationConfigApplicationContext();</div><div class=\"line\"><span class=\"comment\">//加载配置管理类</span></div><div class=\"line\">ctx.register(MyConfiguration.class);</div><div class=\"line\"><span class=\"comment\">//刷新上下文对象</span></div><div class=\"line\">ctx.refresh();</div></pre></td></tr></table></figure></p>\n<p>注意：注册完成后一定要进行刷新，否则加载的Bean将无法被使用</p>\n<h2 id=\"博客链接\"><a href=\"#博客链接\" class=\"headerlink\" title=\"博客链接\"></a>博客链接</h2><ol>\n<li><a href=\"http://www.cnblogs.com/ITtangtang/p/3978349.html\" target=\"_blank\" rel=\"noopener\">源码解读Spring IOC原理</a></li>\n<li><a href=\"http://www.cnblogs.com/dazhaxie/archive/2012/06/18/2553300.html\" target=\"_blank\" rel=\"noopener\">Spring源代码解析</a></li>\n</ol>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>这篇博客简单分析了IOC和DI的原理及区别，并介绍了基于xml和注解的Bean配置方式。<br>","more":"</p>\n<h2 id=\"1-什么是IOC\"><a href=\"#1-什么是IOC\" class=\"headerlink\" title=\"1. 什么是IOC?\"></a>1. 什么是IOC?</h2><h3 id=\"1-1-IoC-Inversion-of-Control-控制反转\"><a href=\"#1-1-IoC-Inversion-of-Control-控制反转\" class=\"headerlink\" title=\"1.1 IoC(Inversion of Control)控制反转\"></a>1.1 IoC(Inversion of Control)控制反转</h3><ul>\n<li>控制:控制的双方是什么？谁控制谁？<ul>\n<li>主控方：Spring</li>\n<li>被控方：应用程序所使用的资源</li>\n<li>(原始)应用程序控制自己执行操作需要使用的外部资源</li>\n<li>(Spring)Spring控制整个程序中所需要使用的外部资源</li>\n</ul>\n</li>\n<li>反转:什么是反转？反转什么？<ul>\n<li>正向：应用程序直接调用资源</li>\n<li>反向：应用程序依赖Spring为其提供资源</li>\n<li>反转的是资源的控制权</li>\n<li>应用程序由主动调用资源，变为被动的等待Spring提供资源</li>\n</ul>\n</li>\n<li>有什么好处？<ul>\n<li>正向缺点：应用程序控制的资源分布在程序的每一个地方</li>\n<li>反向的优点：所有的资源都在Spring中，便于管理</li>\n<li>总结：Spring反向控制应用程序所需要使用的外部资源。资源受Spring管理，利用率最大化。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"1-2-spring演进模式\"><a href=\"#1-2-spring演进模式\" class=\"headerlink\" title=\"1.2 spring演进模式\"></a>1.2 spring演进模式</h3><pre><code>A.基于分层设计\n    UserAction            使用UserService,new UserService()\n    UserService            使用UserDAO,new UserDAO()\n    UserDAO\nB.工厂模式，使用面向接口编程设计，解决层与层之间的紧耦合\n    制作接口，制作实现类，制作对象工厂\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">A a = AFactory.createA();  </div><div class=\"line\">B b = BFactory.createB();  </div><div class=\"line\">a.setB(b);</div></pre></td></tr></table></figure>\n<pre><code>C.工厂模式+配置\n    制作XML文件，将实现类配置到XML文件中\n    读取XML文件中的配置信息，得到实现类的类名\n    使用反射思想，获取实现类对象 class.newInstance();\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">A a = Factory.create(“a”);  </div><div class=\"line\">B b = Factory.create(“b”);  </div><div class=\"line\">a.setB(b);</div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--配置xml--&gt;</span></div><div class=\"line\">a=AImpl  </div><div class=\"line\">b=BImpl</div></pre></td></tr></table></figure>\n<pre><code>D.自动的工厂+配置\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//返回装配好的a   </span></div><div class=\"line\">A a = Factory.create(“a”);</div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--xml配置--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">“a”</span> <span class=\"attr\">class</span>=<span class=\"string\">“AImpl”</span>&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">“b”</span> <span class=\"attr\">ref</span>=<span class=\"string\">“b”/</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">“b”</span> <span class=\"attr\">class</span>=<span class=\"string\">“BImpl”/</span>&gt;</span></div></pre></td></tr></table></figure>\n<pre><code>E.工厂由Spring提供，实现类使用XML格式配置\n    工厂由Spring提供，实现类使用XML格式配置\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//返回装配好的a   </span></div><div class=\"line\">A a = ApplicationContext.getBean(“a”);</div></pre></td></tr></table></figure>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!--xml配置--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">“a”</span> <span class=\"attr\">class</span>=<span class=\"string\">“AImpl”</span>&gt;</span>  </div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">“b”</span> <span class=\"attr\">ref</span>=<span class=\"string\">“b”/</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span>  </div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">“b”</span> <span class=\"attr\">class</span>=<span class=\"string\">“BImpl”/</span>&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"2-什么是DI？\"><a href=\"#2-什么是DI？\" class=\"headerlink\" title=\"2. 什么是DI？\"></a>2. 什么是DI？</h2><h3 id=\"2-1-DI的概念\"><a href=\"#2-1-DI的概念\" class=\"headerlink\" title=\"2.1 DI的概念\"></a>2.1 DI的概念</h3><p>DI(Dependency Injection)依赖注入，指应用程序依赖Spring为其提供运行时所需的资源.</p>\n<ul>\n<li>谁依赖于谁？            ——-   应用程序依赖于IoC容器</li>\n<li>为什么需要依赖？        ——-   应用程序依赖于IoC容器装配类之间的关系</li>\n<li>依赖什么东西？          ——-   依赖了IoC容器的装配功能</li>\n<li>谁注入于谁？            ——-   IoC容器注入应用程序</li>\n<li>注入什么东西？          ——-   注入应用程序需要的资源（类之间的关系）</li>\n</ul>\n<p>更能描述容器其特点的名字——“依赖注入”（Dependency Injection）<br>IoC容器应该具有依赖注入功能，因此也可以叫DI容器 </p>\n<h3 id=\"2-2-DI实现方式\"><a href=\"#2-2-DI实现方式\" class=\"headerlink\" title=\"2.2 DI实现方式\"></a>2.2 DI实现方式</h3><ol>\n<li>构造器注入</li>\n<li>setter注入</li>\n<li>接口注入</li>\n</ol>\n<h2 id=\"3-IOC和DI的关系？\"><a href=\"#3-IOC和DI的关系？\" class=\"headerlink\" title=\"3. IOC和DI的关系？\"></a>3. IOC和DI的关系？</h2><p>IOC和DI其实是同一概念的两种说法，两者站立的角度不一样。<br>IOC：从spring的角度看，资源的控制权限被反转了<br>DI：从应用程序的角度看，应用程序要依赖spring为其注入资源。</p>\n<h2 id=\"4-BeanFactory\"><a href=\"#4-BeanFactory\" class=\"headerlink\" title=\"4. BeanFactory\"></a>4. BeanFactory</h2><ol>\n<li>BeanFactory是ApplicationContext的顶层父接口，使用BeanFactory接口也可以完成获取Bean的操作.</li>\n<li>操作步骤:<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//初始化Resource对象</span></div><div class=\"line\">Resource res = <span class=\"keyword\">new</span> ClassPathResource(<span class=\"string\">\"applicationContext.xml\"</span>);</div><div class=\"line\"><span class=\"comment\">//初始化BeanFactory对象</span></div><div class=\"line\">BeanFactory bf = <span class=\"keyword\">new</span> XmlBeanFactory(res);</div><div class=\"line\"><span class=\"comment\">//根据id名称获取Bean</span></div><div class=\"line\">UserService service = (UserService) bf.getBean(<span class=\"string\">\"userService\"</span>);</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>AppplicationContext与BeanFactory的区别<br>A. 加载方式不同</p>\n<pre><code>AppplicationContext：立即加载，加载配置文件时即加载\nBeanFactory:延迟加载，获取Bean实例时才加载\n</code></pre><p>B. AppplicationContext具有更多的功能</p>\n<pre><code>国际化处理\n事件传递\nBean自动装配\n各种不同应用层的Context实现\n注意：实际开发中，优先选择ApplicationContext对象，避免使用BeanFactory\n</code></pre></li>\n<li><p>Schema风格离线约束配置方式</p>\n<pre><code>A.拷贝访问路径\nB.打开MyEclipse设置中的XML catalog选项\nC.创建新的映射\nD.选择对应的schema风格的约束文件\nE.将key type修改为schema location\nF.将要配置的路径复制到key中\n</code></pre></li>\n</ol>\n<h2 id=\"5-Bean配置（XML）\"><a href=\"#5-Bean配置（XML）\" class=\"headerlink\" title=\"5. Bean配置（XML）\"></a>5. Bean配置（XML）</h2><h3 id=\"5-1-Bean初始化\"><a href=\"#5-1-Bean初始化\" class=\"headerlink\" title=\"5.1 Bean初始化\"></a>5.1 Bean初始化</h3><ol>\n<li>构造器初始化（重点）<br><strong>Bean对应的类必须提供一个默认无参可访问的构造方法</strong></li>\n<li><p>静态工厂初始化</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;bean id=\"userService2\" </div><div class=\"line\">    &lt;!--配置中所配置的class配置成工厂类的类名--&gt;</div><div class=\"line\">    class=\"com.topvision.bean.UserStataicFactory\"</div><div class=\"line\">    &lt;!--配置工厂类中的创建实例的静态方法--&gt;</div><div class=\"line\">    factory-method=\"getInst\"&gt;</div><div class=\"line\">&lt;/bean&gt;</div></pre></td></tr></table></figure>\n</li>\n<li><p>实例工厂初始化<br>提供一个实例工厂类，使用其中的实例方法获取对象。由于该工厂类本身需要创建对象，因此该对象必须受Spring控制，所以必须配置该工厂类为Bean.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">!—实例化工厂Bean</span> <span class=\"attr\">--</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"uf\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.bean.UserFactory\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!--使用实例工厂创建Bean --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!--factory-bean: 配置实例工厂在Spring范围内对应的Bean的id名称--&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!--factory-method：配置工厂类中的创建实例的实例方法--&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"userService3\"</span>  <span class=\"attr\">factory-bean</span>=<span class=\"string\">\"uf\"</span> <span class=\"attr\">factory-method</span>=<span class=\"string\">\"getInst2\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"5-2-Bean的作用域\"><a href=\"#5-2-Bean的作用域\" class=\"headerlink\" title=\"5.2 Bean的作用域\"></a>5.2 Bean的作用域</h3><p>Spring初始化的Bean默认为单例模式，如果想修改成非单例模式需要修改Bean的作用范围。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">”beanId”</span> <span class=\"attr\">class</span>=<span class=\"string\">”BeanClassName”</span> <span class=\"attr\">scope</span>=<span class=\"string\">”prototype”</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure></p>\n<pre><code>scope属性：\n    singleton：单例\n    prototype：非单例\n    request：请求对象范围request.setAttribute(&quot;beanId&quot;,obj);\n    session：会话Session范围request.getSession().setAttribute(&quot;beanId&quot;,obj);\n    globalSession：全局会话,分布式服务器\n</code></pre><h3 id=\"5-3-Bean的生命周期\"><a href=\"#5-3-Bean的生命周期\" class=\"headerlink\" title=\"5.3 Bean的生命周期\"></a>5.3 Bean的生命周期</h3><p>定义Bean初始化与销毁时的动作，属于回调方法配置<br>定义bean时指定两个回调方法，控制bean的初始化与销毁操作时执行的动作</p>\n<ul>\n<li>init-method：初始化回调方法名，配置的方法必须由bean对象提供</li>\n<li>destroy-method：销毁回调方法名，配置的方法必须由bean对象提供</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.lifecycle.User\"</span> <span class=\"attr\">init-method</span>=<span class=\"string\">\"init\"</span> <span class=\"attr\">destroy-method</span>=<span class=\"string\">\"destroy\"</span> <span class=\"attr\">scope</span>=<span class=\"string\">\"prototype\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<ul>\n<li>销毁操作只针对scope=”singletion”的对象，对于非单例对象无效</li>\n<li>单例对象的销毁是在IoC容器关闭时发生，使用ClassPathXmlApplicationContext对象close方法完成</li>\n<li>非单例Bean对象的内存回收交由JVM完成——GC</li>\n</ul>\n<h3 id=\"5-4-Bean属性注入\"><a href=\"#5-4-Bean属性注入\" class=\"headerlink\" title=\"5.4 Bean属性注入\"></a>5.4 Bean属性注入</h3><ol>\n<li><p>构造器注入（了解）<br>A.在domain中提供对象的构造方法<br>B.xml配置中设置构造方法的参数</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- constructor-arg:使用构造器传递参数  --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- value:赋值 --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"bean6\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.bean.xml.Bean6\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">value</span>=<span class=\"string\">\"topvision\"</span>/&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">value</span>=<span class=\"string\">\"2017\"</span>/&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>注意：如果类型匹配不成功，可以为配置中指定index索引属性，对应构造器中参数的位置.</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"bean6\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.bean.xml.Bean6\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">index</span>=<span class=\"string\">\"0\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"2014\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"java.lang.Integer\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">constructor-arg</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">constructor-arg</span> <span class=\"attr\">index</span>=<span class=\"string\">\"1\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"topvision\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"java.lang.String\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">constructor-arg</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>说明：构造器传参受构造器参数位置和类型的限定，因此不常使用</p>\n</li>\n<li><p>setter注入<br><strong>前提：setter注入要求Bean必须提供无参可访问构造方法</strong></p>\n<p>A.注入简单类型</p>\n<pre><code>1.提供对应要注入的属性\n2.为每个要注入的属性提供对应的标准封装setter方法\n3.在配置中为Bean指定要注入的属性，使用property元素 name=“属性名” value=”值”\n</code></pre><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"属性名\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"值\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>B.注入引用类型</p>\n<pre><code>1.为某个Bean注入引用类型的值，首先在Bean对应的类中声明对应的属性\n</code></pre><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"keyword\">private</span> TeacherDAO dao;</div><div class=\"line\">   ``` </div><div class=\"line\"></div><div class=\"line\">\t<span class=\"number\">2</span>.为每个要注入的属性提供对应的标准封装setter方法 (访问器)</div><div class=\"line\">   ```<span class=\"function\">xml</span></div><div class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setDao</span><span class=\"params\">(TeacherDAO dao)</span> &#123;</div><div class=\"line\">\t<span class=\"keyword\">this</span>.dao = dao;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<pre><code>3.必须保障引入的对象是Spring控制的Bean\n</code></pre><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">&lt;!-- 声明引用类型的资源为Bean --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"teacherDao\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.di.setter.TeacherDAO\"</span>&gt;</span>\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n<pre><code>4.在Bean的属性注入中，使用ref引用对应的资源 ref=”beanId/beanName”\n</code></pre><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"comment\">&lt;!-- setter注入 --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- name:属性名 --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- value:简单类型的值 --&gt;</span></div><div class=\"line\"><span class=\"comment\">&lt;!-- ref:引用别的Bean，beanId/beanName --&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"bean7\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.bean.xml.Bean7\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"name\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"topvision\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"age\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"8\"</span>/&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dao\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"teacherDao\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"6-Bean配置（注解）\"><a href=\"#6-Bean配置（注解）\" class=\"headerlink\" title=\"6. Bean配置（注解）\"></a>6. Bean配置（注解）</h2><p>从Spring2.5开始提供使用注解的形式配置Bean。</p>\n<h3 id=\"6-1-配置Bean使用-Component注解\"><a href=\"#6-1-配置Bean使用-Component注解\" class=\"headerlink\" title=\"6.1 配置Bean使用@Component注解\"></a>6.1 配置Bean使用@Component注解</h3><p>如需为Bean定义名称，在参数中添加Bean名称@Component(“beanName”)</p>\n<h3 id=\"6-2-设定Spring的自动扫描路径\"><a href=\"#6-2-设定Spring的自动扫描路径\" class=\"headerlink\" title=\"6.2 设定Spring的自动扫描路径\"></a>6.2 设定Spring的自动扫描路径</h3><p>用于检测对应的Bean是否配置了注解，并加载配置了注解的类</p>\n<ul>\n<li><p>开启context空间的支持</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://www.springframework.org/schema/beans\"</span></span></div><div class=\"line\">  \t<span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">   \t<span class=\"attr\">xmlns:context</span>=<span class=\"string\">\"http://www.springframework.org/schema/context\"</span> </div><div class=\"line\">   \t<span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"</span></div><div class=\"line\">\thttp://www.springframework.org/schema/beans </div><div class=\"line\">\thttp://www.springframework.org/schema/beans/spring-beans.xsd</div><div class=\"line\">\thttp://www.springframework.org/schema/context \t\t\t\t\t</div><div class=\"line\">\thttp://www.springframework.org/schema/context/spring-context.xsd\"&gt;</div></pre></td></tr></table></figure>\n</li>\n<li><p>开启自动扫描功能，并指定扫描的路径</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.annotation\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">context:component-scan</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>说明：扫描路径可以设置多个，中间使用,隔开，扫描路径包含指定包和子包内所有的类,通常使用*号通配符匹配路径</p>\n<h3 id=\"6-3-Spring提供的三个注解\"><a href=\"#6-3-Spring提供的三个注解\" class=\"headerlink\" title=\"6.3 Spring提供的三个注解\"></a>6.3 Spring提供的三个注解</h3><ol>\n<li>@Repository 用于数据层实现类标注</li>\n<li>@Service 用于业务逻辑层实现类标注</li>\n<li>@Controller 用于控制层实现类进行标注</li>\n</ol>\n<h3 id=\"6-4-注入简单类型\"><a href=\"#6-4-注入简单类型\" class=\"headerlink\" title=\"6.4 注入简单类型\"></a>6.4 注入简单类型</h3><ol>\n<li>在属性名上方声明该属性自动装配@Autowired</li>\n<li>在属性名上方声明该属性注入的值@Value(value)<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Autowired</span></div><div class=\"line\"><span class=\"meta\">@Value</span>(<span class=\"string\">\"topvision\"</span>)</div><div class=\"line\"><span class=\"keyword\">private</span> String msg;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>注意：注解自动装配属性值无需提供对应属性的setter方法</p>\n<h3 id=\"6-5-注入引用类型\"><a href=\"#6-5-注入引用类型\" class=\"headerlink\" title=\"6.5 注入引用类型\"></a>6.5 注入引用类型</h3><ul>\n<li>在属性名上方声明该属性自动装配@Autowired</li>\n<li>在属性名上方声明该属性注入的值@Qualifier(bean引用名称)<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Autowired</span></div><div class=\"line\"><span class=\"meta\">@Qualifier</span>(<span class=\"string\">\"anno2\"</span>)</div><div class=\"line\"><span class=\"keyword\">private</span> AnnotationOther other;</div></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"6-6-Autowired\"><a href=\"#6-6-Autowired\" class=\"headerlink\" title=\"6.6 Autowired\"></a>6.6 Autowired</h3><p>Autowired的required属性用用于声明自动装配的数据是必须的。</p>\n<ol>\n<li>如果required=true，必须为其装配数据，如果没有值，抛出异常</li>\n<li>如果required=false，自动装配数据失败，则注入值为null</li>\n</ol>\n<h3 id=\"6-7-Resource\"><a href=\"#6-7-Resource\" class=\"headerlink\" title=\"6.7 Resource\"></a>6.7 Resource</h3><ol>\n<li>格式一：@Resource(name=”myImpl”)</li>\n<li>格式二：@Autowired(required=false)<br>　　　　@Qualifier(“myImpl”)<br>以上两种格式效果相同</li>\n</ol>\n<h3 id=\"6-8-Bean声明周期注解\"><a href=\"#6-8-Bean声明周期注解\" class=\"headerlink\" title=\"6.8 Bean声明周期注解\"></a>6.8 Bean声明周期注解</h3><ol>\n<li>@PostConstruct<br>功能：为当前Bean指定init-method参数<br>格式：定义在成员方法的上方，兼容静态方法</li>\n<li>@PreDestroy<br>功能：为当前Bean指定destory-method参数<br>格式：定义在成员方法的上方，兼容静态方法<br>注意：要求当前类被注册为Bean，否则无效果</li>\n</ol>\n<h3 id=\"6-9-Bean作用域注解\"><a href=\"#6-9-Bean作用域注解\" class=\"headerlink\" title=\"6.9 Bean作用域注解\"></a>6.9 Bean作用域注解</h3><p>在类的定义上方添加@Scope指定Bean的作用域<br>常用：@Scope(“prototype”)<br>默认：@Scope(“singleton”)</p>\n<h3 id=\"6-10-配置类注解\"><a href=\"#6-10-配置类注解\" class=\"headerlink\" title=\"6.10 配置类注解\"></a>6.10 配置类注解</h3><p><strong>@Configuration</strong>配置当前类为配置类，用于加载其中配置的Bean，与静态工厂初始化Bean很相似<br><strong>@Bean(name=”b1”)</strong>将配置类中的某个方法的返回值声明为Bean，该方法必须返回一个对象<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Configuration</span>\t\t\t<span class=\"comment\">//设定该类参与自动扫描</span></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyBeanFactory</span> </span>&#123;</div><div class=\"line\">\t<span class=\"meta\">@Bean</span>(name=&#123;<span class=\"string\">\"aa\"</span>,<span class=\"string\">\"bb\"</span>,<span class=\"string\">\"cc\"</span>&#125;)<span class=\"comment\">//设定该方法的返回值是一个Bean</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> BookService <span class=\"title\">getInst</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> BookService();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure></p>\n<p>以上操作必须基于自动扫描功能，如不开启自动扫描，Spring将无法查找到对应的注解配置</p>\n<h3 id=\"6-11-AnnotationConfigApplicationContext不使用自动扫描\"><a href=\"#6-11-AnnotationConfigApplicationContext不使用自动扫描\" class=\"headerlink\" title=\"6.11 AnnotationConfigApplicationContext不使用自动扫描\"></a>6.11 AnnotationConfigApplicationContext不使用自动扫描</h3><p>AnnotationConfigApplicationContext对象可以手工加载基于注解配置的Bean<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//用于手工添加注解开发Bean的上下文对象</span></div><div class=\"line\">AnnotationConfigApplicationContext ctx = <span class=\"keyword\">new</span> AnnotationConfigApplicationContext();</div><div class=\"line\"><span class=\"comment\">//加载配置管理类</span></div><div class=\"line\">ctx.register(MyConfiguration.class);</div><div class=\"line\"><span class=\"comment\">//刷新上下文对象</span></div><div class=\"line\">ctx.refresh();</div></pre></td></tr></table></figure></p>\n<p>注意：注册完成后一定要进行刷新，否则加载的Bean将无法被使用</p>\n<h2 id=\"博客链接\"><a href=\"#博客链接\" class=\"headerlink\" title=\"博客链接\"></a>博客链接</h2><ol>\n<li><a href=\"http://www.cnblogs.com/ITtangtang/p/3978349.html\" target=\"_blank\" rel=\"noopener\">源码解读Spring IOC原理</a></li>\n<li><a href=\"http://www.cnblogs.com/dazhaxie/archive/2012/06/18/2553300.html\" target=\"_blank\" rel=\"noopener\">Spring源代码解析</a></li>\n</ol>"},{"title":"spring(4)——持久层封装","date":"2017-06-16T09:42:52.000Z","_content":"\n这边博客介绍了持久层的集中封装方式。\n<!--more-->\n\n## 1. 持久层访问方式\n![数据访问方式][1]\n\n## 2. JDBC\n\n\n## 3. JDBCTemplete\n### 3.1 原始jdbcTemplete\n```java\nDriverManagerDataSource dataSource = new DriverManagerDataSource();\ndataSource.setDriverClassName(\"com.mysql.jdbc.Driver\");\ndataSource.setUrl(\"jdbc:mysql://localhost:3306/springdb\");\ndataSource.setUsername(\"root\");\ndataSource.setPassword(\"***********\");\n\nJdbcTemplate template = new JdbcTemplate(dataSource);\ntemplate.execute(\"insert into student values(1,'张三',23)\");\n```\n\n### 3.2 Spring开发jdbcTemplete\n\n 1. 设置Bean\n    ```xml\n    <bean id=\"dao\" class=\"com.topvision.daotest.Dao\">\n    \t<property name=\"jdbcTemplate\" ref=\"jdbcTemplate\" />\n    </bean>\n    \n    <bean id=\"jdbcTemplate\" class=\"org.springframework.jdbc.core.JdbcTemplate\">\n    \t<property name=\"dataSource\" ref=\"dataSource\" />\n    </bean>\n    \n    <bean id=\"dataSource\" class=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n    \t<property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n    \t<property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\" />\n    \t<property name=\"username\" value=\"root\" />\n    \t<property name=\"password\" value=\"xiaoyue*AZ2V65\" />\n    </bean>\n    ```\n 2. 编写dao层测试类\n\n    ```java\n    @Test\n    public void Demo1() {\n        ClassPathXmlApplicationContext ctx = new ClassPathXmlApplicationContext(\"jdbcTemplete.xml\");\n        JdbcTemplate jdbcTemplate = (JdbcTemplate) ctx.getBean(\"jdbcTemplate\");\n        jdbcTemplate.execute(\"insert into student values(5,'23423',24)\");\n    }\n    ```\n    或者注解式\n    \n    开启注解扫描\n    ```xml\n    <context:component-scan base-package=\"com.topvision.daotest\"/>\n    ```\n    去掉dao层的bean,即如下配置\n    ```xml\n    <bean id=\"dao\" class=\"com.topvision.daotest.Dao\">\n    \t<property name=\"jdbcTemplate\" ref=\"jdbcTemplate\" />\n    </bean>\n    ```\n    \n    编写测试类\n    ```java\n    @RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations=\"classpath:jdbcTemplete.xml\")\npublic class Dao {\n\t\n    \t@Autowired\n    \tprivate JdbcTemplate jdbcTemplate;\n    \n    \tpublic void setJdbcTemplate(JdbcTemplate jdbcTemplate) {\n    \t\tthis.jdbcTemplate = jdbcTemplate;\n    \t}\n    \t@Test\n    \tpublic void Demo2() {\n    \t\tjdbcTemplate.execute(\"insert into student values(8,'王五',25)\");\n    \t}\n\t}\n    ```\n\n\n## 3. jdbcDaoSupport\nJdbcDaoSupport是JDBC数据访问对象的超类，其实它使用的还是jdbcTemplete，不过需要DI依赖注入dataSource或者jdbcTemplete.\n\n### 3.1 xml方式\n\n 1. xml配置文件\n \n ```xml\n<bean id=\"jdbcDaoSupportTest\" class=\"com.topvision.daotest.JDBCDaoSupportTest\">\n\t\t<bean id=\"jdbcDaoSupportTest\" class=\"com.topvision.daotest.JDBCDaoSupportTest\">\n\t\t<!-- 必须为继承JdbcDaoSupport的类注入JdbcTemplate，变量名为jdbcTemplate -->\n\t\t<!-- <property name=\"jdbcTemplate\" ref=\"jdbcTemplate\"/> -->\n\t\t<!-- 还可以注入DataSource对象，由JdbcDaoSupport自动创建JdbcTemplate对象 -->\n\t\t<property name=\"dataSource\" ref=\"dataSource\" />\n\t</bean>\n\t\n    <bean id=\"dataSource\"\n    \tclass=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n    \t<property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n    \t<property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\" />\n    \t<property name=\"username\" value=\"root\" />\n    \t<property name=\"password\" value=\"*****\" />\n    </bean>\n ```\n 2. 测试类\n \n ```java\n public class JDBCDaoSupportTest extends JdbcDaoSupport{\n\t\n\tprivate static ClassPathXmlApplicationContext ctx;\n\n\t@Test\n\tpublic void Demo2() {\n\t\tctx = new ClassPathXmlApplicationContext(\"jdbcDaoSupport.xml\");\n\t\tJDBCDaoSupportTest bean = (JDBCDaoSupportTest) ctx.getBean(\"jdbcDaoSupportTest\");\n\t\tJdbcTemplate template = bean.getJdbcTemplate();\n\t\tString sql = \"select name from student where id = ?\";\n\t\tString name = template.queryForObject(sql, String.class,1);\n\t\tSystem.out.println(name);\n\t}\n}\n ```\n\n### 3.2 注解方式\n\n 1. xml配置\n \n ```xml\n <bean id=\"dataSource\"\n\tclass=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n\t<property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n\t<property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\" />\n\t<property name=\"username\" value=\"root\" />\n\t<property name=\"password\" value=\"*****\" />\n</bean>\n ```\n \n 2. 测试类\n ```java\n public class JDBCDaoSupportTest extends JdbcDaoSupport{\n\n    \t@Autowired\n    \tprivate DataSource dataSource;\n    \t\n    \t@PostConstruct\n    \tprivate void init() {\n    \t\tsetDataSource(dataSource);\n    \t}\n    \n    \t@Test\n    \tpublic void Demo1() {\n    \t\tJdbcTemplate template = this.getJdbcTemplate();\n    \t\tString sql = \"select name from student where id = ?\";\n    \t\tString name = template.queryForObject(sql, String.class,1);\n    \t\tSystem.out.println(name);\n    \t}\n}\n ```\n \n\n 3. 注入dataSource注意事项\n 查看jdbcDaoSupport源码，可以注入dataSource或者注入jdbcTemplete\n 注入方法有两种：\n \n 构造方法中注入：\n\n    ```java\n    @Autowired\n    UserVODaoImpl(DataSource dataSource) {\n        setDataSource(dataSource);\n    }\n    ```\n 实例化前注入\n \n ```java\n    @Autowired\n    private DataSource dataSource;\n    \n    @PostConstruct\n    private void init() {\n    \tsetDataSource(dataSource);\n    }\n ```\n \n## 4. Hibernate\n## 5. Mybatis\n\n## 6. DataSource\n\n### 6.1 Spring内置DriverManagerDataSource\n\n 1. 资源包\n\n    ```xml\n    <dependency>\n    \t<groupId>org.springframework</groupId>\n    \t<artifactId>spring-jdbc</artifactId>\n    </dependency>\n    ```  \n    \n 2. 配置项\n \n    ```xml\n    <bean id=\"dataSource\" class=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n        <property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n        <property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\"/>\n        <property name=\"username\" value=\"root\" />\n        <property name=\"password\" value=\"****\" />\n    </bean>\n    ```\n    \n    \n### 6.2 DBCP\n\n 3. 资源包\n     \n    ```xml\n    <dependency>\n        <groupId>org.apache.commons</groupId>\n        <artifactId>com.springsource.org.apache.commons.dbcp</artifactId>\n        <version>1.2.2.osgi</version>\n    </dependency>\n    <dependency>\n        <groupId>org.apache.commons</groupId>\n        <artifactId>com.springsource.org.apache.commons.pool</artifactId>\n        <version>1.5.3</version>\n    </dependency>\n    ```  \n    \n\n 4. 配置项\n    \n    ```xml\n\t<bean id=\"dataSource\" class=\"org.apache.commons.dbcp.BasicDataSource\">\n\t\t<property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n\t\t<property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\" />\n\t\t<property name=\"username\" value=\"root\" />\n\t\t<property name=\"password\" value=\"*****\" />\n\t</bean>\n    ```\n### 6.3 C3P0\n\n 5. 资源包\n     \n    ```xml\n    <dependency>\n\t\t<groupId>com.mchange.c3p0</groupId>\n\t\t<artifactId>com.springsource.com.mchange.v2.c3p0</artifactId>\n\t\t<version>0.9.1.2</version>\n\t</dependency>\n    ```  \n    \n\n 6. 配置项\n    \n    ```xml\n\t<bean id=\"dataSource3\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\">\n\t\t<property name=\"driverClass\" value=\"${driverClass}\" />\n\t\t<property name=\"jdbcUrl\" value=\"${url}\" />\n\t\t<property name=\"user\" value=\"${jdbc_username}\" />\n\t\t<property name=\"password\" value=\"${password}\" />\n\t</bean>\n    ```\n    \n### 6.4 外部properties输入参数\n\n 1. 编写properties文件(jdbc.properties)\n \n ```properties\ndriverClass=com.mysql.jdbc.Driver\nurl=jdbc:mysql://localhost:3306/springdb\njdbc_username=root\npassword=*****\n ```\n\n 2. 在spring配置文件中扫描properties\n \n 方式一：可用*匹配加载多个\n ```xml\n <context:property-placeholder location=\"classpath:jdbc.properties\"/>\n ```\n 方式二：一个property对应一个文件\n ```xml\n <bean class=\"org.springframework.beans.factory.config.PropertyPlaceholdeConfigurer\">\n\t\t<property name=\"location\" value=\"classpath:jdbc.properties\" />\n\t\t<property name=\"location\" value=\"classpath:dsafgusd\" />\n\t</bean>\n ```\n 3. 用&{key}的方式引入\n \n```xml\n<bean id=\"dataSource3\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\">\n\t<property name=\"driverClass\" value=\"${driverClass}\" />\n\t<property name=\"jdbcUrl\" value=\"${url}\" />\n\t<property name=\"user\" value=\"${jdbc_username}\" />\n\t<property name=\"password\" value=\"${password}\" />\n</bean>\n```\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/Spring/DataAccess.png","source":"_posts/spring-4-——持久层封装.md","raw":"---\ntitle: spring(4)——持久层封装\ndate: 2017-06-16 17:42:52\ncategories:\n  - Spring\ntags:\n  - Spring\n---\n\n这边博客介绍了持久层的集中封装方式。\n<!--more-->\n\n## 1. 持久层访问方式\n![数据访问方式][1]\n\n## 2. JDBC\n\n\n## 3. JDBCTemplete\n### 3.1 原始jdbcTemplete\n```java\nDriverManagerDataSource dataSource = new DriverManagerDataSource();\ndataSource.setDriverClassName(\"com.mysql.jdbc.Driver\");\ndataSource.setUrl(\"jdbc:mysql://localhost:3306/springdb\");\ndataSource.setUsername(\"root\");\ndataSource.setPassword(\"***********\");\n\nJdbcTemplate template = new JdbcTemplate(dataSource);\ntemplate.execute(\"insert into student values(1,'张三',23)\");\n```\n\n### 3.2 Spring开发jdbcTemplete\n\n 1. 设置Bean\n    ```xml\n    <bean id=\"dao\" class=\"com.topvision.daotest.Dao\">\n    \t<property name=\"jdbcTemplate\" ref=\"jdbcTemplate\" />\n    </bean>\n    \n    <bean id=\"jdbcTemplate\" class=\"org.springframework.jdbc.core.JdbcTemplate\">\n    \t<property name=\"dataSource\" ref=\"dataSource\" />\n    </bean>\n    \n    <bean id=\"dataSource\" class=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n    \t<property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n    \t<property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\" />\n    \t<property name=\"username\" value=\"root\" />\n    \t<property name=\"password\" value=\"xiaoyue*AZ2V65\" />\n    </bean>\n    ```\n 2. 编写dao层测试类\n\n    ```java\n    @Test\n    public void Demo1() {\n        ClassPathXmlApplicationContext ctx = new ClassPathXmlApplicationContext(\"jdbcTemplete.xml\");\n        JdbcTemplate jdbcTemplate = (JdbcTemplate) ctx.getBean(\"jdbcTemplate\");\n        jdbcTemplate.execute(\"insert into student values(5,'23423',24)\");\n    }\n    ```\n    或者注解式\n    \n    开启注解扫描\n    ```xml\n    <context:component-scan base-package=\"com.topvision.daotest\"/>\n    ```\n    去掉dao层的bean,即如下配置\n    ```xml\n    <bean id=\"dao\" class=\"com.topvision.daotest.Dao\">\n    \t<property name=\"jdbcTemplate\" ref=\"jdbcTemplate\" />\n    </bean>\n    ```\n    \n    编写测试类\n    ```java\n    @RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(locations=\"classpath:jdbcTemplete.xml\")\npublic class Dao {\n\t\n    \t@Autowired\n    \tprivate JdbcTemplate jdbcTemplate;\n    \n    \tpublic void setJdbcTemplate(JdbcTemplate jdbcTemplate) {\n    \t\tthis.jdbcTemplate = jdbcTemplate;\n    \t}\n    \t@Test\n    \tpublic void Demo2() {\n    \t\tjdbcTemplate.execute(\"insert into student values(8,'王五',25)\");\n    \t}\n\t}\n    ```\n\n\n## 3. jdbcDaoSupport\nJdbcDaoSupport是JDBC数据访问对象的超类，其实它使用的还是jdbcTemplete，不过需要DI依赖注入dataSource或者jdbcTemplete.\n\n### 3.1 xml方式\n\n 1. xml配置文件\n \n ```xml\n<bean id=\"jdbcDaoSupportTest\" class=\"com.topvision.daotest.JDBCDaoSupportTest\">\n\t\t<bean id=\"jdbcDaoSupportTest\" class=\"com.topvision.daotest.JDBCDaoSupportTest\">\n\t\t<!-- 必须为继承JdbcDaoSupport的类注入JdbcTemplate，变量名为jdbcTemplate -->\n\t\t<!-- <property name=\"jdbcTemplate\" ref=\"jdbcTemplate\"/> -->\n\t\t<!-- 还可以注入DataSource对象，由JdbcDaoSupport自动创建JdbcTemplate对象 -->\n\t\t<property name=\"dataSource\" ref=\"dataSource\" />\n\t</bean>\n\t\n    <bean id=\"dataSource\"\n    \tclass=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n    \t<property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n    \t<property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\" />\n    \t<property name=\"username\" value=\"root\" />\n    \t<property name=\"password\" value=\"*****\" />\n    </bean>\n ```\n 2. 测试类\n \n ```java\n public class JDBCDaoSupportTest extends JdbcDaoSupport{\n\t\n\tprivate static ClassPathXmlApplicationContext ctx;\n\n\t@Test\n\tpublic void Demo2() {\n\t\tctx = new ClassPathXmlApplicationContext(\"jdbcDaoSupport.xml\");\n\t\tJDBCDaoSupportTest bean = (JDBCDaoSupportTest) ctx.getBean(\"jdbcDaoSupportTest\");\n\t\tJdbcTemplate template = bean.getJdbcTemplate();\n\t\tString sql = \"select name from student where id = ?\";\n\t\tString name = template.queryForObject(sql, String.class,1);\n\t\tSystem.out.println(name);\n\t}\n}\n ```\n\n### 3.2 注解方式\n\n 1. xml配置\n \n ```xml\n <bean id=\"dataSource\"\n\tclass=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n\t<property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n\t<property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\" />\n\t<property name=\"username\" value=\"root\" />\n\t<property name=\"password\" value=\"*****\" />\n</bean>\n ```\n \n 2. 测试类\n ```java\n public class JDBCDaoSupportTest extends JdbcDaoSupport{\n\n    \t@Autowired\n    \tprivate DataSource dataSource;\n    \t\n    \t@PostConstruct\n    \tprivate void init() {\n    \t\tsetDataSource(dataSource);\n    \t}\n    \n    \t@Test\n    \tpublic void Demo1() {\n    \t\tJdbcTemplate template = this.getJdbcTemplate();\n    \t\tString sql = \"select name from student where id = ?\";\n    \t\tString name = template.queryForObject(sql, String.class,1);\n    \t\tSystem.out.println(name);\n    \t}\n}\n ```\n \n\n 3. 注入dataSource注意事项\n 查看jdbcDaoSupport源码，可以注入dataSource或者注入jdbcTemplete\n 注入方法有两种：\n \n 构造方法中注入：\n\n    ```java\n    @Autowired\n    UserVODaoImpl(DataSource dataSource) {\n        setDataSource(dataSource);\n    }\n    ```\n 实例化前注入\n \n ```java\n    @Autowired\n    private DataSource dataSource;\n    \n    @PostConstruct\n    private void init() {\n    \tsetDataSource(dataSource);\n    }\n ```\n \n## 4. Hibernate\n## 5. Mybatis\n\n## 6. DataSource\n\n### 6.1 Spring内置DriverManagerDataSource\n\n 1. 资源包\n\n    ```xml\n    <dependency>\n    \t<groupId>org.springframework</groupId>\n    \t<artifactId>spring-jdbc</artifactId>\n    </dependency>\n    ```  \n    \n 2. 配置项\n \n    ```xml\n    <bean id=\"dataSource\" class=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n        <property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n        <property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\"/>\n        <property name=\"username\" value=\"root\" />\n        <property name=\"password\" value=\"****\" />\n    </bean>\n    ```\n    \n    \n### 6.2 DBCP\n\n 3. 资源包\n     \n    ```xml\n    <dependency>\n        <groupId>org.apache.commons</groupId>\n        <artifactId>com.springsource.org.apache.commons.dbcp</artifactId>\n        <version>1.2.2.osgi</version>\n    </dependency>\n    <dependency>\n        <groupId>org.apache.commons</groupId>\n        <artifactId>com.springsource.org.apache.commons.pool</artifactId>\n        <version>1.5.3</version>\n    </dependency>\n    ```  \n    \n\n 4. 配置项\n    \n    ```xml\n\t<bean id=\"dataSource\" class=\"org.apache.commons.dbcp.BasicDataSource\">\n\t\t<property name=\"driverClassName\" value=\"com.mysql.jdbc.Driver\" />\n\t\t<property name=\"url\" value=\"jdbc:mysql://localhost:3306/springdb\" />\n\t\t<property name=\"username\" value=\"root\" />\n\t\t<property name=\"password\" value=\"*****\" />\n\t</bean>\n    ```\n### 6.3 C3P0\n\n 5. 资源包\n     \n    ```xml\n    <dependency>\n\t\t<groupId>com.mchange.c3p0</groupId>\n\t\t<artifactId>com.springsource.com.mchange.v2.c3p0</artifactId>\n\t\t<version>0.9.1.2</version>\n\t</dependency>\n    ```  \n    \n\n 6. 配置项\n    \n    ```xml\n\t<bean id=\"dataSource3\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\">\n\t\t<property name=\"driverClass\" value=\"${driverClass}\" />\n\t\t<property name=\"jdbcUrl\" value=\"${url}\" />\n\t\t<property name=\"user\" value=\"${jdbc_username}\" />\n\t\t<property name=\"password\" value=\"${password}\" />\n\t</bean>\n    ```\n    \n### 6.4 外部properties输入参数\n\n 1. 编写properties文件(jdbc.properties)\n \n ```properties\ndriverClass=com.mysql.jdbc.Driver\nurl=jdbc:mysql://localhost:3306/springdb\njdbc_username=root\npassword=*****\n ```\n\n 2. 在spring配置文件中扫描properties\n \n 方式一：可用*匹配加载多个\n ```xml\n <context:property-placeholder location=\"classpath:jdbc.properties\"/>\n ```\n 方式二：一个property对应一个文件\n ```xml\n <bean class=\"org.springframework.beans.factory.config.PropertyPlaceholdeConfigurer\">\n\t\t<property name=\"location\" value=\"classpath:jdbc.properties\" />\n\t\t<property name=\"location\" value=\"classpath:dsafgusd\" />\n\t</bean>\n ```\n 3. 用&{key}的方式引入\n \n```xml\n<bean id=\"dataSource3\" class=\"com.mchange.v2.c3p0.ComboPooledDataSource\">\n\t<property name=\"driverClass\" value=\"${driverClass}\" />\n\t<property name=\"jdbcUrl\" value=\"${url}\" />\n\t<property name=\"user\" value=\"${jdbc_username}\" />\n\t<property name=\"password\" value=\"${password}\" />\n</bean>\n```\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/Spring/DataAccess.png","slug":"spring-4-——持久层封装","published":1,"updated":"2018-02-27T07:38:38.101Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfvn0040hwvfpk1y2tlb","content":"<p>这边博客介绍了持久层的集中封装方式。<br><a id=\"more\"></a></p>\n<h2 id=\"1-持久层访问方式\"><a href=\"#1-持久层访问方式\" class=\"headerlink\" title=\"1. 持久层访问方式\"></a>1. 持久层访问方式</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/Spring/DataAccess.png\" alt=\"数据访问方式\"></p>\n<h2 id=\"2-JDBC\"><a href=\"#2-JDBC\" class=\"headerlink\" title=\"2. JDBC\"></a>2. JDBC</h2><h2 id=\"3-JDBCTemplete\"><a href=\"#3-JDBCTemplete\" class=\"headerlink\" title=\"3. JDBCTemplete\"></a>3. JDBCTemplete</h2><h3 id=\"3-1-原始jdbcTemplete\"><a href=\"#3-1-原始jdbcTemplete\" class=\"headerlink\" title=\"3.1 原始jdbcTemplete\"></a>3.1 原始jdbcTemplete</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">DriverManagerDataSource dataSource = <span class=\"keyword\">new</span> DriverManagerDataSource();</div><div class=\"line\">dataSource.setDriverClassName(<span class=\"string\">\"com.mysql.jdbc.Driver\"</span>);</div><div class=\"line\">dataSource.setUrl(<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span>);</div><div class=\"line\">dataSource.setUsername(<span class=\"string\">\"root\"</span>);</div><div class=\"line\">dataSource.setPassword(<span class=\"string\">\"***********\"</span>);</div><div class=\"line\"></div><div class=\"line\">JdbcTemplate template = <span class=\"keyword\">new</span> JdbcTemplate(dataSource);</div><div class=\"line\">template.execute(<span class=\"string\">\"insert into student values(1,'张三',23)\"</span>);</div></pre></td></tr></table></figure>\n<h3 id=\"3-2-Spring开发jdbcTemplete\"><a href=\"#3-2-Spring开发jdbcTemplete\" class=\"headerlink\" title=\"3.2 Spring开发jdbcTemplete\"></a>3.2 Spring开发jdbcTemplete</h3><ol>\n<li><p>设置Bean</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dao\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.daotest.Dao\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcTemplate\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"jdbcTemplate\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"jdbcTemplate\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.core.JdbcTemplate\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DriverManagerDataSource\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"xiaoyue*AZ2V65\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>编写dao层测试类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    ClassPathXmlApplicationContext ctx = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(<span class=\"string\">\"jdbcTemplete.xml\"</span>);</div><div class=\"line\">    JdbcTemplate jdbcTemplate = (JdbcTemplate) ctx.getBean(<span class=\"string\">\"jdbcTemplate\"</span>);</div><div class=\"line\">    jdbcTemplate.execute(<span class=\"string\">\"insert into student values(5,'23423',24)\"</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>或者注解式</p>\n<p>开启注解扫描</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.daotest\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>去掉dao层的bean,即如下配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dao\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.daotest.Dao\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcTemplate\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"jdbcTemplate\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>编写测试类\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"meta\">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class=\"line\"><span class=\"meta\">@ContextConfiguration</span>(locations=<span class=\"string\">\"classpath:jdbcTemplete.xml\"</span>)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Dao</span> </span>&#123;</div><div class=\"line\">\t</div><div class=\"line\">    \t<span class=\"meta\">@Autowired</span></div><div class=\"line\">    \t<span class=\"keyword\">private</span> JdbcTemplate jdbcTemplate;</div><div class=\"line\">    </div><div class=\"line\">    \t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setJdbcTemplate</span><span class=\"params\">(JdbcTemplate jdbcTemplate)</span> </span>&#123;</div><div class=\"line\">    \t\t<span class=\"keyword\">this</span>.jdbcTemplate = jdbcTemplate;</div><div class=\"line\">    \t&#125;</div><div class=\"line\">    \t<span class=\"meta\">@Test</span></div><div class=\"line\">    \t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo2</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    \t\tjdbcTemplate.execute(<span class=\"string\">\"insert into student values(8,'王五',25)\"</span>);</div><div class=\"line\">    \t&#125;</div><div class=\"line\">\t&#125;</div></pre></td></tr></table></figure>\n</code></pre><h2 id=\"3-jdbcDaoSupport\"><a href=\"#3-jdbcDaoSupport\" class=\"headerlink\" title=\"3. jdbcDaoSupport\"></a>3. jdbcDaoSupport</h2><p>JdbcDaoSupport是JDBC数据访问对象的超类，其实它使用的还是jdbcTemplete，不过需要DI依赖注入dataSource或者jdbcTemplete.</p>\n<h3 id=\"3-1-xml方式\"><a href=\"#3-1-xml方式\" class=\"headerlink\" title=\"3.1 xml方式\"></a>3.1 xml方式</h3><ol>\n<li><p>xml配置文件</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"jdbcDaoSupportTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.daotest.JDBCDaoSupportTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"jdbcDaoSupportTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.daotest.JDBCDaoSupportTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 必须为继承JdbcDaoSupport的类注入JdbcTemplate，变量名为jdbcTemplate --&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- &lt;property name=\"jdbcTemplate\" ref=\"jdbcTemplate\"/&gt; --&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 还可以注入DataSource对象，由JdbcDaoSupport自动创建JdbcTemplate对象 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span></span></div><div class=\"line\">    \t<span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DriverManagerDataSource\"</span>&gt;</div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span> /&gt;</span></div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"*****\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>测试类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JDBCDaoSupportTest</span> <span class=\"keyword\">extends</span> <span class=\"title\">JdbcDaoSupport</span></span>&#123;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> ClassPathXmlApplicationContext ctx;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo2</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tctx = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(<span class=\"string\">\"jdbcDaoSupport.xml\"</span>);</div><div class=\"line\">\t\tJDBCDaoSupportTest bean = (JDBCDaoSupportTest) ctx.getBean(<span class=\"string\">\"jdbcDaoSupportTest\"</span>);</div><div class=\"line\">\t\tJdbcTemplate template = bean.getJdbcTemplate();</div><div class=\"line\">\t\tString sql = <span class=\"string\">\"select name from student where id = ?\"</span>;</div><div class=\"line\">\t\tString name = template.queryForObject(sql, String.class,<span class=\"number\">1</span>);</div><div class=\"line\">\t\tSystem.out.println(name);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"3-2-注解方式\"><a href=\"#3-2-注解方式\" class=\"headerlink\" title=\"3.2 注解方式\"></a>3.2 注解方式</h3><ol>\n<li><p>xml配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span></span></div><div class=\"line\">\t<span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DriverManagerDataSource\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"*****\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li>测试类<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JDBCDaoSupportTest</span> <span class=\"keyword\">extends</span> <span class=\"title\">JdbcDaoSupport</span></span>&#123;</div><div class=\"line\"></div><div class=\"line\">    \t<span class=\"meta\">@Autowired</span></div><div class=\"line\">    \t<span class=\"keyword\">private</span> DataSource dataSource;</div><div class=\"line\">    \t</div><div class=\"line\">    \t<span class=\"meta\">@PostConstruct</span></div><div class=\"line\">    \t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    \t\tsetDataSource(dataSource);</div><div class=\"line\">    \t&#125;</div><div class=\"line\">    </div><div class=\"line\">    \t<span class=\"meta\">@Test</span></div><div class=\"line\">    \t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    \t\tJdbcTemplate template = <span class=\"keyword\">this</span>.getJdbcTemplate();</div><div class=\"line\">    \t\tString sql = <span class=\"string\">\"select name from student where id = ?\"</span>;</div><div class=\"line\">    \t\tString name = template.queryForObject(sql, String.class,<span class=\"number\">1</span>);</div><div class=\"line\">    \t\tSystem.out.println(name);</div><div class=\"line\">    \t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>注入dataSource注意事项<br>查看jdbcDaoSupport源码，可以注入dataSource或者注入jdbcTemplete<br>注入方法有两种：</p>\n<p>构造方法中注入：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Autowired</span></div><div class=\"line\">UserVODaoImpl(DataSource dataSource) &#123;</div><div class=\"line\">    setDataSource(dataSource);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>实例化前注入</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Autowired</span></div><div class=\"line\"><span class=\"keyword\">private</span> DataSource dataSource;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@PostConstruct</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tsetDataSource(dataSource);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"4-Hibernate\"><a href=\"#4-Hibernate\" class=\"headerlink\" title=\"4. Hibernate\"></a>4. Hibernate</h2><h2 id=\"5-Mybatis\"><a href=\"#5-Mybatis\" class=\"headerlink\" title=\"5. Mybatis\"></a>5. Mybatis</h2><h2 id=\"6-DataSource\"><a href=\"#6-DataSource\" class=\"headerlink\" title=\"6. DataSource\"></a>6. DataSource</h2><h3 id=\"6-1-Spring内置DriverManagerDataSource\"><a href=\"#6-1-Spring内置DriverManagerDataSource\" class=\"headerlink\" title=\"6.1 Spring内置DriverManagerDataSource\"></a>6.1 Spring内置DriverManagerDataSource</h3><ol>\n<li><p>资源包</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-jdbc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   ```  </div><div class=\"line\">   </div><div class=\"line\">2. 配置项</div><div class=\"line\"></div><div class=\"line\">   ```xml</div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DriverManagerDataSource\"</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span>/&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"****\"</span> /&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"6-2-DBCP\"><a href=\"#6-2-DBCP\" class=\"headerlink\" title=\"6.2 DBCP\"></a>6.2 DBCP</h3><ol>\n<li><p>资源包</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.commons<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>com.springsource.org.apache.commons.dbcp<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.2.osgi<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.commons<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>com.springsource.org.apache.commons.pool<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.5.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   ```  </div><div class=\"line\">   </div><div class=\"line\"></div><div class=\"line\">4. 配置项</div><div class=\"line\">   </div><div class=\"line\">   ```xml</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.apache.commons.dbcp.BasicDataSource\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"*****\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"6-3-C3P0\"><a href=\"#6-3-C3P0\" class=\"headerlink\" title=\"6.3 C3P0\"></a>6.3 C3P0</h3><ol>\n<li><p>资源包</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.mchange.c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>com.springsource.com.mchange.v2.c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   ```  </div><div class=\"line\">   </div><div class=\"line\"></div><div class=\"line\">6. 配置项</div><div class=\"line\">   </div><div class=\"line\">   ```xml</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource3\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.mchange.v2.c3p0.ComboPooledDataSource\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;driverClass&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;url&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc_username&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;password&#125;\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"6-4-外部properties输入参数\"><a href=\"#6-4-外部properties输入参数\" class=\"headerlink\" title=\"6.4 外部properties输入参数\"></a>6.4 外部properties输入参数</h3><ol>\n<li><p>编写properties文件(jdbc.properties)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">driverClass=com.mysql.jdbc.Driver</div><div class=\"line\">url=jdbc:mysql://localhost:3306/springdb</div><div class=\"line\">jdbc_username=root</div><div class=\"line\">password=*****</div></pre></td></tr></table></figure>\n</li>\n<li><p>在spring配置文件中扫描properties</p>\n<p>方式一：可用*匹配加载多个</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:property-placeholder</span> <span class=\"attr\">location</span>=<span class=\"string\">\"classpath:jdbc.properties\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>方式二：一个property对应一个文件</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.beans.factory.config.PropertyPlaceholdeConfigurer\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"location\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"classpath:jdbc.properties\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"location\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"classpath:dsafgusd\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>用&amp;{key}的方式引入</p>\n</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource3\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.mchange.v2.c3p0.ComboPooledDataSource\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;driverClass&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;url&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc_username&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;password&#125;\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>这边博客介绍了持久层的集中封装方式。<br>","more":"</p>\n<h2 id=\"1-持久层访问方式\"><a href=\"#1-持久层访问方式\" class=\"headerlink\" title=\"1. 持久层访问方式\"></a>1. 持久层访问方式</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/Spring/DataAccess.png\" alt=\"数据访问方式\"></p>\n<h2 id=\"2-JDBC\"><a href=\"#2-JDBC\" class=\"headerlink\" title=\"2. JDBC\"></a>2. JDBC</h2><h2 id=\"3-JDBCTemplete\"><a href=\"#3-JDBCTemplete\" class=\"headerlink\" title=\"3. JDBCTemplete\"></a>3. JDBCTemplete</h2><h3 id=\"3-1-原始jdbcTemplete\"><a href=\"#3-1-原始jdbcTemplete\" class=\"headerlink\" title=\"3.1 原始jdbcTemplete\"></a>3.1 原始jdbcTemplete</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">DriverManagerDataSource dataSource = <span class=\"keyword\">new</span> DriverManagerDataSource();</div><div class=\"line\">dataSource.setDriverClassName(<span class=\"string\">\"com.mysql.jdbc.Driver\"</span>);</div><div class=\"line\">dataSource.setUrl(<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span>);</div><div class=\"line\">dataSource.setUsername(<span class=\"string\">\"root\"</span>);</div><div class=\"line\">dataSource.setPassword(<span class=\"string\">\"***********\"</span>);</div><div class=\"line\"></div><div class=\"line\">JdbcTemplate template = <span class=\"keyword\">new</span> JdbcTemplate(dataSource);</div><div class=\"line\">template.execute(<span class=\"string\">\"insert into student values(1,'张三',23)\"</span>);</div></pre></td></tr></table></figure>\n<h3 id=\"3-2-Spring开发jdbcTemplete\"><a href=\"#3-2-Spring开发jdbcTemplete\" class=\"headerlink\" title=\"3.2 Spring开发jdbcTemplete\"></a>3.2 Spring开发jdbcTemplete</h3><ol>\n<li><p>设置Bean</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dao\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.daotest.Dao\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcTemplate\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"jdbcTemplate\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"jdbcTemplate\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.core.JdbcTemplate\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DriverManagerDataSource\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"xiaoyue*AZ2V65\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>编写dao层测试类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Test</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    ClassPathXmlApplicationContext ctx = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(<span class=\"string\">\"jdbcTemplete.xml\"</span>);</div><div class=\"line\">    JdbcTemplate jdbcTemplate = (JdbcTemplate) ctx.getBean(<span class=\"string\">\"jdbcTemplate\"</span>);</div><div class=\"line\">    jdbcTemplate.execute(<span class=\"string\">\"insert into student values(5,'23423',24)\"</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>或者注解式</p>\n<p>开启注解扫描</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:component-scan</span> <span class=\"attr\">base-package</span>=<span class=\"string\">\"com.topvision.daotest\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>去掉dao层的bean,即如下配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dao\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.daotest.Dao\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcTemplate\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"jdbcTemplate\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<pre><code>编写测试类\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">    <span class=\"meta\">@RunWith</span>(SpringJUnit4ClassRunner.class)</div><div class=\"line\"><span class=\"meta\">@ContextConfiguration</span>(locations=<span class=\"string\">\"classpath:jdbcTemplete.xml\"</span>)</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Dao</span> </span>&#123;</div><div class=\"line\">\t</div><div class=\"line\">    \t<span class=\"meta\">@Autowired</span></div><div class=\"line\">    \t<span class=\"keyword\">private</span> JdbcTemplate jdbcTemplate;</div><div class=\"line\">    </div><div class=\"line\">    \t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setJdbcTemplate</span><span class=\"params\">(JdbcTemplate jdbcTemplate)</span> </span>&#123;</div><div class=\"line\">    \t\t<span class=\"keyword\">this</span>.jdbcTemplate = jdbcTemplate;</div><div class=\"line\">    \t&#125;</div><div class=\"line\">    \t<span class=\"meta\">@Test</span></div><div class=\"line\">    \t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo2</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    \t\tjdbcTemplate.execute(<span class=\"string\">\"insert into student values(8,'王五',25)\"</span>);</div><div class=\"line\">    \t&#125;</div><div class=\"line\">\t&#125;</div></pre></td></tr></table></figure>\n</code></pre><h2 id=\"3-jdbcDaoSupport\"><a href=\"#3-jdbcDaoSupport\" class=\"headerlink\" title=\"3. jdbcDaoSupport\"></a>3. jdbcDaoSupport</h2><p>JdbcDaoSupport是JDBC数据访问对象的超类，其实它使用的还是jdbcTemplete，不过需要DI依赖注入dataSource或者jdbcTemplete.</p>\n<h3 id=\"3-1-xml方式\"><a href=\"#3-1-xml方式\" class=\"headerlink\" title=\"3.1 xml方式\"></a>3.1 xml方式</h3><ol>\n<li><p>xml配置文件</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"jdbcDaoSupportTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.daotest.JDBCDaoSupportTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"jdbcDaoSupportTest\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.topvision.daotest.JDBCDaoSupportTest\"</span>&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 必须为继承JdbcDaoSupport的类注入JdbcTemplate，变量名为jdbcTemplate --&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- &lt;property name=\"jdbcTemplate\" ref=\"jdbcTemplate\"/&gt; --&gt;</span></div><div class=\"line\">\t\t<span class=\"comment\">&lt;!-- 还可以注入DataSource对象，由JdbcDaoSupport自动创建JdbcTemplate对象 --&gt;</span></div><div class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">ref</span>=<span class=\"string\">\"dataSource\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div><div class=\"line\">\t</div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span></span></div><div class=\"line\">    \t<span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DriverManagerDataSource\"</span>&gt;</div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span> /&gt;</span></div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">    \t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"*****\"</span> /&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>测试类</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JDBCDaoSupportTest</span> <span class=\"keyword\">extends</span> <span class=\"title\">JdbcDaoSupport</span></span>&#123;</div><div class=\"line\">\t</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> ClassPathXmlApplicationContext ctx;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"meta\">@Test</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo2</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\tctx = <span class=\"keyword\">new</span> ClassPathXmlApplicationContext(<span class=\"string\">\"jdbcDaoSupport.xml\"</span>);</div><div class=\"line\">\t\tJDBCDaoSupportTest bean = (JDBCDaoSupportTest) ctx.getBean(<span class=\"string\">\"jdbcDaoSupportTest\"</span>);</div><div class=\"line\">\t\tJdbcTemplate template = bean.getJdbcTemplate();</div><div class=\"line\">\t\tString sql = <span class=\"string\">\"select name from student where id = ?\"</span>;</div><div class=\"line\">\t\tString name = template.queryForObject(sql, String.class,<span class=\"number\">1</span>);</div><div class=\"line\">\t\tSystem.out.println(name);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"3-2-注解方式\"><a href=\"#3-2-注解方式\" class=\"headerlink\" title=\"3.2 注解方式\"></a>3.2 注解方式</h3><ol>\n<li><p>xml配置</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span></span></div><div class=\"line\">\t<span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DriverManagerDataSource\"</span>&gt;</div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"*****\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li>测试类<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"> <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">JDBCDaoSupportTest</span> <span class=\"keyword\">extends</span> <span class=\"title\">JdbcDaoSupport</span></span>&#123;</div><div class=\"line\"></div><div class=\"line\">    \t<span class=\"meta\">@Autowired</span></div><div class=\"line\">    \t<span class=\"keyword\">private</span> DataSource dataSource;</div><div class=\"line\">    \t</div><div class=\"line\">    \t<span class=\"meta\">@PostConstruct</span></div><div class=\"line\">    \t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    \t\tsetDataSource(dataSource);</div><div class=\"line\">    \t&#125;</div><div class=\"line\">    </div><div class=\"line\">    \t<span class=\"meta\">@Test</span></div><div class=\"line\">    \t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Demo1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">    \t\tJdbcTemplate template = <span class=\"keyword\">this</span>.getJdbcTemplate();</div><div class=\"line\">    \t\tString sql = <span class=\"string\">\"select name from student where id = ?\"</span>;</div><div class=\"line\">    \t\tString name = template.queryForObject(sql, String.class,<span class=\"number\">1</span>);</div><div class=\"line\">    \t\tSystem.out.println(name);</div><div class=\"line\">    \t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>注入dataSource注意事项<br>查看jdbcDaoSupport源码，可以注入dataSource或者注入jdbcTemplete<br>注入方法有两种：</p>\n<p>构造方法中注入：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Autowired</span></div><div class=\"line\">UserVODaoImpl(DataSource dataSource) &#123;</div><div class=\"line\">    setDataSource(dataSource);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>实例化前注入</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">@Autowired</span></div><div class=\"line\"><span class=\"keyword\">private</span> DataSource dataSource;</div><div class=\"line\"></div><div class=\"line\"><span class=\"meta\">@PostConstruct</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tsetDataSource(dataSource);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"4-Hibernate\"><a href=\"#4-Hibernate\" class=\"headerlink\" title=\"4. Hibernate\"></a>4. Hibernate</h2><h2 id=\"5-Mybatis\"><a href=\"#5-Mybatis\" class=\"headerlink\" title=\"5. Mybatis\"></a>5. Mybatis</h2><h2 id=\"6-DataSource\"><a href=\"#6-DataSource\" class=\"headerlink\" title=\"6. DataSource\"></a>6. DataSource</h2><h3 id=\"6-1-Spring内置DriverManagerDataSource\"><a href=\"#6-1-Spring内置DriverManagerDataSource\" class=\"headerlink\" title=\"6.1 Spring内置DriverManagerDataSource\"></a>6.1 Spring内置DriverManagerDataSource</h3><ol>\n<li><p>资源包</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">   \t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-jdbc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   ```  </div><div class=\"line\">   </div><div class=\"line\">2. 配置项</div><div class=\"line\"></div><div class=\"line\">   ```xml</div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.jdbc.datasource.DriverManagerDataSource\"</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span>/&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"****\"</span> /&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"6-2-DBCP\"><a href=\"#6-2-DBCP\" class=\"headerlink\" title=\"6.2 DBCP\"></a>6.2 DBCP</h3><ol>\n<li><p>资源包</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.commons<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>com.springsource.org.apache.commons.dbcp<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.2.osgi<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.commons<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>com.springsource.org.apache.commons.pool<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">       <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.5.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\">   <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   ```  </div><div class=\"line\">   </div><div class=\"line\"></div><div class=\"line\">4. 配置项</div><div class=\"line\">   </div><div class=\"line\">   ```xml</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.apache.commons.dbcp.BasicDataSource\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClassName\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"com.mysql.jdbc.Driver\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"url\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"jdbc:mysql://localhost:3306/springdb\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"username\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"root\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"*****\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"6-3-C3P0\"><a href=\"#6-3-C3P0\" class=\"headerlink\" title=\"6.3 C3P0\"></a>6.3 C3P0</h3><ol>\n<li><p>资源包</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div></pre></td><td class=\"code\"><pre><div class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.mchange.c3p0<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>com.springsource.com.mchange.v2.c3p0<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></div><div class=\"line\">   ```  </div><div class=\"line\">   </div><div class=\"line\"></div><div class=\"line\">6. 配置项</div><div class=\"line\">   </div><div class=\"line\">   ```xml</div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource3\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.mchange.v2.c3p0.ComboPooledDataSource\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;driverClass&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;url&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc_username&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;password&#125;\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"6-4-外部properties输入参数\"><a href=\"#6-4-外部properties输入参数\" class=\"headerlink\" title=\"6.4 外部properties输入参数\"></a>6.4 外部properties输入参数</h3><ol>\n<li><p>编写properties文件(jdbc.properties)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\">driverClass=com.mysql.jdbc.Driver</div><div class=\"line\">url=jdbc:mysql://localhost:3306/springdb</div><div class=\"line\">jdbc_username=root</div><div class=\"line\">password=*****</div></pre></td></tr></table></figure>\n</li>\n<li><p>在spring配置文件中扫描properties</p>\n<p>方式一：可用*匹配加载多个</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">context:property-placeholder</span> <span class=\"attr\">location</span>=<span class=\"string\">\"classpath:jdbc.properties\"</span>/&gt;</span></div></pre></td></tr></table></figure>\n<p>方式二：一个property对应一个文件</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">class</span>=<span class=\"string\">\"org.springframework.beans.factory.config.PropertyPlaceholdeConfigurer\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"location\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"classpath:jdbc.properties\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"location\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"classpath:dsafgusd\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n<li><p>用&amp;{key}的方式引入</p>\n</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">\"dataSource3\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"com.mchange.v2.c3p0.ComboPooledDataSource\"</span>&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"driverClass\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;driverClass&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"jdbcUrl\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;url&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"user\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;jdbc_username&#125;\"</span> /&gt;</span></div><div class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">\"password\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"$&#123;password&#125;\"</span> /&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></div></pre></td></tr></table></figure>"},{"title":"web.xml不同版本之间的差异","keyword":["servlet","web.xml"],"date":"2018-04-13T09:31:13.000Z","_content":"\n![此处输入图片的描述][1]\n\n<!--more-->\nApache官方对各版本的解释：http://tomcat.apache.org/whichversion.html\n\nThe web.xml is a configuration file to describe how a web application should be deployed. Here’re 5 web.xml examples, just for self-reference.\n\n 1. Servlet 4.0\n\n    ```xml\n    <web-app xmlns=\"http://xmlns.jcp.org/xml/ns/javaee\"\n        xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n        xsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/javaee\n        http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\"\n        version=\"4.0\" metadata-complete=\"true\">\n    </web-app>\n    ```\n \n 2. Servlet 3.1\n\n    Java EE 7 XML schema, namespace is http://xmlns.jcp.org/xml/ns/javaee/\n \n    ```xmk\n    <web-app xmlns=\"http://xmlns.jcp.org/xml/ns/javaee\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/javaee \n\t\t http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd\"\n         version=\"3.1\">\n    </web-app>\n    ```\n    \n 3. Servlet 3.0\n\n    Java EE 6 XML schema, namespace is http://java.sun.com/xml/ns/javaee\n    Servlet3.0随J2EE6一起发布，web.xml配置文件中包含：\n    默认页配置、session超时配置和错误提示页配置。\n \n    ```xmk\n    <web-app xmlns=\"http://java.sun.com/xml/ns/javaee\"\n\t      xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\t      xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee \n\t      http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd\"\n\t      version=\"3.0\">\n    </web-app>\n    ```\n    \n 4. Servlet 2.5\n\n    Java EE 5 XML schema, namespace is http://java.sun.com/xml/ns/javaee\n    2.5以上版本即可解决多个url不能映射到同一个servlet的问题。\n \n    ```xml\n    <web-app xmlns=\"http://java.sun.com/xml/ns/javaee\"\n\t      xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\t      xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee \n\t      http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\"\n\t      version=\"2.5\">\n    </web-app>\n    ```\n    \n 5. Servlet 2.4\n    \n    J2EE 1.4 XML schema, namespace is http://java.sun.com/xml/ns/j2ee\n    2.4以上版本即可解决上面问题。\n    但是2.4及以下版本会有一个问题：（多个url不能映射到同一个servlet）\n\n    ```xml\n    <web-app xmlns=\"http://java.sun.com/xml/ns/j2ee\"\n\t      xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\t      xsi:schemaLocation=\"http://java.sun.com/xml/ns/j2ee \n\t      http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd\"\n\t      version=\"2.4\">\n\n    <display-name>Servlet 2.4 Web Application</display-name>\n    </web-app>\n    ```\n    \n 6. Servlet 2.3\n\n    J2EE 1.3 DTD模式。这个xml文件太旧了，强烈推荐你升级。\n    这个有个缺点：web-app里的标签有一定的顺序。\n \n    ```xml\n    <!DOCTYPE web-app PUBLIC\n     \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n     \"http://java.sun.com/dtd/web-app_2_3.dtd\" >\n    \n    <web-app>\n      <display-name>Servlet 2.3 Web Application</display-name>\n    </web-app>\n    ```\n \n \n \n \n \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/web/servletVersion.png\n","source":"_posts/web-xml不同版本之间的差异.md","raw":"---\ntitle: web.xml不同版本之间的差异\ncategories:\n  - Web\ntags:\n  - Web\nkeyword:\n  - servlet\n  - web.xml\ndate: 2018-04-13 17:31:13\n---\n\n![此处输入图片的描述][1]\n\n<!--more-->\nApache官方对各版本的解释：http://tomcat.apache.org/whichversion.html\n\nThe web.xml is a configuration file to describe how a web application should be deployed. Here’re 5 web.xml examples, just for self-reference.\n\n 1. Servlet 4.0\n\n    ```xml\n    <web-app xmlns=\"http://xmlns.jcp.org/xml/ns/javaee\"\n        xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n        xsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/javaee\n        http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\"\n        version=\"4.0\" metadata-complete=\"true\">\n    </web-app>\n    ```\n \n 2. Servlet 3.1\n\n    Java EE 7 XML schema, namespace is http://xmlns.jcp.org/xml/ns/javaee/\n \n    ```xmk\n    <web-app xmlns=\"http://xmlns.jcp.org/xml/ns/javaee\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/javaee \n\t\t http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd\"\n         version=\"3.1\">\n    </web-app>\n    ```\n    \n 3. Servlet 3.0\n\n    Java EE 6 XML schema, namespace is http://java.sun.com/xml/ns/javaee\n    Servlet3.0随J2EE6一起发布，web.xml配置文件中包含：\n    默认页配置、session超时配置和错误提示页配置。\n \n    ```xmk\n    <web-app xmlns=\"http://java.sun.com/xml/ns/javaee\"\n\t      xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\t      xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee \n\t      http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd\"\n\t      version=\"3.0\">\n    </web-app>\n    ```\n    \n 4. Servlet 2.5\n\n    Java EE 5 XML schema, namespace is http://java.sun.com/xml/ns/javaee\n    2.5以上版本即可解决多个url不能映射到同一个servlet的问题。\n \n    ```xml\n    <web-app xmlns=\"http://java.sun.com/xml/ns/javaee\"\n\t      xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\t      xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee \n\t      http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\"\n\t      version=\"2.5\">\n    </web-app>\n    ```\n    \n 5. Servlet 2.4\n    \n    J2EE 1.4 XML schema, namespace is http://java.sun.com/xml/ns/j2ee\n    2.4以上版本即可解决上面问题。\n    但是2.4及以下版本会有一个问题：（多个url不能映射到同一个servlet）\n\n    ```xml\n    <web-app xmlns=\"http://java.sun.com/xml/ns/j2ee\"\n\t      xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\t      xsi:schemaLocation=\"http://java.sun.com/xml/ns/j2ee \n\t      http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd\"\n\t      version=\"2.4\">\n\n    <display-name>Servlet 2.4 Web Application</display-name>\n    </web-app>\n    ```\n    \n 6. Servlet 2.3\n\n    J2EE 1.3 DTD模式。这个xml文件太旧了，强烈推荐你升级。\n    这个有个缺点：web-app里的标签有一定的顺序。\n \n    ```xml\n    <!DOCTYPE web-app PUBLIC\n     \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"\n     \"http://java.sun.com/dtd/web-app_2_3.dtd\" >\n    \n    <web-app>\n      <display-name>Servlet 2.3 Web Application</display-name>\n    </web-app>\n    ```\n \n \n \n \n \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/web/servletVersion.png\n","slug":"web-xml不同版本之间的差异","published":1,"updated":"2018-04-13T09:32:01.509Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfvp0045hwvf0gkcedh7","content":"<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/web/servletVersion.png\" alt=\"此处输入图片的描述\"></p>\n<a id=\"more\"></a>\n<p>Apache官方对各版本的解释：<a href=\"http://tomcat.apache.org/whichversion.html\" target=\"_blank\" rel=\"noopener\">http://tomcat.apache.org/whichversion.html</a></p>\n<p>The web.xml is a configuration file to describe how a web application should be deployed. Here’re 5 web.xml examples, just for self-reference.</p>\n<ol>\n<li><p>Servlet 4.0</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://xmlns.jcp.org/xml/ns/javaee\"</span></span></div><div class=\"line\">    <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">    <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://xmlns.jcp.org/xml/ns/javaee</span></div><div class=\"line\">    http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\"</div><div class=\"line\">    <span class=\"attr\">version</span>=<span class=\"string\">\"4.0\"</span> <span class=\"attr\">metadata-complete</span>=<span class=\"string\">\"true\"</span>&gt;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>Servlet 3.1</p>\n<p>Java EE 7 XML schema, namespace is <a href=\"http://xmlns.jcp.org/xml/ns/javaee/\" target=\"_blank\" rel=\"noopener\">http://xmlns.jcp.org/xml/ns/javaee/</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"> &lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</div><div class=\"line\">      xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class=\"line\">      xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee </div><div class=\"line\">http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</div><div class=\"line\">      version=&quot;3.1&quot;&gt;</div><div class=\"line\"> &lt;/web-app&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>Servlet 3.0</p>\n<p>Java EE 6 XML schema, namespace is <a href=\"http://java.sun.com/xml/ns/javaee\" target=\"_blank\" rel=\"noopener\">http://java.sun.com/xml/ns/javaee</a><br>Servlet3.0随J2EE6一起发布，web.xml配置文件中包含：<br>默认页配置、session超时配置和错误提示页配置。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;</div><div class=\"line\">   xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class=\"line\">   xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee </div><div class=\"line\">   http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</div><div class=\"line\">   version=&quot;3.0&quot;&gt;</div><div class=\"line\">&lt;/web-app&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>Servlet 2.5</p>\n<p>Java EE 5 XML schema, namespace is <a href=\"http://java.sun.com/xml/ns/javaee\" target=\"_blank\" rel=\"noopener\">http://java.sun.com/xml/ns/javaee</a><br>2.5以上版本即可解决多个url不能映射到同一个servlet的问题。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://java.sun.com/xml/ns/javaee\"</span></span></div><div class=\"line\">   <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">   <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://java.sun.com/xml/ns/javaee </span></div><div class=\"line\">   http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\"</div><div class=\"line\">   <span class=\"attr\">version</span>=<span class=\"string\">\"2.5\"</span>&gt;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>Servlet 2.4</p>\n<p>J2EE 1.4 XML schema, namespace is <a href=\"http://java.sun.com/xml/ns/j2ee\" target=\"_blank\" rel=\"noopener\">http://java.sun.com/xml/ns/j2ee</a><br>2.4以上版本即可解决上面问题。<br>但是2.4及以下版本会有一个问题：（多个url不能映射到同一个servlet）</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://java.sun.com/xml/ns/j2ee\"</span></span></div><div class=\"line\">   <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">   <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://java.sun.com/xml/ns/j2ee </span></div><div class=\"line\">   http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd\"</div><div class=\"line\">   <span class=\"attr\">version</span>=<span class=\"string\">\"2.4\"</span>&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">display-name</span>&gt;</span>Servlet 2.4 Web Application<span class=\"tag\">&lt;/<span class=\"name\">display-name</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>Servlet 2.3</p>\n<p>J2EE 1.3 DTD模式。这个xml文件太旧了，强烈推荐你升级。<br>这个有个缺点：web-app里的标签有一定的顺序。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE web-app PUBLIC</span></div><div class=\"line\"> \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"</div><div class=\"line\"> \"http://java.sun.com/dtd/web-app_2_3.dtd\" &gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">display-name</span>&gt;</span>Servlet 2.3 Web Application<span class=\"tag\">&lt;/<span class=\"name\">display-name</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/web/servletVersion.png\" alt=\"此处输入图片的描述\"></p>","more":"<p>Apache官方对各版本的解释：<a href=\"http://tomcat.apache.org/whichversion.html\" target=\"_blank\" rel=\"noopener\">http://tomcat.apache.org/whichversion.html</a></p>\n<p>The web.xml is a configuration file to describe how a web application should be deployed. Here’re 5 web.xml examples, just for self-reference.</p>\n<ol>\n<li><p>Servlet 4.0</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://xmlns.jcp.org/xml/ns/javaee\"</span></span></div><div class=\"line\">    <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">    <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://xmlns.jcp.org/xml/ns/javaee</span></div><div class=\"line\">    http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\"</div><div class=\"line\">    <span class=\"attr\">version</span>=<span class=\"string\">\"4.0\"</span> <span class=\"attr\">metadata-complete</span>=<span class=\"string\">\"true\"</span>&gt;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>Servlet 3.1</p>\n<p>Java EE 7 XML schema, namespace is <a href=\"http://xmlns.jcp.org/xml/ns/javaee/\" target=\"_blank\" rel=\"noopener\">http://xmlns.jcp.org/xml/ns/javaee/</a></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"> &lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</div><div class=\"line\">      xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class=\"line\">      xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee </div><div class=\"line\">http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</div><div class=\"line\">      version=&quot;3.1&quot;&gt;</div><div class=\"line\"> &lt;/web-app&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>Servlet 3.0</p>\n<p>Java EE 6 XML schema, namespace is <a href=\"http://java.sun.com/xml/ns/javaee\" target=\"_blank\" rel=\"noopener\">http://java.sun.com/xml/ns/javaee</a><br>Servlet3.0随J2EE6一起发布，web.xml配置文件中包含：<br>默认页配置、session超时配置和错误提示页配置。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;</div><div class=\"line\">   xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class=\"line\">   xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee </div><div class=\"line\">   http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</div><div class=\"line\">   version=&quot;3.0&quot;&gt;</div><div class=\"line\">&lt;/web-app&gt;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>Servlet 2.5</p>\n<p>Java EE 5 XML schema, namespace is <a href=\"http://java.sun.com/xml/ns/javaee\" target=\"_blank\" rel=\"noopener\">http://java.sun.com/xml/ns/javaee</a><br>2.5以上版本即可解决多个url不能映射到同一个servlet的问题。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://java.sun.com/xml/ns/javaee\"</span></span></div><div class=\"line\">   <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">   <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://java.sun.com/xml/ns/javaee </span></div><div class=\"line\">   http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\"</div><div class=\"line\">   <span class=\"attr\">version</span>=<span class=\"string\">\"2.5\"</span>&gt;</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>Servlet 2.4</p>\n<p>J2EE 1.4 XML schema, namespace is <a href=\"http://java.sun.com/xml/ns/j2ee\" target=\"_blank\" rel=\"noopener\">http://java.sun.com/xml/ns/j2ee</a><br>2.4以上版本即可解决上面问题。<br>但是2.4及以下版本会有一个问题：（多个url不能映射到同一个servlet）</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">\"http://java.sun.com/xml/ns/j2ee\"</span></span></div><div class=\"line\">   <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></div><div class=\"line\">   <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">\"http://java.sun.com/xml/ns/j2ee </span></div><div class=\"line\">   http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd\"</div><div class=\"line\">   <span class=\"attr\">version</span>=<span class=\"string\">\"2.4\"</span>&gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">display-name</span>&gt;</span>Servlet 2.4 Web Application<span class=\"tag\">&lt;/<span class=\"name\">display-name</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>\n<ol>\n<li><p>Servlet 2.3</p>\n<p>J2EE 1.3 DTD模式。这个xml文件太旧了，强烈推荐你升级。<br>这个有个缺点：web-app里的标签有一定的顺序。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;!DOCTYPE web-app PUBLIC</span></div><div class=\"line\"> \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\"</div><div class=\"line\"> \"http://java.sun.com/dtd/web-app_2_3.dtd\" &gt;</div><div class=\"line\"></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">web-app</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">display-name</span>&gt;</span>Servlet 2.3 Web Application<span class=\"tag\">&lt;/<span class=\"name\">display-name</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">web-app</span>&gt;</span></div></pre></td></tr></table></figure>\n</li>\n</ol>"},{"title":"使用jquery.i18n完成前端国际化","date":"2017-08-31T05:15:33.000Z","_content":"本文对 jQuery 国际化插件 jQuery.i18n.properties 进行了介绍，并用实际例子介绍了如何使用 jQuery.i18n.properties 插件实现 Web 前端的国际化。总结起来，jQuery.i18n.properties 具有轻量级（压缩后仅 4kb）、简单易用等特点，但是作为一个普及度不高的轻量级插件，不一定适用于大型的或对效率要求极高的场景。\n<!--more-->\n## 1. 简介\n\njQuery.i18n.properties 是一款轻量级的 jQuery 国际化插件。与 Java 里的资源文件类似，jQuery.i18n.properties 采用 .properties 文件对 JavaScript 进行国际化。jQuery.i18n.properties 插件根据用户指定的（或浏览器提供的 ）语言和国家编码（符合 ISO-639 和 ISO-3166 标准）来解析对应的以“.properties”为后缀的资源文件。\n\n利用资源文件实现国际化是一种比较流行的方式，例如 Android 应用就可以采用以语言和国家编码命名的资源文件来实现国际化。jQuery.i18n.properties 插件中的资源文件以“.properties”为后缀，包含了区域相关的键值对。我们知道，Java 程序也可以使用以 .properties 为后缀的资源文件来实现国际化，因此，当我们要在 Java 程序和前端 JavaScript 程序中共享资源文件时，这种方式就显得特别有用。jQuery.i18n.properties 插件首先加载默认的资源文件（例如：strings.properties），然后加载针对特定语言环境的资源文件（例如：strings_zh.properties），这就保证了在未提供某种语言的翻译时，默认值始终有效。开发人员可以以 JavaScript 变量（或函数）或 Map 的方式使用资源文件中的 key。\n\n总的来说，jQuery.i18n.properties 有一下一些特点：\n\n 1. 使用 Java 标准的 .properties 文件作为资源文件，资源文件命名有以下三种格式：\n\n    ```javascript\n    basename_properties \n    basename_language.properties \n    basename_language_country.properties\n    ```\n 2. 使用 ISO-639 作为语言编码标准，ISO-3166 作为国家名称编码标准\n 3. 按顺序加载默认资源文件和指定语言环境的资源文件，保证默认值始终可用\n 4. 未指定语言环境时使用浏览器提供的语言\n 5. 可以在资源字符串中使用占位符（例如：hello= 你好 {0}! 今天是 {1}。）\n 6. 资源文件中的 Key 支持命名空间（例如：com.company.msgs.hello = Hello!）\n 7. 支持跨行的值\n 8. 可以以 JavaScript 变量（或函数）或 Map 的方式使用资源文件中的 Key\n\n## 2. API\n\njQuery.i18n.properties 的 API 非常简单，只有少数几个 API，即 jQuery.i18n.properties()、jQuery.i18n.prop()、jQuery.i18n.browserLang()。当然，和其他 jQuery 插件一样，我们也可以采用 $.i18n.properties()、$.i18n.prop() 和 $.i18n.browserLang() 的形式使用这用这些 API。\n\n### 2.1 jQuery.i18n.properties(setting)\n\n该方法加载资源文件，其中 settings 是配置加载选项的一系列键值对，各配置项的具体描述如表 1 所示。\n\n**表 1. settings**\n选项| 描述 | 类型 | 可选\n-------|----------\nname | 资源文件的名称，例如 strings 或 [strings1,strings2]，前者代表一个资源文件，后者代表资源文件数组。| String或String[] | 否\npath | 资源文件所在目录的路径 | String | 是\nmode | 加载模式：“vars”表示以JavaScript变量或函数的形式使用资源文件中的Key，“map”表示以 Map 的方式使用资源文件中的Key，“both”表示可以同时使用两种方式。如果资源文件中的 Key 包含 JavaScript 的关键字，则只能采用“map”。默认值是“vars”。 | String | 是\nlanguage | ISO-639 指定的语言编码（如：“en”表示英文、“zh”表示中文），或同时使用ISO-639 指定的语言编码和ISO-3166指定的国家编码（如：“en_US”，“zh_CN”等）。如果不指定，则采用浏览器报告的语言编码。 | String | 是\ncache | 指定浏览器是否对资源文件进行缓存，默认为 false。 | boolean | 是\nencoding | 加载资源文件时使用的编码。默认为 UTF-8。 | String | 是\ncallback | \t代码执行完成时运行的回调函数 | function | 是\n\njQuery.i18n.properties() 的使用方法如清单 1 所示。\n\n清单 1. jQuery.i18n.properties() 用法\n\n```javascript\njQuery.i18n.properties({ \n   name:'strings',// 资源文件名称\n   path:'bundle/',// 资源文件所在目录路径\n   mode:'both',// 模式：变量或 Map \n   language:'pt_PT',// 对应的语言\n   cache:false, \n   encoding: 'UTF-8', \n   callback: function() {// 回调方法\n   } \n});\n```\n\n### 2.2 jQuery.i18n.prop(key)\n\n该方法以 map 的方式使用资源文件中的值，其中 key 指的是资源文件中的 key。当 key 指定的值含有占位符时，可以使用 jQuery.i18n.prop(key,var1,var2 … ) 的形式，其中 var1,var2 …对各占位符依次进行替换。例如资源文件中有“msg_hello= 您好 {0}，今天是 {1}。”的键值对，则我们可以采用“jQuery.i18n.prop( ‘ msg_hello ’ , ’小明’ , ’星期一’ );”的形式使用 msg_hello。\n\n### 2.3 jQuery.i18n.browserLang() \n\n用于获取浏览浏览器的语言信息，这里不再单独介绍。\n\n## 3. 示例\n\n### 3.1 建立资源文件\n\n如下图所示：\n![工程结构][1]\n\n在 i18n 目录下创建 strings_en.properties 和，stirngs_zh.properties 两个资源文件，其中 strings_en.properties 对应英文翻译，如清单 2 所示；string_zh.properties 对应中文翻译，如清单 3 所示。\n\n清单 2. stirngs_en.properties\n\n```properties\nloginTitle              = Login NM3000\nusername                = username\nusernameEnter           = please enter username\npassword                = password\npasswordEnter           = please enter password\nautoLogin               = AutoLogin\nlogin                   = Login\ncopyright               = Topvision All Rights Reserved\n```\n\n清单3. strings_zh.properties\n\n```properties\nloginTitle             = 登录NM3000\nusername                = 用户名\npassword                = 密码\nautoLogin               = 自动登录\nlogin                   = 登录\n```\n\n### 3.2 引用插件\n和其他 jQuery 插件一样，jQuery.i18n.properties插件依赖jQuery，因此我们首先需要引用 jQuery。jQuery.i18n.properties 对 jQuery 的版本没有明确要求。我们使用清单 4 所示的方式在 index.html 中引用 jQuery 和 jQuery.i18n.properties 插件。\n \n 清单 4. 引用 jQuery.i18n.properties\n```javascript\n<script type=\"text/javascript\" src=\"../../lib/jquery/jquery.min.js\"></script>\n<script type=\"text/javascript\" src=\"../../lib/jquery/jquery.i18n.properties-min-1.0.9.js\"></script>\n```\n\n### 3.3 使用\n\n```javascript\n$(function() {\n    lang = (jQuery.i18n.browserLang().substring(0, 2)); //默认从浏览器语言读取\n    jQuery.i18n.properties({\n        name: 'strings',\n        path: '../../i18n/', //资源文件路径\n        mode: 'map', //用Map的方式使用资源文件中的值\n        language: 'en',\n        callback: function() { //加载成功后设置显示内容\n            $('#title').html($.i18n.prop('loginTitle'));\n            ...\n        }\n    });\n})\n```\n\n## 4. 注意事项\n\n### 4.1 资源文件命名\n\n var lang = jQuery.i18n.browserLang() 获取的语言是zh-CN、en-US格式，\n jQuery.i18n.properties 默认的资源文件命名方式为“zh_CN”、“en_US”的形式\n \n 设置插件语言的时候一定要和资源文件的语言代码一致，否则无法解析。\n \n## 5. 总结\n\n本文对 jQuery 国际化插件 jQuery.i18n.properties 进行了介绍，并用实际例子介绍了如何使用 jQuery.i18n.properties 插件实现 Web 前端的国际化。总结起来，jQuery.i18n.properties 具有轻量级（压缩后仅 4kb）、简单易用等特点，但是作为一个普及度不高的轻量级插件，不一定适用于大型的或对效率要求极高的场景。\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/web/jqueryi18n%E7%A4%BA%E4%BE%8B%E5%B7%A5%E7%A8%8B%E7%9B%AE%E5%BD%95.png","source":"_posts/使用jquery-i18n完成前端国际化.md","raw":"---\ntitle: 使用jquery.i18n完成前端国际化\ncategories:\n  - Web\ntags:\n  - 国际化\ndate: 2017-08-31 13:15:33\n---\n本文对 jQuery 国际化插件 jQuery.i18n.properties 进行了介绍，并用实际例子介绍了如何使用 jQuery.i18n.properties 插件实现 Web 前端的国际化。总结起来，jQuery.i18n.properties 具有轻量级（压缩后仅 4kb）、简单易用等特点，但是作为一个普及度不高的轻量级插件，不一定适用于大型的或对效率要求极高的场景。\n<!--more-->\n## 1. 简介\n\njQuery.i18n.properties 是一款轻量级的 jQuery 国际化插件。与 Java 里的资源文件类似，jQuery.i18n.properties 采用 .properties 文件对 JavaScript 进行国际化。jQuery.i18n.properties 插件根据用户指定的（或浏览器提供的 ）语言和国家编码（符合 ISO-639 和 ISO-3166 标准）来解析对应的以“.properties”为后缀的资源文件。\n\n利用资源文件实现国际化是一种比较流行的方式，例如 Android 应用就可以采用以语言和国家编码命名的资源文件来实现国际化。jQuery.i18n.properties 插件中的资源文件以“.properties”为后缀，包含了区域相关的键值对。我们知道，Java 程序也可以使用以 .properties 为后缀的资源文件来实现国际化，因此，当我们要在 Java 程序和前端 JavaScript 程序中共享资源文件时，这种方式就显得特别有用。jQuery.i18n.properties 插件首先加载默认的资源文件（例如：strings.properties），然后加载针对特定语言环境的资源文件（例如：strings_zh.properties），这就保证了在未提供某种语言的翻译时，默认值始终有效。开发人员可以以 JavaScript 变量（或函数）或 Map 的方式使用资源文件中的 key。\n\n总的来说，jQuery.i18n.properties 有一下一些特点：\n\n 1. 使用 Java 标准的 .properties 文件作为资源文件，资源文件命名有以下三种格式：\n\n    ```javascript\n    basename_properties \n    basename_language.properties \n    basename_language_country.properties\n    ```\n 2. 使用 ISO-639 作为语言编码标准，ISO-3166 作为国家名称编码标准\n 3. 按顺序加载默认资源文件和指定语言环境的资源文件，保证默认值始终可用\n 4. 未指定语言环境时使用浏览器提供的语言\n 5. 可以在资源字符串中使用占位符（例如：hello= 你好 {0}! 今天是 {1}。）\n 6. 资源文件中的 Key 支持命名空间（例如：com.company.msgs.hello = Hello!）\n 7. 支持跨行的值\n 8. 可以以 JavaScript 变量（或函数）或 Map 的方式使用资源文件中的 Key\n\n## 2. API\n\njQuery.i18n.properties 的 API 非常简单，只有少数几个 API，即 jQuery.i18n.properties()、jQuery.i18n.prop()、jQuery.i18n.browserLang()。当然，和其他 jQuery 插件一样，我们也可以采用 $.i18n.properties()、$.i18n.prop() 和 $.i18n.browserLang() 的形式使用这用这些 API。\n\n### 2.1 jQuery.i18n.properties(setting)\n\n该方法加载资源文件，其中 settings 是配置加载选项的一系列键值对，各配置项的具体描述如表 1 所示。\n\n**表 1. settings**\n选项| 描述 | 类型 | 可选\n-------|----------\nname | 资源文件的名称，例如 strings 或 [strings1,strings2]，前者代表一个资源文件，后者代表资源文件数组。| String或String[] | 否\npath | 资源文件所在目录的路径 | String | 是\nmode | 加载模式：“vars”表示以JavaScript变量或函数的形式使用资源文件中的Key，“map”表示以 Map 的方式使用资源文件中的Key，“both”表示可以同时使用两种方式。如果资源文件中的 Key 包含 JavaScript 的关键字，则只能采用“map”。默认值是“vars”。 | String | 是\nlanguage | ISO-639 指定的语言编码（如：“en”表示英文、“zh”表示中文），或同时使用ISO-639 指定的语言编码和ISO-3166指定的国家编码（如：“en_US”，“zh_CN”等）。如果不指定，则采用浏览器报告的语言编码。 | String | 是\ncache | 指定浏览器是否对资源文件进行缓存，默认为 false。 | boolean | 是\nencoding | 加载资源文件时使用的编码。默认为 UTF-8。 | String | 是\ncallback | \t代码执行完成时运行的回调函数 | function | 是\n\njQuery.i18n.properties() 的使用方法如清单 1 所示。\n\n清单 1. jQuery.i18n.properties() 用法\n\n```javascript\njQuery.i18n.properties({ \n   name:'strings',// 资源文件名称\n   path:'bundle/',// 资源文件所在目录路径\n   mode:'both',// 模式：变量或 Map \n   language:'pt_PT',// 对应的语言\n   cache:false, \n   encoding: 'UTF-8', \n   callback: function() {// 回调方法\n   } \n});\n```\n\n### 2.2 jQuery.i18n.prop(key)\n\n该方法以 map 的方式使用资源文件中的值，其中 key 指的是资源文件中的 key。当 key 指定的值含有占位符时，可以使用 jQuery.i18n.prop(key,var1,var2 … ) 的形式，其中 var1,var2 …对各占位符依次进行替换。例如资源文件中有“msg_hello= 您好 {0}，今天是 {1}。”的键值对，则我们可以采用“jQuery.i18n.prop( ‘ msg_hello ’ , ’小明’ , ’星期一’ );”的形式使用 msg_hello。\n\n### 2.3 jQuery.i18n.browserLang() \n\n用于获取浏览浏览器的语言信息，这里不再单独介绍。\n\n## 3. 示例\n\n### 3.1 建立资源文件\n\n如下图所示：\n![工程结构][1]\n\n在 i18n 目录下创建 strings_en.properties 和，stirngs_zh.properties 两个资源文件，其中 strings_en.properties 对应英文翻译，如清单 2 所示；string_zh.properties 对应中文翻译，如清单 3 所示。\n\n清单 2. stirngs_en.properties\n\n```properties\nloginTitle              = Login NM3000\nusername                = username\nusernameEnter           = please enter username\npassword                = password\npasswordEnter           = please enter password\nautoLogin               = AutoLogin\nlogin                   = Login\ncopyright               = Topvision All Rights Reserved\n```\n\n清单3. strings_zh.properties\n\n```properties\nloginTitle             = 登录NM3000\nusername                = 用户名\npassword                = 密码\nautoLogin               = 自动登录\nlogin                   = 登录\n```\n\n### 3.2 引用插件\n和其他 jQuery 插件一样，jQuery.i18n.properties插件依赖jQuery，因此我们首先需要引用 jQuery。jQuery.i18n.properties 对 jQuery 的版本没有明确要求。我们使用清单 4 所示的方式在 index.html 中引用 jQuery 和 jQuery.i18n.properties 插件。\n \n 清单 4. 引用 jQuery.i18n.properties\n```javascript\n<script type=\"text/javascript\" src=\"../../lib/jquery/jquery.min.js\"></script>\n<script type=\"text/javascript\" src=\"../../lib/jquery/jquery.i18n.properties-min-1.0.9.js\"></script>\n```\n\n### 3.3 使用\n\n```javascript\n$(function() {\n    lang = (jQuery.i18n.browserLang().substring(0, 2)); //默认从浏览器语言读取\n    jQuery.i18n.properties({\n        name: 'strings',\n        path: '../../i18n/', //资源文件路径\n        mode: 'map', //用Map的方式使用资源文件中的值\n        language: 'en',\n        callback: function() { //加载成功后设置显示内容\n            $('#title').html($.i18n.prop('loginTitle'));\n            ...\n        }\n    });\n})\n```\n\n## 4. 注意事项\n\n### 4.1 资源文件命名\n\n var lang = jQuery.i18n.browserLang() 获取的语言是zh-CN、en-US格式，\n jQuery.i18n.properties 默认的资源文件命名方式为“zh_CN”、“en_US”的形式\n \n 设置插件语言的时候一定要和资源文件的语言代码一致，否则无法解析。\n \n## 5. 总结\n\n本文对 jQuery 国际化插件 jQuery.i18n.properties 进行了介绍，并用实际例子介绍了如何使用 jQuery.i18n.properties 插件实现 Web 前端的国际化。总结起来，jQuery.i18n.properties 具有轻量级（压缩后仅 4kb）、简单易用等特点，但是作为一个普及度不高的轻量级插件，不一定适用于大型的或对效率要求极高的场景。\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/web/jqueryi18n%E7%A4%BA%E4%BE%8B%E5%B7%A5%E7%A8%8B%E7%9B%AE%E5%BD%95.png","slug":"使用jquery-i18n完成前端国际化","published":1,"updated":"2018-02-27T07:38:38.103Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfvr0048hwvfd485j534","content":"<p>本文对 jQuery 国际化插件 jQuery.i18n.properties 进行了介绍，并用实际例子介绍了如何使用 jQuery.i18n.properties 插件实现 Web 前端的国际化。总结起来，jQuery.i18n.properties 具有轻量级（压缩后仅 4kb）、简单易用等特点，但是作为一个普及度不高的轻量级插件，不一定适用于大型的或对效率要求极高的场景。<br><a id=\"more\"></a></p>\n<h2 id=\"1-简介\"><a href=\"#1-简介\" class=\"headerlink\" title=\"1. 简介\"></a>1. 简介</h2><p>jQuery.i18n.properties 是一款轻量级的 jQuery 国际化插件。与 Java 里的资源文件类似，jQuery.i18n.properties 采用 .properties 文件对 JavaScript 进行国际化。jQuery.i18n.properties 插件根据用户指定的（或浏览器提供的 ）语言和国家编码（符合 ISO-639 和 ISO-3166 标准）来解析对应的以“.properties”为后缀的资源文件。</p>\n<p>利用资源文件实现国际化是一种比较流行的方式，例如 Android 应用就可以采用以语言和国家编码命名的资源文件来实现国际化。jQuery.i18n.properties 插件中的资源文件以“.properties”为后缀，包含了区域相关的键值对。我们知道，Java 程序也可以使用以 .properties 为后缀的资源文件来实现国际化，因此，当我们要在 Java 程序和前端 JavaScript 程序中共享资源文件时，这种方式就显得特别有用。jQuery.i18n.properties 插件首先加载默认的资源文件（例如：strings.properties），然后加载针对特定语言环境的资源文件（例如：strings_zh.properties），这就保证了在未提供某种语言的翻译时，默认值始终有效。开发人员可以以 JavaScript 变量（或函数）或 Map 的方式使用资源文件中的 key。</p>\n<p>总的来说，jQuery.i18n.properties 有一下一些特点：</p>\n<ol>\n<li><p>使用 Java 标准的 .properties 文件作为资源文件，资源文件命名有以下三种格式：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">basename_properties </div><div class=\"line\">basename_language.properties </div><div class=\"line\">basename_language_country.properties</div></pre></td></tr></table></figure>\n</li>\n<li><p>使用 ISO-639 作为语言编码标准，ISO-3166 作为国家名称编码标准</p>\n</li>\n<li>按顺序加载默认资源文件和指定语言环境的资源文件，保证默认值始终可用</li>\n<li>未指定语言环境时使用浏览器提供的语言</li>\n<li>可以在资源字符串中使用占位符（例如：hello= 你好 {0}! 今天是 {1}。）</li>\n<li>资源文件中的 Key 支持命名空间（例如：com.company.msgs.hello = Hello!）</li>\n<li>支持跨行的值</li>\n<li>可以以 JavaScript 变量（或函数）或 Map 的方式使用资源文件中的 Key</li>\n</ol>\n<h2 id=\"2-API\"><a href=\"#2-API\" class=\"headerlink\" title=\"2. API\"></a>2. API</h2><p>jQuery.i18n.properties 的 API 非常简单，只有少数几个 API，即 jQuery.i18n.properties()、jQuery.i18n.prop()、jQuery.i18n.browserLang()。当然，和其他 jQuery 插件一样，我们也可以采用 $.i18n.properties()、$.i18n.prop() 和 $.i18n.browserLang() 的形式使用这用这些 API。</p>\n<h3 id=\"2-1-jQuery-i18n-properties-setting\"><a href=\"#2-1-jQuery-i18n-properties-setting\" class=\"headerlink\" title=\"2.1 jQuery.i18n.properties(setting)\"></a>2.1 jQuery.i18n.properties(setting)</h3><p>该方法加载资源文件，其中 settings 是配置加载选项的一系列键值对，各配置项的具体描述如表 1 所示。</p>\n<p><strong>表 1. settings</strong><br>选项| 描述 | 类型 | 可选<br>——-|———-<br>name | 资源文件的名称，例如 strings 或 [strings1,strings2]，前者代表一个资源文件，后者代表资源文件数组。| String或String[] | 否<br>path | 资源文件所在目录的路径 | String | 是<br>mode | 加载模式：“vars”表示以JavaScript变量或函数的形式使用资源文件中的Key，“map”表示以 Map 的方式使用资源文件中的Key，“both”表示可以同时使用两种方式。如果资源文件中的 Key 包含 JavaScript 的关键字，则只能采用“map”。默认值是“vars”。 | String | 是<br>language | ISO-639 指定的语言编码（如：“en”表示英文、“zh”表示中文），或同时使用ISO-639 指定的语言编码和ISO-3166指定的国家编码（如：“en_US”，“zh_CN”等）。如果不指定，则采用浏览器报告的语言编码。 | String | 是<br>cache | 指定浏览器是否对资源文件进行缓存，默认为 false。 | boolean | 是<br>encoding | 加载资源文件时使用的编码。默认为 UTF-8。 | String | 是<br>callback |     代码执行完成时运行的回调函数 | function | 是</p>\n<p>jQuery.i18n.properties() 的使用方法如清单 1 所示。</p>\n<p>清单 1. jQuery.i18n.properties() 用法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">jQuery.i18n.properties(&#123; </div><div class=\"line\">   <span class=\"attr\">name</span>:<span class=\"string\">'strings'</span>,<span class=\"comment\">// 资源文件名称</span></div><div class=\"line\">   path:<span class=\"string\">'bundle/'</span>,<span class=\"comment\">// 资源文件所在目录路径</span></div><div class=\"line\">   mode:<span class=\"string\">'both'</span>,<span class=\"comment\">// 模式：变量或 Map </span></div><div class=\"line\">   language:<span class=\"string\">'pt_PT'</span>,<span class=\"comment\">// 对应的语言</span></div><div class=\"line\">   cache:<span class=\"literal\">false</span>, </div><div class=\"line\">   <span class=\"attr\">encoding</span>: <span class=\"string\">'UTF-8'</span>, </div><div class=\"line\">   <span class=\"attr\">callback</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;<span class=\"comment\">// 回调方法</span></div><div class=\"line\">   &#125; </div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<h3 id=\"2-2-jQuery-i18n-prop-key\"><a href=\"#2-2-jQuery-i18n-prop-key\" class=\"headerlink\" title=\"2.2 jQuery.i18n.prop(key)\"></a>2.2 jQuery.i18n.prop(key)</h3><p>该方法以 map 的方式使用资源文件中的值，其中 key 指的是资源文件中的 key。当 key 指定的值含有占位符时，可以使用 jQuery.i18n.prop(key,var1,var2 … ) 的形式，其中 var1,var2 …对各占位符依次进行替换。例如资源文件中有“msg_hello= 您好 {0}，今天是 {1}。”的键值对，则我们可以采用“jQuery.i18n.prop( ‘ msg_hello ’ , ’小明’ , ’星期一’ );”的形式使用 msg_hello。</p>\n<h3 id=\"2-3-jQuery-i18n-browserLang\"><a href=\"#2-3-jQuery-i18n-browserLang\" class=\"headerlink\" title=\"2.3 jQuery.i18n.browserLang()\"></a>2.3 jQuery.i18n.browserLang()</h3><p>用于获取浏览浏览器的语言信息，这里不再单独介绍。</p>\n<h2 id=\"3-示例\"><a href=\"#3-示例\" class=\"headerlink\" title=\"3. 示例\"></a>3. 示例</h2><h3 id=\"3-1-建立资源文件\"><a href=\"#3-1-建立资源文件\" class=\"headerlink\" title=\"3.1 建立资源文件\"></a>3.1 建立资源文件</h3><p>如下图所示：<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/web/jqueryi18n%E7%A4%BA%E4%BE%8B%E5%B7%A5%E7%A8%8B%E7%9B%AE%E5%BD%95.png\" alt=\"工程结构\"></p>\n<p>在 i18n 目录下创建 strings_en.properties 和，stirngs_zh.properties 两个资源文件，其中 strings_en.properties 对应英文翻译，如清单 2 所示；string_zh.properties 对应中文翻译，如清单 3 所示。</p>\n<p>清单 2. stirngs_en.properties</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">loginTitle              = Login NM3000</div><div class=\"line\">username                = username</div><div class=\"line\">usernameEnter           = please enter username</div><div class=\"line\">password                = password</div><div class=\"line\">passwordEnter           = please enter password</div><div class=\"line\">autoLogin               = AutoLogin</div><div class=\"line\">login                   = Login</div><div class=\"line\">copyright               = Topvision All Rights Reserved</div></pre></td></tr></table></figure>\n<p>清单3. strings_zh.properties</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">loginTitle             = 登录NM3000</div><div class=\"line\">username                = 用户名</div><div class=\"line\">password                = 密码</div><div class=\"line\">autoLogin               = 自动登录</div><div class=\"line\">login                   = 登录</div></pre></td></tr></table></figure>\n<h3 id=\"3-2-引用插件\"><a href=\"#3-2-引用插件\" class=\"headerlink\" title=\"3.2 引用插件\"></a>3.2 引用插件</h3><p>和其他 jQuery 插件一样，jQuery.i18n.properties插件依赖jQuery，因此我们首先需要引用 jQuery。jQuery.i18n.properties 对 jQuery 的版本没有明确要求。我们使用清单 4 所示的方式在 index.html 中引用 jQuery 和 jQuery.i18n.properties 插件。</p>\n<p> 清单 4. 引用 jQuery.i18n.properties<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;script type=<span class=\"string\">\"text/javascript\"</span> src=<span class=\"string\">\"../../lib/jquery/jquery.min.js\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div><div class=\"line\">&lt;script type=<span class=\"string\">\"text/javascript\"</span> src=<span class=\"string\">\"../../lib/jquery/jquery.i18n.properties-min-1.0.9.js\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div></pre></td></tr></table></figure></p>\n<h3 id=\"3-3-使用\"><a href=\"#3-3-使用\" class=\"headerlink\" title=\"3.3 使用\"></a>3.3 使用</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">$(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    lang = (jQuery.i18n.browserLang().substring(<span class=\"number\">0</span>, <span class=\"number\">2</span>)); <span class=\"comment\">//默认从浏览器语言读取</span></div><div class=\"line\">    jQuery.i18n.properties(&#123;</div><div class=\"line\">        <span class=\"attr\">name</span>: <span class=\"string\">'strings'</span>,</div><div class=\"line\">        <span class=\"attr\">path</span>: <span class=\"string\">'../../i18n/'</span>, <span class=\"comment\">//资源文件路径</span></div><div class=\"line\">        mode: <span class=\"string\">'map'</span>, <span class=\"comment\">//用Map的方式使用资源文件中的值</span></div><div class=\"line\">        language: <span class=\"string\">'en'</span>,</div><div class=\"line\">        <span class=\"attr\">callback</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; <span class=\"comment\">//加载成功后设置显示内容</span></div><div class=\"line\">            $(<span class=\"string\">'#title'</span>).html($.i18n.prop(<span class=\"string\">'loginTitle'</span>));</div><div class=\"line\">            ...</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;);</div><div class=\"line\">&#125;)</div></pre></td></tr></table></figure>\n<h2 id=\"4-注意事项\"><a href=\"#4-注意事项\" class=\"headerlink\" title=\"4. 注意事项\"></a>4. 注意事项</h2><h3 id=\"4-1-资源文件命名\"><a href=\"#4-1-资源文件命名\" class=\"headerlink\" title=\"4.1 资源文件命名\"></a>4.1 资源文件命名</h3><p> var lang = jQuery.i18n.browserLang() 获取的语言是zh-CN、en-US格式，<br> jQuery.i18n.properties 默认的资源文件命名方式为“zh_CN”、“en_US”的形式</p>\n<p> 设置插件语言的时候一定要和资源文件的语言代码一致，否则无法解析。</p>\n<h2 id=\"5-总结\"><a href=\"#5-总结\" class=\"headerlink\" title=\"5. 总结\"></a>5. 总结</h2><p>本文对 jQuery 国际化插件 jQuery.i18n.properties 进行了介绍，并用实际例子介绍了如何使用 jQuery.i18n.properties 插件实现 Web 前端的国际化。总结起来，jQuery.i18n.properties 具有轻量级（压缩后仅 4kb）、简单易用等特点，但是作为一个普及度不高的轻量级插件，不一定适用于大型的或对效率要求极高的场景。</p>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>本文对 jQuery 国际化插件 jQuery.i18n.properties 进行了介绍，并用实际例子介绍了如何使用 jQuery.i18n.properties 插件实现 Web 前端的国际化。总结起来，jQuery.i18n.properties 具有轻量级（压缩后仅 4kb）、简单易用等特点，但是作为一个普及度不高的轻量级插件，不一定适用于大型的或对效率要求极高的场景。<br>","more":"</p>\n<h2 id=\"1-简介\"><a href=\"#1-简介\" class=\"headerlink\" title=\"1. 简介\"></a>1. 简介</h2><p>jQuery.i18n.properties 是一款轻量级的 jQuery 国际化插件。与 Java 里的资源文件类似，jQuery.i18n.properties 采用 .properties 文件对 JavaScript 进行国际化。jQuery.i18n.properties 插件根据用户指定的（或浏览器提供的 ）语言和国家编码（符合 ISO-639 和 ISO-3166 标准）来解析对应的以“.properties”为后缀的资源文件。</p>\n<p>利用资源文件实现国际化是一种比较流行的方式，例如 Android 应用就可以采用以语言和国家编码命名的资源文件来实现国际化。jQuery.i18n.properties 插件中的资源文件以“.properties”为后缀，包含了区域相关的键值对。我们知道，Java 程序也可以使用以 .properties 为后缀的资源文件来实现国际化，因此，当我们要在 Java 程序和前端 JavaScript 程序中共享资源文件时，这种方式就显得特别有用。jQuery.i18n.properties 插件首先加载默认的资源文件（例如：strings.properties），然后加载针对特定语言环境的资源文件（例如：strings_zh.properties），这就保证了在未提供某种语言的翻译时，默认值始终有效。开发人员可以以 JavaScript 变量（或函数）或 Map 的方式使用资源文件中的 key。</p>\n<p>总的来说，jQuery.i18n.properties 有一下一些特点：</p>\n<ol>\n<li><p>使用 Java 标准的 .properties 文件作为资源文件，资源文件命名有以下三种格式：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div></pre></td><td class=\"code\"><pre><div class=\"line\">basename_properties </div><div class=\"line\">basename_language.properties </div><div class=\"line\">basename_language_country.properties</div></pre></td></tr></table></figure>\n</li>\n<li><p>使用 ISO-639 作为语言编码标准，ISO-3166 作为国家名称编码标准</p>\n</li>\n<li>按顺序加载默认资源文件和指定语言环境的资源文件，保证默认值始终可用</li>\n<li>未指定语言环境时使用浏览器提供的语言</li>\n<li>可以在资源字符串中使用占位符（例如：hello= 你好 {0}! 今天是 {1}。）</li>\n<li>资源文件中的 Key 支持命名空间（例如：com.company.msgs.hello = Hello!）</li>\n<li>支持跨行的值</li>\n<li>可以以 JavaScript 变量（或函数）或 Map 的方式使用资源文件中的 Key</li>\n</ol>\n<h2 id=\"2-API\"><a href=\"#2-API\" class=\"headerlink\" title=\"2. API\"></a>2. API</h2><p>jQuery.i18n.properties 的 API 非常简单，只有少数几个 API，即 jQuery.i18n.properties()、jQuery.i18n.prop()、jQuery.i18n.browserLang()。当然，和其他 jQuery 插件一样，我们也可以采用 $.i18n.properties()、$.i18n.prop() 和 $.i18n.browserLang() 的形式使用这用这些 API。</p>\n<h3 id=\"2-1-jQuery-i18n-properties-setting\"><a href=\"#2-1-jQuery-i18n-properties-setting\" class=\"headerlink\" title=\"2.1 jQuery.i18n.properties(setting)\"></a>2.1 jQuery.i18n.properties(setting)</h3><p>该方法加载资源文件，其中 settings 是配置加载选项的一系列键值对，各配置项的具体描述如表 1 所示。</p>\n<p><strong>表 1. settings</strong><br>选项| 描述 | 类型 | 可选<br>——-|———-<br>name | 资源文件的名称，例如 strings 或 [strings1,strings2]，前者代表一个资源文件，后者代表资源文件数组。| String或String[] | 否<br>path | 资源文件所在目录的路径 | String | 是<br>mode | 加载模式：“vars”表示以JavaScript变量或函数的形式使用资源文件中的Key，“map”表示以 Map 的方式使用资源文件中的Key，“both”表示可以同时使用两种方式。如果资源文件中的 Key 包含 JavaScript 的关键字，则只能采用“map”。默认值是“vars”。 | String | 是<br>language | ISO-639 指定的语言编码（如：“en”表示英文、“zh”表示中文），或同时使用ISO-639 指定的语言编码和ISO-3166指定的国家编码（如：“en_US”，“zh_CN”等）。如果不指定，则采用浏览器报告的语言编码。 | String | 是<br>cache | 指定浏览器是否对资源文件进行缓存，默认为 false。 | boolean | 是<br>encoding | 加载资源文件时使用的编码。默认为 UTF-8。 | String | 是<br>callback |     代码执行完成时运行的回调函数 | function | 是</p>\n<p>jQuery.i18n.properties() 的使用方法如清单 1 所示。</p>\n<p>清单 1. jQuery.i18n.properties() 用法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div></pre></td><td class=\"code\"><pre><div class=\"line\">jQuery.i18n.properties(&#123; </div><div class=\"line\">   <span class=\"attr\">name</span>:<span class=\"string\">'strings'</span>,<span class=\"comment\">// 资源文件名称</span></div><div class=\"line\">   path:<span class=\"string\">'bundle/'</span>,<span class=\"comment\">// 资源文件所在目录路径</span></div><div class=\"line\">   mode:<span class=\"string\">'both'</span>,<span class=\"comment\">// 模式：变量或 Map </span></div><div class=\"line\">   language:<span class=\"string\">'pt_PT'</span>,<span class=\"comment\">// 对应的语言</span></div><div class=\"line\">   cache:<span class=\"literal\">false</span>, </div><div class=\"line\">   <span class=\"attr\">encoding</span>: <span class=\"string\">'UTF-8'</span>, </div><div class=\"line\">   <span class=\"attr\">callback</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;<span class=\"comment\">// 回调方法</span></div><div class=\"line\">   &#125; </div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<h3 id=\"2-2-jQuery-i18n-prop-key\"><a href=\"#2-2-jQuery-i18n-prop-key\" class=\"headerlink\" title=\"2.2 jQuery.i18n.prop(key)\"></a>2.2 jQuery.i18n.prop(key)</h3><p>该方法以 map 的方式使用资源文件中的值，其中 key 指的是资源文件中的 key。当 key 指定的值含有占位符时，可以使用 jQuery.i18n.prop(key,var1,var2 … ) 的形式，其中 var1,var2 …对各占位符依次进行替换。例如资源文件中有“msg_hello= 您好 {0}，今天是 {1}。”的键值对，则我们可以采用“jQuery.i18n.prop( ‘ msg_hello ’ , ’小明’ , ’星期一’ );”的形式使用 msg_hello。</p>\n<h3 id=\"2-3-jQuery-i18n-browserLang\"><a href=\"#2-3-jQuery-i18n-browserLang\" class=\"headerlink\" title=\"2.3 jQuery.i18n.browserLang()\"></a>2.3 jQuery.i18n.browserLang()</h3><p>用于获取浏览浏览器的语言信息，这里不再单独介绍。</p>\n<h2 id=\"3-示例\"><a href=\"#3-示例\" class=\"headerlink\" title=\"3. 示例\"></a>3. 示例</h2><h3 id=\"3-1-建立资源文件\"><a href=\"#3-1-建立资源文件\" class=\"headerlink\" title=\"3.1 建立资源文件\"></a>3.1 建立资源文件</h3><p>如下图所示：<br><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/web/jqueryi18n%E7%A4%BA%E4%BE%8B%E5%B7%A5%E7%A8%8B%E7%9B%AE%E5%BD%95.png\" alt=\"工程结构\"></p>\n<p>在 i18n 目录下创建 strings_en.properties 和，stirngs_zh.properties 两个资源文件，其中 strings_en.properties 对应英文翻译，如清单 2 所示；string_zh.properties 对应中文翻译，如清单 3 所示。</p>\n<p>清单 2. stirngs_en.properties</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div></pre></td><td class=\"code\"><pre><div class=\"line\">loginTitle              = Login NM3000</div><div class=\"line\">username                = username</div><div class=\"line\">usernameEnter           = please enter username</div><div class=\"line\">password                = password</div><div class=\"line\">passwordEnter           = please enter password</div><div class=\"line\">autoLogin               = AutoLogin</div><div class=\"line\">login                   = Login</div><div class=\"line\">copyright               = Topvision All Rights Reserved</div></pre></td></tr></table></figure>\n<p>清单3. strings_zh.properties</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\">loginTitle             = 登录NM3000</div><div class=\"line\">username                = 用户名</div><div class=\"line\">password                = 密码</div><div class=\"line\">autoLogin               = 自动登录</div><div class=\"line\">login                   = 登录</div></pre></td></tr></table></figure>\n<h3 id=\"3-2-引用插件\"><a href=\"#3-2-引用插件\" class=\"headerlink\" title=\"3.2 引用插件\"></a>3.2 引用插件</h3><p>和其他 jQuery 插件一样，jQuery.i18n.properties插件依赖jQuery，因此我们首先需要引用 jQuery。jQuery.i18n.properties 对 jQuery 的版本没有明确要求。我们使用清单 4 所示的方式在 index.html 中引用 jQuery 和 jQuery.i18n.properties 插件。</p>\n<p> 清单 4. 引用 jQuery.i18n.properties<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div></pre></td><td class=\"code\"><pre><div class=\"line\">&lt;script type=<span class=\"string\">\"text/javascript\"</span> src=<span class=\"string\">\"../../lib/jquery/jquery.min.js\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div><div class=\"line\">&lt;script type=<span class=\"string\">\"text/javascript\"</span> src=<span class=\"string\">\"../../lib/jquery/jquery.i18n.properties-min-1.0.9.js\"</span>&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></div></pre></td></tr></table></figure></p>\n<h3 id=\"3-3-使用\"><a href=\"#3-3-使用\" class=\"headerlink\" title=\"3.3 使用\"></a>3.3 使用</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div></pre></td><td class=\"code\"><pre><div class=\"line\">$(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">    lang = (jQuery.i18n.browserLang().substring(<span class=\"number\">0</span>, <span class=\"number\">2</span>)); <span class=\"comment\">//默认从浏览器语言读取</span></div><div class=\"line\">    jQuery.i18n.properties(&#123;</div><div class=\"line\">        <span class=\"attr\">name</span>: <span class=\"string\">'strings'</span>,</div><div class=\"line\">        <span class=\"attr\">path</span>: <span class=\"string\">'../../i18n/'</span>, <span class=\"comment\">//资源文件路径</span></div><div class=\"line\">        mode: <span class=\"string\">'map'</span>, <span class=\"comment\">//用Map的方式使用资源文件中的值</span></div><div class=\"line\">        language: <span class=\"string\">'en'</span>,</div><div class=\"line\">        <span class=\"attr\">callback</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123; <span class=\"comment\">//加载成功后设置显示内容</span></div><div class=\"line\">            $(<span class=\"string\">'#title'</span>).html($.i18n.prop(<span class=\"string\">'loginTitle'</span>));</div><div class=\"line\">            ...</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;);</div><div class=\"line\">&#125;)</div></pre></td></tr></table></figure>\n<h2 id=\"4-注意事项\"><a href=\"#4-注意事项\" class=\"headerlink\" title=\"4. 注意事项\"></a>4. 注意事项</h2><h3 id=\"4-1-资源文件命名\"><a href=\"#4-1-资源文件命名\" class=\"headerlink\" title=\"4.1 资源文件命名\"></a>4.1 资源文件命名</h3><p> var lang = jQuery.i18n.browserLang() 获取的语言是zh-CN、en-US格式，<br> jQuery.i18n.properties 默认的资源文件命名方式为“zh_CN”、“en_US”的形式</p>\n<p> 设置插件语言的时候一定要和资源文件的语言代码一致，否则无法解析。</p>\n<h2 id=\"5-总结\"><a href=\"#5-总结\" class=\"headerlink\" title=\"5. 总结\"></a>5. 总结</h2><p>本文对 jQuery 国际化插件 jQuery.i18n.properties 进行了介绍，并用实际例子介绍了如何使用 jQuery.i18n.properties 插件实现 Web 前端的国际化。总结起来，jQuery.i18n.properties 具有轻量级（压缩后仅 4kb）、简单易用等特点，但是作为一个普及度不高的轻量级插件，不一定适用于大型的或对效率要求极高的场景。</p>"},{"title":"什么是设计模式","date":"2018-03-26T08:56:22.000Z","_content":"\n简介。\n<!-- more -->\n\n\n## 设计模式简介\n设计模式实质是前人在代码设计的基础上总结出来的编码经验，代表了最佳的实践。使用设计模式是为了重用代码、让代码更容易被他人理解、保证代码可靠性。 \n\n## 设计原则\n设计模式主要是基于以下的面向对象设计原则：\n\n - 对接口编程而不是对实现编程。\n - 优先使用对象组合而不是继承。\n \n## 设计模式的类型\n\n![设计模式分类][1]\n\n - 创建型模式-->对象怎么来\n - 结构型模式-->对象和谁有关\n - 行为型模式-->对象与对象在干嘛\n - J2EE 模式-->对象合起来要干嘛（表现层,文中表示层个人感觉用的不准确）java是面向对象的语言,所以要搞好对象,模式（套路）就是用来更加好的搞对象滴。\n\n \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/designPatterns/patterns.png\n","source":"_posts/什么是设计模式.md","raw":"---\ntitle: 什么是设计模式\ncategories:\n  - 设计模式\ntags:\n  - 设计模式\ndate: 2018-03-26 16:56:22\n---\n\n简介。\n<!-- more -->\n\n\n## 设计模式简介\n设计模式实质是前人在代码设计的基础上总结出来的编码经验，代表了最佳的实践。使用设计模式是为了重用代码、让代码更容易被他人理解、保证代码可靠性。 \n\n## 设计原则\n设计模式主要是基于以下的面向对象设计原则：\n\n - 对接口编程而不是对实现编程。\n - 优先使用对象组合而不是继承。\n \n## 设计模式的类型\n\n![设计模式分类][1]\n\n - 创建型模式-->对象怎么来\n - 结构型模式-->对象和谁有关\n - 行为型模式-->对象与对象在干嘛\n - J2EE 模式-->对象合起来要干嘛（表现层,文中表示层个人感觉用的不准确）java是面向对象的语言,所以要搞好对象,模式（套路）就是用来更加好的搞对象滴。\n\n \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/designPatterns/patterns.png\n","slug":"什么是设计模式","published":1,"updated":"2018-03-26T09:03:11.797Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfvt004chwvfgxys3sia","content":"<p>简介。<br><a id=\"more\"></a></p>\n<h2 id=\"设计模式简介\"><a href=\"#设计模式简介\" class=\"headerlink\" title=\"设计模式简介\"></a>设计模式简介</h2><p>设计模式实质是前人在代码设计的基础上总结出来的编码经验，代表了最佳的实践。使用设计模式是为了重用代码、让代码更容易被他人理解、保证代码可靠性。 </p>\n<h2 id=\"设计原则\"><a href=\"#设计原则\" class=\"headerlink\" title=\"设计原则\"></a>设计原则</h2><p>设计模式主要是基于以下的面向对象设计原则：</p>\n<ul>\n<li>对接口编程而不是对实现编程。</li>\n<li>优先使用对象组合而不是继承。</li>\n</ul>\n<h2 id=\"设计模式的类型\"><a href=\"#设计模式的类型\" class=\"headerlink\" title=\"设计模式的类型\"></a>设计模式的类型</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/designPatterns/patterns.png\" alt=\"设计模式分类\"></p>\n<ul>\n<li>创建型模式–&gt;对象怎么来</li>\n<li>结构型模式–&gt;对象和谁有关</li>\n<li>行为型模式–&gt;对象与对象在干嘛</li>\n<li>J2EE 模式–&gt;对象合起来要干嘛（表现层,文中表示层个人感觉用的不准确）java是面向对象的语言,所以要搞好对象,模式（套路）就是用来更加好的搞对象滴。</li>\n</ul>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>简介。<br>","more":"</p>\n<h2 id=\"设计模式简介\"><a href=\"#设计模式简介\" class=\"headerlink\" title=\"设计模式简介\"></a>设计模式简介</h2><p>设计模式实质是前人在代码设计的基础上总结出来的编码经验，代表了最佳的实践。使用设计模式是为了重用代码、让代码更容易被他人理解、保证代码可靠性。 </p>\n<h2 id=\"设计原则\"><a href=\"#设计原则\" class=\"headerlink\" title=\"设计原则\"></a>设计原则</h2><p>设计模式主要是基于以下的面向对象设计原则：</p>\n<ul>\n<li>对接口编程而不是对实现编程。</li>\n<li>优先使用对象组合而不是继承。</li>\n</ul>\n<h2 id=\"设计模式的类型\"><a href=\"#设计模式的类型\" class=\"headerlink\" title=\"设计模式的类型\"></a>设计模式的类型</h2><p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/designPatterns/patterns.png\" alt=\"设计模式分类\"></p>\n<ul>\n<li>创建型模式–&gt;对象怎么来</li>\n<li>结构型模式–&gt;对象和谁有关</li>\n<li>行为型模式–&gt;对象与对象在干嘛</li>\n<li>J2EE 模式–&gt;对象合起来要干嘛（表现层,文中表示层个人感觉用的不准确）java是面向对象的语言,所以要搞好对象,模式（套路）就是用来更加好的搞对象滴。</li>\n</ul>"},{"title":"二分查找","date":"2018-03-08T07:45:15.000Z","_content":"二分查找法是对一组有序的数字中进行查找，传递相应的数据，进行比较查找到与原数据相同的数据，查找到了返回对应的数组下标，没有找到返回-1；\n<!--more-->\n\n## 1、基本二分查找实现\n\n 1. while循环\n    \n    ```java\n    /**\n     * 循环实现\n     * @param array 已排序数组\n     * @param target 目标\n     * @return 找不到返回-1，找到返回下标\n     */\n    private static int binarySearch(int[] array, int target) {\n        int low = 0;\n        int high = array.length - 1;\n\n        while (low <= high) {\n            int mid = low + (high - low) / 2; //注意此处写法，避免越界\n            if (array[mid] > target) {\n                high = mid - 1;\n            } else if (array[mid] < target) {\n                low = mid + 1;\n            } else {\n                return mid;\n            }\n        }\n\n        return -1;\n    }\n    ```\n\n 2. 递归实现\n \n    ```java\n    private static int binarySearch(int[] array, int target, int low, int high) {\n        int mid = low + (high - low) / 2;\n\n        if (array[mid] == target) {\n            return mid;\n        }\n        if (low >= high) {\n            return -1;\n        } else if (target > array[mid]) {\n            return binarySearch(array, target, mid + 1, high);\n        } else if (target < array[mid]) {\n            return binarySearch(array, target, low, mid - 1);\n        }\n        return -1;\n    }\n    ```\n    \n## 2、变形\n\n随着二分查找的进行，如果找到key并不结束循环的话，最终的结束状态会是right < left，并且right + 1 = left。\n\n - 当数组中存在key时，根据二分区间选择的不同，这里又分为两种情况，如下图（key为2时）\n - 当数组中不存在key时，最后仅有一种情况，即把图中的红色框框去掉。\n \n![此处输入图片的描述][1]\n\n那么，可以找到：\n\n 1. 最后一个小于key的元素 1       左right\n 2. 第一个大于等于key的元素 2     左left\n 3. 最后一个小于等于key的元素 2   右right\n 4. 第一个大于key的元素 5         右left\n\n另外，如果存在多个key时，稍加判断，就可以找到\n\n 1.  第一个与key相等的元素\n 2.  最后一个与key相等的元素\n\n \n\n```java\nwhile (left <= right) {\n    mid = (left + right) / 2;\n    if (key ? arr[mid]) {\n        right = mid - 1;\n    } else {\n        left = mid + 1;\n    }\n}\nreturn ?;\n```\n\n根据要求的值的位置，先确定比较符号，再确定返回值，\n比较符号：左<=，右<\n返回值：左right，右left\n\n### 2.1 查找最后一个小于key的元素\n\n```java\n//1 查找最后一个小于key的元素\nint findLastLess(int arr[], int len, int key) {\n    int left = 0;\n    int right = len - 1;\n    int mid;\n\n    while (left <= right) {\n        mid = left + (right - left) / 2;\n        if (key <= arr[mid]) {  // <=  意为左\n            right = mid - 1;\n        } else {\n            left = mid + 1;\n        }\n    }\n    return right;     //返回左边值right\n}\n```\n\n### 2.2 查找第一个大于等于key的元素\n\n```java\n//2 查找第一个大于等于key的元素\nint findLastLess(int arr[], int len, int key) {\n    int left = 0;\n    int right = len - 1;\n    int mid;\n\n    while (left <= right) {\n        mid = left + (right - left) / 2;\n        if (key <= arr[mid]) {  // <=  意为左\n            right = mid - 1;\n        } else {\n            left = mid + 1;\n        }\n    }\n    return left;     //返回右边值left\n}\n```\n\n### 2.3 查找最后一个小于等于key的元素\n \n```java\n//3 查找第一个大于等于key的元素\nint findLastLess(int arr[], int len, int key) {\n    int left = 0;\n    int right = len - 1;\n    int mid;\n\n    while (left <= right) {\n        mid = left + (right - left) / 2;\n        if (key < arr[mid]) {  // <=  意为右\n            right = mid - 1;\n        } else {\n            left = mid + 1;\n        }\n    }\n    return right;     //返回左边值right\n}\n```\n\n### 2.4 查找第一个大于key的元素\n\n```java\n//4 查找第一个大于key的元素\nint findLastLess(int arr[], int len, int key) {\n    int left = 0;\n    int right = len - 1;\n    int mid;\n\n    while (left <= right) {\n        mid = left + (right - left) / 2;\n        if (key < arr[mid]) {  // <=  意为右\n            right = mid - 1;\n        } else {\n            left = mid + 1;\n        }\n    }\n    return left;     //返回右边值left\n}\n```\n\n### 2.5 查找第一个与key相等的元素\n\n```java\n//5 查找第一个与key相等的元素\nint findFirstEqual(int arr[], int len, int key) {\n    int left = 0;\n    int right = len - 1;\n    int mid;\n\n    while (left <= right) {\n        mid = left + (right - left) / 2;\n        if (key <= arr[mid]) {  // <=  意为左\n            right = mid - 1;\n        } else {\n            left = mid + 1;\n        }\n    }\n    //right是最后一个小于key的\n    //left是第一个大于等于key的\n    if (left < len && arr[left] == key) {\n        return left;\n    }\n    return -1;\n}\n```\n\n### 2.6 查找最后一个与key相等的元素\n \n```java\n//6 查找最后一个与key相等的元素\nint findLastEqual(int arr[], int len, int key) {\n    int left = 0;\n    int right = len - 1;\n    int mid;\n\n    while (left <= right) {\n        mid = left + (right - left) / 2;\n        if (key < arr[mid]) {  // <  意为右\n            right = mid - 1;\n        } else {\n            left = mid + 1;\n        }\n    }\n    //right是最后一个小于key的\n    //left是第一个大于等于key的\n    if (right >= 0 && arr[right] == key) {\n        return right;\n    }\n    return -1;\n}\n```\n\n## 参考资料\n\n[你真的会写二分查找吗？-搏风雨][2]\n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/algorithm/binSearch.png\n  [2]: https://www.cnblogs.com/bofengyu/p/6761389.html\n","source":"_posts/二分查找.md","raw":"---\ntitle: 二分查找\ncategories:\n  - 算法\ntags:\n  - 算法\ndate: 2018-03-08 15:45:15\n---\n二分查找法是对一组有序的数字中进行查找，传递相应的数据，进行比较查找到与原数据相同的数据，查找到了返回对应的数组下标，没有找到返回-1；\n<!--more-->\n\n## 1、基本二分查找实现\n\n 1. while循环\n    \n    ```java\n    /**\n     * 循环实现\n     * @param array 已排序数组\n     * @param target 目标\n     * @return 找不到返回-1，找到返回下标\n     */\n    private static int binarySearch(int[] array, int target) {\n        int low = 0;\n        int high = array.length - 1;\n\n        while (low <= high) {\n            int mid = low + (high - low) / 2; //注意此处写法，避免越界\n            if (array[mid] > target) {\n                high = mid - 1;\n            } else if (array[mid] < target) {\n                low = mid + 1;\n            } else {\n                return mid;\n            }\n        }\n\n        return -1;\n    }\n    ```\n\n 2. 递归实现\n \n    ```java\n    private static int binarySearch(int[] array, int target, int low, int high) {\n        int mid = low + (high - low) / 2;\n\n        if (array[mid] == target) {\n            return mid;\n        }\n        if (low >= high) {\n            return -1;\n        } else if (target > array[mid]) {\n            return binarySearch(array, target, mid + 1, high);\n        } else if (target < array[mid]) {\n            return binarySearch(array, target, low, mid - 1);\n        }\n        return -1;\n    }\n    ```\n    \n## 2、变形\n\n随着二分查找的进行，如果找到key并不结束循环的话，最终的结束状态会是right < left，并且right + 1 = left。\n\n - 当数组中存在key时，根据二分区间选择的不同，这里又分为两种情况，如下图（key为2时）\n - 当数组中不存在key时，最后仅有一种情况，即把图中的红色框框去掉。\n \n![此处输入图片的描述][1]\n\n那么，可以找到：\n\n 1. 最后一个小于key的元素 1       左right\n 2. 第一个大于等于key的元素 2     左left\n 3. 最后一个小于等于key的元素 2   右right\n 4. 第一个大于key的元素 5         右left\n\n另外，如果存在多个key时，稍加判断，就可以找到\n\n 1.  第一个与key相等的元素\n 2.  最后一个与key相等的元素\n\n \n\n```java\nwhile (left <= right) {\n    mid = (left + right) / 2;\n    if (key ? arr[mid]) {\n        right = mid - 1;\n    } else {\n        left = mid + 1;\n    }\n}\nreturn ?;\n```\n\n根据要求的值的位置，先确定比较符号，再确定返回值，\n比较符号：左<=，右<\n返回值：左right，右left\n\n### 2.1 查找最后一个小于key的元素\n\n```java\n//1 查找最后一个小于key的元素\nint findLastLess(int arr[], int len, int key) {\n    int left = 0;\n    int right = len - 1;\n    int mid;\n\n    while (left <= right) {\n        mid = left + (right - left) / 2;\n        if (key <= arr[mid]) {  // <=  意为左\n            right = mid - 1;\n        } else {\n            left = mid + 1;\n        }\n    }\n    return right;     //返回左边值right\n}\n```\n\n### 2.2 查找第一个大于等于key的元素\n\n```java\n//2 查找第一个大于等于key的元素\nint findLastLess(int arr[], int len, int key) {\n    int left = 0;\n    int right = len - 1;\n    int mid;\n\n    while (left <= right) {\n        mid = left + (right - left) / 2;\n        if (key <= arr[mid]) {  // <=  意为左\n            right = mid - 1;\n        } else {\n            left = mid + 1;\n        }\n    }\n    return left;     //返回右边值left\n}\n```\n\n### 2.3 查找最后一个小于等于key的元素\n \n```java\n//3 查找第一个大于等于key的元素\nint findLastLess(int arr[], int len, int key) {\n    int left = 0;\n    int right = len - 1;\n    int mid;\n\n    while (left <= right) {\n        mid = left + (right - left) / 2;\n        if (key < arr[mid]) {  // <=  意为右\n            right = mid - 1;\n        } else {\n            left = mid + 1;\n        }\n    }\n    return right;     //返回左边值right\n}\n```\n\n### 2.4 查找第一个大于key的元素\n\n```java\n//4 查找第一个大于key的元素\nint findLastLess(int arr[], int len, int key) {\n    int left = 0;\n    int right = len - 1;\n    int mid;\n\n    while (left <= right) {\n        mid = left + (right - left) / 2;\n        if (key < arr[mid]) {  // <=  意为右\n            right = mid - 1;\n        } else {\n            left = mid + 1;\n        }\n    }\n    return left;     //返回右边值left\n}\n```\n\n### 2.5 查找第一个与key相等的元素\n\n```java\n//5 查找第一个与key相等的元素\nint findFirstEqual(int arr[], int len, int key) {\n    int left = 0;\n    int right = len - 1;\n    int mid;\n\n    while (left <= right) {\n        mid = left + (right - left) / 2;\n        if (key <= arr[mid]) {  // <=  意为左\n            right = mid - 1;\n        } else {\n            left = mid + 1;\n        }\n    }\n    //right是最后一个小于key的\n    //left是第一个大于等于key的\n    if (left < len && arr[left] == key) {\n        return left;\n    }\n    return -1;\n}\n```\n\n### 2.6 查找最后一个与key相等的元素\n \n```java\n//6 查找最后一个与key相等的元素\nint findLastEqual(int arr[], int len, int key) {\n    int left = 0;\n    int right = len - 1;\n    int mid;\n\n    while (left <= right) {\n        mid = left + (right - left) / 2;\n        if (key < arr[mid]) {  // <  意为右\n            right = mid - 1;\n        } else {\n            left = mid + 1;\n        }\n    }\n    //right是最后一个小于key的\n    //left是第一个大于等于key的\n    if (right >= 0 && arr[right] == key) {\n        return right;\n    }\n    return -1;\n}\n```\n\n## 参考资料\n\n[你真的会写二分查找吗？-搏风雨][2]\n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/algorithm/binSearch.png\n  [2]: https://www.cnblogs.com/bofengyu/p/6761389.html\n","slug":"二分查找","published":1,"updated":"2018-03-08T07:47:08.816Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfvu004ehwvfhu3z9zcf","content":"<p>二分查找法是对一组有序的数字中进行查找，传递相应的数据，进行比较查找到与原数据相同的数据，查找到了返回对应的数组下标，没有找到返回-1；<br><a id=\"more\"></a></p>\n<h2 id=\"1、基本二分查找实现\"><a href=\"#1、基本二分查找实现\" class=\"headerlink\" title=\"1、基本二分查找实现\"></a>1、基本二分查找实现</h2><ol>\n<li><p>while循环</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 循环实现</div><div class=\"line\"> * <span class=\"doctag\">@param</span> array 已排序数组</div><div class=\"line\"> * <span class=\"doctag\">@param</span> target 目标</div><div class=\"line\"> * <span class=\"doctag\">@return</span> 找不到返回-1，找到返回下标</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">binarySearch</span><span class=\"params\">(<span class=\"keyword\">int</span>[] array, <span class=\"keyword\">int</span> target)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> low = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> high = array.length - <span class=\"number\">1</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span> (low &lt;= high) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> mid = low + (high - low) / <span class=\"number\">2</span>; <span class=\"comment\">//注意此处写法，避免越界</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (array[mid] &gt; target) &#123;</div><div class=\"line\">            high = mid - <span class=\"number\">1</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (array[mid] &lt; target) &#123;</div><div class=\"line\">            low = mid + <span class=\"number\">1</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> mid;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>递归实现</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">binarySearch</span><span class=\"params\">(<span class=\"keyword\">int</span>[] array, <span class=\"keyword\">int</span> target, <span class=\"keyword\">int</span> low, <span class=\"keyword\">int</span> high)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> mid = low + (high - low) / <span class=\"number\">2</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span> (array[mid] == target) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> mid;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">if</span> (low &gt;= high) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (target &gt; array[mid]) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> binarySearch(array, target, mid + <span class=\"number\">1</span>, high);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (target &lt; array[mid]) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> binarySearch(array, target, low, mid - <span class=\"number\">1</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"2、变形\"><a href=\"#2、变形\" class=\"headerlink\" title=\"2、变形\"></a>2、变形</h2><p>随着二分查找的进行，如果找到key并不结束循环的话，最终的结束状态会是right &lt; left，并且right + 1 = left。</p>\n<ul>\n<li>当数组中存在key时，根据二分区间选择的不同，这里又分为两种情况，如下图（key为2时）</li>\n<li>当数组中不存在key时，最后仅有一种情况，即把图中的红色框框去掉。</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/algorithm/binSearch.png\" alt=\"此处输入图片的描述\"></p>\n<p>那么，可以找到：</p>\n<ol>\n<li>最后一个小于key的元素 1       左right</li>\n<li>第一个大于等于key的元素 2     左left</li>\n<li>最后一个小于等于key的元素 2   右right</li>\n<li>第一个大于key的元素 5         右left</li>\n</ol>\n<p>另外，如果存在多个key时，稍加判断，就可以找到</p>\n<ol>\n<li>第一个与key相等的元素</li>\n<li>最后一个与key相等的元素</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">while</span> (left &lt;= right) &#123;</div><div class=\"line\">    mid = (left + right) / <span class=\"number\">2</span>;</div><div class=\"line\">    <span class=\"keyword\">if</span> (key ? arr[mid]) &#123;</div><div class=\"line\">        right = mid - <span class=\"number\">1</span>;</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        left = mid + <span class=\"number\">1</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">return</span> ?;</div></pre></td></tr></table></figure>\n<p>根据要求的值的位置，先确定比较符号，再确定返回值，<br>比较符号：左&lt;=，右&lt;<br>返回值：左right，右left</p>\n<h3 id=\"2-1-查找最后一个小于key的元素\"><a href=\"#2-1-查找最后一个小于key的元素\" class=\"headerlink\" title=\"2.1 查找最后一个小于key的元素\"></a>2.1 查找最后一个小于key的元素</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//1 查找最后一个小于key的元素</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findLastLess</span><span class=\"params\">(<span class=\"keyword\">int</span> arr[], <span class=\"keyword\">int</span> len, <span class=\"keyword\">int</span> key)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> left = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> right = len - <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> mid;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span> (left &lt;= right) &#123;</div><div class=\"line\">        mid = left + (right - left) / <span class=\"number\">2</span>;</div><div class=\"line\">        <span class=\"keyword\">if</span> (key &lt;= arr[mid]) &#123;  <span class=\"comment\">// &lt;=  意为左</span></div><div class=\"line\">            right = mid - <span class=\"number\">1</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            left = mid + <span class=\"number\">1</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> right;     <span class=\"comment\">//返回左边值right</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"2-2-查找第一个大于等于key的元素\"><a href=\"#2-2-查找第一个大于等于key的元素\" class=\"headerlink\" title=\"2.2 查找第一个大于等于key的元素\"></a>2.2 查找第一个大于等于key的元素</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//2 查找第一个大于等于key的元素</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findLastLess</span><span class=\"params\">(<span class=\"keyword\">int</span> arr[], <span class=\"keyword\">int</span> len, <span class=\"keyword\">int</span> key)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> left = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> right = len - <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> mid;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span> (left &lt;= right) &#123;</div><div class=\"line\">        mid = left + (right - left) / <span class=\"number\">2</span>;</div><div class=\"line\">        <span class=\"keyword\">if</span> (key &lt;= arr[mid]) &#123;  <span class=\"comment\">// &lt;=  意为左</span></div><div class=\"line\">            right = mid - <span class=\"number\">1</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            left = mid + <span class=\"number\">1</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> left;     <span class=\"comment\">//返回右边值left</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"2-3-查找最后一个小于等于key的元素\"><a href=\"#2-3-查找最后一个小于等于key的元素\" class=\"headerlink\" title=\"2.3 查找最后一个小于等于key的元素\"></a>2.3 查找最后一个小于等于key的元素</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//3 查找第一个大于等于key的元素</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findLastLess</span><span class=\"params\">(<span class=\"keyword\">int</span> arr[], <span class=\"keyword\">int</span> len, <span class=\"keyword\">int</span> key)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> left = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> right = len - <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> mid;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span> (left &lt;= right) &#123;</div><div class=\"line\">        mid = left + (right - left) / <span class=\"number\">2</span>;</div><div class=\"line\">        <span class=\"keyword\">if</span> (key &lt; arr[mid]) &#123;  <span class=\"comment\">// &lt;=  意为右</span></div><div class=\"line\">            right = mid - <span class=\"number\">1</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            left = mid + <span class=\"number\">1</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> right;     <span class=\"comment\">//返回左边值right</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"2-4-查找第一个大于key的元素\"><a href=\"#2-4-查找第一个大于key的元素\" class=\"headerlink\" title=\"2.4 查找第一个大于key的元素\"></a>2.4 查找第一个大于key的元素</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//4 查找第一个大于key的元素</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findLastLess</span><span class=\"params\">(<span class=\"keyword\">int</span> arr[], <span class=\"keyword\">int</span> len, <span class=\"keyword\">int</span> key)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> left = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> right = len - <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> mid;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span> (left &lt;= right) &#123;</div><div class=\"line\">        mid = left + (right - left) / <span class=\"number\">2</span>;</div><div class=\"line\">        <span class=\"keyword\">if</span> (key &lt; arr[mid]) &#123;  <span class=\"comment\">// &lt;=  意为右</span></div><div class=\"line\">            right = mid - <span class=\"number\">1</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            left = mid + <span class=\"number\">1</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> left;     <span class=\"comment\">//返回右边值left</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"2-5-查找第一个与key相等的元素\"><a href=\"#2-5-查找第一个与key相等的元素\" class=\"headerlink\" title=\"2.5 查找第一个与key相等的元素\"></a>2.5 查找第一个与key相等的元素</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//5 查找第一个与key相等的元素</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findFirstEqual</span><span class=\"params\">(<span class=\"keyword\">int</span> arr[], <span class=\"keyword\">int</span> len, <span class=\"keyword\">int</span> key)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> left = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> right = len - <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> mid;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span> (left &lt;= right) &#123;</div><div class=\"line\">        mid = left + (right - left) / <span class=\"number\">2</span>;</div><div class=\"line\">        <span class=\"keyword\">if</span> (key &lt;= arr[mid]) &#123;  <span class=\"comment\">// &lt;=  意为左</span></div><div class=\"line\">            right = mid - <span class=\"number\">1</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            left = mid + <span class=\"number\">1</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">//right是最后一个小于key的</span></div><div class=\"line\">    <span class=\"comment\">//left是第一个大于等于key的</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (left &lt; len &amp;&amp; arr[left] == key) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> left;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"2-6-查找最后一个与key相等的元素\"><a href=\"#2-6-查找最后一个与key相等的元素\" class=\"headerlink\" title=\"2.6 查找最后一个与key相等的元素\"></a>2.6 查找最后一个与key相等的元素</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//6 查找最后一个与key相等的元素</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findLastEqual</span><span class=\"params\">(<span class=\"keyword\">int</span> arr[], <span class=\"keyword\">int</span> len, <span class=\"keyword\">int</span> key)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> left = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> right = len - <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> mid;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span> (left &lt;= right) &#123;</div><div class=\"line\">        mid = left + (right - left) / <span class=\"number\">2</span>;</div><div class=\"line\">        <span class=\"keyword\">if</span> (key &lt; arr[mid]) &#123;  <span class=\"comment\">// &lt;  意为右</span></div><div class=\"line\">            right = mid - <span class=\"number\">1</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            left = mid + <span class=\"number\">1</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">//right是最后一个小于key的</span></div><div class=\"line\">    <span class=\"comment\">//left是第一个大于等于key的</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (right &gt;= <span class=\"number\">0</span> &amp;&amp; arr[right] == key) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> right;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><p><a href=\"https://www.cnblogs.com/bofengyu/p/6761389.html\" target=\"_blank\" rel=\"noopener\">你真的会写二分查找吗？-搏风雨</a></p>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>二分查找法是对一组有序的数字中进行查找，传递相应的数据，进行比较查找到与原数据相同的数据，查找到了返回对应的数组下标，没有找到返回-1；<br>","more":"</p>\n<h2 id=\"1、基本二分查找实现\"><a href=\"#1、基本二分查找实现\" class=\"headerlink\" title=\"1、基本二分查找实现\"></a>1、基本二分查找实现</h2><ol>\n<li><p>while循环</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 循环实现</div><div class=\"line\"> * <span class=\"doctag\">@param</span> array 已排序数组</div><div class=\"line\"> * <span class=\"doctag\">@param</span> target 目标</div><div class=\"line\"> * <span class=\"doctag\">@return</span> 找不到返回-1，找到返回下标</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">binarySearch</span><span class=\"params\">(<span class=\"keyword\">int</span>[] array, <span class=\"keyword\">int</span> target)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> low = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> high = array.length - <span class=\"number\">1</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span> (low &lt;= high) &#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> mid = low + (high - low) / <span class=\"number\">2</span>; <span class=\"comment\">//注意此处写法，避免越界</span></div><div class=\"line\">        <span class=\"keyword\">if</span> (array[mid] &gt; target) &#123;</div><div class=\"line\">            high = mid - <span class=\"number\">1</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (array[mid] &lt; target) &#123;</div><div class=\"line\">            low = mid + <span class=\"number\">1</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            <span class=\"keyword\">return</span> mid;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n<li><p>递归实现</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> <span class=\"title\">binarySearch</span><span class=\"params\">(<span class=\"keyword\">int</span>[] array, <span class=\"keyword\">int</span> target, <span class=\"keyword\">int</span> low, <span class=\"keyword\">int</span> high)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> mid = low + (high - low) / <span class=\"number\">2</span>;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">if</span> (array[mid] == target) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> mid;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">if</span> (low &gt;= high) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (target &gt; array[mid]) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> binarySearch(array, target, mid + <span class=\"number\">1</span>, high);</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (target &lt; array[mid]) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> binarySearch(array, target, low, mid - <span class=\"number\">1</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"2、变形\"><a href=\"#2、变形\" class=\"headerlink\" title=\"2、变形\"></a>2、变形</h2><p>随着二分查找的进行，如果找到key并不结束循环的话，最终的结束状态会是right &lt; left，并且right + 1 = left。</p>\n<ul>\n<li>当数组中存在key时，根据二分区间选择的不同，这里又分为两种情况，如下图（key为2时）</li>\n<li>当数组中不存在key时，最后仅有一种情况，即把图中的红色框框去掉。</li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/algorithm/binSearch.png\" alt=\"此处输入图片的描述\"></p>\n<p>那么，可以找到：</p>\n<ol>\n<li>最后一个小于key的元素 1       左right</li>\n<li>第一个大于等于key的元素 2     左left</li>\n<li>最后一个小于等于key的元素 2   右right</li>\n<li>第一个大于key的元素 5         右left</li>\n</ol>\n<p>另外，如果存在多个key时，稍加判断，就可以找到</p>\n<ol>\n<li>第一个与key相等的元素</li>\n<li>最后一个与key相等的元素</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">while</span> (left &lt;= right) &#123;</div><div class=\"line\">    mid = (left + right) / <span class=\"number\">2</span>;</div><div class=\"line\">    <span class=\"keyword\">if</span> (key ? arr[mid]) &#123;</div><div class=\"line\">        right = mid - <span class=\"number\">1</span>;</div><div class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">        left = mid + <span class=\"number\">1</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"keyword\">return</span> ?;</div></pre></td></tr></table></figure>\n<p>根据要求的值的位置，先确定比较符号，再确定返回值，<br>比较符号：左&lt;=，右&lt;<br>返回值：左right，右left</p>\n<h3 id=\"2-1-查找最后一个小于key的元素\"><a href=\"#2-1-查找最后一个小于key的元素\" class=\"headerlink\" title=\"2.1 查找最后一个小于key的元素\"></a>2.1 查找最后一个小于key的元素</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//1 查找最后一个小于key的元素</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findLastLess</span><span class=\"params\">(<span class=\"keyword\">int</span> arr[], <span class=\"keyword\">int</span> len, <span class=\"keyword\">int</span> key)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> left = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> right = len - <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> mid;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span> (left &lt;= right) &#123;</div><div class=\"line\">        mid = left + (right - left) / <span class=\"number\">2</span>;</div><div class=\"line\">        <span class=\"keyword\">if</span> (key &lt;= arr[mid]) &#123;  <span class=\"comment\">// &lt;=  意为左</span></div><div class=\"line\">            right = mid - <span class=\"number\">1</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            left = mid + <span class=\"number\">1</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> right;     <span class=\"comment\">//返回左边值right</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"2-2-查找第一个大于等于key的元素\"><a href=\"#2-2-查找第一个大于等于key的元素\" class=\"headerlink\" title=\"2.2 查找第一个大于等于key的元素\"></a>2.2 查找第一个大于等于key的元素</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//2 查找第一个大于等于key的元素</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findLastLess</span><span class=\"params\">(<span class=\"keyword\">int</span> arr[], <span class=\"keyword\">int</span> len, <span class=\"keyword\">int</span> key)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> left = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> right = len - <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> mid;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span> (left &lt;= right) &#123;</div><div class=\"line\">        mid = left + (right - left) / <span class=\"number\">2</span>;</div><div class=\"line\">        <span class=\"keyword\">if</span> (key &lt;= arr[mid]) &#123;  <span class=\"comment\">// &lt;=  意为左</span></div><div class=\"line\">            right = mid - <span class=\"number\">1</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            left = mid + <span class=\"number\">1</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> left;     <span class=\"comment\">//返回右边值left</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"2-3-查找最后一个小于等于key的元素\"><a href=\"#2-3-查找最后一个小于等于key的元素\" class=\"headerlink\" title=\"2.3 查找最后一个小于等于key的元素\"></a>2.3 查找最后一个小于等于key的元素</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//3 查找第一个大于等于key的元素</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findLastLess</span><span class=\"params\">(<span class=\"keyword\">int</span> arr[], <span class=\"keyword\">int</span> len, <span class=\"keyword\">int</span> key)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> left = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> right = len - <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> mid;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span> (left &lt;= right) &#123;</div><div class=\"line\">        mid = left + (right - left) / <span class=\"number\">2</span>;</div><div class=\"line\">        <span class=\"keyword\">if</span> (key &lt; arr[mid]) &#123;  <span class=\"comment\">// &lt;=  意为右</span></div><div class=\"line\">            right = mid - <span class=\"number\">1</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            left = mid + <span class=\"number\">1</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> right;     <span class=\"comment\">//返回左边值right</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"2-4-查找第一个大于key的元素\"><a href=\"#2-4-查找第一个大于key的元素\" class=\"headerlink\" title=\"2.4 查找第一个大于key的元素\"></a>2.4 查找第一个大于key的元素</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//4 查找第一个大于key的元素</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findLastLess</span><span class=\"params\">(<span class=\"keyword\">int</span> arr[], <span class=\"keyword\">int</span> len, <span class=\"keyword\">int</span> key)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> left = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> right = len - <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> mid;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span> (left &lt;= right) &#123;</div><div class=\"line\">        mid = left + (right - left) / <span class=\"number\">2</span>;</div><div class=\"line\">        <span class=\"keyword\">if</span> (key &lt; arr[mid]) &#123;  <span class=\"comment\">// &lt;=  意为右</span></div><div class=\"line\">            right = mid - <span class=\"number\">1</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            left = mid + <span class=\"number\">1</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> left;     <span class=\"comment\">//返回右边值left</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"2-5-查找第一个与key相等的元素\"><a href=\"#2-5-查找第一个与key相等的元素\" class=\"headerlink\" title=\"2.5 查找第一个与key相等的元素\"></a>2.5 查找第一个与key相等的元素</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//5 查找第一个与key相等的元素</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findFirstEqual</span><span class=\"params\">(<span class=\"keyword\">int</span> arr[], <span class=\"keyword\">int</span> len, <span class=\"keyword\">int</span> key)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> left = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> right = len - <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> mid;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span> (left &lt;= right) &#123;</div><div class=\"line\">        mid = left + (right - left) / <span class=\"number\">2</span>;</div><div class=\"line\">        <span class=\"keyword\">if</span> (key &lt;= arr[mid]) &#123;  <span class=\"comment\">// &lt;=  意为左</span></div><div class=\"line\">            right = mid - <span class=\"number\">1</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            left = mid + <span class=\"number\">1</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">//right是最后一个小于key的</span></div><div class=\"line\">    <span class=\"comment\">//left是第一个大于等于key的</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (left &lt; len &amp;&amp; arr[left] == key) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> left;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"2-6-查找最后一个与key相等的元素\"><a href=\"#2-6-查找最后一个与key相等的元素\" class=\"headerlink\" title=\"2.6 查找最后一个与key相等的元素\"></a>2.6 查找最后一个与key相等的元素</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//6 查找最后一个与key相等的元素</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">findLastEqual</span><span class=\"params\">(<span class=\"keyword\">int</span> arr[], <span class=\"keyword\">int</span> len, <span class=\"keyword\">int</span> key)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> left = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> right = len - <span class=\"number\">1</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> mid;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">while</span> (left &lt;= right) &#123;</div><div class=\"line\">        mid = left + (right - left) / <span class=\"number\">2</span>;</div><div class=\"line\">        <span class=\"keyword\">if</span> (key &lt; arr[mid]) &#123;  <span class=\"comment\">// &lt;  意为右</span></div><div class=\"line\">            right = mid - <span class=\"number\">1</span>;</div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</div><div class=\"line\">            left = mid + <span class=\"number\">1</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"comment\">//right是最后一个小于key的</span></div><div class=\"line\">    <span class=\"comment\">//left是第一个大于等于key的</span></div><div class=\"line\">    <span class=\"keyword\">if</span> (right &gt;= <span class=\"number\">0</span> &amp;&amp; arr[right] == key) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> right;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><p><a href=\"https://www.cnblogs.com/bofengyu/p/6761389.html\" target=\"_blank\" rel=\"noopener\">你真的会写二分查找吗？-搏风雨</a></p>"},{"title":"多线程","date":"2017-09-30T01:22:54.000Z","_content":"\n本文简单介绍了多线程的基本概念、基于Thread和Runnable实现多线程编程及简单的线程安全问题示例。\n<!--more-->\n\n# 1 概述\n\n## 1.1 进程与线程\n\n - 进程是正在执行的程序    JVM是一个进程.\n - 线程进程中用于控制程序执行的控制单元(执行路径)\n - 进程中至少有一个线程,对于JVM,启动时至少有两个线程:JVM的主线程和JVM的垃圾回收线程\n\n## 1.2 并行与并发\n\n - 并行就是两个任务同时运行，就是甲任务进行的同时，乙任务也在进行。(需要多核CPU)\n - 并发是指两个任务都请求运行，而处理器只能按受一个任务，就把这两个任务安排轮流进行，由于时间间隔较短，使人感觉两个任务都在运行。\n\n## 1.3 基本实现方式\n\n### 1.3.1 继承Thread类覆盖run方法\n\n```java\npackage com.topvision.thread;\n\npublic class ThreadDemo1 {\n\tpublic static void main(String[] args) {\n\t\tDemo1 d1 = new Demo1();\n\t\td1.start();\n\t\tfor (int i = 0; i < 60; i++) {\n\t\t\tSystem.out.println(Thread.currentThread().getName() + i);\n\t\t}\n\t}\n}\n\nclass Demo1 extends Thread {\n\t@Override\n\tpublic void run() {\n\t\tfor (int i = 0; i < 10; i++) {\n\t\t\tSystem.out.println(Thread.currentThread().getName() + i);\n\t\t}\n\t}\n}\n```\n\n### 1.3.2 实现Runnable接口实现run方法\n\n```java\npublic class ThreadDemo1 {\n\tpublic static void main(String[] args) {\n\t\tThread d2 = new Thread(new Demo2());\n\t\td2.start();\n\t\tfor (int i = 0; i < 60; i++) {\n\t\t\tSystem.out.println(Thread.currentThread().getName() + i);\n\t\t}\n\t}\n}\nclass Demo2 implements Runnable {\n\n\t@Override\n\tpublic void run() {\n\t\tfor (int i = 0; i < 10; i++) {\n\t\t\tSystem.out.println(Thread.currentThread().getName() + i);\n\t\t}\n\t}\n}\n```\n\n## 1.4 继承Thread与实现Runnable的区别\n\n - 查看源码的区别:\n\t* a.继承Thread : 由于子类重写了Thread类的run(), 当调用start()时, 直接找子类的run()方法\n\t* b.实现Runnable : 构造函数中传入了Runnable的引用, 成员变量记住了它, start()调用run()方法时内部判断成员变量Runnable的引用是否为空, 不为空编译时看的是Runnable的run(),运行时执行的是子类的run()方法\n - 继承Thread\n\t* 好处是:可以直接使用Thread类中的方法,代码简单\n\t* 弊端是:如果已经有了父类,就不能用这种方法\n - 实现Runnable接口\n\t* 好处是:即使自己定义的线程类有了父类也没关系,因为有了父类也可以实现接口,而且接口是可以多实现的\n\t* 弊端是:不能直接使用Thread中的方法需要先获取到线程对象后,才能得到Thread的方法,代码复杂\n\n# 2 基本API\n\n与人有生老病死一样，线程也同样要经历开始（等待）、运行、挂起和停止四种不同的状态。这四种状态都可以通过Thread类中的方法进行控制。下面给出了Thread类中和这四种状态相关的方法。\n\n 1. 开始线程\n \n    publicvoid start( );\n    publicvoid run( );\n\n 2. 挂起和唤醒线程\n \n    publicvoid resume( );     // 不建议使用\n    publicvoid suspend( );    // 不建议使用\n    publicstaticvoid sleep(long millis);\n    publicstaticvoid sleep(long millis, int nanos);\n\n 3. 终止线程\n \n    publicvoid stop( );       // 不建议使用\n    publicvoid interrupt( );\n\n 4. 得到线程状态\n \n    publicboolean isAlive( );\n    publicboolean isInterrupted( );\n    publicstaticboolean interrupted( );\n\n 5. join方法\n \n    publicvoid join( ) throws InterruptedException;\n\n线程在建立后并不马上执行run方法中的代码，而是处于等待状态。线程处于等待状态时，可以通过Thread类的方法来设置线程不各种属性，如线程的优先级（setPriority）、线程名(setName)和线程的类型（setDaemon）等。\n\n当调用start方法后，线程开始执行run方法中的代码。线程进入运行状态。可以通过Thread类的isAlive方法来判断线程是否处于运行状态。当线程处于运行状态时，isAlive返回true，当isAlive返回false时，可能线程处于等待状态，也可能处于停止状态。\n\n一但线程开始执行run方法，就会一直到这个run方法执行完成这个线程才退出。但在线程执行的过程中，可以通过两个方法使线程暂时停止执行。这两个方法是suspend和sleep。在使用suspend挂起线程后，可以通过resume方法唤醒线程。而使用sleep使线程休眠后，只能在设定的时间后使线程处于就绪状态（在线程休眠结束后，线程不一定会马上执行，只是进入了就绪状态，等待着系统进行调度）。\n\n## 2.1 设置及获取线程名字\n\n 1. 构造方法中传入名字 new Thread(\"张三\"){}\n 2. 线程对象设置名字  thread.setName()\n 3. 线程对象获取名字  thread.getName()  Thread.currentThread().hetName()\n\n## 2.2 休眠线程Sleep\n\n1. sleep方法有两个重载形式，其中一个重载形式不仅可以设毫秒，而且还可以设纳秒(1,000,000纳秒等于1毫秒)。但大多数操作系统平台上的Java虚拟机都无法精确到纳秒，因此，如果对sleep设置了纳秒，Java虚拟机将取最接近这个值的毫秒。\n\n2. 在使用sleep方法时必须使用throws或try{…}catch{…}。因为run方法无法使用throws，所以只能使用try{…}catch{…}。当在线程休眠的过程中，使用interrupt方法中断线程时sleep会抛出一个InterruptedException异常。sleep方法的定义如下：\n\n        publicstaticvoid sleep(long millis) throws InterruptedException\n        publicstaticvoid sleep(long millis, int nanos) throws InterruptedException\n        \n## 2.3 守护线程Daemon\n\n**setDaemon(), 设置一个线程为守护线程, 该线程不会单独执行, 当其他非守护线程都执行结束后, 自动退出\t**\n\n```java\npublic class ThreadDemo4 {\n\t/**\n\t * @param args\n\t * 守护线程\n\t */\n\tpublic static void main(String[] args) {\n\t\tThread t1 = new Thread() {\n\t\t\tpublic void run() {\n\t\t\t\tfor (int i = 0; i < 10; i++) {\n\t\t\t\t\tSystem.out.println(getName() + \"...aaaaaaaaaaaaaaaaaaaa\");\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tThread t2 = new Thread() {\n\t\t\tpublic void run() {\n\t\t\t\tfor (int i = 0; i < 5000; i++) {\n\t\t\t\t\tSystem.out.println(getName() + \"...bb\" + i);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tt2.setDaemon(true); // 设置为守护线程\n\n\t\tt1.start();\n\t\tt2.start();\n\t}\n}\n```\n\n## 2.4 加入线程Join\n\njoin方法的功能就是使异步执行的线程变成同步执行。也就是说，当调用线程实例的start方法后，这个方法会立即返回，如果在调用start方法后后需要使用一个由这个线程计算得到的值，就必须使用join方法。如果不使用join方法，就不能保证当执行到start方法后面的某条语句时，这个线程一定会执行完。而使用join方法后，直到这个线程退出，程序才会往下执行。下面的代码演示了join的用法。\n\n## 2.5 礼让线程Yield\n\nThread.yield()方法作用是：暂停当前正在执行的线程对象，并执行其他线程。\nyield()应该做的是让当前运行线程回到可运行状态，以允许具有相同优先级的其他线程获得运行机会。因此，使用yield()的目的是让相同优先级的线程之间能适当的轮转执行。但是，实际中无法保证yield()达到让步目的，因为让步的线程还有可能被线程调度程序再次选中。\n \n结论：yield()从未导致线程转到等待/睡眠/阻塞状态。在大多数情况下，yield()将导致线程从运行状态转到可运行状态，但有可能没有效果。\n\n## 2.6 设置线程优先级Priority\n\nsetPriority不一定起作用的，在不同的操作系统不同的jvm上，效果也可能不同。现在很多jvm的线程的实现都使用的操作系统线程，设置优先级也是使用的操作系统优先级，java层面有10个优先级别，假设操作系统只有3个优先级别，那么jvm可能将1-4级映射到操作系统的1级，5-7级映射到操作系统的2级，剩下的映射到3级，这样的话，在java层面，将优先级设置为5,6,7，其实本质就是一样的了。\n\n另外，操作系统也不能保证设置了优先级的线程就一定会先运行或得到更多的CPU时间。\n在实际使用中，不建议使用该方法\n\n# 3 同步\n\n* 当多线程并发, 有多段代码同时执行时, 我们希望某一段代码执行的过程中CPU不要切换到其他线程工作. 这时就需要同步.\n* 如果两段代码是同步的, 那么同一时间只能执行一段, 在一段代码没执行结束之前, 不会执行另外一段代码.\n\n## 3.1 同步代码块\n\n* 使用synchronized关键字加上一个锁对象来定义一段代码, 这就叫同步代码块\n* 多个同步代码块如果使用相同的锁对象, 那么他们就是同步的\n\n```java\npublic class ThreadDemo6 {\n\tpublic static void main(String[] args) {\n\t\tPrint p = new Print();\n\t\tnew Thread(){\n\t\t\tpublic void run() {\n\t\t\t\twhile (true) {\n\t\t\t\t\tp.print1();\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\t\t\n\t\tnew Thread(){\n\t\t\tpublic void run() {\n\t\t\t\twhile (true) {\n\t\t\t\t\tp.print2();\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\t}\n}\n\nclass Print {\n\n\tpublic void print1() {\n\t\tsynchronized (ThreadDemo6.class) {\n\t\t\ttry {\n\t\t\t\tThread.sleep(1000);\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t\tSystem.out.println(\"鼎\");\n\t\t\tSystem.out.println(\"点\");\n\t\t\tSystem.out.println(\"视\");\n\t\t\tSystem.out.println(\"讯\");\n\t\t}\n\t}\n\n\tpublic void print2() {\n\t\tsynchronized (ThreadDemo6.class) {\n\t\t\ttry {\n\t\t\t\tThread.sleep(1000);\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t\tSystem.out.println(\"T\");\n\t\t\tSystem.out.println(\"O\");\n\t\t\tSystem.out.println(\"P\");\n\t\t\tSystem.out.println(\"V\");\n\t\t\tSystem.out.println(\"I\");\n\t\t\tSystem.out.println(\"S\");\n\t\t\tSystem.out.println(\"I\");\n\t\t\tSystem.out.println(\"O\");\n\t\t\tSystem.out.println(\"N\");\n\t\t}\n\t}\n}\n```\n\n## 3.2 同步方法\n\n* 使用synchronized关键字修饰一个方法, 该方法中所有的代码都是同步的\n* 注意锁对象\n\n```java\n//同步方法，锁对象是this\npublic synchronized void print1() {\n\tSystem.out.println(\"鼎\");\n\tSystem.out.println(\"点\");\n\tSystem.out.println(\"视\");\n\tSystem.out.println(\"讯\");\n}\n```\n\n```java\n//静态同步方法，锁对象是字节码文件\npublic static synchronized void print1() {\n\tSystem.out.println(\"鼎\");\n\tSystem.out.println(\"点\");\n\tSystem.out.println(\"视\");\n\tSystem.out.println(\"讯\");\n}\n```\n\n## 3.3 线程安全\n\n* 多线程并发操作同一数据时, 就有可能出现线程安全问题\n* 使用同步技术可以解决这种问题, 把操作数据的代码进行同步, 不要多个线程一起操作。\n\n```java\npackage com.topvision.thread;\n\npublic class ThreadTicket1 {\n\tpublic static void main(String[] args) {\n\t\t/*new Ticket1().start();\n\t\tnew Ticket1().start();\n\t\tnew Ticket1().start();\n\t\tnew Ticket1().start();*/\n\t\tTicket2 t2 = new Ticket2();\n\t\tnew Thread(t2).start();\n\t\tnew Thread(t2).start();\n\t\tnew Thread(t2).start();\n\t\tnew Thread(t2).start();\n\t}\n}\n\nclass Ticket1 extends Thread {\n\tprivate static int ticktets = 100;\n\n\tpublic void run() {\n\t\twhile (true) {\n\t\t\tsynchronized (Ticket1.class) {\n\t\t\t\tif (ticktets <= 0) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tSystem.out.println(\"这是第\" + ticktets-- + \"张票\");\n\t\t\t}\n\t\t}\n\n\t}\n}\n\nclass Ticket2 implements Runnable {\n\tprivate int ticktets = 100;\n\n\t@Override\n\tpublic void run() {\n\t\t// TODO Auto-generated method stub\n\t\twhile (true) {\n\t\t\tsynchronized (this) {\n\t\t\t\tif (ticktets <= 0) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tSystem.out.println(\"这是第\" + ticktets-- + \"张票\");\n\t\t\t}\n\t\t}\n\t}\n\n}\n```\n\n## 3.4 死锁\n\n两个线程各自拥有对方需要的锁对象，等待对方释放，因此互相等待，程序卡死。\n* 多线程同步的时候, 如果同步代码嵌套, 使用相同锁, 就有可能出现死锁\n* 尽量不要嵌套使用\n\n```java\npackage com.topvision.thread;\n\n\npublic class ThreadDemo8 {\n\t/**\n\t * @param args\n\t */\n\tprivate static String s1 = \"筷子左\";\n\tprivate static String s2 = \"筷子右\";\n\n\tpublic static void main(String[] args) {\n\t\tnew Thread() {\n\t\t\tpublic void run() {\n\t\t\t\twhile (true) {\n\t\t\t\t\tsynchronized (s1) {\n\t\t\t\t\t\tSystem.out.println(getName() + \"...获取\" + s1 + \"等待\" + s2);\n\t\t\t\t\t\tsynchronized (s2) {\n\t\t\t\t\t\t\tSystem.out.println(getName() + \"...拿到\" + s2 + \"开吃\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\n\t\tnew Thread() {\n\t\t\tpublic void run() {\n\t\t\t\twhile (true) {\n\t\t\t\t\tsynchronized (s2) {\n\t\t\t\t\t\tSystem.out.println(getName() + \"...获取\" + s2 + \"等待\" + s1);\n\t\t\t\t\t\tsynchronized (s1) {\n\t\t\t\t\t\t\tSystem.out.println(getName() + \"...拿到\" + s1 + \"开吃\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\t}\n}\n```\n\n\n\n\n\n\n\n\n \n\t\n \n \n","source":"_posts/多线程.md","raw":"---\ntitle: 多线程\ncategories:\n  - JavaSE\ntags:\n  - 多线程 \n  - Java\ndate: 2017-09-30 09:22:54\n---\n\n本文简单介绍了多线程的基本概念、基于Thread和Runnable实现多线程编程及简单的线程安全问题示例。\n<!--more-->\n\n# 1 概述\n\n## 1.1 进程与线程\n\n - 进程是正在执行的程序    JVM是一个进程.\n - 线程进程中用于控制程序执行的控制单元(执行路径)\n - 进程中至少有一个线程,对于JVM,启动时至少有两个线程:JVM的主线程和JVM的垃圾回收线程\n\n## 1.2 并行与并发\n\n - 并行就是两个任务同时运行，就是甲任务进行的同时，乙任务也在进行。(需要多核CPU)\n - 并发是指两个任务都请求运行，而处理器只能按受一个任务，就把这两个任务安排轮流进行，由于时间间隔较短，使人感觉两个任务都在运行。\n\n## 1.3 基本实现方式\n\n### 1.3.1 继承Thread类覆盖run方法\n\n```java\npackage com.topvision.thread;\n\npublic class ThreadDemo1 {\n\tpublic static void main(String[] args) {\n\t\tDemo1 d1 = new Demo1();\n\t\td1.start();\n\t\tfor (int i = 0; i < 60; i++) {\n\t\t\tSystem.out.println(Thread.currentThread().getName() + i);\n\t\t}\n\t}\n}\n\nclass Demo1 extends Thread {\n\t@Override\n\tpublic void run() {\n\t\tfor (int i = 0; i < 10; i++) {\n\t\t\tSystem.out.println(Thread.currentThread().getName() + i);\n\t\t}\n\t}\n}\n```\n\n### 1.3.2 实现Runnable接口实现run方法\n\n```java\npublic class ThreadDemo1 {\n\tpublic static void main(String[] args) {\n\t\tThread d2 = new Thread(new Demo2());\n\t\td2.start();\n\t\tfor (int i = 0; i < 60; i++) {\n\t\t\tSystem.out.println(Thread.currentThread().getName() + i);\n\t\t}\n\t}\n}\nclass Demo2 implements Runnable {\n\n\t@Override\n\tpublic void run() {\n\t\tfor (int i = 0; i < 10; i++) {\n\t\t\tSystem.out.println(Thread.currentThread().getName() + i);\n\t\t}\n\t}\n}\n```\n\n## 1.4 继承Thread与实现Runnable的区别\n\n - 查看源码的区别:\n\t* a.继承Thread : 由于子类重写了Thread类的run(), 当调用start()时, 直接找子类的run()方法\n\t* b.实现Runnable : 构造函数中传入了Runnable的引用, 成员变量记住了它, start()调用run()方法时内部判断成员变量Runnable的引用是否为空, 不为空编译时看的是Runnable的run(),运行时执行的是子类的run()方法\n - 继承Thread\n\t* 好处是:可以直接使用Thread类中的方法,代码简单\n\t* 弊端是:如果已经有了父类,就不能用这种方法\n - 实现Runnable接口\n\t* 好处是:即使自己定义的线程类有了父类也没关系,因为有了父类也可以实现接口,而且接口是可以多实现的\n\t* 弊端是:不能直接使用Thread中的方法需要先获取到线程对象后,才能得到Thread的方法,代码复杂\n\n# 2 基本API\n\n与人有生老病死一样，线程也同样要经历开始（等待）、运行、挂起和停止四种不同的状态。这四种状态都可以通过Thread类中的方法进行控制。下面给出了Thread类中和这四种状态相关的方法。\n\n 1. 开始线程\n \n    publicvoid start( );\n    publicvoid run( );\n\n 2. 挂起和唤醒线程\n \n    publicvoid resume( );     // 不建议使用\n    publicvoid suspend( );    // 不建议使用\n    publicstaticvoid sleep(long millis);\n    publicstaticvoid sleep(long millis, int nanos);\n\n 3. 终止线程\n \n    publicvoid stop( );       // 不建议使用\n    publicvoid interrupt( );\n\n 4. 得到线程状态\n \n    publicboolean isAlive( );\n    publicboolean isInterrupted( );\n    publicstaticboolean interrupted( );\n\n 5. join方法\n \n    publicvoid join( ) throws InterruptedException;\n\n线程在建立后并不马上执行run方法中的代码，而是处于等待状态。线程处于等待状态时，可以通过Thread类的方法来设置线程不各种属性，如线程的优先级（setPriority）、线程名(setName)和线程的类型（setDaemon）等。\n\n当调用start方法后，线程开始执行run方法中的代码。线程进入运行状态。可以通过Thread类的isAlive方法来判断线程是否处于运行状态。当线程处于运行状态时，isAlive返回true，当isAlive返回false时，可能线程处于等待状态，也可能处于停止状态。\n\n一但线程开始执行run方法，就会一直到这个run方法执行完成这个线程才退出。但在线程执行的过程中，可以通过两个方法使线程暂时停止执行。这两个方法是suspend和sleep。在使用suspend挂起线程后，可以通过resume方法唤醒线程。而使用sleep使线程休眠后，只能在设定的时间后使线程处于就绪状态（在线程休眠结束后，线程不一定会马上执行，只是进入了就绪状态，等待着系统进行调度）。\n\n## 2.1 设置及获取线程名字\n\n 1. 构造方法中传入名字 new Thread(\"张三\"){}\n 2. 线程对象设置名字  thread.setName()\n 3. 线程对象获取名字  thread.getName()  Thread.currentThread().hetName()\n\n## 2.2 休眠线程Sleep\n\n1. sleep方法有两个重载形式，其中一个重载形式不仅可以设毫秒，而且还可以设纳秒(1,000,000纳秒等于1毫秒)。但大多数操作系统平台上的Java虚拟机都无法精确到纳秒，因此，如果对sleep设置了纳秒，Java虚拟机将取最接近这个值的毫秒。\n\n2. 在使用sleep方法时必须使用throws或try{…}catch{…}。因为run方法无法使用throws，所以只能使用try{…}catch{…}。当在线程休眠的过程中，使用interrupt方法中断线程时sleep会抛出一个InterruptedException异常。sleep方法的定义如下：\n\n        publicstaticvoid sleep(long millis) throws InterruptedException\n        publicstaticvoid sleep(long millis, int nanos) throws InterruptedException\n        \n## 2.3 守护线程Daemon\n\n**setDaemon(), 设置一个线程为守护线程, 该线程不会单独执行, 当其他非守护线程都执行结束后, 自动退出\t**\n\n```java\npublic class ThreadDemo4 {\n\t/**\n\t * @param args\n\t * 守护线程\n\t */\n\tpublic static void main(String[] args) {\n\t\tThread t1 = new Thread() {\n\t\t\tpublic void run() {\n\t\t\t\tfor (int i = 0; i < 10; i++) {\n\t\t\t\t\tSystem.out.println(getName() + \"...aaaaaaaaaaaaaaaaaaaa\");\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tThread t2 = new Thread() {\n\t\t\tpublic void run() {\n\t\t\t\tfor (int i = 0; i < 5000; i++) {\n\t\t\t\t\tSystem.out.println(getName() + \"...bb\" + i);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tt2.setDaemon(true); // 设置为守护线程\n\n\t\tt1.start();\n\t\tt2.start();\n\t}\n}\n```\n\n## 2.4 加入线程Join\n\njoin方法的功能就是使异步执行的线程变成同步执行。也就是说，当调用线程实例的start方法后，这个方法会立即返回，如果在调用start方法后后需要使用一个由这个线程计算得到的值，就必须使用join方法。如果不使用join方法，就不能保证当执行到start方法后面的某条语句时，这个线程一定会执行完。而使用join方法后，直到这个线程退出，程序才会往下执行。下面的代码演示了join的用法。\n\n## 2.5 礼让线程Yield\n\nThread.yield()方法作用是：暂停当前正在执行的线程对象，并执行其他线程。\nyield()应该做的是让当前运行线程回到可运行状态，以允许具有相同优先级的其他线程获得运行机会。因此，使用yield()的目的是让相同优先级的线程之间能适当的轮转执行。但是，实际中无法保证yield()达到让步目的，因为让步的线程还有可能被线程调度程序再次选中。\n \n结论：yield()从未导致线程转到等待/睡眠/阻塞状态。在大多数情况下，yield()将导致线程从运行状态转到可运行状态，但有可能没有效果。\n\n## 2.6 设置线程优先级Priority\n\nsetPriority不一定起作用的，在不同的操作系统不同的jvm上，效果也可能不同。现在很多jvm的线程的实现都使用的操作系统线程，设置优先级也是使用的操作系统优先级，java层面有10个优先级别，假设操作系统只有3个优先级别，那么jvm可能将1-4级映射到操作系统的1级，5-7级映射到操作系统的2级，剩下的映射到3级，这样的话，在java层面，将优先级设置为5,6,7，其实本质就是一样的了。\n\n另外，操作系统也不能保证设置了优先级的线程就一定会先运行或得到更多的CPU时间。\n在实际使用中，不建议使用该方法\n\n# 3 同步\n\n* 当多线程并发, 有多段代码同时执行时, 我们希望某一段代码执行的过程中CPU不要切换到其他线程工作. 这时就需要同步.\n* 如果两段代码是同步的, 那么同一时间只能执行一段, 在一段代码没执行结束之前, 不会执行另外一段代码.\n\n## 3.1 同步代码块\n\n* 使用synchronized关键字加上一个锁对象来定义一段代码, 这就叫同步代码块\n* 多个同步代码块如果使用相同的锁对象, 那么他们就是同步的\n\n```java\npublic class ThreadDemo6 {\n\tpublic static void main(String[] args) {\n\t\tPrint p = new Print();\n\t\tnew Thread(){\n\t\t\tpublic void run() {\n\t\t\t\twhile (true) {\n\t\t\t\t\tp.print1();\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\t\t\n\t\tnew Thread(){\n\t\t\tpublic void run() {\n\t\t\t\twhile (true) {\n\t\t\t\t\tp.print2();\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\t}\n}\n\nclass Print {\n\n\tpublic void print1() {\n\t\tsynchronized (ThreadDemo6.class) {\n\t\t\ttry {\n\t\t\t\tThread.sleep(1000);\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t\tSystem.out.println(\"鼎\");\n\t\t\tSystem.out.println(\"点\");\n\t\t\tSystem.out.println(\"视\");\n\t\t\tSystem.out.println(\"讯\");\n\t\t}\n\t}\n\n\tpublic void print2() {\n\t\tsynchronized (ThreadDemo6.class) {\n\t\t\ttry {\n\t\t\t\tThread.sleep(1000);\n\t\t\t} catch (InterruptedException e) {\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t\tSystem.out.println(\"T\");\n\t\t\tSystem.out.println(\"O\");\n\t\t\tSystem.out.println(\"P\");\n\t\t\tSystem.out.println(\"V\");\n\t\t\tSystem.out.println(\"I\");\n\t\t\tSystem.out.println(\"S\");\n\t\t\tSystem.out.println(\"I\");\n\t\t\tSystem.out.println(\"O\");\n\t\t\tSystem.out.println(\"N\");\n\t\t}\n\t}\n}\n```\n\n## 3.2 同步方法\n\n* 使用synchronized关键字修饰一个方法, 该方法中所有的代码都是同步的\n* 注意锁对象\n\n```java\n//同步方法，锁对象是this\npublic synchronized void print1() {\n\tSystem.out.println(\"鼎\");\n\tSystem.out.println(\"点\");\n\tSystem.out.println(\"视\");\n\tSystem.out.println(\"讯\");\n}\n```\n\n```java\n//静态同步方法，锁对象是字节码文件\npublic static synchronized void print1() {\n\tSystem.out.println(\"鼎\");\n\tSystem.out.println(\"点\");\n\tSystem.out.println(\"视\");\n\tSystem.out.println(\"讯\");\n}\n```\n\n## 3.3 线程安全\n\n* 多线程并发操作同一数据时, 就有可能出现线程安全问题\n* 使用同步技术可以解决这种问题, 把操作数据的代码进行同步, 不要多个线程一起操作。\n\n```java\npackage com.topvision.thread;\n\npublic class ThreadTicket1 {\n\tpublic static void main(String[] args) {\n\t\t/*new Ticket1().start();\n\t\tnew Ticket1().start();\n\t\tnew Ticket1().start();\n\t\tnew Ticket1().start();*/\n\t\tTicket2 t2 = new Ticket2();\n\t\tnew Thread(t2).start();\n\t\tnew Thread(t2).start();\n\t\tnew Thread(t2).start();\n\t\tnew Thread(t2).start();\n\t}\n}\n\nclass Ticket1 extends Thread {\n\tprivate static int ticktets = 100;\n\n\tpublic void run() {\n\t\twhile (true) {\n\t\t\tsynchronized (Ticket1.class) {\n\t\t\t\tif (ticktets <= 0) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tSystem.out.println(\"这是第\" + ticktets-- + \"张票\");\n\t\t\t}\n\t\t}\n\n\t}\n}\n\nclass Ticket2 implements Runnable {\n\tprivate int ticktets = 100;\n\n\t@Override\n\tpublic void run() {\n\t\t// TODO Auto-generated method stub\n\t\twhile (true) {\n\t\t\tsynchronized (this) {\n\t\t\t\tif (ticktets <= 0) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tSystem.out.println(\"这是第\" + ticktets-- + \"张票\");\n\t\t\t}\n\t\t}\n\t}\n\n}\n```\n\n## 3.4 死锁\n\n两个线程各自拥有对方需要的锁对象，等待对方释放，因此互相等待，程序卡死。\n* 多线程同步的时候, 如果同步代码嵌套, 使用相同锁, 就有可能出现死锁\n* 尽量不要嵌套使用\n\n```java\npackage com.topvision.thread;\n\n\npublic class ThreadDemo8 {\n\t/**\n\t * @param args\n\t */\n\tprivate static String s1 = \"筷子左\";\n\tprivate static String s2 = \"筷子右\";\n\n\tpublic static void main(String[] args) {\n\t\tnew Thread() {\n\t\t\tpublic void run() {\n\t\t\t\twhile (true) {\n\t\t\t\t\tsynchronized (s1) {\n\t\t\t\t\t\tSystem.out.println(getName() + \"...获取\" + s1 + \"等待\" + s2);\n\t\t\t\t\t\tsynchronized (s2) {\n\t\t\t\t\t\t\tSystem.out.println(getName() + \"...拿到\" + s2 + \"开吃\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\n\t\tnew Thread() {\n\t\t\tpublic void run() {\n\t\t\t\twhile (true) {\n\t\t\t\t\tsynchronized (s2) {\n\t\t\t\t\t\tSystem.out.println(getName() + \"...获取\" + s2 + \"等待\" + s1);\n\t\t\t\t\t\tsynchronized (s1) {\n\t\t\t\t\t\t\tSystem.out.println(getName() + \"...拿到\" + s1 + \"开吃\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}.start();\n\t}\n}\n```\n\n\n\n\n\n\n\n\n \n\t\n \n \n","slug":"多线程","published":1,"updated":"2018-02-27T07:38:38.104Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfvx004ihwvfvm80xzzm","content":"<p>本文简单介绍了多线程的基本概念、基于Thread和Runnable实现多线程编程及简单的线程安全问题示例。<br><a id=\"more\"></a></p>\n<h1 id=\"1-概述\"><a href=\"#1-概述\" class=\"headerlink\" title=\"1 概述\"></a>1 概述</h1><h2 id=\"1-1-进程与线程\"><a href=\"#1-1-进程与线程\" class=\"headerlink\" title=\"1.1 进程与线程\"></a>1.1 进程与线程</h2><ul>\n<li>进程是正在执行的程序    JVM是一个进程.</li>\n<li>线程进程中用于控制程序执行的控制单元(执行路径)</li>\n<li>进程中至少有一个线程,对于JVM,启动时至少有两个线程:JVM的主线程和JVM的垃圾回收线程</li>\n</ul>\n<h2 id=\"1-2-并行与并发\"><a href=\"#1-2-并行与并发\" class=\"headerlink\" title=\"1.2 并行与并发\"></a>1.2 并行与并发</h2><ul>\n<li>并行就是两个任务同时运行，就是甲任务进行的同时，乙任务也在进行。(需要多核CPU)</li>\n<li>并发是指两个任务都请求运行，而处理器只能按受一个任务，就把这两个任务安排轮流进行，由于时间间隔较短，使人感觉两个任务都在运行。</li>\n</ul>\n<h2 id=\"1-3-基本实现方式\"><a href=\"#1-3-基本实现方式\" class=\"headerlink\" title=\"1.3 基本实现方式\"></a>1.3 基本实现方式</h2><h3 id=\"1-3-1-继承Thread类覆盖run方法\"><a href=\"#1-3-1-继承Thread类覆盖run方法\" class=\"headerlink\" title=\"1.3.1 继承Thread类覆盖run方法\"></a>1.3.1 继承Thread类覆盖run方法</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.topvision.thread;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo1</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tDemo1 d1 = <span class=\"keyword\">new</span> Demo1();</div><div class=\"line\">\t\td1.start();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">60</span>; i++) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName() + i);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo1</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;</div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName() + i);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-3-2-实现Runnable接口实现run方法\"><a href=\"#1-3-2-实现Runnable接口实现run方法\" class=\"headerlink\" title=\"1.3.2 实现Runnable接口实现run方法\"></a>1.3.2 实现Runnable接口实现run方法</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo1</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tThread d2 = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Demo2());</div><div class=\"line\">\t\td2.start();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">60</span>; i++) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName() + i);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo2</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName() + i);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"1-4-继承Thread与实现Runnable的区别\"><a href=\"#1-4-继承Thread与实现Runnable的区别\" class=\"headerlink\" title=\"1.4 继承Thread与实现Runnable的区别\"></a>1.4 继承Thread与实现Runnable的区别</h2><ul>\n<li>查看源码的区别:<ul>\n<li>a.继承Thread : 由于子类重写了Thread类的run(), 当调用start()时, 直接找子类的run()方法</li>\n<li>b.实现Runnable : 构造函数中传入了Runnable的引用, 成员变量记住了它, start()调用run()方法时内部判断成员变量Runnable的引用是否为空, 不为空编译时看的是Runnable的run(),运行时执行的是子类的run()方法</li>\n</ul>\n</li>\n<li>继承Thread<ul>\n<li>好处是:可以直接使用Thread类中的方法,代码简单</li>\n<li>弊端是:如果已经有了父类,就不能用这种方法</li>\n</ul>\n</li>\n<li>实现Runnable接口<ul>\n<li>好处是:即使自己定义的线程类有了父类也没关系,因为有了父类也可以实现接口,而且接口是可以多实现的</li>\n<li>弊端是:不能直接使用Thread中的方法需要先获取到线程对象后,才能得到Thread的方法,代码复杂</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"2-基本API\"><a href=\"#2-基本API\" class=\"headerlink\" title=\"2 基本API\"></a>2 基本API</h1><p>与人有生老病死一样，线程也同样要经历开始（等待）、运行、挂起和停止四种不同的状态。这四种状态都可以通过Thread类中的方法进行控制。下面给出了Thread类中和这四种状态相关的方法。</p>\n<ol>\n<li><p>开始线程</p>\n<p>publicvoid start( );<br>publicvoid run( );</p>\n</li>\n<li><p>挂起和唤醒线程</p>\n<p>publicvoid resume( );     // 不建议使用<br>publicvoid suspend( );    // 不建议使用<br>publicstaticvoid sleep(long millis);<br>publicstaticvoid sleep(long millis, int nanos);</p>\n</li>\n<li><p>终止线程</p>\n<p>publicvoid stop( );       // 不建议使用<br>publicvoid interrupt( );</p>\n</li>\n<li><p>得到线程状态</p>\n<p>publicboolean isAlive( );<br>publicboolean isInterrupted( );<br>publicstaticboolean interrupted( );</p>\n</li>\n<li><p>join方法</p>\n<p>publicvoid join( ) throws InterruptedException;</p>\n</li>\n</ol>\n<p>线程在建立后并不马上执行run方法中的代码，而是处于等待状态。线程处于等待状态时，可以通过Thread类的方法来设置线程不各种属性，如线程的优先级（setPriority）、线程名(setName)和线程的类型（setDaemon）等。</p>\n<p>当调用start方法后，线程开始执行run方法中的代码。线程进入运行状态。可以通过Thread类的isAlive方法来判断线程是否处于运行状态。当线程处于运行状态时，isAlive返回true，当isAlive返回false时，可能线程处于等待状态，也可能处于停止状态。</p>\n<p>一但线程开始执行run方法，就会一直到这个run方法执行完成这个线程才退出。但在线程执行的过程中，可以通过两个方法使线程暂时停止执行。这两个方法是suspend和sleep。在使用suspend挂起线程后，可以通过resume方法唤醒线程。而使用sleep使线程休眠后，只能在设定的时间后使线程处于就绪状态（在线程休眠结束后，线程不一定会马上执行，只是进入了就绪状态，等待着系统进行调度）。</p>\n<h2 id=\"2-1-设置及获取线程名字\"><a href=\"#2-1-设置及获取线程名字\" class=\"headerlink\" title=\"2.1 设置及获取线程名字\"></a>2.1 设置及获取线程名字</h2><ol>\n<li>构造方法中传入名字 new Thread(“张三”){}</li>\n<li>线程对象设置名字  thread.setName()</li>\n<li>线程对象获取名字  thread.getName()  Thread.currentThread().hetName()</li>\n</ol>\n<h2 id=\"2-2-休眠线程Sleep\"><a href=\"#2-2-休眠线程Sleep\" class=\"headerlink\" title=\"2.2 休眠线程Sleep\"></a>2.2 休眠线程Sleep</h2><ol>\n<li><p>sleep方法有两个重载形式，其中一个重载形式不仅可以设毫秒，而且还可以设纳秒(1,000,000纳秒等于1毫秒)。但大多数操作系统平台上的Java虚拟机都无法精确到纳秒，因此，如果对sleep设置了纳秒，Java虚拟机将取最接近这个值的毫秒。</p>\n</li>\n<li><p>在使用sleep方法时必须使用throws或try{…}catch{…}。因为run方法无法使用throws，所以只能使用try{…}catch{…}。当在线程休眠的过程中，使用interrupt方法中断线程时sleep会抛出一个InterruptedException异常。sleep方法的定义如下：</p>\n<pre><code>publicstaticvoid sleep(long millis) throws InterruptedException\npublicstaticvoid sleep(long millis, int nanos) throws InterruptedException\n</code></pre></li>\n</ol>\n<h2 id=\"2-3-守护线程Daemon\"><a href=\"#2-3-守护线程Daemon\" class=\"headerlink\" title=\"2.3 守护线程Daemon\"></a>2.3 守护线程Daemon</h2><p><strong>setDaemon(), 设置一个线程为守护线程, 该线程不会单独执行, 当其他非守护线程都执行结束后, 自动退出    </strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo4</span> </span>&#123;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * <span class=\"doctag\">@param</span> args</div><div class=\"line\">\t * 守护线程</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tThread t1 = <span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...aaaaaaaaaaaaaaaaaaaa\"</span>);</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;;</div><div class=\"line\"></div><div class=\"line\">\t\tThread t2 = <span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5000</span>; i++) &#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...bb\"</span> + i);</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;;</div><div class=\"line\"></div><div class=\"line\">\t\tt2.setDaemon(<span class=\"keyword\">true</span>); <span class=\"comment\">// 设置为守护线程</span></div><div class=\"line\"></div><div class=\"line\">\t\tt1.start();</div><div class=\"line\">\t\tt2.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"2-4-加入线程Join\"><a href=\"#2-4-加入线程Join\" class=\"headerlink\" title=\"2.4 加入线程Join\"></a>2.4 加入线程Join</h2><p>join方法的功能就是使异步执行的线程变成同步执行。也就是说，当调用线程实例的start方法后，这个方法会立即返回，如果在调用start方法后后需要使用一个由这个线程计算得到的值，就必须使用join方法。如果不使用join方法，就不能保证当执行到start方法后面的某条语句时，这个线程一定会执行完。而使用join方法后，直到这个线程退出，程序才会往下执行。下面的代码演示了join的用法。</p>\n<h2 id=\"2-5-礼让线程Yield\"><a href=\"#2-5-礼让线程Yield\" class=\"headerlink\" title=\"2.5 礼让线程Yield\"></a>2.5 礼让线程Yield</h2><p>Thread.yield()方法作用是：暂停当前正在执行的线程对象，并执行其他线程。<br>yield()应该做的是让当前运行线程回到可运行状态，以允许具有相同优先级的其他线程获得运行机会。因此，使用yield()的目的是让相同优先级的线程之间能适当的轮转执行。但是，实际中无法保证yield()达到让步目的，因为让步的线程还有可能被线程调度程序再次选中。</p>\n<p>结论：yield()从未导致线程转到等待/睡眠/阻塞状态。在大多数情况下，yield()将导致线程从运行状态转到可运行状态，但有可能没有效果。</p>\n<h2 id=\"2-6-设置线程优先级Priority\"><a href=\"#2-6-设置线程优先级Priority\" class=\"headerlink\" title=\"2.6 设置线程优先级Priority\"></a>2.6 设置线程优先级Priority</h2><p>setPriority不一定起作用的，在不同的操作系统不同的jvm上，效果也可能不同。现在很多jvm的线程的实现都使用的操作系统线程，设置优先级也是使用的操作系统优先级，java层面有10个优先级别，假设操作系统只有3个优先级别，那么jvm可能将1-4级映射到操作系统的1级，5-7级映射到操作系统的2级，剩下的映射到3级，这样的话，在java层面，将优先级设置为5,6,7，其实本质就是一样的了。</p>\n<p>另外，操作系统也不能保证设置了优先级的线程就一定会先运行或得到更多的CPU时间。<br>在实际使用中，不建议使用该方法</p>\n<h1 id=\"3-同步\"><a href=\"#3-同步\" class=\"headerlink\" title=\"3 同步\"></a>3 同步</h1><ul>\n<li>当多线程并发, 有多段代码同时执行时, 我们希望某一段代码执行的过程中CPU不要切换到其他线程工作. 这时就需要同步.</li>\n<li>如果两段代码是同步的, 那么同一时间只能执行一段, 在一段代码没执行结束之前, 不会执行另外一段代码.</li>\n</ul>\n<h2 id=\"3-1-同步代码块\"><a href=\"#3-1-同步代码块\" class=\"headerlink\" title=\"3.1 同步代码块\"></a>3.1 同步代码块</h2><ul>\n<li>使用synchronized关键字加上一个锁对象来定义一段代码, 这就叫同步代码块</li>\n<li>多个同步代码块如果使用相同的锁对象, 那么他们就是同步的</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo6</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tPrint p = <span class=\"keyword\">new</span> Print();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread()&#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t\t\tp.print1();</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread()&#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t\t\tp.print2();</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Print</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">print1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">synchronized</span> (ThreadDemo6.class) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\tThread.sleep(<span class=\"number\">1000</span>);</div><div class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"鼎\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"点\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"视\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"讯\"</span>);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">print2</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">synchronized</span> (ThreadDemo6.class) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\tThread.sleep(<span class=\"number\">1000</span>);</div><div class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"T\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"O\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"P\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"V\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"I\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"S\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"I\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"O\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"N\"</span>);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"3-2-同步方法\"><a href=\"#3-2-同步方法\" class=\"headerlink\" title=\"3.2 同步方法\"></a>3.2 同步方法</h2><ul>\n<li>使用synchronized关键字修饰一个方法, 该方法中所有的代码都是同步的</li>\n<li>注意锁对象</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//同步方法，锁对象是this</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">print1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"鼎\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"点\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"视\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"讯\"</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//静态同步方法，锁对象是字节码文件</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">print1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"鼎\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"点\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"视\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"讯\"</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"3-3-线程安全\"><a href=\"#3-3-线程安全\" class=\"headerlink\" title=\"3.3 线程安全\"></a>3.3 线程安全</h2><ul>\n<li>多线程并发操作同一数据时, 就有可能出现线程安全问题</li>\n<li>使用同步技术可以解决这种问题, 把操作数据的代码进行同步, 不要多个线程一起操作。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.topvision.thread;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadTicket1</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">/*new Ticket1().start();</span></div><div class=\"line\">\t\tnew Ticket1().start();</div><div class=\"line\">\t\tnew Ticket1().start();</div><div class=\"line\">\t\tnew Ticket1().start();*/</div><div class=\"line\">\t\tTicket2 t2 = <span class=\"keyword\">new</span> Ticket2();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(t2).start();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(t2).start();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(t2).start();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(t2).start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Ticket1</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> ticktets = <span class=\"number\">100</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">synchronized</span> (Ticket1.class) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (ticktets &lt;= <span class=\"number\">0</span>) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\tSystem.out.println(<span class=\"string\">\"这是第\"</span> + ticktets-- + <span class=\"string\">\"张票\"</span>);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Ticket2</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">int</span> ticktets = <span class=\"number\">100</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">// TODO Auto-generated method stub</span></div><div class=\"line\">\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">synchronized</span> (<span class=\"keyword\">this</span>) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (ticktets &lt;= <span class=\"number\">0</span>) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\tSystem.out.println(<span class=\"string\">\"这是第\"</span> + ticktets-- + <span class=\"string\">\"张票\"</span>);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"3-4-死锁\"><a href=\"#3-4-死锁\" class=\"headerlink\" title=\"3.4 死锁\"></a>3.4 死锁</h2><p>两个线程各自拥有对方需要的锁对象，等待对方释放，因此互相等待，程序卡死。</p>\n<ul>\n<li>多线程同步的时候, 如果同步代码嵌套, 使用相同锁, 就有可能出现死锁</li>\n<li>尽量不要嵌套使用</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.topvision.thread;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo8</span> </span>&#123;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * <span class=\"doctag\">@param</span> args</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String s1 = <span class=\"string\">\"筷子左\"</span>;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String s2 = <span class=\"string\">\"筷子右\"</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">synchronized</span> (s1) &#123;</div><div class=\"line\">\t\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...获取\"</span> + s1 + <span class=\"string\">\"等待\"</span> + s2);</div><div class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">synchronized</span> (s2) &#123;</div><div class=\"line\">\t\t\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...拿到\"</span> + s2 + <span class=\"string\">\"开吃\"</span>);</div><div class=\"line\">\t\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">synchronized</span> (s2) &#123;</div><div class=\"line\">\t\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...获取\"</span> + s2 + <span class=\"string\">\"等待\"</span> + s1);</div><div class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">synchronized</span> (s1) &#123;</div><div class=\"line\">\t\t\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...拿到\"</span> + s1 + <span class=\"string\">\"开吃\"</span>);</div><div class=\"line\">\t\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>本文简单介绍了多线程的基本概念、基于Thread和Runnable实现多线程编程及简单的线程安全问题示例。<br>","more":"</p>\n<h1 id=\"1-概述\"><a href=\"#1-概述\" class=\"headerlink\" title=\"1 概述\"></a>1 概述</h1><h2 id=\"1-1-进程与线程\"><a href=\"#1-1-进程与线程\" class=\"headerlink\" title=\"1.1 进程与线程\"></a>1.1 进程与线程</h2><ul>\n<li>进程是正在执行的程序    JVM是一个进程.</li>\n<li>线程进程中用于控制程序执行的控制单元(执行路径)</li>\n<li>进程中至少有一个线程,对于JVM,启动时至少有两个线程:JVM的主线程和JVM的垃圾回收线程</li>\n</ul>\n<h2 id=\"1-2-并行与并发\"><a href=\"#1-2-并行与并发\" class=\"headerlink\" title=\"1.2 并行与并发\"></a>1.2 并行与并发</h2><ul>\n<li>并行就是两个任务同时运行，就是甲任务进行的同时，乙任务也在进行。(需要多核CPU)</li>\n<li>并发是指两个任务都请求运行，而处理器只能按受一个任务，就把这两个任务安排轮流进行，由于时间间隔较短，使人感觉两个任务都在运行。</li>\n</ul>\n<h2 id=\"1-3-基本实现方式\"><a href=\"#1-3-基本实现方式\" class=\"headerlink\" title=\"1.3 基本实现方式\"></a>1.3 基本实现方式</h2><h3 id=\"1-3-1-继承Thread类覆盖run方法\"><a href=\"#1-3-1-继承Thread类覆盖run方法\" class=\"headerlink\" title=\"1.3.1 继承Thread类覆盖run方法\"></a>1.3.1 继承Thread类覆盖run方法</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.topvision.thread;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo1</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tDemo1 d1 = <span class=\"keyword\">new</span> Demo1();</div><div class=\"line\">\t\td1.start();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">60</span>; i++) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName() + i);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo1</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;</div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName() + i);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h3 id=\"1-3-2-实现Runnable接口实现run方法\"><a href=\"#1-3-2-实现Runnable接口实现run方法\" class=\"headerlink\" title=\"1.3.2 实现Runnable接口实现run方法\"></a>1.3.2 实现Runnable接口实现run方法</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo1</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tThread d2 = <span class=\"keyword\">new</span> Thread(<span class=\"keyword\">new</span> Demo2());</div><div class=\"line\">\t\td2.start();</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">60</span>; i++) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName() + i);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Demo2</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</div><div class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName() + i);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"1-4-继承Thread与实现Runnable的区别\"><a href=\"#1-4-继承Thread与实现Runnable的区别\" class=\"headerlink\" title=\"1.4 继承Thread与实现Runnable的区别\"></a>1.4 继承Thread与实现Runnable的区别</h2><ul>\n<li>查看源码的区别:<ul>\n<li>a.继承Thread : 由于子类重写了Thread类的run(), 当调用start()时, 直接找子类的run()方法</li>\n<li>b.实现Runnable : 构造函数中传入了Runnable的引用, 成员变量记住了它, start()调用run()方法时内部判断成员变量Runnable的引用是否为空, 不为空编译时看的是Runnable的run(),运行时执行的是子类的run()方法</li>\n</ul>\n</li>\n<li>继承Thread<ul>\n<li>好处是:可以直接使用Thread类中的方法,代码简单</li>\n<li>弊端是:如果已经有了父类,就不能用这种方法</li>\n</ul>\n</li>\n<li>实现Runnable接口<ul>\n<li>好处是:即使自己定义的线程类有了父类也没关系,因为有了父类也可以实现接口,而且接口是可以多实现的</li>\n<li>弊端是:不能直接使用Thread中的方法需要先获取到线程对象后,才能得到Thread的方法,代码复杂</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"2-基本API\"><a href=\"#2-基本API\" class=\"headerlink\" title=\"2 基本API\"></a>2 基本API</h1><p>与人有生老病死一样，线程也同样要经历开始（等待）、运行、挂起和停止四种不同的状态。这四种状态都可以通过Thread类中的方法进行控制。下面给出了Thread类中和这四种状态相关的方法。</p>\n<ol>\n<li><p>开始线程</p>\n<p>publicvoid start( );<br>publicvoid run( );</p>\n</li>\n<li><p>挂起和唤醒线程</p>\n<p>publicvoid resume( );     // 不建议使用<br>publicvoid suspend( );    // 不建议使用<br>publicstaticvoid sleep(long millis);<br>publicstaticvoid sleep(long millis, int nanos);</p>\n</li>\n<li><p>终止线程</p>\n<p>publicvoid stop( );       // 不建议使用<br>publicvoid interrupt( );</p>\n</li>\n<li><p>得到线程状态</p>\n<p>publicboolean isAlive( );<br>publicboolean isInterrupted( );<br>publicstaticboolean interrupted( );</p>\n</li>\n<li><p>join方法</p>\n<p>publicvoid join( ) throws InterruptedException;</p>\n</li>\n</ol>\n<p>线程在建立后并不马上执行run方法中的代码，而是处于等待状态。线程处于等待状态时，可以通过Thread类的方法来设置线程不各种属性，如线程的优先级（setPriority）、线程名(setName)和线程的类型（setDaemon）等。</p>\n<p>当调用start方法后，线程开始执行run方法中的代码。线程进入运行状态。可以通过Thread类的isAlive方法来判断线程是否处于运行状态。当线程处于运行状态时，isAlive返回true，当isAlive返回false时，可能线程处于等待状态，也可能处于停止状态。</p>\n<p>一但线程开始执行run方法，就会一直到这个run方法执行完成这个线程才退出。但在线程执行的过程中，可以通过两个方法使线程暂时停止执行。这两个方法是suspend和sleep。在使用suspend挂起线程后，可以通过resume方法唤醒线程。而使用sleep使线程休眠后，只能在设定的时间后使线程处于就绪状态（在线程休眠结束后，线程不一定会马上执行，只是进入了就绪状态，等待着系统进行调度）。</p>\n<h2 id=\"2-1-设置及获取线程名字\"><a href=\"#2-1-设置及获取线程名字\" class=\"headerlink\" title=\"2.1 设置及获取线程名字\"></a>2.1 设置及获取线程名字</h2><ol>\n<li>构造方法中传入名字 new Thread(“张三”){}</li>\n<li>线程对象设置名字  thread.setName()</li>\n<li>线程对象获取名字  thread.getName()  Thread.currentThread().hetName()</li>\n</ol>\n<h2 id=\"2-2-休眠线程Sleep\"><a href=\"#2-2-休眠线程Sleep\" class=\"headerlink\" title=\"2.2 休眠线程Sleep\"></a>2.2 休眠线程Sleep</h2><ol>\n<li><p>sleep方法有两个重载形式，其中一个重载形式不仅可以设毫秒，而且还可以设纳秒(1,000,000纳秒等于1毫秒)。但大多数操作系统平台上的Java虚拟机都无法精确到纳秒，因此，如果对sleep设置了纳秒，Java虚拟机将取最接近这个值的毫秒。</p>\n</li>\n<li><p>在使用sleep方法时必须使用throws或try{…}catch{…}。因为run方法无法使用throws，所以只能使用try{…}catch{…}。当在线程休眠的过程中，使用interrupt方法中断线程时sleep会抛出一个InterruptedException异常。sleep方法的定义如下：</p>\n<pre><code>publicstaticvoid sleep(long millis) throws InterruptedException\npublicstaticvoid sleep(long millis, int nanos) throws InterruptedException\n</code></pre></li>\n</ol>\n<h2 id=\"2-3-守护线程Daemon\"><a href=\"#2-3-守护线程Daemon\" class=\"headerlink\" title=\"2.3 守护线程Daemon\"></a>2.3 守护线程Daemon</h2><p><strong>setDaemon(), 设置一个线程为守护线程, 该线程不会单独执行, 当其他非守护线程都执行结束后, 自动退出    </strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo4</span> </span>&#123;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * <span class=\"doctag\">@param</span> args</div><div class=\"line\">\t * 守护线程</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tThread t1 = <span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...aaaaaaaaaaaaaaaaaaaa\"</span>);</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;;</div><div class=\"line\"></div><div class=\"line\">\t\tThread t2 = <span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">5000</span>; i++) &#123;</div><div class=\"line\">\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...bb\"</span> + i);</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;;</div><div class=\"line\"></div><div class=\"line\">\t\tt2.setDaemon(<span class=\"keyword\">true</span>); <span class=\"comment\">// 设置为守护线程</span></div><div class=\"line\"></div><div class=\"line\">\t\tt1.start();</div><div class=\"line\">\t\tt2.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"2-4-加入线程Join\"><a href=\"#2-4-加入线程Join\" class=\"headerlink\" title=\"2.4 加入线程Join\"></a>2.4 加入线程Join</h2><p>join方法的功能就是使异步执行的线程变成同步执行。也就是说，当调用线程实例的start方法后，这个方法会立即返回，如果在调用start方法后后需要使用一个由这个线程计算得到的值，就必须使用join方法。如果不使用join方法，就不能保证当执行到start方法后面的某条语句时，这个线程一定会执行完。而使用join方法后，直到这个线程退出，程序才会往下执行。下面的代码演示了join的用法。</p>\n<h2 id=\"2-5-礼让线程Yield\"><a href=\"#2-5-礼让线程Yield\" class=\"headerlink\" title=\"2.5 礼让线程Yield\"></a>2.5 礼让线程Yield</h2><p>Thread.yield()方法作用是：暂停当前正在执行的线程对象，并执行其他线程。<br>yield()应该做的是让当前运行线程回到可运行状态，以允许具有相同优先级的其他线程获得运行机会。因此，使用yield()的目的是让相同优先级的线程之间能适当的轮转执行。但是，实际中无法保证yield()达到让步目的，因为让步的线程还有可能被线程调度程序再次选中。</p>\n<p>结论：yield()从未导致线程转到等待/睡眠/阻塞状态。在大多数情况下，yield()将导致线程从运行状态转到可运行状态，但有可能没有效果。</p>\n<h2 id=\"2-6-设置线程优先级Priority\"><a href=\"#2-6-设置线程优先级Priority\" class=\"headerlink\" title=\"2.6 设置线程优先级Priority\"></a>2.6 设置线程优先级Priority</h2><p>setPriority不一定起作用的，在不同的操作系统不同的jvm上，效果也可能不同。现在很多jvm的线程的实现都使用的操作系统线程，设置优先级也是使用的操作系统优先级，java层面有10个优先级别，假设操作系统只有3个优先级别，那么jvm可能将1-4级映射到操作系统的1级，5-7级映射到操作系统的2级，剩下的映射到3级，这样的话，在java层面，将优先级设置为5,6,7，其实本质就是一样的了。</p>\n<p>另外，操作系统也不能保证设置了优先级的线程就一定会先运行或得到更多的CPU时间。<br>在实际使用中，不建议使用该方法</p>\n<h1 id=\"3-同步\"><a href=\"#3-同步\" class=\"headerlink\" title=\"3 同步\"></a>3 同步</h1><ul>\n<li>当多线程并发, 有多段代码同时执行时, 我们希望某一段代码执行的过程中CPU不要切换到其他线程工作. 这时就需要同步.</li>\n<li>如果两段代码是同步的, 那么同一时间只能执行一段, 在一段代码没执行结束之前, 不会执行另外一段代码.</li>\n</ul>\n<h2 id=\"3-1-同步代码块\"><a href=\"#3-1-同步代码块\" class=\"headerlink\" title=\"3.1 同步代码块\"></a>3.1 同步代码块</h2><ul>\n<li>使用synchronized关键字加上一个锁对象来定义一段代码, 这就叫同步代码块</li>\n<li>多个同步代码块如果使用相同的锁对象, 那么他们就是同步的</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo6</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\tPrint p = <span class=\"keyword\">new</span> Print();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread()&#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t\t\tp.print1();</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t\t</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread()&#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t\t\tp.print2();</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Print</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">print1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">synchronized</span> (ThreadDemo6.class) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\tThread.sleep(<span class=\"number\">1000</span>);</div><div class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"鼎\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"点\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"视\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"讯\"</span>);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">print2</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">synchronized</span> (ThreadDemo6.class) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</div><div class=\"line\">\t\t\t\tThread.sleep(<span class=\"number\">1000</span>);</div><div class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</div><div class=\"line\">\t\t\t\te.printStackTrace();</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"T\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"O\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"P\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"V\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"I\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"S\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"I\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"O\"</span>);</div><div class=\"line\">\t\t\tSystem.out.println(<span class=\"string\">\"N\"</span>);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"3-2-同步方法\"><a href=\"#3-2-同步方法\" class=\"headerlink\" title=\"3.2 同步方法\"></a>3.2 同步方法</h2><ul>\n<li>使用synchronized关键字修饰一个方法, 该方法中所有的代码都是同步的</li>\n<li>注意锁对象</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//同步方法，锁对象是this</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">print1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"鼎\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"点\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"视\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"讯\"</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">//静态同步方法，锁对象是字节码文件</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title\">print1</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"鼎\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"点\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"视\"</span>);</div><div class=\"line\">\tSystem.out.println(<span class=\"string\">\"讯\"</span>);</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"3-3-线程安全\"><a href=\"#3-3-线程安全\" class=\"headerlink\" title=\"3.3 线程安全\"></a>3.3 线程安全</h2><ul>\n<li>多线程并发操作同一数据时, 就有可能出现线程安全问题</li>\n<li>使用同步技术可以解决这种问题, 把操作数据的代码进行同步, 不要多个线程一起操作。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.topvision.thread;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadTicket1</span> </span>&#123;</div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">/*new Ticket1().start();</span></div><div class=\"line\">\t\tnew Ticket1().start();</div><div class=\"line\">\t\tnew Ticket1().start();</div><div class=\"line\">\t\tnew Ticket1().start();*/</div><div class=\"line\">\t\tTicket2 t2 = <span class=\"keyword\">new</span> Ticket2();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(t2).start();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(t2).start();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(t2).start();</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread(t2).start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Ticket1</span> <span class=\"keyword\">extends</span> <span class=\"title\">Thread</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">int</span> ticktets = <span class=\"number\">100</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">synchronized</span> (Ticket1.class) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (ticktets &lt;= <span class=\"number\">0</span>) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\tSystem.out.println(<span class=\"string\">\"这是第\"</span> + ticktets-- + <span class=\"string\">\"张票\"</span>);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\"></div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Ticket2</span> <span class=\"keyword\">implements</span> <span class=\"title\">Runnable</span> </span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">int</span> ticktets = <span class=\"number\">100</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"meta\">@Override</span></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"comment\">// TODO Auto-generated method stub</span></div><div class=\"line\">\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t<span class=\"keyword\">synchronized</span> (<span class=\"keyword\">this</span>) &#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (ticktets &lt;= <span class=\"number\">0</span>) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\tSystem.out.println(<span class=\"string\">\"这是第\"</span> + ticktets-- + <span class=\"string\">\"张票\"</span>);</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"3-4-死锁\"><a href=\"#3-4-死锁\" class=\"headerlink\" title=\"3.4 死锁\"></a>3.4 死锁</h2><p>两个线程各自拥有对方需要的锁对象，等待对方释放，因此互相等待，程序卡死。</p>\n<ul>\n<li>多线程同步的时候, 如果同步代码嵌套, 使用相同锁, 就有可能出现死锁</li>\n<li>尽量不要嵌套使用</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">package</span> com.topvision.thread;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ThreadDemo8</span> </span>&#123;</div><div class=\"line\">\t<span class=\"comment\">/**</span></div><div class=\"line\">\t * <span class=\"doctag\">@param</span> args</div><div class=\"line\">\t */</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String s1 = <span class=\"string\">\"筷子左\"</span>;</div><div class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> String s2 = <span class=\"string\">\"筷子右\"</span>;</div><div class=\"line\"></div><div class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">synchronized</span> (s1) &#123;</div><div class=\"line\">\t\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...获取\"</span> + s1 + <span class=\"string\">\"等待\"</span> + s2);</div><div class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">synchronized</span> (s2) &#123;</div><div class=\"line\">\t\t\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...拿到\"</span> + s2 + <span class=\"string\">\"开吃\"</span>);</div><div class=\"line\">\t\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\"></div><div class=\"line\">\t\t<span class=\"keyword\">new</span> Thread() &#123;</div><div class=\"line\">\t\t\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</div><div class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">\t\t\t\t\t<span class=\"keyword\">synchronized</span> (s2) &#123;</div><div class=\"line\">\t\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...获取\"</span> + s2 + <span class=\"string\">\"等待\"</span> + s1);</div><div class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">synchronized</span> (s1) &#123;</div><div class=\"line\">\t\t\t\t\t\t\tSystem.out.println(getName() + <span class=\"string\">\"...拿到\"</span> + s1 + <span class=\"string\">\"开吃\"</span>);</div><div class=\"line\">\t\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t\t&#125;</div><div class=\"line\">\t\t\t\t&#125;</div><div class=\"line\">\t\t\t&#125;</div><div class=\"line\">\t\t&#125;.start();</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>"},{"title":"基于MUI及Html5+开发app","date":"2017-04-28T09:07:22.000Z","_content":"这边博客简要介绍了使用MUI和5+开发APP的流程\n<!-- more -->\n## MUI简介\n[MUI官网](http://dev.dcloud.net.cn/mui/)&nbsp&nbspMUI是最接近原生APP体验的高性能前端框架，不依赖任何第三方JS库，以iOS平台UI为基础，补充部分Android平台特有的UI控件。\n\n## 工具\n- [HBilder](http://www.dcloud.io/)\n- [5+ SDK](http://ask.dcloud.net.cn/article/103)\n- Android Studio + Android SDK\n\n## html5+简介\n[HTML5+规范](http://www.html5plus.org/doc/h5p.html)\n\n## 开发步骤\n\n    1.在Hbuilder中创建移动app项目\n    2.在manifest.json文件中按照提示配置app相关信息，包括权限选择，这个地方和下面将要提到的androidManifest.xml文件是相互独立的\n    3.新建View文件夹编写html，新建js、css文件夹放置对应文件\n    4.若使用5+相关的东西,如下操作： \n      - 在5+ SDK中，对应Feature-Android.xls文件，使用哪个模块，就在xls文件中找到对应模块\n      - 将文件中提到的相关文件从5+ SDK中的HBuilder-Integrate工程中找到，并移入android工程中\n    5.参照[5+ API](http://www.html5plus.org/doc/h5p.html),编写相关代码\n    \n## 调试\n调试可使用真机调试和模拟调试，建议真机调试，涉及到5+的代码只能在真机上运行。\n","source":"_posts/基于MUI及Html5-开发app.md","raw":"---\ntitle: 基于MUI及Html5+开发app\ndate: 2017-04-28 17:07:22\ncategories:\n    - DCloud\ntags:\n    - MUI\n    - html5+\n---\n这边博客简要介绍了使用MUI和5+开发APP的流程\n<!-- more -->\n## MUI简介\n[MUI官网](http://dev.dcloud.net.cn/mui/)&nbsp&nbspMUI是最接近原生APP体验的高性能前端框架，不依赖任何第三方JS库，以iOS平台UI为基础，补充部分Android平台特有的UI控件。\n\n## 工具\n- [HBilder](http://www.dcloud.io/)\n- [5+ SDK](http://ask.dcloud.net.cn/article/103)\n- Android Studio + Android SDK\n\n## html5+简介\n[HTML5+规范](http://www.html5plus.org/doc/h5p.html)\n\n## 开发步骤\n\n    1.在Hbuilder中创建移动app项目\n    2.在manifest.json文件中按照提示配置app相关信息，包括权限选择，这个地方和下面将要提到的androidManifest.xml文件是相互独立的\n    3.新建View文件夹编写html，新建js、css文件夹放置对应文件\n    4.若使用5+相关的东西,如下操作： \n      - 在5+ SDK中，对应Feature-Android.xls文件，使用哪个模块，就在xls文件中找到对应模块\n      - 将文件中提到的相关文件从5+ SDK中的HBuilder-Integrate工程中找到，并移入android工程中\n    5.参照[5+ API](http://www.html5plus.org/doc/h5p.html),编写相关代码\n    \n## 调试\n调试可使用真机调试和模拟调试，建议真机调试，涉及到5+的代码只能在真机上运行。\n","slug":"基于MUI及Html5-开发app","published":1,"updated":"2018-02-27T07:38:38.103Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfw1004khwvfuh76rimv","content":"<p>这边博客简要介绍了使用MUI和5+开发APP的流程<br><a id=\"more\"></a></p>\n<h2 id=\"MUI简介\"><a href=\"#MUI简介\" class=\"headerlink\" title=\"MUI简介\"></a>MUI简介</h2><p><a href=\"http://dev.dcloud.net.cn/mui/\" target=\"_blank\" rel=\"noopener\">MUI官网</a>&amp;nbsp&amp;nbspMUI是最接近原生APP体验的高性能前端框架，不依赖任何第三方JS库，以iOS平台UI为基础，补充部分Android平台特有的UI控件。</p>\n<h2 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h2><ul>\n<li><a href=\"http://www.dcloud.io/\" target=\"_blank\" rel=\"noopener\">HBilder</a></li>\n<li><a href=\"http://ask.dcloud.net.cn/article/103\" target=\"_blank\" rel=\"noopener\">5+ SDK</a></li>\n<li>Android Studio + Android SDK</li>\n</ul>\n<h2 id=\"html5-简介\"><a href=\"#html5-简介\" class=\"headerlink\" title=\"html5+简介\"></a>html5+简介</h2><p><a href=\"http://www.html5plus.org/doc/h5p.html\" target=\"_blank\" rel=\"noopener\">HTML5+规范</a></p>\n<h2 id=\"开发步骤\"><a href=\"#开发步骤\" class=\"headerlink\" title=\"开发步骤\"></a>开发步骤</h2><pre><code>1.在Hbuilder中创建移动app项目\n2.在manifest.json文件中按照提示配置app相关信息，包括权限选择，这个地方和下面将要提到的androidManifest.xml文件是相互独立的\n3.新建View文件夹编写html，新建js、css文件夹放置对应文件\n4.若使用5+相关的东西,如下操作： \n  - 在5+ SDK中，对应Feature-Android.xls文件，使用哪个模块，就在xls文件中找到对应模块\n  - 将文件中提到的相关文件从5+ SDK中的HBuilder-Integrate工程中找到，并移入android工程中\n5.参照[5+ API](http://www.html5plus.org/doc/h5p.html),编写相关代码\n</code></pre><h2 id=\"调试\"><a href=\"#调试\" class=\"headerlink\" title=\"调试\"></a>调试</h2><p>调试可使用真机调试和模拟调试，建议真机调试，涉及到5+的代码只能在真机上运行。</p>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>这边博客简要介绍了使用MUI和5+开发APP的流程<br>","more":"</p>\n<h2 id=\"MUI简介\"><a href=\"#MUI简介\" class=\"headerlink\" title=\"MUI简介\"></a>MUI简介</h2><p><a href=\"http://dev.dcloud.net.cn/mui/\" target=\"_blank\" rel=\"noopener\">MUI官网</a>&amp;nbsp&amp;nbspMUI是最接近原生APP体验的高性能前端框架，不依赖任何第三方JS库，以iOS平台UI为基础，补充部分Android平台特有的UI控件。</p>\n<h2 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h2><ul>\n<li><a href=\"http://www.dcloud.io/\" target=\"_blank\" rel=\"noopener\">HBilder</a></li>\n<li><a href=\"http://ask.dcloud.net.cn/article/103\" target=\"_blank\" rel=\"noopener\">5+ SDK</a></li>\n<li>Android Studio + Android SDK</li>\n</ul>\n<h2 id=\"html5-简介\"><a href=\"#html5-简介\" class=\"headerlink\" title=\"html5+简介\"></a>html5+简介</h2><p><a href=\"http://www.html5plus.org/doc/h5p.html\" target=\"_blank\" rel=\"noopener\">HTML5+规范</a></p>\n<h2 id=\"开发步骤\"><a href=\"#开发步骤\" class=\"headerlink\" title=\"开发步骤\"></a>开发步骤</h2><pre><code>1.在Hbuilder中创建移动app项目\n2.在manifest.json文件中按照提示配置app相关信息，包括权限选择，这个地方和下面将要提到的androidManifest.xml文件是相互独立的\n3.新建View文件夹编写html，新建js、css文件夹放置对应文件\n4.若使用5+相关的东西,如下操作： \n  - 在5+ SDK中，对应Feature-Android.xls文件，使用哪个模块，就在xls文件中找到对应模块\n  - 将文件中提到的相关文件从5+ SDK中的HBuilder-Integrate工程中找到，并移入android工程中\n5.参照[5+ API](http://www.html5plus.org/doc/h5p.html),编写相关代码\n</code></pre><h2 id=\"调试\"><a href=\"#调试\" class=\"headerlink\" title=\"调试\"></a>调试</h2><p>调试可使用真机调试和模拟调试，建议真机调试，涉及到5+的代码只能在真机上运行。</p>"},{"title":"网站数据分析","date":"2017-07-18T00:40:13.000Z","_content":"\n我们需要问自己几个问题： \n访问者来自哪里？ -- 页面布局合理吗？ \n访问者在寻找什么？ -- 网站导航清晰吗？ \n哪些页面最受欢迎？ -- 哪些功能存在问题？ \n访问者从哪里进入？ -- 网站内容有效吗？ \n访问者从哪里离开？ -- 转化路径靠谱吗？\n\n<!-- more -->\n\n对所有网站来说，页面都可以被划分为三个类别：导航页、功能页、内容页。 \n导航页：引导访问者找到信息 \n功能页：帮助访问者完成特定任务 \n内容页：向访问者展示信息并帮助进行决策\n\n有两种诡异行为： \n1、在导航页中途离开 \n2、从内容页重新返回导航页面\n\n没有规范的分析流程容易使最后的结果逻辑混乱或偏离原来的主题\n\n## 数据获取方式\n\n1、网站日志文件 \n有两个缺点。1、原始的日志文件记录了很多统计中用不到的内容，很难筛选内容；2、很多在页面的操作（点击，ajax）无法被记录。\n\n2、Web Beacons \n在需要统计的网站页面嵌入一个1*1的透明图片，用户完全察觉不到。当用户访问网页的同时会请求透明图片，并完成页面访问记录工作。 \nWeb Beacons实现了日志记录服务器与网站应用服务器的分离。一般的网站页面，传统日志记录6-10条，用可控的图片嵌入方式大幅降低日志记录数。\n\n3、JS页面标记 \n嵌入的不再是图片，而是代码。 \n当用户访问网页时同时执行JS代码，会将一些统计需要的信息以url参数的形式附带在图片请求地址的后面，然后再向日志服务器请求图片。这样，日志服务器就可以获得比较完整的访问数据。\n\ncookie+session相同，是同一个用户在同义词访问过程中进行的操作。将相同的session的点根据发生时间的先后，和页面浏览关系的前后关系连成线。这样，将原先只有页面浏览的日志记录规划到相应的访问层面。底层的表可以从单纯记录页面浏览拆分为记录页面浏览和网站访问的两个表。\n\n页面浏览表（PageView）： \n浏览时间、页面url、session、停留时长、第几步\n\n访问表（Visit）： \nsession、起始时间、结束时间、进入页面、离开页面、访问页面数、ip、cookie、referral\n","source":"_posts/网站数据分析.md","raw":"---\ntitle: 网站数据分析\ncategories:\n  - Web\ntags:\n  - 数据收集\ndate: 2017-07-18 08:40:13\n---\n\n我们需要问自己几个问题： \n访问者来自哪里？ -- 页面布局合理吗？ \n访问者在寻找什么？ -- 网站导航清晰吗？ \n哪些页面最受欢迎？ -- 哪些功能存在问题？ \n访问者从哪里进入？ -- 网站内容有效吗？ \n访问者从哪里离开？ -- 转化路径靠谱吗？\n\n<!-- more -->\n\n对所有网站来说，页面都可以被划分为三个类别：导航页、功能页、内容页。 \n导航页：引导访问者找到信息 \n功能页：帮助访问者完成特定任务 \n内容页：向访问者展示信息并帮助进行决策\n\n有两种诡异行为： \n1、在导航页中途离开 \n2、从内容页重新返回导航页面\n\n没有规范的分析流程容易使最后的结果逻辑混乱或偏离原来的主题\n\n## 数据获取方式\n\n1、网站日志文件 \n有两个缺点。1、原始的日志文件记录了很多统计中用不到的内容，很难筛选内容；2、很多在页面的操作（点击，ajax）无法被记录。\n\n2、Web Beacons \n在需要统计的网站页面嵌入一个1*1的透明图片，用户完全察觉不到。当用户访问网页的同时会请求透明图片，并完成页面访问记录工作。 \nWeb Beacons实现了日志记录服务器与网站应用服务器的分离。一般的网站页面，传统日志记录6-10条，用可控的图片嵌入方式大幅降低日志记录数。\n\n3、JS页面标记 \n嵌入的不再是图片，而是代码。 \n当用户访问网页时同时执行JS代码，会将一些统计需要的信息以url参数的形式附带在图片请求地址的后面，然后再向日志服务器请求图片。这样，日志服务器就可以获得比较完整的访问数据。\n\ncookie+session相同，是同一个用户在同义词访问过程中进行的操作。将相同的session的点根据发生时间的先后，和页面浏览关系的前后关系连成线。这样，将原先只有页面浏览的日志记录规划到相应的访问层面。底层的表可以从单纯记录页面浏览拆分为记录页面浏览和网站访问的两个表。\n\n页面浏览表（PageView）： \n浏览时间、页面url、session、停留时长、第几步\n\n访问表（Visit）： \nsession、起始时间、结束时间、进入页面、离开页面、访问页面数、ip、cookie、referral\n","slug":"网站数据分析","published":1,"updated":"2018-02-27T07:38:38.104Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfw5004phwvfwchsweyo","content":"<p>我们需要问自己几个问题：<br>访问者来自哪里？ – 页面布局合理吗？<br>访问者在寻找什么？ – 网站导航清晰吗？<br>哪些页面最受欢迎？ – 哪些功能存在问题？<br>访问者从哪里进入？ – 网站内容有效吗？<br>访问者从哪里离开？ – 转化路径靠谱吗？</p>\n<a id=\"more\"></a>\n<p>对所有网站来说，页面都可以被划分为三个类别：导航页、功能页、内容页。<br>导航页：引导访问者找到信息<br>功能页：帮助访问者完成特定任务<br>内容页：向访问者展示信息并帮助进行决策</p>\n<p>有两种诡异行为：<br>1、在导航页中途离开<br>2、从内容页重新返回导航页面</p>\n<p>没有规范的分析流程容易使最后的结果逻辑混乱或偏离原来的主题</p>\n<h2 id=\"数据获取方式\"><a href=\"#数据获取方式\" class=\"headerlink\" title=\"数据获取方式\"></a>数据获取方式</h2><p>1、网站日志文件<br>有两个缺点。1、原始的日志文件记录了很多统计中用不到的内容，很难筛选内容；2、很多在页面的操作（点击，ajax）无法被记录。</p>\n<p>2、Web Beacons<br>在需要统计的网站页面嵌入一个1*1的透明图片，用户完全察觉不到。当用户访问网页的同时会请求透明图片，并完成页面访问记录工作。<br>Web Beacons实现了日志记录服务器与网站应用服务器的分离。一般的网站页面，传统日志记录6-10条，用可控的图片嵌入方式大幅降低日志记录数。</p>\n<p>3、JS页面标记<br>嵌入的不再是图片，而是代码。<br>当用户访问网页时同时执行JS代码，会将一些统计需要的信息以url参数的形式附带在图片请求地址的后面，然后再向日志服务器请求图片。这样，日志服务器就可以获得比较完整的访问数据。</p>\n<p>cookie+session相同，是同一个用户在同义词访问过程中进行的操作。将相同的session的点根据发生时间的先后，和页面浏览关系的前后关系连成线。这样，将原先只有页面浏览的日志记录规划到相应的访问层面。底层的表可以从单纯记录页面浏览拆分为记录页面浏览和网站访问的两个表。</p>\n<p>页面浏览表（PageView）：<br>浏览时间、页面url、session、停留时长、第几步</p>\n<p>访问表（Visit）：<br>session、起始时间、结束时间、进入页面、离开页面、访问页面数、ip、cookie、referral</p>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>我们需要问自己几个问题：<br>访问者来自哪里？ – 页面布局合理吗？<br>访问者在寻找什么？ – 网站导航清晰吗？<br>哪些页面最受欢迎？ – 哪些功能存在问题？<br>访问者从哪里进入？ – 网站内容有效吗？<br>访问者从哪里离开？ – 转化路径靠谱吗？</p>","more":"<p>对所有网站来说，页面都可以被划分为三个类别：导航页、功能页、内容页。<br>导航页：引导访问者找到信息<br>功能页：帮助访问者完成特定任务<br>内容页：向访问者展示信息并帮助进行决策</p>\n<p>有两种诡异行为：<br>1、在导航页中途离开<br>2、从内容页重新返回导航页面</p>\n<p>没有规范的分析流程容易使最后的结果逻辑混乱或偏离原来的主题</p>\n<h2 id=\"数据获取方式\"><a href=\"#数据获取方式\" class=\"headerlink\" title=\"数据获取方式\"></a>数据获取方式</h2><p>1、网站日志文件<br>有两个缺点。1、原始的日志文件记录了很多统计中用不到的内容，很难筛选内容；2、很多在页面的操作（点击，ajax）无法被记录。</p>\n<p>2、Web Beacons<br>在需要统计的网站页面嵌入一个1*1的透明图片，用户完全察觉不到。当用户访问网页的同时会请求透明图片，并完成页面访问记录工作。<br>Web Beacons实现了日志记录服务器与网站应用服务器的分离。一般的网站页面，传统日志记录6-10条，用可控的图片嵌入方式大幅降低日志记录数。</p>\n<p>3、JS页面标记<br>嵌入的不再是图片，而是代码。<br>当用户访问网页时同时执行JS代码，会将一些统计需要的信息以url参数的形式附带在图片请求地址的后面，然后再向日志服务器请求图片。这样，日志服务器就可以获得比较完整的访问数据。</p>\n<p>cookie+session相同，是同一个用户在同义词访问过程中进行的操作。将相同的session的点根据发生时间的先后，和页面浏览关系的前后关系连成线。这样，将原先只有页面浏览的日志记录规划到相应的访问层面。底层的表可以从单纯记录页面浏览拆分为记录页面浏览和网站访问的两个表。</p>\n<p>页面浏览表（PageView）：<br>浏览时间、页面url、session、停留时长、第几步</p>\n<p>访问表（Visit）：<br>session、起始时间、结束时间、进入页面、离开页面、访问页面数、ip、cookie、referral</p>"},{"title":"观察者模式","date":"2018-03-26T08:57:45.000Z","_content":"当对象间存在一对多关系时，则使用观察者模式（Observer Pattern）。比如，当一个对象被修改时，则会自动通知它的依赖对象。观察者模式属于行为型模式。\n\n<!-- more -->\n\n## 介绍\n\n**意图**：定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。\n**主要解决**：一个对象状态改变给其他对象通知的问题，而且要考虑到易用和低耦合，保证高度的协作。\n**关键代码**：在抽象类（主题、被观察者）里有一个 **集合** 存放观察者们。\n**优点**： \n1. 观察者和被观察者是抽象耦合的。 \n2. 建立一套触发机制。\n**缺点**： \n1、如果一个被观察者对象有很多的直接和间接的观察者的话，将所有的观察者都通知到会花费很多时间。 \n2、如果在观察者和观察目标之间有循环依赖的话，观察目标会触发它们之间进行循环调用，可能导致系统崩溃。\n3、观察者模式没有相应的机制让观察者知道所观察的目标对象是怎么发生变化的，而仅仅只是知道观察目标发生了变化。\n**注意事项**： \n1、JAVA 中已经有了对观察者模式的支持类。 \n2、避免循环引用。 \n3、如果顺序执行，某一观察者错误会导致系统卡壳，一般采用异步方式。\n\n## 实现\n\n观察者模式主要使用的5个类或接口对象。\n\n 1. 主题（被观察者）接口：定义绑定、移除、通知观察者的方法\n 2. 主题实现类：实现上述三个方法，包含一个观察者引用队列\n 3. 观察者接口：定义了该类观察者要实现的方法\n 4. 观察者实现类：实现具体的观察者接口，初始化时将自己注册到主题的观察者引用队列\n 5. 消息实体类：主题和观察者之间传递的消息实体\n\n![观察者模式结构][1]\n\n## 改进\n\n 1. JDK已有观察者顶层接口： java.util.EventListener\n 2. JDK已有消息实体顶层父类： java.util.EventObject\n\n \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/designPatterns/observerPattern.png","source":"_posts/观察者模式.md","raw":"---\ntitle: 观察者模式\ncategories:\n  - 设计模式\ntags:\n  - 设计模式\ndate: 2018-03-26 16:57:45\n---\n当对象间存在一对多关系时，则使用观察者模式（Observer Pattern）。比如，当一个对象被修改时，则会自动通知它的依赖对象。观察者模式属于行为型模式。\n\n<!-- more -->\n\n## 介绍\n\n**意图**：定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。\n**主要解决**：一个对象状态改变给其他对象通知的问题，而且要考虑到易用和低耦合，保证高度的协作。\n**关键代码**：在抽象类（主题、被观察者）里有一个 **集合** 存放观察者们。\n**优点**： \n1. 观察者和被观察者是抽象耦合的。 \n2. 建立一套触发机制。\n**缺点**： \n1、如果一个被观察者对象有很多的直接和间接的观察者的话，将所有的观察者都通知到会花费很多时间。 \n2、如果在观察者和观察目标之间有循环依赖的话，观察目标会触发它们之间进行循环调用，可能导致系统崩溃。\n3、观察者模式没有相应的机制让观察者知道所观察的目标对象是怎么发生变化的，而仅仅只是知道观察目标发生了变化。\n**注意事项**： \n1、JAVA 中已经有了对观察者模式的支持类。 \n2、避免循环引用。 \n3、如果顺序执行，某一观察者错误会导致系统卡壳，一般采用异步方式。\n\n## 实现\n\n观察者模式主要使用的5个类或接口对象。\n\n 1. 主题（被观察者）接口：定义绑定、移除、通知观察者的方法\n 2. 主题实现类：实现上述三个方法，包含一个观察者引用队列\n 3. 观察者接口：定义了该类观察者要实现的方法\n 4. 观察者实现类：实现具体的观察者接口，初始化时将自己注册到主题的观察者引用队列\n 5. 消息实体类：主题和观察者之间传递的消息实体\n\n![观察者模式结构][1]\n\n## 改进\n\n 1. JDK已有观察者顶层接口： java.util.EventListener\n 2. JDK已有消息实体顶层父类： java.util.EventObject\n\n \n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/designPatterns/observerPattern.png","slug":"观察者模式","published":1,"updated":"2018-03-30T09:30:17.276Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfwa004shwvfrt79b0en","content":"<p>当对象间存在一对多关系时，则使用观察者模式（Observer Pattern）。比如，当一个对象被修改时，则会自动通知它的依赖对象。观察者模式属于行为型模式。</p>\n<a id=\"more\"></a>\n<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p><strong>意图</strong>：定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。<br><strong>主要解决</strong>：一个对象状态改变给其他对象通知的问题，而且要考虑到易用和低耦合，保证高度的协作。<br><strong>关键代码</strong>：在抽象类（主题、被观察者）里有一个 <strong>集合</strong> 存放观察者们。<br><strong>优点</strong>： </p>\n<ol>\n<li>观察者和被观察者是抽象耦合的。 </li>\n<li>建立一套触发机制。<br><strong>缺点</strong>：<br>1、如果一个被观察者对象有很多的直接和间接的观察者的话，将所有的观察者都通知到会花费很多时间。<br>2、如果在观察者和观察目标之间有循环依赖的话，观察目标会触发它们之间进行循环调用，可能导致系统崩溃。<br>3、观察者模式没有相应的机制让观察者知道所观察的目标对象是怎么发生变化的，而仅仅只是知道观察目标发生了变化。<br><strong>注意事项</strong>：<br>1、JAVA 中已经有了对观察者模式的支持类。<br>2、避免循环引用。<br>3、如果顺序执行，某一观察者错误会导致系统卡壳，一般采用异步方式。</li>\n</ol>\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h2><p>观察者模式主要使用的5个类或接口对象。</p>\n<ol>\n<li>主题（被观察者）接口：定义绑定、移除、通知观察者的方法</li>\n<li>主题实现类：实现上述三个方法，包含一个观察者引用队列</li>\n<li>观察者接口：定义了该类观察者要实现的方法</li>\n<li>观察者实现类：实现具体的观察者接口，初始化时将自己注册到主题的观察者引用队列</li>\n<li>消息实体类：主题和观察者之间传递的消息实体</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/designPatterns/observerPattern.png\" alt=\"观察者模式结构\"></p>\n<h2 id=\"改进\"><a href=\"#改进\" class=\"headerlink\" title=\"改进\"></a>改进</h2><ol>\n<li>JDK已有观察者顶层接口： java.util.EventListener</li>\n<li>JDK已有消息实体顶层父类： java.util.EventObject</li>\n</ol>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>当对象间存在一对多关系时，则使用观察者模式（Observer Pattern）。比如，当一个对象被修改时，则会自动通知它的依赖对象。观察者模式属于行为型模式。</p>","more":"<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p><strong>意图</strong>：定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。<br><strong>主要解决</strong>：一个对象状态改变给其他对象通知的问题，而且要考虑到易用和低耦合，保证高度的协作。<br><strong>关键代码</strong>：在抽象类（主题、被观察者）里有一个 <strong>集合</strong> 存放观察者们。<br><strong>优点</strong>： </p>\n<ol>\n<li>观察者和被观察者是抽象耦合的。 </li>\n<li>建立一套触发机制。<br><strong>缺点</strong>：<br>1、如果一个被观察者对象有很多的直接和间接的观察者的话，将所有的观察者都通知到会花费很多时间。<br>2、如果在观察者和观察目标之间有循环依赖的话，观察目标会触发它们之间进行循环调用，可能导致系统崩溃。<br>3、观察者模式没有相应的机制让观察者知道所观察的目标对象是怎么发生变化的，而仅仅只是知道观察目标发生了变化。<br><strong>注意事项</strong>：<br>1、JAVA 中已经有了对观察者模式的支持类。<br>2、避免循环引用。<br>3、如果顺序执行，某一观察者错误会导致系统卡壳，一般采用异步方式。</li>\n</ol>\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h2><p>观察者模式主要使用的5个类或接口对象。</p>\n<ol>\n<li>主题（被观察者）接口：定义绑定、移除、通知观察者的方法</li>\n<li>主题实现类：实现上述三个方法，包含一个观察者引用队列</li>\n<li>观察者接口：定义了该类观察者要实现的方法</li>\n<li>观察者实现类：实现具体的观察者接口，初始化时将自己注册到主题的观察者引用队列</li>\n<li>消息实体类：主题和观察者之间传递的消息实体</li>\n</ol>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/designPatterns/observerPattern.png\" alt=\"观察者模式结构\"></p>\n<h2 id=\"改进\"><a href=\"#改进\" class=\"headerlink\" title=\"改进\"></a>改进</h2><ol>\n<li>JDK已有观察者顶层接口： java.util.EventListener</li>\n<li>JDK已有消息实体顶层父类： java.util.EventObject</li>\n</ol>"},{"title":"常见排序算法","date":"2018-03-07T11:48:45.000Z","_content":"我们通常所说的排序算法往往指的是内部排序算法，即数据记录在内存中进行排序。\n\n排序算法大体可分为两种：\n\n - 比较排序\n 时间复杂度O(nlogn) ~ O(n^2)，主要有：冒泡排序，选择排序，插入排序，归并排序，堆排序，快速排序等。\n - 非比较排序\n 时间复杂度可以达到O(n)，主要有：计数排序，基数排序，桶排序等。\n\n<!--more-->\n\n![排序对比][1]\n \n## 1、冒泡排序(Bubble Sort)\n\n冒泡排序算法的运作如下：\n\n 1. 比较相邻的元素，如果前一个比后一个大，就把它们两个调换位置。\n 2. 对每一对相邻元素作同样的工作，从开始第一对到结尾的最后一对。这步做完后，最后的元素会是最大的数。\n 3. 针对所有的元素重复以上的步骤，除了最后一个。\n 4. 持续每次对越来越少的元素重复上面的步骤，直到没有任何一对数字需要比较。\n\n由于它的简洁，冒泡排序通常被用来对于程序设计入门的学生介绍算法的概念。冒泡排序的代码如下：\n\n```java\n/**\n * 冒泡排序算法：平均o(n^2) 稳定 相邻两个比较，最大或最小的移到最右边\n *      \n * @author xiaoyue\n * @created @2018年3月6日-下午7:16:01\n *\n */\npublic class BubbleSort {\n\n    public static void main(String[] args) {\n        int A[] = { 6, 5, 3, 1, 8, 7, 2, 4 }; // 从小到大冒泡排序\n        int size = A.length;\n\n        for (int i = 0; i < size - 1; i++) {// 每次最大元素就像气泡一样\"浮\"到数组的最后\n            for (int j = 0; j < size - 1 - i; j++) { //依次比较相邻的两个元素,使较大的那个向后移\n                if (A[j] > A[j + 1]) { // 如果条件改成A[j] >= A[j + 1],则变为不稳定的排序算法\n                    int temp = A[j];\n                    A[j] = A[j + 1];\n                    A[j + 1] = temp;\n                }\n            }\n        }\n        for (int i = 0; i < size; i++) {\n            System.out.print(A[i] + \", \");\n        }\n    }\n\n}\n```\n\n## 2、选择排序(Selection Sort)\n\n选择排序也是一种简单直观的排序算法。它的工作原理很容易理解：初始时在序列中找到最小（大）元素，放到序列的起始位置作为已排序序列；然后，再从剩余未排序元素中继续寻找最小（大）元素，放到已排序序列的末尾。以此类推，直到所有元素均排序完毕。\n\n　　注意选择排序与冒泡排序的区别：冒泡排序通过依次交换相邻两个顺序不合法的元素位置，从而将当前最小（大）元素放到合适的位置；而选择排序每遍历一次都记住了当前最小（大）元素的位置，最后仅需一次交换操作即可将其放到合适的位置。\n\n```java\npublic static void main(String[] args) {\n        int A[] = { 8, 5, 2, 6, 9, 3, 1, 4, 0, 7 }; // 从小到大选择排序\n        int size = A.length;\n\n        for (int i = 0; i < size - 1; i++) {//循环比对次数，除了最后一个数\n            int min = i;\n            for (int j = i + 1; j < size; j++) {//选择用来比对的数，从当前下一位到最后一位\n                if (A[j] < A[min]) {\n                    min = j;\n                }\n            }\n            if (min != i) { //放到已排序序列的末尾，该操作很有可能把稳定性打乱，所以选择排序是不稳定的排序算法\n                int temp = A[i];\n                A[i] = A[min];\n                A[min] = temp;\n            }\n        }\n        \n        for (int i = 0; i < size; i++) {\n            System.out.print(A[i] + \", \");\n        }\n        \n    }\n```\n\n\n## 3、插入排序(Insertion Sort)\n\n具体算法描述如下：\n\n 1. 从第一个元素开始，该元素可以认为已经被排序\n 2. 取出下一个元素，在已经排序的元素序列中从后向前扫描\n 3. 如果该元素（已排序）大于新元素，将该元素移到下一位置\n 4. 重复步骤3，直到找到已排序的元素小于或者等于新元素的位置\n 5. 将新元素插入到该位置后\n 6. 重复步骤2~5\n\n```java\npublic static void main(String[] args) {\n        int A[] = { 6, 5, 3, 1, 8, 7, 2, 4 };// 从小到大插入排序\n        int size = A.length;\n\n        for (int i = 1; i < size; i++) {\n            int get = A[i];// 右手抓到一张扑克牌\n            int j = i - 1;// 拿在左手上的牌总是排序好的\n            while (j >= 0 && A[j] > get) {// 将抓到的牌与手牌从右向左进行比较\n                A[j + 1] = A[j];// 如果该手牌比抓到的牌大，就将其右移\n                j--;\n            }\n            A[j + 1] = get;// 直到该手牌比抓到的牌小(或二者相等)，将抓到的牌插入到该手牌右边\n                           //(相等元素的相对次序未变，所以插入排序是稳定的)\n        }\n\n        for (int i = 0; i < size; i++) {\n            System.out.print(A[i] + \", \");\n        }\n    }\n```\n\n## 4、快速排序(Quick Sort)  \n\n快速排序使用分治策略(Divide and Conquer)来把一个序列分为两个子序列。步骤为：\n\n 1. 从序列中挑出一个元素，作为\"基准\"(pivot).\n 2. 把所有比基准值小的元素放在基准前面，所有比基准值大的元素放在基准的后面（相同的数可以到任一边），这个称为分区(partition)操作。\n 3. 对每个分区递归地进行步骤1~2，递归的结束条件是序列的大小是0或1，这时整体已经被排好序了。\n\n```java\npublic static void main(String[] args) {\n    int a[] = { 49, 37, 65, 97, 76, 13, 27, 49, 78 };\n\n    int low = 0;\n    int high = a.length-1;\n\n    quickSort(a, low, high);\n    \n    for (int i = 0; i < a.length; i++) {\n        System.out.print(a[i]+\" \");\n    }\n\n}\n\nprivate static void quickSort(int[] a, int low, int high) {\n    int i = low,j = high;\n    if (i > j) {\n        return;\n    }\n    while (i < j) {\n        while (i<j && a[j]>=a[low]) {//从后往前找小于基准数的位置\n            j--;\n        }\n        while (i<j && a[i]<=a[low]) {//从前往后找大于基准数的位置\n            i++;\n        }\n        if (i < j) {//注意，i,j不能相遇或交叉\n            swap(a,i,j);\n        }\n    }\n    swap(a, low, j);\n    quickSort(a, low, j-1);\n    quickSort(a, j+1, high);\n\n}\n```\n\n## Arrays.sort()\n\nJava系统提供的Arrays.sort函数。对于基础类型，底层使用快速排序。对于非基础类型，底层使用归并排序。请问是为什么？\n\n答：这是考虑到排序算法的稳定性。对于基础类型，相同值是无差别的，排序前后相同值的相对位置并不重要，所以选择更为高效的快速排序，尽管它是不稳定的排序算法；而对于非基础类型，排序前后相等实例的相对位置不宜改变，所以选择稳定的归并排序。 \n\n## 参考资料\n\n[常用排序算法总结(一)][2]\n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/algorithm/sortCompare.png\n  [2]: http://www.cnblogs.com/eniac12/p/5329396.html","source":"_posts/常见排序算法.md","raw":"---\ntitle: 常见排序算法\ncategories:\n  - 算法\ntags:\n  - 算法\ndate: 2018-03-07 19:48:45\n---\n我们通常所说的排序算法往往指的是内部排序算法，即数据记录在内存中进行排序。\n\n排序算法大体可分为两种：\n\n - 比较排序\n 时间复杂度O(nlogn) ~ O(n^2)，主要有：冒泡排序，选择排序，插入排序，归并排序，堆排序，快速排序等。\n - 非比较排序\n 时间复杂度可以达到O(n)，主要有：计数排序，基数排序，桶排序等。\n\n<!--more-->\n\n![排序对比][1]\n \n## 1、冒泡排序(Bubble Sort)\n\n冒泡排序算法的运作如下：\n\n 1. 比较相邻的元素，如果前一个比后一个大，就把它们两个调换位置。\n 2. 对每一对相邻元素作同样的工作，从开始第一对到结尾的最后一对。这步做完后，最后的元素会是最大的数。\n 3. 针对所有的元素重复以上的步骤，除了最后一个。\n 4. 持续每次对越来越少的元素重复上面的步骤，直到没有任何一对数字需要比较。\n\n由于它的简洁，冒泡排序通常被用来对于程序设计入门的学生介绍算法的概念。冒泡排序的代码如下：\n\n```java\n/**\n * 冒泡排序算法：平均o(n^2) 稳定 相邻两个比较，最大或最小的移到最右边\n *      \n * @author xiaoyue\n * @created @2018年3月6日-下午7:16:01\n *\n */\npublic class BubbleSort {\n\n    public static void main(String[] args) {\n        int A[] = { 6, 5, 3, 1, 8, 7, 2, 4 }; // 从小到大冒泡排序\n        int size = A.length;\n\n        for (int i = 0; i < size - 1; i++) {// 每次最大元素就像气泡一样\"浮\"到数组的最后\n            for (int j = 0; j < size - 1 - i; j++) { //依次比较相邻的两个元素,使较大的那个向后移\n                if (A[j] > A[j + 1]) { // 如果条件改成A[j] >= A[j + 1],则变为不稳定的排序算法\n                    int temp = A[j];\n                    A[j] = A[j + 1];\n                    A[j + 1] = temp;\n                }\n            }\n        }\n        for (int i = 0; i < size; i++) {\n            System.out.print(A[i] + \", \");\n        }\n    }\n\n}\n```\n\n## 2、选择排序(Selection Sort)\n\n选择排序也是一种简单直观的排序算法。它的工作原理很容易理解：初始时在序列中找到最小（大）元素，放到序列的起始位置作为已排序序列；然后，再从剩余未排序元素中继续寻找最小（大）元素，放到已排序序列的末尾。以此类推，直到所有元素均排序完毕。\n\n　　注意选择排序与冒泡排序的区别：冒泡排序通过依次交换相邻两个顺序不合法的元素位置，从而将当前最小（大）元素放到合适的位置；而选择排序每遍历一次都记住了当前最小（大）元素的位置，最后仅需一次交换操作即可将其放到合适的位置。\n\n```java\npublic static void main(String[] args) {\n        int A[] = { 8, 5, 2, 6, 9, 3, 1, 4, 0, 7 }; // 从小到大选择排序\n        int size = A.length;\n\n        for (int i = 0; i < size - 1; i++) {//循环比对次数，除了最后一个数\n            int min = i;\n            for (int j = i + 1; j < size; j++) {//选择用来比对的数，从当前下一位到最后一位\n                if (A[j] < A[min]) {\n                    min = j;\n                }\n            }\n            if (min != i) { //放到已排序序列的末尾，该操作很有可能把稳定性打乱，所以选择排序是不稳定的排序算法\n                int temp = A[i];\n                A[i] = A[min];\n                A[min] = temp;\n            }\n        }\n        \n        for (int i = 0; i < size; i++) {\n            System.out.print(A[i] + \", \");\n        }\n        \n    }\n```\n\n\n## 3、插入排序(Insertion Sort)\n\n具体算法描述如下：\n\n 1. 从第一个元素开始，该元素可以认为已经被排序\n 2. 取出下一个元素，在已经排序的元素序列中从后向前扫描\n 3. 如果该元素（已排序）大于新元素，将该元素移到下一位置\n 4. 重复步骤3，直到找到已排序的元素小于或者等于新元素的位置\n 5. 将新元素插入到该位置后\n 6. 重复步骤2~5\n\n```java\npublic static void main(String[] args) {\n        int A[] = { 6, 5, 3, 1, 8, 7, 2, 4 };// 从小到大插入排序\n        int size = A.length;\n\n        for (int i = 1; i < size; i++) {\n            int get = A[i];// 右手抓到一张扑克牌\n            int j = i - 1;// 拿在左手上的牌总是排序好的\n            while (j >= 0 && A[j] > get) {// 将抓到的牌与手牌从右向左进行比较\n                A[j + 1] = A[j];// 如果该手牌比抓到的牌大，就将其右移\n                j--;\n            }\n            A[j + 1] = get;// 直到该手牌比抓到的牌小(或二者相等)，将抓到的牌插入到该手牌右边\n                           //(相等元素的相对次序未变，所以插入排序是稳定的)\n        }\n\n        for (int i = 0; i < size; i++) {\n            System.out.print(A[i] + \", \");\n        }\n    }\n```\n\n## 4、快速排序(Quick Sort)  \n\n快速排序使用分治策略(Divide and Conquer)来把一个序列分为两个子序列。步骤为：\n\n 1. 从序列中挑出一个元素，作为\"基准\"(pivot).\n 2. 把所有比基准值小的元素放在基准前面，所有比基准值大的元素放在基准的后面（相同的数可以到任一边），这个称为分区(partition)操作。\n 3. 对每个分区递归地进行步骤1~2，递归的结束条件是序列的大小是0或1，这时整体已经被排好序了。\n\n```java\npublic static void main(String[] args) {\n    int a[] = { 49, 37, 65, 97, 76, 13, 27, 49, 78 };\n\n    int low = 0;\n    int high = a.length-1;\n\n    quickSort(a, low, high);\n    \n    for (int i = 0; i < a.length; i++) {\n        System.out.print(a[i]+\" \");\n    }\n\n}\n\nprivate static void quickSort(int[] a, int low, int high) {\n    int i = low,j = high;\n    if (i > j) {\n        return;\n    }\n    while (i < j) {\n        while (i<j && a[j]>=a[low]) {//从后往前找小于基准数的位置\n            j--;\n        }\n        while (i<j && a[i]<=a[low]) {//从前往后找大于基准数的位置\n            i++;\n        }\n        if (i < j) {//注意，i,j不能相遇或交叉\n            swap(a,i,j);\n        }\n    }\n    swap(a, low, j);\n    quickSort(a, low, j-1);\n    quickSort(a, j+1, high);\n\n}\n```\n\n## Arrays.sort()\n\nJava系统提供的Arrays.sort函数。对于基础类型，底层使用快速排序。对于非基础类型，底层使用归并排序。请问是为什么？\n\n答：这是考虑到排序算法的稳定性。对于基础类型，相同值是无差别的，排序前后相同值的相对位置并不重要，所以选择更为高效的快速排序，尽管它是不稳定的排序算法；而对于非基础类型，排序前后相等实例的相对位置不宜改变，所以选择稳定的归并排序。 \n\n## 参考资料\n\n[常用排序算法总结(一)][2]\n\n\n  [1]: https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/algorithm/sortCompare.png\n  [2]: http://www.cnblogs.com/eniac12/p/5329396.html","slug":"常见排序算法","published":1,"updated":"2018-03-07T11:49:38.034Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfwg004xhwvf2bvp9qkv","content":"<p>我们通常所说的排序算法往往指的是内部排序算法，即数据记录在内存中进行排序。</p>\n<p>排序算法大体可分为两种：</p>\n<ul>\n<li>比较排序<br>时间复杂度O(nlogn) ~ O(n^2)，主要有：冒泡排序，选择排序，插入排序，归并排序，堆排序，快速排序等。</li>\n<li>非比较排序<br>时间复杂度可以达到O(n)，主要有：计数排序，基数排序，桶排序等。</li>\n</ul>\n<a id=\"more\"></a>\n<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/algorithm/sortCompare.png\" alt=\"排序对比\"></p>\n<h2 id=\"1、冒泡排序-Bubble-Sort\"><a href=\"#1、冒泡排序-Bubble-Sort\" class=\"headerlink\" title=\"1、冒泡排序(Bubble Sort)\"></a>1、冒泡排序(Bubble Sort)</h2><p>冒泡排序算法的运作如下：</p>\n<ol>\n<li>比较相邻的元素，如果前一个比后一个大，就把它们两个调换位置。</li>\n<li>对每一对相邻元素作同样的工作，从开始第一对到结尾的最后一对。这步做完后，最后的元素会是最大的数。</li>\n<li>针对所有的元素重复以上的步骤，除了最后一个。</li>\n<li>持续每次对越来越少的元素重复上面的步骤，直到没有任何一对数字需要比较。</li>\n</ol>\n<p>由于它的简洁，冒泡排序通常被用来对于程序设计入门的学生介绍算法的概念。冒泡排序的代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 冒泡排序算法：平均o(n^2) 稳定 相邻两个比较，最大或最小的移到最右边</div><div class=\"line\"> *      </div><div class=\"line\"> * <span class=\"doctag\">@author</span> xiaoyue</div><div class=\"line\"> * <span class=\"doctag\">@created</span> @2018年3月6日-下午7:16:01</div><div class=\"line\"> *</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BubbleSort</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> A[] = &#123; <span class=\"number\">6</span>, <span class=\"number\">5</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"number\">8</span>, <span class=\"number\">7</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span> &#125;; <span class=\"comment\">// 从小到大冒泡排序</span></div><div class=\"line\">        <span class=\"keyword\">int</span> size = A.length;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; size - <span class=\"number\">1</span>; i++) &#123;<span class=\"comment\">// 每次最大元素就像气泡一样\"浮\"到数组的最后</span></div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; size - <span class=\"number\">1</span> - i; j++) &#123; <span class=\"comment\">//依次比较相邻的两个元素,使较大的那个向后移</span></div><div class=\"line\">                <span class=\"keyword\">if</span> (A[j] &gt; A[j + <span class=\"number\">1</span>]) &#123; <span class=\"comment\">// 如果条件改成A[j] &gt;= A[j + 1],则变为不稳定的排序算法</span></div><div class=\"line\">                    <span class=\"keyword\">int</span> temp = A[j];</div><div class=\"line\">                    A[j] = A[j + <span class=\"number\">1</span>];</div><div class=\"line\">                    A[j + <span class=\"number\">1</span>] = temp;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; size; i++) &#123;</div><div class=\"line\">            System.out.print(A[i] + <span class=\"string\">\", \"</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"2、选择排序-Selection-Sort\"><a href=\"#2、选择排序-Selection-Sort\" class=\"headerlink\" title=\"2、选择排序(Selection Sort)\"></a>2、选择排序(Selection Sort)</h2><p>选择排序也是一种简单直观的排序算法。它的工作原理很容易理解：初始时在序列中找到最小（大）元素，放到序列的起始位置作为已排序序列；然后，再从剩余未排序元素中继续寻找最小（大）元素，放到已排序序列的末尾。以此类推，直到所有元素均排序完毕。</p>\n<p>　　注意选择排序与冒泡排序的区别：冒泡排序通过依次交换相邻两个顺序不合法的元素位置，从而将当前最小（大）元素放到合适的位置；而选择排序每遍历一次都记住了当前最小（大）元素的位置，最后仅需一次交换操作即可将其放到合适的位置。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> A[] = &#123; <span class=\"number\">8</span>, <span class=\"number\">5</span>, <span class=\"number\">2</span>, <span class=\"number\">6</span>, <span class=\"number\">9</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"number\">4</span>, <span class=\"number\">0</span>, <span class=\"number\">7</span> &#125;; <span class=\"comment\">// 从小到大选择排序</span></div><div class=\"line\">        <span class=\"keyword\">int</span> size = A.length;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; size - <span class=\"number\">1</span>; i++) &#123;<span class=\"comment\">//循环比对次数，除了最后一个数</span></div><div class=\"line\">            <span class=\"keyword\">int</span> min = i;</div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = i + <span class=\"number\">1</span>; j &lt; size; j++) &#123;<span class=\"comment\">//选择用来比对的数，从当前下一位到最后一位</span></div><div class=\"line\">                <span class=\"keyword\">if</span> (A[j] &lt; A[min]) &#123;</div><div class=\"line\">                    min = j;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">if</span> (min != i) &#123; <span class=\"comment\">//放到已排序序列的末尾，该操作很有可能把稳定性打乱，所以选择排序是不稳定的排序算法</span></div><div class=\"line\">                <span class=\"keyword\">int</span> temp = A[i];</div><div class=\"line\">                A[i] = A[min];</div><div class=\"line\">                A[min] = temp;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        </div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; size; i++) &#123;</div><div class=\"line\">            System.out.print(A[i] + <span class=\"string\">\", \"</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">        </div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h2 id=\"3、插入排序-Insertion-Sort\"><a href=\"#3、插入排序-Insertion-Sort\" class=\"headerlink\" title=\"3、插入排序(Insertion Sort)\"></a>3、插入排序(Insertion Sort)</h2><p>具体算法描述如下：</p>\n<ol>\n<li>从第一个元素开始，该元素可以认为已经被排序</li>\n<li>取出下一个元素，在已经排序的元素序列中从后向前扫描</li>\n<li>如果该元素（已排序）大于新元素，将该元素移到下一位置</li>\n<li>重复步骤3，直到找到已排序的元素小于或者等于新元素的位置</li>\n<li>将新元素插入到该位置后</li>\n<li>重复步骤2~5</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> A[] = &#123; <span class=\"number\">6</span>, <span class=\"number\">5</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"number\">8</span>, <span class=\"number\">7</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span> &#125;;<span class=\"comment\">// 从小到大插入排序</span></div><div class=\"line\">        <span class=\"keyword\">int</span> size = A.length;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &lt; size; i++) &#123;</div><div class=\"line\">            <span class=\"keyword\">int</span> get = A[i];<span class=\"comment\">// 右手抓到一张扑克牌</span></div><div class=\"line\">            <span class=\"keyword\">int</span> j = i - <span class=\"number\">1</span>;<span class=\"comment\">// 拿在左手上的牌总是排序好的</span></div><div class=\"line\">            <span class=\"keyword\">while</span> (j &gt;= <span class=\"number\">0</span> &amp;&amp; A[j] &gt; get) &#123;<span class=\"comment\">// 将抓到的牌与手牌从右向左进行比较</span></div><div class=\"line\">                A[j + <span class=\"number\">1</span>] = A[j];<span class=\"comment\">// 如果该手牌比抓到的牌大，就将其右移</span></div><div class=\"line\">                j--;</div><div class=\"line\">            &#125;</div><div class=\"line\">            A[j + <span class=\"number\">1</span>] = get;<span class=\"comment\">// 直到该手牌比抓到的牌小(或二者相等)，将抓到的牌插入到该手牌右边</span></div><div class=\"line\">                           <span class=\"comment\">//(相等元素的相对次序未变，所以插入排序是稳定的)</span></div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; size; i++) &#123;</div><div class=\"line\">            System.out.print(A[i] + <span class=\"string\">\", \"</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h2 id=\"4、快速排序-Quick-Sort\"><a href=\"#4、快速排序-Quick-Sort\" class=\"headerlink\" title=\"4、快速排序(Quick Sort)\"></a>4、快速排序(Quick Sort)</h2><p>快速排序使用分治策略(Divide and Conquer)来把一个序列分为两个子序列。步骤为：</p>\n<ol>\n<li>从序列中挑出一个元素，作为”基准”(pivot).</li>\n<li>把所有比基准值小的元素放在基准前面，所有比基准值大的元素放在基准的后面（相同的数可以到任一边），这个称为分区(partition)操作。</li>\n<li>对每个分区递归地进行步骤1~2，递归的结束条件是序列的大小是0或1，这时整体已经被排好序了。</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> a[] = &#123; <span class=\"number\">49</span>, <span class=\"number\">37</span>, <span class=\"number\">65</span>, <span class=\"number\">97</span>, <span class=\"number\">76</span>, <span class=\"number\">13</span>, <span class=\"number\">27</span>, <span class=\"number\">49</span>, <span class=\"number\">78</span> &#125;;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">int</span> low = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> high = a.length-<span class=\"number\">1</span>;</div><div class=\"line\"></div><div class=\"line\">    quickSort(a, low, high);</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; a.length; i++) &#123;</div><div class=\"line\">        System.out.print(a[i]+<span class=\"string\">\" \"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">quickSort</span><span class=\"params\">(<span class=\"keyword\">int</span>[] a, <span class=\"keyword\">int</span> low, <span class=\"keyword\">int</span> high)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> i = low,j = high;</div><div class=\"line\">    <span class=\"keyword\">if</span> (i &gt; j) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">while</span> (i &lt; j) &#123;</div><div class=\"line\">        <span class=\"keyword\">while</span> (i&lt;j &amp;&amp; a[j]&gt;=a[low]) &#123;<span class=\"comment\">//从后往前找小于基准数的位置</span></div><div class=\"line\">            j--;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">while</span> (i&lt;j &amp;&amp; a[i]&lt;=a[low]) &#123;<span class=\"comment\">//从前往后找大于基准数的位置</span></div><div class=\"line\">            i++;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">if</span> (i &lt; j) &#123;<span class=\"comment\">//注意，i,j不能相遇或交叉</span></div><div class=\"line\">            swap(a,i,j);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    swap(a, low, j);</div><div class=\"line\">    quickSort(a, low, j-<span class=\"number\">1</span>);</div><div class=\"line\">    quickSort(a, j+<span class=\"number\">1</span>, high);</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"Arrays-sort\"><a href=\"#Arrays-sort\" class=\"headerlink\" title=\"Arrays.sort()\"></a>Arrays.sort()</h2><p>Java系统提供的Arrays.sort函数。对于基础类型，底层使用快速排序。对于非基础类型，底层使用归并排序。请问是为什么？</p>\n<p>答：这是考虑到排序算法的稳定性。对于基础类型，相同值是无差别的，排序前后相同值的相对位置并不重要，所以选择更为高效的快速排序，尽管它是不稳定的排序算法；而对于非基础类型，排序前后相等实例的相对位置不宜改变，所以选择稳定的归并排序。 </p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><p><a href=\"http://www.cnblogs.com/eniac12/p/5329396.html\" target=\"_blank\" rel=\"noopener\">常用排序算法总结(一)</a></p>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>我们通常所说的排序算法往往指的是内部排序算法，即数据记录在内存中进行排序。</p>\n<p>排序算法大体可分为两种：</p>\n<ul>\n<li>比较排序<br>时间复杂度O(nlogn) ~ O(n^2)，主要有：冒泡排序，选择排序，插入排序，归并排序，堆排序，快速排序等。</li>\n<li>非比较排序<br>时间复杂度可以达到O(n)，主要有：计数排序，基数排序，桶排序等。</li>\n</ul>","more":"<p><img src=\"https://raw.githubusercontent.com/kevinXiao2016/kevinXiao2016.github.io/hexo/imageStorage/algorithm/sortCompare.png\" alt=\"排序对比\"></p>\n<h2 id=\"1、冒泡排序-Bubble-Sort\"><a href=\"#1、冒泡排序-Bubble-Sort\" class=\"headerlink\" title=\"1、冒泡排序(Bubble Sort)\"></a>1、冒泡排序(Bubble Sort)</h2><p>冒泡排序算法的运作如下：</p>\n<ol>\n<li>比较相邻的元素，如果前一个比后一个大，就把它们两个调换位置。</li>\n<li>对每一对相邻元素作同样的工作，从开始第一对到结尾的最后一对。这步做完后，最后的元素会是最大的数。</li>\n<li>针对所有的元素重复以上的步骤，除了最后一个。</li>\n<li>持续每次对越来越少的元素重复上面的步骤，直到没有任何一对数字需要比较。</li>\n</ol>\n<p>由于它的简洁，冒泡排序通常被用来对于程序设计入门的学生介绍算法的概念。冒泡排序的代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"> * 冒泡排序算法：平均o(n^2) 稳定 相邻两个比较，最大或最小的移到最右边</div><div class=\"line\"> *      </div><div class=\"line\"> * <span class=\"doctag\">@author</span> xiaoyue</div><div class=\"line\"> * <span class=\"doctag\">@created</span> @2018年3月6日-下午7:16:01</div><div class=\"line\"> *</div><div class=\"line\"> */</div><div class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BubbleSort</span> </span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> A[] = &#123; <span class=\"number\">6</span>, <span class=\"number\">5</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"number\">8</span>, <span class=\"number\">7</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span> &#125;; <span class=\"comment\">// 从小到大冒泡排序</span></div><div class=\"line\">        <span class=\"keyword\">int</span> size = A.length;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; size - <span class=\"number\">1</span>; i++) &#123;<span class=\"comment\">// 每次最大元素就像气泡一样\"浮\"到数组的最后</span></div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; size - <span class=\"number\">1</span> - i; j++) &#123; <span class=\"comment\">//依次比较相邻的两个元素,使较大的那个向后移</span></div><div class=\"line\">                <span class=\"keyword\">if</span> (A[j] &gt; A[j + <span class=\"number\">1</span>]) &#123; <span class=\"comment\">// 如果条件改成A[j] &gt;= A[j + 1],则变为不稳定的排序算法</span></div><div class=\"line\">                    <span class=\"keyword\">int</span> temp = A[j];</div><div class=\"line\">                    A[j] = A[j + <span class=\"number\">1</span>];</div><div class=\"line\">                    A[j + <span class=\"number\">1</span>] = temp;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; size; i++) &#123;</div><div class=\"line\">            System.out.print(A[i] + <span class=\"string\">\", \"</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"2、选择排序-Selection-Sort\"><a href=\"#2、选择排序-Selection-Sort\" class=\"headerlink\" title=\"2、选择排序(Selection Sort)\"></a>2、选择排序(Selection Sort)</h2><p>选择排序也是一种简单直观的排序算法。它的工作原理很容易理解：初始时在序列中找到最小（大）元素，放到序列的起始位置作为已排序序列；然后，再从剩余未排序元素中继续寻找最小（大）元素，放到已排序序列的末尾。以此类推，直到所有元素均排序完毕。</p>\n<p>　　注意选择排序与冒泡排序的区别：冒泡排序通过依次交换相邻两个顺序不合法的元素位置，从而将当前最小（大）元素放到合适的位置；而选择排序每遍历一次都记住了当前最小（大）元素的位置，最后仅需一次交换操作即可将其放到合适的位置。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> A[] = &#123; <span class=\"number\">8</span>, <span class=\"number\">5</span>, <span class=\"number\">2</span>, <span class=\"number\">6</span>, <span class=\"number\">9</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"number\">4</span>, <span class=\"number\">0</span>, <span class=\"number\">7</span> &#125;; <span class=\"comment\">// 从小到大选择排序</span></div><div class=\"line\">        <span class=\"keyword\">int</span> size = A.length;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; size - <span class=\"number\">1</span>; i++) &#123;<span class=\"comment\">//循环比对次数，除了最后一个数</span></div><div class=\"line\">            <span class=\"keyword\">int</span> min = i;</div><div class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = i + <span class=\"number\">1</span>; j &lt; size; j++) &#123;<span class=\"comment\">//选择用来比对的数，从当前下一位到最后一位</span></div><div class=\"line\">                <span class=\"keyword\">if</span> (A[j] &lt; A[min]) &#123;</div><div class=\"line\">                    min = j;</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"keyword\">if</span> (min != i) &#123; <span class=\"comment\">//放到已排序序列的末尾，该操作很有可能把稳定性打乱，所以选择排序是不稳定的排序算法</span></div><div class=\"line\">                <span class=\"keyword\">int</span> temp = A[i];</div><div class=\"line\">                A[i] = A[min];</div><div class=\"line\">                A[min] = temp;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">        </div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; size; i++) &#123;</div><div class=\"line\">            System.out.print(A[i] + <span class=\"string\">\", \"</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">        </div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h2 id=\"3、插入排序-Insertion-Sort\"><a href=\"#3、插入排序-Insertion-Sort\" class=\"headerlink\" title=\"3、插入排序(Insertion Sort)\"></a>3、插入排序(Insertion Sort)</h2><p>具体算法描述如下：</p>\n<ol>\n<li>从第一个元素开始，该元素可以认为已经被排序</li>\n<li>取出下一个元素，在已经排序的元素序列中从后向前扫描</li>\n<li>如果该元素（已排序）大于新元素，将该元素移到下一位置</li>\n<li>重复步骤3，直到找到已排序的元素小于或者等于新元素的位置</li>\n<li>将新元素插入到该位置后</li>\n<li>重复步骤2~5</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">int</span> A[] = &#123; <span class=\"number\">6</span>, <span class=\"number\">5</span>, <span class=\"number\">3</span>, <span class=\"number\">1</span>, <span class=\"number\">8</span>, <span class=\"number\">7</span>, <span class=\"number\">2</span>, <span class=\"number\">4</span> &#125;;<span class=\"comment\">// 从小到大插入排序</span></div><div class=\"line\">        <span class=\"keyword\">int</span> size = A.length;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">1</span>; i &lt; size; i++) &#123;</div><div class=\"line\">            <span class=\"keyword\">int</span> get = A[i];<span class=\"comment\">// 右手抓到一张扑克牌</span></div><div class=\"line\">            <span class=\"keyword\">int</span> j = i - <span class=\"number\">1</span>;<span class=\"comment\">// 拿在左手上的牌总是排序好的</span></div><div class=\"line\">            <span class=\"keyword\">while</span> (j &gt;= <span class=\"number\">0</span> &amp;&amp; A[j] &gt; get) &#123;<span class=\"comment\">// 将抓到的牌与手牌从右向左进行比较</span></div><div class=\"line\">                A[j + <span class=\"number\">1</span>] = A[j];<span class=\"comment\">// 如果该手牌比抓到的牌大，就将其右移</span></div><div class=\"line\">                j--;</div><div class=\"line\">            &#125;</div><div class=\"line\">            A[j + <span class=\"number\">1</span>] = get;<span class=\"comment\">// 直到该手牌比抓到的牌小(或二者相等)，将抓到的牌插入到该手牌右边</span></div><div class=\"line\">                           <span class=\"comment\">//(相等元素的相对次序未变，所以插入排序是稳定的)</span></div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; size; i++) &#123;</div><div class=\"line\">            System.out.print(A[i] + <span class=\"string\">\", \"</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h2 id=\"4、快速排序-Quick-Sort\"><a href=\"#4、快速排序-Quick-Sort\" class=\"headerlink\" title=\"4、快速排序(Quick Sort)\"></a>4、快速排序(Quick Sort)</h2><p>快速排序使用分治策略(Divide and Conquer)来把一个序列分为两个子序列。步骤为：</p>\n<ol>\n<li>从序列中挑出一个元素，作为”基准”(pivot).</li>\n<li>把所有比基准值小的元素放在基准前面，所有比基准值大的元素放在基准的后面（相同的数可以到任一边），这个称为分区(partition)操作。</li>\n<li>对每个分区递归地进行步骤1~2，递归的结束条件是序列的大小是0或1，这时整体已经被排好序了。</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> a[] = &#123; <span class=\"number\">49</span>, <span class=\"number\">37</span>, <span class=\"number\">65</span>, <span class=\"number\">97</span>, <span class=\"number\">76</span>, <span class=\"number\">13</span>, <span class=\"number\">27</span>, <span class=\"number\">49</span>, <span class=\"number\">78</span> &#125;;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">int</span> low = <span class=\"number\">0</span>;</div><div class=\"line\">    <span class=\"keyword\">int</span> high = a.length-<span class=\"number\">1</span>;</div><div class=\"line\"></div><div class=\"line\">    quickSort(a, low, high);</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; a.length; i++) &#123;</div><div class=\"line\">        System.out.print(a[i]+<span class=\"string\">\" \"</span>);</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">quickSort</span><span class=\"params\">(<span class=\"keyword\">int</span>[] a, <span class=\"keyword\">int</span> low, <span class=\"keyword\">int</span> high)</span> </span>&#123;</div><div class=\"line\">    <span class=\"keyword\">int</span> i = low,j = high;</div><div class=\"line\">    <span class=\"keyword\">if</span> (i &gt; j) &#123;</div><div class=\"line\">        <span class=\"keyword\">return</span>;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"keyword\">while</span> (i &lt; j) &#123;</div><div class=\"line\">        <span class=\"keyword\">while</span> (i&lt;j &amp;&amp; a[j]&gt;=a[low]) &#123;<span class=\"comment\">//从后往前找小于基准数的位置</span></div><div class=\"line\">            j--;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">while</span> (i&lt;j &amp;&amp; a[i]&lt;=a[low]) &#123;<span class=\"comment\">//从前往后找大于基准数的位置</span></div><div class=\"line\">            i++;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"keyword\">if</span> (i &lt; j) &#123;<span class=\"comment\">//注意，i,j不能相遇或交叉</span></div><div class=\"line\">            swap(a,i,j);</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    swap(a, low, j);</div><div class=\"line\">    quickSort(a, low, j-<span class=\"number\">1</span>);</div><div class=\"line\">    quickSort(a, j+<span class=\"number\">1</span>, high);</div><div class=\"line\"></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"Arrays-sort\"><a href=\"#Arrays-sort\" class=\"headerlink\" title=\"Arrays.sort()\"></a>Arrays.sort()</h2><p>Java系统提供的Arrays.sort函数。对于基础类型，底层使用快速排序。对于非基础类型，底层使用归并排序。请问是为什么？</p>\n<p>答：这是考虑到排序算法的稳定性。对于基础类型，相同值是无差别的，排序前后相同值的相对位置并不重要，所以选择更为高效的快速排序，尽管它是不稳定的排序算法；而对于非基础类型，排序前后相等实例的相对位置不宜改变，所以选择稳定的归并排序。 </p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><p><a href=\"http://www.cnblogs.com/eniac12/p/5329396.html\" target=\"_blank\" rel=\"noopener\">常用排序算法总结(一)</a></p>"},{"title":"使用i18next完成前端国际化","date":"2017-09-30T01:53:44.000Z","_content":"i18next是一个用来支持应用国际化的javascript库,不依赖于其他第三方js库如jQuuery。[i18next官方网站][3]\n<!--more-->\n\n# 1 初始化init\n\n```javascript\ni18next\n    .use(i18nextXHRBackend)\n    .init({\n        fallbackLng: 'en',\n        lng: 'en',\n        debug: false,\n        ns: 'strings',\n        defaultNS: 'strings',\n        backend: {\n            loadPath: src + '/{{lng}}/{{ns}}.json', //在每个html中定义localesPath，即localesPath文件夹路径\n            crossDomain: true\n        }\n    }, function(err, t) {\n        // init set content\n        var array = document.querySelectorAll('[data-i18n]');\n        if(array){\n            for(var i = 0, len = array.length; i < len; i++) {\n                var value = array[i].getAttribute('data-i18n');\n                array[i].innerHTML = i18next.t(value);\n            }\n        };\n\n        var inputs = document.querySelectorAll('input');\n        if(inputs) {\n            for(var i = 0, len = inputs.length; i < len; i++) {\n            \tvar placeholder = inputs[i].getAttribute(\"placeholder\");\n            \tvar value = inputs[i].getAttribute('data-i18n');\n            \tif(placeholder != null){\n                \tinputs[i].setAttribute(\"placeholder\", i18next.t(value));\n                }\n            }\n        }\n    });\n```\n\n# 2 API\n\n## 2.1 init\n\n    i18next.init(options, callback)\n    \n```javascript\ni18next.init({\n    fallbackLng: 'en',\n    ns: ['file1', 'file2'],\n    defaultNS: 'file1',\n    debug: true\n}, (err, t) => {\n    if(err) return console.log('something went wrong loading', err);\n    t('key'); // -> same as i18next.t\n});\n\n// with only callback\ni18next.init((err, t) => {\n    if(err) return console.log('something went wrong loading', err);\n    t('key'); // -> same as i18next.t\n});\n```\n\n - debug:default false，是否输出日志\n - fallbackLng:default 'dev',当当前语言中找不到key，则去fallbackLng中查找\n - lng:default undefined,设置当前翻译的语言\n - ns：default 'translation'，命名空间，可以是数组，可以理解为国际化文件的名字\n - defaultNS：default 'translation'，如果没有找到设置的ns文件，则去找defaultNS文件\n - backend：设置国际化文件路径，需要配合***i18nextXHRBackend***插件使用，可以跨域读取网络文件，可以读取本地文件。具体配置参看[i18next-xhr-backend][1]\n    -  loadPath： 文件路径\n    -  crossDomain： 是否强制跨域\n\n## 2.2 use\n    \n    i18next.use(module)\n    \n用来添加插件,如下代码所示，注意：一定要在工程中引入对应的js文件\n```javascript\ni18next\n  .use(Backend)\n  .use(Cache)\n  .use(LanguageDetector)\n  .use(postProcessor)\n  .init(options, callback);\n```\n\n## 2.3 t\n\n    i18next.t(keys, options)\n\n在js中手动查找key得到对应翻译，options可省略，基本用法如下，详细用法请参看[interpolation][2]\n\n```javascript\ni18next.t('common.hello') 或 t('common.hello')\n```\n\n# 3 小结\n\n以上是i18next的基本使用，可以满足基本的国际化需求。对于更加复杂的国际化需求，请参看官方文档。\n\n说明：\n\n 1. 国际化文件为json格式\n 2. 国际化文件路径建议设置为 locales/语言（国家代码）/命名空间.json\n 3. 对应第2条，loadPath设置为 locales文件夹路径/{{lng}}/{{ns}}.json\n\n    \n \n\n\n\n  [1]: https://github.com/i18next/i18next-xhr-backend\n  [2]: https://www.i18next.com/interpolation.html\n  [3]: https://github.com/i18next/i18next","source":"_posts/使用i18next完成前端国际化.md","raw":"---\ntitle: 使用i18next完成前端国际化\ncategories:\n  - Web\ntags:\n  - 国际化\ndate: 2017-09-30 09:53:44\n---\ni18next是一个用来支持应用国际化的javascript库,不依赖于其他第三方js库如jQuuery。[i18next官方网站][3]\n<!--more-->\n\n# 1 初始化init\n\n```javascript\ni18next\n    .use(i18nextXHRBackend)\n    .init({\n        fallbackLng: 'en',\n        lng: 'en',\n        debug: false,\n        ns: 'strings',\n        defaultNS: 'strings',\n        backend: {\n            loadPath: src + '/{{lng}}/{{ns}}.json', //在每个html中定义localesPath，即localesPath文件夹路径\n            crossDomain: true\n        }\n    }, function(err, t) {\n        // init set content\n        var array = document.querySelectorAll('[data-i18n]');\n        if(array){\n            for(var i = 0, len = array.length; i < len; i++) {\n                var value = array[i].getAttribute('data-i18n');\n                array[i].innerHTML = i18next.t(value);\n            }\n        };\n\n        var inputs = document.querySelectorAll('input');\n        if(inputs) {\n            for(var i = 0, len = inputs.length; i < len; i++) {\n            \tvar placeholder = inputs[i].getAttribute(\"placeholder\");\n            \tvar value = inputs[i].getAttribute('data-i18n');\n            \tif(placeholder != null){\n                \tinputs[i].setAttribute(\"placeholder\", i18next.t(value));\n                }\n            }\n        }\n    });\n```\n\n# 2 API\n\n## 2.1 init\n\n    i18next.init(options, callback)\n    \n```javascript\ni18next.init({\n    fallbackLng: 'en',\n    ns: ['file1', 'file2'],\n    defaultNS: 'file1',\n    debug: true\n}, (err, t) => {\n    if(err) return console.log('something went wrong loading', err);\n    t('key'); // -> same as i18next.t\n});\n\n// with only callback\ni18next.init((err, t) => {\n    if(err) return console.log('something went wrong loading', err);\n    t('key'); // -> same as i18next.t\n});\n```\n\n - debug:default false，是否输出日志\n - fallbackLng:default 'dev',当当前语言中找不到key，则去fallbackLng中查找\n - lng:default undefined,设置当前翻译的语言\n - ns：default 'translation'，命名空间，可以是数组，可以理解为国际化文件的名字\n - defaultNS：default 'translation'，如果没有找到设置的ns文件，则去找defaultNS文件\n - backend：设置国际化文件路径，需要配合***i18nextXHRBackend***插件使用，可以跨域读取网络文件，可以读取本地文件。具体配置参看[i18next-xhr-backend][1]\n    -  loadPath： 文件路径\n    -  crossDomain： 是否强制跨域\n\n## 2.2 use\n    \n    i18next.use(module)\n    \n用来添加插件,如下代码所示，注意：一定要在工程中引入对应的js文件\n```javascript\ni18next\n  .use(Backend)\n  .use(Cache)\n  .use(LanguageDetector)\n  .use(postProcessor)\n  .init(options, callback);\n```\n\n## 2.3 t\n\n    i18next.t(keys, options)\n\n在js中手动查找key得到对应翻译，options可省略，基本用法如下，详细用法请参看[interpolation][2]\n\n```javascript\ni18next.t('common.hello') 或 t('common.hello')\n```\n\n# 3 小结\n\n以上是i18next的基本使用，可以满足基本的国际化需求。对于更加复杂的国际化需求，请参看官方文档。\n\n说明：\n\n 1. 国际化文件为json格式\n 2. 国际化文件路径建议设置为 locales/语言（国家代码）/命名空间.json\n 3. 对应第2条，loadPath设置为 locales文件夹路径/{{lng}}/{{ns}}.json\n\n    \n \n\n\n\n  [1]: https://github.com/i18next/i18next-xhr-backend\n  [2]: https://www.i18next.com/interpolation.html\n  [3]: https://github.com/i18next/i18next","slug":"使用i18next完成前端国际化","published":1,"updated":"2018-02-27T07:38:38.102Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjgd7qfwk0050hwvf3ija97jx","content":"<p>i18next是一个用来支持应用国际化的javascript库,不依赖于其他第三方js库如jQuuery。<a href=\"https://github.com/i18next/i18next\" target=\"_blank\" rel=\"noopener\">i18next官方网站</a><br><a id=\"more\"></a></p>\n<h1 id=\"1-初始化init\"><a href=\"#1-初始化init\" class=\"headerlink\" title=\"1 初始化init\"></a>1 初始化init</h1><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\">i18next</div><div class=\"line\">    .use(i18nextXHRBackend)</div><div class=\"line\">    .init(&#123;</div><div class=\"line\">        <span class=\"attr\">fallbackLng</span>: <span class=\"string\">'en'</span>,</div><div class=\"line\">        <span class=\"attr\">lng</span>: <span class=\"string\">'en'</span>,</div><div class=\"line\">        <span class=\"attr\">debug</span>: <span class=\"literal\">false</span>,</div><div class=\"line\">        <span class=\"attr\">ns</span>: <span class=\"string\">'strings'</span>,</div><div class=\"line\">        <span class=\"attr\">defaultNS</span>: <span class=\"string\">'strings'</span>,</div><div class=\"line\">        <span class=\"attr\">backend</span>: &#123;</div><div class=\"line\">            <span class=\"attr\">loadPath</span>: src + <span class=\"string\">'/&#123;&#123;lng&#125;&#125;/&#123;&#123;ns&#125;&#125;.json'</span>, <span class=\"comment\">//在每个html中定义localesPath，即localesPath文件夹路径</span></div><div class=\"line\">            crossDomain: <span class=\"literal\">true</span></div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, t</span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// init set content</span></div><div class=\"line\">        <span class=\"keyword\">var</span> array = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">'[data-i18n]'</span>);</div><div class=\"line\">        <span class=\"keyword\">if</span>(array)&#123;</div><div class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = array.length; i &lt; len; i++) &#123;</div><div class=\"line\">                <span class=\"keyword\">var</span> value = array[i].getAttribute(<span class=\"string\">'data-i18n'</span>);</div><div class=\"line\">                array[i].innerHTML = i18next.t(value);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">var</span> inputs = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">'input'</span>);</div><div class=\"line\">        <span class=\"keyword\">if</span>(inputs) &#123;</div><div class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = inputs.length; i &lt; len; i++) &#123;</div><div class=\"line\">            \t<span class=\"keyword\">var</span> placeholder = inputs[i].getAttribute(<span class=\"string\">\"placeholder\"</span>);</div><div class=\"line\">            \t<span class=\"keyword\">var</span> value = inputs[i].getAttribute(<span class=\"string\">'data-i18n'</span>);</div><div class=\"line\">            \t<span class=\"keyword\">if</span>(placeholder != <span class=\"literal\">null</span>)&#123;</div><div class=\"line\">                \tinputs[i].setAttribute(<span class=\"string\">\"placeholder\"</span>, i18next.t(value));</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;);</div></pre></td></tr></table></figure>\n<h1 id=\"2-API\"><a href=\"#2-API\" class=\"headerlink\" title=\"2 API\"></a>2 API</h1><h2 id=\"2-1-init\"><a href=\"#2-1-init\" class=\"headerlink\" title=\"2.1 init\"></a>2.1 init</h2><pre><code>i18next.init(options, callback)\n</code></pre><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">i18next.init(&#123;</div><div class=\"line\">    <span class=\"attr\">fallbackLng</span>: <span class=\"string\">'en'</span>,</div><div class=\"line\">    <span class=\"attr\">ns</span>: [<span class=\"string\">'file1'</span>, <span class=\"string\">'file2'</span>],</div><div class=\"line\">    <span class=\"attr\">defaultNS</span>: <span class=\"string\">'file1'</span>,</div><div class=\"line\">    <span class=\"attr\">debug</span>: <span class=\"literal\">true</span></div><div class=\"line\">&#125;, (err, t) =&gt; &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(err) <span class=\"keyword\">return</span> <span class=\"built_in\">console</span>.log(<span class=\"string\">'something went wrong loading'</span>, err);</div><div class=\"line\">    t(<span class=\"string\">'key'</span>); <span class=\"comment\">// -&gt; same as i18next.t</span></div><div class=\"line\">&#125;);</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// with only callback</span></div><div class=\"line\">i18next.init(<span class=\"function\">(<span class=\"params\">err, t</span>) =&gt;</span> &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(err) <span class=\"keyword\">return</span> <span class=\"built_in\">console</span>.log(<span class=\"string\">'something went wrong loading'</span>, err);</div><div class=\"line\">    t(<span class=\"string\">'key'</span>); <span class=\"comment\">// -&gt; same as i18next.t</span></div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<ul>\n<li>debug:default false，是否输出日志</li>\n<li>fallbackLng:default ‘dev’,当当前语言中找不到key，则去fallbackLng中查找</li>\n<li>lng:default undefined,设置当前翻译的语言</li>\n<li>ns：default ‘translation’，命名空间，可以是数组，可以理解为国际化文件的名字</li>\n<li>defaultNS：default ‘translation’，如果没有找到设置的ns文件，则去找defaultNS文件</li>\n<li>backend：设置国际化文件路径，需要配合<strong><em>i18nextXHRBackend</em></strong>插件使用，可以跨域读取网络文件，可以读取本地文件。具体配置参看<a href=\"https://github.com/i18next/i18next-xhr-backend\" target=\"_blank\" rel=\"noopener\">i18next-xhr-backend</a><ul>\n<li>loadPath： 文件路径</li>\n<li>crossDomain： 是否强制跨域</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"2-2-use\"><a href=\"#2-2-use\" class=\"headerlink\" title=\"2.2 use\"></a>2.2 use</h2><pre><code>i18next.use(module)\n</code></pre><p>用来添加插件,如下代码所示，注意：一定要在工程中引入对应的js文件<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">i18next</div><div class=\"line\">  .use(Backend)</div><div class=\"line\">  .use(Cache)</div><div class=\"line\">  .use(LanguageDetector)</div><div class=\"line\">  .use(postProcessor)</div><div class=\"line\">  .init(options, callback);</div></pre></td></tr></table></figure></p>\n<h2 id=\"2-3-t\"><a href=\"#2-3-t\" class=\"headerlink\" title=\"2.3 t\"></a>2.3 t</h2><pre><code>i18next.t(keys, options)\n</code></pre><p>在js中手动查找key得到对应翻译，options可省略，基本用法如下，详细用法请参看<a href=\"https://www.i18next.com/interpolation.html\" target=\"_blank\" rel=\"noopener\">interpolation</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">i18next.t(<span class=\"string\">'common.hello'</span>) 或 t(<span class=\"string\">'common.hello'</span>)</div></pre></td></tr></table></figure>\n<h1 id=\"3-小结\"><a href=\"#3-小结\" class=\"headerlink\" title=\"3 小结\"></a>3 小结</h1><p>以上是i18next的基本使用，可以满足基本的国际化需求。对于更加复杂的国际化需求，请参看官方文档。</p>\n<p>说明：</p>\n<ol>\n<li>国际化文件为json格式</li>\n<li>国际化文件路径建议设置为 locales/语言（国家代码）/命名空间.json</li>\n<li>对应第2条，loadPath设置为 locales文件夹路径//.json</li>\n</ol>\n","site":{"data":{"next":{"favicon":{"small":"/images/favicon.ico","medium":"/images/favicon.ico","apple_touch_icon":"/images/favicon.ico","safari_pinned_tab":"/images/favicon.ico"},"rss":null,"footer":{"since":2017,"icon":{"name":"heart","animated":true,"color":"#ff0000"},"copyright":null,"powered":true,"theme":{"enable":true,"version":true}},"canonical":true,"seo":true,"index_with_subtitle":false,"sitemap":{"path":"sitemap.xml"},"baidusitemap":{"path":"baidusitemap.xml"},"url":"http://www.greateman.top","menu":{"home":"/ || home","about":"/about/ || user","tags":"/tags/ || tags","categories":"/categories/ || th","archives":"/archives/ || archive"},"menu_settings":{"icons":true,"badges":false},"scheme":"Mist","site_state":true,"social":null,"social_icons":{"enable":true,"icons_only":false,"transition":false,"exturl":false},"github_banner":"https://github.com/kevinXiao2016 || Follow me on GitHub","links_icon":"globe","links_title":"神奇的链接","links_layout":"block","links":{"EMS规范":"http://ems.top-vision.cn:8110/dm/dm.html"},"avatar":"/images/avatar.png","toc":{"enable":true,"number":false,"wrap":false},"sidebar":{"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"scroll_to_more":false,"save_scroll":false,"excerpt_description":false,"auto_excerpt":{"enable":false,"length":150},"post_meta":{"item_text":true,"created_at":true,"updated_at":false,"updated_diff":false,"categories":true},"symbols_count_time":{"separated_meta":true,"item_text_post":true,"item_text_total":false,"awl":5,"wpm":200},"codeblock":{"border_radius":null},"reward_comment":"坚持原创技术分享，您的支持将鼓励我继续创作！","wechatpay":"/images/wechat-reward-image.jpg","alipay":"/images/alipay-reward-image.jpg","related_posts":{"enable":false,"title":null,"display_in_home":false,"params":{"maxCount":5}},"post_copyright":{"enable":false,"license":"<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow\" target=\"_blank\">CC BY-NC-SA 4.0</a>"},"mobile_layout_economy":false,"android_chrome_color":"#222","custom_logo":{"enabled":false,"image":null},"highlight_theme":"normal","cheers_enabled":true,"sidebar_width":null,"font":{"enable":false,"host":null,"global":{"external":true,"family":"Lato","size":null},"headings":{"external":true,"family":null,"size":null},"posts":{"external":true,"family":null},"logo":{"external":true,"family":null,"size":null},"codes":{"external":true,"family":null,"size":null}},"math":{"enable":false,"per_page":true,"engine":"mathjax","mathjax":{"cdn":"//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"},"katex":{"cdn":"//cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css"}},"han":false,"pangu":false,"disqus":{"enable":false,"shortname":null,"count":true,"lazyload":false},"changyan":{"enable":false,"appid":null,"appkey":null},"valine":{"enable":false,"appid":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","appkey":"CnhNSWBKT3kwj52vyJ36armb","notify":false,"verify":false,"placeholder":"Just go go","avatar":"mm","guest_info":"nick,mail,link","pageSize":10},"livere_uid":"MTAyMC8yODQwNi80OTc3","gitment":{"enable":false,"mint":true,"count":true,"lazy":false,"cleanly":false,"language":null,"github_user":null,"github_repo":null,"client_id":null,"client_secret":null,"proxy_gateway":null,"redirect_protocol":null},"needmoreshare2":{"enable":false,"postbottom":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"bottomCenter","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}},"float":{"enable":false,"options":{"iconStyle":"box","boxForm":"horizontal","position":"middleRight","networks":"Weibo,Wechat,Douban,QQZone,Twitter,Facebook"}}},"facebook_sdk":{"enable":false,"app_id":null,"fb_admin":null,"like_button":null,"webmaster":null},"facebook_comments_plugin":{"enable":false,"num_of_posts":10,"width":"100%","scheme":"light"},"vkontakte_api":{"enable":false,"app_id":null,"like":true,"comments":true,"num_of_posts":10},"rating":{"enable":false,"id":null,"color":"fc6423"},"leancloud_visitors":{"enable":false,"app_id":"P08Jh3wwb2zPhfm9puCevcUa-gzGzoHsz","app_key":"CnhNSWBKT3kwj52vyJ36armb","security":true,"betterPerformance":false},"firestore":{"enable":false,"collection":"articles","apiKey":null,"projectId":null,"bluebird":false},"busuanzi_count":{"enable":true,"total_visitors":true,"total_visitors_icon":"user","total_views":true,"total_views_icon":"eye","post_views":true,"post_views_icon":"eye"},"baidu_push":true,"calendar":{"enable":false,"calendar_id":"<required>","api_key":"<required>","orderBy":"startTime","offsetMax":24,"offsetMin":4,"timeZone":null,"showDeleted":false,"singleEvents":true,"maxResults":250},"algolia_search":{"enable":false,"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"local_search":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false},"bookmark":{"enable":false,"save":"auto"},"exturl":false,"note":{"style":"simple","icons":false,"border_radius":3,"light_bg_offset":0},"label":true,"tabs":{"enable":true,"transition":{"tabs":false,"labels":true},"border_radius":0},"reading_progress":{"enable":false,"color":"#37c6c0","height":"2px"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"fancybox":false,"fastclick":false,"lazyload":false,"pace":false,"pace_theme":"pace-theme-minimal","canvas_nest":false,"three_waves":false,"canvas_lines":true,"canvas_sphere":false,"canvas_ribbon":{"enable":false,"size":300,"alpha":0.6,"zIndex":-1},"vendors":{"_internal":"lib","jquery":null,"fancybox":null,"fancybox_css":null,"fastclick":null,"lazyload":null,"velocity":null,"velocity_ui":null,"ua_parser":null,"fontawesome":null,"algolia_instant_js":null,"algolia_instant_css":null,"pace":null,"pace_css":null,"canvas_nest":null,"three":null,"three_waves":null,"canvas_lines":null,"canvas_sphere":null,"canvas_ribbon":null,"han":null,"pangu":null,"needmoreshare2_js":null,"needmoreshare2_css":null,"bookmark":null,"reading_progress":null,"valine":null},"css":"css","js":"js","images":"images","version":"6.0.6"}}},"excerpt":"<p>i18next是一个用来支持应用国际化的javascript库,不依赖于其他第三方js库如jQuuery。<a href=\"https://github.com/i18next/i18next\" target=\"_blank\" rel=\"noopener\">i18next官方网站</a><br>","more":"</p>\n<h1 id=\"1-初始化init\"><a href=\"#1-初始化init\" class=\"headerlink\" title=\"1 初始化init\"></a>1 初始化init</h1><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\">i18next</div><div class=\"line\">    .use(i18nextXHRBackend)</div><div class=\"line\">    .init(&#123;</div><div class=\"line\">        <span class=\"attr\">fallbackLng</span>: <span class=\"string\">'en'</span>,</div><div class=\"line\">        <span class=\"attr\">lng</span>: <span class=\"string\">'en'</span>,</div><div class=\"line\">        <span class=\"attr\">debug</span>: <span class=\"literal\">false</span>,</div><div class=\"line\">        <span class=\"attr\">ns</span>: <span class=\"string\">'strings'</span>,</div><div class=\"line\">        <span class=\"attr\">defaultNS</span>: <span class=\"string\">'strings'</span>,</div><div class=\"line\">        <span class=\"attr\">backend</span>: &#123;</div><div class=\"line\">            <span class=\"attr\">loadPath</span>: src + <span class=\"string\">'/&#123;&#123;lng&#125;&#125;/&#123;&#123;ns&#125;&#125;.json'</span>, <span class=\"comment\">//在每个html中定义localesPath，即localesPath文件夹路径</span></div><div class=\"line\">            crossDomain: <span class=\"literal\">true</span></div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, t</span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// init set content</span></div><div class=\"line\">        <span class=\"keyword\">var</span> array = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">'[data-i18n]'</span>);</div><div class=\"line\">        <span class=\"keyword\">if</span>(array)&#123;</div><div class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = array.length; i &lt; len; i++) &#123;</div><div class=\"line\">                <span class=\"keyword\">var</span> value = array[i].getAttribute(<span class=\"string\">'data-i18n'</span>);</div><div class=\"line\">                array[i].innerHTML = i18next.t(value);</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">var</span> inputs = <span class=\"built_in\">document</span>.querySelectorAll(<span class=\"string\">'input'</span>);</div><div class=\"line\">        <span class=\"keyword\">if</span>(inputs) &#123;</div><div class=\"line\">            <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, len = inputs.length; i &lt; len; i++) &#123;</div><div class=\"line\">            \t<span class=\"keyword\">var</span> placeholder = inputs[i].getAttribute(<span class=\"string\">\"placeholder\"</span>);</div><div class=\"line\">            \t<span class=\"keyword\">var</span> value = inputs[i].getAttribute(<span class=\"string\">'data-i18n'</span>);</div><div class=\"line\">            \t<span class=\"keyword\">if</span>(placeholder != <span class=\"literal\">null</span>)&#123;</div><div class=\"line\">                \tinputs[i].setAttribute(<span class=\"string\">\"placeholder\"</span>, i18next.t(value));</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;);</div></pre></td></tr></table></figure>\n<h1 id=\"2-API\"><a href=\"#2-API\" class=\"headerlink\" title=\"2 API\"></a>2 API</h1><h2 id=\"2-1-init\"><a href=\"#2-1-init\" class=\"headerlink\" title=\"2.1 init\"></a>2.1 init</h2><pre><code>i18next.init(options, callback)\n</code></pre><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div></pre></td><td class=\"code\"><pre><div class=\"line\">i18next.init(&#123;</div><div class=\"line\">    <span class=\"attr\">fallbackLng</span>: <span class=\"string\">'en'</span>,</div><div class=\"line\">    <span class=\"attr\">ns</span>: [<span class=\"string\">'file1'</span>, <span class=\"string\">'file2'</span>],</div><div class=\"line\">    <span class=\"attr\">defaultNS</span>: <span class=\"string\">'file1'</span>,</div><div class=\"line\">    <span class=\"attr\">debug</span>: <span class=\"literal\">true</span></div><div class=\"line\">&#125;, (err, t) =&gt; &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(err) <span class=\"keyword\">return</span> <span class=\"built_in\">console</span>.log(<span class=\"string\">'something went wrong loading'</span>, err);</div><div class=\"line\">    t(<span class=\"string\">'key'</span>); <span class=\"comment\">// -&gt; same as i18next.t</span></div><div class=\"line\">&#125;);</div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">// with only callback</span></div><div class=\"line\">i18next.init(<span class=\"function\">(<span class=\"params\">err, t</span>) =&gt;</span> &#123;</div><div class=\"line\">    <span class=\"keyword\">if</span>(err) <span class=\"keyword\">return</span> <span class=\"built_in\">console</span>.log(<span class=\"string\">'something went wrong loading'</span>, err);</div><div class=\"line\">    t(<span class=\"string\">'key'</span>); <span class=\"comment\">// -&gt; same as i18next.t</span></div><div class=\"line\">&#125;);</div></pre></td></tr></table></figure>\n<ul>\n<li>debug:default false，是否输出日志</li>\n<li>fallbackLng:default ‘dev’,当当前语言中找不到key，则去fallbackLng中查找</li>\n<li>lng:default undefined,设置当前翻译的语言</li>\n<li>ns：default ‘translation’，命名空间，可以是数组，可以理解为国际化文件的名字</li>\n<li>defaultNS：default ‘translation’，如果没有找到设置的ns文件，则去找defaultNS文件</li>\n<li>backend：设置国际化文件路径，需要配合<strong><em>i18nextXHRBackend</em></strong>插件使用，可以跨域读取网络文件，可以读取本地文件。具体配置参看<a href=\"https://github.com/i18next/i18next-xhr-backend\" target=\"_blank\" rel=\"noopener\">i18next-xhr-backend</a><ul>\n<li>loadPath： 文件路径</li>\n<li>crossDomain： 是否强制跨域</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"2-2-use\"><a href=\"#2-2-use\" class=\"headerlink\" title=\"2.2 use\"></a>2.2 use</h2><pre><code>i18next.use(module)\n</code></pre><p>用来添加插件,如下代码所示，注意：一定要在工程中引入对应的js文件<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div></pre></td><td class=\"code\"><pre><div class=\"line\">i18next</div><div class=\"line\">  .use(Backend)</div><div class=\"line\">  .use(Cache)</div><div class=\"line\">  .use(LanguageDetector)</div><div class=\"line\">  .use(postProcessor)</div><div class=\"line\">  .init(options, callback);</div></pre></td></tr></table></figure></p>\n<h2 id=\"2-3-t\"><a href=\"#2-3-t\" class=\"headerlink\" title=\"2.3 t\"></a>2.3 t</h2><pre><code>i18next.t(keys, options)\n</code></pre><p>在js中手动查找key得到对应翻译，options可省略，基本用法如下，详细用法请参看<a href=\"https://www.i18next.com/interpolation.html\" target=\"_blank\" rel=\"noopener\">interpolation</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div></pre></td><td class=\"code\"><pre><div class=\"line\">i18next.t(<span class=\"string\">'common.hello'</span>) 或 t(<span class=\"string\">'common.hello'</span>)</div></pre></td></tr></table></figure>\n<h1 id=\"3-小结\"><a href=\"#3-小结\" class=\"headerlink\" title=\"3 小结\"></a>3 小结</h1><p>以上是i18next的基本使用，可以满足基本的国际化需求。对于更加复杂的国际化需求，请参看官方文档。</p>\n<p>说明：</p>\n<ol>\n<li>国际化文件为json格式</li>\n<li>国际化文件路径建议设置为 locales/语言（国家代码）/命名空间.json</li>\n<li>对应第2条，loadPath设置为 locales文件夹路径//.json</li>\n</ol>"}],"PostAsset":[],"PostCategory":[{"post_id":"cjgd7qfhw0002hwvfbbdjm4ow","category_id":"cjgd7qfib0003hwvf33e2tlso","_id":"cjgd7qfii0006hwvfjunq2j30"},{"post_id":"cjgd7qfkg0007hwvfvctmi5kt","category_id":"cjgd7qfkp0009hwvftp7d0jcd","_id":"cjgd7qfl0000fhwvfnw4vhddb"},{"post_id":"cjgd7qfkl0008hwvfy7z1qvzl","category_id":"cjgd7qfky000dhwvfh2vc4trr","_id":"cjgd7qfl3000jhwvf5twbox70"},{"post_id":"cjgd7qfkq000bhwvfocloccxp","category_id":"cjgd7qfky000dhwvfh2vc4trr","_id":"cjgd7qfl4000mhwvfmus9p2ae"},{"post_id":"cjgd7qfkt000chwvfr9drspvb","category_id":"cjgd7qfl2000ihwvfzj8j1oru","_id":"cjgd7qfl6000rhwvf4s0ieknc"},{"post_id":"cjgd7qfsg000xhwvf7jxgv2vg","category_id":"cjgd7qfso0011hwvfipahmc88","_id":"cjgd7qfta001fhwvf0y56xhtf"},{"post_id":"cjgd7qfsl000zhwvfgvucz8mg","category_id":"cjgd7qft10018hwvf16lfwma8","_id":"cjgd7qftk001phwvfmhyfgyjn"},{"post_id":"cjgd7qfsq0013hwvfkrzbii7j","category_id":"cjgd7qft10018hwvf16lfwma8","_id":"cjgd7qftr001whwvfvnsooidy"},{"post_id":"cjgd7qfth001mhwvfnctznxiv","category_id":"cjgd7qfl2000ihwvfzj8j1oru","_id":"cjgd7qftt0020hwvfnhymltor"},{"post_id":"cjgd7qfsu0015hwvft7qmm20g","category_id":"cjgd7qft10018hwvf16lfwma8","_id":"cjgd7qftw0024hwvfbv4ebqc1"},{"post_id":"cjgd7qftr001yhwvfxwcyx6yl","category_id":"cjgd7qft10018hwvf16lfwma8","_id":"cjgd7qftz0029hwvfnt8jf233"},{"post_id":"cjgd7qfsz0017hwvfyhdroaje","category_id":"cjgd7qft10018hwvf16lfwma8","_id":"cjgd7qfu2002ehwvf9jean5gk"},{"post_id":"cjgd7qft3001chwvffn6emk6i","category_id":"cjgd7qftv0023hwvfcfz7c17q","_id":"cjgd7qfua002hhwvfdsgauex9"},{"post_id":"cjgd7qft8001ehwvfc8s4vpbl","category_id":"cjgd7qftv0023hwvfcfz7c17q","_id":"cjgd7qfuf002nhwvfif48unh0"},{"post_id":"cjgd7qfub002jhwvfg83fmxgg","category_id":"cjgd7qfso0011hwvfipahmc88","_id":"cjgd7qfuj002shwvfatk4bz3l"},{"post_id":"cjgd7qfte001jhwvf0dhdblkz","category_id":"cjgd7qftv0023hwvfcfz7c17q","_id":"cjgd7qfuq002xhwvfs6e1u533"},{"post_id":"cjgd7qfud002lhwvfn5fmm000","category_id":"cjgd7qfso0011hwvfipahmc88","_id":"cjgd7qfus0030hwvfimp5jx1e"},{"post_id":"cjgd7qfug002qhwvfwaiz3dal","category_id":"cjgd7qftv0023hwvfcfz7c17q","_id":"cjgd7qfuu0035hwvfnyjvep68"},{"post_id":"cjgd7qftl001rhwvfq9xmx96r","category_id":"cjgd7qfue002mhwvfpwjbk0ol","_id":"cjgd7qfuw0038hwvfhiv24ndl"},{"post_id":"cjgd7qfto001thwvfwvlmkoz1","category_id":"cjgd7qfue002mhwvfpwjbk0ol","_id":"cjgd7qfv0003chwvf3izfn96d"},{"post_id":"cjgd7qfur002zhwvfb34iftst","category_id":"cjgd7qfso0011hwvfipahmc88","_id":"cjgd7qfv3003fhwvfacgtzved"},{"post_id":"cjgd7qftt0021hwvfi5lt419g","category_id":"cjgd7qftv0023hwvfcfz7c17q","_id":"cjgd7qfv5003ihwvf1vo7v1lo"},{"post_id":"cjgd7qfuy003bhwvfb1t5t0b3","category_id":"cjgd7qfso0011hwvfipahmc88","_id":"cjgd7qfv9003nhwvfqijm7kd4"},{"post_id":"cjgd7qftw0026hwvf93cu6816","category_id":"cjgd7qfux0039hwvfdnszvedu","_id":"cjgd7qfvc003qhwvfd33m533n"},{"post_id":"cjgd7qfv7003mhwvfbmutchbc","category_id":"cjgd7qfkp0009hwvftp7d0jcd","_id":"cjgd7qfvi003vhwvfdlp9qywv"},{"post_id":"cjgd7qfty0028hwvffi31zjoj","category_id":"cjgd7qfux0039hwvfdnszvedu","_id":"cjgd7qfvm003zhwvf82b4wtj4"},{"post_id":"cjgd7qfvd003thwvf3xd3nix8","category_id":"cjgd7qfso0011hwvfipahmc88","_id":"cjgd7qfvo0041hwvflmwcqg86"},{"post_id":"cjgd7qfu1002dhwvfgihr2t6i","category_id":"cjgd7qfvc003phwvfr204thm6","_id":"cjgd7qfvq0046hwvfm80zgdro"},{"post_id":"cjgd7qfvg003uhwvfeuqu52g0","category_id":"cjgd7qfso0011hwvfipahmc88","_id":"cjgd7qfvs0049hwvfofuqrz84"},{"post_id":"cjgd7qfvl003yhwvfjvan7gso","category_id":"cjgd7qfso0011hwvfipahmc88","_id":"cjgd7qfvu004dhwvfrixksci4"},{"post_id":"cjgd7qfu7002fhwvf6pe5h09l","category_id":"cjgd7qfux0039hwvfdnszvedu","_id":"cjgd7qfvw004fhwvfc7pjmb4w"},{"post_id":"cjgd7qfvn0040hwvfpk1y2tlb","category_id":"cjgd7qfso0011hwvfipahmc88","_id":"cjgd7qfw0004jhwvffy10zc8q"},{"post_id":"cjgd7qfui002rhwvf10t5nurf","category_id":"cjgd7qfvo0043hwvftmfehbwg","_id":"cjgd7qfw3004lhwvfyneooy0h"},{"post_id":"cjgd7qfum002whwvfsyaxynkm","category_id":"cjgd7qfvo0043hwvftmfehbwg","_id":"cjgd7qfw7004qhwvffeivkd42"},{"post_id":"cjgd7qfvx004ihwvfvm80xzzm","category_id":"cjgd7qfl2000ihwvfzj8j1oru","_id":"cjgd7qfwb004thwvfq9ii5dsp"},{"post_id":"cjgd7qfuu0034hwvfncgz38xd","category_id":"cjgd7qfvo0043hwvftmfehbwg","_id":"cjgd7qfwi004yhwvf3iar7c0j"},{"post_id":"cjgd7qfw1004khwvfuh76rimv","category_id":"cjgd7qfkp0009hwvftp7d0jcd","_id":"cjgd7qfwl0051hwvf5649eg5o"},{"post_id":"cjgd7qfuv0037hwvfhhcwa5a5","category_id":"cjgd7qfvo0043hwvftmfehbwg","_id":"cjgd7qfwm0055hwvfdi4pnl7m"},{"post_id":"cjgd7qfv1003ehwvfdf2m7yco","category_id":"cjgd7qfvc003phwvfr204thm6","_id":"cjgd7qfwn0057hwvfaxy4z8mg"},{"post_id":"cjgd7qfv4003hhwvfewdqh7zn","category_id":"cjgd7qfvo0043hwvftmfehbwg","_id":"cjgd7qfwo005bhwvfl7y9pyln"},{"post_id":"cjgd7qfvb003ohwvfn3590ocm","category_id":"cjgd7qfvo0043hwvftmfehbwg","_id":"cjgd7qfwp005fhwvfmmzr81t8"},{"post_id":"cjgd7qfvp0045hwvf0gkcedh7","category_id":"cjgd7qfwo005ahwvfvt8xo6li","_id":"cjgd7qfwr005khwvfa1lkrzeb"},{"post_id":"cjgd7qfvr0048hwvfd485j534","category_id":"cjgd7qfwo005ahwvfvt8xo6li","_id":"cjgd7qfws005mhwvfdsbsnnl7"},{"post_id":"cjgd7qfvt004chwvfgxys3sia","category_id":"cjgd7qfwq005jhwvflo3loc70","_id":"cjgd7qfwv005rhwvf25eetz21"},{"post_id":"cjgd7qfvu004ehwvfhu3z9zcf","category_id":"cjgd7qfwt005nhwvfbjxedmn3","_id":"cjgd7qfwy005xhwvfpp03y0zi"},{"post_id":"cjgd7qfw5004phwvfwchsweyo","category_id":"cjgd7qfwo005ahwvfvt8xo6li","_id":"cjgd7qfx00061hwvfelljrftl"},{"post_id":"cjgd7qfwa004shwvfrt79b0en","category_id":"cjgd7qfwq005jhwvflo3loc70","_id":"cjgd7qfx10065hwvfpive55pq"},{"post_id":"cjgd7qfwg004xhwvf2bvp9qkv","category_id":"cjgd7qfwt005nhwvfbjxedmn3","_id":"cjgd7qfx20068hwvfkbta5tyl"},{"post_id":"cjgd7qfwk0050hwvf3ija97jx","category_id":"cjgd7qfwo005ahwvfvt8xo6li","_id":"cjgd7qfx3006bhwvfs59x9snp"}],"PostTag":[{"post_id":"cjgd7qfhw0002hwvfbbdjm4ow","tag_id":"cjgd7qfie0004hwvffvjo49w1","_id":"cjgd7qfig0005hwvfl46xc42e"},{"post_id":"cjgd7qfkg0007hwvfvctmi5kt","tag_id":"cjgd7qfkp000ahwvf2bvp3o9z","_id":"cjgd7qfl3000lhwvfagdbjqll"},{"post_id":"cjgd7qfkg0007hwvfvctmi5kt","tag_id":"cjgd7qfkz000ehwvf4arxwqq6","_id":"cjgd7qfl5000nhwvf09j5tu7u"},{"post_id":"cjgd7qfkg0007hwvfvctmi5kt","tag_id":"cjgd7qfl0000hhwvfamohuzss","_id":"cjgd7qfl6000phwvfti3bjmad"},{"post_id":"cjgd7qfkl0008hwvfy7z1qvzl","tag_id":"cjgd7qfl3000khwvf4nvjhrib","_id":"cjgd7qfl6000qhwvfq0hdfsr5"},{"post_id":"cjgd7qfkq000bhwvfocloccxp","tag_id":"cjgd7qfl3000khwvf4nvjhrib","_id":"cjgd7qfl8000thwvfbd81pt9t"},{"post_id":"cjgd7qfkt000chwvfr9drspvb","tag_id":"cjgd7qfl7000shwvfb4w9gnsp","_id":"cjgd7qfla000vhwvfs7hbt0cv"},{"post_id":"cjgd7qfkt000chwvfr9drspvb","tag_id":"cjgd7qfl9000uhwvfnt5htsnh","_id":"cjgd7qflb000whwvfair70s1i"},{"post_id":"cjgd7qfsg000xhwvf7jxgv2vg","tag_id":"cjgd7qfsp0012hwvf7mdec3kc","_id":"cjgd7qft2001bhwvf06n5u2hn"},{"post_id":"cjgd7qfsl000zhwvfgvucz8mg","tag_id":"cjgd7qft10019hwvf2aewmt85","_id":"cjgd7qftg001khwvfwoq1yv9b"},{"post_id":"cjgd7qfsq0013hwvfkrzbii7j","tag_id":"cjgd7qft10019hwvf2aewmt85","_id":"cjgd7qftn001shwvfwjgr1m25"},{"post_id":"cjgd7qfth001mhwvfnctznxiv","tag_id":"cjgd7qfl7000shwvfb4w9gnsp","_id":"cjgd7qftq001uhwvfuldfob8f"},{"post_id":"cjgd7qfth001mhwvfnctznxiv","tag_id":"cjgd7qfl9000uhwvfnt5htsnh","_id":"cjgd7qfts001zhwvf0b2357n3"},{"post_id":"cjgd7qfsu0015hwvft7qmm20g","tag_id":"cjgd7qft10019hwvf2aewmt85","_id":"cjgd7qftv0022hwvf6s8efuul"},{"post_id":"cjgd7qftr001yhwvfxwcyx6yl","tag_id":"cjgd7qft10019hwvf2aewmt85","_id":"cjgd7qfty0027hwvf3k43huye"},{"post_id":"cjgd7qfsz0017hwvfyhdroaje","tag_id":"cjgd7qft10019hwvf2aewmt85","_id":"cjgd7qfu0002ahwvfosipum88"},{"post_id":"cjgd7qft3001chwvffn6emk6i","tag_id":"cjgd7qftw0025hwvf2o7k6q4k","_id":"cjgd7qfud002khwvf0yhjjzde"},{"post_id":"cjgd7qft3001chwvffn6emk6i","tag_id":"cjgd7qfu0002chwvfhhm8ebbo","_id":"cjgd7qfuf002ohwvfkwzgkr1l"},{"post_id":"cjgd7qfug002qhwvfwaiz3dal","tag_id":"cjgd7qftw0025hwvf2o7k6q4k","_id":"cjgd7qfuk002thwvf5k2c6xym"},{"post_id":"cjgd7qfug002qhwvfwaiz3dal","tag_id":"cjgd7qfu0002chwvfhhm8ebbo","_id":"cjgd7qfur002yhwvffnh2gmzq"},{"post_id":"cjgd7qft8001ehwvfc8s4vpbl","tag_id":"cjgd7qftw0025hwvf2o7k6q4k","_id":"cjgd7qfut0031hwvfqry1wytx"},{"post_id":"cjgd7qft8001ehwvfc8s4vpbl","tag_id":"cjgd7qfu0002chwvfhhm8ebbo","_id":"cjgd7qfuv0036hwvf95zufr2u"},{"post_id":"cjgd7qfte001jhwvf0dhdblkz","tag_id":"cjgd7qftw0025hwvf2o7k6q4k","_id":"cjgd7qfv0003dhwvf3k5v1lqk"},{"post_id":"cjgd7qfte001jhwvf0dhdblkz","tag_id":"cjgd7qfu0002chwvfhhm8ebbo","_id":"cjgd7qfv4003ghwvfik16p3yd"},{"post_id":"cjgd7qftl001rhwvfq9xmx96r","tag_id":"cjgd7qfuy003ahwvfd0ferjzo","_id":"cjgd7qfv7003lhwvfj7ku3l2t"},{"post_id":"cjgd7qfto001thwvfwvlmkoz1","tag_id":"cjgd7qfuy003ahwvfd0ferjzo","_id":"cjgd7qfvd003shwvf85bu2wzz"},{"post_id":"cjgd7qftt0021hwvfi5lt419g","tag_id":"cjgd7qftw0025hwvf2o7k6q4k","_id":"cjgd7qfvp0044hwvfjk4ch1v2"},{"post_id":"cjgd7qftt0021hwvfi5lt419g","tag_id":"cjgd7qfu0002chwvfhhm8ebbo","_id":"cjgd7qfvr0047hwvfzqado6fu"},{"post_id":"cjgd7qfvx004ihwvfvm80xzzm","tag_id":"cjgd7qfl9000uhwvfnt5htsnh","_id":"cjgd7qfw5004nhwvfndeizhlc"},{"post_id":"cjgd7qfvx004ihwvfvm80xzzm","tag_id":"cjgd7qfl7000shwvfb4w9gnsp","_id":"cjgd7qfw9004rhwvff9wj3jat"},{"post_id":"cjgd7qftw0026hwvf93cu6816","tag_id":"cjgd7qfvo0042hwvf0hh3s9du","_id":"cjgd7qfwc004vhwvf6z7wp02j"},{"post_id":"cjgd7qftw0026hwvf93cu6816","tag_id":"cjgd7qfvs004ahwvf4piz5lzy","_id":"cjgd7qfwj004zhwvfc4rrgwfy"},{"post_id":"cjgd7qftw0026hwvf93cu6816","tag_id":"cjgd7qfvx004hhwvfhhzde1r9","_id":"cjgd7qfwl0053hwvf7v8y4g6y"},{"post_id":"cjgd7qfty0028hwvffi31zjoj","tag_id":"cjgd7qfvo0042hwvf0hh3s9du","_id":"cjgd7qfwo0059hwvfafg2xqbv"},{"post_id":"cjgd7qfty0028hwvffi31zjoj","tag_id":"cjgd7qfvs004ahwvf4piz5lzy","_id":"cjgd7qfwo005chwvfgc7bxk4g"},{"post_id":"cjgd7qfty0028hwvffi31zjoj","tag_id":"cjgd7qfvx004hhwvfhhzde1r9","_id":"cjgd7qfwp005ehwvfb4xns219"},{"post_id":"cjgd7qfu1002dhwvfgihr2t6i","tag_id":"cjgd7qfwn0058hwvfkrxju9f6","_id":"cjgd7qfwp005ghwvfrldbk76v"},{"post_id":"cjgd7qfu7002fhwvf6pe5h09l","tag_id":"cjgd7qfvo0042hwvf0hh3s9du","_id":"cjgd7qfwu005phwvfknaqput5"},{"post_id":"cjgd7qfu7002fhwvf6pe5h09l","tag_id":"cjgd7qfvs004ahwvf4piz5lzy","_id":"cjgd7qfwu005qhwvfw9q4nm0f"},{"post_id":"cjgd7qfu7002fhwvf6pe5h09l","tag_id":"cjgd7qfvx004hhwvfhhzde1r9","_id":"cjgd7qfww005uhwvfsmxwuo4e"},{"post_id":"cjgd7qfub002jhwvfg83fmxgg","tag_id":"cjgd7qfwt005ohwvfrismq9my","_id":"cjgd7qfwx005vhwvfz3bdvkpp"},{"post_id":"cjgd7qfud002lhwvfn5fmm000","tag_id":"cjgd7qfwt005ohwvfrismq9my","_id":"cjgd7qfwz005zhwvf86091v2d"},{"post_id":"cjgd7qfui002rhwvf10t5nurf","tag_id":"cjgd7qfwy005yhwvf5lfcivus","_id":"cjgd7qfx00063hwvftwrs07z0"},{"post_id":"cjgd7qfum002whwvfsyaxynkm","tag_id":"cjgd7qfwy005yhwvf5lfcivus","_id":"cjgd7qfx20067hwvfkhp7996d"},{"post_id":"cjgd7qfur002zhwvfb34iftst","tag_id":"cjgd7qfwt005ohwvfrismq9my","_id":"cjgd7qfx3006ahwvfvytdpanx"},{"post_id":"cjgd7qfuu0034hwvfncgz38xd","tag_id":"cjgd7qfwy005yhwvf5lfcivus","_id":"cjgd7qfx4006dhwvfl9eqfnuk"},{"post_id":"cjgd7qfuv0037hwvfhhcwa5a5","tag_id":"cjgd7qfwy005yhwvf5lfcivus","_id":"cjgd7qfx5006fhwvfbtfr5bve"},{"post_id":"cjgd7qfuy003bhwvfb1t5t0b3","tag_id":"cjgd7qfwt005ohwvfrismq9my","_id":"cjgd7qfx6006hhwvfeap07lc2"},{"post_id":"cjgd7qfv1003ehwvfdf2m7yco","tag_id":"cjgd7qfwn0058hwvfkrxju9f6","_id":"cjgd7qfx7006jhwvf6sh9affm"},{"post_id":"cjgd7qfv4003hhwvfewdqh7zn","tag_id":"cjgd7qfwy005yhwvf5lfcivus","_id":"cjgd7qfx8006lhwvfndvs14pf"},{"post_id":"cjgd7qfv7003mhwvfbmutchbc","tag_id":"cjgd7qfx7006khwvf8piv0ys0","_id":"cjgd7qfxb006ohwvf8r657em6"},{"post_id":"cjgd7qfv7003mhwvfbmutchbc","tag_id":"cjgd7qfx9006mhwvfw6cblslc","_id":"cjgd7qfxb006phwvfk889y131"},{"post_id":"cjgd7qfvb003ohwvfn3590ocm","tag_id":"cjgd7qfwy005yhwvf5lfcivus","_id":"cjgd7qfxc006rhwvf8dp32ur7"},{"post_id":"cjgd7qfvd003thwvf3xd3nix8","tag_id":"cjgd7qfxb006qhwvf32zh0g0k","_id":"cjgd7qfxd006thwvfj6dw0xsv"},{"post_id":"cjgd7qfvg003uhwvfeuqu52g0","tag_id":"cjgd7qfxb006qhwvf32zh0g0k","_id":"cjgd7qfxf006whwvf1llmy2zr"},{"post_id":"cjgd7qfvg003uhwvfeuqu52g0","tag_id":"cjgd7qfxe006uhwvfdhemwx3f","_id":"cjgd7qfxf006xhwvfdsnrfg3j"},{"post_id":"cjgd7qfvl003yhwvfjvan7gso","tag_id":"cjgd7qfxb006qhwvf32zh0g0k","_id":"cjgd7qfxg0070hwvfaz05f4w9"},{"post_id":"cjgd7qfvl003yhwvfjvan7gso","tag_id":"cjgd7qfxf006yhwvf3vnr3hgo","_id":"cjgd7qfxg0071hwvf5wqc9tmj"},{"post_id":"cjgd7qfvn0040hwvfpk1y2tlb","tag_id":"cjgd7qfxb006qhwvf32zh0g0k","_id":"cjgd7qfxh0073hwvfuwjkjgw2"},{"post_id":"cjgd7qfvp0045hwvf0gkcedh7","tag_id":"cjgd7qfxg0072hwvfafun1qix","_id":"cjgd7qfxh0075hwvfvsbcicuq"},{"post_id":"cjgd7qfvr0048hwvfd485j534","tag_id":"cjgd7qfxh0074hwvfryrx2ens","_id":"cjgd7qfxi0077hwvfsdtn9jfc"},{"post_id":"cjgd7qfvt004chwvfgxys3sia","tag_id":"cjgd7qfxh0076hwvfboqe0ty2","_id":"cjgd7qfxi0079hwvf2j4b4ayt"},{"post_id":"cjgd7qfvu004ehwvfhu3z9zcf","tag_id":"cjgd7qfxi0078hwvf16ou9hvd","_id":"cjgd7qfxj007bhwvfmvzh2kng"},{"post_id":"cjgd7qfw1004khwvfuh76rimv","tag_id":"cjgd7qfkp000ahwvf2bvp3o9z","_id":"cjgd7qfxo007dhwvfg413ykos"},{"post_id":"cjgd7qfw1004khwvfuh76rimv","tag_id":"cjgd7qfx7006khwvf8piv0ys0","_id":"cjgd7qfxp007ehwvfyw3kwug6"},{"post_id":"cjgd7qfw5004phwvfwchsweyo","tag_id":"cjgd7qfxj007chwvfn3xmrwub","_id":"cjgd7qfxq007ghwvf2yg4ova3"},{"post_id":"cjgd7qfwa004shwvfrt79b0en","tag_id":"cjgd7qfxh0076hwvfboqe0ty2","_id":"cjgd7qfxr007ihwvf4ybiijyh"},{"post_id":"cjgd7qfwg004xhwvf2bvp9qkv","tag_id":"cjgd7qfxi0078hwvf16ou9hvd","_id":"cjgd7qfxr007khwvftl03lgsv"},{"post_id":"cjgd7qfwk0050hwvf3ija97jx","tag_id":"cjgd7qfxh0074hwvfryrx2ens","_id":"cjgd7qfxs007lhwvffhf2uthj"}],"Tag":[{"name":"activiti","_id":"cjgd7qfie0004hwvffvjo49w1"},{"name":"MUI","_id":"cjgd7qfkp000ahwvf2bvp3o9z"},{"name":"Android Studio","_id":"cjgd7qfkz000ehwvf4arxwqq6"},{"name":"离线打包","_id":"cjgd7qfl0000hhwvfamohuzss"},{"name":"Java虚拟机","_id":"cjgd7qfl3000khwvf4nvjhrib"},{"name":"Java","_id":"cjgd7qfl7000shwvfb4w9gnsp"},{"name":"多线程","_id":"cjgd7qfl9000uhwvfnt5htsnh"},{"name":"properties","_id":"cjgd7qfsp0012hwvf7mdec3kc"},{"name":"Mybatis","_id":"cjgd7qft10019hwvf2aewmt85"},{"name":"Mysql","_id":"cjgd7qftw0025hwvf2o7k6q4k"},{"name":"数据库","_id":"cjgd7qfu0002chwvfhhm8ebbo"},{"name":"NM3000","_id":"cjgd7qfuy003ahwvfd0ferjzo"},{"name":"snmp","_id":"cjgd7qfvo0042hwvf0hh3s9du"},{"name":"network","_id":"cjgd7qfvs004ahwvf4piz5lzy"},{"name":"snmp4j","_id":"cjgd7qfvx004hhwvfhhzde1r9"},{"name":"Blog","_id":"cjgd7qfwn0058hwvfkrxju9f6"},{"name":"SpringMVC","_id":"cjgd7qfwt005ohwvfrismq9my"},{"name":"Struts2","_id":"cjgd7qfwy005yhwvf5lfcivus"},{"name":"html5+","_id":"cjgd7qfx7006khwvf8piv0ys0"},{"name":"native.js","_id":"cjgd7qfx9006mhwvfw6cblslc"},{"name":"Spring","_id":"cjgd7qfxb006qhwvf32zh0g0k"},{"name":"AOP","_id":"cjgd7qfxe006uhwvfdhemwx3f"},{"name":"IOC","_id":"cjgd7qfxf006yhwvf3vnr3hgo"},{"name":"Web","_id":"cjgd7qfxg0072hwvfafun1qix"},{"name":"国际化","_id":"cjgd7qfxh0074hwvfryrx2ens"},{"name":"设计模式","_id":"cjgd7qfxh0076hwvfboqe0ty2"},{"name":"算法","_id":"cjgd7qfxi0078hwvf16ou9hvd"},{"name":"数据收集","_id":"cjgd7qfxj007chwvfn3xmrwub"}]}}